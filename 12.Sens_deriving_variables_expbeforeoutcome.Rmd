---
title: "Deriving variables: Sensitivity analysis"
author: "Helena Davies"
date: "21/12/2021"
output: html_document
---

This script derives variables ready for sensitivity analysis in which exposures must come BEFORE outcomes and NOT in the same phase. Therefore, all baseline reports of outcomes do not count and we have amended the 'exposures before outcome' chunks.

This script derives variables ready for regression analyses.
Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Read in file with path to data channel
```{r Read in file with path to data channel}
source(file = "../credentials/paths.R")
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = paste0(filepath_functions, "add_numeric.R"))
source(file = paste0(filepath_functions, "remove_duplicates.R"))
source(file = paste0(filepath_functions, "package_check.R"))
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

# Read in data
```{r Read in data}
# Need these data for re-deriving the outcome variables with no baseline 
additional_dat <- readRDS(paste0(filepath_saved_data, "final_dat_no_dup_entries2022-09-27.rds")) 

additional_dat <- additional_dat %>%
  select(contains("ID"),
         contains("sample"),
         contains("taf"), # Self-harm responses at each phase
         contains("ed_scid5"), # Eating disorder responses at each phase
         contains("pandemic_binge_eating_derived"),
         contains("pandemic_low_weight_derived")
          )

# Also need these data for variables I'm not changing
final_dat_merged <- readRDS(paste0(filepath_saved_data, "final_dat_merged_exclusions_2022-10-04.rds"))

final_dat_merged <- final_dat_merged %>%
  select(ID,
         # Eating disorder prepandemic variables from 2.BASELINE_ED_groupings
         lifetime_binge_eating_baseline_numeric,
         lifetime_low_weight_baseline_numeric,
         
         # Exposures in all models
         age_category_COVID_baseline,
         minoritised_gender,
         sex_binary,
         race_binary,
         highest_education,
         mental_health_diagnosis,
         increased_loneliness_during_pandemic,
         paid_employment_key_worker,
         vulnerable_group_member,
         panworry_total_score,
         
         # Time at which participants first experienced each outcome
         outcome_phase_binge_eating,
         outcome_phase_low_weight,
         outcome_phase_harmful_ideation,
         outcome_phase_selfharm,

          # Time at which participants first experienced exposures with follow-up data
         exposure_phase_losing_someone,
         exposure_phase_positive_covid_test,       
         exposure_phase_living_situation_change,
         exposure_phase_main_eco_change
)

# Merge
dat <- dplyr::left_join(final_dat_merged,
                        additional_dat,
                        by ="ID")
```

First, need to create new outcome variables which do NOT count baseline reports. This is because we are ONLY accepting reports where the outcome has been reported AFTER (i.e., in a phase after) the exposures. Many exposures are collected only at baseline (e.g., vulnerable group member status). Therefore, because of these exposures, we need to remove all instances 
# Outcome = Binge eating (without baseline)
## Derive ANY Binge eating during the COVID-19 pandemic
```{r Derive any binge eating during the pandemic no baseline}
dat <- dat %>%
  mutate(pandemic_binge_eating =
           case_when(# ed_scid5.regular_episodes_eating_binges_.Wavebaseline == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_1b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_2b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_3b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_4b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_6b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_8b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_10b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_12b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_14b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_16b == "Yes" ~ 1, # Answered yes at least once to the binge eating screener
                     
                      is.na(ed_scid5.regular_episodes_eating_binges_.Wavebaseline) &
                      is.na(ed_scid5.regular_episodes_eating_binges_.Wave_1b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_2b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_3b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_4b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_6b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_8b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_10b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_12b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_14b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_16b)  ~ NA_real_, # Captures anyone who did not answer any of the binge eating screeners at any phase
                     
                      ed_scid5.regular_episodes_eating_binges_.Wavebaseline == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_1b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_2b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_3b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_4b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_6b == "No" |
                      ed_scid5.regular_episodes_eating_binges_.Wave_8b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_10b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_12b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_14b == "No" | 
                      ed_scid5.regular_episodes_eating_binges_.Wave_16b == "No"  ~ 0 # Captures anyone who has at least one "No" and never said "Yes" and is not NA for all phases
                    
           ))

# Check
dat %>%
  freq(pandemic_binge_eating)
```

NEW binge eating experience, i.e., those who at baseline indicated no lifetime experience of binge eating
```{r Derive NEW binge eating experience}
dat <- dat %>%
  mutate(sens2_NEW_binge_eating_pandemic =
           case_when(
             lifetime_binge_eating_baseline_numeric == 0 & # No lifetime binge eating at baseline...
               
               #...but occured at least once during the pandemic
                     (pandemic_binge_eating == 1  | # as identified above
                     pandemic_binge_eating_derived == 1)  # as identified in the script "2.Baseline_ED_groupings"
                     ~ 1,
                     
                     lifetime_binge_eating_baseline_numeric == 0 &  # No lifetime binge eating at baseline, and no binge eating during the pandemic
                     pandemic_binge_eating == 0 ~ 0
           )
  )

dat %>%
  freq(sens2_NEW_binge_eating_pandemic) # NAs are because the sample is restricted to those who did NOT report binge eating at baseline

# Check NAs
dat %>%
  filter(is.na(sens2_NEW_binge_eating_pandemic) &
         lifetime_binge_eating_baseline_numeric == 0) %>% # Only interested in those with no prepan experience
  freq(pandemic_binge_eating)
```

# Outcome = Low weight (without baseline)
## Derive ANY low weight during the COVID-19 pandemic
```{r Derive ANY low weight during pandemic no baseline}
dat <- dat %>%
  mutate(pandemic_low_weight =
           case_when(
                     # ed_scid5.weigh_weighed_past_month_.Wavebaseline == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "Yes" ~ 1, # Answered yes at least once to the low weight screener
                     
                  is.na(ed_scid5.weigh_weighed_past_month_.Wavebaseline) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b) ~ NA_real_, # Captures anyone who did not answer any of the low weight screeners at any phase
                     
                  ed_scid5.weigh_weighed_past_month_.Wavebaseline == "No" |
                       ed_scid5.weigh_weighed_past_month_.Wave_1b == "No" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "No"  ~ 0 # Captures anyone who has at least one "No" and never said "Yes" and is not NA for all phases (answer options are only "Yes" or "No")
                    
           )
  )

# Check
dat %>%
  freq(pandemic_low_weight)
```

NEW low weight experience, i.e., those who at baseline indicated no lifetime experience of binge eating
```{r Derive NEW low weight experience during pandemic}
dat <- dat %>%
  mutate(sens2_NEW_low_weight_pandemic =
           case_when( 
                  # No lifetime low weight at baseline...
                   lifetime_low_weight_baseline_numeric == 0 & 
               
                 #... but occurred at least once during the pandemic
                     (pandemic_low_weight == 1 |
                     pandemic_low_weight_derived == 1)  # as identified in the script "2.Baseline_ED_groupings" 
                        ~ 1,
                     
                     lifetime_low_weight_baseline_numeric == 0 &  # No lifetime low weight at baseline, and no low weight during the pandemic
                     pandemic_low_weight == 0 ~ 0
            )
  )

dat %>%
  freq(sens2_NEW_low_weight_pandemic) # NAs are because the sample is restricted to those who did NOT report low weight at baseline

# Check NAs
dat %>%
  filter(is.na(sens2_NEW_low_weight_pandemic) &
           lifetime_low_weight_baseline_numeric == 0) %>% # Only interested in those with no prepan experience
  freq(pandemic_low_weight)
```

# Outcome = Passive suicidal ideation (without baseline)
## Derive ANY passive suicidal ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Many people have thoughts that life is not worth living. Have you felt that way?" If "Yes", they are asked: "Have you felt that way in the past two weeks?"
```{r Passive suicidal ideation in the past two weeks no baseline}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation =
           case_when(
                   #  taf.felt_weeks_past_.Wavebaseline == "Yes" |
                      taf.felt_weeks_past_.Wave_1a == "Yes" |
                       taf.felt_weeks_past_.Wave_1b == "Yes" |
                       taf.felt_weeks_past_.Wave_2a == "Yes" |
                       taf.felt_weeks_past_.Wave_2b == "Yes" |
                       taf.felt_weeks_past_.Wave_3a == "Yes" |
                       taf.felt_weeks_past_.Wave_3b == "Yes" |
                       taf.felt_weeks_past_.Wave_4a == "Yes" |
                       taf.felt_weeks_past_.Wave_4b == "Yes" |
                       taf.felt_weeks_past_.Wave_5a == "Yes" |
                       taf.felt_weeks_past_.Wave_6b == "Yes" |
                       taf.felt_weeks_past_.Wave_7a == "Yes" |
                       taf.felt_weeks_past_.Wave_8b == "Yes" |
                       taf.felt_weeks_past_.Wave_9a == "Yes" |
                       taf.felt_weeks_past_.Wave_10b == "Yes" |
                       taf.felt_weeks_past_.Wave_11a == "Yes" |
                       taf.felt_weeks_past_.Wave_12b == "Yes" |
                       taf.felt_weeks_past_.Wave_13a == "Yes" |
                       taf.felt_weeks_past_.Wave_14b == "Yes" |
                       taf.felt_weeks_past_.Wave_15a == "Yes" |
                       taf.felt_weeks_past_.Wave_16b == "Yes"  ~ 1, # Said 'Yes' at least once during the pandemic
                        
      # Either never answered screener or DID answer screener but never answered about last two weeks
                 (
             (is.na(taf.worth_living_life_people_.Wavebaseline) | # Did not answer screener
               ((taf.worth_living_life_people_.Wavebaseline == "Yes, once" | # Passed screener
                 taf.worth_living_life_people_.Wavebaseline == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wavebaseline))) & # Didn't answer about last two weeks 
               
               (is.na(taf.worth_living_life_people_.Wave_1a) |
                  ((taf.worth_living_life_people_.Wave_1a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_1a == "Yes, more than once") &
                   is.na(taf.felt_weeks_past_.Wave_1a))) &
               
                (is.na(taf.worth_living_life_people_.Wave_1b) |
               ((taf.worth_living_life_people_.Wave_1b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_1b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_1b))) &
               
               (is.na(taf.worth_living_life_people_.Wave_2a) |
                ((taf.worth_living_life_people_.Wave_2a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_2a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_2a))) &
                   
                (is.na(taf.worth_living_life_people_.Wave_2b) |
               ((taf.worth_living_life_people_.Wave_2b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_2b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_2b))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3a) |
               ((taf.worth_living_life_people_.Wave_3a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_3a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_3a))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3b) |
               ((taf.worth_living_life_people_.Wave_3b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_3b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_3b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4a) |
               ((taf.worth_living_life_people_.Wave_4a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_4a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_4a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4b) |
               ((taf.worth_living_life_people_.Wave_4b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_4b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_4b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_5a) |
               ((taf.worth_living_life_people_.Wave_5a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_5a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_5a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_6b) |
              ((taf.worth_living_life_people_.Wave_6b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_6b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_6b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_7a) |
               ((taf.worth_living_life_people_.Wave_7a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_7a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_7a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_8b) |
              ((taf.worth_living_life_people_.Wave_8b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_8b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_8b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_9a) |
               ((taf.worth_living_life_people_.Wave_9a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_9a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_9a))) & 
               
              (is.na(taf.worth_living_life_people_.Wave_10b) |
                ((taf.worth_living_life_people_.Wave_10b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_10b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_10b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_11a) |
               ((taf.worth_living_life_people_.Wave_11a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_11a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_11a))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_12b) |
                ((taf.worth_living_life_people_.Wave_12b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_12b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_12b))) & 
                 
                   (is.na(taf.worth_living_life_people_.Wave_13a) |
               ((taf.worth_living_life_people_.Wave_13a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_13a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_13a))) & 
                 
                  (is.na(taf.worth_living_life_people_.Wave_14b) |
                ((taf.worth_living_life_people_.Wave_14b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_14b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_14b))) & 
                 
                 (is.na(taf.worth_living_life_people_.Wave_15a) |
                ((taf.worth_living_life_people_.Wave_15a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_15a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_15a))) & 
                      
                  (is.na(taf.worth_living_life_people_.Wave_16b) |
               ((taf.worth_living_life_people_.Wave_16b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_16b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_16b)))
               ) ~ NA_real_, 
                     
               # Either never experienced it (lifetime) or HAS but not in the last two weeks       
             (
             (taf.worth_living_life_people_.Wavebaseline == "No" | 
               taf.felt_weeks_past_.Wavebaseline == "No") |
               
               (taf.worth_living_life_people_.Wave_1a == "No" | 
               taf.felt_weeks_past_.Wave_1a == "No") |
               
               (taf.worth_living_life_people_.Wave_1b == "No" | 
               taf.felt_weeks_past_.Wave_1b == "No") |
               
               (taf.worth_living_life_people_.Wave_2a == "No" | 
               taf.felt_weeks_past_.Wave_2a == "No") |
               
               (taf.worth_living_life_people_.Wave_2b == "No" | 
               taf.felt_weeks_past_.Wave_2b== "No") |
               
               (taf.worth_living_life_people_.Wave_3a == "No" | 
               taf.felt_weeks_past_.Wave_3a == "No") |
               
               (taf.worth_living_life_people_.Wave_3b == "No" | 
               taf.felt_weeks_past_.Wave_3b == "No") |
               
               (taf.worth_living_life_people_.Wave_4a == "No" | 
               taf.felt_weeks_past_.Wave_4a == "No") |
               
               (taf.worth_living_life_people_.Wave_4b == "No" | 
               taf.felt_weeks_past_.Wave_4b == "No") |
               
                 (taf.worth_living_life_people_.Wave_5a == "No" | 
               taf.felt_weeks_past_.Wave_5a == "No") |
               
                (taf.worth_living_life_people_.Wave_6b == "No" | 
               taf.felt_weeks_past_.Wave_6b == "No") |
               
                (taf.worth_living_life_people_.Wave_7a == "No" | 
               taf.felt_weeks_past_.Wave_7a == "No") |
               
               (taf.worth_living_life_people_.Wave_8b == "No" | 
               taf.felt_weeks_past_.Wave_8b == "No") |
               
                (taf.worth_living_life_people_.Wave_9a == "No" | 
               taf.felt_weeks_past_.Wave_9a == "No") |
               
               (taf.worth_living_life_people_.Wave_10b == "No" | 
               taf.felt_weeks_past_.Wave_10b == "No") |
               
               (taf.worth_living_life_people_.Wave_11a == "No" | 
               taf.felt_weeks_past_.Wave_11a == "No") |
               
               (taf.worth_living_life_people_.Wave_12b  == "No" | 
               taf.felt_weeks_past_.Wave_12b == "No") |
               
               (taf.worth_living_life_people_.Wave_13a  == "No" | 
               taf.felt_weeks_past_.Wave_13a == "No") |
               
               (taf.worth_living_life_people_.Wave_14b  == "No" | 
               taf.felt_weeks_past_.Wave_14b == "No") |
               
                (taf.worth_living_life_people_.Wave_15a  == "No" | 
               taf.felt_weeks_past_.Wave_15a == "No") |
               
               (taf.worth_living_life_people_.Wave_16b  == "No" | 
               taf.felt_weeks_past_.Wave_16b == "No")
             ) ~ 0 
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)
```

### Experience ever
In the follow ups and baseline, participants are also asked: "Many people have thoughts that life is not worth living. Have you felt that way". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Passive suicidal ideation ever}
# Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_passive_suicidal_ideation =
           case_when(
                    (# taf.worth_living_life_people_.Wavebaseline == "Yes, once" |
                      taf.worth_living_life_people_.Wave_1a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_13a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_14b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_15a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_16b == "Yes, once" |
                      
                    #  taf.worth_living_life_people_.Wavebaseline == "Yes, more than once" |
                        taf.worth_living_life_people_.Wave_1a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_13a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_14b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_15a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_16b == "Yes, more than once")  ~ 1, # Answered yes at least once
                        
                       (is.na(taf.worth_living_life_people_.Wavebaseline) &
                       is.na(taf.worth_living_life_people_.Wave_1a) &
                       is.na(taf.worth_living_life_people_.Wave_1b) &
                       is.na(taf.worth_living_life_people_.Wave_2a) &
                       is.na(taf.worth_living_life_people_.Wave_2b) &
                       is.na(taf.worth_living_life_people_.Wave_3a) &
                       is.na(taf.worth_living_life_people_.Wave_3b) &
                       is.na(taf.worth_living_life_people_.Wave_4a) &
                       is.na(taf.worth_living_life_people_.Wave_4b) &
                       is.na(taf.worth_living_life_people_.Wave_5a) &
                       is.na(taf.worth_living_life_people_.Wave_6b) &
                       is.na(taf.worth_living_life_people_.Wave_7a) &
                       is.na(taf.worth_living_life_people_.Wave_8b) &
                       is.na(taf.worth_living_life_people_.Wave_9a) &
                       is.na(taf.worth_living_life_people_.Wave_10b) &
                       is.na(taf.worth_living_life_people_.Wave_11a) &
                       is.na(taf.worth_living_life_people_.Wave_12b) &
                       is.na(taf.worth_living_life_people_.Wave_13a) &
                       is.na(taf.worth_living_life_people_.Wave_14b) &
                       is.na(taf.worth_living_life_people_.Wave_15a) &
                       is.na(taf.worth_living_life_people_.Wave_16b))  ~ NA_real_, # Captures those missing at every phase
                     
                     (taf.worth_living_life_people_.Wavebaseline == "No" |
                       taf.worth_living_life_people_.Wave_1a == "No" |
                       taf.worth_living_life_people_.Wave_1b == "No"  |
                       taf.worth_living_life_people_.Wave_2a == "No" |
                       taf.worth_living_life_people_.Wave_2b == "No" |
                       taf.worth_living_life_people_.Wave_3a == "No" |
                       taf.worth_living_life_people_.Wave_3b == "No" |
                       taf.worth_living_life_people_.Wave_4a == "No" |
                       taf.worth_living_life_people_.Wave_4b == "No" |
                       taf.worth_living_life_people_.Wave_5a == "No" |
                       taf.worth_living_life_people_.Wave_6b == "No" |
                       taf.worth_living_life_people_.Wave_7a == "No" |
                       taf.worth_living_life_people_.Wave_8b == "No" |
                       taf.worth_living_life_people_.Wave_9a == "No" |
                       taf.worth_living_life_people_.Wave_10b == "No" | 
                       taf.worth_living_life_people_.Wave_11a == "No" | 
                       taf.worth_living_life_people_.Wave_12b == "No" | 
                       taf.worth_living_life_people_.Wave_13a == "No" | 
                       taf.worth_living_life_people_.Wave_14b == "No" | 
                       taf.worth_living_life_people_.Wave_15a == "No" | 
                       taf.worth_living_life_people_.Wave_16b == "No") ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           )
         )

# Check
dat %>%
  freq(EVER_PANDEMIC_passive_suicidal_ideation)
```

### PREPANDEMIC passive suicidal ideation 
At baseline, participants are first asked: "Many people have thoughts that life is not worth living. Have you felt that way?" (taf.worth_living_thoughts_life_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.
```{r Passive suicidal ideation baseline pre-pandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_passive_suicidal_ideation =
           case_when(
             
                  taf.worth_living_life_people_.Wavebaseline == "No" ~ 0, # Never experienced it (lifetime)
                  
                    taf.pandemic_felt_.Wavebaseline == "No" ~ 0, # Have in their life but not before the pandemic
                    taf.pandemic_felt_.Wavebaseline == "Yes" ~ 1 # Have in their life AND before the pandemic
                  )
                      
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_passive_suicidal_ideation)

# Check NAs
dat %>%
  filter(is.na(PREPANDEMIC_passive_suicidal_ideation)) %>%
           freq(taf.worth_living_life_people_.Wavebaseline) # Some NAs are people who said yes to lifetime but then PNTA or NA to pre-pandemic or NA

dat %>%
  filter(is.na(PREPANDEMIC_passive_suicidal_ideation)) %>%
           freq(taf.pandemic_felt_.Wavebaseline)
```

### NEW passive suicidal ideation experience, i.e., those who at baseline indicated no prepandemic experience of passive suicidal ideation and then went on to experience it
Combined - passive suicidal ideation during the pandemic 
*Basically, if someone has said that they experienced it BEFORE the pandemic AND they endorse lifetime experience during the pandemic, it's hard for us to work out whether their experience is ONLY BEFORE the pandemic (therefore, should be 0 for pandemic experience) or whether they are referencing their experience BEFORE the pandemic AND during the pandemic (so should be 1 for pandemic experience). Decided to just look at those with NO prepandemic experience.
```{r Derive NEW passive suicidal ideation experience}
dat <- dat %>%
  mutate(NEW_passive_suicidal_ideation_pandemic =
           case_when(
             PREPANDEMIC_passive_suicidal_ideation == 0 & # No pre-pandemic passive suicidal ideation
               
               #...but occured at least once during the pandemic
                     (TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1   | # either in the past two weeks question
                      EVER_PANDEMIC_passive_suicidal_ideation == 1)  ~ 1, # or in the lifetime question
                     
             
                PREPANDEMIC_passive_suicidal_ideation == 0 & # No pre-pandemic passive suicidal ideation
                EVER_PANDEMIC_passive_suicidal_ideation == 0  ~ 0 # never in their life (therefore don't get asked 2 week question)
                     
          )
  )

dat %>%
  freq(NEW_passive_suicidal_ideation_pandemic) # NAs are because the sample is restricted to those who did NOT report binge eating at baseline

# Check NAs (should all be NA)
dat %>%
  filter(is.na(NEW_passive_suicidal_ideation_pandemic) &
         PREPANDEMIC_passive_suicidal_ideation == 0) %>% # only interested in those without prepandemic experience
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)

dat %>%
  filter(is.na(NEW_passive_suicidal_ideation_pandemic) &
         PREPANDEMIC_passive_suicidal_ideation == 0) %>% # only interested in those without prepandemic experience
  freq(EVER_PANDEMIC_passive_suicidal_ideation)
```

# Outcome = Self-harm ideation (without baseline)
## Derive ANY self-harm ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Have you contemplated harming yourself?" [If "Yes"] then asked "Have you felt that way in the past two weeks?" (taf.felt_weeks_past.1_.Wave_1a etc)
```{r Self-harm ideation ANY past two weeks pandemic no baseline}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_selfharm_ideation =
           case_when( # taf.felt_weeks_past.1_.Wavebaseline == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_13a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_14b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_15a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_16b == "Yes" ~ 1, # Said "Yes" at any point to the two week question
                        
              # Either never answered screener or DID answer screener but never answered about last two weeks
                (
             (is.na(taf.have_you_contemplated_harming_yourself_.Wavebaseline) |
                 ((taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wavebaseline))) &
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_1a))) &
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_1b))) &
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_2a))) &
                   
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_2b))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_3a))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_3b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_4a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) |
                (taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes" &
               is.na(taf.felt_weeks_past.1_.Wave_4b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_5a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_6b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_7a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_8b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_9a))) & 
               
                      (is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_10b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_11a))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_12b))) & 
                 
                   (is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_13a))) & 
                 
                  (is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_14b))) & 
                 
                 (is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_15a))) & 
                      
                  (is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_16b)))
               ) ~ NA_real_, 
                     
               # Either never experienced it (lifetime) or HAS but not in the last two weeks       
             (
             (taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" | 
               taf.felt_weeks_past.1_.Wavebaseline == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | 
               taf.felt_weeks_past.1_.Wave_1a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | 
               taf.felt_weeks_past.1_.Wave_1b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | 
               taf.felt_weeks_past.1_.Wave_2a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | 
               taf.felt_weeks_past.1_.Wave_2b== "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | 
               taf.felt_weeks_past.1_.Wave_3a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | 
               taf.felt_weeks_past.1_.Wave_3b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | 
               taf.felt_weeks_past.1_.Wave_4a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | 
               taf.felt_weeks_past.1_.Wave_4b == "No") |
               
                 (taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | 
               taf.felt_weeks_past.1_.Wave_5a == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | 
               taf.felt_weeks_past.1_.Wave_6b == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | 
               taf.felt_weeks_past.1_.Wave_7a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | 
               taf.felt_weeks_past.1_.Wave_8b == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" | 
               taf.felt_weeks_past.1_.Wave_9a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | 
               taf.felt_weeks_past.1_.Wave_10b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | 
               taf.felt_weeks_past.1_.Wave_11a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_12b  == "No" | 
               taf.felt_weeks_past.1_.Wave_12b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_13a  == "No" | 
               taf.felt_weeks_past.1_.Wave_13a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_14b  == "No" | 
               taf.felt_weeks_past.1_.Wave_14b == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_15a  == "No" | 
               taf.felt_weeks_past.1_.Wave_15a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_16b  == "No" | 
               taf.felt_weeks_past.1_.Wave_16b == "No")
             ) ~ 0 
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)
```

### Experience ever (without baseline)
In the follow ups, participants are also asked lifetime self-harm ideation: "Have you contemplated harming yourself?". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Self-harm ideation EVER pandemic no baseline}
# Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_selfharm_ideation =
           case_when(
             (
                      # taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" |
                       
                     #  taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once") 
                     ~ 1, # "Yes" at at least one phase
                       
                      (is.na(taf.have_you_contemplated_harming_yourself_.Wavebaseline) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) &
                        is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b))
                       ~ NA_real_, # Missing at every phase
                     
                       (taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" |
                         taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "No")  ~ 0 # "No" at least once and never said "Yes"
                     )
         )

# Check
dat %>%
  freq(EVER_PANDEMIC_selfharm_ideation)
```

### PREPANDEMIC self-harm ideation 
At baseline, participants are first asked: "Have you contemplated harming yourself ?" (taf.have_you_contemplated_harming_yourself_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt.1_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.

```{r Self-harm ideation prepandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_ideation =
           case_when(
                     taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" ~ 0, # Never experienced it in their life
                     
                     taf.pandemic_felt.1_.Wavebaseline == "No" ~ 0, # Have experienced it in their life but not before the pandemic
                     taf.pandemic_felt.1_.Wavebaseline == "Yes" ~ 1 # Have experienced it before in their life and before the pandemic
                     )
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_selfharm_ideation)

# Check NAs
dat %>%
  filter(is.na(PREPANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wavebaseline) # Again, some NAs are people who said Yes to lifetime but then did not answer or PNTA for pre-pandemic question

dat %>%
  filter(is.na(PREPANDEMIC_selfharm_ideation)) %>%
  freq(taf.pandemic_felt.1_.Wavebaseline)
```

### NEW self-harm ideation experience, i.e., those who at baseline indicated no prepandemic experience of self-harm ideation
```{r Derive NEW self harm ideation experience}
dat <- dat %>%
  mutate(NEW_selfharm_ideation_pandemic =
           case_when(
             PREPANDEMIC_selfharm_ideation == 0 & # No pre-pandemic self-harm ideation
               
               #...but occured at least once during the pandemic
                     (TWO_WEEKS_PANDEMIC_selfharm_ideation == 1   | # either in the past two weeks question
                      EVER_PANDEMIC_selfharm_ideation == 1)  ~ 1, # or in the lifetime question
                     
             
               PREPANDEMIC_selfharm_ideation == 0 & # No pre-pandemic self-harm ideation
                EVER_PANDEMIC_selfharm_ideation == 0  ~ 0 # & never in their life (therefore don't get asked 2 week question)
                     
          )
  )

dat %>%
  freq(NEW_selfharm_ideation_pandemic) 

# Check NAs
dat %>%
  filter(is.na(NEW_selfharm_ideation_pandemic) &
           PREPANDEMIC_selfharm_ideation == 0) %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)

dat %>%
  filter(is.na(NEW_selfharm_ideation_pandemic) &
           PREPANDEMIC_selfharm_ideation == 0) %>%
  freq(EVER_PANDEMIC_selfharm_ideation)
```

#### Combine self-harm ideation and passive suicidal ideation (correlation of 0.87)
```{r combining self-harm and suicidal ideation main analysis}
dat <- dat %>%
  mutate(sens2_NEW_harmful_ideation_pandemic =
           case_when(
              ((PREPANDEMIC_passive_suicidal_ideation == 0 &
               PREPANDEMIC_selfharm_ideation == 0) &
            (NEW_selfharm_ideation_pandemic == 1 |
             NEW_passive_suicidal_ideation_pandemic == 1) ~ 1),
            
            (PREPANDEMIC_passive_suicidal_ideation == 0 &
               PREPANDEMIC_selfharm_ideation == 0 &
             NEW_selfharm_ideation_pandemic == 0 &
             NEW_passive_suicidal_ideation_pandemic == 0 ~ 0)
             
           ))

# Check
dat %>%
  freq(sens2_NEW_harmful_ideation_pandemic)

# Check NAs
dat %>%
  filter(is.na(sens2_NEW_harmful_ideation_pandemic)) %>%
  freq(NEW_selfharm_ideation_pandemic)

dat %>%
  filter(is.na(sens2_NEW_harmful_ideation_pandemic)) %>%
  freq(NEW_passive_suicidal_ideation_pandemic)

dat %>% 
  filter(is.na(sens2_NEW_harmful_ideation_pandemic) &
           (!is.na(NEW_passive_suicidal_ideation_pandemic) |
              !is.na(NEW_selfharm_ideation_pandemic))
         ) %>%
  select(NEW_passive_suicidal_ideation_pandemic,
         NEW_selfharm_ideation_pandemic) # Some people missing have a 0 for one but are NA for the other. Can not assume they have not experienced some form of harmful ideation so have to drop from this variable. 
```

# Outcome = Self-harm (without baseline)
## Derive ANY self-harm during the COVID-19 pandemic
### Experience during past two weeks 
NB: There is no 'ever' question for self-harm
```{r Self-harm experience ANY past two weeks no baseline}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_selfharm =
           case_when(
                       (
                       #  taf.meant_life_end_weeks_.Wavebaseline == "Yes" |
                       taf.meant_life_end_weeks_.Wave_1a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_1b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_2a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_2b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_3a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_3b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_4a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_4b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_5a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_6b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_7a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_8b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_9a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_10b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_11a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_12b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_13a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_14b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_15a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_16b == "Yes")
                       ~ 1, # "Yes" at least once
                        
                       (is.na(taf.meant_life_end_weeks_.Wavebaseline) &
                       is.na(taf.meant_life_end_weeks_.Wave_1a) &
                       is.na(taf.meant_life_end_weeks_.Wave_1b) &
                       is.na(taf.meant_life_end_weeks_.Wave_2a) &
                       is.na(taf.meant_life_end_weeks_.Wave_2b) &
                       is.na(taf.meant_life_end_weeks_.Wave_3a) &
                       is.na(taf.meant_life_end_weeks_.Wave_3b) &
                       is.na(taf.meant_life_end_weeks_.Wave_4a) &
                       is.na(taf.meant_life_end_weeks_.Wave_4b) &
                       is.na(taf.meant_life_end_weeks_.Wave_5a) &
                       is.na(taf.meant_life_end_weeks_.Wave_6b) &
                       is.na(taf.meant_life_end_weeks_.Wave_7a) &
                       is.na(taf.meant_life_end_weeks_.Wave_8b) &
                       is.na(taf.meant_life_end_weeks_.Wave_9a) &
                       is.na(taf.meant_life_end_weeks_.Wave_10b) &
                       is.na(taf.meant_life_end_weeks_.Wave_11a) &
                       is.na(taf.meant_life_end_weeks_.Wave_12b) &
                       is.na(taf.meant_life_end_weeks_.Wave_13a) &
                       is.na(taf.meant_life_end_weeks_.Wave_14b) &
                       is.na(taf.meant_life_end_weeks_.Wave_15a) &
                       is.na(taf.meant_life_end_weeks_.Wave_16b))
                      ~ NA_real_, # Missing at every phase
                     
                       (taf.meant_life_end_weeks_.Wavebaseline == "No" | 
                       taf.meant_life_end_weeks_.Wave_1a == "No" |
                       taf.meant_life_end_weeks_.Wave_1b == "No" |
                       taf.meant_life_end_weeks_.Wave_2a == "No" |
                       taf.meant_life_end_weeks_.Wave_2b == "No" |
                       taf.meant_life_end_weeks_.Wave_3a == "No" |
                       taf.meant_life_end_weeks_.Wave_3b == "No" |
                       taf.meant_life_end_weeks_.Wave_4a == "No" |
                       taf.meant_life_end_weeks_.Wave_4b == "No" |
                       taf.meant_life_end_weeks_.Wave_5a == "No" |
                       taf.meant_life_end_weeks_.Wave_6b == "No" |
                       taf.meant_life_end_weeks_.Wave_7a == "No" |
                       taf.meant_life_end_weeks_.Wave_8b == "No" |
                       taf.meant_life_end_weeks_.Wave_9a == "No" |
                       taf.meant_life_end_weeks_.Wave_10b == "No" | 
                       taf.meant_life_end_weeks_.Wave_11a == "No" | 
                       taf.meant_life_end_weeks_.Wave_12b == "No" | 
                       taf.meant_life_end_weeks_.Wave_13a == "No" | 
                       taf.meant_life_end_weeks_.Wave_14b == "No" | 
                       taf.meant_life_end_weeks_.Wave_15a == "No" | 
                       taf.meant_life_end_weeks_.Wave_16b == "No") ~ 0 # Said "No" to at least one phase and never said "Yes"
                    
           ))
                    
   
# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm)
```

### PREPANDEMIC self-harm 
At baseline, participants are asked: "Before the pandemic, had you deliberately harmed yourself, whether or not you meant to end your life?" (taf.meant_end_life_pandemic_.Wavebaseline). Note again, there is no lifetime assessment of self-harm.
```{r Prepandemic self-harm experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm =
           case_when(
                    taf.meant_end_life_pandemic_.Wavebaseline == "No" ~ 0, # Not experienced self-harm before the pandemic
                    taf.meant_end_life_pandemic_.Wavebaseline == "Yes" ~ 1 # Experienced self-harm before the pandemic 
            )
  )

# Check 
dat %>%
  freq(PREPANDEMIC_selfharm) # NAs are either NA or PNTA for taf.meant_end_life_pandemic_.Wavebaseline 
```


### Self-harm during the pandemic 
NB: This question "Before the pandemic, had you deliberately harmed yourself, whether or not you meant to end your life?" is shown to everyone, so I don't need to use the same logic as with the other baseline questions (i.e., there is no screener question that asks about lifetime self-harm). Because there is no lifetime assessment of self-harm, there might be some people who joined the study later (e.g., in November 2020) and had self-harmed earlier in the pandemic (e.g., July) but we would not capture them.
```{r Combined self-harm baseline and follow up experience}
dat <- dat %>%
  mutate(selfharm_PANDEMIC =
           case_when(
            TWO_WEEKS_PANDEMIC_selfharm == 1 ~ 1,# Experienced DURING pandemic (answered yes to 2 week question during pandemic)
             
            TWO_WEEKS_PANDEMIC_selfharm == 0 ~ 0,# Experienced DURING pandemic (answered no to 2 week question during pandemic)
              
           )
  )

# Check
dat %>%
  freq(selfharm_PANDEMIC)

# Check NAs
dat %>%
  filter(is.na(selfharm_PANDEMIC)) %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm)
```

### NEW self-harm experience, i.e., those who at baseline indicated no prepandemic experience of self-harm
NEW experience of self-harm during the pandemic
```{r new experience of self-harm during pandemic}
dat <- dat %>%
  mutate(sens2_NEW_selfharm_pandemic =
           case_when(
            
            PREPANDEMIC_selfharm == 0 &
            selfharm_PANDEMIC == 1 ~ 1,
              
            PREPANDEMIC_selfharm == 0 &
            selfharm_PANDEMIC == 0 ~ 0
           
           )
  )

# Check
dat %>%
  freq(sens2_NEW_selfharm_pandemic)

# Check NAs
dat %>%
  filter(is.na(sens2_NEW_selfharm_pandemic) &
           PREPANDEMIC_selfharm == 0) %>%
  freq(selfharm_PANDEMIC)
```

*The below use follow-up data and are coded so that exposures are only counted if they happened BEFORE (and NOT in same phase as this is the sensitivity analysis in which they must have been reported BEFORE) the outcome*

## COVID-19 infection
```{r Positve COVID test result exposure BEFORE outcome BE - virus, dem and resp Q}
# Baseline
 dat <- dat %>%
  mutate(positive_covid_test_BE_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "Baseline" &
                     outcome_phase_binge_eating == "Baseline" ~ "To drop", # Drop co-occurring
                     
                     # These people will have experienced a positive COVID test before their first experience of BE
                       exposure_phase_positive_covid_test == "Baseline" & 
                       (outcome_phase_binge_eating == "1b" | 
                       outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
     
# Check
 dat %>%
   freq(positive_covid_test_BE_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_BE_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_binge_eating == "Baseline" ~ "To drop", 
                        
                     # These people will have experienced a positive COVID test before their first experience of BE
                        exposure_phase_positive_covid_test == "1a" & 
                       ( outcome_phase_binge_eating == "1b" | 
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_BE_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                      exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                      (outcome_phase_binge_eating == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline") ~ "To drop", 
                    
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_BE_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_BE_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_binge_eating == "1b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_binge_eating == "2b" | 
                        outcome_phase_binge_eating == "3b" | 
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_BE_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "1b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop
                    
                      exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       ( outcome_phase_binge_eating == "3b" |
                         outcome_phase_binge_eating == "4b" | 
                         outcome_phase_binge_eating == "6b" |
                         outcome_phase_binge_eating == "8b" |
                         outcome_phase_binge_eating == "10b" |
                         outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                         outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_BE_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                      outcome_phase_binge_eating == "6b" | 
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_BE_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_BE_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                        outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_BE_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                        outcome_phase_binge_eating == "10b" | 
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_BE_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", 
                     
                     # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_BE_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_BE_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b"|
                       outcome_phase_binge_eating == "6b" | # Co-occuring symptom and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                 
                         exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_BE_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b"|
                    outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                    exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_BE_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b"|
                       outcome_phase_binge_eating == "8b" |  # Co-occuring symptom and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                   outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_BE_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                   
                       exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_BE_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b"|
                       outcome_phase_binge_eating == "10b" | # Co-occuring symptom and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    (
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_BE_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                   outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_BE_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b"|
                       outcome_phase_binge_eating == "12b"| # Co-occurring
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                     ( outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occuring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_BE_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                   (outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
                             
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_13a)


# Phase 14b - 
dat <- dat %>%
  mutate(positive_covid_test_BE_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_binge_eating == "1b" |
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" | # Co-occuring symptom and exposure
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                     outcome_phase_binge_eating == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_14b)


# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_BE_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b"|
                        outcome_phase_binge_eating == "Baseline" )  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                     outcome_phase_binge_eating == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_15a)

# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_BE_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b"|
                        outcome_phase_binge_eating == "16b" | # Co-occuring symptom and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_16b)
```

Binge eating & Positive COVID test result
```{r Positve COVID test result exposure BE - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_BE =
           case_when(# First exposure NOT before first experience of outcome
                positive_covid_test_BE_baseline == "To drop" |
                            positive_covid_test_BE_1a == "To drop" |
                    positive_covid_test_BE_1b == "To drop" |
               positive_covid_test_BE_2a == "To drop" |
                    positive_covid_test_BE_2b == "To drop" |
               positive_covid_test_BE_3a == "To drop" |
                    positive_covid_test_BE_3b == "To drop" |
               positive_covid_test_BE_4a == "To drop" |
                    positive_covid_test_BE_4b == "To drop" |
               positive_covid_test_BE_5a == "To drop" |
                    positive_covid_test_BE_6b == "To drop" |
               positive_covid_test_BE_7a == "To drop" |
                    positive_covid_test_BE_8b == "To drop" |
               positive_covid_test_BE_9a == "To drop" |
                    positive_covid_test_BE_10b == "To drop" |
              positive_covid_test_BE_11a == "To drop" |
                    positive_covid_test_BE_12b == "To drop" |
                positive_covid_test_BE_13a == "To drop" |
                    positive_covid_test_BE_14b == "To drop" |
                positive_covid_test_BE_15a == "To drop" |
                    positive_covid_test_BE_16b == "To drop"  | # Positive test after binge eating
                    
                    
                     # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "To drop", # Missing whether experienced binge eating
                    
                    # First positive test BEFORE first experience of binge eating
             positive_covid_test_BE_baseline == "Yes" |
                    positive_covid_test_BE_1a == "Yes" |
             positive_covid_test_BE_1b == "Yes" |
               positive_covid_test_BE_2a == "Yes" |
              positive_covid_test_BE_2b == "Yes" |
               positive_covid_test_BE_3a== "Yes" |
                    positive_covid_test_BE_3b == "Yes" |
               positive_covid_test_BE_4a == "Yes" |
                    positive_covid_test_BE_4b == "Yes" |
               positive_covid_test_BE_5a == "Yes" |
                    positive_covid_test_BE_6b == "Yes" |
               positive_covid_test_BE_7a == "Yes" |
                    positive_covid_test_BE_8b == "Yes" |
               positive_covid_test_BE_9a == "Yes" |
                    positive_covid_test_BE_10b== "Yes" |
               positive_covid_test_BE_11a == "Yes" |
                    positive_covid_test_BE_12b == "Yes" |
               positive_covid_test_BE_13a == "Yes" |
                    positive_covid_test_BE_14b == "Yes" |
               positive_covid_test_BE_15a == "Yes" |
                    positive_covid_test_BE_16b == "Yes"  ~ "Positive test before binge eating",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_BE_baseline == "No outcome" |
             positive_covid_test_BE_1a == "No outcome" |
                    positive_covid_test_BE_1b == "No outcome" |
               positive_covid_test_BE_2a == "No outcome" |
                    positive_covid_test_BE_2b == "No outcome" |
               positive_covid_test_BE_3a == "No outcome" |
                    positive_covid_test_BE_3b == "No outcome" |
               positive_covid_test_BE_4a == "No outcome" |
                    positive_covid_test_BE_4b == "No outcome" |
               positive_covid_test_BE_5a == "No outcome" |
                    positive_covid_test_BE_6b == "No outcome" |
               positive_covid_test_BE_7a == "No outcome" |
                    positive_covid_test_BE_8b == "No outcome" |
               positive_covid_test_BE_9a == "No outcome" |
                    positive_covid_test_BE_10b == "No outcome" |
               positive_covid_test_BE_11a == "No outcome" |
                    positive_covid_test_BE_12b == "No outcome" |
               positive_covid_test_BE_13a == "No outcome" |
                    positive_covid_test_BE_14b == "No outcome" |
               positive_covid_test_BE_15a == "No outcome" |
                    positive_covid_test_BE_16b == "No outcome"  ~ "Exposure but no outcome",
             
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     (outcome_phase_binge_eating != "Not answered" &
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     outcome_phase_binge_eating == "Not experienced" ~ "Neither exposure nor outcome"
  
      )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_BE) 

# Check NAs
dat %>%
  filter(is.na(positive_covid_test_before_BE)) %>%
  freq(exposure_phase_positive_covid_test) 

dat %>%
  filter(is.na(positive_covid_test_before_BE)) %>%
  freq(outcome_phase_binge_eating)

# Create final variable of positive COVID test before BE outcome
dat <- dat %>%
  mutate(positive_covid_test_before_BE_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered whether they'd experienced the exposure
             # Taken a test but not indicated result of test
             # Need to drop people who never answered whether they'd experienced the outcome
             
             positive_covid_test_before_BE == "To drop" ~ NA_character_,  
                     
                     positive_covid_test_before_BE ==  "Outcome but no exposure" |
                     positive_covid_test_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                     positive_covid_test_before_BE == "Exposure but no outcome" | # Had COVID but no outcome 
                    positive_covid_test_before_BE == "Positive test before binge eating" ~ "Yes" # Those who had outcome, only include those who had exposure first
                    )
  )

# Check
dat %>%
  freq(positive_covid_test_before_BE_final)

# Check NAs
missing <- dat %>%
  filter(is.na(positive_covid_test_before_BE_final) 
           )

# These people should all have experienced outcome before exposure, or missing test result etc    
missing %>%
  filter(exposure_phase_positive_covid_test != "Not experienced" &
          outcome_phase_binge_eating != "Not answered") %>%
  select(exposure_phase_positive_covid_test,
         outcome_phase_binge_eating
         )
```

Low weight 
```{r Positve COVID test result exposure BEFORE outcome LW - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_LW_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                    exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_low_weight == "Baseline" ~ "To drop", # Co-occurring
                      
                     # These people will have experienced a positive COVID test before their first experience of LW
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (outcome_phase_low_weight == "Baseline" | 
                         outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_LW_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_low_weight == "Baseline" ~ "To drop", 
                        
                     # These people will have experienced a positive COVID test before their first experience of LW
                        exposure_phase_positive_covid_test == "1a" & 
                       (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_LW_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                      (outcome_phase_low_weight == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "Baseline") ~ "To drop",
                        
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_LW_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_low_weight == "1b" |
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_low_weight == "2b" | 
                        outcome_phase_low_weight == "3b" | 
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_LW_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_low_weight == "1b" |
                        outcome_phase_low_weight == "2b" )  ~ "To drop", # Co-occurring outcome and exposure
                     # First experience of low weight occurred before first COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" | 
                        outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_LW_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" | 
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_LW_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_low_weight == "1b" |
                        outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                     outcome_phase_low_weight == "2b" |
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weightoccurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_LW_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" | 
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_LW_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_low_weight == "3b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_LW_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_LW_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "6b" | # Co-occuring symptom and exposure
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_LW_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_LW_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"|
                       outcome_phase_low_weight == "8b" |  # Co-occuring symptom and exposure
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_LW_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_LW_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight== "2b" |
                     outcome_phase_low_weight== "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b"|
                       outcome_phase_low_weight == "10b" | # Co-occuring symptom and exposure
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    (
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_LW_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_LW_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b"|
                       outcome_phase_low_weight == "12b" | # Co-occurring
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_LW_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    (outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_13a)

# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_LW_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    (outcome_phase_low_weight == "14b" | # Co-occurring symptom and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_14b)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_LW_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "Baseline"
                     )  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                     outcome_phase_low_weight == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_LW_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b"| # Co-occurring
                         outcome_phase_low_weight == "Baseline"
                     )  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_16b)

```

Low weight & Positive COVID test result
```{r Positve COVID test result exposure LW - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_LW =
           case_when(# First exposure NOT before first experience of outcome
                positive_covid_test_LW_baseline == "To drop" |
                            positive_covid_test_LW_1a == "To drop" |
                    positive_covid_test_LW_1b == "To drop" |
               positive_covid_test_LW_2a == "To drop" |
                    positive_covid_test_LW_2b == "To drop" |
               positive_covid_test_LW_3a == "To drop" |
                    positive_covid_test_LW_3b == "To drop" |
               positive_covid_test_LW_4a == "To drop" |
                    positive_covid_test_LW_4b == "To drop" |
               positive_covid_test_LW_5a == "To drop" |
                    positive_covid_test_LW_6b == "To drop" |
               positive_covid_test_LW_7a == "To drop" |
                    positive_covid_test_LW_8b == "To drop" |
               positive_covid_test_LW_9a == "To drop" |
                    positive_covid_test_LW_10b == "To drop" |
              positive_covid_test_LW_11a == "To drop" |
                    positive_covid_test_LW_12b == "To drop" |
                positive_covid_test_LW_13a == "To drop" |
                    positive_covid_test_LW_14b == "To drop" |
                 positive_covid_test_LW_15a == "To drop" |
                    positive_covid_test_LW_16b == "To drop" | # Positive test after low weight
                    
                    
                     # Not answered whether they'd experienced low weight
                    outcome_phase_low_weight == "Not answered" ~ "To drop", # Missing whether experienced low weight
                    
                    # First exposure BEFORE first experience of outcome
             positive_covid_test_LW_baseline == "Yes" |
                    positive_covid_test_LW_1a == "Yes" |
             positive_covid_test_LW_1b == "Yes" |
               positive_covid_test_LW_2a == "Yes" |
              positive_covid_test_LW_2b == "Yes" |
               positive_covid_test_LW_3a == "Yes" |
                    positive_covid_test_LW_3b == "Yes" |
               positive_covid_test_LW_4a == "Yes" |
                    positive_covid_test_LW_4b == "Yes" |
               positive_covid_test_LW_5a == "Yes" |
                    positive_covid_test_LW_6b == "Yes" |
               positive_covid_test_LW_7a == "Yes" |
                    positive_covid_test_LW_8b == "Yes" |
               positive_covid_test_LW_9a == "Yes" |
                    positive_covid_test_LW_10b == "Yes" |
               positive_covid_test_LW_11a  == "Yes" |
                    positive_covid_test_LW_12b  == "Yes" |
               positive_covid_test_LW_13a  == "Yes" |
                    positive_covid_test_LW_14b  == "Yes" |
               positive_covid_test_LW_15a == "Yes" |
                    positive_covid_test_LW_16b == "Yes"~ "Positive test before low weight",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_LW_baseline == "No outcome" |
             positive_covid_test_LW_1a == "No outcome" |
                    positive_covid_test_LW_1b == "No outcome" |
               positive_covid_test_LW_2a == "No outcome" |
                    positive_covid_test_LW_2b == "No outcome" |
               positive_covid_test_LW_3a == "No outcome" |
                    positive_covid_test_LW_3b == "No outcome" |
               positive_covid_test_LW_4a == "No outcome" |
                    positive_covid_test_LW_4b == "No outcome" |
               positive_covid_test_LW_5a == "No outcome" |
                    positive_covid_test_LW_6b == "No outcome" |
               positive_covid_test_LW_7a == "No outcome" |
                    positive_covid_test_LW_8b == "No outcome" |
               positive_covid_test_LW_9a == "No outcome" |
                    positive_covid_test_LW_10b == "No outcome" |
               positive_covid_test_LW_11a == "No outcome" |
                    positive_covid_test_LW_12b == "No outcome" |
               positive_covid_test_LW_13a == "No outcome" |
                    positive_covid_test_LW_14b == "No outcome" |
               positive_covid_test_LW_15a == "No outcome" |
                    positive_covid_test_LW_16b == "No outcome"  ~ "Exposure but no outcome",
             
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     (outcome_phase_low_weight != "Not answered" &
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     outcome_phase_low_weight == "Not experienced" ~ "Neither exposure nor outcome"
  
      )
)
                   
# Check            
dat %>%
  freq(positive_covid_test_before_LW)  # No NAs

# Create final variable of positive COVID test before LW outcome
dat <- dat %>%
  mutate(positive_covid_test_before_LW_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered whether they'd experienced the exposure
             # Taken a test but not indicated result of test
             # Need to drop people who never answered whether they'd experienced the outcome
             positive_covid_test_before_LW == "To drop" ~ NA_character_,  
                     
                     positive_covid_test_before_LW ==  "Outcome but no exposure" |
                     positive_covid_test_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     
                       positive_covid_test_before_LW == "Exposure but no outcome" |
                    positive_covid_test_before_LW == "Positive test before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_LW) 

# Check NAs
missing <- dat %>%
  filter(is.na(positive_covid_test_before_LW_final) 
           )

# These people should all have experienced outcome before exposure, or missing test result etc    
missing %>%
  filter(exposure_phase_positive_covid_test != "Not experienced" &
          outcome_phase_low_weight != "Not answered") %>%
  select(exposure_phase_positive_covid_test,
         outcome_phase_low_weight
         )
```

Harmful ideation
```{r Positve COVID test result exposure BEFORE outcome HI - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_HI_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_harmful_ideation == "Baseline" ~ "To drop", # Co-occurring
                        
                     # These people will have experienced a positive COVID test before their first experience of HI
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (
                         outcome_phase_harmful_ideation == "1a" | 
                         outcome_phase_harmful_ideation == "1b" |
                          outcome_phase_harmful_ideation == "2a" | 
                        outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b" |
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_HI_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a") ~ "To drop",  # Co-occurring exposure & outcome
                      
                     # These people will have experienced a positive COVID test before their first experience of HI
                        exposure_phase_positive_covid_test == "1a" & 
                       (outcome_phase_harmful_ideation == "1b" | 
                          outcome_phase_harmful_ideation == "2a" | 
                        outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_HI_1b =
           case_when(exposure_phase_positive_covid_test == "1b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "1a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (
                       outcome_phase_harmful_ideation == "2a" | 
                          outcome_phase_harmful_ideation == "2b" | 
                         outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b"  ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_HI_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                        outcome_phase_harmful_ideation == "2a" |  # Co-occurring symptom & exposure
                       outcome_phase_harmful_ideation == "1b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (
                         outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" | 
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_HI_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                        outcome_phase_harmful_ideation == "2a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" | 
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_HI_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                        outcome_phase_harmful_ideation == "3a" |  # Co-occurring exposure and outcome
                     outcome_phase_harmful_ideation == "2b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (
                      outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                     outcome_phase_harmful_ideation == "6b" | 
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_HI_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of  harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" | 
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_HI_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "4a" |  # Co-occurring exposure and outcome
                     outcome_phase_harmful_ideation == "3b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (
                        outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" | 
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_HI_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (
                     outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_HI_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "5a" |  # Co-occurring exposure & outcome
                     outcome_phase_harmful_ideation == "4b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (
                      outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_HI_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_harmful_ideation == "5a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_HI_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "7a" | # Co-occurring exposure & outcome
                     outcome_phase_harmful_ideation == "6b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (
                      outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_HI_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_harmful_ideation == "7a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_HI_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "9a" | # Co-occuring exposure & outcome
                     outcome_phase_harmful_ideation == "8b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (
                      outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_HI_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" | 
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" | 
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" | 
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" | 
                      outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "10b" | # Co-occuring symptom and exposure
                        outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    (
                       outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_HI_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                        outcome_phase_harmful_ideation == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_harmful_ideation == "10b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (
                      outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_HI_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "12b" | # Co-occurring symptom and exposure
                        outcome_phase_harmful_ideation == "11a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_HI_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "13a" | # Co-occurring symptom and exposure
                        outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    ( 
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_13a)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_HI_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "12b" |
                         outcome_phase_harmful_ideation == "14b" |  # Co-occurring symptom and exposure
                        outcome_phase_harmful_ideation == "13a" )  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    (
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_14b)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_HI_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "12b" |
                        outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "15a" |  # Co-occurring symptom and exposure
                        outcome_phase_harmful_ideation == "14b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                     outcome_phase_harmful_ideation == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_HI_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "12b" |
                        outcome_phase_harmful_ideation == "13a" |
                        outcome_phase_harmful_ideation == "14b" |
                        outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" )  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_16b)
``` 


Harmful ideation & Positive COVID test result
```{r Positve COVID test result exposure HI - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_HI =
           case_when(# First positive test NOT before first experience of harm ideation
                positive_covid_test_HI_baseline == "To drop" |
                            positive_covid_test_HI_1a == "To drop" |
                    positive_covid_test_HI_1b == "To drop" |
               positive_covid_test_HI_2a == "To drop" |
                    positive_covid_test_HI_2b == "To drop" |
               positive_covid_test_HI_3a == "To drop" |
                    positive_covid_test_HI_3b == "To drop" |
               positive_covid_test_HI_4a == "To drop" |
                    positive_covid_test_HI_4b == "To drop" |
               positive_covid_test_HI_5a == "To drop" |
                    positive_covid_test_HI_6b == "To drop" |
               positive_covid_test_HI_7a == "To drop" |
                    positive_covid_test_HI_8b == "To drop" |
               positive_covid_test_HI_9a == "To drop" |
                    positive_covid_test_HI_10b == "To drop" |
              positive_covid_test_HI_11a == "To drop" |
                    positive_covid_test_HI_12b == "To drop" |
                 positive_covid_test_HI_13a == "To drop" |
                    positive_covid_test_HI_14b == "To drop" |
                 positive_covid_test_HI_15a == "To drop" |
                    positive_covid_test_HI_16b == "To drop" |  # Positive test after harmful ideation 
                     
                     # Not answered whether they'd experienced harmful ideation
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "To drop", # Missing whether experienced harmful ideation
              
                    # First positive test BEFORE first experience of passsive suicidal ideation
             positive_covid_test_HI_baseline == "Yes" |
                    positive_covid_test_HI_1a == "Yes" |
             positive_covid_test_HI_1b == "Yes" |
               positive_covid_test_HI_2a == "Yes" |
              positive_covid_test_HI_2b == "Yes" |
               positive_covid_test_HI_3a== "Yes" |
                    positive_covid_test_HI_3b == "Yes" |
               positive_covid_test_HI_4a == "Yes" |
                    positive_covid_test_HI_4b == "Yes" |
               positive_covid_test_HI_5a == "Yes" |
                    positive_covid_test_HI_6b == "Yes" |
               positive_covid_test_HI_7a == "Yes" |
                    positive_covid_test_HI_8b == "Yes" |
               positive_covid_test_HI_9a == "Yes" |
                    positive_covid_test_HI_10b== "Yes" |
               positive_covid_test_HI_11a == "Yes" |
                    positive_covid_test_HI_12b == "Yes"|
               positive_covid_test_HI_13a == "Yes" |
                    positive_covid_test_HI_14b == "Yes"|
               positive_covid_test_HI_15a == "Yes" |
                    positive_covid_test_HI_16b == "Yes" ~ "Positive test before harmful ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_HI_baseline == "No outcome" |
             positive_covid_test_HI_1a == "No outcome" |
                    positive_covid_test_HI_1b == "No outcome" |
               positive_covid_test_HI_2a == "No outcome" |
                    positive_covid_test_HI_2b == "No outcome" |
               positive_covid_test_HI_3a == "No outcome" |
                    positive_covid_test_HI_3b == "No outcome" |
               positive_covid_test_HI_4a == "No outcome" |
                    positive_covid_test_HI_4b == "No outcome" |
               positive_covid_test_HI_5a == "No outcome" |
                    positive_covid_test_HI_6b == "No outcome" |
               positive_covid_test_HI_7a == "No outcome" |
                    positive_covid_test_HI_8b == "No outcome" |
               positive_covid_test_HI_9a == "No outcome" |
                    positive_covid_test_HI_10b == "No outcome" |
               positive_covid_test_HI_11a == "No outcome" |
                    positive_covid_test_HI_12b == "No outcome" |
               positive_covid_test_HI_13a == "No outcome" |
                    positive_covid_test_HI_14b == "No outcome" |
               positive_covid_test_HI_15a == "No outcome" |
                    positive_covid_test_HI_16b == "No outcome" ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" &
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     outcome_phase_harmful_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_HI) # No NAs

# Create final variable of positive COVID test before HI outcome
dat <- dat %>%
  mutate(positive_covid_test_before_HI_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered whether they'd taken a COVID test
             # Taken a test but not indicated result of test
             # Need to drop people who never answered whether they'd experienced harmful ideation
             positive_covid_test_before_HI == "To drop" ~ NA_character_,  
                     
                     positive_covid_test_before_HI ==  "Outcome but no exposure" |
                    positive_covid_test_before_HI ==  "Neither exposure nor outcome" ~ "No",
                     
                     positive_covid_test_before_HI == "Exposure but no outcome" |
                    positive_covid_test_before_HI == "Positive test before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_HI_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(positive_covid_test_before_HI_final) 
           )

# These people should all have experienced outcome before exposure, or missing test result etc    
missing %>%
  filter(exposure_phase_positive_covid_test != "Not experienced" &
          outcome_phase_harmful_ideation != "Not answered or PNTA") %>%
  select(exposure_phase_positive_covid_test,
         outcome_phase_harmful_ideation
         )
```
                 
Self-harm
```{r Positve COVID test result exposure BEFORE outcome SH - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_SH_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                     outcome_phase_selfharm == "Baseline" ~ "To drop", # Co-occurring exposure & outcome 
                       
                     
                     # These people will have experienced a positive COVID test before their first experience of SH
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (
                         outcome_phase_selfharm == "1a" | 
                         outcome_phase_selfharm == "1b" |
                          outcome_phase_selfharm == "2a" | 
                        outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_SH_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a  
                    ( outcome_phase_selfharm == "1a" |  # Co-occurring exposure & outcome
                        outcome_phase_selfharm == "Baseline") ~ "To drop",
                      
                     # These people will have experienced a positive COVID test before their first experience of SH
                        exposure_phase_positive_covid_test == "1a" & 
                       (outcome_phase_selfharm == "1b" | 
                          outcome_phase_selfharm == "2a" | 
                        outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_SH_1b =
           case_when(exposure_phase_positive_covid_test == "1b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "1a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (
                       outcome_phase_selfharm == "2a" | 
                          outcome_phase_selfharm == "2b" | 
                         outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_SH_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_SH_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                        outcome_phase_selfharm == "2a" |  # Co-occurring symptom & exposure
                       outcome_phase_selfharm == "1b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (
                         outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" | 
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_SH_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                        outcome_phase_selfharm == "2a")  ~ "To drop", # First experience of self-harm  occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" | 
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_SH_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                        outcome_phase_selfharm == "3a" |  # Co-occurring exposure and outcome
                     outcome_phase_selfharm == "2b")  ~ "To drop", # First experience of self-harm  occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (
                      outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                     outcome_phase_selfharm == "6b" | 
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_SH_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_SH_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" | 
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_SH_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "4a" |  # Co-occurring exposure and outcome
                     outcome_phase_selfharm == "3b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (
                        outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" | 
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_SH_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (
                     outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_SH_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "5a" |  # Co-occurring exposure & outcome
                     outcome_phase_selfharm == "4b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (
                      outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_SH_6b2 =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_selfharm == "5a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_6b2)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_SH_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "7a" | # Co-occurring exposure & outcome
                     outcome_phase_selfharm == "6b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (
                      outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_SH_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_selfharm == "7a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_SH_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "9a" | # Co-occuring exposure & outcome
                     outcome_phase_selfharm == "8b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (
                      outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_SH_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" | 
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" | 
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" | 
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" | 
                      outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "10b" | # Co-occuring symptom and exposure
                        outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    (
                       outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_SH_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                        outcome_phase_selfharm == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_selfharm == "10b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (
                      outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_SH_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "12b" | # Co-occurring
                        outcome_phase_selfharm == "11a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_SH_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                        outcome_phase_selfharm == "13a" | # Co-occurring symptom and exposure
                        outcome_phase_selfharm == "12b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    (
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_13a)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_SH_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                        outcome_phase_selfharm == "12b" |
                        outcome_phase_selfharm == "14b" |   # Co-occurring symptom and exposure
                        outcome_phase_selfharm == "13a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    ( 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_14b)


# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_SH_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                        outcome_phase_selfharm == "12b" |
                        outcome_phase_selfharm == "13a" |
                        outcome_phase_selfharm == "15a" | # Co-occurring symptom and exposure
                        outcome_phase_selfharm == "14b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                   outcome_phase_selfharm == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_SH_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                        outcome_phase_selfharm == "12b" |
                        outcome_phase_selfharm == "13a" |
                        outcome_phase_selfharm == "14b" |
                        outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" )  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome" # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_16b)
```

Self-harm & Positive COVID test result
```{r Positve COVID test result exposure SH - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_SH =
           case_when(
             # First positive test NOT before first experience of self-harm 
                positive_covid_test_SH_baseline == "To drop" |
                            positive_covid_test_SH_1a == "To drop" |
                    positive_covid_test_SH_1b == "To drop" |
               positive_covid_test_SH_2a == "To drop" |
                    positive_covid_test_SH_2b == "To drop" |
               positive_covid_test_SH_3a == "To drop" |
                    positive_covid_test_SH_3b == "To drop" |
               positive_covid_test_SH_4a == "To drop" |
                    positive_covid_test_SH_4b == "To drop" |
               positive_covid_test_SH_5a == "To drop" |
                    positive_covid_test_SH_6b2 == "To drop" |
               positive_covid_test_SH_7a == "To drop" |
                    positive_covid_test_SH_8b == "To drop" |
               positive_covid_test_SH_9a == "To drop" |
                    positive_covid_test_SH_10b == "To drop" |
              positive_covid_test_SH_11a == "To drop" |
                    positive_covid_test_SH_12b == "To drop" |
                positive_covid_test_SH_13a == "To drop" |
               positive_covid_test_SH_14b == "To drop" |
                    positive_covid_test_SH_15a == "To drop" |
              positive_covid_test_SH_16b == "To drop" | # Positive test after self-harm
                    
                    
                     # Not answered whether they'd experienced self-harm
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "To drop", # Missing whether experienced self-harm
                    
                    # First positive test BEFORE first experience of self-harm
             positive_covid_test_SH_baseline == "Yes" |
                    positive_covid_test_SH_1a == "Yes" |
             positive_covid_test_SH_1b == "Yes" |
               positive_covid_test_SH_2a == "Yes" |
              positive_covid_test_SH_2b == "Yes" |
               positive_covid_test_SH_3a== "Yes" |
                    positive_covid_test_SH_3b == "Yes" |
               positive_covid_test_SH_4a == "Yes" |
                    positive_covid_test_SH_4b == "Yes" |
               positive_covid_test_SH_5a == "Yes" |
                    positive_covid_test_SH_6b2 == "Yes" |
               positive_covid_test_SH_7a == "Yes" |
                    positive_covid_test_SH_8b == "Yes" |
               positive_covid_test_SH_9a == "Yes" |
                    positive_covid_test_SH_10b== "Yes" |
               positive_covid_test_SH_11a == "Yes" |
                    positive_covid_test_SH_12b == "Yes" |
                positive_covid_test_SH_13a == "Yes" |
               positive_covid_test_SH_14b == "Yes" |
                    positive_covid_test_SH_15a== "Yes" |
               positive_covid_test_SH_16b == "Yes" ~ "Positive test before self-harm",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_SH_baseline == "No outcome" |
             positive_covid_test_SH_1a == "No outcome" |
                    positive_covid_test_SH_1b == "No outcome" |
               positive_covid_test_SH_2a == "No outcome" |
                    positive_covid_test_SH_2b == "No outcome" |
               positive_covid_test_SH_3a == "No outcome" |
                    positive_covid_test_SH_3b == "No outcome" |
               positive_covid_test_SH_4a == "No outcome" |
                    positive_covid_test_SH_4b == "No outcome" |
               positive_covid_test_SH_5a == "No outcome" |
                    positive_covid_test_SH_6b2 == "No outcome" |
               positive_covid_test_SH_7a == "No outcome" |
                    positive_covid_test_SH_8b == "No outcome" |
               positive_covid_test_SH_9a == "No outcome" |
                    positive_covid_test_SH_10b == "No outcome" |
               positive_covid_test_SH_11a == "No outcome" |
                    positive_covid_test_SH_12b == "No outcome" |
               positive_covid_test_SH_13a == "No outcome" |
               positive_covid_test_SH_14b == "No outcome" |
                    positive_covid_test_SH_15a == "No outcome" |
               positive_covid_test_SH_16b == "No outcome" ~ "Exposure but no outcome",
                   
                   # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     (outcome_phase_selfharm != "Not answered or PNTA" &
                        outcome_phase_selfharm != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not experienced" &
                     outcome_phase_selfharm == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_SH) 

# Create final variable of positive COVID test before SH outcome
dat <- dat %>%
  mutate(positive_covid_test_before_SH_final =
           case_when(# Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered whether they'd taken a COVID test
             # Taken a test but not indicated result of test
             # Need to drop people who never answered whether they'd experienced self-harm 
                     
                     positive_covid_test_before_SH == "To drop" ~ NA_character_,  
               
                    positive_covid_test_before_SH ==  "Outcome but no exposure" |
                     positive_covid_test_before_SH ==  "Neither exposure nor outcome" ~ "No",
                     
                    positive_covid_test_before_SH == "Exposure but no outcome" |
                    positive_covid_test_before_SH == "Positive test before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_SH_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(positive_covid_test_before_SH_final) 
           )

# These people should all have experienced outcome before exposure, or missing test result etc    
missing %>%
  filter(exposure_phase_positive_covid_test != "Not experienced" &
          outcome_phase_selfharm != "Not answered or PNTA") %>%
  select(exposure_phase_positive_covid_test,
         outcome_phase_selfharm
         )
```

## Losing someone due to COVID-19 (grief)
There are two questions in COPING that capture whether someone has lost someone due to COVID, in the 'grief' questionnaire in follow up B only and baseline ("In the past month, have you lost someone close to you due to COVID-19?") and the demographics questionnaire ("Has a relative that was previously ill with coronavirus or suspected coronavirus passed away?") in follow up A and B [not at baseline]
```{r Lost someone exposure BEFORE outcome BE}
# Baseline
dat <- dat %>%
  mutate(lost_someone_BE_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "Baseline" &
                     outcome_phase_binge_eating == "Baseline" ~ "To drop",
                     
                      # These people will have experienced losing someone before their first experience of BE
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (
                         outcome_phase_binge_eating == "1b" | 
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_BE_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_binge_eating == "Baseline" ~ "To drop", 
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (outcome_phase_binge_eating == "1b" |
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_BE_1a)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_BE_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_binge_eating == "Baseline" |
                        outcome_phase_binge_eating == "1b" ) ~ "To drop", 
                        
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_BE_1b)

# Phase 2a
dat <- dat %>%
  mutate(lost_someone_BE_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     ( outcome_phase_binge_eating == "Baseline"|
                         outcome_phase_binge_eating == "1b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       (outcome_phase_binge_eating == "2b" | 
                         outcome_phase_binge_eating == "3b" |
                         outcome_phase_binge_eating == "4b" | 
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_BE_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_binge_eating == "Baseline"|
                        outcome_phase_binge_eating == "1b" |
                        outcome_phase_binge_eating == "2b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (
                         outcome_phase_binge_eating == "3b" |
                         outcome_phase_binge_eating == "4b" | 
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_BE_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                      (outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                        outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_3a)


# Phase 3b
dat <- dat %>%
  mutate(lost_someone_BE_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                        outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_BE_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" | 
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    (outcome_phase_binge_eating == "4b" | 
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_BE_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" | 
                       outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_BE_5a =
           case_when(exposure_phase_losing_someone == "5a" &  # First indicated losing someone at phase 5a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" | 
                       outcome_phase_binge_eating == "4b" | 
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    (outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_BE_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" | 
                       outcome_phase_binge_eating == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_6b)

# Phase 7a
dat <- dat %>%
  mutate(lost_someone_BE_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" | 
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    (  outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_7a)


# Phase 8b
dat <- dat %>%
  mutate(lost_someone_BE_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" | 
                       outcome_phase_binge_eating == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_BE_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    (outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_9a)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_BE_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_BE_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" | 
                       outcome_phase_binge_eating == "Baseline" )  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    (outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_11a)


# Phase 12b
dat <- dat %>%
  mutate(lost_someone_BE_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" | 
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    (  outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_BE_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" | 
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    ( outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_13a)


# Phase 14b
dat <- dat %>%
  mutate(lost_someone_BE_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" | 
                       outcome_phase_binge_eating == "14b" | # Co-occurring symptom and exposure
                       outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     outcome_phase_binge_eating == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_BE_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" | 
                       outcome_phase_binge_eating == "Baseline" )  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                      outcome_phase_binge_eating == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_15a)


# Phase 16b
dat <- dat %>%
  mutate(lost_someone_BE_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" | 
                       outcome_phase_binge_eating == "16b" |
                       outcome_phase_binge_eating == "Baseline")   ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                           
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_16b)
```

Binge eating & losing someone
```{r Losing someone exposure BE}
dat <- dat %>%
  mutate(losing_someone_before_BE =
           case_when(# First lost someone NOT before first experience of binge eating
                    lost_someone_BE_baseline == "To drop" |
                       lost_someone_BE_1a == "To drop" |
                    lost_someone_BE_1b == "To drop" |
                       lost_someone_BE_2a == "To drop" |
                    lost_someone_BE_2b == "To drop" |
                       lost_someone_BE_3a == "To drop" |
                    lost_someone_BE_3b == "To drop" |
                       lost_someone_BE_4a == "To drop" |
                    lost_someone_BE_4b == "To drop" |
                       lost_someone_BE_5a == "To drop" |
                    lost_someone_BE_6b == "To drop" |
                       lost_someone_BE_7a == "To drop" |
                    lost_someone_BE_8b == "To drop" |
                       lost_someone_BE_9a == "To drop" |
                    lost_someone_BE_10b == "To drop" |
                       lost_someone_BE_11a == "To drop" |
                    lost_someone_BE_12b == "To drop" |
                       lost_someone_BE_13a == "To drop" |
                     lost_someone_BE_14b == "To drop" |
                       lost_someone_BE_15a == "To drop" |
                    lost_someone_BE_16b == "To drop"  | # Lost someone after binge eating
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" | # missing whether lost someone
                    
                    # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "To drop" , # Missing whether experienced binge eating
                    
                  # First lost someone BEFORE first experience of binge eating
                   lost_someone_BE_baseline == "Yes" |
                       lost_someone_BE_1a == "Yes" |
                    lost_someone_BE_1b == "Yes" |
                       lost_someone_BE_2a == "Yes" |
                    lost_someone_BE_2b == "Yes" |
                       lost_someone_BE_3a == "Yes" |
                    lost_someone_BE_3b == "Yes" |
                       lost_someone_BE_4a == "Yes" |
                    lost_someone_BE_4b == "Yes" |
                       lost_someone_BE_5a == "Yes" |
                    lost_someone_BE_6b == "Yes" |
                       lost_someone_BE_7a == "Yes" |
                    lost_someone_BE_8b == "Yes" |
                       lost_someone_BE_9a == "Yes" |
                    lost_someone_BE_10b == "Yes" |
                       lost_someone_BE_11a == "Yes" |
                    lost_someone_BE_12b == "Yes" |
                       lost_someone_BE_13a == "Yes" |
                     lost_someone_BE_14b == "Yes" |
                       lost_someone_BE_15a == "Yes" |
                    lost_someone_BE_16b == "Yes" ~ "Lost someone before binge eating",
                    
                   # Experienced exposure but not outcome
                      lost_someone_BE_baseline == "No outcome" |
                       lost_someone_BE_1a == "No outcome" |
                    lost_someone_BE_1b == "No outcome" |
                       lost_someone_BE_2a == "No outcome" |
                    lost_someone_BE_2b == "No outcome" |
                       lost_someone_BE_3a == "No outcome" |
                    lost_someone_BE_3b == "No outcome" |
                       lost_someone_BE_4a == "No outcome" |
                    lost_someone_BE_4b == "No outcome" |
                       lost_someone_BE_5a == "No outcome" |
                    lost_someone_BE_6b == "No outcome" |
                       lost_someone_BE_7a == "No outcome" |
                    lost_someone_BE_8b == "No outcome" |
                       lost_someone_BE_9a == "No outcome" |
                    lost_someone_BE_10b == "No outcome" |
                       lost_someone_BE_11a == "No outcome" |
                    lost_someone_BE_12b == "No outcome" |
                       lost_someone_BE_13a == "No outcome" |
                     lost_someone_BE_14b == "No outcome" |
                       lost_someone_BE_15a == "No outcome" |
                    lost_someone_BE_16b == "No outcome"  ~ "Exposure but no outcome",
                   
                   # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_binge_eating != "Not answered" &
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_binge_eating == "Not experienced" ~ "Neither exposure nor outcome"
                  
            
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_BE) 


# Create final variable of lost someone before BE outcome
dat <- dat %>%
  mutate(lost_someone_before_BE_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd lost someone
             # Need to drop people who never answered whether they'd experienced binge eating
             
             losing_someone_before_BE == "To drop" ~ NA_character_,  
                     
                       losing_someone_before_BE ==  "Outcome but no exposure" |
                      losing_someone_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_BE == "Exposure but no outcome" |
                    losing_someone_before_BE == "Lost someone before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_BE_final) 


# Check NAs
missing <- dat %>%
  filter(is.na(lost_someone_before_BE_final) 
           )

# These people should all have experienced outcome before exposure
missing %>%
  filter(exposure_phase_losing_someone != "Not answered or PNTA" &
          outcome_phase_binge_eating != "Not answered") %>%
  select(exposure_phase_losing_someone,
         outcome_phase_binge_eating
         )
```

Low weight 
```{r Lost someone exposure BEFORE outcome LW}
# Baseline
dat <- dat %>%
  mutate(lost_someone_LW_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_low_weight == "Baseline" ~ "To drop", # Co-occurring
                     
                    # These people will have experienced losing someone before their first experience of LW
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (  outcome_phase_low_weight == "Baseline" | # Co-occurring
                         outcome_phase_low_weight == "1b" | 
                         outcome_phase_low_weight == "2b" |
                          outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                         outcome_phase_low_weight == "6b" |
                          outcome_phase_low_weight == "8b" |
                         outcome_phase_low_weight == "10b" |
                          outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_LW_1a =
           case_when(exposure_phase_losing_someone == "1a" &
                   outcome_phase_low_weight == "Baseline" ~ "To drop",
                     
                    exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (outcome_phase_low_weight == "1b" | 
                         outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_LW_1a)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_LW_1b =
           case_when( exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                    (outcome_phase_low_weight == "Baseline" |
                       outcome_phase_low_weight == "1b") ~ "To  drop", 
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (
                         outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_LW_1b)


# Phase 2a
dat <- dat %>%
  mutate(lost_someone_LW_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       ( outcome_phase_low_weight == "2b" |
                         outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                         outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_2a)


# Phase 2b
dat <- dat %>%
  mutate(lost_someone_LW_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "Baseline" |
                        outcome_phase_low_weight == "2b") ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                         outcome_phase_low_weight == "6b" |
                         outcome_phase_low_weight == "8b" |
                         outcome_phase_low_weight == "10b" |
                         outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_LW_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                      ( outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                         outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_3a)


# Phase 3b
dat <- dat %>%
  mutate(lost_someone_LW_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     ( outcome_phase_low_weight == "1b" | 
                         outcome_phase_low_weight == "2b"| 
                        outcome_phase_low_weight == "Baseline" |
                         outcome_phase_low_weight == "3b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      ( outcome_phase_low_weight == "4b" |
                         outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_LW_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_low_weight == "1b" | 
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    (  outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_LW_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "Baseline" |
                         outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_LW_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b"| 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    (  outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_LW_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "Baseline" |
                         outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    ( outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(lost_someone_LW_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" | 
                        outcome_phase_low_weight == "Baseline" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_LW_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" | 
                        outcome_phase_low_weight == "Baseline" |
                         outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    ( outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_LW_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_low_weight == "1b" | 
                       outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"| 
                        outcome_phase_low_weight == "Baseline" |
                        outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    ( outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_LW_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_low_weight == "1b" | 
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "Baseline" |
                        outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    ( outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"  ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_LW_11a = 
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_low_weight == "1b" | 
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b"| 
                        outcome_phase_low_weight == "Baseline" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    ( outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"  ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_LW_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_low_weight == "1b" | 
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "Baseline" |
                        outcome_phase_low_weight == "12b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    ( outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" 
                         ) ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_LW_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_low_weight == "1b" | 
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    ( outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"  ) ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_12b)


# Phase 14b
dat <- dat %>%
  mutate(lost_someone_LW_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "Baseline" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                      outcome_phase_low_weight == "16b"  ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_LW_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                      outcome_phase_low_weight == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_15a)


# Phase 16b
dat <- dat %>%
  mutate(lost_someone_LW_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                          outcome_phase_low_weight == "16b"  |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_16b)

```

Low weight & losing someone
```{r Losing someone exposure LW}
dat <- dat %>%
  mutate(losing_someone_before_LW =
           case_when(# First lost someone NOT before first experience of low weight
                    lost_someone_LW_baseline == "To drop" |
                      lost_someone_LW_1a == "To drop" |
                    lost_someone_LW_1b == "To drop" |
                      lost_someone_LW_2a == "To drop" |
                    lost_someone_LW_2b == "To drop" |
                      lost_someone_LW_3a == "To drop" |
                    lost_someone_LW_3b == "To drop" |
                      lost_someone_LW_4a == "To drop" |
                    lost_someone_LW_4b == "To drop" |
                      lost_someone_LW_5a == "To drop" |
                    lost_someone_LW_6b == "To drop" |
                      lost_someone_LW_7a == "To drop" |
                    lost_someone_LW_8b == "To drop" |
                      lost_someone_LW_9a == "To drop" |
                    lost_someone_LW_10b == "To drop" |
                      lost_someone_LW_11a == "To drop" |
                    lost_someone_LW_12b == "To drop"  |
                      lost_someone_LW_13a == "To drop" |
                      lost_someone_LW_14b == "To drop" |
                      lost_someone_LW_15a == "To drop" |
                    lost_someone_LW_16b == "To drop"  |  # Lost someone after low weight 
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" |  # Missing whether lost someone
                    
                    # Not answered whether they'd experienced low weight
                    outcome_phase_low_weight == "Not answered" ~ "To drop", # Missing whether experienced low weight
                    
                  # First lost someone BEFORE first experience of low weight
                     lost_someone_LW_baseline == "Yes" |
                      lost_someone_LW_1a == "Yes" |
                    lost_someone_LW_1b == "Yes" |
                      lost_someone_LW_2a == "Yes" |
                    lost_someone_LW_2b == "Yes" |
                      lost_someone_LW_3a == "Yes" |
                    lost_someone_LW_3b == "Yes" |
                      lost_someone_LW_4a == "Yes" |
                    lost_someone_LW_4b == "Yes" |
                      lost_someone_LW_5a == "Yes" |
                    lost_someone_LW_6b == "Yes" |
                      lost_someone_LW_7a == "Yes" |
                    lost_someone_LW_8b == "Yes" |
                      lost_someone_LW_9a == "Yes" |
                    lost_someone_LW_10b == "Yes" |
                      lost_someone_LW_11a == "Yes" |
                    lost_someone_LW_12b == "Yes"  |
                      lost_someone_LW_13a == "Yes" |
                      lost_someone_LW_14b == "Yes" |
                      lost_someone_LW_15a == "Yes" |
                    lost_someone_LW_16b == "Yes"  ~ "Lost someone before low weight",
                    
                   # Experienced exposure but not outcome
                    lost_someone_LW_baseline == "No outcome" |
                      lost_someone_LW_1a == "No outcome" |
                    lost_someone_LW_1b == "No outcome" |
                      lost_someone_LW_2a == "No outcome" |
                    lost_someone_LW_2b == "No outcome" |
                      lost_someone_LW_3a == "No outcome" |
                    lost_someone_LW_3b == "No outcome" |
                      lost_someone_LW_4a == "No outcome" |
                    lost_someone_LW_4b == "No outcome" |
                      lost_someone_LW_5a == "No outcome" |
                    lost_someone_LW_6b == "No outcome" |
                      lost_someone_LW_7a == "No outcome" |
                    lost_someone_LW_8b == "No outcome" |
                      lost_someone_LW_9a == "No outcome" |
                    lost_someone_LW_10b == "No outcome" |
                      lost_someone_LW_11a == "No outcome" |
                    lost_someone_LW_12b == "No outcome"  |
                      lost_someone_LW_13a == "No outcome" |
                      lost_someone_LW_14b == "No outcome" |
                      lost_someone_LW_15a == "No outcome" |
                    lost_someone_LW_16b == "No outcome"  ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_low_weight != "Not answered" &
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_low_weight == "Not experienced" ~ "Neither exposure nor outcome"
                  )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_LW) 

# Create final variable of lost someone before LW outcome
dat <- dat %>%
  mutate(lost_someone_before_LW_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd lost someone
             # Need to drop people who never answered whether they'd experienced low weight
            
              losing_someone_before_LW == "To drop" ~ NA_character_,  
                     
                      losing_someone_before_LW ==  "Outcome but no exposure" |
                    losing_someone_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     losing_someone_before_LW == "Exposure but no outcome" |
                    losing_someone_before_LW == "Lost someone before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_LW_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(lost_someone_before_LW_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_losing_someone != "Not answered or PNTA" &
          outcome_phase_low_weight != "Not answered") %>%
  select(exposure_phase_losing_someone,
         outcome_phase_low_weight
         )

```

Harmful ideation
```{r Lost someone exposure BEFORE outcome HI}
# Baseline
dat <- dat %>%
  mutate(lost_someone_HI_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                     outcome_phase_harmful_ideation == "Baseline" ~ "To drop", # Co-occurring
                        
                     # These people will have experienced losing someone before their first experience of HI
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (  # Co-occurring exposure & outcome
                         outcome_phase_harmful_ideation == "1a" | 
                          outcome_phase_harmful_ideation == "1b" | 
                          outcome_phase_harmful_ideation == "2a" | 
                        outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b" |
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_HI_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a") # Co-occurring outcome and exposure
                         ~ "To drop",
                     
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (
                         outcome_phase_harmful_ideation == "1b" | 
                        outcome_phase_harmful_ideation == "2a" | 
                          outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_HI_1a)


# Phase 1b
dat <- dat %>%
  mutate(lost_someone_HI_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_harmful_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "1b"  # Co-occurring outcome and exposure
                      ) ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (
                        outcome_phase_harmful_ideation == "2a" | 
                          outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(lost_someone_HI_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "2a" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "1b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       (
                         outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" |
                         outcome_phase_harmful_ideation == "3b" |
                           outcome_phase_harmful_ideation == "4a" |
                         outcome_phase_harmful_ideation == "4b" | 
                           outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_HI_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                        outcome_phase_harmful_ideation == "2a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_harmful_ideation == "3a" |
                         outcome_phase_harmful_ideation == "3b" |
                           outcome_phase_harmful_ideation == "4a" |
                         outcome_phase_harmful_ideation == "4b" | 
                           outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_HI_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                        outcome_phase_harmful_ideation == "3a" |  # Co-occurring outcome and exposure
                     outcome_phase_harmful_ideation == "2b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                       (
                        outcome_phase_harmful_ideation == "3b" | 
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                        outcome_phase_harmful_ideation == "8b" | 
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_HI_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                        outcome_phase_harmful_ideation == "8b" | 
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_HI_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "4a" | # Co-occurring outcome and exposure
                     outcome_phase_harmful_ideation == "3b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    (
                      outcome_phase_harmful_ideation == "4b" | 
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_HI_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_HI_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                        outcome_phase_harmful_ideation == "5a" |  # Co-occurring symptom and exposure
                      outcome_phase_harmful_ideation == "4b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    (
                      outcome_phase_harmful_ideation == "6b" | 
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_HI_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "5a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_6b)


# Phase 7a
dat <- dat %>%
  mutate(lost_someone_HI_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "7a" |  # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "6b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    (
                      outcome_phase_harmful_ideation == "8b" |  
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_HI_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "7a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_HI_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "9a" |  # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "8b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    (
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_9a)


# Phase 10b
dat <- dat %>%
  mutate(lost_someone_HI_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_HI_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "11a" | # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "10b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    (
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_HI_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "12b"| # Co-occurring
                       outcome_phase_harmful_ideation == "11a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   (   outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                         outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_HI_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "13a" | # Co-occurring
                       outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                   ( 
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_13a)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_HI_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "14b" |  # Co-occurring symptom and exposure
                          outcome_phase_harmful_ideation == "13a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   (   outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" )  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_HI_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "15a" | # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "14b"  )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                   outcome_phase_harmful_ideation == "16b"  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_15a)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_HI_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b" |  
                       outcome_phase_harmful_ideation == "15a" |
                       outcome_phase_harmful_ideation == "16b" 
                         )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                                     
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_16b)
```

Harmful ideation & losing someone
```{r Losing someone exposure HI}
dat <- dat %>%
  mutate(losing_someone_before_HI =
           case_when(# First lost someone NOT before first experience of harmful ideation
                    lost_someone_HI_baseline == "To drop" |
                       lost_someone_HI_1a == "To drop" |
                    lost_someone_HI_1b == "To drop" |
                       lost_someone_HI_2a == "To drop" |
                    lost_someone_HI_2b == "To drop" |
                       lost_someone_HI_3a == "To drop" |
                    lost_someone_HI_3b == "To drop" |
                       lost_someone_HI_4a == "To drop" |
                    lost_someone_HI_4b == "To drop" |
                       lost_someone_HI_5a == "To drop" |
                    lost_someone_HI_6b == "To drop" |
                       lost_someone_HI_7a == "To drop" |
                    lost_someone_HI_8b == "To drop" |
                       lost_someone_HI_9a == "To drop" |
                    lost_someone_HI_10b == "To drop" |
                       lost_someone_HI_11a == "To drop" |
                    lost_someone_HI_12b == "To drop" |
                       lost_someone_HI_13a == "To drop" |
                      lost_someone_HI_14b == "To drop" |
                       lost_someone_HI_15a == "To drop" |
                    lost_someone_HI_16b == "To drop" |  # Lost someone after harmful ideation 
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" | # Missing whether lost someone
                      
                    # Not answered whether they'd experienced harmful ideation
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "To drop", # Missing whether experienced harmful ideation
                    
                  # First lost someone BEFORE first experience of harmful ideation
                    lost_someone_HI_baseline == "Yes" |
                       lost_someone_HI_1a == "Yes" |
                    lost_someone_HI_1b == "Yes" |
                       lost_someone_HI_2a == "Yes" |
                    lost_someone_HI_2b == "Yes" |
                       lost_someone_HI_3a == "Yes" |
                    lost_someone_HI_3b == "Yes" |
                       lost_someone_HI_4a == "Yes" |
                    lost_someone_HI_4b == "Yes" |
                       lost_someone_HI_5a == "Yes" |
                    lost_someone_HI_6b == "Yes" |
                       lost_someone_HI_7a == "Yes" |
                    lost_someone_HI_8b == "Yes" |
                       lost_someone_HI_9a == "Yes" |
                    lost_someone_HI_10b == "Yes" |
                       lost_someone_HI_11a == "Yes" |
                    lost_someone_HI_12b == "Yes" |
                       lost_someone_HI_13a == "Yes" |
                      lost_someone_HI_14b == "Yes" |
                       lost_someone_HI_15a == "Yes" |
                    lost_someone_HI_16b == "Yes"  ~ "Lost someone before harmful ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_HI_baseline == "No outcome" |
                       lost_someone_HI_1a == "No outcome" |
                    lost_someone_HI_1b == "No outcome" |
                       lost_someone_HI_2a == "No outcome" |
                    lost_someone_HI_2b == "No outcome" |
                       lost_someone_HI_3a == "No outcome" |
                    lost_someone_HI_3b == "No outcome" |
                       lost_someone_HI_4a == "No outcome" |
                    lost_someone_HI_4b == "No outcome" |
                       lost_someone_HI_5a == "No outcome" |
                    lost_someone_HI_6b == "No outcome" |
                       lost_someone_HI_7a == "No outcome" |
                    lost_someone_HI_8b == "No outcome" |
                       lost_someone_HI_9a == "No outcome" |
                    lost_someone_HI_10b == "No outcome" |
                       lost_someone_HI_11a == "No outcome" |
                    lost_someone_HI_12b == "No outcome" |
                       lost_someone_HI_13a == "No outcome" |
                      lost_someone_HI_14b == "No outcome" |
                       lost_someone_HI_15a == "No outcome" |
                    lost_someone_HI_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                  
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" &
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_harmful_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_HI) 

# Create final variable of lost someone before HI outcome
dat <- dat %>%
  mutate(lost_someone_before_HI_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd lost someone
             # Need to drop people who never answered whether they'd experienced harmful ideation
             
             losing_someone_before_HI == "To drop" ~ NA_character_,  
                     
                      losing_someone_before_HI ==  "Outcome but no exposure" |
                     losing_someone_before_HI ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_HI == "Exposure but no outcome" |
                    losing_someone_before_HI == "Lost someone before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_HI_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(lost_someone_before_HI_final) 
           )

# These people should all have experienced outcome before exposure    
missing %>%
  filter(exposure_phase_losing_someone != "Not answered or PNTA" &
          outcome_phase_harmful_ideation != "Not answered or PNTA") %>%
  select(exposure_phase_losing_someone,
         outcome_phase_harmful_ideation
         )
```

Self-harm 
```{r Lost someone exposure BEFORE outcome SH}
# Baseline
dat <- dat %>%
  mutate(lost_someone_SH_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                     outcome_phase_selfharm == "Baseline" ~ "To drop", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      # These people will have experienced losing someone before their first experience of SH
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_selfharm == "1a" | 
                          outcome_phase_selfharm == "1b" | 
                          outcome_phase_selfharm == "2a" | 
                        outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_SH_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_SH_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     (outcome_phase_selfharm == "1a" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "Baseline")  ~ "To drop",
                     
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       ( outcome_phase_selfharm == "1b" | 
                        outcome_phase_selfharm == "2a" | 
                          outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SH_1a)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_SH_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_selfharm == "Baseline" |  
                        outcome_phase_selfharm == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_selfharm == "2a" | 
                          outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SH_1b)


# Phase 2a
dat <- dat %>%
  mutate(lost_someone_SH_2a =
           case_when(exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     (outcome_phase_selfharm == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "2a" |   # Co-occurring outcome and exposure
                        outcome_phase_selfharm == "1b" ) ~ "To drop",
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       ( outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SH_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_SH_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "2a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                    outcome_phase_selfharm == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       ( outcome_phase_selfharm == "3a" |
                         outcome_phase_selfharm == "3b" |
                           outcome_phase_selfharm == "4a" |
                         outcome_phase_selfharm == "4b" | 
                           outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SH_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_SH_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                        outcome_phase_selfharm == "3a" | # Co-occurring outcome and exposure
                        outcome_phase_selfharm == "2b" )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                    outcome_phase_selfharm == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                       ( outcome_phase_selfharm == "3b" |
                           outcome_phase_selfharm == "4a" |
                         outcome_phase_selfharm == "4b" | 
                           outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SH_3a)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_SH_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" |
                        outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      ( outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                        outcome_phase_selfharm == "8b" | 
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SH_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_SH_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" |
                         outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" |
                         outcome_phase_selfharm == "4a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm == "3b" )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                      ( outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                        outcome_phase_selfharm == "8b" | 
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SH_4a)


# Phase 4b
dat <- dat %>%
  mutate(lost_someone_SH_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_SH_5a =
           case_when(exposure_phase_losing_someone == "5a" &  # First indicated losing someone at phase 5a
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "5a" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "4b" )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    (
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_5a)


# Phase 6b
dat <- dat %>%
  mutate(lost_someone_SH_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "5a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_6b)

# Phase 7a
dat <- dat %>%
  mutate(lost_someone_SH_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "7a" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "6b")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    ( 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_SH_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "7a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_8b)


# Phase 9a
dat <- dat %>%
  mutate(lost_someone_SH_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                        outcome_phase_selfharm == "9a" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "8b" )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    ( 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_9a)


# Phase 10b
dat <- dat %>%
  mutate(lost_someone_SH_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_SH_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                        outcome_phase_selfharm == "11a" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "10b")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    ( 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_11a)


# Phase 12b
dat <- dat %>%
  mutate(lost_someone_SH_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "11a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (
                         outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                         outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_12b)


# Phase 13a
dat <- dat %>%
  mutate(lost_someone_SH_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "13a" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "12b" )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    (  outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_13a)


# Phase 14b
dat <- dat %>%
  mutate(lost_someone_SH_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "13a" |
                     outcome_phase_selfharm == "14b" # co-occurring
                         )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    (
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_14b)


# Phase 15a
dat <- dat %>%
  mutate(lost_someone_SH_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a"  # Co-occurring symptom and exposure
                         )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                      outcome_phase_selfharm == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_15a)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_SH_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_16b)

```

Self-harm  & losing someone
```{r Losing someone exposure SH}
dat <- dat %>%
  mutate(losing_someone_before_SH =
           case_when(# First lost someone NOT before first experience of self-harm 
                    lost_someone_SH_baseline == "To drop" |
                      lost_someone_SH_1a == "To drop" |
                    lost_someone_SH_1b == "To drop" |
                      lost_someone_SH_2a == "To drop" |
                    lost_someone_SH_2b == "To drop" |
                      lost_someone_SH_3a == "To drop" |
                    lost_someone_SH_3b == "To drop" |
                      lost_someone_SH_4a == "To drop" |
                    lost_someone_SH_4b == "To drop" |
                      lost_someone_SH_5a == "To drop" |
                    lost_someone_SH_6b == "To drop" |
                      lost_someone_SH_7a == "To drop" |
                    lost_someone_SH_8b == "To drop" |
                      lost_someone_SH_9a == "To drop" |
                    lost_someone_SH_10b == "To drop" |
                      lost_someone_SH_11a == "To drop" |
                    lost_someone_SH_12b == "To drop" |
                      lost_someone_SH_13a == "To drop" |
                    lost_someone_SH_14b == "To drop" |
                      lost_someone_SH_15a == "To drop" |
                    lost_someone_SH_16b == "To drop"  | # Lost someone after self-harm
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" | # Missing whether lost someone
                      
                    # Not answered whether they'd experienced self-harm
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "To drop", # Missing whether experienced self-harm
                    
                  # First lost someone BEFORE first experience of self-harm
                   lost_someone_SH_baseline == "Yes" |
                      lost_someone_SH_1a == "Yes" |
                    lost_someone_SH_1b == "Yes" |
                      lost_someone_SH_2a == "Yes" |
                    lost_someone_SH_2b == "Yes" |
                      lost_someone_SH_3a == "Yes" |
                    lost_someone_SH_3b == "Yes" |
                      lost_someone_SH_4a == "Yes" |
                    lost_someone_SH_4b == "Yes" |
                      lost_someone_SH_5a == "Yes" |
                    lost_someone_SH_6b == "Yes" |
                      lost_someone_SH_7a == "Yes" |
                    lost_someone_SH_8b == "Yes" |
                      lost_someone_SH_9a == "Yes" |
                    lost_someone_SH_10b == "Yes" |
                      lost_someone_SH_11a == "Yes" |
                    lost_someone_SH_12b == "Yes" |
                      lost_someone_SH_13a == "Yes" |
                    lost_someone_SH_14b == "Yes" |
                      lost_someone_SH_15a == "Yes" |
                    lost_someone_SH_16b == "Yes"  ~ "Lost someone before self-harm",
                    
                   # Experienced exposure but not outcome
                    lost_someone_SH_baseline == "No outcome" |
                      lost_someone_SH_1a == "No outcome" |
                    lost_someone_SH_1b == "No outcome" |
                      lost_someone_SH_2a == "No outcome" |
                    lost_someone_SH_2b == "No outcome" |
                      lost_someone_SH_3a == "No outcome" |
                    lost_someone_SH_3b == "No outcome" |
                      lost_someone_SH_4a == "No outcome" |
                    lost_someone_SH_4b == "No outcome" |
                      lost_someone_SH_5a == "No outcome" |
                    lost_someone_SH_6b == "No outcome" |
                      lost_someone_SH_7a == "No outcome" |
                    lost_someone_SH_8b == "No outcome" |
                      lost_someone_SH_9a == "No outcome" |
                    lost_someone_SH_10b == "No outcome" |
                      lost_someone_SH_11a == "No outcome" |
                    lost_someone_SH_12b == "No outcome" |
                      lost_someone_SH_13a == "No outcome" |
                    lost_someone_SH_14b == "No outcome" |
                      lost_someone_SH_15a == "No outcome" |
                    lost_someone_SH_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                   # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_selfharm != "Not answered or PNTA" &
                        outcome_phase_selfharm != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_selfharm  == "Not experienced" ~ "Neither exposure nor outcome"
           )
  )
# Check                      
dat %>%
  freq(losing_someone_before_SH) 

# Create final variable of lost someone before SH outcome
dat <- dat %>%
  mutate(lost_someone_before_SH_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd lost someone
             # Need to drop people who never answered whether they'd experienced self-harm ideation
             
             losing_someone_before_SH == "To drop" ~ NA_character_,  
                     
                       losing_someone_before_SH ==  "Outcome but no exposure" |
                     losing_someone_before_SH ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_SH == "Exposure but no outcome" |
                    losing_someone_before_SH == "Lost someone before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_SH_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(lost_someone_before_SH_final) 
           )

# These people should all have experienced outcome before exposure  
missing %>%
  filter(exposure_phase_losing_someone != "Not answered or PNTA" &
          outcome_phase_selfharm != "Not answered or PNTA") %>%
  select(exposure_phase_losing_someone,
         outcome_phase_selfharm
         )
```

## Change in main eco activity (work/education)
```{r Change in main eco activity BEFORE outcome BE}
# Baseline
dat <- dat %>%
  mutate(main_eco_change_BE_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline 
                      outcome_phase_binge_eating == "Baseline" ~ "To drop",  # Co-occurring
                        
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_BE_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                        exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_binge_eating == "Baseline" ~ "To drop", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                       exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_BE_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at 1b
                      (outcome_phase_binge_eating == "Baseline" |
                         outcome_phase_binge_eating == "1b") ~ "To drop", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_BE_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_binge_eating == "1b"|
                          outcome_phase_binge_eating == "Baseline") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_BE_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                     (outcome_phase_binge_eating == "1b" |
                        outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_binge_eating == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_BE_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_BE_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_binge_eating == "1b" |
                       outcome_phase_binge_eating == "2b"|
                          outcome_phase_binge_eating == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_BE_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_BE_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b"|
                       outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_BE_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_binge_eating == "1b" |
                      outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                    outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_BE_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_BE_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b"|
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_BE_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b"|
                       outcome_phase_binge_eating == "6b" | # Co-occurring outcome and exposure
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_BE_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_BE_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b"|
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_BE_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_BE_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" | # Co-occurring outcome and exposure
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_BE_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b"|
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_BE_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" | # Co-occurring outcome and exposure
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_BE_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b"|
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                   outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_binge_eating == "12b" | # Experienced outcome AFTER or at SAME TIME as exposure
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_BE_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b"|
                       outcome_phase_binge_eating == "12b" | # Experienced outcome AFTER or at SAME TIME as exposure
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_BE_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_binge_eating == "14b" | 
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_BE_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |  # Co-occurring outcome and exposure
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                     outcome_phase_binge_eating == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_BE_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b"|
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_binge_eating == "16b"  ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_BE_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b" |
                          outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_16b)
  
```

Binge eating & change in main eco activity 
```{r Change in eco activity exposure BE}

dat <- dat %>%
  mutate(main_eco_change_before_BE =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_BE_baseline == "To drop" |
                    main_eco_change_BE_1a == "To drop" |
                    main_eco_change_BE_1b == "To drop" |
                      main_eco_change_BE_2a == "To drop" |
                    main_eco_change_BE_2b == "To drop" |
                      main_eco_change_BE_3a == "To drop" |
                    main_eco_change_BE_3b == "To drop" |
                      main_eco_change_BE_4a == "To drop" |
                    main_eco_change_BE_4b == "To drop" |
                      main_eco_change_BE_5a == "To drop" |
                    main_eco_change_BE_6b == "To drop" |
                      main_eco_change_BE_7a == "To drop" |
                    main_eco_change_BE_8b == "To drop" |
                      main_eco_change_BE_9a == "To drop" |
                    main_eco_change_BE_10b == "To drop" |
                      main_eco_change_BE_11a == "To drop" |
                    main_eco_change_BE_12b == "To drop" |
                    main_eco_change_BE_13a == "To drop" |
                      main_eco_change_BE_14b == "To drop" |
                    main_eco_change_BE_15a == "To drop" |
                      main_eco_change_BE_16b == "To drop" | # Change in eco activity after binge eating 
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" | # Missing whether change in eco activity
                    
                    # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "To drop", # Missing whether experienced binge eating
                    
                  # First exposure before first outcome
                    main_eco_change_BE_baseline == "Yes" |
                    main_eco_change_BE_1a == "Yes" |
                    main_eco_change_BE_1b == "Yes" |
                    main_eco_change_BE_2a == "Yes" |
                    main_eco_change_BE_2b == "Yes" |
                    main_eco_change_BE_3a == "Yes" |
                    main_eco_change_BE_3b == "Yes" |
                    main_eco_change_BE_4a == "Yes" |
                    main_eco_change_BE_4b == "Yes" |
                    main_eco_change_BE_5a == "Yes" |
                    main_eco_change_BE_6b == "Yes" |
                    main_eco_change_BE_7a == "Yes" |
                    main_eco_change_BE_8b == "Yes" |
                    main_eco_change_BE_9a == "Yes" |
                    main_eco_change_BE_10b == "Yes" |
                    main_eco_change_BE_11a == "Yes" |
                    main_eco_change_BE_12b == "Yes" |
                    main_eco_change_BE_13a == "Yes" |
                    main_eco_change_BE_14b == "Yes" |
                    main_eco_change_BE_15a == "Yes" |
                    main_eco_change_BE_16b == "Yes" ~ "Change in eco activity before binge eating",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_BE_baseline == "No outcome" |
                    main_eco_change_BE_1a == "No outcome" |
                    main_eco_change_BE_1b == "No outcome" |
                    main_eco_change_BE_2a == "No outcome" |
                    main_eco_change_BE_2b == "No outcome" |
                    main_eco_change_BE_3a == "No outcome" |
                    main_eco_change_BE_3b == "No outcome" |
                    main_eco_change_BE_4a == "No outcome" |
                    main_eco_change_BE_4b == "No outcome" |
                    main_eco_change_BE_5a == "No outcome" |
                    main_eco_change_BE_6b == "No outcome" |
                    main_eco_change_BE_7a == "No outcome" |
                    main_eco_change_BE_8b == "No outcome" |
                    main_eco_change_BE_9a == "No outcome" |
                    main_eco_change_BE_10b == "No outcome" |
                    main_eco_change_BE_11a == "No outcome" |
                    main_eco_change_BE_12b == "No outcome" |
                    main_eco_change_BE_13a == "No outcome" |
                    main_eco_change_BE_14b == "No outcome" |
                    main_eco_change_BE_15a == "No outcome" |
                    main_eco_change_BE_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_binge_eating != "Not answered" &
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_binge_eating  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_BE) 


# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_BE_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
             # Need to drop people who never answered whether they'd experienced binge eating
             
             main_eco_change_before_BE == "To drop" ~ NA_character_,  
                     
                     main_eco_change_before_BE ==  "Outcome but no exposure" |
                      main_eco_change_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                     main_eco_change_before_BE == "Exposure but no outcome" |
                    main_eco_change_before_BE == "Change in eco activity before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_BE_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(main_eco_change_before_BE_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_main_eco_change != "Missing at every phase" &
          outcome_phase_binge_eating != "Not answered") %>%
  select(exposure_phase_main_eco_change,
         outcome_phase_binge_eating
         )
```

Low weight
```{r Change in main eco activity BEFORE outcome LW}
# Baseline
dat <- dat %>%
  mutate(main_eco_change_LW_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                       exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Baseline" ~ "To drop",  # Co-occurring
                      
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (
                        outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_LW_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Baseline"~ "To drop", 
                       
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_LW_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at 1b
                      (outcome_phase_low_weight == "1b" |  # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline" ) ~ "To drop", 
                       
                     
                        exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_LW_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "1b"|
                          outcome_phase_low_weight == "Baseline") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_LW_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                     (outcome_phase_low_weight == "1b" |
                        outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_LW_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_low_weight == "1b" |
                       outcome_phase_low_weight == "2b"|
                          outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_LW_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_LW_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_low_weight == "1b" |
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_LW_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_LW_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_LW_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_LW_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_LW_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b"|
                       outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_LW_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_LW_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b"|
                       outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_LW_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_LW_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b"|
                       outcome_phase_low_weight == "12b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_12b)


# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_LW_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_LW_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" | # Co-occurring outcome and exposure
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                      outcome_phase_low_weight == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_LW_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                     outcome_phase_low_weight == "16b" ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_LW_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"  | # Co-occurring
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_16b)
```

Low weight & change in main eco activity 
```{r Change in eco activity exposure LW}
dat <- dat %>%
  mutate(main_eco_change_before_LW =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_LW_baseline == "To drop" |
                       main_eco_change_LW_1a == "To drop" |
                    main_eco_change_LW_1b == "To drop" |
                       main_eco_change_LW_2a == "To drop" |
                    main_eco_change_LW_2b == "To drop" |
                       main_eco_change_LW_3a == "To drop" |
                    main_eco_change_LW_3b == "To drop" |
                       main_eco_change_LW_4a == "To drop" |
                    main_eco_change_LW_4b == "To drop" |
                       main_eco_change_LW_5a == "To drop" |
                    main_eco_change_LW_6b == "To drop" |
                       main_eco_change_LW_7a == "To drop" |
                    main_eco_change_LW_8b == "To drop" |
                       main_eco_change_LW_9a == "To drop" |
                    main_eco_change_LW_10b == "To drop" |
                       main_eco_change_LW_11a == "To drop" |
                    main_eco_change_LW_12b == "To drop" |
                    main_eco_change_LW_13a == "To drop" |
                       main_eco_change_LW_14b == "To drop" |
                    main_eco_change_LW_15a == "To drop" |
                       main_eco_change_LW_16b == "To drop" | # Change in eco activity after low weight
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" | # Missing whether change in eco activity
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_low_weight == "Not answered" ~ "To drop", # Missing whether experienced low weight
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_LW_baseline == "Yes" |
                     main_eco_change_LW_1a == "Yes" |
                    main_eco_change_LW_1b == "Yes" |
                     main_eco_change_LW_2a == "Yes" |
                    main_eco_change_LW_2b == "Yes" |
                     main_eco_change_LW_3a == "Yes" |
                    main_eco_change_LW_3b == "Yes" |
                     main_eco_change_LW_4a == "Yes" |
                    main_eco_change_LW_4b == "Yes" |
                     main_eco_change_LW_5a == "Yes" |
                    main_eco_change_LW_6b == "Yes" |
                     main_eco_change_LW_7a == "Yes" |
                    main_eco_change_LW_8b == "Yes" |
                     main_eco_change_LW_9a == "Yes" |
                    main_eco_change_LW_10b == "Yes" |
                     main_eco_change_LW_11a == "Yes" |
                    main_eco_change_LW_12b == "Yes" |
                    main_eco_change_LW_13a == "Yes" |
                     main_eco_change_LW_14b == "Yes" |
                    main_eco_change_LW_15a == "Yes" |
                     main_eco_change_LW_16b == "Yes" ~ "Change in eco activity before low weight",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_LW_baseline == "No outcome" |
                    main_eco_change_LW_1a == "No outcome" |
                    main_eco_change_LW_1b == "No outcome" |
                    main_eco_change_LW_2a == "No outcome" |
                    main_eco_change_LW_2b == "No outcome" |
                    main_eco_change_LW_3a == "No outcome" |
                    main_eco_change_LW_3b == "No outcome" |
                    main_eco_change_LW_4a == "No outcome" |
                    main_eco_change_LW_4b == "No outcome" |
                    main_eco_change_LW_5a == "No outcome" |
                    main_eco_change_LW_6b == "No outcome" |
                    main_eco_change_LW_7a == "No outcome" |
                    main_eco_change_LW_8b == "No outcome" |
                    main_eco_change_LW_9a == "No outcome" |
                    main_eco_change_LW_10b == "No outcome" |
                    main_eco_change_LW_11a == "No outcome" |
                    main_eco_change_LW_12b == "No outcome" |
                    main_eco_change_LW_13a == "No outcome" |
                    main_eco_change_LW_14b == "No outcome" |
                    main_eco_change_LW_15a == "No outcome" |
                    main_eco_change_LW_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_low_weight != "Not answered" &
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_low_weight  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_LW) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_LW_final =
           case_when(# Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
             # Need to drop people who never answered whether they'd experienced outcome
             
             main_eco_change_before_LW == "To drop" ~ NA_character_,  
                     
                      main_eco_change_before_LW ==  "Outcome but no exposure" |
                      main_eco_change_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                      main_eco_change_before_LW == "Exposure but no outcome" |
                      main_eco_change_before_LW == "Change in eco activity before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_LW_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(main_eco_change_before_LW_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_main_eco_change != "Missing at every phase" &
          outcome_phase_low_weight != "Not answered") %>%
  select(exposure_phase_main_eco_change,
         outcome_phase_low_weight
         )
```

Harmful ideation
```{r Change in main eco activity BEFORE outcome HI}
# Baseline
dat <- dat %>%
  mutate(main_eco_change_HI_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_harmful_ideation == "Baseline"  ~ "To drop", # Co-occurring
                      
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (
                        outcome_phase_harmful_ideation == "1a" | 
                        outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" | 
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_HI_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      (outcome_phase_harmful_ideation == "1a" |  # Co-occurring
                        outcome_phase_harmful_ideation == "Baseline") ~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (
                        outcome_phase_harmful_ideation == "1b" |  
                         outcome_phase_harmful_ideation == "2a" | 
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                          outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                          outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                          outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                          outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                          outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_HI_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1b" |  # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (
                      outcome_phase_harmful_ideation == "2a" |
                         outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_HI_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                         outcome_phase_harmful_ideation == "2a" | # Co-occurring
                       outcome_phase_harmful_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (
                         outcome_phase_harmful_ideation == "2b" |
                          outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_HI_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_harmful_ideation == "Baseline" |
                           outcome_phase_harmful_ideation == "1a" |
                           outcome_phase_harmful_ideation == "1b" |
                           outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_harmful_ideation == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_harmful_ideation == "3a" |
                          outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_HI_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                         outcome_phase_harmful_ideation == "3a" | # Co-occurring
                       outcome_phase_harmful_ideation == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (
                         outcome_phase_harmful_ideation == "3b" |
                          outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_HI_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (
                      outcome_phase_harmful_ideation == "4a" |
                           outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_HI_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                        outcome_phase_harmful_ideation == "4a" | # Co-occurring
                       outcome_phase_harmful_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (
                         outcome_phase_harmful_ideation == "4b" |
                          outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_HI_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_harmful_ideation == "5a" |
                          outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_HI_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (
                         outcome_phase_harmful_ideation == "6b" |
                          outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_HI_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (
                      outcome_phase_harmful_ideation == "7a" |
                        outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_HI_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_HI_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                        outcome_phase_harmful_ideation == "7a" | # Co-occurring
                       outcome_phase_harmful_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    ( 
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_HI_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      ( outcome_phase_harmful_ideation == "9a" |
                          outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_HI_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "9a" | # Co-occurring
                       outcome_phase_harmful_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (
                        outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_HI_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (
                       outcome_phase_harmful_ideation == "11a" |
                         outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_HI_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" | 
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "11a" | # Co-occurring
                       outcome_phase_harmful_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (
                        outcome_phase_harmful_ideation == "12b"| 
                        outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                        outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_HI_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "12b" |  # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_HI_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "13a" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_HI_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b" |
                        outcome_phase_harmful_ideation == "14b" |   # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 13a
                    ( 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_14b)


# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_HI_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                        outcome_phase_harmful_ideation == "15a" | # Co-occurring outcome and exposure
                        outcome_phase_harmful_ideation == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                     outcome_phase_harmful_ideation == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_15a)



# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_HI_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                        outcome_phase_harmful_ideation == "14b" |
                         outcome_phase_harmful_ideation == "16b" |
                        outcome_phase_harmful_ideation == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                   
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_16b)
```

Harmful ideation & change in main eco activity 
```{r Change in eco activity exposure HI}
dat <- dat %>%
  mutate(main_eco_change_before_HI =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_HI_baseline == "To drop" |
                       main_eco_change_HI_1a == "To drop" |
                    main_eco_change_HI_1b == "To drop" |
                       main_eco_change_HI_2a == "To drop" |
                    main_eco_change_HI_2b == "To drop" |
                       main_eco_change_HI_3a == "To drop" |
                    main_eco_change_HI_3b == "To drop" |
                       main_eco_change_HI_4a == "To drop" |
                    main_eco_change_HI_4b == "To drop" |
                       main_eco_change_HI_5a == "To drop" |
                    main_eco_change_HI_6b == "To drop" |
                       main_eco_change_HI_7a == "To drop" |
                    main_eco_change_HI_8b == "To drop" |
                       main_eco_change_HI_9a == "To drop" |
                    main_eco_change_HI_10b == "To drop" |
                       main_eco_change_HI_11a == "To drop" |
                    main_eco_change_HI_12b == "To drop" |
                    main_eco_change_HI_13a == "To drop" |
                       main_eco_change_HI_14b == "To drop" |
                    main_eco_change_HI_15a == "To drop" |
                       main_eco_change_HI_16b == "To drop" | # Change in eco activity after harmful ideation
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" | # Missing whether change in eco activity
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "To drop", # Missing whether experienced harmful ideation
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_HI_baseline == "Yes" |
                     main_eco_change_HI_1a == "Yes" |
                    main_eco_change_HI_1b == "Yes" |
                     main_eco_change_HI_2a == "Yes" |
                    main_eco_change_HI_2b == "Yes" |
                     main_eco_change_HI_3a == "Yes" |
                    main_eco_change_HI_3b == "Yes" |
                     main_eco_change_HI_4a == "Yes" |
                    main_eco_change_HI_4b == "Yes" |
                     main_eco_change_HI_5a == "Yes" |
                    main_eco_change_HI_6b == "Yes" |
                     main_eco_change_HI_7a == "Yes" |
                    main_eco_change_HI_8b == "Yes" |
                     main_eco_change_HI_9a == "Yes" |
                    main_eco_change_HI_10b == "Yes" |
                     main_eco_change_HI_11a == "Yes" |
                    main_eco_change_HI_12b == "Yes"|
                    main_eco_change_HI_13a == "Yes" |
                     main_eco_change_HI_14b == "Yes" |
                    main_eco_change_HI_15a == "Yes" |
                     main_eco_change_HI_16b == "Yes"  ~ "Change in eco activity before harmful ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_HI_baseline == "No outcome" |
                    main_eco_change_HI_1a == "No outcome" |
                    main_eco_change_HI_1b == "No outcome" |
                    main_eco_change_HI_2a == "No outcome" |
                    main_eco_change_HI_2b == "No outcome" |
                    main_eco_change_HI_3a == "No outcome" |
                    main_eco_change_HI_3b == "No outcome" |
                    main_eco_change_HI_4a == "No outcome" |
                    main_eco_change_HI_4b == "No outcome" |
                    main_eco_change_HI_5a == "No outcome" |
                    main_eco_change_HI_6b == "No outcome" |
                    main_eco_change_HI_7a == "No outcome" |
                    main_eco_change_HI_8b == "No outcome" |
                    main_eco_change_HI_9a == "No outcome" |
                    main_eco_change_HI_10b == "No outcome" |
                    main_eco_change_HI_11a == "No outcome" |
                    main_eco_change_HI_12b == "No outcome" |
                    main_eco_change_HI_13a == "No outcome" |
                    main_eco_change_HI_14b == "No outcome" |
                    main_eco_change_HI_15a == "No outcome" |
                    main_eco_change_HI_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" &
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_harmful_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_HI) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_HI_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
             # Need to drop people who never answered whether they'd experienced outcome
             
             main_eco_change_before_HI == "To drop" ~ NA_character_,  
                     
                      main_eco_change_before_HI ==  "Outcome but no exposure" |
                      main_eco_change_before_HI ==  "Neither exposure nor outcome" ~ "No",
                      
                     main_eco_change_before_HI == "Exposure but no outcome" |
                      main_eco_change_before_HI == "Change in eco activity before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_HI_final)  

# Check NAs
missing <- dat %>%
  filter(is.na(main_eco_change_before_HI_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_main_eco_change != "Missing at every phase" &
          outcome_phase_harmful_ideation != "Not answered or PNTA" &
  outcome_phase_harmful_ideation != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_main_eco_change,
         outcome_phase_harmful_ideation
         )
```

Self-harm
```{r Change in main eco activity BEFORE outcome SH}
# Baseline
dat <- dat %>%
  mutate(main_eco_change_SH_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm == "Baseline" ~ "To drop", # Co-occurring
                     
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (
                        outcome_phase_selfharm == "1a" | 
                        outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" | 
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_SH_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" ) ~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (
                        outcome_phase_selfharm == "1b" |  
                         outcome_phase_selfharm == "2a" | 
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                          outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                          outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                          outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                          outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                          outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_SH_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1b" |  # Co-occurring outcome and exposure
                         outcome_phase_selfharm == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (
                      outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_SH_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                         outcome_phase_selfharm == "2a" | # Co-occurring
                       outcome_phase_selfharm == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (
                         outcome_phase_selfharm == "2b" |
                          outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_SH_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_selfharm == "Baseline" |
                           outcome_phase_selfharm == "1a" |
                           outcome_phase_selfharm == "1b" |
                           outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_selfharm == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_selfharm == "3a" |
                          outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SH_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_SH_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "3a" | # Co-occurring
                       outcome_phase_selfharm == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (
                         outcome_phase_selfharm == "3b" |
                          outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SH_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_SH_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (
                      outcome_phase_selfharm == "4a" |
                           outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_SH_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                        outcome_phase_selfharm == "4a" | # Co-occurring
                       outcome_phase_selfharm == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (
                         outcome_phase_selfharm == "4b" |
                          outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_SH_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_selfharm == "5a" |
                          outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_SH_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "5a" | # Co-occurring
                       outcome_phase_selfharm == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (
                         outcome_phase_selfharm == "6b" |
                          outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_SH_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (
                      outcome_phase_selfharm == "7a" |
                        outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SH_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_SH_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                        outcome_phase_selfharm == "7a" | # Co-occurring
                       outcome_phase_selfharm == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    ( 
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SH_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_SH_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      ( outcome_phase_selfharm == "9a" |
                          outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_SH_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "9a" | # Co-occurring
                       outcome_phase_selfharm == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (
                        outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_SH_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (
                       outcome_phase_selfharm == "11a" |
                         outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_SH_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" | 
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "11a" | # Co-occurring
                       outcome_phase_selfharm == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (
                    outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_SH_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "12b" | # Co-occurring
                       outcome_phase_selfharm == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_SH_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                        outcome_phase_selfharm == "13a" | # Co-occurring
                       outcome_phase_selfharm == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (
                      outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_13a)

# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_SH_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "14b" |  # Co-occurring
                       outcome_phase_selfharm == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                     ( outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_SH_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "15a" | # Co-occurring
                       outcome_phase_selfharm == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                      outcome_phase_selfharm == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_SH_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                          outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_16b)
```


Self-harm ideation & change in main eco activity 
```{r Change in eco activity exposure SH}
dat <- dat %>%
  mutate(main_eco_change_before_SH =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_SH_baseline == "To drop" |
                       main_eco_change_SH_1a == "To drop" |
                    main_eco_change_SH_1b == "To drop" |
                       main_eco_change_SH_2a == "To drop" |
                    main_eco_change_SH_2b == "To drop" |
                       main_eco_change_SH_3a == "To drop" |
                    main_eco_change_SH_3b == "To drop" |
                       main_eco_change_SH_4a == "To drop" |
                    main_eco_change_SH_4b == "To drop" |
                       main_eco_change_SH_5a == "To drop" |
                    main_eco_change_SH_6b == "To drop" |
                       main_eco_change_SH_7a == "To drop" |
                    main_eco_change_SH_8b == "To drop" |
                       main_eco_change_SH_9a == "To drop" |
                    main_eco_change_SH_10b == "To drop" |
                       main_eco_change_SH_11a == "To drop" |
                    main_eco_change_SH_12b == "To drop"|
                    main_eco_change_SH_13a == "To drop" |
                       main_eco_change_SH_14b == "To drop" |
                    main_eco_change_SH_15a == "To drop" |
                       main_eco_change_SH_16b == "To drop"  | # Change in eco activity after self-harm
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" | # Missing whether change in eco activity
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "To drop", # Missing whether experienced self-harm
                    
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_SH_baseline == "Yes" |
                     main_eco_change_SH_1a == "Yes" |
                    main_eco_change_SH_1b == "Yes" |
                     main_eco_change_SH_2a == "Yes" |
                    main_eco_change_SH_2b == "Yes" |
                     main_eco_change_SH_3a == "Yes" |
                    main_eco_change_SH_3b == "Yes" |
                     main_eco_change_SH_4a == "Yes" |
                    main_eco_change_SH_4b == "Yes" |
                     main_eco_change_SH_5a == "Yes" |
                    main_eco_change_SH_6b == "Yes" |
                     main_eco_change_SH_7a == "Yes" |
                    main_eco_change_SH_8b == "Yes" |
                     main_eco_change_SH_9a == "Yes" |
                    main_eco_change_SH_10b == "Yes" |
                     main_eco_change_SH_11a == "Yes" |
                    main_eco_change_SH_12b == "Yes"|
                    main_eco_change_SH_13a == "Yes" |
                     main_eco_change_SH_14b == "Yes" |
                    main_eco_change_SH_15a == "Yes" |
                     main_eco_change_SH_16b == "Yes"~ "Change in eco activity before self-harm",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_SH_baseline == "No outcome" |
                    main_eco_change_SH_1a == "No outcome" |
                    main_eco_change_SH_1b == "No outcome" |
                    main_eco_change_SH_2a == "No outcome" |
                    main_eco_change_SH_2b == "No outcome" |
                    main_eco_change_SH_3a == "No outcome" |
                    main_eco_change_SH_3b == "No outcome" |
                    main_eco_change_SH_4a == "No outcome" |
                    main_eco_change_SH_4b == "No outcome" |
                    main_eco_change_SH_5a == "No outcome" |
                    main_eco_change_SH_6b == "No outcome" |
                    main_eco_change_SH_7a == "No outcome" |
                    main_eco_change_SH_8b == "No outcome" |
                    main_eco_change_SH_9a == "No outcome" |
                    main_eco_change_SH_10b == "No outcome" |
                    main_eco_change_SH_11a == "No outcome" |
                    main_eco_change_SH_12b == "No outcome" |
                    main_eco_change_SH_13a == "No outcome" |
                    main_eco_change_SH_14b == "No outcome" |
                    main_eco_change_SH_15a == "No outcome" |
                    main_eco_change_SH_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_selfharm != "Not answered or PNTA" &
                        outcome_phase_selfharm!= "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_selfharm  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
   
# Check                      
dat %>%
  freq(main_eco_change_before_SH) 


# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_SH_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
              # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
              # Need to drop people who never answered whether they'd experienced outcome
             
             main_eco_change_before_SH == "To drop" ~ NA_character_, 
                     
                      main_eco_change_before_SH ==  "Outcome but no exposure" |
                      main_eco_change_before_SH ==  "Neither exposure nor outcome" ~ "No",
                    
                     main_eco_change_before_SH == "Exposure but no outcome" |
                      main_eco_change_before_SH == "Change in eco activity before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_SH_final)  

# Check NAs
missing <- dat %>%
  filter(is.na(main_eco_change_before_SH_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_main_eco_change != "Missing at every phase" &
          outcome_phase_selfharm != "Not answered or PNTA" &
  outcome_phase_selfharm != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_main_eco_change,
         outcome_phase_selfharm
         )
```

## Change in living situation
```{r Change in living situation BEFORE outcome BE}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_BE_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_binge_eating == "Baseline" ~ "To drop", # Co-occurring
                       
                       exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      ( outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_BE_1a =
           case_when(
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_binge_eating == "Baseline" ~ "To drop", 
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_BE_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "1b" & # First exposure at 1b
                      (outcome_phase_binge_eating == "1b" |  # Co-occurring outcome and exposure)
                       outcome_phase_binge_eating == "Baseline") ~ "To drop", 
                     
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_BE_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_binge_eating == "1b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_BE_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_binge_eating == "1b"  |
                        outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_BE_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_BE_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_binge_eating == "1b" |
                       outcome_phase_binge_eating == "2b"|
                        outcome_phase_binge_eating == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_BE_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_BE_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b"|
                       outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_BE_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_binge_eating == "1b" |
                      outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_BE_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b"|
                       outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_BE_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_BE_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b"|
                       outcome_phase_binge_eating == "6b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_BE_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_BE_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b"|
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_BE_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_BE_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_BE_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_BE_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_BE_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_BE_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" | # Co-occurring
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_12b)


# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_BE_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_BE_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                        outcome_phase_binge_eating == "14b" |  # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                     outcome_phase_binge_eating == "16b" ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_14b)

# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_BE_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                      outcome_phase_binge_eating == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_15a)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_BE_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                        outcome_phase_binge_eating == "16b" | # Co-occurring
                        outcome_phase_binge_eating == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_16b)
```

Binge eating & change in living situation
```{r Change in living situation exposure BE}
dat <- dat %>%
  mutate(living_situation_change_before_BE =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_BE_baseline == "To drop" |
                    living_situation_change_BE_1a == "To drop" |
                    living_situation_change_BE_1b == "To drop" |
                      living_situation_change_BE_2a == "To drop" |
                    living_situation_change_BE_2b == "To drop" |
                      living_situation_change_BE_3a == "To drop" |
                    living_situation_change_BE_3b == "To drop" |
                      living_situation_change_BE_4a == "To drop" |
                    living_situation_change_BE_4b == "To drop" |
                      living_situation_change_BE_5a == "To drop" |
                    living_situation_change_BE_6b == "To drop" |
                      living_situation_change_BE_7a == "To drop" |
                    living_situation_change_BE_8b == "To drop" |
                      living_situation_change_BE_9a == "To drop" |
                    living_situation_change_BE_10b == "To drop" |
                      living_situation_change_BE_11a == "To drop" |
                    living_situation_change_BE_12b == "To drop" |
                    living_situation_change_BE_13a == "To drop" |
                      living_situation_change_BE_14b == "To drop" |
                    living_situation_change_BE_15a == "To drop" |
                      living_situation_change_BE_16b == "To drop" | # Change in living situation after binge eating
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" | # Missing whether change in living situation
                    
                    # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "To drop", # Missing whether experienced binge eating
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_BE_baseline == "Yes" |
                    living_situation_change_BE_1a == "Yes" |
                    living_situation_change_BE_1b == "Yes" |
                    living_situation_change_BE_2a == "Yes" |
                    living_situation_change_BE_2b == "Yes" |
                    living_situation_change_BE_3a == "Yes" |
                    living_situation_change_BE_3b == "Yes" |
                    living_situation_change_BE_4a == "Yes" |
                    living_situation_change_BE_4b == "Yes" |
                    living_situation_change_BE_5a == "Yes" |
                    living_situation_change_BE_6b == "Yes" |
                    living_situation_change_BE_7a == "Yes" |
                    living_situation_change_BE_8b == "Yes" |
                    living_situation_change_BE_9a == "Yes" |
                    living_situation_change_BE_10b == "Yes" |
                    living_situation_change_BE_11a == "Yes" |
                    living_situation_change_BE_12b == "Yes" |
                    living_situation_change_BE_13a == "Yes" |
                    living_situation_change_BE_14b == "Yes" |
                    living_situation_change_BE_15a == "Yes" |
                    living_situation_change_BE_16b == "Yes"~ "Change in living situation before binge eating",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_BE_baseline == "No outcome" |
                    living_situation_change_BE_1a == "No outcome" |
                    living_situation_change_BE_1b == "No outcome" |
                    living_situation_change_BE_2a == "No outcome" |
                    living_situation_change_BE_2b == "No outcome" |
                    living_situation_change_BE_3a == "No outcome" |
                    living_situation_change_BE_3b == "No outcome" |
                    living_situation_change_BE_4a == "No outcome" |
                    living_situation_change_BE_4b == "No outcome" |
                    living_situation_change_BE_5a == "No outcome" |
                    living_situation_change_BE_6b == "No outcome" |
                    living_situation_change_BE_7a == "No outcome" |
                    living_situation_change_BE_8b == "No outcome" |
                    living_situation_change_BE_9a == "No outcome" |
                    living_situation_change_BE_10b == "No outcome" |
                    living_situation_change_BE_11a == "No outcome" |
                    living_situation_change_BE_12b == "No outcome" |
                    living_situation_change_BE_13a == "No outcome" |
                    living_situation_change_BE_14b == "No outcome" |
                    living_situation_change_BE_15a == "No outcome" |
                    living_situation_change_BE_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_binge_eating != "Not answered" &
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_binge_eating  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_BE) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_BE_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
             # Need to drop people who never answered whether they'd experienced binge eating
             
             living_situation_change_before_BE == "To drop" ~ NA_character_,  
                     
                       living_situation_change_before_BE ==  "Outcome but no exposure" |
                      living_situation_change_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                      living_situation_change_before_BE == "Exposure but no outcome" |
                    living_situation_change_before_BE == "Change in living situation before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_BE_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(living_situation_change_before_BE_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_living_situation_change != "Missing at every phase" &
          outcome_phase_binge_eating != "Not answered" &
           outcome_phase_binge_eating != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_living_situation_change,
         outcome_phase_binge_eating
         )
```

Low weight
```{r Change in living situation BEFORE outcome LW}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_LW_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Baseline" ~ "To drop", # Co-occurring
                     
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_low_weight == "Baseline" | # Co-occurring 
                        outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_LW_1a =
           case_when(
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Baseline" ~ "To drop",
                         
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_LW_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                      exposure_phase_living_situation_change == "1b" & # First exposure at 1b
                      (outcome_phase_low_weight == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "Baseline") ~ "To drop",
                     
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_LW_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      (outcome_phase_low_weight == "1b" |
                        outcome_phase_low_weight == "Baseline") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_LW_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_low_weight == "1b"  |
                        outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred LWfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_LW_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_low_weight == "1b" |
                       outcome_phase_low_weight == "2b"|
                        outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_LW_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b"|
                       outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_LW_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_low_weight == "1b" |
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_LW_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_LW_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_LW_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_LW_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_LW_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_LW_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_LW_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_LW_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "Baseline")   ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_LW_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" | # Co-occurring
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_12b)




# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_LW_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_LW_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |  # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                      outcome_phase_low_weight == "16b" ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_14b)


# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_LW_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                      outcome_phase_low_weight == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_15a)

# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_LW_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_16b)
```

Low weight & change in living situation
```{r Change in living situation exposure LW}
dat <- dat %>%
  mutate(living_situation_change_before_LW =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_LW_baseline == "To drop" |
                    living_situation_change_LW_1a == "To drop" |
                    living_situation_change_LW_1b == "To drop" |
                      living_situation_change_LW_2a == "To drop" |
                    living_situation_change_LW_2b == "To drop" |
                      living_situation_change_LW_3a == "To drop" |
                    living_situation_change_LW_3b == "To drop" |
                      living_situation_change_LW_4a == "To drop" |
                    living_situation_change_LW_4b == "To drop" |
                      living_situation_change_LW_5a == "To drop" |
                    living_situation_change_LW_6b == "To drop" |
                      living_situation_change_LW_7a == "To drop" |
                    living_situation_change_LW_8b == "To drop" |
                      living_situation_change_LW_9a == "To drop" |
                    living_situation_change_LW_10b == "To drop" |
                      living_situation_change_LW_11a == "To drop" |
                    living_situation_change_LW_12b == "To drop"|
                    living_situation_change_LW_13a == "To drop" |
                      living_situation_change_LW_14b== "To drop" |
                    living_situation_change_LW_15a == "To drop" |
                      living_situation_change_LW_16b == "To drop" | # Change in living situation after low weight
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" | # Missing whether change in living situation
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_low_weight == "Not answered" ~ "To drop", # Missing whether experienced low weight
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_LW_baseline == "Yes" |
                    living_situation_change_LW_1a == "Yes" |
                    living_situation_change_LW_1b == "Yes" |
                    living_situation_change_LW_2a == "Yes" |
                    living_situation_change_LW_2b == "Yes" |
                    living_situation_change_LW_3a == "Yes" |
                    living_situation_change_LW_3b == "Yes" |
                    living_situation_change_LW_4a == "Yes" |
                    living_situation_change_LW_4b == "Yes" |
                    living_situation_change_LW_5a == "Yes" |
                    living_situation_change_LW_6b == "Yes" |
                    living_situation_change_LW_7a == "Yes" |
                    living_situation_change_LW_8b == "Yes" |
                    living_situation_change_LW_9a == "Yes" |
                    living_situation_change_LW_10b == "Yes" |
                    living_situation_change_LW_11a == "Yes" |
                    living_situation_change_LW_12b == "Yes" |
                    living_situation_change_LW_13a == "Yes" |
                    living_situation_change_LW_14b == "Yes" |
                    living_situation_change_LW_15a == "Yes" |
                    living_situation_change_LW_16b == "Yes"~ "Change in living situation before low weight",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_LW_baseline == "No outcome" |
                    living_situation_change_LW_1a == "No outcome" |
                    living_situation_change_LW_1b == "No outcome" |
                    living_situation_change_LW_2a == "No outcome" |
                    living_situation_change_LW_2b == "No outcome" |
                    living_situation_change_LW_3a == "No outcome" |
                    living_situation_change_LW_3b == "No outcome" |
                    living_situation_change_LW_4a == "No outcome" |
                    living_situation_change_LW_4b == "No outcome" |
                    living_situation_change_LW_5a == "No outcome" |
                    living_situation_change_LW_6b == "No outcome" |
                    living_situation_change_LW_7a == "No outcome" |
                    living_situation_change_LW_8b == "No outcome" |
                    living_situation_change_LW_9a == "No outcome" |
                    living_situation_change_LW_10b == "No outcome" |
                    living_situation_change_LW_11a == "No outcome" |
                    living_situation_change_LW_12b == "No outcome" |
                    living_situation_change_LW_13a == "No outcome" |
                    living_situation_change_LW_14b == "No outcome" |
                    living_situation_change_LW_15a == "No outcome" |
                    living_situation_change_LW_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_low_weight != "Not answered" &
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_low_weight  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_LW) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_LW_final =
           case_when(
             # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
             # Need to drop people who never answered whether they'd experienced the outcome
             
             living_situation_change_before_LW == "To drop" ~ NA_character_,  
                     
                       living_situation_change_before_LW ==  "Outcome but no exposure" |
                     living_situation_change_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     living_situation_change_before_LW == "Exposure but no outcome" |
                    living_situation_change_before_LW == "Change in living situation before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_LW_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(living_situation_change_before_LW_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_living_situation_change != "Missing at every phase" &
          outcome_phase_low_weight != "Not answered" &
           outcome_phase_low_weight != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_living_situation_change,
         outcome_phase_low_weight
         )
```

Harmful ideation
```{r Change in living situation BEFORE outcome HI}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_HI_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_harmful_ideation == "Baseline" ~ "To drop", # Co-occurring
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (
                         outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "1b" |  
                         outcome_phase_harmful_ideation == "2a" |
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_HI_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (
                        outcome_phase_harmful_ideation == "1b" | 
                         outcome_phase_harmful_ideation == "2a" |
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_HI_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1b" |  # Co-occurring outcome and exposure
                        outcome_phase_harmful_ideation == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (
                       outcome_phase_harmful_ideation == "2a" |
                         outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_HI_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_harmful_ideation == "Baseline" |
                          outcome_phase_harmful_ideation == "1a" |
                          outcome_phase_harmful_ideation == "2a" | # Co-occurring
                       outcome_phase_harmful_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (
                         outcome_phase_harmful_ideation == "2b" |
                          outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_HI_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                        outcome_phase_harmful_ideation == "2a") ~ "To drop", # First experience of outcome occurred HIfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_harmful_ideation == "3a" |
                          outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_HI_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                         outcome_phase_harmful_ideation == "3a" | # Co-occurring
                       outcome_phase_harmful_ideation == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (
                         outcome_phase_harmful_ideation == "3b" |
                          outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_HI_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (
                       outcome_phase_harmful_ideation == "4a" |
                          outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_HI_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                        outcome_phase_harmful_ideation == "4a" | # Co-occurring
                       outcome_phase_harmful_ideation == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (
                         outcome_phase_harmful_ideation == "4b" |
                          outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_HI_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_harmful_ideation == "5a" |
                          outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_HI_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "5a" | # Co-occurring
                       outcome_phase_harmful_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (
                         outcome_phase_harmful_ideation == "6b" |
                          outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_HI_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_HI_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_HI_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                        outcome_phase_harmful_ideation == "7a" | # Co-occurring
                       outcome_phase_harmful_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    ( 
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_HI_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "7a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (
                      outcome_phase_harmful_ideation == "9a" |
                          outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_HI_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "9a" | # Co-occurring
                       outcome_phase_harmful_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (
                        outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_HI_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (
                      outcome_phase_harmful_ideation == "11a" |
                          outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_HI_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" | 
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "11a" | # Co-occurring
                       outcome_phase_harmful_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (
                     outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_HI_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "12b" | # Co-occurring
                       outcome_phase_harmful_ideation == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_12b)

# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_HI_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "13a" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_HI_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b"   # Co-occurring outcome and exposure
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                        (outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_HI_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a"  # Co-occurring outcome and exposure
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                      outcome_phase_harmful_ideation == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_15a)



# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_HI_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b" |
                        outcome_phase_harmful_ideation == "15a" |
                        outcome_phase_harmful_ideation == "16b"
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_16b)
```

harmful ideation & change in living situation
```{r Change in living situation exposure HI}
dat <- dat %>%
  mutate(living_situation_change_before_HI =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_HI_baseline == "To drop" |
                    living_situation_change_HI_1a == "To drop" |
                    living_situation_change_HI_1b == "To drop" |
                      living_situation_change_HI_2a == "To drop" |
                    living_situation_change_HI_2b == "To drop" |
                      living_situation_change_HI_3a == "To drop" |
                    living_situation_change_HI_3b == "To drop" |
                      living_situation_change_HI_4a == "To drop" |
                    living_situation_change_HI_4b == "To drop" |
                      living_situation_change_HI_5a == "To drop" |
                    living_situation_change_HI_6b == "To drop" |
                      living_situation_change_HI_7a == "To drop" |
                    living_situation_change_HI_8b == "To drop" |
                      living_situation_change_HI_9a == "To drop" |
                    living_situation_change_HI_10b == "To drop" |
                      living_situation_change_HI_11a == "To drop" |
                    living_situation_change_HI_12b == "To drop" |
                    living_situation_change_HI_13a == "To drop" |
                      living_situation_change_HI_14b == "To drop" |
                    living_situation_change_HI_15a == "To drop" |
                      living_situation_change_HI_16b == "To drop" | # Change in living situation after harmful ideation
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" | # Missing whether change in living situation
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "To drop", # Missing whether experienced harmful ideation
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_HI_baseline == "Yes" |
                    living_situation_change_HI_1a == "Yes" |
                    living_situation_change_HI_1b == "Yes" |
                    living_situation_change_HI_2a == "Yes" |
                    living_situation_change_HI_2b == "Yes" |
                    living_situation_change_HI_3a == "Yes" |
                    living_situation_change_HI_3b == "Yes" |
                    living_situation_change_HI_4a == "Yes" |
                    living_situation_change_HI_4b == "Yes" |
                    living_situation_change_HI_5a == "Yes" |
                    living_situation_change_HI_6b == "Yes" |
                    living_situation_change_HI_7a == "Yes" |
                    living_situation_change_HI_8b == "Yes" |
                    living_situation_change_HI_9a == "Yes" |
                    living_situation_change_HI_10b == "Yes" |
                    living_situation_change_HI_11a == "Yes" |
                    living_situation_change_HI_12b == "Yes"|
                    living_situation_change_HI_13a == "Yes" |
                    living_situation_change_HI_14b == "Yes" |
                    living_situation_change_HI_15a == "Yes" |
                    living_situation_change_HI_16b == "Yes" ~ "Change in living situation before harmful ideation",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_HI_baseline == "No outcome" |
                    living_situation_change_HI_1a == "No outcome" |
                    living_situation_change_HI_1b == "No outcome" |
                    living_situation_change_HI_2a == "No outcome" |
                    living_situation_change_HI_2b == "No outcome" |
                    living_situation_change_HI_3a == "No outcome" |
                    living_situation_change_HI_3b == "No outcome" |
                    living_situation_change_HI_4a == "No outcome" |
                    living_situation_change_HI_4b == "No outcome" |
                    living_situation_change_HI_5a == "No outcome" |
                    living_situation_change_HI_6b == "No outcome" |
                    living_situation_change_HI_7a == "No outcome" |
                    living_situation_change_HI_8b == "No outcome" |
                    living_situation_change_HI_9a == "No outcome" |
                    living_situation_change_HI_10b == "No outcome" |
                    living_situation_change_HI_11a == "No outcome" |
                    living_situation_change_HI_12b == "No outcome" |
                    living_situation_change_HI_13a == "No outcome" |
                    living_situation_change_HI_14b == "No outcome" |
                    living_situation_change_HI_15a == "No outcome" |
                    living_situation_change_HI_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" &
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_harmful_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_HI) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_HI_final =
           case_when(
              # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
             # Need to drop people who never answered whether they'd experienced the outcome
             
             living_situation_change_before_HI == "To drop" ~ NA_character_,  
                     
                       living_situation_change_before_HI ==  "Outcome but no exposure" |
                      living_situation_change_before_HI ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_HI == "Exposure but no outcome" |
                    living_situation_change_before_HI == "Change in living situation before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_HI_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(living_situation_change_before_HI_final) 
           )


# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_living_situation_change != "Missing at every phase" &
          outcome_phase_harmful_ideation != "Not answered or PNTA" &
           outcome_phase_harmful_ideation != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_living_situation_change,
         outcome_phase_harmful_ideation
         )
```

Self-harm 
```{r Change in living situation BEFORE outcome SH}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_SH_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm == "Baseline" ~ "To drop", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                      
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (
                         outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" |  
                         outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_SH_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" ) ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (
                        outcome_phase_selfharm == "1b" | 
                         outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_SH_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1b" |  # Co-occurring outcome and exposure
                        outcome_phase_selfharm == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (
                       outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_SH_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm == "Baseline" |
                          outcome_phase_selfharm == "1a" |
                          outcome_phase_selfharm == "2a" | # Co-occurring
                       outcome_phase_selfharm == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (
                         outcome_phase_selfharm == "2b" |
                          outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_SH_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                        outcome_phase_selfharm == "2a") ~ "To drop", # First experience of outcome occurred SHfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (
                       outcome_phase_selfharm == "3a" |
                          outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SH_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_SH_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "3a" | # Co-occurring
                       outcome_phase_selfharm == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (
                         outcome_phase_selfharm == "3b" |
                          outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SH_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_SH_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (
                       outcome_phase_selfharm == "4a" |
                          outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_SH_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                        outcome_phase_selfharm == "4a" | # Co-occurring
                       outcome_phase_selfharm == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (
                         outcome_phase_selfharm == "4b" |
                          outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_SH_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (
                       outcome_phase_selfharm == "5a" |
                          outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_SH_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "5a" | # Co-occurring
                       outcome_phase_selfharm == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (
                         outcome_phase_selfharm == "6b" |
                          outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_SH_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "5a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SH_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_SH_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_selfharm == "Baseline" |
                      outcome_phase_selfharm == "1a" |
                      outcome_phase_selfharm == "1b" |
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                        outcome_phase_selfharm == "7a" | # Co-occurring
                       outcome_phase_selfharm == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    ( 
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SH_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_SH_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "7a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (
                      outcome_phase_selfharm == "9a" |
                          outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_SH_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "9a" | # Co-occurring
                       outcome_phase_selfharm == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (
                        outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_SH_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (
                      outcome_phase_selfharm == "11a" |
                          outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_SH_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" | 
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "11a" | # Co-occurring
                       outcome_phase_selfharm == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (
                        outcome_phase_selfharm == "12b"|
                        outcome_phase_selfharm == "13a" |
                        outcome_phase_selfharm == "14b" |
                        outcome_phase_selfharm == "15a" |
                        outcome_phase_selfharm == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_SH_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (   outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_12b)



# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_SH_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "13a" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    (
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_SH_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b"  # Co-occurring outcome and exposure
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_SH_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                        outcome_phase_selfharm == "15a"  # Co-occurring outcome and exposure
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                      outcome_phase_selfharm == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_15a)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_SH_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                        outcome_phase_selfharm == "15a" |
                        outcome_phase_selfharm == "16b"
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_16b)
```

Self-harm & change in living situation
```{r Change in living situation exposure SH}
dat <- dat %>%
  mutate(living_situation_change_before_SH =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_SH_baseline == "To drop" |
                    living_situation_change_SH_1a == "To drop" |
                    living_situation_change_SH_1b == "To drop" |
                      living_situation_change_SH_2a == "To drop" |
                    living_situation_change_SH_2b == "To drop" |
                      living_situation_change_SH_3a == "To drop" |
                    living_situation_change_SH_3b == "To drop" |
                      living_situation_change_SH_4a == "To drop" |
                    living_situation_change_SH_4b == "To drop" |
                      living_situation_change_SH_5a == "To drop" |
                    living_situation_change_SH_6b == "To drop" |
                      living_situation_change_SH_7a == "To drop" |
                    living_situation_change_SH_8b == "To drop" |
                      living_situation_change_SH_9a == "To drop" |
                    living_situation_change_SH_10b == "To drop" |
                      living_situation_change_SH_11a == "To drop" |
                    living_situation_change_SH_12b == "To drop" |
                    living_situation_change_SH_13a == "To drop" |
                      living_situation_change_SH_14b == "To drop" |
                    living_situation_change_SH_15a == "To drop" |
                      living_situation_change_SH_16b == "To drop" | # Change in living situation after self-harm
                  
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" | # Missing whether change in living situation
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "To drop", # Missing whether experienced self-harm
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_SH_baseline == "Yes" |
                    living_situation_change_SH_1a == "Yes" |
                    living_situation_change_SH_1b == "Yes" |
                    living_situation_change_SH_2a == "Yes" |
                    living_situation_change_SH_2b == "Yes" |
                    living_situation_change_SH_3a == "Yes" |
                    living_situation_change_SH_3b == "Yes" |
                    living_situation_change_SH_4a == "Yes" |
                    living_situation_change_SH_4b == "Yes" |
                    living_situation_change_SH_5a == "Yes" |
                    living_situation_change_SH_6b == "Yes" |
                    living_situation_change_SH_7a == "Yes" |
                    living_situation_change_SH_8b == "Yes" |
                    living_situation_change_SH_9a == "Yes" |
                    living_situation_change_SH_10b == "Yes" |
                    living_situation_change_SH_11a == "Yes" |
                    living_situation_change_SH_12b == "Yes" |
                    living_situation_change_SH_13a == "Yes" |
                    living_situation_change_SH_14b == "Yes" |
                    living_situation_change_SH_15a == "Yes" |
                    living_situation_change_SH_16b == "Yes" ~ "Change in living situation before self-harm",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_SH_baseline == "No outcome" |
                    living_situation_change_SH_1a == "No outcome" |
                    living_situation_change_SH_1b == "No outcome" |
                    living_situation_change_SH_2a == "No outcome" |
                    living_situation_change_SH_2b == "No outcome" |
                    living_situation_change_SH_3a == "No outcome" |
                    living_situation_change_SH_3b == "No outcome" |
                    living_situation_change_SH_4a == "No outcome" |
                    living_situation_change_SH_4b == "No outcome" |
                    living_situation_change_SH_5a == "No outcome" |
                    living_situation_change_SH_6b == "No outcome" |
                    living_situation_change_SH_7a == "No outcome" |
                    living_situation_change_SH_8b == "No outcome" |
                    living_situation_change_SH_9a == "No outcome" |
                    living_situation_change_SH_10b == "No outcome" |
                    living_situation_change_SH_11a == "No outcome" |
                    living_situation_change_SH_12b == "No outcome" |
                    living_situation_change_SH_13a == "No outcome" |
                    living_situation_change_SH_14b == "No outcome" |
                    living_situation_change_SH_15a == "No outcome" |
                    living_situation_change_SH_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_selfharm != "Not answered or PNTA" &
                        outcome_phase_selfharm != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_selfharm  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_SH) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_SH_final =
           case_when(
              # Need to drop people who first experienced outcome before first experience of exposure
             # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
             # Need to drop people who never answered whether they'd experienced the outcome
             
             living_situation_change_before_SH == "To drop" ~ NA_character_,  
                     
                       living_situation_change_before_SH ==  "Outcome but no exposure" |
                     living_situation_change_before_SH ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_SH == "Exposure but no outcome" |
                    living_situation_change_before_SH == "Change in living situation before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_SH_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(living_situation_change_before_SH_final))
 
missing %>%
  filter(exposure_phase_living_situation_change != "Missing at every phase" &
          outcome_phase_selfharm != "Not answered or PNTA" &
           outcome_phase_selfharm != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_living_situation_change,
         outcome_phase_selfharm
         )
```

# Saving dataset
## Select & save variables needed for analysis
```{r Select final variables ready for regression analyses}
final_dat <- dat %>%
  select(ID,
         sample,
         # Outcome for eating disorder regressions (changed for sensitivity analysis, i.e,. no baseline)
         sens2_NEW_binge_eating_pandemic,
         sens2_NEW_low_weight_pandemic,
         
         # Outcome for self harm regressions  (changed for sensitivity analysis, i.e,. no baseline)
         sens2_NEW_harmful_ideation_pandemic,
         sens2_NEW_selfharm_pandemic,
       
         # Exposures in all models
         age_category_COVID_baseline,
         minoritised_gender,
         sex_binary,
         race_binary,
         highest_education,
         mental_health_diagnosis,
         increased_loneliness_during_pandemic,
         paid_employment_key_worker,
         vulnerable_group_member,
         panworry_total_score,
        
         # Exposures now changed for sensitivity analysis
         positive_covid_test_before_BE_final,
         positive_covid_test_before_LW_final,
         positive_covid_test_before_HI_final,
         positive_covid_test_before_SH_final,

        lost_someone_before_BE_final,
        lost_someone_before_LW_final,
        lost_someone_before_HI_final,
        lost_someone_before_SH_final,
        
        main_eco_change_before_BE_final,
        main_eco_change_before_LW_final,
        main_eco_change_before_HI_final,
        main_eco_change_before_SH_final,
        
        living_situation_change_before_BE_final,
        living_situation_change_before_LW_final,
        living_situation_change_before_HI_final,
        living_situation_change_before_SH_final,
        
        PREPANDEMIC_passive_suicidal_ideation,
        PREPANDEMIC_selfharm_ideation
        )
```

Save final dataset 
Save dataset
```{r save dataset}
saveRDS(object = final_dat,
       file = paste0(filepath_saved_data, "sens_dat_no_baseline", date, ".rds"))
```

