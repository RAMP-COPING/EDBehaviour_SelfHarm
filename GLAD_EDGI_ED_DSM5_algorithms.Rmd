---
title: "EDGI/GLAD (original) ED algorithms"
author: "Helena Davies"
date: "09/04/2021"
output: html_document
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

#### Call in library script

```{r source files}
source("./libraries.R")
```

#### Call in functions script

```{r source files}
source("./functions.R")
```

## Read in data - AN ED100K GLAD
```{r Read in data}

AN_symptom_data_GLAD <- readRDS(file = "../data_raw/glad/aan_glad_ed_c2.rds") #Add your data file here

#Check colnames
colnames(AN_symptom_data_GLAD)

#Check number of rows
nrow(AN_symptom_data_GLAD)
```


#Select columns
```{r Read in data}

exclude_cols_dem <- c("ID",
                      "cohort_name")

AN_symptom_data_GLAD.id <- AN_symptom_data_GLAD  %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "aan.1.eating_disorder_due_illness") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         aan.1.eating_disorder_due_illness,
         aan.1.what_was_the_illness.txt,
         aan.1.feel_fat_period_significant,
         aan.1.gain_weight_afraid_fat,
         aan.1.not_at_all_dependentcompletely_dependent,
         aan.1.health_negative_consequences_significant,
         aan.1.people_thought_larger_parts
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(AN_symptom_data_GLAD.id)
# Inspect colnames
colnames(AN_symptom_data_GLAD.id)
#Differences
dim(AN_symptom_data_GLAD)[1]-dim(AN_symptom_data_GLAD.id)[1]

```

## Read in data - AN ED100K EDGI 
```{r Read in data}

AN_symptom_data_EDGI <- readRDS(file = "../data_raw/edgi/aan_edgi_c2.rds") #Add your data file here

#Check colnames
colnames(AN_symptom_data_EDGI)

#Check number of rows
nrow(AN_symptom_data_EDGI)

```

#Select columns
```{r Read in data}

exclude_cols_dem <- c("ID",
                      "cohort_name")

AN_symptom_data_EDGI.id <- AN_symptom_data_EDGI %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "aan.1.eating_disorder_due_illness") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         aan.1.eating_disorder_due_illness,           
         aan.1.what_was_the_illness.txt,
         aan.1.feel_fat_period_significant,           
         aan.1.gain_weight_afraid_fat,                   
         aan.1.not_at_all_dependentcompletely_dependent,
         aan.1.health_negative_consequences_significant,
         aan.1.people_thought_larger_parts
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(AN_symptom_data_EDGI.id)
# Inspect colnames
colnames(AN_symptom_data_EDGI.id)
#Differences
dim(AN_symptom_data_EDGI)[1]-dim(AN_symptom_data_EDGI.id)[1]

```

## Read in data - BE ED100K GLAD
```{r Read in data}

BE_symptom_data_GLAD <- readRDS(file = "../data_raw/glad/be_glad_ed.rds") #Add your data file here

#Check colnames
colnames(BE_symptom_data_GLAD)

#Check number of rows
nrow(BE_symptom_data_GLAD)

```

#Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

BE_symptom_data_GLAD.id <- BE_symptom_data_GLAD  %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "be.short_period_ate_regard") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
         be.short_period_ate_regard,
         be.binge_eating_stop_eating,
         be.binge_eating_episodes_experience.txt,
         be.long_experience_regularly_occurring,
         be.long_experience_regularly_occurring.1,
         be.began_roughly_regular_episodes.txt,
         be.feel_distressed_episodes_eating,
         be.not_at_all_dependentcompletely_dependent,
         be.experience_regular_episodes_lowest,
         be.binge_eating_distressed_make,
         be.a_eat_much_more_rapidly_than_usual,
         be.a_eat_much_more_rapidly_than_usual.1,
         be.a_eat_much_more_rapidly_than_usual.2,
         be.b_eat_until_you_felt_uncomfortably_full,
         be.b_eat_until_you_felt_uncomfortably_full.1,
         be.rapidly_usual_eat,
         be.eat_felt_uncomfortably_full,
         be.didn39_food_eat_large,
         be.embarrassed_eat_eating.3,
         be.feel_ashamed_disgusted_guilty.3,
         be.control_feel_eating,
         be.shape_means_make_control,
         be.binge_eating_experience_episodes.txt,
         be.binge_eating_experience_episodes.txt.1,
         be.binge_eating_stopped_regular) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(BE_symptom_data_GLAD.id)
# Inspect colnames
colnames(BE_symptom_data_GLAD.id)
#Differences
dim(BE_symptom_data_GLAD.id)[1]-dim(BE_symptom_data_GLAD.id)[1]

```

## Read in data - BE ED100K EDGI
```{r Read in data}

BE_symptom_data_EDGI <- readRDS(file = "../data_raw/edgi/be_edgi.rds") #Add your data file here

#Check colnames
colnames(BE_symptom_data_EDGI)

#Check number of rows
nrow(BE_symptom_data_EDGI)
```

## Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

BE_symptom_data_EDGI.id <- BE_symptom_data_EDGI %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "edgi", .before = "be.short_period_ate_regard") %>% #create new column 
  select(
         ID = externalDataReference,# ID
        # cohort_name, # Sample
         be.short_period_ate_regard,
         be.binge_eating_stop_eating,
         be.binge_eating_episodes_experience.txt = be.follow_binge_eating_question.txt,
         be.long_experience_regularly_occurring,
         be.long_experience_regularly_occurring.1,
         be.began_roughly_regular_episodes.txt,
         be.feel_distressed_episodes_eating = be.feel_distressed_overeating_episodes,
         be.not_at_all_dependentcompletely_dependent,
         be.experience_regular_episodes_lowest,
         be.binge_eating_distressed_make,
         be.a_eat_much_more_rapidly_than_usual,
         be.a_eat_much_more_rapidly_than_usual.1,
         be.a_eat_much_more_rapidly_than_usual.2,
         be.b_eat_until_you_felt_uncomfortably_full,
         be.b_eat_until_you_felt_uncomfortably_full.1,
         be.rapidly_usual_eat,
         be.eat_felt_uncomfortably_full,
         be.didn39_food_eat_large,
         be.embarrassed_eat_eating.3,
         be.feel_ashamed_disgusted_guilty.3,
         be.control_feel_eating,
         be.shape_means_make_control,
         be.binge_eating_experience_episodes.txt.1 = be.binge_eating_experience_episodes.txt, 
         be.binge_eating_experience_episodes.txt = be.follow_binge_eating_question.txt.1,
         be.binge_eating_stopped_regular) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(BE_symptom_data_EDGI.id)
# Inspect colnames
colnames(BE_symptom_data_EDGI.id)
#Differences
dim(BE_symptom_data_EDGI.id)[1]-dim(BE_symptom_data_EDGI.id)[1]

```
## Read in data - ICB ED100K GLAD
```{r Read in data}

ICB_symptom_data_GLAD <- readRDS(file = "../data_raw/glad/icb_glad_ed.rds") #Add your data file here

#Check colnames
colnames(ICB_symptom_data_GLAD)

#Check number of rows
nrow(ICB_symptom_data_GLAD)
```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

ICB_symptom_data_GLAD.id <- ICB_symptom_data_GLAD %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "icb.b_used_laxatives") %>% #create new column 
  select(
         ID = externalDataReference,# ID
        # cohort_name, # Sample
         icb.b_used_laxatives,
         icb.b_used_laxatives.1,
         icb.b_used_laxatives.2, 
         icb.a_made_yourself_vomit,
         icb.a_made_yourself_vomit.1,
         icb.a_made_yourself_vomit.2,
         icb.engage_fasting_time_period,
         icb.engage_fasting_time_period.1,
         icb.fasted_time.txt,
         icb.time_diet_pills.txt,
         icb.long_time_period_diet,
         icb.long_time_period_diet.1,
         icb.body_shape_felt_compelled,
         icb.felt_uneasy_unable_distressed,
        # icb.friends_order_exercise_times,
         icb.injury_prevented_illness_exercised,
       #  icb.shape_compelled_unable_distressed.txt,
         icb.feel_compelled_felt_distressed,
         icb.feel_compelled_felt_distressed.1,
         icb.began_time_inducing_vomiting.txt,
         icb.engaging_long_time_period,
         icb.engaging_long_time_period.1,
         icb.laxatives_time.txt,
         icb.long_laxatives_time_period,
         icb.long_laxatives_time_period.1,
         icb.diuretics_time.txt,
         icb.long_diuretics_time_period,
         icb.long_diuretics_time_period.1,
         icb.making_yourself_vomit,
         icb.laxatives,
         icb.diuretics,
         icb.weight_loss_pills,
         icb.excessive_exercise,
         icb.fasting,
         icb.other_methods,
         icb.none_of_the_above,
         icb.making_yourself_vomit.1,
         icb.laxatives.1,
         icb.diuretics_water_pills,
         icb.weight_loss_pills.1,
         icb.excessive_exercise.1,
         icb.fasting.1,
         icb.other_methods.1,
         icb.none_of_the_above.1,
         icb.week_periods_induce_vomiting,
         icb.lasted_binge_eating_episodes,
         icb.eating_habits_modified_reason,
        # icb.compensate_state_binge_eating.txt,
         icb.state_methods_shape_control.txt,
         icb.month_periods_induce_vomiting,
         icb.year_periods_induce_vomiting,
         icb.3months_average_time_week,
         icb.wasthere_average_binge_engaged,
         icb.laxatives_week_periods,
         icb.month_laxatives_periods,
         icb.laxatives_year_periods,
         icb.diuretics_week_periods,
         icb.month_diuretics_periods,
         icb.diuretics_year_periods,
         icb.week_periods_diet_pills,
         icb.month_periods_diet_pills,
         icb.year_periods_diet_pills,
         icb.exercise_week_periods,
         icb.month_exercise_periods,
         icb.exercise_year_periods,
         icb.fast_week_periods,
       #  icb.month_fast_periods,
         icb.fast_year_periods
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ICB_symptom_data_GLAD.id)
# Inspect colnames
colnames(ICB_symptom_data_GLAD.id)
#Differences
dim(ICB_symptom_data_GLAD)[1]-dim(ICB_symptom_data_GLAD.id)[1]

```

## Read in data - ICB ED100K EDGI
```{r Read in data}

ICB_symptom_data_EDGI <- readRDS(file = "../data_raw/edgi/icb_edgi.rds") #Add your data file here

#Check colnames
colnames(ICB_symptom_data_EDGI)

#Check number of rows
nrow(ICB_symptom_data_EDGI)

```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

ICB_symptom_data_EDGI.id <- ICB_symptom_data_EDGI %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "edgi", .before = "icb.exercised_excessively.1") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
         icb.b_used_laxatives = icb.exercised_excessively.1,
         icb.b_used_laxatives.1 = icb.exercised_excessively.2,
         icb.b_used_laxatives.2 = icb.fasted_or_did_not_eat.2, 
         icb.a_made_yourself_vomit = icb.made_yourself_vomit.1,
         icb.a_made_yourself_vomit.1 = icb.any_other_methods_not_previously_listed,
         icb.a_made_yourself_vomit.2 = icb.any_other_methods_not_previously_listed.1,
         icb.engage_fasting_time_period = icb.engage_fasting_period_periods,
         icb.engage_fasting_time_period.1 = icb.engage_fasting_period_periods.1,
         icb.fasted_time.txt,
         icb.time_diet_pills.txt,
         icb.long_time_period_diet,
         icb.long_time_period_diet.1,
         icb.body_shape_felt_compelled,
         icb.felt_uneasy_unable_distressed,
       #  icb.friends_order_exercise_times = icb.order_friends_exercise_times,
         icb.injury_prevented_illness_exercised,
       #  icb.shape_compelled_unable_distressed.txt = icb.compelled_shape_unable_distressed.txt,
         icb.feel_compelled_felt_distressed,
         icb.feel_compelled_felt_distressed.1,
         icb.began_time_inducing_vomiting.txt = icb.time_induced_vomiting.txt,
         icb.engaging_long_time_period,
         icb.engaging_long_time_period.1,
         icb.laxatives_time.txt,
         icb.long_laxatives_time_period,
         icb.long_laxatives_time_period.1,
         icb.diuretics_time.txt,
         icb.long_diuretics_time_period,
         icb.long_diuretics_time_period.1,
         icb.making_yourself_vomit,
         icb.laxatives,
         icb.diuretics,
         icb.weight_loss_pills,
         icb.excessive_exercise,
         icb.fasting,
         icb.other_methods,
         icb.none_of_the_above = icb.none,
         icb.making_yourself_vomit.1,
         icb.laxatives.1,
         icb.diuretics_water_pills = icb.diuretics.1,
         icb.weight_loss_pills.1,
         icb.excessive_exercise.1,
         icb.fasting.1,
         icb.other_methods.1,
         icb.none_of_the_above.1 = icb.none.1,
         icb.week_periods_induce_vomiting,
         icb.lasted_binge_eating_episodes1 = icb.icb_bingeing_engage_months,
         icb.lasted_binge_eating_episodes2 = icb.icb_bingeing_engage_months.1,
         icb.lasted_binge_eating_episodes3 = icb.dont_know,
         icb.eating_habits_modified_reason,
        # icb.compensate_state_binge_eating.txt = icb.compensate_binge_eating_state.txt,
         icb.state_methods_shape_control.txt,
         icb.month_periods_induce_vomiting,
         icb.year_periods_induce_vomiting,
         icb.3months_average_time_week = icb.binge_eating_average_months,
         icb.wasthere_average_binge_engaged = icb.binge_eating_wasthere_made,
         icb.laxatives_week_periods,
         icb.month_laxatives_periods,
         icb.laxatives_year_periods,
         icb.diuretics_week_periods,
         icb.month_diuretics_periods,
         icb.diuretics_year_periods,
         icb.week_periods_diet_pills,
         icb.month_periods_diet_pills,
         icb.year_periods_diet_pills,
         icb.exercise_week_periods,
         icb.month_exercise_periods,
         icb.exercise_year_periods,
         icb.fast_week_periods,
        # icb.month_fast_periods = icb.fast_month_periods,
         icb.fast_year_periods
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ICB_symptom_data_EDGI.id)
# Inspect colnames
colnames(ICB_symptom_data_EDGI.id)
#Differences
dim(ICB_symptom_data_EDGI)[1]-dim(ICB_symptom_data_EDGI.id)[1]

```
## Read in data - demographics GLAD ED
```{r Read in data}

dem_GLAD_ED <- readRDS(file = "../data_raw/glad/demographics_glad_ed.rds") #Add your data file here

#Check colnames
colnames(dem_GLAD_ED)

#Check number of rows
nrow(dem_GLAD_ED)

```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

dem_GLAD_ED.id <- dem_GLAD_ED %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "demographics.what_was_your_biological_sex_at_birth") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
         demographics.what_was_your_biological_sex_at_birth,
         demographics.what_is_your_current_height,
         demographics.what_is_your_current_height.1,
         demographics.what_is_your_current_height.2,
         demographics.wearing_indoor_clothing_shoes,
         demographics.wearing_indoor_clothing_shoes.1,
         demographics.wearing_indoor_clothing_shoes.2,
         demographics.weighed,
         demographics.weighed.1,
         demographics.weighed.2,
         demographics.highest_weight_bmi,
         demographics.period,
         demographics.adult_height_reaching_weighed,
         demographics.adult_height_reaching_weighed.1,
         demographics.adult_height_reaching_weighed.2,
         demographics.adult_height_lowest_weight,
         demographics.please_select_your_preferred_units_of_measurement,
         demographics.what_is_your_bmi,
         demographics.what_is_your_highest_lifetime_bmi_,
         demographics.adult_height_lowest_bmi,
         demographics.have_you_had_your_first_period
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dem_GLAD_ED.id)
# Inspect colnames
colnames(dem_GLAD_ED.id)
#Differences
dim(dem_GLAD_ED)[1]-dim(dem_GLAD_ED.id)[1]

```

## Read in data - demographics EDGI 
```{r Read in data}

dem_EDGI_ED <- readRDS(file = "../data_raw/edgi/an_edgi.rds") #Add your data file here

#Check colnames
colnames(dem_EDGI_ED)

#Check number of rows
nrow(dem_EDGI_ED)

```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

dem_EDGI_ED.id <- dem_EDGI_ED %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "an.lowest_weight_people_thought") %>% #create new column 
  select(
         ID = externalDataReference,# ID
      #   cohort_name, # Sample
         an.lowest_weight_people_thought,
         an.how_old_were_you_then.txt,
         an.low_weight_time,
         an.low_weight_time.1,
         an.low_weight_time.2,
         an.gain_weight_low_weight,
         an.not_at_all_dependentcompletely_dependent,
         an.health_low_weight_bmi,
         an.feel_fat_low_weight,
         an.started_time_periods,
         an.periods_stop_low_weight,
         an.for_how_long_did_your_periods_stop,
         an.for_how_long_did_your_periods_stop.1,
         an.roughly_periods_stopped.txt,
         an.what_was_the_illness.txt,
         an.how_tall_were_you_then,
         an.how_tall_were_you_then.1,
         an.how_tall_were_you_then.2,
         an.people_thought_larger_low,
         an.bmi_low_time,
         an.anorexia_nervosa_low_weight,
         an.anorexia_nervosa_low_weight.1
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dem_EDGI_ED.id)
# Inspect colnames
colnames(dem_EDGI_ED.id)
#Differences
dim(dem_EDGI_ED)[1]-dim(dem_EDGI_ED.id)[1]

```

##Merge ICB and BED - GLAD
```{r}
dfs.list <- list(
 BE_symptom_data_GLAD.id,
  ICB_symptom_data_GLAD.id)

#Merge
dat.ed.GLAD.id <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(dat.ed.GLAD.id)

#Check columns
colnames(dat.ed.GLAD.id)
```

##Merge ICB and BED with AN - GLAD
```{r}
dfs.list <- list(
 dat.ed.GLAD.id,
  AN_symptom_data_GLAD.id)

#Merge
dat.ed.GLAD1 <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(dat.ed.GLAD1)

#Check columns
colnames(dat.ed.GLAD1)
```
##final - Merge ICB and BED and AN with GLAD demographics - GLAD
```{r}
dfs.list <- list(
 dat.ed.GLAD1,
  dem_GLAD_ED.id)

#Merge
dat.ed.GLAD <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(dat.ed.GLAD)

#Check columns
colnames(dat.ed.GLAD)
```

##Merge ICB and BED - EDGI
```{r}
dfs.list <- list(
 BE_symptom_data_EDGI.id,
  ICB_symptom_data_EDGI.id)

#Merge
ICB_BE_symptom_EDGI.id <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(ICB_BE_symptom_EDGI.id)

#Check columns
colnames(ICB_BE_symptom_EDGI.id)
```


##Merge ICB and BED with AN - EDGI
```{r}
dfs.list <- list(
  ICB_symptom_data_EDGI.id,
  AN_symptom_data_EDGI.id)

#Merge
dat.ed.EDGI1 <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(dat.ed.EDGI1)

#Check columns
colnames(dat.ed.EDGI1)
```


##Final - Merge ICB and BED and AN with EDGI demographics 
```{r}
dfs.list <- list(
 dat.ed.EDGI1,
  dem_EDGI_ED.id)

#Merge
dat.ed.EDGI <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(dat.ed.EDGI)

#Check columns
colnames(dat.ed.EDGI)
```


## Derived variables (GLAD + EDGI)

NB: Have written the algorithms separately (despite trying to merge the data) because of the different way these variables - icb.lasted_binge_eating_episodes1, icb.lasted_binge_eating_episodes2, icb.lasted_binge_eating_episodes3 - have been stored

#Work out BMI 
BMI = kg/m2 

##Weight in kg (EDGI)
```{r}

##First need all numeric variables (all are currently factor variables...)
dat.ed.EDGI$weight_stone <- as.numeric(dat.ed.EDGI$an.low_weight_time_numeric)

dat.ed.EDGI$weight_lbs <- as.numeric(dat.ed.EDGI$an.low_weight_time.1_numeric)

dat.ed.EDGI$weight_kg <- as.numeric(dat.ed.EDGI$an.low_weight_time.2_numeric)

##To convert stone to kg, multiply by 6.35029
dat.ed.EDGI$weight_kg_converted <- NA_real_

dat.ed.EDGI$weight_kg_converted <-
  if_else(condition = is.na(dat.ed.EDGI$weight_kg_converted), 
         true = (
           (dat.ed.EDGI$weight_stone*6.35029) + 
             (dat.ed.EDGI$weight_lbs*0.453592)
           ), #weight in st and lbs converted to kg
         false = NA_real_,
         missing = NA_real_)


# Kilograms
dat.ed.EDGI$weight_kg_unc <- 
  if_else(condition = is.na(dat.ed.EDGI$weight_kg_converted), 
         true = dat.ed.EDGI$weight_kg, #weight in kilos
         false = dat.ed.EDGI$weight_kg_converted,
         missing = NA_real_) 

# Summary
summary(dat.ed.EDGI$weight_kg_unc)

```
## Clean weight in kg (EDGI)
```{r}
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  weight_upper_limit = 150 
  weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.ed.EDGI$weight_kg_unc > weight_upper_limit |
        dat.ed.EDGI$weight_kg_unc < weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
      weight_kg_final =
        if_else(
          weight_kg_unc > weight_upper_limit |
            weight_kg_unc < weight_lower_limit,
          true = NA_real_,
          false = weight_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.EDGI %>%
    freq(weight_kg_final)

  
```


##Height in m (EDGI)
```{r}

##Change character variables to numeric / rename
dat.ed.EDGI$height_inches_numeric <- as.numeric(dat.ed.EDGI$an.how_tall_were_you_then.1_numeric)

dat.ed.EDGI$height_cm_numeric <- as.numeric(dat.ed.EDGI$an.how_tall_were_you_then.2_numeric)

dat.ed.EDGI$height_ft_numeric <- as.numeric(dat.ed.EDGI$an.how_tall_were_you_then)

# Feet and inches to metres
dat.ed.EDGI$height_m <- NA

dat.ed.EDGI$height_m <- 
  if_else(
    condition = is.na(dat.ed.EDGI$height_m),
    true = (
      (dat.ed.EDGI$height_ft_numeric*0.3048) +
      (dat.ed.EDGI$height_inches_numeric*0.0254)
       ),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.ed.EDGI$height_m_unc <- 
  if_else(
    condition = is.na(dat.ed.EDGI$height_m),
    true = dat.ed.EDGI$height_cm_numeric/100,
    false = dat.ed.EDGI$height_m)

# Summary
summary(dat.ed.EDGI$height_m_unc)
```

## Clean height in m (EDGI)
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.ed.EDGI$height_m_unc > height_upper_limit |
        dat.ed.EDGI$height_m_unc < height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
     height_m_final =
        if_else(
          height_m_unc > height_upper_limit |
            height_m_unc < height_lower_limit,
          true = NA_real_,
          false = height_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.EDGI %>%
    freq(height_m_final)
  
  
```

## Work out BMI (EDGI)
```{r}

# Calculated from height and weight **This should be based on min weight and height - have quite low values <10 - need to check
dat.ed.EDGI$bmi_unc <- NA

dat.ed.EDGI$bmi_unc <- 
  if_else(condition = is.na(dat.ed.EDGI$bmi_unc), 
         true = dat.ed.EDGI$weight_kg_final/dat.ed.EDGI$height_m_final^2, 
         false = NA_real_,
         missing = NA_real_)

# Summary
summary(dat.ed.EDGI$bmi_unc)

```

##Weight in kg (GLAD)
```{r}

##First need all numeric variables (all are currently factor variables...)
dat.ed.GLAD$weight_stone <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed_numeric)

dat.ed.GLAD$weight_lbs <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed.1_numeric)

dat.ed.GLAD$weight_kg <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed.2_numeric)

##To convert stone to kg, multiply by 6.35029
dat.ed.GLAD$weight_kg_converted <- NA_real_

dat.ed.GLAD$weight_kg_converted <-
  if_else(condition = is.na(dat.ed.GLAD$weight_kg_converted), 
         true = (
           (dat.ed.GLAD$weight_stone*6.35029) + 
             (dat.ed.GLAD$weight_lbs*0.453592)
           ), #weight in st and lbs converted to kg
         false = NA_real_,
         missing = NA_real_)


# Kilograms
dat.ed.GLAD$weight_kg_unc <- 
  if_else(condition = is.na(dat.ed.GLAD$weight_kg_converted), 
         true = dat.ed.GLAD$weight_kg, #weight in kilos
         false = dat.ed.GLAD$weight_kg_converted,
         missing = NA_real_) 

# Summary
summary(dat.ed.GLAD$weight_kg_unc)

```
## Clean weight in kg (GLAD)
```{r}
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  weight_upper_limit = 150 
  weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$weight_kg_unc > weight_upper_limit |
        dat.ed.GLAD$weight_kg_unc < weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
      weight_kg_final =
        if_else(
          weight_kg_unc > weight_upper_limit |
            weight_kg_unc < weight_lower_limit,
          true = NA_real_,
          false = weight_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(weight_kg_final)
  
  
```


##Height in m (GLAD)
```{r}

##Change character variables to numeric 

#NB*** This is CURRENT height, because the question about low weight is: 'What is the least you have ever weighed since reaching your adult height' rather than 'How much did you weigh at your lowest weight?' followed by 'how tall were you then?', so note that this would not capture low childhood BMI. GLAD is being updated to reflect EDGI so this will change.
dat.ed.GLAD$height_ft_numeric <- as.numeric(dat.ed.GLAD$demographics.what_is_your_current_height_numeric) 

dat.ed.GLAD$height_inches_numeric <- as.numeric(dat.ed.GLAD$demographics.what_is_your_current_height.1_numeric)

dat.ed.GLAD$height_cm_numeric <- as.numeric(dat.ed.GLAD$demographics.what_is_your_current_height.2_numeric)


# Feet and inches to metres
dat.ed.GLAD$height_m <- NA


dat.ed.GLAD$height_m <- 
  if_else(
    condition = is.na(dat.ed.GLAD$height_m),
    true = (
      (dat.ed.GLAD$height_ft_numeric*0.3048) +
      (dat.ed.GLAD$height_inches_numeric*0.0254)
       ),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.ed.GLAD$height_m_unc <- 
  if_else(
    condition = is.na(dat.ed.GLAD$height_m),
    true = dat.ed.GLAD$height_cm_numeric/100,
    false = dat.ed.GLAD$height_m)

# Summary
summary(dat.ed.GLAD$height_m_unc)
```

## Clean height in m (GLAD)
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$height_m_unc > height_upper_limit |
        dat.ed.GLAD$height_m_unc < height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
     height_m_final =
        if_else(
          height_m_unc > height_upper_limit |
            height_m_unc < height_lower_limit,
          true = NA_real_,
          false = height_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(height_m_final)
  
  
```

## Work out BMI (GLAD)
```{r}

# Calculated from height and weight **This should be based on min weight and height - have quite low values <10 - need to check
dat.ed.GLAD$bmi_unc <- NA

dat.ed.GLAD$bmi_unc <- 
  if_else(condition = is.na(dat.ed.GLAD$bmi_unc), 
         true = dat.ed.GLAD$weight_kg_final/dat.ed.GLAD$height_m_final^2, 
         false = NA_real_,
         missing = NA_real_)

# Summary
summary(dat.ed.GLAD$bmi_unc)

```


#BE Behaviour score - Number of BE behaviours [EDGI & GLAD]

##NB: Naming in data dictionary is wrong - use the following:
be.a_eat_much_more_rapidly_than_usual = a) Eat much more rapidly than usual?

be.a_eat_much_more_rapidly_than_usual.1 = b) Eat until you felt uncomfortably full?

be.a_eat_much_more_rapidly_than_usual.2 = c) Eat large amounts of food when you didnt feel physically hungry?

be.b_eat_until_you_felt_uncomfortably_full = d) Eat alone because you were embarrassed by what/how much you were eating?

be.b_eat_until_you_felt_uncomfortably_full.1 e) Feel ashamed/disgusted with yourself, depressed, or very guilty after overeating?


```{r ed.BE_behaviour_sum_numeric}

#Sum of binge eating behaviours - GLAD
dat.ed.GLAD.id$ed.BE_behaviour_sum_numeric <- rowSums(dat.ed.GLAD.id[ ,
                                 c("be.a_eat_much_more_rapidly_than_usual_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.1_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.2_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full.1_numeric")],
                                  na.rm = TRUE)

#Summary
freq(dat.ed.GLAD.id$ed.BE_behaviour_sum_numeric)         

colnames(dat.ed.GLAD.id)

#Sum of binge eating behaviours - EDGI
dat.ed.EDGI$ed.BE_behaviour_sum_numeric <- rowSums(dat.ed.EDGI[ ,
                                 c("be.a_eat_much_more_rapidly_than_usual_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.1_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.2_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full.1_numeric")],
                                  na.rm = TRUE)

#Summary
freq(dat.ed.EDGI$ed.BE_behaviour_sum_numeric)         

colnames(dat.ed.EDGI)
```

##Binge eating FREQUENCY
One year = 52.1429 weeks
One month = 4.34524 weeks 
```{r ed.BE_freq conversion}
#GLAD
dat.ed.GLAD.id$ed.BE_freq_per_week <- NA

# Calculate frequency per week - GLAD
dat.ed.GLAD.id$ed.BE_freq_per_week <- 
  with(dat.ed.GLAD.id,
    case_when(
      be.binge_eating_experience_episodes.txt.1_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt.1_numeric/52.1429, digits = 2),
      be.binge_eating_experience_episodes.txt_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt_numeric/4.34524, digits = 2), 
      be.binge_eating_episodes_experience.txt_numeric > 0 ~ be.binge_eating_episodes_experience.txt_numeric
      )
  )
  
#Summary
freq(dat.ed.GLAD.id$ed.BE_freq_per_week) 

#EDGI
dat.ed.EDGI$ed.BE_freq_per_week <- NA

# Calculate frequency per week - EDGI
dat.ed.EDGI$ed.BE_freq_per_week <- 
  with(dat.ed.EDGI,
    case_when(
      be.binge_eating_experience_episodes.txt.1_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt.1_numeric/52.1429, digits = 2),
      be.binge_eating_experience_episodes.txt_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt_numeric/4.34524, digits = 2), 
      be.binge_eating_episodes_experience.txt_numeric > 0 ~ be.binge_eating_episodes_experience.txt_numeric
      )
  )
  
#Summary
freq(dat.ed.EDGI$ed.BE_freq_per_week) 
```

#Binge eating DURATION
Converting to smallest unit first gives you more accurate estimates
One year = 365.25 days; One month = 30.4167 days
```{r ed.BE_duration conversion}

##GLAD
dat.ed.GLAD.id$ed.BE_duration_months <- NA

# Sum years and months into months
dat.ed.GLAD.id$ed.BE_duration_months <- 
  if_else(condition = is.na(dat.ed.GLAD.id$ed.BE_duration_months),
         true = ((dat.ed.GLAD.id$be.long_experience_regularly_occurring_numeric*365.25) + (dat.ed.GLAD.id$be.long_experience_regularly_occurring.1_numeric*30.4167)) / 30.4167, 
        false = NA_real_,
        missing = NA_real_)

# Summary
#freq(dat.ed.GLAD.id$ed.BE_duration_months)

##Change below 0 to NA
##Just temporary - all negative values should be cleaned when you select columns...
dat.ed.GLAD.id$ed.BE_duration_months[dat.ed.GLAD.id$ed.BE_duration_months < 0] <- NA_real_

# Check
#freq(dat.ed.GLAD.id$ed.BE_duration_months)


##EDGI
dat.ed.EDGI$ed.BE_duration_months <- NA

#Change to numeric
dat.ed.EDGI$be.duration_years_numeric <- as.numeric(dat.ed.EDGI$be.long_experience_regularly_occurring_numeric)

dat.ed.EDGI$be.duration_months_numeric <- as.numeric(dat.ed.EDGI$be.long_experience_regularly_occurring.1_numeric)

# Sum years and months into months
dat.ed.EDGI$ed.BE_duration_months <- 
  if_else(condition = is.na(dat.ed.EDGI$ed.BE_duration_months),
         true = ((dat.ed.EDGI$be.duration_years_numeric*365.25) + (dat.ed.EDGI$be.duration_months_numeric*30.4167)) / 30.4167, 
        false = NA_real_,
        missing = NA_real_)

# Summary
#freq(dat.ed.EDGI$ed.BE_duration_months)


##Change below 0 to NA
##Just temporary - all negative values should be cleaned when you select columns...
dat.ed.EDGI$ed.BE_duration_months[dat.ed.EDGI$ed.BE_duration_months < 0] <- NA_real_

# Check
#freq(dat.ed.EDGI$ed.BE_duration_months)
```


#DSM5 BED ALGORITHM - GLAD
```{r}

#BED numeric variable
dat.ed.GLAD.id$ed.DSM5_BED_binary_numeric <- 
  with(dat.ed.GLAD.id,
  dplyr::if_else(

    #A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:
#1)Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most people would eat in a similar period of time under similar circumstances
    be.short_period_ate_regard == "Yes" & 

      #2)A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating)
      (be.binge_eating_stop_eating == "Slightly" | #*** Should this be "slightly" for a more lenient algorithm? ***Difference between inclusion criteria and actual diagnositics?
       be.binge_eating_stop_eating == "Somewhat" |
       be.binge_eating_stop_eating == "Very" |
       be.binge_eating_stop_eating == "Extremely") & 

  #B. The binge-eating episodes are associated with three (or more) of the following:
#1. Eating much more rapidly than normal.
#2. Eating until feeling uncomfortably full.
#3. Eating large amounts of food when not feeling physically hungry.
#4. Eating alone because of feeling embarrassed by how much one is eating.
#5. Feeling disgusted with oneself, depressed, or very guilty afterward.
  ed.BE_behaviour_sum_numeric >= 3 & 

  #C. Marked distress regarding binge eating is present.       
  (be.binge_eating_distressed_make == "Slightly" |  #*** Should this be "slightly" for a more lenient algorithm? Difference between inclusion criteria and actual diagnositics?
         be.binge_eating_distressed_make == "Somewhat" |
         be.binge_eating_distressed_make == "Very" |
         be.binge_eating_distressed_make == "Extremely") & 

  #D. The binge eating occurs, on average, at least once a week for 3 months.
  (ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95) & # Binge eating total duration 

  #E. The binge eating is not associated with the recurrent use of inappropriate compensatory behavior as in bulimia nervosa... "Did you ever have periods of time that lasted three months or more when you had binge-eating episodes without regularly engaging in any of the following: making yourself vomit, laxative use, diuretic use, taking weight loss pills, excessively exercising ?"
  (icb.lasted_binge_eating_episodes == "Yes" | 
        icb.none_of_the_above.1 == "Yes"  |
     is.na(icb.lasted_binge_eating_episodes)) &  #***ask Molly about the logic of this question - does everyone get asked this?

  #...and does not occur exclusively during the course of bulimia nervosa or anorexia nervosa.  
  (be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" |
     be.experience_regular_episodes_lowest == "No" |
     is.na(be.experience_regular_episodes_lowest)),
    true = 1,
    false = 0,
    missing = NA_real_)
    )
    
#Recode numeric to factor
dat.ed.GLAD.id$ed.DSM5_BED_binary <-
  recode_factor(dat.ed.GLAD.id$ed.DSM5_BED_binary_numeric,
                "0" = "No DSM-5 BED",
                "1" = "DSM-5 BED")

#Summary
freq(dat.ed.GLAD.id$ed.DSM5_BED_binary)

```
#DSM5 BED ALGORITHM - EDGI
```{r}

#BED numeric variable
dat.ed.EDGI$ed.DSM5_BED_binary_numeric <- 
  with(dat.ed.EDGI,
  dplyr::if_else(

    #A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:
#1)Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most people would eat in a similar period of time under similar circumstances
    be.short_period_ate_regard == "Yes" & 

      #2)A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating)
      (be.binge_eating_stop_eating == "Slightly" | 
       be.binge_eating_stop_eating == "Somewhat" |
       be.binge_eating_stop_eating == "Very" |
       be.binge_eating_stop_eating == "Extremely") & 

  #B. The binge-eating episodes are associated with three (or more) of the following:
#1. Eating much more rapidly than normal.
#2. Eating until feeling uncomfortably full.
#3. Eating large amounts of food when not feeling physically hungry.
#4. Eating alone because of feeling embarrassed by how much one is eating.
#5. Feeling disgusted with oneself, depressed, or very guilty afterward.
  ed.BE_behaviour_sum_numeric >= 3 & 

  #C. Marked distress regarding binge eating is present.       
  (be.binge_eating_distressed_make == "Slightly" |  #*** Should this be "slightly" for a more lenient algorithm? Difference between inclusion criteria and actual diagnositics?
         be.binge_eating_distressed_make == "Somewhat" |
         be.binge_eating_distressed_make == "Very" |
         be.binge_eating_distressed_make == "Extremely") & 

  #D. The binge eating occurs, on average, at least once a week for 3 months.
  (ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95) & # Binge eating total duration 

  #E. The binge eating is not associated with the recurrent use of inappropriate compensatory behavior as in bulimia nervosa... "Did you ever have periods of time that lasted three months or more when you had binge-eating episodes without regularly engaging in any of the following: making yourself vomit, laxative use, diuretic use, taking weight loss pills, excessively exercising ?"
  (
  (
    icb.lasted_binge_eating_episodes1 == "Yes, 3 months DID NOT engage in ICB while bingeing" | 
        icb.none_of_the_above.1 == "Yes"
    ) |
  
  (
    is.na(icb.lasted_binge_eating_episodes1) & #***Is this right?
     is.na(icb.lasted_binge_eating_episodes2) &
     is.na(icb.lasted_binge_eating_episodes3)
     )
  ) & 

  #...and does not occur exclusively during the course of bulimia nervosa or anorexia nervosa.  
  (be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" |
     be.experience_regular_episodes_lowest == "No" |
     is.na(be.experience_regular_episodes_lowest)),
    true = 1,
    false = 0,
    missing = NA_real_)
    )
    
#Recode numeric to factor
dat.ed.EDGI$ed.DSM5_BED_binary <-
  recode_factor(dat.ed.EDGI$ed.DSM5_BED_binary_numeric,
                "0" = "No DSM-5 BED",
                "1" = "DSM-5 BED")

#Summary
freq(dat.ed.EDGI$ed.DSM5_BED_binary)

```

##DSM-5 BN ALGORITHM - GLAD

NB: ICBs mislabelled in data dictionary
icb.b_used_laxatives = Fasted or did not eat
icb.b_used_laxatives.1 = Used diet pills
icb.b_used_laxatives.2 = Exercised excessively
icb.a_made_yourself_vomit = Made yourself vomit
icb.a_made_yourself_vomit.1 = Used laxatives
icb.a_made_yourself_vomit.2 =  Used diuretics
```{r ed.BN_DSM5_binary}

#Bulimia nervosa numeric variable
dat.ed.GLAD.id$ed.DSM5_BN_binary_numeric <- 
  with(dat.ed.GLAD.id,
  dplyr::if_else(

#A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:

    #1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most individuals would eat in a similar period of time under similar circumstances.
    
    ##Have you ever had regular episodes of overeating or eating binges when you ate what most people would regard as an unusually large amount of food in a short period of time?
    be.short_period_ate_regard == "Yes" & 

      #2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).
      
      #When you were having regularly occurring episodes of binge eating or overeating, did you feel that your eating was out of control such that you felt you could not stop eating, or that you could not control what or how much you were eating?
      
        (
          be.binge_eating_stop_eating == "Slightly" | #**Check cut off!
         be.binge_eating_stop_eating == "Somewhat" |
         be.binge_eating_stop_eating == "Very" |
         be.binge_eating_stop_eating == "Extremely"
         ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs to control weight or shape, i.e. not necessarily in response to binge eating]
          (
            icb.a_made_yourself_vomit == "A few times" |  #Vomiting
          icb.a_made_yourself_vomit == "Often" | 
            
          icb.a_made_yourself_vomit.1 == "A few times" | #Laxtives
          icb.a_made_yourself_vomit.1 == "Often" |
            
          icb.a_made_yourself_vomit.2  == "A few times" | #Diuretics
          icb.a_made_yourself_vomit.2  =="Often" |
            
          icb.b_used_laxatives.1 == "A few times" | #Diet pills
          icb.b_used_laxatives.1 == "Often" |
            
          icb.b_used_laxatives.2 == "A few times" | #Excessive exercise
          icb.b_used_laxatives.2 == "Often" |
            
          icb.b_used_laxatives == "A few times" | #Fasting
          icb.b_used_laxatives == "Often"
          ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      (
        ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95 # Binge eating total duration 
      ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs in response to binge eating]
        (
          icb.making_yourself_vomit.1 == "Making yourself vomit" |
        icb.laxatives.1 == "Laxatives (including pills or liquids meant to stimulate bowel movements)" |
        icb.diuretics_water_pills == "Diuretics (water pills)" |
        icb.weight_loss_pills.1 == "Weight loss pills (over the counter or prescription)" |
        icb.excessive_exercise.1 == "Excessive exercise (e.g. feel compelled to exercise, feel uneasy or distressed if unable to exercise)" |
        icb.fasting.1 == "Fasting (not eating for 8 waking hours or more)"
        ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      
  #Did the binge eating and compensatory behaviours occur at the same time, on average, once a week for 3 months?
      
      (
        icb.3months_average_time_week == "Yes" | 
  is.na(icb.3months_average_time_week)
  ) & 

    #D. Self-evaluation is unduly influenced by body shape and weight.
         
    #During the time when you were binge eating, how dependent was your self-worth on your body shape or weight?
    (
    be.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    be.not_at_all_dependentcompletely_dependent == "2" | 
    be.not_at_all_dependentcompletely_dependent == "3" |
      be.not_at_all_dependentcompletely_dependent == "4" |
      be.not_at_all_dependentcompletely_dependent == "5" |
      be.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) &

    #E. The disturbance does not occur exclusively during episodes of anorexia nervosa.
        (
          be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" | 
         be.experience_regular_episodes_lowest == "No" |
         is.na(be.experience_regular_episodes_lowest)
         ),
    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric variable to factor
dat.ed.GLAD.id$ed.DSM5_BN_binary <-
  recode_factor(dat.ed.GLAD.id$ed.DSM5_BN_binary_numeric,
                "0" = "No DSM-5 BN",
                "1" = "DSM-5 BN")

#Summary
freq(dat.ed.GLAD.id$ed.DSM5_BN_binary)
```


##DSM-5 BN ALGORITHM - EDGI

NB: ICBs mislabelled in data dictionary

icb.exercised_excessively.1 = Fasted or did not eat
icb.exercised_excessively.2 = Used diet pills
icb.fasted_or_did_not_eat.2 = Exercised excessively
icb.made_yourself_vomit.1 = Made yourself vomit
icb.any_other_methods_not_previously_listed = Used laxatives
icb.any_other_methods_not_previously_listed.1 =  Used diuretics

```{r ed.BN_DSM5_binary}

#Bulimia nervosa numeric variable
dat.ed.EDGI$ed.DSM5_BN_binary_numeric <- 
  with(dat.ed.EDGI,
  dplyr::if_else(

#A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:

    #1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most individuals would eat in a similar period of time under similar circumstances.
    
    ##Have you ever had regular episodes of overeating or eating binges when you ate what most people would regard as an unusually large amount of food in a short period of time?
    be.short_period_ate_regard == "Yes" & 

      #2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).
      
      #When you were having regularly occurring episodes of binge eating or overeating, did you feel that your eating was out of control such that you felt you could not stop eating, or that you could not control what or how much you were eating?
      
        (
          be.binge_eating_stop_eating == "Slightly" | #**Check cut off!
         be.binge_eating_stop_eating == "Somewhat" |
         be.binge_eating_stop_eating == "Very" |
         be.binge_eating_stop_eating == "Extremely"
         ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs to control weight or shape, i.e. not necessarily in response to binge eating]
          (
            icb.a_made_yourself_vomit == "A few times" |  #Vomiting
          icb.a_made_yourself_vomit == "Often" | 
            
          icb.a_made_yourself_vomit.1 == "A few times" | #Laxtives
          icb.a_made_yourself_vomit.1 == "Often" |
            
          icb.a_made_yourself_vomit.2  == "A few times" | #Diuretics
          icb.a_made_yourself_vomit.2  =="Often" |
            
          icb.b_used_laxatives.1 == "A few times" | #Diet pills
          icb.b_used_laxatives.1 == "Often" |
            
          icb.b_used_laxatives.2 == "A few times" | #Excessive exercise
          icb.b_used_laxatives.2 == "Often" |
            
          icb.b_used_laxatives == "A few times" | #Fasting
          icb.b_used_laxatives == "Often"
          ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      (
        ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95 # Binge eating total duration 
      ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs in response to binge eating]
        (
          icb.making_yourself_vomit.1 == "Making yourself vomit" |
        icb.laxatives.1 == "Laxatives" |
        icb.diuretics_water_pills == "Diuretics" |
        icb.weight_loss_pills.1 == "Weight loss pills" |
        icb.excessive_exercise.1 == "Excessive exercise" |
        icb.fasting.1 == "Fasting"
        ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      
  #Did the binge eating and compensatory behaviours occur at the same time, on average, once a week for 3 months?
      
      (
        icb.3months_average_time_week == "Yes" | 
  is.na(icb.3months_average_time_week)
  ) & 

    #D. Self-evaluation is unduly influenced by body shape and weight.
         
    #During the time when you were binge eating, how dependent was your self-worth on your body shape or weight?
    (
    be.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    be.not_at_all_dependentcompletely_dependent == "2" | 
    be.not_at_all_dependentcompletely_dependent == "3" |
      be.not_at_all_dependentcompletely_dependent == "4" |
      be.not_at_all_dependentcompletely_dependent == "5" |
      be.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) &

    #E. The disturbance does not occur exclusively during episodes of anorexia nervosa.
        (
          be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" | 
         be.experience_regular_episodes_lowest == "No" |
         is.na(be.experience_regular_episodes_lowest)
         ),
    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric variable to factor
dat.ed.EDGI$ed.DSM5_BN_binary <-
  recode_factor(dat.ed.EDGI$ed.DSM5_BN_binary_numeric,
                "0" = "No DSM-5 BN",
                "1" = "DSM-5 BN")

#Summary
freq(dat.ed.EDGI$ed.DSM5_BN_binary)
```



#### DSM 5 AN restricting - EDGI

A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.

B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.

C. Disturbance in the way in which one’s body weight or shape is experienced, undueinfluence of body weight or shape on self-evaluation, or persistent lack of recognition of the seriousness of the current low body weight.

Subtype of DSM-5 AN; All DSM5 AN symptoms are met, but...

Restricting type: During the last 3 months, the individual has not engaged in recurrent episodes of binge eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas). This subtype describes presentations in which weight loss is accomplished primarily through dieting, fasting, and/or excessive exercise.

```{r}
dat.ed$ed.DSM5_AN_restricting_binary_numeric <- 
  with(dat.ed,
  dplyr::if_else(
#A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.
    (
      bmi_unc <= 18.55 |
       bmi_unc <= 18.55 |
       bmi_unc <= 18.55
      ) &
      
      
#When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
  an.1.lowest_weight_weigh_weighed == "No" &
 
#B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.
   
  #During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?
  (
        an.1.gain_weight_low_weight == "Slightly afraid" |
      an.1.gain_weight_low_weight == "Somewhat afraid" |
      an.1.gain_weight_low_weight == "Very afraid" |
      an.1.gain_weight_low_weight == "Extremely afraid"
      ) &


#C. Disturbance in the way in which one’s body weight or shape is experienced... 

  #During the time when you were at this low weight, did you still feel fat? 
  (
  (
    an.1.feel_fat_low_weight == "Slightly" | #***Check cut off!
     an.1.feel_fat_low_weight == "Somewhat" | 
     an.1.feel_fat_low_weight == "Very" |
     an.1.feel_fat_low_weight == "Extremely"
    ) |
    
  #During the time when you were at this low weight did you ever experience your body or parts of your body to be larger than they actually were or than other people thought they were?
  (
    an.1.body_larger_low_weight == "Somewhat" | 
     an.1.body_larger_low_weight == "Very much"
    ) |
  
#...undue influence of body weight or shape on self-evaluation
 
   #During the time when you were at this low weight, how dependent was your self-worth on your body shape or weight?
    (
    an.1.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    an.1.not_at_all_dependentcompletely_dependent == "2" | 
    an.1.not_at_all_dependentcompletely_dependent == "3" |
      an.1.not_at_all_dependentcompletely_dependent == "4" |
      an.1.not_at_all_dependentcompletely_dependent == "5" |
      an.1.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) |

#...or persistent lack of recognition of the seriousness of the current low body weight.
  
  #Did you ever think your low weight had negative consequences for your health?
      an.1.low_weight_health_negative == "Not at all"
) &

  #Restricting type: During the last 3 months... 
  
  #...the individual has not engaged in recurrent episodes of binge eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas)...

  #Did you experience regular episodes of binge eating while at your lowest weight?
  (
  (
    be.experience_regular_episodes_binge == "No" |
     is.na(be.experience_regular_episodes_binge) #***Perhaps don't include NA??
   ) & 

  ##During the period of time when you were at your lowest weight, did you use any of the following as a way to control yourweight or shape? .
  (
    icb.making_yourself_vomit.1 == "Not Making yourself vomit" |
     is.na(icb.making_yourself_vomit.1)
    ) & 

      (
    icb.laxatives.1 == "Not Laxatives"
   | is.na(icb.laxatives.1)
   ) &
  
  (icb.diuretics.1 == "Not Diuretics" |
     is.na(icb.diuretics.1)
   ) &  

  #...This subtype describes presentations in which weight loss is accomplished primarily through dieting, fasting, and/or excessive exercise.
  
    #During the period of time when you were at your lowest weight, did you use any of the following as a way to control yourweight or shape? .
    (
      icb.excessive_exercise.1 == "Excessive exercise" |
     icb.fasting.1 == "Fasting"
     )
  ),

    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric to factor
dat.ed$ed.DSM5_AN_restricting_binary <-
  recode_factor(dat.ed$ed.DSM5_AN_restricting_binary_numeric,
                "0" = "No DSM5 AN restricting",
                "1" = "DSM5 AN restricting"
                )

#Summary
freq(dat.ed$ed.DSM5_AN_restricting_binary)


#Check which cohort they are from
ANR_cases <- dat.ed %>%
  filter(ed.DSM5_AN_restricting_binary == "DSM5 AN restricting")

freq(ANR_cases$cohort_name)
```




## SELF-REPORTED DIAGNOSES ##


##GLAD MHD
```{r}
 glad.mhd.raw <- readRDS(file = "../data_raw/glad/mhd_glad.rds")
  dim(glad.mhd.raw)
  colnames(glad.mhd.raw)
```


##Select columns
```{r}
exclude_cols <- c("ID",
                  "cohort_name")

glad.mhd.raw.id <- glad.mhd.raw %>%
    drop_na(externalDataReference) %>% # Drop NAs
    distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
    #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
    # mutate(ID = as.numeric(ID)) %>%
    add_column(cohort_name = "glad", .before = "mhd.an") %>% #create new column 
    select(
      ID = externalDataReference, # ID
      cohort_name, # Sample
      mhd.anorexia_signup = mhd.an,
      mhd.bulimia_signup = mhd.bn,
      mhd.bed_signup = mhd.bed

    ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(glad.mhd.raw.id)
  # Inspect colnames
  colnames(glad.mhd.raw.id)
  #Differences
  dim(glad.mhd.raw)[1]-dim(glad.mhd.raw.id)[1]
```
##GLAD MHD
```{r}
edgi.mhd.raw <- readRDS(file = "../data_raw/edgi/mhd_edgi.rds")
  dim(edgi.mhd.raw)
  colnames(edgi.mhd.raw)
```

##Select columns
```{r}
exclude_cols <- c("ID",
                  "cohort_name")

edgi.mhd.raw.id <- edgi.mhd.raw %>%
    drop_na(externalDataReference) %>% # Drop NAs
    distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
    #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
    # mutate(ID = as.numeric(ID)) %>%
    add_column(cohort_name = "edgi", .before = "mhd.anorexia_nervosa") %>% #create new column 
    select(
      ID = externalDataReference, # ID
      cohort_name, # Sample
      mhd.anorexia_signup = mhd.anorexia_nervosa,
      mhd.bulimia_signup = mhd.bulimia_nervosa,
      mhd.bed_signup = mhd.bingeeating_disorder

    ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(glad.mhd.raw.id)
  # Inspect colnames
  colnames(glad.mhd.raw.id)
  #Differences
  dim(glad.mhd.raw)[1]-dim(glad.mhd.raw.id)[1]
```







