---
title: "EDGI/GLAD (original) ED algorithms"
author: "Helena Davies"
date: "09/04/2021"
output: html_document
---

This script identifies eating disorder cases within the EDGI and GLAD studies, both algorithm-derived or self-reported eating disorder diagnoses.

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

#### Call in library script

```{r source files}
source("./libraries.R")
```

#### Call in functions script

```{r source files}
source("./functions.R")
```

#Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

## Read in data - AN ED100K GLAD
```{r Read in data}

AAN_symptom_data_GLAD <- readRDS(file = "../data_raw/glad/aan_glad_ed_c2.rds") #Add your data file here

#Check colnames
colnames(AAN_symptom_data_GLAD)

#Check number of rows
nrow(AAN_symptom_data_GLAD)
```


#Select columns
```{r Read in data}

exclude_cols_dem <- c("ID",
                      "cohort_name")

AAN_symptom_data_GLAD.id <- AAN_symptom_data_GLAD  %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "aan.1.eating_disorder_due_illness") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         aan.1.eating_disorder_due_illness,
         aan.1.what_was_the_illness.txt,
         aan.1.feel_fat_period_significant,
         aan.1.gain_weight_afraid_fat,
         aan.1.not_at_all_dependentcompletely_dependent,
         aan.1.health_negative_consequences_significant,
         aan.1.people_thought_larger_parts
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(AAN_symptom_data_GLAD.id)
# Inspect colnames
colnames(AAN_symptom_data_GLAD.id)
#Differences
dim(AAN_symptom_data_GLAD)[1]-dim(AAN_symptom_data_GLAD.id)[1]

```

## Read in data - AN ED100K EDGI 
```{r Read in data}

AAN_symptom_data_EDGI <- readRDS(file = "../data_raw/edgi/aan_edgi_c2.rds") #Add your data file here

#Check colnames
colnames(AAN_symptom_data_EDGI)

#Check number of rows
nrow(AAN_symptom_data_EDGI)

```

#Select columns
```{r Read in data}

exclude_cols_dem <- c("ID",
                      "cohort_name")

AAN_symptom_data_EDGI.id <- AAN_symptom_data_EDGI %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "aan.1.eating_disorder_due_illness") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         aan.1.eating_disorder_due_illness,           
         aan.1.what_was_the_illness.txt,
         aan.1.feel_fat_period_significant,           
         aan.1.gain_weight_afraid_fat,                   
         aan.1.not_at_all_dependentcompletely_dependent,
         aan.1.health_negative_consequences_significant,
         aan.1.people_thought_larger_parts
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(AAN_symptom_data_EDGI.id)
# Inspect colnames
colnames(AAN_symptom_data_EDGI.id)
#Differences
dim(AAN_symptom_data_EDGI)[1]-dim(AAN_symptom_data_EDGI.id)[1]

```
## Read in data - EDGI DEMOGRAPHICS
```{r Read in data}

EDGI_dem <- readRDS(file = "../data_raw/edgi/demographics_edgi.rds") #Add your data file here

#Check colnames
colnames(EDGI_dem)

#Check number of rows
nrow(EDGI_dem)

```

#Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

EDGI_dem.id <- EDGI_dem  %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  #add_column(cohort_name = "glad", .before = "be.short_period_ate_regard") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
      demographics.what_is_your_current_height,
      demographics.what_is_your_current_height.1,
      demographics.what_is_your_current_height.2,
      demographics.pregnant_current_weight_provide,
      demographics.pregnant_current_weight_provide.1,
      demographics.pregnant_current_weight_provide.2,
      demographics.pregnant_provide_weighed_weight,
      demographics.pregnant_provide_weighed_weight.1,
      demographics.pregnant_provide_weighed_weight.2,
      demographics.highest_weight_bmi.txt,
      demographics.period.txt,
      demographics.adult_height_reaching_weighed,
      demographics.adult_height_reaching_weighed.1,
      demographics.adult_height_reaching_weighed.2,
      demographics.adult_height_lowest_weight.txt,
      demographics.pregnant_provide_bmi_weight
       ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(EDGI_dem.id)
# Inspect colnames
colnames(EDGI_dem.id)
#Differences
dim(EDGI_dem)[1]-dim(EDGI_dem.id)[1]

```

## Read in data - BE ED100K GLAD
```{r Read in data}

BE_symptom_data_GLAD <- readRDS(file = "../data_raw/glad/be_glad_ed.rds") #Add your data file here

#Check colnames
colnames(BE_symptom_data_GLAD)

#Check number of rows
nrow(BE_symptom_data_GLAD)

```

#Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

BE_symptom_data_GLAD.id <- BE_symptom_data_GLAD  %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "be.short_period_ate_regard") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
         be.short_period_ate_regard,
         be.binge_eating_stop_eating,
         be.binge_eating_episodes_experience.txt,
         be.long_experience_regularly_occurring,
         be.long_experience_regularly_occurring.1,
         be.began_roughly_regular_episodes.txt,
         be.feel_distressed_episodes_eating,
         be.not_at_all_dependentcompletely_dependent,
         be.experience_regular_episodes_lowest,
         be.binge_eating_distressed_make,
         be.a_eat_much_more_rapidly_than_usual,
         be.a_eat_much_more_rapidly_than_usual.1,
         be.a_eat_much_more_rapidly_than_usual.2,
         be.b_eat_until_you_felt_uncomfortably_full,
         be.b_eat_until_you_felt_uncomfortably_full.1,
         be.rapidly_usual_eat,
         be.eat_felt_uncomfortably_full,
         be.didn39_food_eat_large,
         be.embarrassed_eat_eating.3,
         be.feel_ashamed_disgusted_guilty.3,
         be.control_feel_eating,
         be.shape_means_make_control,
         be.binge_eating_experience_episodes.txt,
         be.binge_eating_experience_episodes.txt.1,
         be.binge_eating_stopped_regular) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(BE_symptom_data_GLAD.id)
# Inspect colnames
colnames(BE_symptom_data_GLAD.id)
#Differences
dim(BE_symptom_data_GLAD.id)[1]-dim(BE_symptom_data_GLAD.id)[1]

```

## Read in data - BE ED100K EDGI
```{r Read in data}

BE_symptom_data_EDGI <- readRDS(file = "../data_raw/edgi/be_edgi.rds") #Add your data file here

#Check colnames
colnames(BE_symptom_data_EDGI)

#Check number of rows
nrow(BE_symptom_data_EDGI)
```

## Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

BE_symptom_data_EDGI.id <- BE_symptom_data_EDGI %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "edgi", .before = "be.short_period_ate_regard") %>% #create new column 
  select(
         ID = externalDataReference,# ID
        # cohort_name, # Sample
         be.short_period_ate_regard,
         be.binge_eating_stop_eating,
         be.binge_eating_episodes_experience.txt = be.follow_binge_eating_question.txt,
         be.long_experience_regularly_occurring,
         be.long_experience_regularly_occurring.1,
         be.began_roughly_regular_episodes.txt,
         be.feel_distressed_episodes_eating = be.feel_distressed_overeating_episodes,
         be.not_at_all_dependentcompletely_dependent,
         be.experience_regular_episodes_lowest,
         be.binge_eating_distressed_make,
         be.a_eat_much_more_rapidly_than_usual,
         be.a_eat_much_more_rapidly_than_usual.1,
         be.a_eat_much_more_rapidly_than_usual.2,
         be.b_eat_until_you_felt_uncomfortably_full,
         be.b_eat_until_you_felt_uncomfortably_full.1,
         be.rapidly_usual_eat,
         be.eat_felt_uncomfortably_full,
         be.didn39_food_eat_large,
         be.embarrassed_eat_eating.3,
         be.feel_ashamed_disgusted_guilty.3,
         be.control_feel_eating,
         be.shape_means_make_control,
         be.binge_eating_experience_episodes.txt.1 = be.binge_eating_experience_episodes.txt, 
         be.binge_eating_experience_episodes.txt = be.follow_binge_eating_question.txt.1,
         be.binge_eating_stopped_regular) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(BE_symptom_data_EDGI.id)
# Inspect colnames
colnames(BE_symptom_data_EDGI.id)
#Differences
dim(BE_symptom_data_EDGI.id)[1]-dim(BE_symptom_data_EDGI.id)[1]

```
## Read in data - ICB ED100K GLAD
```{r Read in data}

ICB_symptom_data_GLAD <- readRDS(file = "../data_raw/glad/icb_glad_ed.rds") #Add your data file here

#Check colnames
colnames(ICB_symptom_data_GLAD)

#Check number of rows
nrow(ICB_symptom_data_GLAD)
```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

ICB_symptom_data_GLAD.id <- ICB_symptom_data_GLAD %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "icb.b_used_laxatives") %>% #create new column 
  select(
         ID = externalDataReference,# ID
        # cohort_name, # Sample
         icb.b_used_laxatives,
         icb.b_used_laxatives.1,
         icb.b_used_laxatives.2, 
         icb.a_made_yourself_vomit,
         icb.a_made_yourself_vomit.1,
         icb.a_made_yourself_vomit.2,
         icb.engage_fasting_time_period,
         icb.engage_fasting_time_period.1,
         icb.fasted_time.txt,
         icb.time_diet_pills.txt,
         icb.long_time_period_diet,
         icb.long_time_period_diet.1,
         icb.body_shape_felt_compelled,
         icb.felt_uneasy_unable_distressed,
        # icb.friends_order_exercise_times,
         icb.injury_prevented_illness_exercised,
       #  icb.shape_compelled_unable_distressed.txt,
         icb.feel_compelled_felt_distressed,
         icb.feel_compelled_felt_distressed.1,
         icb.began_time_inducing_vomiting.txt,
         icb.engaging_long_time_period,
         icb.engaging_long_time_period.1,
         icb.laxatives_time.txt,
         icb.long_laxatives_time_period,
         icb.long_laxatives_time_period.1,
         icb.diuretics_time.txt,
         icb.long_diuretics_time_period,
         icb.long_diuretics_time_period.1,
         icb.making_yourself_vomit,
         icb.laxatives,
         icb.diuretics,
         icb.weight_loss_pills,
         icb.excessive_exercise,
         icb.fasting,
         icb.other_methods,
         icb.none_of_the_above,
         icb.making_yourself_vomit.1,
         icb.laxatives.1,
         icb.diuretics_water_pills,
         icb.weight_loss_pills.1,
         icb.excessive_exercise.1,
         icb.fasting.1,
         icb.other_methods.1,
         icb.none_of_the_above.1,
         icb.week_periods_induce_vomiting,
         icb.lasted_binge_eating_episodes,
         icb.eating_habits_modified_reason,
        # icb.compensate_state_binge_eating.txt,
         icb.state_methods_shape_control.txt,
         icb.month_periods_induce_vomiting,
         icb.year_periods_induce_vomiting,
         icb.3months_average_time_week,
         icb.wasthere_average_binge_engaged,
         icb.laxatives_week_periods,
         icb.month_laxatives_periods,
         icb.laxatives_year_periods,
         icb.diuretics_week_periods,
         icb.month_diuretics_periods,
         icb.diuretics_year_periods,
         icb.week_periods_diet_pills,
         icb.month_periods_diet_pills,
         icb.year_periods_diet_pills,
         icb.exercise_week_periods,
         icb.month_exercise_periods,
         icb.exercise_year_periods,
         icb.fast_week_periods,
       #  icb.month_fast_periods,
         icb.fast_year_periods
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ICB_symptom_data_GLAD.id)
# Inspect colnames
colnames(ICB_symptom_data_GLAD.id)
#Differences
dim(ICB_symptom_data_GLAD)[1]-dim(ICB_symptom_data_GLAD.id)[1]

```

## Read in data - ICB ED100K EDGI
```{r Read in data}

ICB_symptom_data_EDGI <- readRDS(file = "../data_raw/edgi/icb_edgi.rds") #Add your data file here

#Check colnames
colnames(ICB_symptom_data_EDGI)

#Check number of rows
nrow(ICB_symptom_data_EDGI)

```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

ICB_symptom_data_EDGI.id <- ICB_symptom_data_EDGI %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "edgi", .before = "icb.exercised_excessively.1") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
         icb.b_used_laxatives = icb.exercised_excessively.1,
         icb.b_used_laxatives.1 = icb.exercised_excessively.2,
         icb.b_used_laxatives.2 = icb.fasted_or_did_not_eat.2, 
         icb.a_made_yourself_vomit = icb.made_yourself_vomit.1,
         icb.a_made_yourself_vomit.1 = icb.any_other_methods_not_previously_listed,
         icb.a_made_yourself_vomit.2 = icb.any_other_methods_not_previously_listed.1,
         icb.engage_fasting_time_period = icb.engage_fasting_period_periods,
         icb.engage_fasting_time_period.1 = icb.engage_fasting_period_periods.1,
         icb.fasted_time.txt,
         icb.time_diet_pills.txt,
         icb.long_time_period_diet,
         icb.long_time_period_diet.1,
         icb.body_shape_felt_compelled,
         icb.felt_uneasy_unable_distressed,
       #  icb.friends_order_exercise_times = icb.order_friends_exercise_times,
         icb.injury_prevented_illness_exercised,
       #  icb.shape_compelled_unable_distressed.txt = icb.compelled_shape_unable_distressed.txt,
         icb.feel_compelled_felt_distressed,
         icb.feel_compelled_felt_distressed.1,
         icb.began_time_inducing_vomiting.txt = icb.time_induced_vomiting.txt,
         icb.engaging_long_time_period,
         icb.engaging_long_time_period.1,
         icb.laxatives_time.txt,
         icb.long_laxatives_time_period,
         icb.long_laxatives_time_period.1,
         icb.diuretics_time.txt,
         icb.long_diuretics_time_period,
         icb.long_diuretics_time_period.1,
         icb.making_yourself_vomit,
         icb.laxatives,
         icb.diuretics,
         icb.weight_loss_pills,
         icb.excessive_exercise,
         icb.fasting,
         icb.other_methods,
         icb.none_of_the_above = icb.none,
         icb.making_yourself_vomit.1,
         icb.laxatives.1,
         icb.diuretics_water_pills = icb.diuretics.1,
         icb.weight_loss_pills.1,
         icb.excessive_exercise.1,
         icb.fasting.1,
         icb.other_methods.1,
         icb.none_of_the_above.1 = icb.none.1,
         icb.week_periods_induce_vomiting,
         icb.lasted_binge_eating_episodes1 = icb.icb_bingeing_engage_months,
         icb.lasted_binge_eating_episodes2 = icb.icb_bingeing_engage_months.1,
         icb.lasted_binge_eating_episodes3 = icb.dont_know,
         icb.eating_habits_modified_reason,
        # icb.compensate_state_binge_eating.txt = icb.compensate_binge_eating_state.txt,
         icb.state_methods_shape_control.txt,
         icb.month_periods_induce_vomiting,
         icb.year_periods_induce_vomiting,
         icb.3months_average_time_week = icb.binge_eating_average_months,
         icb.wasthere_average_binge_engaged = icb.binge_eating_wasthere_made,
         icb.laxatives_week_periods,
         icb.month_laxatives_periods,
         icb.laxatives_year_periods,
         icb.diuretics_week_periods,
         icb.month_diuretics_periods,
         icb.diuretics_year_periods,
         icb.week_periods_diet_pills,
         icb.month_periods_diet_pills,
         icb.year_periods_diet_pills,
         icb.exercise_week_periods,
         icb.month_exercise_periods,
         icb.exercise_year_periods,
         icb.fast_week_periods,
        # icb.month_fast_periods = icb.fast_month_periods,
         icb.fast_year_periods
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ICB_symptom_data_EDGI.id)
# Inspect colnames
colnames(ICB_symptom_data_EDGI.id)
#Differences
dim(ICB_symptom_data_EDGI)[1]-dim(ICB_symptom_data_EDGI.id)[1]

```
## Read in data - demographics GLAD ED
```{r Read in data}

dem_GLAD_ED <- readRDS(file = "../data_raw/glad/demographics_glad_ed.rds") #Add your data file here

#Check colnames
colnames(dem_GLAD_ED)

#Check number of rows
nrow(dem_GLAD_ED)

```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

dem_GLAD_ED.id <- dem_GLAD_ED %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "demographics.what_was_your_biological_sex_at_birth") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
         demographics.what_was_your_biological_sex_at_birth,
         demographics.what_is_your_current_height,
         demographics.what_is_your_current_height.1,
         demographics.what_is_your_current_height.2,
         demographics.wearing_indoor_clothing_shoes,
         demographics.wearing_indoor_clothing_shoes.1,
         demographics.wearing_indoor_clothing_shoes.2,
         demographics.weighed,
         demographics.weighed.1,
         demographics.weighed.2,
         demographics.highest_weight_bmi,
         demographics.period,
         demographics.adult_height_reaching_weighed,
         demographics.adult_height_reaching_weighed.1,
         demographics.adult_height_reaching_weighed.2,
         demographics.adult_height_lowest_weight,
         demographics.please_select_your_preferred_units_of_measurement,
         demographics.what_is_your_bmi,
         demographics.what_is_your_highest_lifetime_bmi_,
         demographics.adult_height_lowest_bmi,
         demographics.have_you_had_your_first_period
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dem_GLAD_ED.id)
# Inspect colnames
colnames(dem_GLAD_ED.id)
#Differences
dim(dem_GLAD_ED)[1]-dim(dem_GLAD_ED.id)[1]

```
## Read in data - AN GLAD
```{r Read in data}

AN_GLAD_ED <- readRDS(file = "../data_raw/glad/an_glad_ed.rds") #Add your data file here

#Check colnames
colnames(AN_GLAD_ED)

#Check number of rows
nrow(AN_GLAD_ED)

```
##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

AN_GLAD_ED.id <- AN_GLAD_ED %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
#  add_column(cohort_name = "glad", .before = "an.lowest_weight_people_thought") %>% #create new column 
  select(
         ID = externalDataReference,# ID
      an.lowest_weight_people_thought,
      an.how_old_were_you,
      an.low_time_weight,
      an.low_time_weight.1,
      an.low_time_weight.2,
      an.low_weight_long_bmi,
      an.low_weight_long_bmi.1,
      an.gain_weight_low_weight,
      an.not_at_all_dependentcompletely_dependent,
      an.health_low_weight_bmi,
      an.feel_fat_low_weight,
      an.started_time_periods,
      an.periods_stop_low_weight,
      an.for_how_long_did_your_periods_stop,
      an.for_how_long_did_your_periods_stop.1,
      an.roughly_periods_stopped.txt,
      an.what_was_the_illness.txt,
      an.how_tall_were_you_then,
      an.how_tall_were_you_then.1,
      an.how_tall_were_you_then.2,
      an.people_thought_larger_parts,
      an.bmi_low_time,
      an.suffered_eating_disorder_long,
      an.suffered_eating_disorder_long.1
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(AN_GLAD_ED.id )
# Inspect colnames
colnames(AN_GLAD_ED.id )
#Differences
dim(AN_GLAD_ED)[1]-dim(AN_GLAD_ED.id )[1]

```

## Read in data - AN EDGI 
```{r Read in data}

AN_EDGI_ED <- readRDS(file = "../data_raw/edgi/an_edgi.rds") #Add your data file here

#Check colnames
colnames(AN_EDGI_ED)

#Check number of rows
nrow(AN_EDGI_ED)

```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

AN_EDGI_ED.id <- AN_EDGI_ED %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
  add_column(cohort_name = "glad", .before = "an.lowest_weight_people_thought") %>% #create new column 
  select(
         ID = externalDataReference,# ID
      #   cohort_name, # Sample
         an.lowest_weight_people_thought,
         an.how_old_were_you_then.txt,
         an.low_weight_time,
         an.low_weight_time.1,
         an.low_weight_time.2,
         an.gain_weight_low_weight,
         an.not_at_all_dependentcompletely_dependent,
         an.health_low_weight_bmi,
         an.feel_fat_low_weight,
         an.started_time_periods,
         an.periods_stop_low_weight,
         an.for_how_long_did_your_periods_stop,
         an.for_how_long_did_your_periods_stop.1,
         an.roughly_periods_stopped.txt,
         an.what_was_the_illness.txt,
         an.how_tall_were_you_then,
         an.how_tall_were_you_then.1,
         an.how_tall_were_you_then.2,
         an.people_thought_larger_low,
         an.bmi_low_time,
         an.anorexia_nervosa_low_weight,
         an.anorexia_nervosa_low_weight.1
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(AN_EDGI_ED.id)
# Inspect colnames
colnames(AN_EDGI_ED.id)
#Differences
dim(AN_EDGI_ED)[1]-dim(AN_EDGI_ED.id)[1]

```

## Read in data - AN GLAD
```{r Read in data}

GLAD_signup_dem <- readRDS(file = "../data_raw/glad/dem_glad.rds") #Add your data file here

#Check colnames
colnames(GLAD_signup_dem )

#Check number of rows
nrow(GLAD_signup_dem )

```

##Select columns
```{r Read in data}

exclude_cols_dem <- c("ID")

GLAD_signup_dem.id <- GLAD_signup_dem %>% 
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE)  %>%
#  add_column(cohort_name = "glad", .before = "an.lowest_weight_people_thought") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         dem.current_weight_pregnant_weight,
         dem.current_weight_pregnant_weight.1,
         dem.current_weight_pregnant_weight.2,
         dem.what_is_your_current_height,
         dem.what_is_your_current_height.1,
         dem.what_is_your_current_height.2
         
         ) %>%
    add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(GLAD_signup_dem.id)
# Inspect colnames
colnames(GLAD_signup_dem.id)
#Differences
dim(GLAD_signup_dem)[1]-dim(GLAD_signup_dem.id)[1]

```


## SELF-REPORTED DIAGNOSES ##

GLAD has self-reported ED diagnoses in the following:
1) MHD questionnaire [glad.mhd.raw]
2) ED100K screener (optional) [glad_ed100k_an]

EDGI has self-reported ED diagnoses in the following:
1) MHD questionnaire (used as ED100K screener) [edgi_mhd]


##GLAD MHD
```{r}
 glad.mhd.raw <- readRDS(file = "../data_raw/glad/mhd_glad.rds")
  dim(glad.mhd.raw)
  colnames(glad.mhd.raw)
```

##Select columns
```{r}
exclude_cols <- c("ID",
                  "cohort_name")

glad.mhd.raw.id <- glad.mhd.raw %>%
    drop_na(externalDataReference) %>% # Drop NAs
    distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
    #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
    # mutate(ID = as.numeric(ID)) %>%
   # add_column(cohort_name = "glad", .before = "mhd.an") %>% #create new column 
    select(
      ID = externalDataReference, # ID
    #  cohort_name, # Sample
      mhd.anorexia_signup = mhd.an,
      mhd.bulimia_signup = mhd.bn,
      mhd.bed_signup = mhd.bed

    ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(glad.mhd.raw.id)
  # Inspect colnames
  colnames(glad.mhd.raw.id)
  #Differences
  dim(glad.mhd.raw)[1]-dim(glad.mhd.raw.id)[1]
```

##GLAD ED100K screener
```{r}
 glad.ED100K.screener.raw <- readRDS(file = "../data_raw/glad/an_glad_ed100k.rds")
  dim(glad.ED100K.screener.raw)
  colnames(glad.ED100K.screener.raw)
```

##Select columns
```{r}
exclude_cols <- c("ID")

glad.ED100K.screener.raw.id <- glad.ED100K.screener.raw %>%
    drop_na(externalDataReference) %>% # Drop NAs
    distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
    #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
    # mutate(ID = as.numeric(ID)) %>%
   # add_column(cohort_name = "g", .before = "mhd.an") %>% #create new column 
    select(
      ID = externalDataReference, # ID
    #  cohort_name, # Sample
    an.1.diagnosed_suspected_eating_disorder,
    an.1.eating_disorder_received_treatment,
    an.1.anorexia_nervosa,
    an.1.atypical_anorexia_nervosa,
    an.1.bulimia_nervosa,
    an.1.bingeeating_disorder,
    an.1.purging_disorder,
    an.1.night_eating_syndrome,
    an.1.pica,
    an.1.avoidantrestrictive_food_intake_disorder,
    an.1.rumination_disorder,
    an.1.other_eating_disorder,
    an.1.other_eating_disorder_text.txt,
    an.1.dont_know,
    an.1.prefer_not_to_answer,
    an.1.people_thought_weigh_weighed
    ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(glad.ED100K.screener.raw.id)
  # Inspect colnames
  colnames(glad.ED100K.screener.raw.id)
  #Differences
  dim(glad.ED100K.screener.raw)[1]-dim(glad.ED100K.screener.raw.id)[1]
```

##EDGI MHD
```{r}
edgi.mhd.raw <- readRDS(file = "../data_raw/edgi/mhd_edgi.rds")
  dim(edgi.mhd.raw)
  colnames(edgi.mhd.raw)
```

##Select columns
```{r}
exclude_cols <- c("ID")

edgi.mhd.raw.id <- edgi.mhd.raw %>%
    drop_na(externalDataReference) %>% # Drop NAs
    distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
    #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
    # mutate(ID = as.numeric(ID)) %>%
    #add_column(cohort_name = "edgi", .before = "mhd.anorexia_nervosa") %>% #create new column 
    select(
      ID = externalDataReference, # ID
     # cohort_name, # Sample
      mhd.anorexia_signup = mhd.anorexia_nervosa,
      mhd.bulimia_signup = mhd.bulimia_nervosa,
      mhd.bed_signup = mhd.bingeeating_disorder

    ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(glad.mhd.raw.id)
  # Inspect colnames
  colnames(glad.mhd.raw.id)
  #Differences
  dim(glad.mhd.raw)[1]-dim(glad.mhd.raw.id)[1]
```

##Merge data - GLAD
```{r}
dfs.list <- list(
 BE_symptom_data_GLAD.id,
  ICB_symptom_data_GLAD.id,
 AAN_symptom_data_GLAD.id,
 dem_GLAD_ED.id,
 AN_GLAD_ED.id,
 GLAD_signup_dem.id,
 glad.ED100K.screener.raw.id,
 glad.mhd.raw.id
 
 )

#Merge
dat.ed.GLAD <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(dat.ed.GLAD)

#Check columns
colnames(dat.ed.GLAD)
```


##Merge data - EDGI
```{r}
dfs.list <- list(
 BE_symptom_data_EDGI.id,
  ICB_symptom_data_EDGI.id,
 AAN_symptom_data_EDGI.id,
 AN_EDGI_ED.id,
 EDGI_dem.id,
 edgi.mhd.raw.id
 
 )

#Merge
dat.ed.EDGI <- plyr::join_all(dfs.list,
                                      by = c("ID"))


#Check rows
nrow(dat.ed.EDGI)

#Check columns
colnames(dat.ed.EDGI)
```

############# Derived variables (GLAD + EDGI) #################

NB: Have written the algorithms separately (despite trying to merge the data) because of the many different names of the variables 

#Work out lowest and current BMI 
BMI = kg/m2 


#EDGI BMI
EDGI has two reports of BMI that are relevant to this analysis.
1) Lowest BMI (lowest_bmi)
2) Current BMI (ed.bmi_current)


#Lowest BMI (EDGI)
##Lowest weight in kg (EDGI)
```{r}

##First need all numeric variables (all are currently factor variables...)
dat.ed.EDGI$low_weight_stone <- as.numeric(dat.ed.EDGI$an.low_weight_time_numeric)

dat.ed.EDGI$low_weight_lbs <- as.numeric(dat.ed.EDGI$an.low_weight_time.1_numeric)

dat.ed.EDGI$low_weight_kg <- as.numeric(dat.ed.EDGI$an.low_weight_time.2_numeric)

##To convert stone to kg, multiply by 6.35029
dat.ed.EDGI$low_weight_kg_converted <- NA_real_

dat.ed.EDGI$low_weight_kg_converted <-
  if_else(condition = is.na(dat.ed.EDGI$low_weight_kg_converted), 
         true = (
           (dat.ed.EDGI$low_weight_stone*6.35029) + 
             (dat.ed.EDGI$low_weight_lbs*0.453592)
           ), #weight in st and lbs converted to kg
         false = NA_real_,
         missing = NA_real_)


# Kilograms
dat.ed.EDGI$low_weight_kg_unc <- 
  if_else(condition = is.na(dat.ed.EDGI$low_weight_kg_converted), 
         true = dat.ed.EDGI$low_weight_kg, #weight in kilos
         false = dat.ed.EDGI$low_weight_kg_converted,
         missing = NA_real_) 

# Summary
summary(dat.ed.EDGI$low_weight_kg_unc)

```
## Clean lowest weight in kg (EDGI)
```{r}
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  low_weight_upper_limit = 150 
  low_weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.ed.EDGI$low_weight_kg_unc > low_weight_upper_limit |
        dat.ed.EDGI$low_weight_kg_unc < low_weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
      low_weight_kg_final =
        if_else(
          low_weight_kg_unc > low_weight_upper_limit |
            low_weight_kg_unc < low_weight_lower_limit,
          true = NA_real_,
          false = low_weight_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.EDGI %>%
    freq(low_weight_kg_final)

  
```

##Height at lowest weight in m (EDGI)
```{r}

##Change character variables to numeric / rename
dat.ed.EDGI$low_height_inches_numeric <- as.numeric(dat.ed.EDGI$an.how_tall_were_you_then.1_numeric)

dat.ed.EDGI$low_height_cm_numeric <- as.numeric(dat.ed.EDGI$an.how_tall_were_you_then.2_numeric)

dat.ed.EDGI$low_height_ft_numeric <- as.numeric(dat.ed.EDGI$an.how_tall_were_you_then)

# Feet and inches to metres
dat.ed.EDGI$low_height_m <- NA

dat.ed.EDGI$low_height_m <- 
  if_else(
    condition = is.na(dat.ed.EDGI$low_height_m),
    true = (
      (dat.ed.EDGI$low_height_ft_numeric*0.3048) +
      (dat.ed.EDGI$low_height_inches_numeric*0.0254)
       ),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.ed.EDGI$low_height_m_unc <- 
  if_else(
    condition = is.na(dat.ed.EDGI$low_height_m),
    true = dat.ed.EDGI$low_height_cm_numeric/100,
    false = dat.ed.EDGI$low_height_m)

# Summary
summary(dat.ed.EDGI$low_height_m_unc)
```

## Clean height at lowest weight in m (EDGI)
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  low_height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  low_height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.ed.EDGI$low_height_m_unc > low_height_upper_limit |
        dat.ed.EDGI$low_height_m_unc < low_height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
     low_height_m_final =
        if_else(
          low_height_m_unc > low_height_upper_limit |
            low_height_m_unc < low_height_lower_limit,
          true = NA_real_,
          false = low_height_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.EDGI %>%
    freq(low_height_m_final)
  
  
```

## Work out lowest BMI (EDGI)
```{r}

# Calculated from height and weight **This should be based on min weight and height - have quite low values <10 - need to check
dat.ed.EDGI$lowest_bmi <- NA

#Self-reported BMI
dat.ed.EDGI$lowest_bmi <- 
  if_else(condition = is.na(dat.ed.EDGI$lowest_bmi), 
         true = dat.ed.EDGI$an.bmi_low_time_numeric, # RAW BMI: How low did your BMI get during this time?
         false = NA_real_, 
         missing = NA_real_)

#Derived BMI
dat.ed.EDGI$lowest_bmi <- 
  if_else(condition = is.na(dat.ed.EDGI$lowest_bmi), 
         true = dat.ed.EDGI$low_weight_kg_final/dat.ed.EDGI$low_height_m_final^2, #From height and weight
         false = as.numeric(dat.ed.EDGI$lowest_bmi), 
         missing = NA_real_)

# Summary
summary(dat.ed.EDGI$lowest_bmi)

```

# Current BMI (EDGI)

## Current height (EDGI)
Conversion from feet to metres: 1 feet corresponds to 0.3048 metres
Conversion from inches to metres: 1 inch corresponds to 0.0254 metres
```{r ed.height_current conversion}
dat.ed.EDGI$ed.height_current_metres <- NA

#First, need numeric variables
dat.ed.EDGI$current_height_ft <- as.numeric(dat.ed.EDGI$demographics.what_is_your_current_height_numeric)

dat.ed.EDGI$current_height_inches <- as.numeric(dat.ed.EDGI$demographics.what_is_your_current_height.1_numeric)

dat.ed.EDGI$current_height_cm <- as.numeric(dat.ed.EDGI$demographics.what_is_your_current_height.2_numeric)

# Feet and inches to metres
dat.ed.EDGI$ed.height_current_metres <- 
  if_else(
    condition = is.na(dat.ed.EDGI$ed.height_current_metres),
    true = (dat.ed.EDGI$current_height_ft*0.3048) +
      (dat.ed.EDGI$current_height_inches*0.0254),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.ed.EDGI$ed.height_current_m_unc <- 
  if_else(
    condition = is.na(dat.ed.EDGI$ed.height_current_metres),
    true = dat.ed.EDGI$current_height_cm/100,
    false = dat.ed.EDGI$ed.height_current_metres)

# Summary
summary(dat.ed.EDGI$ed.height_current_m_unc)
```

## Clean current height in m (EDGI)
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.ed.EDGI$ed.height_current_m_unc > height_upper_limit |
      dat.ed.EDGI$ed.height_current_m_unc < height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
     current_height_m_final =
        if_else(
          ed.height_current_m_unc > height_upper_limit |
            ed.height_current_m_unc < height_lower_limit,
          true = NA_real_,
          false = ed.height_current_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.EDGI %>%
    freq(current_height_m_final)
  
  
```

#Current weight (EDGI)
Conversion from stone and lbs to kg: 1 stone corresponds to 6.35029 kg, 1 lb corresponds to 0.453592 kg
```{r ed.weight_current conversion}
dat.ed.EDGI$ed.weight_current_kg <- NA

#First, need numeric variables
dat.ed.EDGI$current_weight_st <- as.numeric(dat.ed.EDGI$demographics.pregnant_current_weight_provide_numeric)

dat.ed.EDGI$current_weight_lbs <- as.numeric(dat.ed.EDGI$demographics.pregnant_current_weight_provide.1_numeric)

dat.ed.EDGI$current_weight_kg <- as.numeric(dat.ed.EDGI$demographics.pregnant_current_weight_provide.2_numeric)

# Stones and pounds to kilogram
dat.ed.EDGI$ed.weight_current_kg <-
  if_else(condition = is.na(dat.ed.EDGI$ed.weight_current_kg), 
         true = (dat.ed.EDGI$current_weight_st*6.35029) + (dat.ed.EDGI$current_weight_lbs*0.453592),
         false = NA_real_,
         missing = NA_real_)

# Kilograms
dat.ed.EDGI$weight_current_kg_unc <- 
  if_else(condition = is.na(dat.ed.EDGI$ed.weight_current_kg), 
         true = dat.ed.EDGI$current_weight_kg,
         false = dat.ed.EDGI$ed.weight_current_kg,
         missing = NA_real_) 

# Summary
summary(dat.ed.EDGI$weight_current_kg_unc)
```

## Clean current weight in kg (EDGI)
```{r}
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
 current_weight_upper_limit = 150 
   current_weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.ed.EDGI$weight_current_kg_unc >  current_weight_upper_limit |
        dat.ed.EDGI$weight_current_kg_unc <  current_weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
      current_weight_kg_final =
        if_else(
          weight_current_kg_unc > current_weight_upper_limit |
            weight_current_kg_unc <  current_weight_lower_limit,
          true = NA_real_,
          false = weight_current_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.EDGI %>%
    freq(current_weight_kg_final)

  
```

#Current BMI (EDGI)
If participants have self-reported their BMI, we input these values into the new "ed.bmi_current" column.

For participants who have not self-reported their BMI, we calculate it using their height and weight: The BMI is defined as the body mass divided by the square of the body height, and is universally expressed in units of kg/mÂ², resulting from mass in kilograms and height in metres.
```{r ed.bmi_current conversion}
dat.ed.EDGI$ed.bmi_current <- NA

# Self-reported
dat.ed.EDGI$ed.bmi_current <- 
  if_else(condition = is.na(dat.ed.EDGI$ed.bmi_current), 
       true = dat.ed.EDGI$demographics.pregnant_provide_bmi_weight_numeric, #Raw BMI
       false = NA_real_,
       missing = NA_real_)

# Calculated from height and weight
dat.ed.EDGI$ed.bmi_current <- 
  if_else(condition = is.na(dat.ed.EDGI$ed.bmi_current), 
         true = dat.ed.EDGI$current_weight_kg_final/dat.ed.EDGI$current_height_m_final^2, #Derived BMI
         false = dat.ed.EDGI$ed.bmi_current,
         missing = NA_real_)

# Summary
summary(dat.ed.EDGI$ed.bmi_current)

```
#GLAD BMI

In GLAD, there are three reports of BMI.
1) Lowest BMI as reported in the signup (i.e., glad_ed_demographics) (low_dem_bmi)
2) Current BMI as reported in the signup (current_bmi)
3) Lowest BMI as reported in the optional ED100K (low_AN_bmi)


##Lowest BMI reported in demographic sign-up (GLAD)

1) Lowest BMI as reported in the signup (i.e., glad_ed_demographics) (low_dem_bmi)

###Lowest weight in kg (GLAD) from DEMOGRAPHICS (i.e., sign up)
```{r}

##First need all numeric variables (all are currently factor variables...)
dat.ed.GLAD$low_dem_weight_stone <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed_numeric)

dat.ed.GLAD$low_dem_weight_lbs <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed.1_numeric)

dat.ed.GLAD$low_dem_weight_kg <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed.2_numeric)

##To convert stone to kg, multiply by 6.35029
dat.ed.GLAD$low_dem_weight_kg_converted <- NA_real_

dat.ed.GLAD$low_dem_weight_kg_converted <-
  if_else(condition = is.na(dat.ed.GLAD$low_dem_weight_kg_converted), 
         true = (
           (dat.ed.GLAD$low_dem_weight_stone*6.35029) + 
             (dat.ed.GLAD$low_dem_weight_lbs*0.453592)
           ), #weight in st and lbs converted to kg
         false = NA_real_,
         missing = NA_real_)


# Kilograms
dat.ed.GLAD$low_dem_weight_kg_unc <- 
  if_else(condition = is.na(dat.ed.GLAD$low_dem_weight_kg_converted), 
         true = dat.ed.GLAD$low_dem_weight_kg, #weight in kilos
         false = dat.ed.GLAD$low_weight_kg_converted,
         missing = NA_real_) 

# Summary
summary(dat.ed.GLAD$low_dem_weight_kg_unc)

```

## Clean low dem weight in kg (GLAD) 
```{r }
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  low_dem_weight_upper_limit = 150 
  low_dem_weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$low_dem_weight_kg_unc > low_dem_weight_upper_limit |
        dat.ed.GLAD$low_dem_weight_kg_unc < low_dem_weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
      low_dem_weight_kg_final =
        if_else(
          low_dem_weight_kg_unc > low_dem_weight_upper_limit |
            low_dem_weight_kg_unc < low_dem_weight_lower_limit,
          true = NA_real_,
          false = low_dem_weight_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(low_dem_weight_kg_final)
  
  
```

##Current ED_DEM height in m (GLAD)
This is current height as captured in the glad_ed_demographics
```{r}

##Change character variables to numeric 

#NB*** This is CURRENT height, because the question about low weight is: 'What is the least you have ever weighed since reaching your adult height' rather than 'How much did you weigh at your lowest weight?' followed by 'how tall were you then?', so note that this would not capture low childhood BMI. GLAD is being updated to reflect EDGI so this will change.
dat.ed.GLAD$current_ed_height_ft_numeric <- as.numeric(dat.ed.GLAD$demographics.what_is_your_current_height_numeric) 

dat.ed.GLAD$current_ed_height_inches_numeric <- as.numeric(dat.ed.GLAD$demographics.what_is_your_current_height.1_numeric)

dat.ed.GLAD$current_ed_height_cm_numeric <- as.numeric(dat.ed.GLAD$demographics.what_is_your_current_height.2_numeric)


# Feet and inches to metres
dat.ed.GLAD$current_ed_height_m <- NA


dat.ed.GLAD$current_ed_height_m <- 
  if_else(
    condition = is.na(dat.ed.GLAD$current_ed_height_m),
    true = (
      (dat.ed.GLAD$current_ed_height_ft_numeric*0.3048) +
      (dat.ed.GLAD$current_ed_height_inches_numeric*0.0254)
       ),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.ed.GLAD$current_ed_height_m_unc <- 
  if_else(
    condition = is.na(dat.ed.GLAD$current_ed_height_m),
    true = dat.ed.GLAD$current_ed_height_cm_numeric/100,
    false = dat.ed.GLAD$current_ed_height_m)

# Summary
summary(dat.ed.GLAD$current_ed_height_m_unc)
```

## Clean current height in m (GLAD) 
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  current_ed_height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  current_ed_height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$current_ed_height_m_unc > current_ed_height_upper_limit |
        dat.ed.GLAD$current_ed_height_m_unc < current_ed_height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
     current_ed_height_m_final =
        if_else(
          current_ed_height_m_unc > current_ed_height_upper_limit |
            current_ed_height_m_unc < current_ed_height_lower_limit,
          true = NA_real_,
          false = current_ed_height_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(current_ed_height_m_final)
  
  
```

## Work out lowest dem BMI (GLAD)
```{r }

# Calculated from current height and lowest weight reported in the sign up **This should be based on min weight and height - have quite low values <10 - need to check
dat.ed.GLAD$low_dem_bmi <- NA

# Self-reported
dat.ed.GLAD$low_dem_bmi <- 
  if_else(condition = is.na(dat.ed.GLAD$low_dem_bmi), 
       true = as.numeric(dat.ed.GLAD$demographics.adult_height_lowest_bmi_numeric), #First fill with raw BMI responses
       false = NA_real_,
       missing = NA_real_)

# Calculated from height and weight
dat.ed.GLAD$low_dem_bmi <- 
  if_else(condition = is.na(dat.ed.GLAD$low_dem_bmi), 
         true = dat.ed.GLAD$low_dem_weight_kg_final/dat.ed.GLAD$current_ed_height_m_final^2, #Then fill with derived BMI from people's height and weight
         false = NA_real_,
         missing = NA_real_)

# Summary
summary(dat.ed.GLAD$low_dem_bmi)
```

2) Current BMI as reported in the GLAD signup (current_bmi)

##Current weight in kg (GLAD) from DEMOGRAPHICS (i.e., sign up)
```{r}

##First need all numeric variables (all are currently factor variables...)
dat.ed.GLAD$current_weight_stone <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed_numeric)

dat.ed.GLAD$current_weight_lbs <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed.1_numeric)

dat.ed.GLAD$current_weight_kg <- as.numeric(dat.ed.GLAD$demographics.adult_height_reaching_weighed.2_numeric)

##To convert stone to kg, multiply by 6.35029
dat.ed.GLAD$current_weight_kg_converted <- NA_real_

dat.ed.GLAD$current_weight_kg_converted <-
  if_else(condition = is.na(dat.ed.GLAD$current_weight_kg_converted), 
         true = (
           (dat.ed.GLAD$current_weight_stone*6.35029) + 
             (dat.ed.GLAD$current_weight_lbs*0.453592)
           ), #weight in st and lbs converted to kg
         false = NA_real_,
         missing = NA_real_)


# Kilograms
dat.ed.GLAD$current_weight_kg_unc <- 
  if_else(condition = is.na(dat.ed.GLAD$current_weight_kg_converted), 
         true = dat.ed.GLAD$current_weight_kg, #weight in kilos
         false = dat.ed.GLAD$current_weight_kg_converted,
         missing = NA_real_) 

# Summary
summary(dat.ed.GLAD$current_weight_kg_unc)

```

## Clean current weight in kg (GLAD) 
```{r }
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  current_dem_weight_upper_limit = 150 
  current_dem_weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$current_weight_kg_unc > current_dem_weight_upper_limit |
        dat.ed.GLAD$current_weight_kg_unc < current_dem_weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
      current_weight_kg =
        if_else(
          current_weight_kg_unc > current_dem_weight_upper_limit |
            current_weight_kg_unc < current_dem_weight_lower_limit,
          true = NA_real_,
          false = current_weight_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(current_weight_kg)
  
  
```


##Current DEM height in m (GLAD)
This is current height as captured in the GLAD demographics
```{r}

##Change character variables to numeric 

#NB*** This is CURRENT height, because the question about low weight is: 'What is the least you have ever weighed since reaching your adult height' rather than 'How much did you weigh at your lowest weight?' followed by 'how tall were you then?', so note that this would not capture low childhood BMI. GLAD is being updated to reflect EDGI so this will change.
dat.ed.GLAD$current_height_ft_numeric <- as.numeric(dat.ed.GLAD$dem.what_is_your_current_height.1_numeric) 

dat.ed.GLAD$current_height_inches_numeric <- as.numeric(dat.ed.GLAD$dem.what_is_your_current_height.2_numeric)

dat.ed.GLAD$current_height_cm_numeric <- as.numeric(dat.ed.GLAD$dem.what_is_your_current_height_numeric)


# Feet and inches to metres
dat.ed.GLAD$current_height_m <- NA


dat.ed.GLAD$current_height_m <- 
  if_else(
    condition = is.na(dat.ed.GLAD$current_height_m),
    true = (
      (dat.ed.GLAD$current_height_ft_numeric*0.3048) +
      (dat.ed.GLAD$current_height_inches_numeric*0.0254)
       ),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.ed.GLAD$current_height_m_unc <- 
  if_else(
    condition = is.na(dat.ed.GLAD$current_height_m),
    true = dat.ed.GLAD$current_height_cm_numeric/100,
    false = dat.ed.GLAD$current_height_m)

# Summary
summary(dat.ed.GLAD$current_height_m_unc)
```

## Clean current height in m (GLAD) 
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  current_height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  current_height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$current_height_m_unc > current_height_upper_limit |
        dat.ed.GLAD$current_height_m_unc < current_height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
     current_height_m_final =
        if_else(
          current_height_m_unc > current_height_upper_limit |
            current_height_m_unc < current_height_lower_limit,
          true = NA_real_,
          false = current_height_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(current_height_m_final)
  
  
```

## Work out current BMI as reported in the signup (GLAD)

The GLAD signup does not ask for current BMI
```{r }

# Calculated from current height and lowest weight reported in the sign up **This should be based on min weight and height - have quite low values <10 - need to check
dat.ed.GLAD$current_bmi <- NA

dat.ed.GLAD$current_bmi <- 
  if_else(condition = is.na(dat.ed.GLAD$current_bmi), 
         true = dat.ed.GLAD$current_weight_kg/dat.ed.GLAD$current_height_m_final^2, 
         false = NA_real_, #No raw BMI in GLAD signup, use only derived from height and weight
         missing = NA_real_)

# Summary
summary(dat.ed.GLAD$current_bmi)

```


3) Lowest BMI as reported in the optional ED100K (low_AN_bmi)

##Lowest weight in kg as reported in the AN module of the ED100K
```{r}

##First need all numeric variables (all are currently factor variables...)
dat.ed.GLAD$AN_low_weight_stone <- as.numeric(dat.ed.GLAD$an.low_time_weight_numeric)

dat.ed.GLAD$AN_low_weight_lbs <- as.numeric(dat.ed.GLAD$an.low_time_weight.1_numeric)

dat.ed.GLAD$AN_low_weight_kg <- as.numeric(dat.ed.GLAD$an.low_time_weight.2_numeric)

##To convert stone to kg, multiply by 6.35029
dat.ed.GLAD$AN_low_weight_kg_converted <- NA_real_

dat.ed.GLAD$AN_low_weight_kg_converted <-
  if_else(condition = is.na(dat.ed.GLAD$AN_low_weight_kg_converted), 
         true = (
           (dat.ed.GLAD$AN_low_weight_stone*6.35029) + 
             (dat.ed.GLAD$AN_low_weight_lbs*0.453592)
           ), #weight in st and lbs converted to kg
         false = NA_real_,
         missing = NA_real_)


# Kilograms
dat.ed.GLAD$AN_low_weight_kg_unc <- 
  if_else(condition = is.na(dat.ed.GLAD$AN_low_weight_kg_converted), 
         true = dat.ed.GLAD$AN_low_weight_kg, #weight in kilos
         false = dat.ed.GLAD$AN_low_weight_kg_converted,
         missing = NA_real_) 

# Summary
summary(dat.ed.GLAD$AN_low_weight_kg_unc)

```

## Clean lowest AN weight in kg (GLAD) 
```{r }
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  AN_low_weight_upper_limit = 150 
  AN_low_weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$current_weight_kg_unc > AN_low_weight_upper_limit |
        dat.ed.GLAD$current_weight_kg_unc < AN_low_weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
      AN_low_weight_kg =
        if_else(
          AN_low_weight_kg_unc > AN_low_weight_upper_limit |
            AN_low_weight_kg_unc < AN_low_weight_lower_limit,
          true = NA_real_,
          false = AN_low_weight_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(AN_low_weight_kg)
  
  
```


##Height at lowest weight GLAD ED100K
```{r}

##Change character variables to numeric 

dat.ed.GLAD$AN_low_height_ft_numeric <- as.numeric(dat.ed.GLAD$an.how_tall_were_you_then_numeric) 

dat.ed.GLAD$AN_low_height_inches_numeric <- as.numeric(dat.ed.GLAD$an.how_tall_were_you_then.1_numeric)

dat.ed.GLAD$AN_low_height_cm_numeric <- as.numeric(dat.ed.GLAD$an.how_tall_were_you_then.2_numeric)


# Feet and inches to metres
dat.ed.GLAD$AN_low_height_m <- NA


dat.ed.GLAD$AN_low_height_m <- 
  if_else(
    condition = is.na(dat.ed.GLAD$AN_low_height_m),
    true = (
      (dat.ed.GLAD$AN_low_height_ft_numeric*0.3048) +
      (dat.ed.GLAD$AN_low_height_inches_numeric*0.0254)
       ),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.ed.GLAD$AN_low_height_m_unc <- 
  if_else(
    condition = is.na(dat.ed.GLAD$AN_low_height_m),
    true = dat.ed.GLAD$AN_low_height_cm_numeric/100,
    false = dat.ed.GLAD$AN_low_height_m)

# Summary
summary(dat.ed.GLAD$AN_low_height_m_unc)
```

## Clean current height in m (GLAD) 
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  AN_low_height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  AN_low_height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.ed.GLAD$AN_low_height_m_unc > AN_low_height_upper_limit |
        dat.ed.GLAD$AN_low_height_m_unc < AN_low_height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
     AN_low_height_m_final =
        if_else(
          AN_low_height_m_unc > AN_low_height_upper_limit |
            AN_low_height_m_unc < AN_low_height_lower_limit,
          true = NA_real_,
          false = AN_low_height_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.ed.GLAD %>%
    freq(AN_low_height_m_final)
  
  
```

## Work out lowest BMI as reported in the ED100K (GLAD)
```{r }

dat.ed.GLAD$AN_low_bmi <- NA

# Self-reported
dat.ed.GLAD$AN_low_bmi <- 
  if_else(condition = is.na(dat.ed.GLAD$AN_low_bmi), 
       true = as.numeric(dat.ed.GLAD$an.bmi_low_time_numeric), #First fill with raw BMI responses
       false = NA_real_,
       missing = NA_real_)

#Derived
dat.ed.GLAD$AN_low_bmi <- 
  if_else(condition = is.na(dat.ed.GLAD$AN_low_bmi), 
         true = dat.ed.GLAD$AN_low_weight_kg/dat.ed.GLAD$AN_low_height_m_final^2, #Then with derived
         false = as.numeric(dat.ed.GLAD$AN_low_bmi),
         missing = NA_real_)

# Summary
summary(dat.ed.GLAD$AN_low_bmi)
```


#BE Behaviour score - Number of BE behaviours [EDGI & GLAD]

##NB: Naming in data dictionary is wrong - use the following:
be.a_eat_much_more_rapidly_than_usual = a) Eat much more rapidly than usual?

be.a_eat_much_more_rapidly_than_usual.1 = b) Eat until you felt uncomfortably full?

be.a_eat_much_more_rapidly_than_usual.2 = c) Eat large amounts of food when you didnt feel physically hungry?

be.b_eat_until_you_felt_uncomfortably_full = d) Eat alone because you were embarrassed by what/how much you were eating?

be.b_eat_until_you_felt_uncomfortably_full.1 e) Feel ashamed/disgusted with yourself, depressed, or very guilty after overeating?


```{r ed.BE_behaviour_sum_numeric}

#Sum of binge eating behaviours - GLAD
dat.ed.GLAD$ed.BE_behaviour_sum_numeric <- rowSums(dat.ed.GLAD[ ,
                                 c("be.a_eat_much_more_rapidly_than_usual_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.1_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.2_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full.1_numeric")],
                                  na.rm = TRUE)

#Summary
freq(dat.ed.GLAD$ed.BE_behaviour_sum_numeric)         

colnames(dat.ed.GLAD)

#Sum of binge eating behaviours - EDGI
dat.ed.EDGI$ed.BE_behaviour_sum_numeric <- rowSums(dat.ed.EDGI[ ,
                                 c("be.a_eat_much_more_rapidly_than_usual_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.1_numeric",
                                   "be.a_eat_much_more_rapidly_than_usual.2_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full_numeric",
                                   "be.b_eat_until_you_felt_uncomfortably_full.1_numeric")],
                                  na.rm = TRUE)

#Summary
freq(dat.ed.EDGI$ed.BE_behaviour_sum_numeric)         

colnames(dat.ed.EDGI)
```

##Binge eating FREQUENCY
One year = 52.1429 weeks
One month = 4.34524 weeks 
```{r ed.BE_freq conversion}
#GLAD
dat.ed.GLAD$ed.BE_freq_per_week <- NA

# Calculate frequency per week - GLAD
dat.ed.GLAD$ed.BE_freq_per_week <- 
  with(dat.ed.GLAD,
    case_when(
      be.binge_eating_experience_episodes.txt.1_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt.1_numeric/52.1429, digits = 2),
      be.binge_eating_experience_episodes.txt_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt_numeric/4.34524, digits = 2), 
      be.binge_eating_episodes_experience.txt_numeric > 0 ~ be.binge_eating_episodes_experience.txt_numeric
      )
  )
  
#Summary
freq(dat.ed.GLAD$ed.BE_freq_per_week) 

#EDGI
dat.ed.EDGI$ed.BE_freq_per_week <- NA

# Calculate frequency per week - EDGI
dat.ed.EDGI$ed.BE_freq_per_week <- 
  with(dat.ed.EDGI,
    case_when(
      be.binge_eating_experience_episodes.txt.1_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt.1_numeric/52.1429, digits = 2),
      be.binge_eating_experience_episodes.txt_numeric > 0 ~ round(be.binge_eating_experience_episodes.txt_numeric/4.34524, digits = 2), 
      be.binge_eating_episodes_experience.txt_numeric > 0 ~ be.binge_eating_episodes_experience.txt_numeric
      )
  )
  
#Summary
freq(dat.ed.EDGI$ed.BE_freq_per_week) 
```

#Binge eating DURATION
Converting to smallest unit first gives you more accurate estimates
One year = 365.25 days; One month = 30.4167 days
```{r ed.BE_duration conversion}

##GLAD
dat.ed.GLAD$ed.BE_duration_months <- NA

# Sum years and months into months
dat.ed.GLAD$ed.BE_duration_months <- 
  if_else(condition = is.na(dat.ed.GLAD$ed.BE_duration_months),
         true = ((dat.ed.GLAD$be.long_experience_regularly_occurring_numeric*365.25) + (dat.ed.GLAD$be.long_experience_regularly_occurring.1_numeric*30.4167)) / 30.4167, 
        false = NA_real_,
        missing = NA_real_)

# Summary
#freq(dat.ed.GLAD.id$ed.BE_duration_months)

##Change below 0 to NA
##Just temporary - all negative values should be cleaned when you select columns...
dat.ed.GLAD$ed.BE_duration_months[dat.ed.GLAD$ed.BE_duration_months < 0] <- NA_real_

# Check
#freq(dat.ed.GLAD.id$ed.BE_duration_months)


##EDGI
dat.ed.EDGI$ed.BE_duration_months <- NA

#Change to numeric
dat.ed.EDGI$be.duration_years_numeric <- as.numeric(dat.ed.EDGI$be.long_experience_regularly_occurring_numeric)

dat.ed.EDGI$be.duration_months_numeric <- as.numeric(dat.ed.EDGI$be.long_experience_regularly_occurring.1_numeric)

# Sum years and months into months
dat.ed.EDGI$ed.BE_duration_months <- 
  if_else(condition = is.na(dat.ed.EDGI$ed.BE_duration_months),
         true = ((dat.ed.EDGI$be.duration_years_numeric*365.25) + (dat.ed.EDGI$be.duration_months_numeric*30.4167)) / 30.4167, 
        false = NA_real_,
        missing = NA_real_)

# Summary
#freq(dat.ed.EDGI$ed.BE_duration_months)


##Change below 0 to NA
##Just temporary - all negative values should be cleaned when you select columns...
dat.ed.EDGI$ed.BE_duration_months[dat.ed.EDGI$ed.BE_duration_months < 0] <- NA_real_

# Check
#freq(dat.ed.EDGI$ed.BE_duration_months)
```



########## DSM-5 ED ALGORITHMS ###################


#### DSM 5 AN no subtype defined - GLAD 

A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.

B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.

C. Disturbance in the way in which oneâs body weight or shape is experienced, undueinfluence of body weight or shape on self-evaluation, or persistent lack of recognition of the seriousness of the current low body weight.

```{r }
dat.ed.GLAD$ed.DSM5_AN_binary_numeric <- 
  with(dat.ed.GLAD,
  dplyr::if_else(
#A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.
    (
      AN_low_bmi <= 18.55 | #Lowest BMI as reported in ED100K optional questionnaire
     current_bmi <= 18.55 | #Current BMI as reported in signup
       low_dem_bmi <= 18.55 #Lowest BMI as reported in signup
      ) &
      
      
#When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
 an.lowest_weight_people_thought == "No" &
 
#B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.
   
  #During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?
  (
       an.gain_weight_low_weight == "Slightly afraid" | #***Check cut off!
      an.gain_weight_low_weight == "Somewhat afraid" |
      an.gain_weight_low_weight == "Very afraid" |
      an.gain_weight_low_weight == "Extremely afraid"
      ) &


#C. Disturbance in the way in which oneâs body weight or shape is experienced... 

  #During the time when you were at this low weight, did you still feel fat? 
  (
  (
     an.feel_fat_low_weight== "Slightly" | #***Check cut off!
     an.feel_fat_low_weight == "Somewhat" | 
     an.feel_fat_low_weight == "Very" |
     an.feel_fat_low_weight == "Extremely"
    ) |
    
  #During the time when you were at this low weight did you ever experience your body or parts of your body to be larger than they actually were or than other people thought they were?
  (
    an.people_thought_larger_parts == "Somewhat" | 
     an.people_thought_larger_parts == "Very much"
    ) |
  
#...undue influence of body weight or shape on self-evaluation
 
   #During the time when you were at this low weight, how dependent was your self-worth on your body shape or weight?
    (
   an.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
     an.not_at_all_dependentcompletely_dependent == "2" | 
      an.not_at_all_dependentcompletely_dependent== "3" |
      an.not_at_all_dependentcompletely_dependent == "4" |
      an.not_at_all_dependentcompletely_dependent == "5" |
      an.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) |

#...or persistent lack of recognition of the seriousness of the current low body weight.
  
  #Did you ever think your low weight had negative consequences for your health?
     an.health_low_weight_bmi == "Not at all"
),

    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric to factor

dat.ed.GLAD$ed.DSM5_AN_binary <-
  recode_factor(dat.ed.GLAD$ed.DSM5_AN_binary_numeric,
                "0" = "No DSM5 AN",
                "1" = "DSM5 AN"
                )

#Summary
freq(dat.ed.GLAD$ed.DSM5_AN_binary)

```

#### DSM 5 AN restricting - GLAD 

A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.

B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.

C. Disturbance in the way in which oneâs body weight or shape is experienced, undueinfluence of body weight or shape on self-evaluation, or persistent lack of recognition of the seriousness of the current low body weight.

Subtype of DSM-5 AN; All DSM5 AN symptoms are met, but...

Restricting type: During the last 3 months, the individual has not engaged in recurrent episodes of binge eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas). This subtype describes presentations in which weight loss is accomplished primarily through dieting, fasting, and/or excessive exercise.
```{r }
dat.ed.GLAD$ed.DSM5_AN_restricting_binary_numeric <- 
  with(dat.ed.GLAD,
  dplyr::if_else(
#A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.
    (
      AN_low_bmi <= 18.55 | #Lowest BMI as reported in ED100K optional questionnaire
     current_bmi <= 18.55 | #Current BMI as reported in signup
       low_dem_bmi <= 18.55 #Lowest BMI as reported in signup
      ) &
      
      
#When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
 an.lowest_weight_people_thought == "No" &
 
#B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.
   
  #During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?
  (
       an.gain_weight_low_weight == "Slightly afraid" | #***Check cut off!
      an.gain_weight_low_weight == "Somewhat afraid" | 
      an.gain_weight_low_weight == "Very afraid" |
      an.gain_weight_low_weight == "Extremely afraid"
      ) &


#C. Disturbance in the way in which oneâs body weight or shape is experienced... 

  #During the time when you were at this low weight, did you still feel fat? 
  (
  (
     an.feel_fat_low_weight== "Slightly" | #***Check cut off!
     an.feel_fat_low_weight == "Somewhat" | 
     an.feel_fat_low_weight == "Very" |
     an.feel_fat_low_weight == "Extremely"
    ) |
    
  #During the time when you were at this low weight did you ever experience your body or parts of your body to be larger than they actually were or than other people thought they were?
  (
    an.people_thought_larger_parts == "Somewhat" | 
     an.people_thought_larger_parts == "Very much"
    ) |
  
#...undue influence of body weight or shape on self-evaluation
 
   #During the time when you were at this low weight, how dependent was your self-worth on your body shape or weight?
    (
   an.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
     an.not_at_all_dependentcompletely_dependent == "2" | 
      an.not_at_all_dependentcompletely_dependent== "3" |
      an.not_at_all_dependentcompletely_dependent == "4" |
      an.not_at_all_dependentcompletely_dependent == "5" |
      an.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) |

#...or persistent lack of recognition of the seriousness of the current low body weight.
  
  #Did you ever think your low weight had negative consequences for your health?
     an.health_low_weight_bmi == "Not at all"
) &

  #Restricting type: During the last 3 months... 
  
  #...the individual has not engaged in recurrent episodes of binge eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas)...

  #Did you experience regular episodes of binge eating while at your lowest weight?
  (
  (
     be.experience_regular_episodes_lowest == "No" |
     is.na(be.experience_regular_episodes_lowest) #***Perhaps don't include NA??
   ) & 

  ##During the period of time when you were at your lowest weight, did you use any of the following as a way to control yourweight or shape? .
  (
    icb.making_yourself_vomit == "Not Making yourself vomit" |
     is.na(icb.making_yourself_vomit)
    ) & 

  (
    icb.laxatives == "Not Laxatives" |
      is.na(icb.laxatives)
   ) &
  
  (
    icb.diuretics == "Not Diuretics" |
     is.na(icb.diuretics)
   ) &  

  #...This subtype describes presentations in which weight loss is accomplished primarily through dieting, fasting, and/or excessive exercise.
  
    #During the period of time when you were at your lowest weight, did you use any of the following as a way to control yourweight or shape? .
    (
      icb.excessive_exercise == "Excessive exercise (e.g. feel compelled to exercise, feel uneasy or distressed if unable to exercise)" |
     icb.fasting  == "Fasting (not eating for 8 waking hours or more)"
     )
  ),

    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric to factor

dat.ed.GLAD$ed.DSM5_AN_restricting_binary <-
  recode_factor(dat.ed.GLAD$ed.DSM5_AN_restricting_binary_numeric,
                "0" = "No DSM5 AN restricting",
                "1" = "DSM5 AN restricting"
                )

#Summary
freq(dat.ed.GLAD$ed.DSM5_AN_restricting_binary)

```
#### DSM 5 AN binge-eating/purging - GLAD 

A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.

B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.

C. Disturbance in the way in which oneâs body weight or shape is experienced, undueinfluence of body weight or shape on self-evaluation, or persistent lack of recognition of the seriousness of the current low body weight.

Subtype of DSM-5 AN; All DSM5 AN symptoms are met, but...

Binge eating/purging subtype: During the last 3 months, the individual has engaged in recurrent episodes of binge-eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas).
```{r }
dat.ed.GLAD$ed.DSM5_AN_binge_purge_binary_numeric <- 
  with(dat.ed.GLAD,
  dplyr::if_else(
#A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.
     (
       (
      AN_low_bmi <= 18.55 | #Lowest BMI as reported in ED100K optional questionnaire
     current_bmi <= 18.55 | #Current BMI as reported in signup
      low_dem_bmi <= 18.55 #Lowest BMI as reported in signup
      ) &
      
#When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
  an.lowest_weight_people_thought == "No" &
 
#B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.
   
  #During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?
  (
      an.gain_weight_low_weight == "Slightly afraid" | #***Check cut off!
      an.gain_weight_low_weight == "Somewhat afraid" |
      an.gain_weight_low_weight == "Very afraid" |
      an.gain_weight_low_weight == "Extremely afraid"
      ) &

#C. Disturbance in the way in which oneâs body weight or shape is experienced... 

  #During the time when you were at this low weight, did you still feel fat? 
(
  (
     an.feel_fat_low_weight== "Slightly" | #***Check cut off!
     an.feel_fat_low_weight == "Somewhat" | 
     an.feel_fat_low_weight == "Very" |
     an.feel_fat_low_weight == "Extremely"
    ) |
    
  #During the time when you were at this low weight did you ever experience your body or parts of your body to be larger than they actually were or than other people thought they were?
  (
     an.people_thought_larger_parts == "Somewhat" | 
     an.people_thought_larger_parts == "Very much"
    ) |
  
#...undue influence of body weight or shape on self-evaluation
 
   #During the time when you were at this low weight, how dependent was your self-worth on your body shape or weight?
    (
   an.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
     an.not_at_all_dependentcompletely_dependent == "2" | 
      an.not_at_all_dependentcompletely_dependent== "3" |
      an.not_at_all_dependentcompletely_dependent == "4" |
      an.not_at_all_dependentcompletely_dependent == "5" |
      an.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) |

#...OR persistent lack of recognition of the seriousness of the current low body weight.
  
  #Did you ever think your low weight had negative consequences for your health?
     an.health_low_weight_bmi == "Not at all"
) &

   ##Binge eating/purging subtype: During the last 3 months... 
  
 #...the individual has engaged in recurrent episodes of binge-eating... 
  
  #Did you experience regular episodes of binge eating while at your lowest weight?
  (
  (
     be.experience_regular_episodes_lowest == "only during times of low weight" |
     be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" |
      is.na(be.experience_regular_episodes_lowest)
     ) | 
      
      #...OR purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas).
      
      #During the period of time when you were at your lowest weight, did you use any of the following as a way to control your weight or shape?
      
  (
    icb.making_yourself_vomit == "Making yourself vomit" |
      icb.laxatives == "Laxatives" |
     icb.diuretics == "Diuretics"
    )
  )
),
#Not included absence of fasting and/or exercise because ANBP captures people who are restricting but ALSO binge and/or purge (on top of restricting behaviour)
    true = 1,
    false = 0,
    missing = NA_real_)
)
  
#Recode numeric to factor
dat.ed.GLAD$ed.DSM5_ANBP_binary <-
  recode_factor(dat.ed.GLAD$ed.DSM5_AN_binge_purge_binary_numeric,
                "0" = "No DSM5 AN binge eating/purging",
                "1" = "DSM5 AN binge eating/purging")


#Summary
freq(dat.ed.GLAD$ed.DSM5_ANBP_binary)

```

#### DSM 5 AN (no subtype defined) - EDGI

A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.

B. Intense fear of gaining weight or of becoming fat,or persistent behavior that interferes with weight gain, even though at a significantly low weight.

C. Disturbance in the way in which oneâs body weight or shape is experienced, undueinfluence of body weight or shape on self-evaluation, or persistent lack of recognition of the seriousness of the current low body weight.
```{r ed.AN_DSM5_binary}
#Anorexia nervosa numeric variable
dat.ed.EDGI$ed.DSM5_AN_binary_numeric <- 
  with(dat.ed.EDGI,
       dplyr::if_else(
#A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.
    (
      (
        ed.bmi_current <= 18.55 | #Current BMI
      lowest_bmi <= 18.55 #Lowest BMI
      ) & 
      
      
#When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
  an.lowest_weight_people_thought == "No" & #***Do we need this?
 
#B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.
   
  #During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?
  (
        an.gain_weight_low_weight == "Slightly afraid" | #***Check cut off!
      an.gain_weight_low_weight == "Somewhat afraid" |
      an.gain_weight_low_weight == "Very afraid" |
      an.gain_weight_low_weight == "Extremely afraid"
      ) &

#C. Disturbance in the way in which oneâs body weight or shape is experienced... 

  #During the time when you were at this low weight, did you still feel fat? 
  (
  (
    an.feel_fat_low_weight == "Slightly" | #***Check cut off!
     an.feel_fat_low_weight == "Somewhat" | 
     an.feel_fat_low_weight == "Very" |
     an.feel_fat_low_weight == "Extremely"
    ) |
    
  #During the time when you were at this low weight did you ever experience your body or parts of your body to be larger than they actually were or than other people thought they were?
  (
    an.people_thought_larger_low == "Somewhat" | 
     an.people_thought_larger_low == "Very much"
    ) |
  
#...undue influence of body weight or shape on self-evaluation
 
   #During the time when you were at this low weight, how dependent was your self-worth on your body shape or weight?
    (
    an.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    an.not_at_all_dependentcompletely_dependent == "2" | 
    an.not_at_all_dependentcompletely_dependent == "3" |
      an.not_at_all_dependentcompletely_dependent == "4" |
      an.not_at_all_dependentcompletely_dependent == "5" |
      an.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) |

#...or persistent lack of recognition of the seriousness of the current low body weight.
  
  #Did you ever think your low weight had negative consequences for your health?
      an.health_low_weight_bmi == "Not at all"
)
),
    true = 1,
    false = 0,
    missing = NA_real_)
)
  
  
#Recode numeric to factor
dat.ed.EDGI$ed.DSM5_AN_binary <-
  recode_factor(dat.ed.EDGI$ed.DSM5_AN_binary_numeric,
                "0" = "No DSM5 AN",
                "1" = "DSM5 AN"
                )

#Summary
freq(dat.ed.EDGI$ed.DSM5_AN_binary)
```

#### DSM 5 AN restricting - EDGI

A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.

B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.

C. Disturbance in the way in which oneâs body weight or shape is experienced, undueinfluence of body weight or shape on self-evaluation, or persistent lack of recognition of the seriousness of the current low body weight.

Subtype of DSM-5 AN; All DSM5 AN symptoms are met, but...

Restricting type: During the last 3 months, the individual has not engaged in recurrent episodes of binge eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas). This subtype describes presentations in which weight loss is accomplished primarily through dieting, fasting, and/or excessive exercise.
```{r}
dat.ed.EDGI$ed.DSM5_AN_restricting_binary_numeric <- 
  with(dat.ed.EDGI,
  dplyr::if_else(
#A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.
    (
      (
        ed.bmi_current <= 18.55 | #Current BMI
      lowest_bmi <= 18.55  #Lowest BMI
      ) &
      
#When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
  an.lowest_weight_people_thought == "No" & #***Do we need this?
 
#B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.
   
  #During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?
  (
        an.gain_weight_low_weight == "Slightly afraid" | #***Check cut off!
      an.gain_weight_low_weight == "Somewhat afraid" |
      an.gain_weight_low_weight == "Very afraid" |
      an.gain_weight_low_weight == "Extremely afraid"
      ) &


#C. Disturbance in the way in which oneâs body weight or shape is experienced... 

  #During the time when you were at this low weight, did you still feel fat? 
  (
  (
    an.feel_fat_low_weight == "Slightly" | #***Check cut off!
     an.feel_fat_low_weight == "Somewhat" | 
     an.feel_fat_low_weight == "Very" |
     an.feel_fat_low_weight == "Extremely"
    ) |
    
  #During the time when you were at this low weight did you ever experience your body or parts of your body to be larger than they actually were or than other people thought they were?
  (
    an.people_thought_larger_low == "Somewhat" | 
     an.people_thought_larger_low == "Very much"
    ) |
  
#...undue influence of body weight or shape on self-evaluation
 
   #During the time when you were at this low weight, how dependent was your self-worth on your body shape or weight?
    (
    an.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    an.not_at_all_dependentcompletely_dependent == "2" | 
    an.not_at_all_dependentcompletely_dependent == "3" |
      an.not_at_all_dependentcompletely_dependent == "4" |
      an.not_at_all_dependentcompletely_dependent == "5" |
      an.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) |

#...or persistent lack of recognition of the seriousness of the current low body weight.
  
  #Did you ever think your low weight had negative consequences for your health?
      an.health_low_weight_bmi == "Not at all"
) &

  #Restricting type: During the last 3 months... 
  
  #...the individual has not engaged in recurrent episodes of binge eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas)...

  #Did you experience regular episodes of binge eating while at your lowest weight?
  (
  (
  be.experience_regular_episodes_lowest == "No" |
     is.na(be.experience_regular_episodes_lowest) #***Perhaps don't include NA??
   ) & 

  ##During the period of time when you were at your lowest weight, didyou use any of the following as a way to control your weight or shape? .
  (
    icb.making_yourself_vomit == "Not Making yourself vomit" |
     is.na(icb.making_yourself_vomit)
    ) & 

      (
    icb.laxatives == "Not Laxatives"
   | is.na(icb.laxatives)
   ) &
  
  (icb.diuretics == "Not Diuretics" |
     is.na(icb.diuretics)
   ) &  

  #...This subtype describes presentations in which weight loss is accomplished primarily through dieting, fasting, and/or excessive exercise.
  
    #During the period of time when you were at your lowest weight, did you use any of the following as a way to control yourweight or shape? .
    (
      icb.excessive_exercise == "Excessive exercise" |
     icb.fasting == "Fasting"
     )
  )
),

    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric to factor
dat.ed.EDGI$ed.DSM5_AN_restricting_binary <-
  recode_factor(dat.ed.EDGI$ed.DSM5_AN_restricting_binary_numeric,
                "0" = "No DSM5 AN restricting",
                "1" = "DSM5 AN restricting"
                )

#Summary
freq(dat.ed.EDGI$ed.DSM5_AN_restricting_binary)

```

#### DSM 5 AN binge eating/purging - EDGI

A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.

B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.

C. Disturbance in the way in which oneâs body weight or shape is experienced, undueinfluence of body weight or shape on self-evaluation, or persistent lack of recognition of the seriousness of the current low body weight.

Subtype of DSM-5 AN; All DSM5 AN symptoms are met, but...

Binge eating/purging subtype: During the last 3 months, the individual has engaged in recurrent episodes of binge-eating or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas).
```{r}
dat.ed.EDGI$ed.DSM5_AN_binge_purge_binary_numeric <- 
  with(dat.ed.EDGI,
  dplyr::if_else(
#A. Restriction of energy intake relative to requirements,leading to a significantly low body weight in the context of age, sex, developmental trajectory, and physical health. Significantly low weight is defined as a weight that is less than minimally normal or, for children and adolescents, less than that minimally expected.
    (
      (ed.bmi_current <= 18.55 | #Current BMI
      lowest_bmi <= 18.55  #Lowest BMI
      ) &
      
#When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
  an.lowest_weight_people_thought == "No" &
 
#B. Intense fear of gaining weight or of becoming fat, or persistent behavior that interferes with weight gain, even though at a significantly low weight.
   
  #During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?
  (
        an.gain_weight_low_weight == "Slightly afraid" | #***Check cut off!
      an.gain_weight_low_weight == "Somewhat afraid" |
      an.gain_weight_low_weight == "Very afraid" |
      an.gain_weight_low_weight == "Extremely afraid"
      ) &


#C. Disturbance in the way in which oneâs body weight or shape is experienced... 

  #During the time when you were at this low weight, did you still feel fat? 
  (
  (
    an.feel_fat_low_weight == "Slightly" | #***Check cut off!
     an.feel_fat_low_weight == "Somewhat" | 
     an.feel_fat_low_weight == "Very" |
     an.feel_fat_low_weight == "Extremely"
    ) |
    
  #During the time when you were at this low weight did you ever experience your body or parts of your body to be larger than they actually were or than other people thought they were?
  (
    an.people_thought_larger_low == "Somewhat" | 
     an.people_thought_larger_low == "Very much"
    ) |
  
#...undue influence of body weight or shape on self-evaluation
 
   #During the time when you were at this low weight, how dependent was your self-worth on your body shape or weight?
    (
    an.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    an.not_at_all_dependentcompletely_dependent == "2" | 
    an.not_at_all_dependentcompletely_dependent == "3" |
      an.not_at_all_dependentcompletely_dependent == "4" |
      an.not_at_all_dependentcompletely_dependent == "5" |
      an.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) |

#...or persistent lack of recognition of the seriousness of the current low body weight.
  
  #Did you ever think your low weight had negative consequences for your health?
      an.health_low_weight_bmi == "Not at all"
) &
  
  ##Binge eating/purging subtype: During the last 3 months... 
  
  #...the individual has engaged in recurrent episodes of binge-eating... 
  
  #Did you experience regular episodes of binge eating while at your lowest weight?
  (
    (be.experience_regular_episodes_lowest == "only during times of low weight" |
     be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" |
      is.na(be.experience_regular_episodes_lowest)
     ) | 
      
      #...or purging behavior (i.e., self-induced vomiting or the misuse of laxatives, diuretics, or enemas).
      
      #During the period of time when you were at your lowest weight, did you use any of the following as a way to control your weight or shape?
      
  (
    icb.making_yourself_vomit == "Making yourself vomit" |
      icb.laxatives == "Laxatives" |
     icb.diuretics == "Diuretics"
    )
  )
),

#Not included absence of fasting and/or exercise because ANBP captures people who are restricting but ALSO binge and/or purge (on top of restricting behaviour)
    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric to factor
dat.ed.EDGI$ed.DSM5_ANBP_binary <-
  recode_factor(dat.ed.EDGI$ed.DSM5_AN_binge_purge_binary_numeric,
                "0" = "No DSM5 AN binge eating/purging",
                "1" = "DSM5 AN binge eating/purging")


#Summary
freq(dat.ed.EDGI$ed.DSM5_ANBP_binary)

```

#DSM5 BED ALGORITHM - GLAD
A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:
  1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most people would eat in a similar period of time under similar circumstances.

2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).

B. The binge-eating episodes are associated with three (or more) of the following:
  1. Eating much more rapidly than normal.
  2. Eating until feeling uncomfortably full.
  3. Eating large amounts of food when not feeling physically hungry.
  4. Eating alone because of feeling embarrassed by how much one is eating.
  5. Feeling disgusted with oneself, depressed, or very guilty afterward.

C. Marked distress regarding binge eating is present.

D. The binge eating occurs, on average, at least once a week for 3 months.

E. The binge eating is not associated with the recurrent use of inappropriate compensatory behavior as in bulimia nen/osa and does not occur exclusively during the course of bulimia nervosa or anorexia nervosa.
```{r}

#BED numeric variable
dat.ed.GLAD$ed.DSM5_BED_binary_numeric <- 
  with(dat.ed.GLAD,
  dplyr::if_else(

    #A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:
#1)Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most people would eat in a similar period of time under similar circumstances
    be.short_period_ate_regard == "Yes" & 

      #2)A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating)
      (be.binge_eating_stop_eating == "Slightly" | #*** Should this be "slightly" for a more lenient algorithm? ***Difference between inclusion criteria and actual diagnositics?
       be.binge_eating_stop_eating == "Somewhat" |
       be.binge_eating_stop_eating == "Very" |
       be.binge_eating_stop_eating == "Extremely") & 

  #B. The binge-eating episodes are associated with three (or more) of the following:
#1. Eating much more rapidly than normal.
#2. Eating until feeling uncomfortably full.
#3. Eating large amounts of food when not feeling physically hungry.
#4. Eating alone because of feeling embarrassed by how much one is eating.
#5. Feeling disgusted with oneself, depressed, or very guilty afterward.
  ed.BE_behaviour_sum_numeric >= 3 & 

  #C. Marked distress regarding binge eating is present.       
  (be.binge_eating_distressed_make == "Slightly" |  #*** Should this be "slightly" for a more lenient algorithm? Difference between inclusion criteria and actual diagnositics?
         be.binge_eating_distressed_make == "Somewhat" |
         be.binge_eating_distressed_make == "Very" |
         be.binge_eating_distressed_make == "Extremely") & 

  #D. The binge eating occurs, on average, at least once a week for 3 months.
  (ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95) & # Binge eating total duration 

  #E. The binge eating is not associated with the recurrent use of inappropriate compensatory behavior as in bulimia nervosa... "Did you ever have periods of time that lasted three months or more when you had binge-eating episodes without regularly engaging in any of the following: making yourself vomit, laxative use, diuretic use, taking weight loss pills, excessively exercising ?"
  (
    icb.lasted_binge_eating_episodes == "Yes" | 
        icb.none_of_the_above.1 == "Yes"  |
     is.na(icb.lasted_binge_eating_episodes)
   ) &  #***ask Molly about the logic of this question - does everyone get asked this?

  #...and does not occur exclusively during the course of bulimia nervosa or anorexia nervosa.  
  (
    be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" |
     be.experience_regular_episodes_lowest == "No" |
     is.na(be.experience_regular_episodes_lowest) #***Do we want to include missing? Need to check logic of question
    ),
    true = 1,
    false = 0,
    missing = NA_real_)
    )
    
#Recode numeric to factor
dat.ed.GLAD$ed.DSM5_BED_binary <-
  recode_factor(dat.ed.GLAD$ed.DSM5_BED_binary_numeric,
                "0" = "No DSM-5 BED",
                "1" = "DSM-5 BED")

#Summary
freq(dat.ed.GLAD$ed.DSM5_BED_binary)

```

#DSM5 BED ALGORITHM - EDGI
A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:
  1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most people would eat in a similar period of time under similar circumstances.

2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).

B. The binge-eating episodes are associated with three (or more) of the following:
  1. Eating much more rapidly than normal.
  2. Eating until feeling uncomfortably full.
  3. Eating large amounts of food when not feeling physically hungry.
  4. Eating alone because of feeling embarrassed by how much one is eating.
  5. Feeling disgusted with oneself, depressed, or very guilty afterward.

C. Marked distress regarding binge eating is present.

D. The binge eating occurs, on average, at least once a week for 3 months.

E. The binge eating is not associated with the recurrent use of inappropriate compensatory behavior as in bulimia nen/osa and does not occur exclusively during the course of bulimia nervosa or anorexia nervosa.
```{r}

#BED numeric variable
dat.ed.EDGI$ed.DSM5_BED_binary_numeric <- 
  with(dat.ed.EDGI,
  dplyr::if_else(

    #A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:
#1)Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most people would eat in a similar period of time under similar circumstances
    be.short_period_ate_regard == "Yes" & 

      #2)A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating)
      (
        be.binge_eating_stop_eating == "Slightly" |  #***Check cut off!
       be.binge_eating_stop_eating == "Somewhat" |
       be.binge_eating_stop_eating == "Very" |
       be.binge_eating_stop_eating == "Extremely"
       ) & 

  #B. The binge-eating episodes are associated with three (or more) of the following:
#1. Eating much more rapidly than normal.
#2. Eating until feeling uncomfortably full.
#3. Eating large amounts of food when not feeling physically hungry.
#4. Eating alone because of feeling embarrassed by how much one is eating.
#5. Feeling disgusted with oneself, depressed, or very guilty afterward.
  ed.BE_behaviour_sum_numeric >= 3 & 

  #C. Marked distress regarding binge eating is present.       
  (
    be.binge_eating_distressed_make == "Slightly" |  #*** Should this be "slightly" for a more lenient algorithm? Difference between inclusion criteria and actual diagnositics?
         be.binge_eating_distressed_make == "Somewhat" |
         be.binge_eating_distressed_make == "Very" |
         be.binge_eating_distressed_make == "Extremely"
    ) & 

  #D. The binge eating occurs, on average, at least once a week for 3 months.
  (ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95) & # Binge eating total duration 

  #E. The binge eating is not associated with the recurrent use of inappropriate compensatory behavior as in bulimia nervosa... "Did you ever have periods of time that lasted three months or more when you had binge-eating episodes without regularly engaging in any of the following: making yourself vomit, laxative use, diuretic use, taking weight loss pills, excessively exercising ?"
  (
  (
    icb.lasted_binge_eating_episodes1 == "Yes, 3 months DID NOT engage in ICB while bingeing" | 
        icb.none_of_the_above.1 == "Yes"
    ) |
  
  (
    is.na(icb.lasted_binge_eating_episodes1) & #***Is this right?
     is.na(icb.lasted_binge_eating_episodes2) &
     is.na(icb.lasted_binge_eating_episodes3)
     )
  ) & 

  #...and does not occur exclusively during the course of bulimia nervosa or anorexia nervosa.  
  (
    be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" |
     be.experience_regular_episodes_lowest == "No" |
     is.na(be.experience_regular_episodes_lowest) #***Include missing?
    ),
    true = 1,
    false = 0,
    missing = NA_real_)
    )
    
#Recode numeric to factor
dat.ed.EDGI$ed.DSM5_BED_binary <-
  recode_factor(dat.ed.EDGI$ed.DSM5_BED_binary_numeric,
                "0" = "No DSM-5 BED",
                "1" = "DSM-5 BED")

#Summary
freq(dat.ed.EDGI$ed.DSM5_BED_binary)

```

##DSM-5 BN ALGORITHM - GLAD

A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:

  1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most individuals would eat in a similar period of time under similar circumstances.
  2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).

B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain,such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise.

C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.

D. Self-evaluation is unduly influenced by body shape and weight.

E. The disturbance does not occur exclusively during episodes of anorexia nervosa.


NB: ICBs mislabelled in data dictionary
icb.b_used_laxatives = Fasted or did not eat
icb.b_used_laxatives.1 = Used diet pills
icb.b_used_laxatives.2 = Exercised excessively
icb.a_made_yourself_vomit = Made yourself vomit
icb.a_made_yourself_vomit.1 = Used laxatives
icb.a_made_yourself_vomit.2 =  Used diuretics
```{r ed.BN_DSM5_binary}

#Bulimia nervosa numeric variable
dat.ed.GLAD$ed.DSM5_BN_binary_numeric <- 
  with(dat.ed.GLAD,
  dplyr::if_else(

#A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:

    #1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most individuals would eat in a similar period of time under similar circumstances.
    
    ##Have you ever had regular episodes of overeating or eating binges when you ate what most people would regard as an unusually large amount of food in a short period of time?
    be.short_period_ate_regard == "Yes" & 

      #2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).
      
      #When you were having regularly occurring episodes of binge eating or overeating, did you feel that your eating was out of control such that you felt you could not stop eating, or that you could not control what or how much you were eating?
      
        (
          be.binge_eating_stop_eating == "Slightly" | #**Check cut off!
         be.binge_eating_stop_eating == "Somewhat" |
         be.binge_eating_stop_eating == "Very" |
         be.binge_eating_stop_eating == "Extremely"
         ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs to control weight or shape, i.e. not necessarily in response to binge eating]
          (
            icb.a_made_yourself_vomit == "A few times" |  #Vomiting
          icb.a_made_yourself_vomit == "Often" | 
            
          icb.a_made_yourself_vomit.1 == "A few times" | #Laxtives
          icb.a_made_yourself_vomit.1 == "Often" |
            
          icb.a_made_yourself_vomit.2  == "A few times" | #Diuretics
          icb.a_made_yourself_vomit.2  =="Often" |
            
          icb.b_used_laxatives.1 == "A few times" | #Diet pills
          icb.b_used_laxatives.1 == "Often" |
            
          icb.b_used_laxatives.2 == "A few times" | #Excessive exercise
          icb.b_used_laxatives.2 == "Often" |
            
          icb.b_used_laxatives == "A few times" | #Fasting
          icb.b_used_laxatives == "Often"
          ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      (
        ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95 # Binge eating total duration 
      ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs in response to binge eating]
        (
          icb.making_yourself_vomit.1 == "Making yourself vomit" |
        icb.laxatives.1 == "Laxatives (including pills or liquids meant to stimulate bowel movements)" |
        icb.diuretics_water_pills == "Diuretics (water pills)" |
        icb.weight_loss_pills.1 == "Weight loss pills (over the counter or prescription)" |
        icb.excessive_exercise.1 == "Excessive exercise (e.g. feel compelled to exercise, feel uneasy or distressed if unable to exercise)" |
        icb.fasting.1 == "Fasting (not eating for 8 waking hours or more)"
        ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      
  #Did the binge eating and compensatory behaviours occur at the same time, on average, once a week for 3 months?
      
      (
        icb.3months_average_time_week == "Yes" | 
  is.na(icb.3months_average_time_week)
  ) & 

    #D. Self-evaluation is unduly influenced by body shape and weight.
         
    #During the time when you were binge eating, how dependent was your self-worth on your body shape or weight?
    (
    be.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    be.not_at_all_dependentcompletely_dependent == "2" | 
    be.not_at_all_dependentcompletely_dependent == "3" |
      be.not_at_all_dependentcompletely_dependent == "4" |
      be.not_at_all_dependentcompletely_dependent == "5" |
      be.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) &

    #E. The disturbance does not occur exclusively during episodes of anorexia nervosa.
        (
          be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" | 
         be.experience_regular_episodes_lowest == "No" |
         is.na(be.experience_regular_episodes_lowest) #***Including missing?
         ),
    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric variable to factor
dat.ed.GLAD$ed.DSM5_BN_binary <-
  recode_factor(dat.ed.GLAD$ed.DSM5_BN_binary_numeric,
                "0" = "No DSM-5 BN",
                "1" = "DSM-5 BN")

#Summary
freq(dat.ed.GLAD$ed.DSM5_BN_binary)
```


##DSM-5 BN ALGORITHM - EDGI

A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:

  1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most individuals would eat in a similar period of time under similar circumstances.
  2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).

B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain,such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise.

C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.

D. Self-evaluation is unduly influenced by body shape and weight.

E. The disturbance does not occur exclusively during episodes of anorexia nervosa.

NB: ICBs mislabelled in data dictionary

icb.exercised_excessively.1 = Fasted or did not eat
icb.exercised_excessively.2 = Used diet pills
icb.fasted_or_did_not_eat.2 = Exercised excessively
icb.made_yourself_vomit.1 = Made yourself vomit
icb.any_other_methods_not_previously_listed = Used laxatives
icb.any_other_methods_not_previously_listed.1 =  Used diuretics

```{r ed.BN_DSM5_binary}

#Bulimia nervosa numeric variable
dat.ed.EDGI$ed.DSM5_BN_binary_numeric <- 
  with(dat.ed.EDGI,
  dplyr::if_else(

#A. Recurrent episodes of binge eating. An episode of binge eating is characterized by both of the following:

    #1. Eating, in a discrete period of time (e.g., within any 2-hour period), an amount of food that is definitely larger than what most individuals would eat in a similar period of time under similar circumstances.
    
    ##Have you ever had regular episodes of overeating or eating binges when you ate what most people would regard as an unusually large amount of food in a short period of time?
    be.short_period_ate_regard == "Yes" & 

      #2. A sense of lack of control over eating during the episode (e.g., a feeling that one cannot stop eating or control what or how much one is eating).
      
      #When you were having regularly occurring episodes of binge eating or overeating, did you feel that your eating was out of control such that you felt you could not stop eating, or that you could not control what or how much you were eating?
      
        (
          be.binge_eating_stop_eating == "Slightly" | #**Check cut off!
         be.binge_eating_stop_eating == "Somewhat" |
         be.binge_eating_stop_eating == "Very" |
         be.binge_eating_stop_eating == "Extremely"
         ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs to control weight or shape, i.e. not necessarily in response to binge eating]
          (
            icb.a_made_yourself_vomit == "A few times" |  #Vomiting
          icb.a_made_yourself_vomit == "Often" | 
            
          icb.a_made_yourself_vomit.1 == "A few times" | #Laxtives
          icb.a_made_yourself_vomit.1 == "Often" |
            
          icb.a_made_yourself_vomit.2  == "A few times" | #Diuretics
          icb.a_made_yourself_vomit.2  =="Often" |
            
          icb.b_used_laxatives.1 == "A few times" | #Diet pills
          icb.b_used_laxatives.1 == "Often" |
            
          icb.b_used_laxatives.2 == "A few times" | #Excessive exercise
          icb.b_used_laxatives.2 == "Often" |
            
          icb.b_used_laxatives == "A few times" | #Fasting
          icb.b_used_laxatives == "Often"
          ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      (
        ed.BE_freq_per_week >= 0.95 & # Binge eating per week 
      ed.BE_duration_months >= 2.95 # Binge eating total duration 
      ) & 

      #B. Recurrent inappropriate compensatory behaviors in order to prevent weight gain, such as self-induced vomiting; misuse of laxatives, diuretics, or other medications; fasting; or excessive exercise. [these variables are referring to ICBs in response to binge eating]
        (
          icb.making_yourself_vomit.1 == "Making yourself vomit" |
        icb.laxatives.1 == "Laxatives" |
        icb.diuretics_water_pills == "Diuretics" |
        icb.weight_loss_pills.1 == "Weight loss pills" |
        icb.excessive_exercise.1 == "Excessive exercise" |
        icb.fasting.1 == "Fasting"
        ) & 

      #C. The binge eating and inappropriate compensatory behaviors both occur, on average, at least once a week for 3 months.
      
  #Did the binge eating and compensatory behaviours occur at the same time, on average, once a week for 3 months?
      
      (
        icb.3months_average_time_week == "Yes" | 
  is.na(icb.3months_average_time_week)
  ) & 

    #D. Self-evaluation is unduly influenced by body shape and weight.
         
    #During the time when you were binge eating, how dependent was your self-worth on your body shape or weight?
    (
    be.not_at_all_dependentcompletely_dependent == "1" | #***Check cut off!
    be.not_at_all_dependentcompletely_dependent == "2" | 
    be.not_at_all_dependentcompletely_dependent == "3" |
      be.not_at_all_dependentcompletely_dependent == "4" |
      be.not_at_all_dependentcompletely_dependent == "5" |
      be.not_at_all_dependentcompletely_dependent == "Completely Dependent"
  ) &

    #E. The disturbance does not occur exclusively during episodes of anorexia nervosa.
        (
          be.experience_regular_episodes_lowest == "At times of low weight and at times outside of low weight" | 
         be.experience_regular_episodes_lowest == "No" |
         is.na(be.experience_regular_episodes_lowest)
         ),
    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric variable to factor
dat.ed.EDGI$ed.DSM5_BN_binary <-
  recode_factor(dat.ed.EDGI$ed.DSM5_BN_binary_numeric,
                "0" = "No DSM-5 BN",
                "1" = "DSM-5 BN")

#Summary
freq(dat.ed.EDGI$ed.DSM5_BN_binary)
```
##Identifying groups: Self-report AND/OR algorithm-derived

## GLAD ANOREXIA GROUP - self-reported AN AND/OR algorithm-derived AN/ANR/ANBP
```{r}

dat.ed.GLAD <- dat.ed.GLAD %>%
  mutate(
    anorexia_group_numeric =
           case_when(ed.DSM5_AN_restricting_binary_numeric == 1 |
                       ed.DSM5_AN_binge_purge_binary_numeric == 1 |
                       ed.DSM5_AN_binary_numeric == 1 |
                       mhd.anorexia_signup_numeric == 1 |
                       an.1.anorexia_nervosa_numeric == 1 ~ 1, #Self-reported or algorithm-derived AN
             
                     ed.DSM5_AN_restricting_binary_numeric == 0 |
                       ed.DSM5_AN_binge_purge_binary_numeric == 0 |
                       ed.DSM5_AN_binary_numeric == 0 |
                       mhd.anorexia_signup_numeric == 0 |
                       an.1.anorexia_nervosa_numeric == 0 ~ 0, #This will capture people who have at least one 0 for self-report or algorithm-derived. The rest will be either 0 or missing (people with 1 at ANY of these are captured in the code above)
                     
                     is.na(ed.DSM5_AN_restricting_binary_numeric) &
                       is.na(ed.DSM5_AN_binge_purge_binary_numeric) &
                       is.na(ed.DSM5_AN_binary_numeric) &
                       is.na(mhd.anorexia_signup_numeric) &
                       is.na(an.1.anorexia_nervosa_numeric) ~ NA_real_, #All missing data
           )
  )


#Check freq                    
dat.ed.GLAD %>%
  freq(anorexia_group_numeric)
           
#Add factor variable 
dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
      anorexia_group =
        recode_factor(anorexia_group_numeric,
                      "0" = "No anorexia nervosa",
                      "1" = "Self-reported and/or algorithm derived anorexia nervosa",
                      missing = NA_character_
        )
    )

#Check freq #1311 GLAD participants with AN
  dat.ed.GLAD %>%
    freq(anorexia_group,
         cumul = F)
  
```
## EDGI ANOREXIA GROUP - self-reported AN AND/OR algorithm-derived AN/ANR/ANBP
```{r}

dat.ed.EDGI <- dat.ed.EDGI %>%
  mutate(
    anorexia_group_numeric =
           case_when(ed.DSM5_AN_restricting_binary_numeric == 1 |
                       ed.DSM5_AN_binge_purge_binary_numeric == 1 |
                       ed.DSM5_AN_binary_numeric == 1 |
                       mhd.anorexia_signup_numeric == 1 ~ 1, #Self-reported or algorithm-derived AN
                  
                     ed.DSM5_AN_restricting_binary_numeric == 0 |
                       ed.DSM5_AN_binge_purge_binary_numeric == 0 |
                       ed.DSM5_AN_binary_numeric == 0 |
                       mhd.anorexia_signup_numeric == 0  ~ 0, #This will capture people who have at least one 0 for self-report or algorithm-derived. The rest will be either 0 or missing (people with 1 at ANY of these are captured in the code above)
                     
                     is.na(ed.DSM5_AN_restricting_binary_numeric) &
                       is.na(ed.DSM5_AN_binge_purge_binary_numeric) &
                       is.na(ed.DSM5_AN_binary_numeric) &
                       is.na(mhd.anorexia_signup_numeric) ~ NA_real_, #All missing data
           )
  )


#Check freq                    
dat.ed.EDGI %>%
  freq(anorexia_group_numeric)
           
#Add factor variable 
dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
      anorexia_group =
        recode_factor(anorexia_group_numeric,
                      "0" = "No anorexia nervosa",
                      "1" = "Self-reported and/or algorithm derived anorexia nervosa",
                      missing = NA_character_
        )
    )

#Check freq #2012 EDGI participants with AN
  dat.ed.EDGI %>%
    freq(anorexia_group,
         cumul = F)
  
```

## GLAD BULIMIA GROUP - self-reported BN AND/OR algorithm-derived BN
```{r}

dat.ed.GLAD <- dat.ed.GLAD %>%
  mutate(
    bulimia_group_numeric =
           case_when(ed.DSM5_BN_binary_numeric == 1 |
                       mhd.bulimia_signup_numeric == 1 |
                       an.1.bulimia_nervosa_numeric == 1 ~ 1, #Self-reported or algorithm-derived AN
                      
                     ed.DSM5_BN_binary_numeric == 0 |
                       mhd.bulimia_signup_numeric == 0 |
                       an.1.bulimia_nervosa_numeric == 0 ~ 0, #This will capture people who have at least one 0 for self-report or algorithm-derived. The rest will be either 0 or missing (people with 1 at ANY of these are captured in the code above)
                     
                     is.na(ed.DSM5_BN_binary_numeric) &
                       is.na(mhd.bulimia_signup_numeric) &
                       is.na(an.1.bulimia_nervosa_numeric)  ~ NA_real_, #All missing data
           )
  )


#Check freq                    
dat.ed.GLAD %>%
  freq(bulimia_group_numeric)
           
#Add factor variable 
dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
      bulimia_group =
        recode_factor(bulimia_group_numeric,
                      "0" = "No bulimia nervosa",
                      "1" = "Self-reported and/or algorithm derived bulimia",
                      missing = NA_character_
        )
    )

#Check freq #1336 GLAD participants with BN
  dat.ed.GLAD %>%
    freq(bulimia_group,
         cumul = F)
  
```

## EDGI BULIMIA GROUP - self-reported BN AND/OR algorithm-derived BN
```{r}

dat.ed.EDGI <- dat.ed.EDGI %>%
  mutate(
    bulimia_group_numeric =
           case_when(ed.DSM5_BN_binary_numeric == 1 |
                       mhd.bulimia_signup_numeric == 1  ~ 1, #Self-reported or algorithm-derived AN
                      
                     ed.DSM5_BN_binary_numeric == 0 |
                       mhd.bulimia_signup_numeric == 0  ~ 0, #This will capture people who have at least one 0 for self-report or algorithm-derived. The rest will be either 0 or missing (people with 1 at ANY of these are captured in the code above)
                     
                     is.na(ed.DSM5_BN_binary_numeric) &
                       is.na(mhd.bulimia_signup_numeric)   ~ NA_real_, #All missing data
           )
  )


#Check freq                    
dat.ed.EDGI %>%
  freq(bulimia_group_numeric)
           
#Add factor variable 
dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
      bulimia_group =
        recode_factor(bulimia_group_numeric,
                      "0" = "No bulimia nervosa",
                      "1" = "Self-reported and/or algorithm derived bulimia",
                      missing = NA_character_
        )
    )

#Check freq #1105 EDGI participants with BN
  dat.ed.EDGI %>%
    freq(bulimia_group,
         cumul = F)
  
```

## GLAD BED GROUP - self-reported BED AND/OR algorithm-derived BED
```{r}

dat.ed.GLAD <- dat.ed.GLAD %>%
  mutate(
    BED_group_numeric =
           case_when(ed.DSM5_BED_binary_numeric == 1 |
                       mhd.bed_signup_numeric == 1 |
                       an.1.bingeeating_disorder_numeric == 1 ~ 1, #Self-reported or algorithm-derived AN
                     
                     ed.DSM5_BED_binary_numeric == 0 |
                       mhd.bed_signup_numeric == 0 |
                       an.1.bingeeating_disorder_numeric == 0 ~ 0, #This will capture people who have at least one 0 for self-report or algorithm-derived. The rest will be either 0 or missing (people with 1 at ANY of these are captured in the code above)
                     
                     is.na(ed.DSM5_BED_binary_numeric) &
                       is.na(mhd.bed_signup_numeric) &
                       is.na(an.1.bingeeating_disorder_numeric)  ~ NA_real_, #All missing data
           )
  )


#Check freq                    
dat.ed.GLAD %>%
  freq(BED_group_numeric)
           
#Add factor variable 
dat.ed.GLAD <- dat.ed.GLAD %>%
    mutate(
      BED_group =
        recode_factor(BED_group_numeric,
                      "0" = "No binge-eating disorder",
                      "1" = "Self-reported and/or algorithm derived binge-eating disorder",
                      missing = NA_character_
        )
    )

#Check freq #2725 GLAD participants with BED
  dat.ed.GLAD %>%
    freq(BED_group,
         cumul = F)

```

## EDGI BED GROUP - self-reported BED AND/OR algorithm-derived BED
```{r}

dat.ed.EDGI <- dat.ed.EDGI %>%
  mutate(
    BED_group_numeric =
           case_when(ed.DSM5_BED_binary_numeric == 1 |
                       mhd.bed_signup_numeric == 1 ~ 1, #Self-reported or algorithm-derived AN
                     
                     ed.DSM5_BED_binary_numeric == 0 |
                       mhd.bed_signup_numeric == 0  ~ 0, #This will capture people who have at least one 0 for self-report or algorithm-derived. The rest will be either 0 or missing (people with 1 at ANY of these are captured in the code above)
                     
                     is.na(ed.DSM5_BED_binary_numeric) &
                       is.na(mhd.bed_signup_numeric)  ~ NA_real_, #All missing data
           )
  )


#Check freq                    
dat.ed.EDGI %>%
  freq(BED_group_numeric)
           
#Add factor variable 
dat.ed.EDGI <- dat.ed.EDGI %>%
    mutate(
      BED_group =
        recode_factor(BED_group_numeric,
                      "0" = "No binge-eating disorder",
                      "1" = "Self-reported and/or algorithm derived binge-eating disorder",
                      missing = NA_character_
        )
    )

#Check freq #644 EDGI participants with BED
  dat.ed.EDGI %>%
    freq(BED_group,
         cumul = F)

```

##PGC check - Lowest BMI in self-reported AN

In GLAD, there are three reports of BMI.
1) Lowest BMI as reported in the signup (i.e., glad_ed_demographics) (low_dem_bmi)
2) Current BMI as reported in the signup (current_bmi)
3) Lowest BMI as reported in the optional ED100K (AN_low_bmi)

#1. mhd self report = Have you ever been diagnosed with one or more of the following mental health problems or neurodevelopmental disorders by a professional, even if you don't have it currently? By professional we mean: any doctor, nurse or person with specialist training . Please include disorders even if you did not need treatment for them or if you did not agree with the diagnosis. Select ALL that apply:

```{r}

##Identify group

#Filter for those who self-report AN
mhd.self.report.GLAD1 <- dat.ed.GLAD %>%
  filter(mhd.anorexia_signup_numeric == 1)

nrow(mhd.self.report.GLAD1)

#Filter again for those with age of onset above the age of 18

freq(mhd.self.report.GLAD1$an.how_old_were_you)

mhd.self.report.GLAD <- mhd.self.report.GLAD1 %>%
  filter(an.how_old_were_you >= 18)

nrow(mhd.self.report.GLAD)

#Check
freq(mhd.self.report.GLAD$an.how_old_were_you)

#BMI variable - if not reported in signup, use value from ED100K (if available)

mhd.self.report.GLAD$LOWEST_BMI <- 
  if_else(
    condition = is.na(mhd.self.report.GLAD$low_dem_bmi),
    true = mhd.self.report.GLAD$AN_low_bmi,
    false = mhd.self.report.GLAD$low_dem_bmi,
    missing = NA_real_
    )

#Descriptives
mhd.self.report.GLAD %>%
  freq(LOWEST_BMI)

mhd.self.report.GLAD %>%
  descr(LOWEST_BMI)


#Plot 
qplot(mhd.self.report.GLAD$LOWEST_BMI)

#Percentage with BMI over 18.5
mhd.self.report.GLAD %>%
  filter(LOWEST_BMI > 18.5) %>%
  nrow()

(21/189)*100


```

#2. AN self report = Which of the following eating disorders did you/do you currently have? If you have not received a diagnosis and are not sure which of the following may apply to you please select Don't know: [this is asked to people who indicate "yes" to "Have you ever suspected that you may have an eating disorder, whether or not you were ever diagnosed?"]

```{r}

##Identify group

#Filter for those who self-report AN diagnosis
an.self.report.GLAD1 <- dat.ed.GLAD %>%
  filter(an.1.anorexia_nervosa_numeric == 1)

nrow(an.self.report.GLAD1)

#Filter again for those with age of onset above the age of 18

freq(an.self.report.GLAD1$an.how_old_were_you)

an.self.report.GLAD <- an.self.report.GLAD1 %>%
  filter(an.how_old_were_you >= 18)

nrow(an.self.report.GLAD)

freq(an.self.report.GLAD$an.how_old_were_you)

#BMI variable - if not reported in signup, use value from ED100K (if available)

an.self.report.GLAD$LOWEST_BMI <- 
  if_else(
    condition = is.na(an.self.report.GLAD$AN_low_bmi),
    true = an.self.report.GLAD$low_dem_bmi,
    false = an.self.report.GLAD$AN_low_bmi,
    missing = NA_real_
    )

#Descriptives
an.self.report.GLAD %>%
  freq(LOWEST_BMI)

an.self.report.GLAD %>%
  descr(LOWEST_BMI)


#Plot 
qplot(an.self.report.GLAD$LOWEST_BMI)

#Percentage with BMI over 18.5
an.self.report.GLAD %>%
  filter(LOWEST_BMI > 18.5) %>%
  nrow()

(71/310)*100

```
## Select variables to keep
All self-report and algorithm-derived variables and final grouping variables (both numeric and factor). Plus ID and cohort name

```{r}

#EDGI final ED variables 
final_edgi_data_ed <- dat.ed.EDGI  %>%
  select(ID,
         cohort_name,
         ed.DSM5_AN_binary_numeric,                           
         ed.DSM5_AN_binary,                                   
         ed.DSM5_AN_restricting_binary_numeric,             
         ed.DSM5_AN_restricting_binary,                       
         ed.DSM5_AN_binge_purge_binary_numeric,               
         ed.DSM5_ANBP_binary,                                  
         ed.DSM5_BED_binary_numeric,                          
         ed.DSM5_BED_binary,                                    
         ed.DSM5_BN_binary_numeric,                            
         ed.DSM5_BN_binary,                                     
         anorexia_group_numeric,                                
         anorexia_group,                                       
         bulimia_group_numeric,                                
         bulimia_group,                                        
         BED_group_numeric,                                     
         BED_group,
         mhd.anorexia_signup_numeric,
          mhd.anorexia_signup,
         mhd.bulimia_signup,
         mhd.bulimia_signup_numeric,
          mhd.bed_signup,
          mhd.bed_signup_numeric) 

#GLAD final ED variables 
final_glad_data_ed <- dat.ed.GLAD  %>%
  select(ID,
         cohort_name,
         ed.DSM5_AN_binary_numeric,                           
         ed.DSM5_AN_binary,                                   
         ed.DSM5_AN_restricting_binary_numeric,             
         ed.DSM5_AN_restricting_binary,                       
         ed.DSM5_AN_binge_purge_binary_numeric,               
         ed.DSM5_ANBP_binary,                                  
         ed.DSM5_BED_binary_numeric,                          
         ed.DSM5_BED_binary,                                    
         ed.DSM5_BN_binary_numeric,                            
         ed.DSM5_BN_binary,                                     
         anorexia_group_numeric,                                
         anorexia_group,                                       
         bulimia_group_numeric,                                
         bulimia_group,                                        
         BED_group_numeric,                                     
         BED_group,
         mhd.anorexia_signup_numeric,
          mhd.anorexia_signup,
         mhd.bulimia_signup,
         mhd.bulimia_signup_numeric,
          mhd.bed_signup,
          mhd.bed_signup_numeric,
         an.1.anorexia_nervosa_numeric,
         an.1.anorexia_nervosa,
         an.1.bulimia_nervosa,
         an.1.bulimia_nervosa_numeric,
         an.1.bingeeating_disorder_numeric,
         an.1.bingeeating_disorder) 
  
```

##Save datasets
```{r}
#EDGI
saveRDS(object = final_edgi_data_ed,
        file = paste0("/Users/helenadavies/King's College London/MT-Translational Neuropsychiatric Genomics - Helena_Davies_PhD - Helena_Davies_PhD/EDBeh_SelfHarm/data_cleaned/EDGI_ED_data_cleaned", date, ".rds"))
#GLAD
saveRDS(object = final_glad_data_ed,
        file = paste0("/Users/helenadavies/King's College London/MT-Translational Neuropsychiatric Genomics - Helena_Davies_PhD - Helena_Davies_PhD/EDBeh_SelfHarm/data_cleaned/GLAD_ED_data_cleaned", date, ".rds"))

```
