---
title: "COPING_cleaning_dem"
author: "Helena Davies (based on PANCHANGE script by KP, KT, KY, TH)"
date: "15/12/2020"
output: html_document
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

#### Call in library script

```{r source files}
source("./libraries.R")
```


#Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

#### R functions

```{r call in function library functions}
# source all functions in the function folder
source("./functions.R")
```


# Specify cohort
```{r Specify cohort}
GLAD = FALSE
EDGI = FALSE
RAMP = FALSE
NBR = FALSE
COPING = TRUE
```


# Demographics 
## GLAD 1
### Read in data
```{r glad dem cols}
if(GLAD == TRUE){
glad.coping.dem.raw <- readRDS(file = "../data_raw/glad/dem_coping_glad.rds")
dim(glad.coping.dem.raw)
colnames(glad.coping.dem.raw)
}
```

### Select variables
```{r glad dem select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem.raw.id <- glad.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_pregnant,
         weight_lb_unc = dem.current_weight_provide_pregnant.1,
         weight_kg_unc = dem.current_weight_provide_pregnant.2,
         highest_weight_st_unc = dem.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = dem.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = dem.provide_pregnant_weighed_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.adult_height_lowest_weight.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem.raw.id)
# Inspect colnames
colnames(glad.coping.dem.raw.id)
#Differences
dim(glad.coping.dem.raw)[1]-dim(glad.coping.dem.raw.id)[1]
}

```

###Summarise 
```{r glad dem summary, eval=FALSE, include=FALSE}
if(GLAD == TRUE) {
summarytools::dfSummary(
  glad.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## GLAD 2
### Read in data
```{r glad dem2 cols}
if(GLAD == TRUE){
glad.coping.dem2.raw <- readRDS(file = "../data_raw/glad/dem2_coping_glad.rds")
dim(glad.coping.dem2.raw)
colnames(glad.coping.dem2.raw)
}
```

### Select variables
```{r glad dem2 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem2.raw.id <- glad.coping.dem2.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1,
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem2.raw.id)
# Inspect colnames
colnames(glad.coping.dem2.raw.id)
#Differences
dim(glad.coping.dem2.raw)[1]-dim(glad.coping.dem2.raw.id)[1]
}

```

###Summarise 
```{r glad dem2 summary, eval=FALSE, include=FALSE}
if(GLAD == TRUE) {
summarytools::dfSummary(
  glad.coping.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## GLAD 3  [sign up]
### Read in data
```{r glad dem3 cols}
if(GLAD == TRUE){
glad.dem3.raw <- readRDS(file = "../data_raw/glad/dem_glad.rds")
dim(glad.dem3.raw)
colnames(glad.dem3.raw)
}
```

### Select variables
```{r glad dem3 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.dem3.raw.id <- glad.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         age_unc = dem.how_old_are_you_now.txt,
         ethnicity_unc = dem.questions_based_ethnic_origin,
         ethnicity_unc_text = dem.questions_based_ethnic_origin.txt,
         dem.college_or_university_degree,
         dem.a_levelsas_levels_or_equivalent,
         dem.o_levelsgcses_or_equivalent,
         dem.cses_or_equivalent,
         dem.nvq_or_hnd_or_hnc_or_equivalent,
         dem.other_professional_qualifications,
         dem.other_professional_qualifications_text.txt,
         dem.none_of_the_above_education = dem.none_of_the_above,
         transgender = dem.do_you_identify_as_transgender
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.dem3.raw.id)
# Inspect colnames
colnames(glad.dem3.raw.id)
#Differences
dim(glad.dem3.raw)[1]-dim(glad.dem3.raw.id)[1]
}

```

# Demographics 
## EDGI 
### Read in data
```{r edgi dem cols}
if(EDGI == TRUE){
edgi.coping.dem.raw <- readRDS(file = "../data_raw/edgi/dem_coping_edgi.rds")
dim(edgi.coping.dem.raw)
colnames(edgi.coping.dem.raw)
}
```

### Select variables
```{r edgi dem select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem.raw.id <- edgi.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_weight,
         weight_lb_unc = dem.current_weight_provide_weight.1,
         weight_kg_unc = dem.current_weight_provide_weight.2,
         highest_weight_st_unc = dem.provide_weighed_pregnant_weight,
         highest_weight_lb_unc = dem.provide_weighed_pregnant_weight.1,
         highest_weight_kg_unc = dem.provide_weighed_pregnant_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.lowest_weight_adult_height.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem.raw.id)
# Inspect colnames
colnames(edgi.coping.dem.raw.id)
#Differences
dim(edgi.coping.dem.raw)[1]-dim(edgi.coping.dem.raw.id)[1]
}

```
###Summarise 
```{r edgi dem summarise}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## EDGI 2
### Read in data
```{r edgi dem2 cols}
if(EDGI == TRUE){
edgi.coping.dem2.raw <- readRDS(file = "../data_raw/edgi/dem2_coping_edgi.rds")
dim(edgi.coping.dem2.raw)
colnames(edgi.coping.dem2.raw)
}
```

### Select variables
```{r edgi dem2 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem2.raw.id <- edgi.coping.dem2.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital, #To match name in GLAD
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1,
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem2.raw.id)
# Inspect colnames
colnames(edgi.coping.dem2.raw.id)
#Differences
dim(edgi.coping.dem2.raw)[1]-dim(edgi.coping.dem2.raw.id)[1]
}

```

###Summarise 
```{r edgi dem2 summarise, eval=FALSE, include=FALSE}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.coping.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## EDGI 3  [sign up]
### Read in data
```{r EDGI dem3 cols}
if(EDGI == TRUE){
edgi.dem3.raw <- readRDS(file = "../data_raw/edgi/demographics_edgi.rds")
dim(edgi.dem3.raw)
colnames(edgi.dem3.raw)
}
```

### Select variables
```{r edgi dem3 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.dem3.raw.id <- edgi.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         age_unc = dem.how_old_are_you_now.txt,
         ethnicity_unc = demographics.what_is_your_ethnic_origin,
         ethnicity_unc_text = demographics.what_is_your_ethnic_origin.txt,
         transgender = demographics.do_you_consider_yourself_to_be_transgender,
         demographics.collegeuniversity,
         demographics.asa_levels,
         demographics.cse,
         demographics.gcse,
         demographics.nvq,
         demographics.other.1,
         demographics.none_of_the_above,
         demographics.other_text.txt.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.dem3.raw.id)
# Inspect colnames
colnames(edgi.dem3.raw.id)
#Differences
dim(edgi.dem3.raw)[1]-dim(edgi.dem3.raw.id)[1]
}

```

# Demographics 
## GLAD 4 employment 
### Read in data
```{r GLAD dem4 cols}
if(GLAD == TRUE){
glad.coping.dem4.employ.raw <- readRDS(file = "../data_raw/glad/employ_coping_glad.rds")
dim(glad.coping.dem4.employ.raw)
colnames(glad.coping.dem4.employ.raw)
}

```
### Select variables
```{r glad dem4 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role = employ.role_type, #renamed to be same as edgi
         employ.type_role.txt = employ.role_type.txt, #renamed to be same as edgi
         employ.type_role.1 = employ.role_type.1, #renamed to be same as edgi
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.job_due_losing_risk, #renamed to be same as edgi
         employ.increased_due_job_pandemic = employ.increased_job_due_pandemic #renamed to be same as edgi
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem4.employ.raw.id)
# Inspect colnames
colnames(glad.coping.dem4.employ.raw.id)
#Differences
dim(glad.coping.dem4.employ.raw)[1]-dim(glad.coping.dem4.employ.raw.id)[1]
}

```

# Demographics 
## EDGI 4 employment
### Read in data
```{r EDGI dem4 cols}
if(EDGI == TRUE){
edgi.coping.dem4.employ.raw <- readRDS(file = "../data_raw/edgi/employ_coping_edgi.rds")
dim(edgi.coping.dem4.employ.raw)
colnames(edgi.coping.dem4.employ.raw)
}
```

### Select variables
```{r edgi dem4 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt,
         employ.type_role.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk,
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem4.employ.raw.id)
# Inspect colnames
colnames(edgi.coping.dem4.employ.raw.id)
#Differences
dim(edgi.coping.dem4.employ.raw)[1]-dim(edgi.coping.dem4.employ.raw.id)[1]

}

```
# Demographics 
## NBR 1
### Read in data
```{r nbr dem1 cols}
if(NBR == TRUE){
nbr.dem.raw <- readRDS(file = "../data_raw/nbr/demographics_coping_nbr.rds")
dim(nbr.dem.raw)
colnames(nbr.dem.raw)
}

```

### Select variables
```{r nbr dem1 select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem.raw.id <- nbr.dem.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = demographics.which_gender_do_you_identify_with, # Gender
         sex = demographics.select_questionnaire_items_medical, #Sex
         pregnant_binary = demographics.baby_pregnant_months,
         birthday_day = demographics.day,
         birthday_month = demographics.month,
         birthday_year = demographics.year,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = demographics.what_is_your_current_height,
         height_inch_unc = demographics.what_is_your_current_height.1,
         height_cm_unc = demographics.what_is_your_current_height.2,
         weight_st_unc = demographics.provide_current_weight_pregnant,
         weight_lb_unc = demographics.provide_current_weight_pregnant.1,
         weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         highest_weight_st_unc = demographics.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = demographics.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         lowest_weight_st_unc = demographics.adult_height_reaching_weighed,
         lowest_weight_lb_unc = demographics.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = demographics.adult_height_reaching_weighed.2,
         age_highest_weight_unc = demographics.highest_weight.txt,
         age_lowest_weight_unc = demographics.adult_height_lowest_weight.txt,
         uk_location = demographics.live,
         current_country = demographics.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem.raw.id)
# Inspect colnames
colnames(nbr.dem.raw.id)
#Differences
dim(nbr.dem.raw)[1]-dim(nbr.dem.raw.id)[1]
}

```

# Demographics 
## NBR 2
### Read in data
```{r nbr dem2 cols}
if(NBR == TRUE){
nbr.dem2.raw <- readRDS(file = "../data_raw/nbr/dem_coping_nbr.rds")
dim(nbr.dem2.raw)
colnames(nbr.dem2.raw)
}
```

### Select variables
```{r nbr dem2 select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem2.raw.id <- nbr.dem2.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living = dem2.spouse_members_partner_living, #Renamed to be same as edgi/glad
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1 = dem2.spouse_members_partner_living.1, #Renamed to be same as edgi/glad
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place = dem2.relationships_describe_place_question, #Renamed to be same as edgi/glad
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital, #To match name in GLAD
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem2.raw.id)
# Inspect colnames
colnames(nbr.dem2.raw.id)
#Differences
dim(nbr.dem2.raw)[1]-dim(nbr.dem2.raw.id)[1]
}

```

###Summarise 
```{r nbr dem2 summary, eval=FALSE, include=FALSE}
if(NBR == TRUE) {
summarytools::dfSummary(
  nbr.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## NBR employment 
### Read in data
```{r nbr dem employ cols}
if(NBR == TRUE){
nbr.dem.employ.raw <- readRDS(file = "../data_raw/nbr/employ_coping_nbr.rds")
dim(nbr.dem.employ.raw)
colnames(nbr.dem.employ.raw)
}
```

### Select variables
```{r nbr dem employ select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem.employ.raw.id <- nbr.dem.employ.raw%>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt,
         employ.type_role.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.job_due_losing_risk, #renamed to same as edgi
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem.employ.raw.id)
# Inspect colnames
colnames(nbr.dem.employ.raw.id)
#Differences
dim(nbr.dem.employ.raw)[1]-dim(nbr.dem.employ.raw.id)[1]
}

```

# Demographics 
## RAMP
### Read in data
```{r ramp dem cols}
if(RAMP == TRUE){
ramp.dem.raw <- readRDS(file = "../data_raw/ramp/dem_ramp.rds")
dim(ramp.dem.raw)
colnames(ramp.dem.raw)
}
```

### Select variables
```{r ramp dem select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

ramp.dem.raw.id <- ramp.dem.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column
  select(
         ID = `Login ID`,# ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         age_unc = dem2.how_old_are_you,
         gender_unc = dem2.which_gender_do_you_identify_with, # Gender
         pregnant_binary = dem2.are_you_pregnant, 
         #dem2.what_is_your_current_maritalrelationship_status #Not in COPING 
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3 = dem2.living_children_under_the_age_of_18, #Renamed to be same as coping glad/edgi
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_members_partner_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.relationships_describe_question_place = dem2.describe_relationships_live_living, #Rename to be same as coping glad/edgi
         dem2.household_living_place_answer, 
         dem2.include_living_areas_count = dem2.count_bathrooms_bedrooms_hallways,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.none,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         transgender = dem2.do_you_identify_as_transgender,
         dem2.adult_children_pandemic_returned,
         dem2.adult_children_pandemic_returned.txt,
         dem.live = dem2.where_in_the_uk_do_you_live.txt, #changed wording to match glad edgi dem
         ethnicity_unc_text = dem2.what_is_your_ethnic_origin.txt,
         ethnicity_unc = dem2.what_is_your_ethnic_origin,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.living_children_under_the_age_of_18.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_members_partner_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.household_living_place_answer,
         dem2.do_you_have_any_children,
         dem2.adult_children_home_living.1,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.ramp_study_hear.txt,
         dem2.ramp_study_hear
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp.dem.raw.id)
# Inspect colnames
colnames(ramp.dem.raw.id)
#Differences
dim(ramp.dem.raw)[1]-dim(ramp.dem.raw.id)[1]
}

```
# Demographics 
## RAMP employment
### Read in data
```{r ramp dem employ cols}
if(RAMP == TRUE){
ramp.dem.employ.raw <- readRDS(file = "../data_raw/ramp/employ_ramp.rds")
dim(ramp.dem.employ.raw)
colnames(ramp.dem.employ.raw)
}
```

### Select variables
```{r ramp dem employ select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

ramp.dem.employ.raw.id <- ramp.dem.employ.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #employ.phd,
         #employ.masters_degree_or_equivalent,
         #employ.postgraduate_degree_or_equivalent,
         #employ.bachelors_degree_or_equivalent,
         #employ.a_levelsas_levels_or_equivalent,
         #employ.o_levelsgcses_or_equivalent,
         #employ.cses_or_equivalent,
         #employ.nvq_or_hnd_or_hnc_or_equivalent,
         #employ.other_professional_qualifications_e.g._nursing_teaching,
         #employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.what_is_your_highest_level_of_education,
         #employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         #employ.taking_unpaid_leave, #Not in RAMP
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work = employ.work_attend_work_encouraged, #renamed to same as edgi and glsd
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt = employ.role_type.txt,
         employ.type_role.1 = employ.role_type.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.scale_line_losing_click,
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp.dem.employ.raw.id)
# Inspect colnames
colnames(ramp.dem.employ.raw.id)
#Differences
dim(ramp.dem.employ.raw)[1]-dim(ramp.dem.employ.raw.id)[1]
}

```
# EDEQ
## COPING follow up b [nbr, glad + edgi]
### Read in data
```{r coping edeq follow up b cols}
if(COPING == TRUE){
edeq.coping.followupb.raw <- readRDS(file = "../data_raw/coping/edeq_coping_followupb.rds")
dim(edeq.coping.followupb.raw)
colnames(edeq.coping.followupb.raw)
}
```

### Select variables
```{r edeq coping select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

edeq.coping.followupb.raw.id <- edeq.coping.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape = edeq.calories_made_body_shape,
         edeq.weight_influenced_person = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight = edeq.dissatisfied_shape_weight,
         edeq.actively_been_monitoring_your_shape_or_weight = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories = edeq.compulsive_driven_burn_calories,
         edeq.eating_behaviours_distressed_concerns = edeq.eating_behaviours_distressed_concerns,
         edeq.nibbled_picked_snacks_grazed  = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1 = edeq.felt_anxious_blue_bored.1,
         edeq.experiences_pandemic = edeq.experiences_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  #mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.coping.followupb.raw.id)
# Inspect colnames
colnames(edeq.coping.followupb.raw.id)
#Differences
dim(edeq.coping.followupb.raw)[1]-dim(edeq.coping.followupb.raw.id)[1]
}
```

# EDEQ
## RAMP baseline
### Read in data
```{r RAMP edeq baseline cols}
if(RAMP == TRUE){
edeq.ramp.baseline.raw <- readRDS(file = "../data_raw/ramp/edeq_ramp.rds")
dim(edeq.ramp.baseline.raw)
colnames(edeq.ramp.baseline.raw)
}
```
### Select variables
```{r ramp edeq baseline select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edeq.ramp.baseline.raw.id <- edeq.ramp.baseline.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence_baseline = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape_baseline = edeq.calories_made_body_shape,
         edeq.weight_influenced_person_baseline = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight_baseline = edeq.dissatisfied_shape_weight,
         edeq.nibbled_picked_snacks_grazed_baseline = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored_baseline = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1_baseline = edeq.felt_anxious_blue_bored.1,
         edeq.eating_behaviours_concerns_distressed_baseline = edeq.eating_behaviours_concerns_distressed,
         edeq.deliberately_limit_amount_influence.1_baseline = edeq.deliberately_limit_amount_influence.1,
         edeq.calories_made_body_shape.1_baseline = edeq.calories_made_body_shape.1,
         edeq.weight_influenced_person.1_baseline = edeq.weight_influenced_person.1,
         edeq.dissatisfied_shape_weight.1_baseline = edeq.dissatisfied_shape_weight.1,
         edeq.eating_behaviours_concerns_distressed.1_baseline = edeq.eating_behaviours_concerns_distressed.1,
         edeq.feelings_pandemic_felt_baseline = edeq.feelings_pandemic_felt,
         edeq.actively_been_monitoring_your_shape_or_weight_baseline = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten_baseline = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape_baseline = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape_baseline = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories_baseline = edeq.compulsive_driven_burn_calories,
         edeq.nibbled_picked_snacks_grazed.1_baseline = edeq.nibbled_picked_snacks_grazed.1,
         edeq.felt_anxious_blue_bored.2_baseline = edeq.felt_anxious_blue_bored.2,
         edeq.felt_anxious_blue_bored.3_baseline = edeq.felt_anxious_blue_bored.3,
         edeq.actively_been_monitoring_your_shape_or_weight_.1_baseline = edeq.actively_been_monitoring_your_shape_or_weight_.1,
         edeq.regard_lost_control_eaten.1_baseline = edeq.regard_lost_control_eaten.1,
         edeq.sick_means_made_shape.1_baseline = edeq.sick_means_made_shape.1,
         edeq.diuretics_laxatives_means_shape.1_baseline = edeq.diuretics_laxatives_means_shape.1,
         edeq.compulsive_driven_burn_calories.1_baseline = edeq.compulsive_driven_burn_calories.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.ramp.baseline.raw.id)
# Inspect colnames
colnames(edeq.ramp.baseline.raw.id)
#Differences
dim(edeq.ramp.baseline.raw)[1]-dim(edeq.ramp.baseline.raw.id)[1]
}
```

# EDEQ
## RAMP follow up b
### Read in data
```{r RAMP edeq follow up b cols}
if(RAMP == TRUE){
edeq.ramp.followupb.raw <- readRDS(file = "../data_raw/ramp/edeq_ramp_followupb.rds")
dim(edeq.ramp.followupb.raw)
colnames(edeq.ramp.followupb.raw)
}
```
### Select variables
```{r ramp edeq follow up b select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

edeq.ramp.followupb.raw.id <- edeq.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape = edeq.calories_made_body_shape,
         edeq.weight_influenced_person = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight = edeq.dissatisfied_shape_weight,
         edeq.actively_been_monitoring_your_shape_or_weight = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories = edeq.compulsive_driven_burn_calories,
         edeq.eating_behaviours_distressed_concerns = edeq.eating_behaviours_distressed_concerns,
         edeq.nibbled_picked_snacks_grazed = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1 = edeq.felt_anxious_blue_bored.1,
         #edeq.experiences_pandemic #not in ramp but in coping
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) 
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.ramp.followupb.raw.id)
# Inspect colnames
colnames(edeq.ramp.followupb.raw.id)
#Differences
dim(edeq.ramp.followupb.raw)[1]-dim(edeq.ramp.followupb.raw.id)[1]
}
```

###EDEQ scoring

The EDE, and its self-report version, the EDE-Q, generate two types of data. First, they provide
frequency data on key behavioural features of eating disorders in terms of number of episodes of the
behaviour and in some instances number of days on which the behaviour has occurred. Second, they
provide subscale scores reflecting the severity of aspects of the psychopathology of eating disorders.
The subscales are Restraint, Eating Concern, Shape Concern and Weight Concern. To obtain a
particular subscale score, the ratings for the relevant items (listed below) are added together and the sum
divided by the total number of items forming the subscale. If ratings are only available on some items, a
score may nevertheless be obtained by dividing the resulting total by the number of rated items so long
as more than half the items have been rated. To obtain an overall or ‘global’ score, the four subscales
scores are summed and the resulting total divided by the number of subscales (i.e. four). Subscale
scores are reported as means and standard deviations.

# TAF - baseline 
## GLAD 
### Read in data
```{r GLAD taf sign up cols}
if(GLAD == TRUE){
taf.glad.coping.baseline.raw <- readRDS(file = "../data_raw/glad/taf_coping_glad.rds")
dim(taf.glad.coping.baseline.raw)
colnames(taf.glad.coping.baseline.raw)
}

```

### Select variables
```{r GLAD sign up taf select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.glad.coping.baseline.raw.id <- taf.glad.coping.baseline.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_life_thoughts, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.glad.coping.baseline.raw.id)
# Inspect colnames
colnames(taf.glad.coping.baseline.raw.id)
#Differences
dim(taf.glad.coping.baseline.raw)[1]-dim(taf.glad.coping.baseline.raw.id)[1]
}
```

# TAF - baseline
## EDGI  
### Read in data
```{r EDGI taf sign up cols}
if(EDGI == TRUE){
taf.edgi.coping.baseline.raw <- readRDS(file = "../data_raw/edgi/taf_coping_edgi.rds")
dim(taf.edgi.coping.baseline.raw)
colnames(taf.edgi.coping.baseline.raw)
}
```

### Select variables
```{r EDGI sign up taf select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")


taf.edgi.coping.baseline.raw.id <- taf.edgi.coping.baseline.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.weeks_past_felt,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.weeks_past_felt.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_weeks_life, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) 
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.edgi.coping.baseline.raw.id)
# Inspect colnames
colnames(taf.edgi.coping.baseline.raw.id)
#Differences
dim(taf.edgi.coping.baseline.raw)[1]-dim(taf.edgi.coping.baseline.raw.id)[1]
}
```
# TAF - baseline 
## NBR 
### Read in data
```{r NBR taf sign up cols}
if(NBR == TRUE){
taf.nbr.baseline.raw <- readRDS(file = "../data_raw/nbr/taf_coping_nbr.rds")
dim(taf.nbr.baseline.raw)
colnames(taf.nbr.baseline.raw)
}

```
### Select variables
```{r NBR sign up taf select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.nbr.baseline.raw.id <- taf.nbr.baseline.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  #mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) 
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.nbr.baseline.raw.id)
# Inspect colnames
colnames(taf.nbr.baseline.raw.id)
#Differences
dim(taf.nbr.baseline.raw)[1]-dim(taf.nbr.baseline.raw.id)[1]
}
```
# TAF - baseline 
## RAMP
### Read in data
```{r RAMP taf sign up cols}
if(RAMP == TRUE){
taf.ramp.baseline.raw <- readRDS(file = "../data_raw/ramp/taf_ramp.rds")
dim(taf.ramp.baseline.raw)
colnames(taf.ramp.baseline.raw)
}
```

### Select variables
```{r RAMP sign up taf select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.ramp.baseline.raw.id <- taf.ramp.baseline.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.weeks_past_felt.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.baseline.raw.id)
# Inspect colnames
colnames(taf.ramp.baseline.raw.id)
#Differences
dim(taf.ramp.baseline.raw)[1]-dim(taf.ramp.baseline.raw.id)[1]
}
```

# TAF - follow up A
## COPING (first 2 waves)
### Read in data
```{r COPING taf follow up a cols}
if(COPING == TRUE){
taf.coping.followupa.raw.1 <- readRDS(file = "../data_raw/coping/taf_coping_followupa.rds")
dim(taf.coping.followupa.raw.1)
colnames(taf.coping.followupa.raw.1)
}
```

### Select variables
```{r COPING taf follow up a select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.coping.followupa.raw.id.1 <- taf.coping.followupa.raw.1 %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupa.raw.id.1)
# Inspect colnames
colnames(taf.coping.followupa.raw.id.1)
#Differences
dim(taf.coping.followupa.raw.1)[1]-dim(taf.coping.followupa.raw.id.1)[1]
}
```

# TAF - follow up A
## COPING (subsequent waves)
### Read in data
```{r COPING taf follow up a cols}
if(COPING == TRUE){
taf.coping.followupa.raw.2 <- readRDS(file = "../data_raw/coping/taf_coping_followupa_ongoing.rds")
dim(taf.coping.followupa.raw.2)
colnames(taf.coping.followupa.raw.2)
}
```

### Select variables
```{r COPING taf follow up a select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.coping.followupa.raw.id.2 <- taf.coping.followupa.raw.2 %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
# mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupa.raw.id.2)
# Inspect colnames
colnames(taf.coping.followupa.raw.id.2)
#Differences
dim(taf.coping.followupa.raw.2)[1]-dim(taf.coping.followupa.raw.id.2)[1]
}
```

#Combine taf coping follow up A datasets 
```{r}
if(COPING == TRUE){
    taf.coping.followupa.raw.id <- rbind(taf.coping.followupa.raw.id.2, taf.coping.followupa.raw.id.1) ##**Note that some people may be in both datasets, i.e. answered the questionnaire using the original link during the time period that is considered the start of the 'ongoing' dataset, before realising and answering through the correct link. Example - questionnaires answered on the 29th July are present in both datasets. This is fine - as long as it's different people. Will need to filter by duplicate ID and duplicate wave once wave variable is created.
  
# Inspect dimensions
  dim(taf.coping.followupa.raw.id)
# Inspect colnames
  colnames(taf.coping.followupa.raw.id)
}
```


# TAF - follow up b
## COPING
### Read in data
```{r COPING taf follow up b cols}
if(COPING == TRUE){
taf.coping.followupb.raw <- readRDS(file = "../data_raw/coping/taf_coping_followupb.rds")
dim(taf.coping.followupb.raw)
colnames(taf.coping.followupb.raw)
}
```

### Select variables
```{r COPING taf follow up b select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.coping.followupb.raw.id <- taf.coping.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
 # distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.weeks_past_felt, #renamed to same follow up a
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.weeks_past_felt.1, #renamed to same follow up a
         taf.meant_life_end_weeks = taf.deliberately_harmed_meant_end #renamed to same follow up a
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupb.raw.id)
# Inspect colnames
colnames(taf.coping.followupb.raw.id)
#Differences
dim(taf.coping.followupb.raw)[1]-dim(taf.coping.followupb.raw.id)[1]
}
```
# TAF - follow up A
## RAMP
### Read in data
```{r RAMP taf follow up a cols}
if(RAMP == TRUE){
taf.ramp.followupa.raw <- readRDS(file = "../data_raw/ramp/taf_ramp_followupa.rds")
dim(taf.ramp.followupa.raw)
colnames(taf.ramp.followupa.raw)
}
```

### Select variables
```{r RAMP taf follow up a select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.ramp.followupa.raw.id <- taf.ramp.followupa.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.followupa.raw.id)
# Inspect colnames
colnames(taf.ramp.followupa.raw.id)
#Differences
dim(taf.ramp.followupa.raw)[1]-dim(taf.ramp.followupa.raw.id)[1]
}
```
# TAF - follow up B
## RAMP
### Read in data
```{r RAMP taf follow up b cols}
if(RAMP == TRUE){
taf.ramp.followupb.raw <- readRDS(file = "../data_raw/ramp/taf_ramp_followupb.rds")
dim(taf.ramp.followupb.raw)
colnames(taf.ramp.followupb.raw)
}
```
### Select variables
```{r RAMP taf follow up b select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.ramp.followupb.raw.id <- taf.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.weeks_past_felt, #renamed to match follow up a
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.weeks_past_felt.1, #renamed to match follow up a
         taf.meant_life_end_weeks = taf.deliberately_harmed_meant_end #renamed to match follow up a
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 #mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.followupb.raw.id)
# Inspect colnames
colnames(taf.ramp.followupb.raw.id)
#Differences
dim(taf.ramp.followupb.raw)[1]-dim(taf.ramp.followupb.raw.id)[1]
}
```


# Source script for synchronising gender categories - GLAD, EDGI, NBR
RAMP has the correct Gender categories so does not need editing.
```{r nbr dem calculating age from birthday}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE) {
source("./gender_glad_edgi_nbr.R")
}
```

# Source script for synchronising gender categories - GLAD, EDGI, NBR
RAMP has the correct Gender categories so does not need editing.
```{r nbr dem calculating age from birthday}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
source("./ethnicity_ALLdatasets.R")
}
```


#CLEANING DEMOGRAPHICS 
##AGE
###Source script for CREATING AGE variable in nbr (age_unc), cleaning it (in all datasets), and categorising it (nbr, edgi, glad - to match ramp)

```{r source script age}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | NBR == TRUE) {
source("./age_ALLdatasets.R")
}
```

##EDUCATION
###Call script for recoding highest education received, prepandemic (EDGI, GLAD) and baseline (EDGI, GLAD, NBR, RAMP)
```{r nbr dem calculating age from birthday}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | NBR == TRUE) {
source("./education_ALLdatasets.R")
}
```

##EMPLOYMENT
###Call script for recoding employment and key worker status
```{r nbr dem calculating age from birthday}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | NBR == TRUE) {
source("./employment_ALLdatasets.R")
}
```


##MENTAL HEALTH DIAGNOSIS
###Call script for recoding employment and key worker status
```{r nbr dem calculating age from birthday}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./mental_health_diagnosis_ALLdatasets.R")
}
```

### Controls
##EDGI & NBR controls **NEED to check this for NBR - getting no controls?
These individuals have no self report diagnosis of any kind that we measure.
```{r mhd control EDGI NBR}
if(EDGI == TRUE | NBR == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_eating_disorder_numeric  == "0" & #**Need to ask why these are here??
    mhd.prefer_not_to_answer_eating_disorder_numeric  == "0" &
    mhd.dont_know_numeric  == "0" &
    mhd.prefer_not_to_answer_numeric  == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric  == "0" &
    (mhd.none_of_the_above.1_numeric == "1" | is.na(mhd.none_of_the_above.1_numeric)) &
    (mhd.none_of_the_above.2_numeric == "1" | is.na(mhd.none_of_the_above.2_numeric)) &
    (mhd.none_of_the_above_eating_disorder_numeric == "1" | is.na(mhd.none_of_the_above_eating_disorder_numeric)), #Check this - this would mean 'controls' may have answered 'None of the above' to all but one, in which the remaining one is NA. Does this really make them a control?
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}

```

```{r EDGI NBR mhd check none of the above}
if(EDGI == TRUE | NBR == TRUE) {
mhd.raw.id %>%
  group_by(control) %>%
  count(
    mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above_eating_disorder
  )
}

```



##GLAD controls
```{r mhd control GLAD }
if(GLAD == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.dont_know_eating_disorder_numeric == "0" &
    mhd.prefer_not_to_answer_eating_disorder_numeric == "0" &
    mhd.none_of_the_above.1_numeric != "0" &
    mhd.none_of_the_above.2_numeric != "0" &
    mhd.none_of_the_above.3_numeric != "0" &
    mhd.none_of_the_above.4_numeric != "0" &
    mhd.none_of_the_above_eating_disorder_numeric != "0", #Check this - this would mean 'controls' may have answered 'None of the above' to all but one, in which the remaining one is NA. Does this really make them a control?
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}
```

```{r GLAD mhd check none of the above}
if(GLAD == TRUE) {
mhd.raw.id %>%
  select(
    control,
    mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above.3,
    mhd.none_of_the_above.4,
    mhd.none_of_the_above_eating_disorder
  )
mhd.raw.id %>%
  group_by(control) %>%
  count(
     mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above.3,
    mhd.none_of_the_above.4,
    mhd.none_of_the_above_eating_disorder 
  )
}
```

##RAMP controls
```{r mhd control GLAD RAMP}
if(RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.none_of_the_above_numeric  != "0" &
    mhd.none_of_the_above.1_numeric != "0",
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}
```

```{r RAMP mhd check none of the above}
if(RAMP == TRUE) {
mhd.raw.id %>%
  select(
    control,
    mhd.none_of_the_above,
    mhd.none_of_the_above.1
  )
mhd.raw.id %>%
  group_by(control) %>%
  count(
    mhd.none_of_the_above,
     mhd.none_of_the_above.1
  )
}
```

**Check - does this work with EDGI?
```{r Check control columns}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE | EDGI == TRUE) {
mhd.raw.id %>%
  select(
    control,
    depressive_disorders_numeric,
    anxiety_disorders_numeric,
    eating_disorders_numeric,
    obsessive_compulsive_disorders_numeric,
    psychotic_disorders_numeric,
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
    mhd.posttraumatic_stress_disorder_ptsd_numeric,
    autism_spectrum_disorder_numeric,
    mhd.attention_deficit_hyperactivity_disorder_numeric,
    mhd.personality_disorder_numeric
  )
}
```

#WAVES - TAF

## 1. Create a wave columns in follow up data - RAMP
```{r identify wave dates ramp}
if (RAMP ==TRUE) {
source("./wavesRAMP.R")

}
```

##2. Join TAF follow ups (RAMP)
```{r RANP join taf data}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- rbind(taf.ramp.followupa.raw.id,
    taf.ramp.followupb.raw.id)

#check column names
colnames(dat.raw.taf.ramp)
}
```

##1.Create a wave columns in follow up data - COPING
```{r identify wave dates ramp}
if (COPING ==TRUE) {
source("./wavesCOPING.R")

}

```

##2. Join TAF follow ups (COPING)
```{r COPING join taf}
if(COPING == TRUE) {
dat.raw.taf.coping <- rbind(taf.coping.followupa.raw.id,
    taf.coping.followupb.raw.id)


##Check col names
colnames(dat.raw.taf.coping)

##Check number of rows
nrow(dat.raw.taf.coping)

}
```

##Remove dup IDs (TAF COPING) [not in use]
```{r identify wave dates ramp, eval=FALSE, include=FALSE}
if (COPING ==TRUE) {
source("./DupIDs_TAF_COPING.R")

}

```
## 3. Change follow up TAF COPING to long format
```{r TAF COPING long format}

dat.raw.taf.coping <- dat.raw.taf.coping %>%
  group_by(wave_taf) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_taf, 
                     values_from = c(taf.worth_living_life_people_numeric,
                              taf.felt_weeks_past_numeric,
                              taf.have_you_contemplated_harming_yourself_numeric,
                              taf.felt_weeks_past.1_numeric,
                              taf.meant_life_end_weeks_numeric)) %>%
  select(-row)
  

```


##4. Select variables for dataset TAF COPING
```{r}
dat.raw.taf.coping <- dat.raw.taf.coping %>%
  select(ID,
         `taf.worth_living_life_people_numeric_Wave 2a`,
         `taf.worth_living_life_people_numeric_Wave 2b`,
         `taf.worth_living_life_people_numeric_Wave 3a`,
         `taf.worth_living_life_people_numeric_Wave 3b`,
         `taf.worth_living_life_people_numeric_Wave 4a`,
         `taf.worth_living_life_people_numeric_Wave 4b`,
         `taf.worth_living_life_people_numeric_Wave 5`,
         `taf.worth_living_life_people_numeric_Wave 6`,
         `taf.worth_living_life_people_numeric_Wave 7`,
         `taf.worth_living_life_people_numeric_Wave 8`,
         `taf.felt_weeks_past_numeric_Wave 2a`,
         `taf.felt_weeks_past_numeric_Wave 2b`,
         `taf.felt_weeks_past_numeric_Wave 3a`,
         `taf.felt_weeks_past_numeric_Wave 3b`,
         `taf.felt_weeks_past_numeric_Wave 4a`,
         `taf.felt_weeks_past_numeric_Wave 4b`,
         `taf.felt_weeks_past_numeric_Wave 5`,
         `taf.felt_weeks_past_numeric_Wave 6`,
         `taf.felt_weeks_past_numeric_Wave 7`,
         `taf.felt_weeks_past_numeric_Wave 8`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 2a`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 2b`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 3a`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 3b`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 4a`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 4b`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 5`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 6`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 7`,
         `taf.have_you_contemplated_harming_yourself_numeric_Wave 8`,
         `taf.felt_weeks_past.1_numeric_Wave 2a`,
         `taf.felt_weeks_past.1_numeric_Wave 2b`,
         `taf.felt_weeks_past.1_numeric_Wave 3a`,
         `taf.felt_weeks_past.1_numeric_Wave 3b`,
         `taf.felt_weeks_past.1_numeric_Wave 4a`,
         `taf.felt_weeks_past.1_numeric_Wave 4b`,
         `taf.felt_weeks_past.1_numeric_Wave 5`,
         `taf.felt_weeks_past.1_numeric_Wave 6`,
         `taf.felt_weeks_past.1_numeric_Wave 7`,
         `taf.felt_weeks_past.1_numeric_Wave 8`,
         `taf.meant_life_end_weeks_numeric_Wave 2a`,
         `taf.meant_life_end_weeks_numeric_Wave 2b`,
         `taf.meant_life_end_weeks_numeric_Wave 3a`,
         `taf.meant_life_end_weeks_numeric_Wave 3b`,
         `taf.meant_life_end_weeks_numeric_Wave 4a`,
         `taf.meant_life_end_weeks_numeric_Wave 4b`,
         `taf.meant_life_end_weeks_numeric_Wave 5`,
         `taf.meant_life_end_weeks_numeric_Wave 6`,
         `taf.meant_life_end_weeks_numeric_Wave 7`,
         `taf.meant_life_end_weeks_numeric_Wave 8`)
```

##5. Remove duplicate IDs TAF COPING
```{r}
##Check col names
colnames(dat.raw.taf.coping)

##Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
dat.raw.taf.coping2  <- dat.raw.taf.coping  %>%
  filter(., !duplicated(ID)) 

##Check number of rows
nrow(dat.raw.taf.coping2)

```

##Remove dup IDs (EDEQ COPING) [not in use]
```{r identify wave dates ramp}
if (COPING ==TRUE) {
source("./DupIDs_EDEQ_COPING.R")

}

```
## 6. Change follow up TAF COPING to long format
```{r TAF COPING long format}

edeq.coping.followupb.raw.id <- edeq.coping.followupb.raw.id %>%
  group_by(wave_edeq) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_edeq, 
                     values_from = c(edeq.deliberately_limit_amount_influence_numeric,
                              edeq.calories_made_body_shape_numeric,
                              edeq.weight_influenced_person_numeric,
                              edeq.dissatisfied_shape_weight_numeric,
                              edeq.eating_behaviours_distressed_concerns_numeric,
                              edeq.actively_been_monitoring_your_shape_or_weight_numeric,
                              edeq.regard_lost_control_eaten_numeric,
                              edeq.sick_means_made_shape_numeric,
                              edeq.diuretics_laxatives_means_shape_numeric,
                              edeq.compulsive_driven_burn_calories_numeric,
                              edeq.nibbled_picked_snacks_grazed_numeric,
                              edeq.felt_anxious_blue_bored_numeric,
                              edeq.felt_anxious_blue_bored.1_numeric)) %>%
  select(-row)
  

```

##7. Select variables for dataset EDEQ COPING
```{r}
edeq.coping.followupb.raw.id$ <- edeq.coping.followupb.raw.id  %>%
  select(ID,
         `taf.worth_living_life_people_numeric_Wave 2a`
         
         
         
```






  

















###JOINING DATASETS
##EDGI data frame list
```{r EDGI data frame list}
if(EDGI == TRUE) {
dfs.list <- list(
  edgi.coping.dem.raw.id,
edgi.coping.dem2.raw.id,
edgi.dem3.raw.id,
edgi.coping.dem4.employ.raw.id,
taf.edgi.coping.baseline.raw.id,
mhd.raw.id
#ADD EDEQ/TAF COPING
)
}
```

##GLAD data frame list
```{r GLAD data frame list}
if(GLAD == TRUE) {
dfs.list <- list(
    glad.coping.dem.raw.id,
glad.coping.dem2.raw.id,
glad.dem3.raw.id,
glad.coping.dem4.employ.raw.id,
taf.glad.coping.baseline.raw.id,
mhd.raw.id
#ADD EDEQ/TAF COPING
)
}
```

##NBR data frame list
```{r NBR data frame list}
if(NBR == TRUE) {
dfs.list <- list(
    nbr.dem.employ.raw.id,
nbr.dem.raw.id.complete,
nbr.dem2.raw.id,
mhd.raw.id,
taf.nbr.baseline.raw.id
#ADD EDEQ/TAF COPING
)
}

```


##RAMP data frame list
```{r RAMP data frame list}
if(RAMP == TRUE) {
dfs.list <- list(
    ramp.dem.employ.raw.id,
    ramp.dem.raw.id,
    mhd.raw.id,
    edeq.ramp.baseline.raw.id,
    #edeq.ramp.followupb.raw.id,
    taf.ramp.baseline.raw.id
    #taf.ramp.followupa.raw.id,
    #taf.ramp.followupb.raw.id
  
)

}
```



```{r Join all questionnaires}
if(RAMP == TRUE | NBR ==TRUE | EDGI == TRUE| GLAD == TRUE) {
dat.raw <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name") # Alternatively you can join by several columns EDGI -> "Age", "Sex", "Birthyear"
  )

#look at the data
colnames(dat.raw)
}

```


#Get rid of duplicates in all baseline data
```{r Check duplicates, eval=FALSE, include=FALSE}
dat.raw$ID.dup <- duplicated(dat.raw$ID)

summary(as.factor(dat.raw$ID.dup))

select(dat.raw)

 #Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw)))
names_freq[names_freq$Freq > 1, ]

##Filter out duplicate column names
 dat.dup <- dat.raw %>%
  filter(ID.dup == TRUE)

dat.raw.no.dup <- dat.raw %>%
  filter(ID.dup == FALSE)

colnames(dat.raw.no.dup)

```











# Export data
```{r export data, eval=FALSE, include=FALSE}
if(GLAD == TRUE){
saveRDS(object = dat.coping, file = paste0(data_path, "/glad.rds"))
}
if(EDGI == TRUE){
saveRDS(object = dat.coping, file = paste0(data_path, "/edgi.rds"))
}
if(NBR == TRUE){
saveRDS(object = dat.coping, file = paste0(data_path, "/nbr.rds"))
}
if(RAMP == TRUE){
saveRDS(object = dat.coping, file = paste0(data_path, "/ramp.rds"))
}
```





