---
title: "COPING_cleaning_dem"
author: "Helena Davies (based on PANCHANGE script by KP, KT, KY, TH)"
date: "15/12/2020"
output: html_document
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

#### Call in library script

```{r source files}
source("./libraries.R")
```


#Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

#### R functions

```{r call in function library functions}
# source all functions in the function folder
source("./functions.R")
```


# Specify cohort
```{r Specify cohort}
GLAD = FALSE
EDGI = FALSE
RAMP = TRUE
NBR = FALSE
COPING = FALSE
```


# Demographics 
## GLAD 1
### Read in data
```{r glad dem cols}
if(GLAD == TRUE){
glad.coping.dem.raw <- readRDS(file = "../data_raw/glad/dem_coping_glad.rds")
dim(glad.coping.dem.raw)
colnames(glad.coping.dem.raw)
}
```

### Select variables
```{r glad dem select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem.raw.id <- glad.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_pregnant,
         weight_lb_unc = dem.current_weight_provide_pregnant.1,
         weight_kg_unc = dem.current_weight_provide_pregnant.2,
         highest_weight_st_unc = dem.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = dem.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = dem.provide_pregnant_weighed_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.adult_height_lowest_weight.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem.raw.id)
# Inspect colnames
colnames(glad.coping.dem.raw.id)
#Differences
dim(glad.coping.dem.raw)[1]-dim(glad.coping.dem.raw.id)[1]
}

```

###Summarise 
```{r glad dem summary, eval=FALSE, include=FALSE}
if(GLAD == TRUE) {
summarytools::dfSummary(
  glad.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## GLAD 2
### Read in data
```{r glad dem2 cols}
if(GLAD == TRUE){
glad.coping.dem2.raw <- readRDS(file = "../data_raw/glad/dem2_coping_glad.rds")
dim(glad.coping.dem2.raw)
colnames(glad.coping.dem2.raw)
}
```

### Select variables
```{r glad dem2 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem2.raw.id <- glad.coping.dem2.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1,
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem2.raw.id)
# Inspect colnames
colnames(glad.coping.dem2.raw.id)
#Differences
dim(glad.coping.dem2.raw)[1]-dim(glad.coping.dem2.raw.id)[1]
}

```

###Summarise 
```{r glad dem2 summary, eval=FALSE, include=FALSE}
if(GLAD == TRUE) {
summarytools::dfSummary(
  glad.coping.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## GLAD 3  [sign up]
### Read in data
```{r glad dem3 cols}
if(GLAD == TRUE){
glad.dem3.raw <- readRDS(file = "../data_raw/glad/dem_glad.rds")
dim(glad.dem3.raw)
colnames(glad.dem3.raw)
}
```

### Select variables
```{r glad dem3 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.dem3.raw.id <- glad.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         age_unc = dem.how_old_are_you_now.txt,
         ethnicity_unc = dem.questions_based_ethnic_origin,
         ethnicity_unc_text = dem.questions_based_ethnic_origin.txt,
         dem.college_or_university_degree,
         dem.a_levelsas_levels_or_equivalent,
         dem.o_levelsgcses_or_equivalent,
         dem.cses_or_equivalent,
         dem.nvq_or_hnd_or_hnc_or_equivalent,
         dem.other_professional_qualifications,
         dem.other_professional_qualifications_text.txt,
         dem.none_of_the_above_education = dem.none_of_the_above,
         transgender = dem.do_you_identify_as_transgender
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.dem3.raw.id)
# Inspect colnames
colnames(glad.dem3.raw.id)
#Differences
dim(glad.dem3.raw)[1]-dim(glad.dem3.raw.id)[1]
}

```

# Demographics 
## EDGI 
### Read in data
```{r edgi dem cols}
if(EDGI == TRUE){
edgi.coping.dem.raw <- readRDS(file = "../data_raw/edgi/dem_coping_edgi.rds")
dim(edgi.coping.dem.raw)
colnames(edgi.coping.dem.raw)
}
```

### Select variables
```{r edgi dem select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem.raw.id <- edgi.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_weight,
         weight_lb_unc = dem.current_weight_provide_weight.1,
         weight_kg_unc = dem.current_weight_provide_weight.2,
         highest_weight_st_unc = dem.provide_weighed_pregnant_weight,
         highest_weight_lb_unc = dem.provide_weighed_pregnant_weight.1,
         highest_weight_kg_unc = dem.provide_weighed_pregnant_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.lowest_weight_adult_height.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem.raw.id)
# Inspect colnames
colnames(edgi.coping.dem.raw.id)
#Differences
dim(edgi.coping.dem.raw)[1]-dim(edgi.coping.dem.raw.id)[1]
}

```
###Summarise 
```{r edgi dem summarise}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## EDGI 2
### Read in data
```{r edgi dem2 cols}
if(EDGI == TRUE){
edgi.coping.dem2.raw <- readRDS(file = "../data_raw/edgi/dem2_coping_edgi.rds")
dim(edgi.coping.dem2.raw)
colnames(edgi.coping.dem2.raw)
}
```

### Select variables
```{r edgi dem2 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem2.raw.id <- edgi.coping.dem2.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital, #To match name in GLAD
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1,
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem2.raw.id)
# Inspect colnames
colnames(edgi.coping.dem2.raw.id)
#Differences
dim(edgi.coping.dem2.raw)[1]-dim(edgi.coping.dem2.raw.id)[1]
}

```

###Summarise 
```{r edgi dem2 summarise, eval=FALSE, include=FALSE}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.coping.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## EDGI 3  [sign up]
### Read in data
```{r EDGI dem3 cols}
if(EDGI == TRUE){
edgi.dem3.raw <- readRDS(file = "../data_raw/edgi/demographics_edgi.rds")
dim(edgi.dem3.raw)
colnames(edgi.dem3.raw)
}
```

### Select variables
```{r edgi dem3 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.dem3.raw.id <- edgi.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         age_unc = dem.how_old_are_you_now.txt,
         ethnicity_unc = demographics.what_is_your_ethnic_origin,
         ethnicity_unc_text = demographics.what_is_your_ethnic_origin.txt,
         transgender = demographics.do_you_consider_yourself_to_be_transgender,
         demographics.collegeuniversity,
         demographics.asa_levels,
         demographics.cse,
         demographics.gcse,
         demographics.nvq,
         demographics.other.1,
         demographics.none_of_the_above,
         demographics.other_text.txt.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.dem3.raw.id)
# Inspect colnames
colnames(edgi.dem3.raw.id)
#Differences
dim(edgi.dem3.raw)[1]-dim(edgi.dem3.raw.id)[1]
}

```

# Demographics 
## GLAD 4 employment 
### Read in data
```{r GLAD dem4 cols}
if(GLAD == TRUE){
glad.coping.dem4.employ.raw <- readRDS(file = "../data_raw/glad/employ_coping_glad.rds")
dim(glad.coping.dem4.employ.raw)
colnames(glad.coping.dem4.employ.raw)
}

```
### Select variables
```{r glad dem4 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role = employ.role_type, #renamed to be same as edgi
         employ.type_role.txt = employ.role_type.txt, #renamed to be same as edgi
         employ.type_role.1 = employ.role_type.1, #renamed to be same as edgi
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.job_due_losing_risk, #renamed to be same as edgi
         employ.increased_due_job_pandemic = employ.increased_job_due_pandemic #renamed to be same as edgi
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem4.employ.raw.id)
# Inspect colnames
colnames(glad.coping.dem4.employ.raw.id)
#Differences
dim(glad.coping.dem4.employ.raw)[1]-dim(glad.coping.dem4.employ.raw.id)[1]
}

```

# Demographics 
## EDGI 4 employment
### Read in data
```{r EDGI dem4 cols}
if(EDGI == TRUE){
edgi.coping.dem4.employ.raw <- readRDS(file = "../data_raw/edgi/employ_coping_edgi.rds")
dim(edgi.coping.dem4.employ.raw)
colnames(edgi.coping.dem4.employ.raw)
}
```

### Select variables
```{r edgi dem4 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt,
         employ.type_role.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk,
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem4.employ.raw.id)
# Inspect colnames
colnames(edgi.coping.dem4.employ.raw.id)
#Differences
dim(edgi.coping.dem4.employ.raw)[1]-dim(edgi.coping.dem4.employ.raw.id)[1]

}

```
# Demographics 
## NBR 1
### Read in data
```{r nbr dem1 cols}
if(NBR == TRUE){
nbr.dem.raw <- readRDS(file = "../data_raw/nbr/demographics_coping_nbr.rds")
dim(nbr.dem.raw)
colnames(nbr.dem.raw)
}

```

### Select variables
```{r nbr dem1 select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem.raw.id <- nbr.dem.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = demographics.which_gender_do_you_identify_with, # Gender
         sex = demographics.select_questionnaire_items_medical, #Sex
         pregnant_binary = demographics.baby_pregnant_months,
         birthday_day = demographics.day,
         birthday_month = demographics.month,
         birthday_year = demographics.year,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = demographics.what_is_your_current_height,
         height_inch_unc = demographics.what_is_your_current_height.1,
         height_cm_unc = demographics.what_is_your_current_height.2,
         weight_st_unc = demographics.provide_current_weight_pregnant,
         weight_lb_unc = demographics.provide_current_weight_pregnant.1,
         weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         highest_weight_st_unc = demographics.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = demographics.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         lowest_weight_st_unc = demographics.adult_height_reaching_weighed,
         lowest_weight_lb_unc = demographics.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = demographics.adult_height_reaching_weighed.2,
         age_highest_weight_unc = demographics.highest_weight.txt,
         age_lowest_weight_unc = demographics.adult_height_lowest_weight.txt,
         uk_location = demographics.live,
         current_country = demographics.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem.raw.id)
# Inspect colnames
colnames(nbr.dem.raw.id)
#Differences
dim(nbr.dem.raw)[1]-dim(nbr.dem.raw.id)[1]
}

```

# Demographics 
## NBR 2
### Read in data
```{r nbr dem2 cols}
if(NBR == TRUE){
nbr.dem2.raw <- readRDS(file = "../data_raw/nbr/dem_coping_nbr.rds")
dim(nbr.dem2.raw)
colnames(nbr.dem2.raw)
}
```

### Select variables
```{r nbr dem2 select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem2.raw.id <- nbr.dem2.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living = dem2.spouse_members_partner_living, #Renamed to be same as edgi/glad
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1 = dem2.spouse_members_partner_living.1, #Renamed to be same as edgi/glad
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place = dem2.relationships_describe_place_question, #Renamed to be same as edgi/glad
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital, #To match name in GLAD
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem2.raw.id)
# Inspect colnames
colnames(nbr.dem2.raw.id)
#Differences
dim(nbr.dem2.raw)[1]-dim(nbr.dem2.raw.id)[1]
}

```

###Summarise 
```{r nbr dem2 summary, eval=FALSE, include=FALSE}
if(NBR == TRUE) {
summarytools::dfSummary(
  nbr.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## NBR employment 
### Read in data
```{r nbr dem employ cols}
if(NBR == TRUE){
nbr.dem.employ.raw <- readRDS(file = "../data_raw/nbr/employ_coping_nbr.rds")
dim(nbr.dem.employ.raw)
colnames(nbr.dem.employ.raw)
}
```

### Select variables
```{r nbr dem employ select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem.employ.raw.id <- nbr.dem.employ.raw%>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt,
         employ.type_role.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.job_due_losing_risk, #renamed to same as edgi
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem.employ.raw.id)
# Inspect colnames
colnames(nbr.dem.employ.raw.id)
#Differences
dim(nbr.dem.employ.raw)[1]-dim(nbr.dem.employ.raw.id)[1]
}

```

# Demographics 
## RAMP
### Read in data
```{r ramp dem cols}
if(RAMP == TRUE){
ramp.dem.raw <- readRDS(file = "../data_raw/ramp/dem_ramp.rds")
dim(ramp.dem.raw)
colnames(ramp.dem.raw)
}
```

### Select variables
```{r ramp dem select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

ramp.dem.raw.id <- ramp.dem.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column
  select(
         ID = `Login ID`,# ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         age_unc = dem2.how_old_are_you,
         gender_unc = dem2.which_gender_do_you_identify_with, # Gender
         pregnant_binary = dem2.are_you_pregnant, 
         #dem2.what_is_your_current_maritalrelationship_status #Not in COPING 
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3 = dem2.living_children_under_the_age_of_18, #Renamed to be same as coping glad/edgi
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_members_partner_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.relationships_describe_question_place = dem2.describe_relationships_live_living, #Rename to be same as coping glad/edgi
         dem2.household_living_place_answer, 
         dem2.include_living_areas_count = dem2.count_bathrooms_bedrooms_hallways,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.none,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         transgender = dem2.do_you_identify_as_transgender,
         dem2.adult_children_pandemic_returned,
         dem2.adult_children_pandemic_returned.txt,
         dem.live = dem2.where_in_the_uk_do_you_live.txt, #changed wording to match glad edgi dem
         ethnicity_unc_text = dem2.what_is_your_ethnic_origin.txt,
         ethnicity_unc = dem2.what_is_your_ethnic_origin,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.living_children_under_the_age_of_18.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_members_partner_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.household_living_place_answer,
         dem2.do_you_have_any_children,
         dem2.adult_children_home_living.1,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.ramp_study_hear.txt,
         dem2.ramp_study_hear
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp.dem.raw.id)
# Inspect colnames
colnames(ramp.dem.raw.id)
#Differences
dim(ramp.dem.raw)[1]-dim(ramp.dem.raw.id)[1]
}

```
# Demographics 
## RAMP employment
### Read in data
```{r ramp dem employ cols}
if(RAMP == TRUE){
ramp.dem.employ.raw <- readRDS(file = "../data_raw/ramp/employ_ramp.rds")
dim(ramp.dem.employ.raw)
colnames(ramp.dem.employ.raw)
}
```

### Select variables
```{r ramp dem employ select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

ramp.dem.employ.raw.id <- ramp.dem.employ.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #employ.phd,
         #employ.masters_degree_or_equivalent,
         #employ.postgraduate_degree_or_equivalent,
         #employ.bachelors_degree_or_equivalent,
         #employ.a_levelsas_levels_or_equivalent,
         #employ.o_levelsgcses_or_equivalent,
         #employ.cses_or_equivalent,
         #employ.nvq_or_hnd_or_hnc_or_equivalent,
         #employ.other_professional_qualifications_e.g._nursing_teaching,
         #employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.what_is_your_highest_level_of_education,
         #employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         #employ.taking_unpaid_leave, #Not in RAMP
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work = employ.work_attend_work_encouraged, #renamed to same as edgi and glsd
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt = employ.role_type.txt,
         employ.type_role.1 = employ.role_type.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.scale_line_losing_click,
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp.dem.employ.raw.id)
# Inspect colnames
colnames(ramp.dem.employ.raw.id)
#Differences
dim(ramp.dem.employ.raw)[1]-dim(ramp.dem.employ.raw.id)[1]
}

```
# EDEQ
## COPING follow up b [nbr, glad + edgi]
### Read in data
```{r coping edeq follow up b cols}
if(COPING == TRUE){
edeq.coping.followupb.raw <- readRDS(file = "../data_raw/coping/edeq_coping_followupb.rds")
dim(edeq.coping.followupb.raw)
colnames(edeq.coping.followupb.raw)
}
```

### Select variables
```{r edeq coping select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

edeq.coping.followupb.raw.id <- edeq.coping.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape = edeq.calories_made_body_shape,
         edeq.weight_influenced_person = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight = edeq.dissatisfied_shape_weight,
         edeq.actively_been_monitoring_your_shape_or_weight = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories = edeq.compulsive_driven_burn_calories,
         edeq.eating_behaviours_distressed_concerns = edeq.eating_behaviours_distressed_concerns,
         edeq.nibbled_picked_snacks_grazed  = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1 = edeq.felt_anxious_blue_bored.1,
         edeq.experiences_pandemic = edeq.experiences_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  #mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.coping.followupb.raw.id)
# Inspect colnames
colnames(edeq.coping.followupb.raw.id)
#Differences
dim(edeq.coping.followupb.raw)[1]-dim(edeq.coping.followupb.raw.id)[1]
}
```

### Read in screener data
```{r coping edeq follow up b cols}
if(COPING == TRUE){
edeq.coping.followupb.screener.raw <- readRDS(file = "../data_raw/coping/ed_scid5_coping_followupb.rds")
dim(edeq.coping.followupb.screener.raw)
colnames(edeq.coping.followupb.screener.raw)
}
```
### Select variables
```{r edeq coping select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         ed_scid5.regular_episodes_eating_binges,
         ed_scid5.weigh_weighed_past_month
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  #mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.coping.followupb.screener.raw.id)
# Inspect colnames
colnames(edeq.coping.followupb.screener.raw.id)
#Differences
dim(edeq.coping.followupb.screener.raw)[1]-dim(edeq.coping.followupb.screener.raw.id)[1]
}
```

# EDEQ
## RAMP baseline
### Read in data
```{r RAMP edeq baseline cols}
if(RAMP == TRUE){
edeq.ramp.baseline.raw <- readRDS(file = "../data_raw/ramp/edeq_ramp.rds")
dim(edeq.ramp.baseline.raw)
colnames(edeq.ramp.baseline.raw)
}
```
### Select variables
```{r ramp edeq baseline select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edeq.ramp.baseline.raw.id <- edeq.ramp.baseline.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence_.Wavebaseline = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape_.Wavebaseline = edeq.calories_made_body_shape,
         edeq.weight_influenced_person_.Wavebaseline = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight_.Wavebaseline = edeq.dissatisfied_shape_weight,
         edeq.nibbled_picked_snacks_grazed_.Wavebaseline = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored_.Wavebaseline = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1_.Wavebaseline = edeq.felt_anxious_blue_bored.1,
         edeq.eating_behaviours_concerns_distressed_.Wavebaseline = edeq.eating_behaviours_concerns_distressed,
         edeq.deliberately_limit_amount_influence.1_.Wavebaseline = edeq.deliberately_limit_amount_influence.1,
         edeq.calories_made_body_shape.1_.Wavebaseline = edeq.calories_made_body_shape.1,
         edeq.weight_influenced_person.1_.Wavebaseline = edeq.weight_influenced_person.1,
         edeq.dissatisfied_shape_weight.1_.Wavebaseline = edeq.dissatisfied_shape_weight.1,
         edeq.eating_behaviours_concerns_distressed.1_.Wavebaseline = edeq.eating_behaviours_concerns_distressed.1,
         edeq.feelings_pandemic_felt_.Wavebaseline = edeq.feelings_pandemic_felt,
         edeq.actively_been_monitoring_your_shape_or_weight_.Wavebaseline = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten_.Wavebaseline = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape_.Wavebaseline = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape_.Wavebaseline = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories_.Wavebaseline = edeq.compulsive_driven_burn_calories,
         edeq.nibbled_picked_snacks_grazed.1_.Wavebaseline = edeq.nibbled_picked_snacks_grazed.1,
         edeq.felt_anxious_blue_bored.2_.Wavebaseline = edeq.felt_anxious_blue_bored.2,
         edeq.felt_anxious_blue_bored.3_.Wavebaseline = edeq.felt_anxious_blue_bored.3,
         edeq.actively_been_monitoring_your_shape_or_weight_.1_.Wavebaseline = edeq.actively_been_monitoring_your_shape_or_weight_.1,
         edeq.regard_lost_control_eaten.1_.Wavebaseline = edeq.regard_lost_control_eaten.1,
         edeq.sick_means_made_shape.1_.Wavebaseline = edeq.sick_means_made_shape.1,
         edeq.diuretics_laxatives_means_shape.1_.Wavebaseline = edeq.diuretics_laxatives_means_shape.1,
         edeq.compulsive_driven_burn_calories.1_.Wavebaseline = edeq.compulsive_driven_burn_calories.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.ramp.baseline.raw.id)
# Inspect colnames
colnames(edeq.ramp.baseline.raw.id)
#Differences
dim(edeq.ramp.baseline.raw)[1]-dim(edeq.ramp.baseline.raw.id)[1]
}

```

### Read in screener data
```{r RAMP edeq follow up b cols}
if(RAMP == TRUE){
edeq.ramp.followupb.screener.raw <- readRDS(file = "../data_raw/ramp/ed_scid5_ramp_followupb.rds")
dim(edeq.ramp.followupb.screener.raw)
colnames(edeq.ramp.followupb.screener.raw)
}
```
### Select variables
```{r RAMP coping select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         ed_scid5.regular_episodes_eating_binges,
         ed_scid5.weigh_weighed_past_month
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  #mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.ramp.followupb.screener.raw.id)
# Inspect colnames
colnames(edeq.ramp.followupb.screener.raw.id)
#Differences
dim(edeq.ramp.followupb.screener.raw)[1]-dim(edeq.ramp.followupb.screener.raw.id)[1]
}
```


##Check earliest date of baseline being filled in by RAMP participants
```{r}
if(RAMP == TRUE){

x <- as.Date(edeq.ramp.baseline.raw.id$startDate_baseline)

min(x )
}
```

##Exclude people who answered baseline questionnaire after 18th May (first follow up questinnaire sent out on 19th May)
1. Change date format
```{r}
if(RAMP == TRUE){

as.Date(edeq.ramp.baseline.raw.id$startDate_baseline)

edeq.ramp.baseline.raw.id <- edeq.ramp.baseline.raw.id %>%
  filter(startDate_baseline < as.Date("2020-04-21"))

#Drop start date baseline column

edeq.ramp.baseline.raw.id <- edeq.ramp.baseline.raw.id %>%
  select(-c(startDate_baseline,
            startDate_baseline_numeric))

}
```


# EDEQ
## RAMP follow up b
### Read in data
```{r RAMP edeq follow up b cols}
if(RAMP == TRUE){
edeq.ramp.followupb.raw <- readRDS(file = "../data_raw/ramp/edeq_ramp_followupb.rds")
dim(edeq.ramp.followupb.raw)
colnames(edeq.ramp.followupb.raw)

}
```
### Select variables
```{r ramp edeq follow up b select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

edeq.ramp.followupb.raw.id <- edeq.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape = edeq.calories_made_body_shape,
         edeq.weight_influenced_person = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight = edeq.dissatisfied_shape_weight,
         edeq.actively_been_monitoring_your_shape_or_weight = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories = edeq.compulsive_driven_burn_calories,
         edeq.eating_behaviours_distressed_concerns = edeq.eating_behaviours_distressed_concerns,
         edeq.nibbled_picked_snacks_grazed = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1 = edeq.felt_anxious_blue_bored.1,
         #edeq.experiences_pandemic #not in ramp but in coping
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) 
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.ramp.followupb.raw.id)
# Inspect colnames
colnames(edeq.ramp.followupb.raw.id)
#Differences
dim(edeq.ramp.followupb.raw)[1]-dim(edeq.ramp.followupb.raw.id)[1]
}


```

###EDEQ scoring

The EDE, and its self-report version, the EDE-Q, generate two types of data. First, they provide
frequency data on key behavioural features of eating disorders in terms of number of episodes of the
behaviour and in some instances number of days on which the behaviour has occurred. Second, they
provide subscale scores reflecting the severity of aspects of the psychopathology of eating disorders.
The subscales are Restraint, Eating Concern, Shape Concern and Weight Concern. To obtain a
particular subscale score, the ratings for the relevant items (listed below) are added together and the sum
divided by the total number of items forming the subscale. If ratings are only available on some items, a
score may nevertheless be obtained by dividing the resulting total by the number of rated items so long
as more than half the items have been rated. To obtain an overall or global score, the four subscales
scores are summed and the resulting total divided by the number of subscales (i.e. four). Subscale
scores are reported as means and standard deviations.

# TAF - baseline 
## GLAD 
### Read in data
```{r GLAD taf sign up cols}
if(GLAD == TRUE){
taf.glad.coping.baseline.raw <- readRDS(file = "../data_raw/glad/taf_coping_glad.rds")
dim(taf.glad.coping.baseline.raw)
colnames(taf.glad.coping.baseline.raw)
}

```

### Select variables
```{r GLAD sign up taf select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.glad.coping.baseline.raw.id <- taf.glad.coping.baseline.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_life_thoughts, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.glad.coping.baseline.raw.id)
# Inspect colnames
colnames(taf.glad.coping.baseline.raw.id)
#Differences
dim(taf.glad.coping.baseline.raw)[1]-dim(taf.glad.coping.baseline.raw.id)[1]
}


```
##Exclude people who answered baseline questionnaire after 18th May (first follow up questinnaire sent out on 19th May)
1. Change date format
```{r}
if(GLAD == TRUE){

as.Date(taf.glad.coping.baseline.raw.id$startDate_baseline)


#Filter by people who completed baseline survey before 18th May


taf.glad.coping.baseline.raw.id <- taf.glad.coping.baseline.raw.id %>%
  filter(startDate_baseline < as.Date("2020-04-21"))


#Drop start date baseline column

taf.glad.coping.baseline.raw.id <- taf.glad.coping.baseline.raw.id %>%
  select(-c(startDate_baseline,
            startDate_baseline_numeric))
}
```



# TAF - baseline
## EDGI  
### Read in data
```{r EDGI taf sign up cols}
if(EDGI == TRUE){
taf.edgi.coping.baseline.raw <- readRDS(file = "../data_raw/edgi/taf_coping_edgi.rds")
dim(taf.edgi.coping.baseline.raw)
colnames(taf.edgi.coping.baseline.raw)
}
```

### Select variables
```{r EDGI sign up taf select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")


taf.edgi.coping.baseline.raw.id <- taf.edgi.coping.baseline.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.weeks_past_felt,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.weeks_past_felt.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_weeks_life, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) 
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.edgi.coping.baseline.raw.id)
# Inspect colnames
colnames(taf.edgi.coping.baseline.raw.id)
#Differences
dim(taf.edgi.coping.baseline.raw)[1]-dim(taf.edgi.coping.baseline.raw.id)[1]
}
```

##Exclude people who answered baseline questionnaire after 18th May (first follow up questinnaire sent out on 19th May)
1. Change date format
```{r}
if(EDGI == TRUE){

as.Date(taf.edgi.coping.baseline.raw.id$startDate_baseline)


#Filter by people who completed baseline survey before 18th May

taf.edgi.coping.baseline.raw.id <- taf.edgi.coping.baseline.raw.id %>%
  filter(startDate_baseline < as.Date("2020-04-21"))


#Drop start date baseline column

taf.edgi.coping.baseline.raw.id <- taf.edgi.coping.baseline.raw.id %>%
  select(-c(startDate_baseline,
            startDate_baseline_numeric))

}

```


# TAF - baseline 
## NBR 
### Read in data
```{r NBR taf sign up cols}
if(NBR == TRUE){
taf.nbr.baseline.raw <- readRDS(file = "../data_raw/nbr/taf_coping_nbr.rds")
dim(taf.nbr.baseline.raw)
colnames(taf.nbr.baseline.raw)
}

```
### Select variables
```{r NBR sign up taf select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.nbr.baseline.raw.id <- taf.nbr.baseline.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  #mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) 
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.nbr.baseline.raw.id)
# Inspect colnames
colnames(taf.nbr.baseline.raw.id)
#Differences
dim(taf.nbr.baseline.raw)[1]-dim(taf.nbr.baseline.raw.id)[1]
}
```

##Exclude people who answered baseline questionnaire after 18th May (first follow up questinnaire sent out on 19th May)
1. Change date format
```{r}
if(NBR == TRUE){

as.Date(taf.nbr.baseline.raw.id$startDate_baseline)


#Filter by people who completed baseline survey before 18th May

taf.nbr.baseline.raw.id <- taf.nbr.baseline.raw.id %>%
  filter(startDate_baseline < as.Date("2020-04-21"))


#Drop start date baseline column

taf.nbr.baseline.raw.id <- taf.nbr.baseline.raw.id %>%
  select(-c(startDate_baseline,
            startDate_baseline_numeric))
}
```

# TAF - baseline 
## RAMP
### Read in data
```{r RAMP taf sign up cols}
if(RAMP == TRUE){
taf.ramp.baseline.raw <- readRDS(file = "../data_raw/ramp/taf_ramp.rds")
dim(taf.ramp.baseline.raw)
colnames(taf.ramp.baseline.raw)
}
```

### Select variables
```{r RAMP sign up taf select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.ramp.baseline.raw.id <- taf.ramp.baseline.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.weeks_past_felt.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.baseline.raw.id)
# Inspect colnames
colnames(taf.ramp.baseline.raw.id)
#Differences
dim(taf.ramp.baseline.raw)[1]-dim(taf.ramp.baseline.raw.id)[1]
}
```

##Check earliest date of baseline being filled in by RAMP participants
```{r}
if(RAMP == TRUE){

x <- as.Date(taf.ramp.baseline.raw.id$startDate_baseline)

min(x)
}
```

##Exclude people who answered baseline questionnaire after 18th May (first follow up questinnaire sent out on 19th May)
1. Change date format
```{r}
if(RAMP == TRUE){

as.Date(taf.ramp.baseline.raw.id$startDate_baseline)


#Filter by people who completed baseline survey before 18th May
taf.ramp.baseline.raw.id <- taf.ramp.baseline.raw.id %>%
  filter(startDate_baseline < as.Date("2020-04-21"))


#Drop start date baseline column

taf.ramp.baseline.raw.id <- taf.ramp.baseline.raw.id %>%
  select(-c(startDate_baseline,
            startDate_baseline_numeric))
}
```

# TAF - follow up A
## COPING (first 2 waves)
### Read in data
```{r COPING taf follow up a cols}
if(COPING == TRUE){
taf.coping.followupa.raw.1 <- readRDS(file = "../data_raw/coping/taf_coping_followupa.rds")
dim(taf.coping.followupa.raw.1)
colnames(taf.coping.followupa.raw.1)
}
```

### Select variables
```{r COPING taf follow up a select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.coping.followupa.raw.id.1 <- taf.coping.followupa.raw.1 %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupa.raw.id.1)
# Inspect colnames
colnames(taf.coping.followupa.raw.id.1)
#Differences
dim(taf.coping.followupa.raw.1)[1]-dim(taf.coping.followupa.raw.id.1)[1]
}
```

# TAF - follow up A
## COPING (subsequent waves)
### Read in data
```{r COPING taf follow up a cols}
if(COPING == TRUE){
taf.coping.followupa.raw.2 <- readRDS(file = "../data_raw/coping/taf_coping_followupa_ongoing.rds")
dim(taf.coping.followupa.raw.2)
colnames(taf.coping.followupa.raw.2)
}
```

### Select variables
```{r COPING taf follow up a select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.coping.followupa.raw.id.2 <- taf.coping.followupa.raw.2 %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
# mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupa.raw.id.2)
# Inspect colnames
colnames(taf.coping.followupa.raw.id.2)
#Differences
dim(taf.coping.followupa.raw.2)[1]-dim(taf.coping.followupa.raw.id.2)[1]
}
```

#Combine taf coping follow up A datasets 
```{r}
if(COPING == TRUE){
    taf.coping.followupa.raw.id <- rbind(taf.coping.followupa.raw.id.2, taf.coping.followupa.raw.id.1) ##**Note that some people may be in both datasets, i.e. answered the questionnaire using the original link during the time period that is considered the start of the 'ongoing' dataset, before realising and answering through the correct link. Example - questionnaires answered on the 29th July are present in both datasets. This is fine - as long as it's different people. Will need to filter by duplicate ID and duplicate wave once wave variable is created.
  
# Inspect dimensions
  dim(taf.coping.followupa.raw.id)
# Inspect colnames
  colnames(taf.coping.followupa.raw.id)
}
```


# TAF - follow up b
## COPING
### Read in data
```{r COPING taf follow up b cols}
if(COPING == TRUE){
taf.coping.followupb.raw <- readRDS(file = "../data_raw/coping/taf_coping_followupb.rds")
dim(taf.coping.followupb.raw)
colnames(taf.coping.followupb.raw)
}
```

### Select variables
```{r COPING taf follow up b select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.coping.followupb.raw.id <- taf.coping.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
 # distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.weeks_past_felt, #renamed to same follow up a
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.weeks_past_felt.1, #renamed to same follow up a
         taf.meant_life_end_weeks = taf.deliberately_harmed_meant_end #renamed to same follow up a
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
 # mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupb.raw.id)
# Inspect colnames
colnames(taf.coping.followupb.raw.id)
#Differences
dim(taf.coping.followupb.raw)[1]-dim(taf.coping.followupb.raw.id)[1]
}
```
# TAF - follow up A
## RAMP
### Read in data
```{r RAMP taf follow up a cols}
if(RAMP == TRUE){
taf.ramp.followupa.raw <- readRDS(file = "../data_raw/ramp/taf_ramp_followupa.rds")
dim(taf.ramp.followupa.raw)
colnames(taf.ramp.followupa.raw)
}
```

### Select variables
```{r RAMP taf follow up a select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.ramp.followupa.raw.id <- taf.ramp.followupa.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 # mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
#  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.followupa.raw.id)
# Inspect colnames
colnames(taf.ramp.followupa.raw.id)
#Differences
dim(taf.ramp.followupa.raw)[1]-dim(taf.ramp.followupa.raw.id)[1]
}
```
# TAF - follow up B
## RAMP
### Read in data
```{r RAMP taf follow up b cols}
if(RAMP == TRUE){
taf.ramp.followupb.raw <- readRDS(file = "../data_raw/ramp/taf_ramp_followupb.rds")
dim(taf.ramp.followupb.raw)
colnames(taf.ramp.followupb.raw)
}
```
### Select variables
```{r RAMP taf follow up b select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.ramp.followupb.raw.id <- taf.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  #distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.weeks_past_felt, #renamed to match follow up a
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.weeks_past_felt.1, #renamed to match follow up a
         taf.meant_life_end_weeks = taf.deliberately_harmed_meant_end #renamed to match follow up a
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 #mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
 # mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.followupb.raw.id)
# Inspect colnames
colnames(taf.ramp.followupb.raw.id)
#Differences
dim(taf.ramp.followupb.raw)[1]-dim(taf.ramp.followupb.raw.id)[1]
}
```

#CLEANING DEMOGRAPHICS 

# GENDER - Source script for synchronising gender categories - GLAD, EDGI, NBR
RAMP has the correct Gender categories so does not need editing.
```{r nbr dem calculating age from birthday}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE) {
source("./gender_glad_edgi_nbr.R")
}
```

# ETHNICITY
```{r nbr dem calculating age from birthday}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
source("./ethnicity_ALLdatasets.R")
}
```

##AGE
###Source script for CREATING AGE variable in nbr (age_unc),cleaning it (in all datasets), and categorising it (nbr, edgi, glad - to match ramp)
```{r source script age}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./age_ALLdatasets.R")
}

```


##EDUCATION
###Call script for recoding highest education received, prepandemic (EDGI, GLAD) and baseline (EDGI, GLAD, NBR, RAMP)
```{r education all cohorts}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./education_ALLdatasets.R")
}


```

##EMPLOYMENT
###Call script for recoding employment and key worker status
```{r employment all cohorts}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./employment_ALLdatasets.R")
}
```


##MENTAL HEALTH DIAGNOSIS
###Call script for recoding/grouping mental health diagnoses
```{r mental health diagnoses all cohorts}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./mental_health_diagnosis_ALLdatasets.R")
}

```


### Controls
##EDGI 
These individuals have no self report diagnosis of any kind that we measure.
```{r mhd control EDGI}
if(EDGI == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_eating_disorder_numeric  == "0" & #**Need to ask why these are here??
    mhd.prefer_not_to_answer_eating_disorder_numeric  == "0" &
    mhd.dont_know_numeric  == "0" &
    mhd.prefer_not_to_answer_numeric  == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric  == "0" &
    (mhd.none_of_the_above.1_numeric == "1" | is.na(mhd.none_of_the_above.1_numeric)) &
    (mhd.none_of_the_above.2_numeric == "1" | is.na(mhd.none_of_the_above.2_numeric)) &
    (mhd.none_of_the_above_eating_disorder_numeric == "1" | is.na(mhd.none_of_the_above_eating_disorder_numeric)), #Check this - this would mean 'controls' may have answered 'None of the above' to all but one, in which the remaining one is NA. Does this really make them a control?
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}


```

### Controls
## NBR controls **NEED to check this for NBR - getting no controls?
#first need to recode PTSD variable
```{r}
if(NBR == TRUE) {

#change ptsd variable to numeric [wrongly coded] 2 == DIAGNOSIS OF PTSD, 1 == NO DIAGNOSIS OF PTSD
mhd.raw.id <- mhd.raw.id %>%
    mutate(
      mhd.posttraumatic_stress_disorder_ptsd_numeric =
        case_when(
          mhd.posttraumatic_stress_disorder_ptsd_numeric == "Not PTSD" ~ 0,
          mhd.posttraumatic_stress_disorder_ptsd_numeric == "PTSD" ~ 1,
          is.na(mhd.posttraumatic_stress_disorder_ptsd_numeric) ~ NA_real_))
}
```

These individuals have no self report diagnosis of any kind that we measure.
```{r mhd control NBR}
if(NBR == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_eating_disorder_numeric  == "0" & #**Need to ask why these are here??
    mhd.prefer_not_to_answer_eating_disorder_numeric  == "0" &
    mhd.dont_know_numeric  == "0" &
    mhd.prefer_not_to_answer_numeric  == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric  == "0" &
    (mhd.none_of_the_above.1_numeric == "1" | is.na(mhd.none_of_the_above.1_numeric)) &
    (mhd.none_of_the_above.2_numeric == "1" | is.na(mhd.none_of_the_above.2_numeric)) &
    (mhd.none_of_the_above_eating_disorder_numeric == "1" | is.na(mhd.none_of_the_above_eating_disorder_numeric)), #Check this - this would mean 'controls' may have answered 'None of the above' to all but one, in which the remaining one is NA. Does this really make them a control?
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}


```

```{r EDGI NBR mhd check none of the above}
if(EDGI == TRUE | NBR == TRUE) {
mhd.raw.id %>%
  group_by(control) %>%
  count(
    mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above_eating_disorder
  )
}

```
##GLAD controls
```{r mhd control GLAD }
if(GLAD == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.dont_know_eating_disorder_numeric == "0" &
    mhd.prefer_not_to_answer_eating_disorder_numeric == "0" &
    mhd.none_of_the_above.1_numeric != "0" &
    mhd.none_of_the_above.2_numeric != "0" &
    mhd.none_of_the_above.3_numeric != "0" &
    mhd.none_of_the_above.4_numeric != "0" &
    mhd.none_of_the_above_eating_disorder_numeric != "0", #Check this - this would mean 'controls' may have answered 'None of the above' to all but one, in which the remaining one is NA. Does this really make them a control?
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}


```

```{r GLAD mhd check none of the above}
if(GLAD == TRUE) {
mhd.raw.id %>%
  select(
    control,
    mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above.3,
    mhd.none_of_the_above.4,
    mhd.none_of_the_above_eating_disorder
  )
mhd.raw.id %>%
  group_by(control) %>%
  count(
     mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above.3,
    mhd.none_of_the_above.4,
    mhd.none_of_the_above_eating_disorder 
  )
}
```

##RAMP controls
```{r mhd control GLAD RAMP}
if(RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.none_of_the_above_numeric  != "0" &
    mhd.none_of_the_above.1_numeric != "0",
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}
```

```{r RAMP mhd check none of the above}
if(RAMP == TRUE) {
mhd.raw.id %>%
  select(
    control,
    mhd.none_of_the_above,
    mhd.none_of_the_above.1
  )
mhd.raw.id %>%
  group_by(control) %>%
  count(
    mhd.none_of_the_above,
     mhd.none_of_the_above.1
  )
}
```

**Check - does this work with EDGI? NBR?
```{r Check control columns}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE | EDGI == TRUE) {
mhd.raw.id %>%
  select(
    control,
    depressive_disorders_numeric,
    anxiety_disorders_numeric,
    eating_disorders_numeric,
    obsessive_compulsive_disorders_numeric,
    psychotic_disorders_numeric,
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
    mhd.posttraumatic_stress_disorder_ptsd_numeric,
    autism_spectrum_disorder_numeric,
    mhd.attention_deficit_hyperactivity_disorder_numeric,
    mhd.personality_disorder_numeric
  )
}
```



#WAVES - TAF

## 1. Create a wave columns in follow up data - RAMP
```{r identify wave dates ramp}
if (RAMP ==TRUE) {
source("./wavesRAMP.R")

}
```

##2. Join TAF follow ups (RAMP)
```{r RANP join taf data}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- rbind(taf.ramp.followupa.raw.id,
    taf.ramp.followupb.raw.id)

#check column names
colnames(dat.raw.taf.ramp)
}
```

## 3. Change follow up TAF RAMP to long format
```{r TAF COPING long format}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- dat.raw.taf.ramp %>%
  group_by(wave_taf) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_taf, 
                     values_from = c(taf.worth_living_life_people,
                              taf.felt_weeks_past,
                              taf.have_you_contemplated_harming_yourself,
                              taf.felt_weeks_past.1,
                              taf.meant_life_end_weeks)) %>%
  select(-row)
  
}

```

##4. Select variables for dataset TAF RAMP
```{r}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- dat.raw.taf.ramp %>%
  select(ID,
         `taf.worth_living_life_people_.Wave 1a`,
         `taf.worth_living_life_people_.Wave 1b`,
         `taf.worth_living_life_people_.Wave 2a`,
         `taf.worth_living_life_people_.Wave 2b`,
         `taf.worth_living_life_people_.Wave 3a`,
         `taf.worth_living_life_people_.Wave 3b`,
         `taf.worth_living_life_people_.Wave 4a`,
         `taf.worth_living_life_people_.Wave 4b`,
         `taf.worth_living_life_people_.Wave 5`,
         `taf.worth_living_life_people_.Wave 6`,
         `taf.worth_living_life_people_.Wave 7`,
         `taf.worth_living_life_people_.Wave 8`,
         `taf.felt_weeks_past_.Wave 1a`,
         `taf.felt_weeks_past_.Wave 1b`,
         `taf.felt_weeks_past_.Wave 2a`,
         `taf.felt_weeks_past_.Wave 2b`,
         `taf.felt_weeks_past_.Wave 3a`,
         `taf.felt_weeks_past_.Wave 3b`,
         `taf.felt_weeks_past_.Wave 4a`,
         `taf.felt_weeks_past_.Wave 4b`,
         `taf.felt_weeks_past_.Wave 5`,
         `taf.felt_weeks_past_.Wave 6`,
         `taf.felt_weeks_past_.Wave 7`,
         `taf.felt_weeks_past_.Wave 8`,
         `taf.have_you_contemplated_harming_yourself_.Wave 1a`,
         `taf.have_you_contemplated_harming_yourself_.Wave 1b`,
         `taf.have_you_contemplated_harming_yourself_.Wave 2a`,
         `taf.have_you_contemplated_harming_yourself_.Wave 2b`,
         `taf.have_you_contemplated_harming_yourself_.Wave 3a`,
         `taf.have_you_contemplated_harming_yourself_.Wave 3b`,
         `taf.have_you_contemplated_harming_yourself_.Wave 4a`,
         `taf.have_you_contemplated_harming_yourself_.Wave 4b`,
         `taf.have_you_contemplated_harming_yourself_.Wave 5`,
         `taf.have_you_contemplated_harming_yourself_.Wave 6`,
         `taf.have_you_contemplated_harming_yourself_.Wave 7`,
         `taf.have_you_contemplated_harming_yourself_.Wave 8`,
         `taf.felt_weeks_past.1_.Wave 1a`,
         `taf.felt_weeks_past.1_.Wave 1b`,
         `taf.felt_weeks_past.1_.Wave 2a`,
         `taf.felt_weeks_past.1_.Wave 2b`,
         `taf.felt_weeks_past.1_.Wave 3a`,
         `taf.felt_weeks_past.1_.Wave 3b`,
         `taf.felt_weeks_past.1_.Wave 4a`,
         `taf.felt_weeks_past.1_.Wave 4b`,
         `taf.felt_weeks_past.1_.Wave 5`,
         `taf.felt_weeks_past.1_.Wave 6`,
         `taf.felt_weeks_past.1_.Wave 7`,
         `taf.felt_weeks_past.1_.Wave 8`,
         `taf.meant_life_end_weeks_.Wave 1a`,
         `taf.meant_life_end_weeks_.Wave 1b`,
         `taf.meant_life_end_weeks_.Wave 2a`,
         `taf.meant_life_end_weeks_.Wave 2b`,
         `taf.meant_life_end_weeks_.Wave 3a`,
         `taf.meant_life_end_weeks_.Wave 3b`,
         `taf.meant_life_end_weeks_.Wave 4a`,
         `taf.meant_life_end_weeks_.Wave 4b`,
         `taf.meant_life_end_weeks_.Wave 5`,
         `taf.meant_life_end_weeks_.Wave 6`,
         `taf.meant_life_end_weeks_.Wave 7`,
         `taf.meant_life_end_weeks_.Wave 8`)
}
```

##5. Remove duplicate IDs TAF RAMP
```{r}
if(RAMP == TRUE) {
##Check col names
colnames(dat.raw.taf.ramp)

##Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
dat.raw.taf.ramp  <- dat.raw.taf.ramp %>%
  filter(., !duplicated(ID)) 

##Check number of rows
nrow(dat.raw.taf.ramp)
}

```

## 6. Change follow up EDEQ RAMP to long format
```{r EDEQ RAMP long format}
if(RAMP == TRUE) {
edeq.ramp.followupb.raw.id <- edeq.ramp.followupb.raw.id %>%
  group_by(wave_edeq) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_edeq, 
                     values_from = c(edeq.deliberately_limit_amount_influence,
                              edeq.calories_made_body_shape,
                              edeq.weight_influenced_person,
                              edeq.dissatisfied_shape_weight,
                              edeq.eating_behaviours_distressed_concerns,
                              edeq.actively_been_monitoring_your_shape_or_weight_numeric, ##Need numeric version
                              edeq.regard_lost_control_eaten_numeric, ##Need numeric version
                              edeq.sick_means_made_shape_numeric, ##Need numeric version
                              edeq.diuretics_laxatives_means_shape_numeric, ##Need numeric version
                              edeq.compulsive_driven_burn_calories_numeric, ##Need numeric version
                              edeq.nibbled_picked_snacks_grazed,
                              edeq.felt_anxious_blue_bored,
                              edeq.felt_anxious_blue_bored.1)) %>%
  select(-row)
  
}


```

##7. Select variables for dataset EDEQ RAMP
```{r}
if(RAMP == TRUE) {
edeq.ramp.followupb.raw.id <- edeq.ramp.followupb.raw.id  %>%
  select(ID,
         `edeq.deliberately_limit_amount_influence_.Wave 1b`,
         `edeq.deliberately_limit_amount_influence_.Wave 2b`,
         `edeq.deliberately_limit_amount_influence_.Wave 3b`,
         `edeq.deliberately_limit_amount_influence_.Wave 4b`,
         `edeq.deliberately_limit_amount_influence_.Wave 6`,
         `edeq.deliberately_limit_amount_influence_.Wave 8`,
         `edeq.calories_made_body_shape_.Wave 1b`,
         `edeq.calories_made_body_shape_.Wave 2b`,
         `edeq.calories_made_body_shape_.Wave 3b`,
         `edeq.calories_made_body_shape_.Wave 4b`,
         `edeq.calories_made_body_shape_.Wave 6`,
         `edeq.calories_made_body_shape_.Wave 8`,
         `edeq.weight_influenced_person_.Wave 1b`,
         `edeq.weight_influenced_person_.Wave 2b`,
         `edeq.weight_influenced_person_.Wave 3b`,
         `edeq.weight_influenced_person_.Wave 4b`,
         `edeq.weight_influenced_person_.Wave 6`,
         `edeq.weight_influenced_person_.Wave 8`,
         `edeq.dissatisfied_shape_weight_.Wave 1b`,
         `edeq.dissatisfied_shape_weight_.Wave 2b`,
         `edeq.dissatisfied_shape_weight_.Wave 3b`,
         `edeq.dissatisfied_shape_weight_.Wave 4b`,
         `edeq.dissatisfied_shape_weight_.Wave 6`,
         `edeq.dissatisfied_shape_weight_.Wave 8`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 1b`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 2b`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 3b`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 4b`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 6`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 8`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 1b`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 2b`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 3b`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 4b`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 6`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 8`,
          `edeq.regard_lost_control_eaten_numeric_.Wave 1b`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 2b`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 3b`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 4b`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 6`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 8`,
          `edeq.sick_means_made_shape_numeric_.Wave 1b`,
         `edeq.sick_means_made_shape_numeric_.Wave 2b`,
         `edeq.sick_means_made_shape_numeric_.Wave 3b`,
         `edeq.sick_means_made_shape_numeric_.Wave 4b`,
         `edeq.sick_means_made_shape_numeric_.Wave 6`,
         `edeq.sick_means_made_shape_numeric_.Wave 8`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 1b`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 2b`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 3b`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 4b`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 6`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 8`,
          `edeq.compulsive_driven_burn_calories_numeric_.Wave 1b`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 2b`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 3b`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 4b`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 6`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 8`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 1b`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 2b`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 3b`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 4b`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 6`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 8`,
          `edeq.felt_anxious_blue_bored_.Wave 1b`,
         `edeq.felt_anxious_blue_bored_.Wave 2b`,
         `edeq.felt_anxious_blue_bored_.Wave 3b`,
         `edeq.felt_anxious_blue_bored_.Wave 4b`,
         `edeq.felt_anxious_blue_bored_.Wave 6`,
         `edeq.felt_anxious_blue_bored_.Wave 8`,
          `edeq.felt_anxious_blue_bored.1_.Wave 1b`,
         `edeq.felt_anxious_blue_bored.1_.Wave 2b`,
         `edeq.felt_anxious_blue_bored.1_.Wave 3b`,
         `edeq.felt_anxious_blue_bored.1_.Wave 4b`,
         `edeq.felt_anxious_blue_bored.1_.Wave 6`,
         `edeq.felt_anxious_blue_bored.1_.Wave 8`)
}
```

##8. Remove duplicate IDs EDEQ RAMP
```{r}
if(RAMP == TRUE) {
##Check col names
colnames(edeq.ramp.followupb.raw.id)

##Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
edeq.ramp.followupb.raw.id  <- edeq.ramp.followupb.raw.id  %>%
  filter(., !duplicated(ID)) 

##Check number of rows
nrow(edeq.ramp.followupb.raw.id)
}

```

## 6. Change follow up EDEQ RAMP screener to long format
```{r EDEQ screener RAMP long format}
if(RAMP == TRUE) {
edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_edeq, 
                     values_from = c(ed_scid5.regular_episodes_eating_binges,
                                     ed_scid5.weigh_weighed_past_month,
                                     ed_scid5.regular_episodes_eating_binges_numeric,
                                     ed_scid5.weigh_weighed_past_month_numeric)) %>%
  select(-row)
  
}
```

##7. Select variables for dataset EDEQ RAMP screener
```{r}
if(RAMP == TRUE) {
edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw.id  %>%
  select(ID,
         cohort_name,
         `ed_scid5.regular_episodes_eating_binges_.Wave 1b` ,    
         `ed_scid5.regular_episodes_eating_binges_.Wave 2b` ,       
         `ed_scid5.regular_episodes_eating_binges_.Wave 3b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave 4b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave 6`,
         `ed_scid5.regular_episodes_eating_binges_.Wave 8`,
         `ed_scid5.weigh_weighed_past_month_.Wave 1b` ,             
         `ed_scid5.weigh_weighed_past_month_.Wave 2b`,               
         `ed_scid5.weigh_weighed_past_month_.Wave 3b`,               
         `ed_scid5.weigh_weighed_past_month_.Wave 4b` ,             
         `ed_scid5.weigh_weighed_past_month_.Wave 6`,
         `ed_scid5.weigh_weighed_past_month_.Wave 8`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 1b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 2b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 3b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 4b`, 
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 6`,  
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 6`,  
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 8`, 
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 1b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 2b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 3b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 4b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 6`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 8`)
}
```

##8. Remove duplicate IDs EDEQ RAMP screener
```{r}
if(RAMP == TRUE) {
##Check col names
colnames(edeq.ramp.followupb.screener.raw.id)

##Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
edeq.ramp.followupb.screener.raw.id  <- edeq.ramp.followupb.screener.raw.id  %>%
  filter(., !duplicated(ID)) 

##Check number of rows
nrow(edeq.ramp.followupb.screener.raw.id)
}

```

##1.Create a wave columns in follow up data - COPING
```{r identify wave dates coping}
if (COPING ==TRUE) {
source("./wavesCOPING.R")

}
```

##2. Join TAF follow ups (COPING)
```{r COPING join taf}
if(COPING == TRUE) {
dat.raw.taf.coping <- rbind(taf.coping.followupa.raw.id,
    taf.coping.followupb.raw.id)


##Check col names
colnames(dat.raw.taf.coping)

##Check number of rows
nrow(dat.raw.taf.coping)

}
```

## 3. Change follow up TAF COPING to long format
```{r TAF COPING long format}
if(COPING == TRUE) {
dat.raw.taf.coping <- dat.raw.taf.coping %>%
  group_by(wave_taf) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_taf, 
                     values_from = c(taf.worth_living_life_people,
                              taf.felt_weeks_past,
                              taf.have_you_contemplated_harming_yourself,
                              taf.felt_weeks_past.1,
                              taf.meant_life_end_weeks)) %>%
  select(-row)
  
}
```


##4. Select variables for dataset TAF COPING
```{r}
if(COPING == TRUE) {
dat.raw.taf.coping <- dat.raw.taf.coping %>%
  select(ID,
         `taf.worth_living_life_people_.Wave 2a`,
         `taf.worth_living_life_people_.Wave 2b`,
         `taf.worth_living_life_people_.Wave 3a`,
         `taf.worth_living_life_people_.Wave 3b`,
         `taf.worth_living_life_people_.Wave 4a`,
         `taf.worth_living_life_people_.Wave 4b`,
         `taf.worth_living_life_people_.Wave 5`,
         `taf.worth_living_life_people_.Wave 6`,
         `taf.worth_living_life_people_.Wave 7`,
         `taf.worth_living_life_people_.Wave 8`,
         `taf.felt_weeks_past_.Wave 2a`,
         `taf.felt_weeks_past_.Wave 2b`,
         `taf.felt_weeks_past_.Wave 3a`,
         `taf.felt_weeks_past_.Wave 3b`,
         `taf.felt_weeks_past_.Wave 4a`,
         `taf.felt_weeks_past_.Wave 4b`,
         `taf.felt_weeks_past_.Wave 5`,
         `taf.felt_weeks_past_.Wave 6`,
         `taf.felt_weeks_past_.Wave 7`,
         `taf.felt_weeks_past_.Wave 8`,
         `taf.have_you_contemplated_harming_yourself_.Wave 2a`,
         `taf.have_you_contemplated_harming_yourself_.Wave 2b`,
         `taf.have_you_contemplated_harming_yourself_.Wave 3a`,
         `taf.have_you_contemplated_harming_yourself_.Wave 3b`,
         `taf.have_you_contemplated_harming_yourself_.Wave 4a`,
         `taf.have_you_contemplated_harming_yourself_.Wave 4b`,
         `taf.have_you_contemplated_harming_yourself_.Wave 5`,
         `taf.have_you_contemplated_harming_yourself_.Wave 6`,
         `taf.have_you_contemplated_harming_yourself_.Wave 7`,
         `taf.have_you_contemplated_harming_yourself_.Wave 8`,
         `taf.felt_weeks_past.1_.Wave 2a`,
         `taf.felt_weeks_past.1_.Wave 2b`,
         `taf.felt_weeks_past.1_.Wave 3a`,
         `taf.felt_weeks_past.1_.Wave 3b`,
         `taf.felt_weeks_past.1_.Wave 4a`,
         `taf.felt_weeks_past.1_.Wave 4b`,
         `taf.felt_weeks_past.1_.Wave 5`,
         `taf.felt_weeks_past.1_.Wave 6`,
         `taf.felt_weeks_past.1_.Wave 7`,
         `taf.felt_weeks_past.1_.Wave 8`,
         `taf.meant_life_end_weeks_.Wave 2a`,
         `taf.meant_life_end_weeks_.Wave 2b`,
         `taf.meant_life_end_weeks_.Wave 3a`,
         `taf.meant_life_end_weeks_.Wave 3b`,
         `taf.meant_life_end_weeks_.Wave 4a`,
         `taf.meant_life_end_weeks_.Wave 4b`,
         `taf.meant_life_end_weeks_.Wave 5`,
         `taf.meant_life_end_weeks_.Wave 6`,
         `taf.meant_life_end_weeks_.Wave 7`,
         `taf.meant_life_end_weeks_.Wave 8`)
}
```

##5. Remove duplicate IDs TAF COPING
```{r}
if(COPING == TRUE) {
##Check col names
colnames(dat.raw.taf.coping)

##Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
dat.raw.taf.coping  <- dat.raw.taf.coping  %>%
  filter(., !duplicated(ID)) 

##Check number of rows
nrow(dat.raw.taf.coping)
}

```



## 6. Change follow up EDE COPING to long format
```{r TAF COPING long format}
if(COPING == TRUE) {
edeq.coping.followupb.raw.id <- edeq.coping.followupb.raw.id %>%
  group_by(wave_edeq) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_edeq,
                     values_from = c(edeq.deliberately_limit_amount_influence,
                              edeq.calories_made_body_shape,
                              edeq.weight_influenced_person,
                              edeq.dissatisfied_shape_weight,
                              edeq.eating_behaviours_distressed_concerns,
                              edeq.actively_been_monitoring_your_shape_or_weight_numeric, ##Need numeric version
                              edeq.regard_lost_control_eaten_numeric, ##Need numeric version
                              edeq.sick_means_made_shape_numeric, ##Need numeric version
                              edeq.diuretics_laxatives_means_shape_numeric, ##Need numeric version
                              edeq.compulsive_driven_burn_calories_numeric, ##Need numeric version
                              edeq.nibbled_picked_snacks_grazed,
                              edeq.felt_anxious_blue_bored,
                              edeq.felt_anxious_blue_bored.1)) %>%
  select(-row)
  
}

```

##7. Select variables for dataset EDEQ COPING
```{r}
if(COPING == TRUE) {
edeq.coping.followupb.raw.id <- edeq.coping.followupb.raw.id  %>%
  select(ID,
         `edeq.deliberately_limit_amount_influence_.Wave 2b`,
         `edeq.deliberately_limit_amount_influence_.Wave 3b`,
         `edeq.deliberately_limit_amount_influence_.Wave 4b`,
         `edeq.deliberately_limit_amount_influence_.Wave 6`,
         `edeq.deliberately_limit_amount_influence_.Wave 8`,
         `edeq.calories_made_body_shape_.Wave 2b`,
         `edeq.calories_made_body_shape_.Wave 3b`,
         `edeq.calories_made_body_shape_.Wave 4b`,
         `edeq.calories_made_body_shape_.Wave 6`,
         `edeq.calories_made_body_shape_.Wave 8`,
         `edeq.weight_influenced_person_.Wave 2b`,
         `edeq.weight_influenced_person_.Wave 3b`,
         `edeq.weight_influenced_person_.Wave 4b`,
         `edeq.weight_influenced_person_.Wave 6`,
         `edeq.weight_influenced_person_.Wave 8`,
         `edeq.dissatisfied_shape_weight_.Wave 2b`,
         `edeq.dissatisfied_shape_weight_.Wave 3b`,
         `edeq.dissatisfied_shape_weight_.Wave 4b`,
         `edeq.dissatisfied_shape_weight_.Wave 6`,
         `edeq.dissatisfied_shape_weight_.Wave 8`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 2b`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 3b`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 4b`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 6`,
         `edeq.eating_behaviours_distressed_concerns_.Wave 8`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 2b`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 3b`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 4b`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 6`,
         `edeq.actively_been_monitoring_your_shape_or_weight_numeric_.Wave 8`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 2b`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 3b`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 4b`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 6`,
         `edeq.regard_lost_control_eaten_numeric_.Wave 8`,
         `edeq.sick_means_made_shape_numeric_.Wave 2b`,
         `edeq.sick_means_made_shape_numeric_.Wave 3b`,
         `edeq.sick_means_made_shape_numeric_.Wave 4b`,
         `edeq.sick_means_made_shape_numeric_.Wave 6`,
         `edeq.sick_means_made_shape_numeric_.Wave 8`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 2b`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 3b`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 4b`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 6`,
         `edeq.diuretics_laxatives_means_shape_numeric_.Wave 8`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 2b`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 3b`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 4b`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 6`,
         `edeq.compulsive_driven_burn_calories_numeric_.Wave 8`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 2b`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 3b`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 4b`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 6`,
         `edeq.nibbled_picked_snacks_grazed_.Wave 8`,
         `edeq.felt_anxious_blue_bored_.Wave 2b`,
         `edeq.felt_anxious_blue_bored_.Wave 3b`,
         `edeq.felt_anxious_blue_bored_.Wave 4b`,
         `edeq.felt_anxious_blue_bored_.Wave 6`,
         `edeq.felt_anxious_blue_bored_.Wave 8`,
         `edeq.felt_anxious_blue_bored.1_.Wave 2b`,
         `edeq.felt_anxious_blue_bored.1_.Wave 3b`,
         `edeq.felt_anxious_blue_bored.1_.Wave 4b`,
         `edeq.felt_anxious_blue_bored.1_.Wave 6`,
         `edeq.felt_anxious_blue_bored.1_.Wave 8`)
}
```


## 6. Change follow up EDE COPING to long format SCREENER
```{r TAF COPING long format}
if(COPING == TRUE) {
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>%
  mutate(row = row_number()) %>%
  tidyr::pivot_wider(names_from = wave_edeq,
                     values_from = c(ed_scid5.regular_episodes_eating_binges,
                     ed_scid5.weigh_weighed_past_month,
                     ed_scid5.regular_episodes_eating_binges_numeric,
                     ed_scid5.weigh_weighed_past_month_numeric)) %>%
  select(-row)
  
}


```

##7. Select variables for dataset EDEQ RAMP screener
```{r}
if(COPING == TRUE) {
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw.id  %>%
  select(ID,
         cohort_name,
         `ed_scid5.regular_episodes_eating_binges_.Wave 2b` ,       
         `ed_scid5.regular_episodes_eating_binges_.Wave 3b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave 4b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave 6`,
         `ed_scid5.regular_episodes_eating_binges_.Wave 8`,
         `ed_scid5.weigh_weighed_past_month_.Wave 2b`,               
         `ed_scid5.weigh_weighed_past_month_.Wave 3b`,               
         `ed_scid5.weigh_weighed_past_month_.Wave 4b` ,             
         `ed_scid5.weigh_weighed_past_month_.Wave 6`,
         `ed_scid5.weigh_weighed_past_month_.Wave 8`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 2b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 3b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 4b`, 
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 6`,  
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 6`,  
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave 8`, 
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 2b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 3b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 4b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 6`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave 8`)
}
```

##8. Remove duplicate IDs EDEQ COPING
```{r}
if(COPING == TRUE) {
##Check col names
colnames(edeq.coping.followupb.screener.raw.id)

##Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
edeq.coping.followupb.screener.raw.id  <- edeq.coping.followupb.screener.raw.id  %>%
  filter(., !duplicated(ID)) 

##Check number of rows
nrow(edeq.coping.followupb.screener.raw.id)
}

```

# Export data
```{r export data}
if(COPING == TRUE) {
saveRDS(object = edeq.coping.followupb.raw.id, file = "../data_cleaned/edeq_coping.rds")
  
saveRDS(object = dat.raw.taf.coping, file = "../data_cleaned/taf_coping.rds")

saveRDS(object = edeq.coping.followupb.screener.raw.id, file = "../data_cleaned/edeq_screener_coping.rds")

}

if(RAMP == TRUE) {
saveRDS(object = dat.raw.taf.ramp, file = "../data_cleaned/taf_ramp.rds")

saveRDS(object = edeq.ramp.followupb.raw.id, file = "../data_cleaned/edeq_ramp.rds")
  
  saveRDS(object = edeq.ramp.followupb.screener.raw.id, file = "../data_cleaned/edeq_screener_ramp.rds")


}

```

###JOINING DATASETS - baseline 

##Select same variables from each dataset

##EDGI select variables from each dataset
```{r EDGI select variables}
if(EDGI == TRUE) {
edgi.1 <- edgi.coping.dem.raw.id %>% #590
  select(ID,
  cohort_name,
  gender_unc,
  sex,
  uk_location,
  current_country)
  
edgi.2 <- edgi.dem3.raw.id %>% #3251
  select(ID,
  cohort_name,
  age_category_numeric,
  age_category,
  highest_education_prepan_numeric,
  highest_education_prepan,
  ethnicity)
  
edgi.3 <- edgi.coping.dem4.employ.raw.id %>% #590
  select(ID,
  cohort_name,
  highest_education_numeric,
  highest_education,
  employment_prior_covid_numeric,
  employment_prior_covid,
  employment_change_numeric,
  employment_change,
  key_worker,
  key_worker_numeric)
  
edgi.4 <- taf.edgi.coping.baseline.raw.id %>% #590
  select(ID,
  cohort_name,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.pandemic_felt_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)


edgi.5 <- mhd.raw.id %>% #3251
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
         mhd.posttraumatic_stress_disorder_ptsd_numeric, 
         autism_spectrum_disorder_numeric,
         mhd.attention_deficit_hyperactivity_disorder_numeric,
         mhd.personality_disorder_numeric,
         mhd.suspected_eating_disorder_diagnosed_numeric,
         mhd.body_dysmorphic_disorder_bdd_numeric,
         mhd.anorexia_nervosa_numeric,
          mhd.atypical_anorexia_nervosa_numeric,
          mhd.bulimia_nervosa_numeric, 
          mhd.atypical_bulimia_nervosa_numeric,  
          mhd.bingeeating_disorder_numeric, 
          mhd.atypical_bingeeating_disorder_numeric, 
          mhd.purging_disorder_numeric, 
          mhd.night_eating_syndrome_numeric,  
          mhd.pica_numeric, 
          mhd.avoidantrestrictive_food_intake_disorder_numeric,
          mhd.rumination_disorder_numeric, 
          mhd.feeding_eating_disorder_numeric, 
          mhd.other_eating_disorder_numeric)

##See if IDs match with edgi.5
x <- edgi.5[edgi.5$ID %in% edgi.4$ID,]

length(unique(x$ID))

x <- edgi.5[edgi.5$ID %in% edgi.3$ID,]

length(unique(x$ID))

x <- edgi.5[edgi.5$ID %in% edgi.2$ID,]

length(unique(x$ID))

x <- edgi.5[edgi.5$ID %in% edgi.1$ID,]

length(unique(x$ID))

}

#no edeq baseline (only in ramp)
```

##EDGI data frame list
```{r EDGI data frame list}
if(EDGI == TRUE) {
dfs.list <- list(
  edgi.1,
  edgi.2,
  edgi.3,
  edgi.4,
  edgi.5
)
}

```

##Join all EDGI
```{r Join all EDGI questionnaires}
if(EDGI == TRUE) {
dat.raw.edgi <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name") # Alternatively you can join by several columns EDGI -> "Age", "Sex", "Birthyear"
  )

#look at the data
colnames(dat.raw.edgi)
}

```

#Get rid of duplicates in EDGI
```{r Check duplicates}
if(EDGI == TRUE) {
dat.raw.edgi$ID.dup <- duplicated(dat.raw.edgi$ID)

summary(as.factor(dat.raw.edgi$ID.dup))

select(dat.raw.edgi)

 #Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw.edgi)))
names_freq[names_freq$Freq > 1, ]

##Filter out duplicate column names
 dat.dup <- dat.raw.edgi %>%
  filter(ID.dup == TRUE)

dat.raw.edgi <- dat.raw.edgi %>%
  filter(ID.dup == FALSE)

colnames(dat.raw.edgi)
}

```

##GLAD data frame list
```{r GLAD data frame list}
if(GLAD == TRUE) {
 
glad.1 <-  glad.coping.dem.raw.id %>%
     select(ID,
            cohort_name,
            sex,
            gender_unc,
            uk_location,
            current_country)
   
glad.2 <- glad.dem3.raw.id %>%
  select(ID,
         cohort_name,
         age_category_numeric,
         age_category,
         ethnicity,
         highest_education_prepan_numeric,
         highest_education_prepan)

glad.3 <- glad.coping.dem4.employ.raw.id %>% 
  select(ID,
         cohort_name,
         highest_education_numeric,
         highest_education,
         employment_prior_covid,
         employment_prior_covid_numeric,
         employment_change,
         employment_change_numeric,
         key_worker,
         key_worker_numeric)

glad.4 <- taf.glad.coping.baseline.raw.id %>%
  select(ID,
  cohort_name,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.pandemic_felt_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)


glad.5 <- mhd.raw.id %>%
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
        mhd.posttraumatic_stress_disorder_ptsd_numeric, 
        autism_spectrum_disorder_numeric,
        mhd.attention_deficit_hyperactivity_disorder_numeric,
        mhd.personality_disorder_numeric,
        mhd.suspected_eating_disorder_diagnosed_numeric,
        mhd.body_dysmorphic_disorder_bdd_numeric,
        mhd.anorexia_nervosa_numeric,
          mhd.atypical_anorexia_nervosa_numeric,
          mhd.bulimia_nervosa_numeric, 
          mhd.atypical_bulimia_nervosa_numeric,  
          mhd.bingeeating_disorder_numeric, 
          mhd.atypical_bingeeating_disorder_numeric, 
          mhd.purging_disorder_numeric, 
          mhd.night_eating_syndrome_numeric,  
          mhd.pica_numeric, 
          mhd.avoidantrestrictive_food_intake_disorder_numeric,
          mhd.rumination_disorder_numeric, 
          mhd.feeding_eating_disorder_numeric, 
          mhd.other_eating_disorder_numeric)

##See if IDs match with glad.3
x <- glad.3[glad.3$ID %in% glad.1$ID,]

length(unique(x$ID))

x <- glad.3[glad.3$ID %in% glad.2$ID,]

length(unique(x$ID))

x <- glad.3[glad.3$ID %in% glad.4$ID,]

length(unique(x$ID))

x <- glad.3[glad.3$ID %in% glad.5$ID,]

length(unique(x$ID))

}
```

##GLAD data frame list
```{r GLAD data frame list}
if(GLAD == TRUE) {
dfs.list <- list(
  glad.1,
  glad.2,
  glad.3,
  glad.4,
  glad.5
)
}

```


##Join all GLAD
```{r Join all GLAD questionnaires}
if(GLAD == TRUE) {
dat.raw.glad <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name")
  )
#look at the data
colnames(dat.raw.glad)
}

```

#Get rid of duplicates in GLAD
```{r Check duplicates}
if(GLAD == TRUE) {
dat.raw.glad$ID.dup <- duplicated(dat.raw.glad$ID)

summary(as.factor(dat.raw.glad$ID.dup))

select(dat.raw.glad)

#Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw.glad)))
names_freq[names_freq$Freq > 1, ]

##Filter out duplicate column names
 #dat.dup <- dat.raw.glad %>%
 # filter(ID.dup == TRUE)

#dat.raw.glad <- dat.raw.glad %>%
#  filter(ID.dup == FALSE)

colnames(dat.raw.glad)
}

```

##NBR selected variables
```{r NBR selected variables}
if(NBR == TRUE) {

  nbr.1 <- nbr.dem.employ.raw.id %>%
    select(ID,
           cohort_name,
           highest_education_numeric,
           highest_education,
           employment_change_numeric,
           employment_change,
           employment_prior_covid,
           employment_prior_covid_numeric,
           key_worker,
           key_worker_numeric)
  
nbr.2 <- nbr.dem.raw.id.complete %>%
  select(ID,
         cohort_name,
         sex,
         gender_unc,
         ethnicity,
         current_country,
         uk_location)

freq(nbr.2$ethnicity)
    
  nbr.3 <- nbr.dem.raw.id %>%
    select(ID,
           cohort_name,
           age_category,
           age_category_numeric)

nbr.4 <- taf.nbr.baseline.raw.id %>%
  select(ID,
  cohort_name,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.pandemic_felt_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)


nbr.5 <- mhd.raw.id %>% 
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
        mhd.posttraumatic_stress_disorder_ptsd_numeric, 
        autism_spectrum_disorder_numeric,
        mhd.attention_deficit_hyperactivity_disorder_numeric,
        mhd.personality_disorder_numeric,
        mhd.suspected_eating_disorder_diagnosed_numeric,
        mhd.body_dysmorphic_disorder_bdd_numeric,
        mhd.anorexia_nervosa_numeric,
          mhd.atypical_anorexia_nervosa_numeric,
          mhd.bulimia_nervosa_numeric, 
          mhd.atypical_bulimia_nervosa_numeric,  
          mhd.bingeeating_disorder_numeric, 
          mhd.atypical_bingeeating_disorder_numeric, 
          mhd.purging_disorder_numeric, 
          mhd.night_eating_syndrome_numeric,  
          mhd.pica_numeric, 
          mhd.avoidantrestrictive_food_intake_disorder_numeric,
          mhd.rumination_disorder_numeric, 
          mhd.feeding_eating_disorder_numeric, 
          mhd.other_eating_disorder_numeric)





#Check nbr mhd data IDs
x <- nbr.5[nbr.5$ID %in% nbr.1$ID,]

length(unique(x$ID))

x <- nbr.5[nbr.5$ID %in% nbr.2$ID,]

length(unique(x$ID))

x <- nbr.5[nbr.5$ID %in% nbr.3$ID,]

length(unique(x$ID))

x <- nbr.5[nbr.5$ID %in% nbr.4$ID,]

length(unique(x$ID))

nrow(nbr.5)
nrow(nbr.4)
nrow(nbr.3)
nrow(nbr.2)
nrow(nbr.1)
}

#NO HIGHEST EDUCATION PREPAN
#no edeq baseline (only in ramp)
```

##NBR  data frame list
```{r NBR data frame list}
if(NBR == TRUE) {
dfs.list <- list(
  nbr.1,
  nbr.2,
  nbr.3,
  nbr.4,
  nbr.5
)
}
```

##Join all NBR 
```{r Join all NBR questionnaires}
if(NBR == TRUE) {
dat.raw.nbr <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name") # Alternatively you can join by several columns EDGI -> "Age", "Sex", "Birthyear"
  )

#look at the data
colnames(dat.raw.nbr)
}
```

#Get rid of duplicates in NBR
```{r Check duplicates}
if(NBR == TRUE) {
dat.raw.nbr$ID.dup <- duplicated(dat.raw.nbr$ID)

summary(as.factor(dat.raw.nbr$ID.dup))

select(dat.raw.nbr)

 #Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw.nbr)))
names_freq[names_freq$Freq > 1, ]

##Filter out duplicate column names
 dat.dup <- dat.raw.nbr %>%
  filter(ID.dup == TRUE)

dat.raw.nbr <- dat.raw.nbr %>%
  filter(ID.dup == FALSE)

colnames(dat.raw.nbr)
}

```

##RAMP variable list
```{r RAMP variable list}
if(RAMP == TRUE) {

  ramp.1 <- ramp.dem.raw.id %>%
    select(ID,
           cohort_name,
           gender_unc,
           ethnicity,
           age_unc)

  ramp.2 <- ramp.dem.employ.raw.id %>%
    select(ID,
           cohort_name,
           highest_education,
           highest_education_numeric,
           employment_prior_covid,
           employment_prior_covid_numeric,
           employment_change,
           employment_change_numeric,
           key_worker,
           key_worker_numeric)
   
  ramp.3 <- taf.ramp.baseline.raw.id %>%
  select(ID,
  cohort_name,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.pandemic_felt_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)


  ramp.4 <- mhd.raw.id %>% 
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
         mhd.posttraumatic_stress_disorder_ptsd_numeric, 
         autism_spectrum_disorder_numeric,
         mhd.attention_deficit_hyperactivity_disorder_numeric,
         mhd.personality_disorder_numeric,
         mhd.body_dysmorphic_disorder_bdd_numeric,
         mhd.anorexia_nervosa_numeric,
         mhd.atypical_anorexia_nervosa_numeric,
         mhd.bulimia_nervosa_numeric,
         mhd.bingeeating_disorder_numeric)


  ramp.5 <- edeq.ramp.baseline.raw.id 
   
#Check ramp.4 has same IDs as other datasets
x <- ramp.4[ramp.4$ID %in% ramp.1$ID,]

length(unique(x$ID))

x <- ramp.4[ramp.4$ID %in% ramp.2$ID,]

length(unique(x$ID))

x <- ramp.4[ramp.4$ID %in% ramp.3$ID,]

length(unique(x$ID))

x <- ramp.4[ramp.4$ID %in% ramp.5$ID,]

length(unique(x$ID))        
}

#NO SEX
#no highest education pre-pandemic
```

##RAMP  data frame list
```{r RAMP data frame list}
if(RAMP == TRUE) {
dfs.list <- list(
  ramp.1,
  ramp.2,
  ramp.3,
  ramp.4,
  ramp.5
  
)
}
```

##Join all RAMP
```{r Join all RAMP questionnaires}
if(RAMP == TRUE) {
dat.raw.ramp <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name") # Alternatively you can join by several columns EDGI -> "Age", "Sex", "Birthyear"
  )

#look at the data
colnames(dat.raw.ramp)
}

```

#Get rid of duplicates in RAMP
```{r Check duplicates}
if(RAMP == TRUE) {
dat.raw.ramp$ID.dup <- duplicated(dat.raw.ramp$ID)

summary(as.factor(dat.raw.ramp$ID.dup))

select(dat.raw.ramp)

 #Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw.ramp)))
names_freq[names_freq$Freq > 1, ]

##Filter out duplicate column names
 dat.dup <- dat.raw.ramp %>%
  filter(ID.dup == TRUE)

dat.raw.ramp <- dat.raw.ramp %>%
  filter(ID.dup == FALSE)

}
```

# Export baseline data
```{r export data}
if(GLAD == TRUE) {
saveRDS(object = dat.raw.glad, file = "../data_cleaned/baseline_glad.rds")
}

if(EDGI == TRUE) {
saveRDS(object = dat.raw.edgi, file = "../data_cleaned/baseline_edgi.rds")
  
}
if(RAMP == TRUE) {
  saveRDS(object = dat.raw.ramp, file = "../data_cleaned/baseline_ramp.rds")
}


if(NBR == TRUE) {
  saveRDS(object = dat.raw.nbr, file = "../data_cleaned/baseline_nbr.rds")
}


```





