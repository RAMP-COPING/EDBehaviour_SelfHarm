---
title: "COPING_cleaning_dem"
author: "Helena Davies"
date: "15/12/2020"
output: html_document
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

Install packages
```{r Install packages}
# Remember to hash the installing out
#install.packages(c("knitr","tidyverse","car","psych","lubridate","broom","ggfortify","summarytools","ggformula","data.table","ggpubr","ggrepel", "eeptools", "skimr"))
```

Load packages
```{r Load packages}
library(knitr)
library(car)
library(psych)
library(lubridate)
library(broom)
library(ggfortify)
library(summarytools)
library(ggformula)
library(data.table)
library(ggrepel)
library(ggpubr)
library(UpSetR)
library(skimr)
library(tidyverse)
```

#Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

# Specify cohort
```{r Specify cohort}
GLAD = FALSE
EDGI = FALSE
RAMP = FALSE
NBR = TRUE
COPING = FALSE
```

#Add_numeric function
Function used to convert character variables into numeric variables.
```{r add_numeric function}
add_numeric <- function(dat, exclude = NULL) {
  dat_fct <- sjlabelled::as_label(dat)
  dat <- dat[!colnames(dat) %in% exclude]
  colnames(dat) <- paste(colnames(dat), "numeric", sep = "_")
  return(bind_cols(dat_fct, dat))
}
```

# Demographics 
## GLAD 1
### Read in data
```{r glad dem cols}
if(GLAD == TRUE){
glad.coping.dem.raw <- readRDS(file = "../data_raw/glad/dem_coping_glad.rds")
dim(glad.coping.dem.raw)
colnames(glad.coping.dem.raw)
}
```

### Select variables
```{r glad dem select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem.raw.id <- glad.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_pregnant,
         weight_lb_unc = dem.current_weight_provide_pregnant.1,
         weight_kg_unc = dem.current_weight_provide_pregnant.2,
         highest_weight_st_unc = dem.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = dem.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = dem.provide_pregnant_weighed_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.adult_height_lowest_weight.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem.raw.id)
# Inspect colnames
colnames(glad.coping.dem.raw.id)
#Differences
dim(glad.coping.dem.raw)[1]-dim(glad.coping.dem.raw.id)[1]
}

```

###Summarise 
```{r glad dem summary, eval=FALSE, include=FALSE}
if(GLAD == TRUE) {
summarytools::dfSummary(
  glad.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## GLAD 2
### Read in data
```{r glad dem2 cols}
if(GLAD == TRUE){
glad.coping.dem2.raw <- readRDS(file = "../data_raw/glad/dem2_coping_glad.rds")
dim(glad.coping.dem2.raw)
colnames(glad.coping.dem2.raw)
}
```

### Select variables
```{r glad dem2 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem2.raw.id <- glad.coping.dem2.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1,
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem2.raw.id)
# Inspect colnames
colnames(glad.coping.dem2.raw.id)
#Differences
dim(glad.coping.dem2.raw)[1]-dim(glad.coping.dem2.raw.id)[1]
}

```

###Summarise 
```{r glad dem2 summary, eval=FALSE, include=FALSE}
if(GLAD == TRUE) {
summarytools::dfSummary(
  glad.coping.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## GLAD 3  [sign up]
### Read in data
```{r glad dem3 cols}
if(GLAD == TRUE){
glad.dem3.raw <- readRDS(file = "../data_raw/glad/dem_glad.rds")
dim(glad.dem3.raw)
colnames(glad.dem3.raw)
}
```

### Select variables
```{r glad dem3 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.dem3.raw.id <- glad.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         age_unc = dem.how_old_are_you_now.txt,
         ethnicity_unc = dem.questions_based_ethnic_origin,
         ethnicity_unc_text = dem.questions_based_ethnic_origin.txt,
         dem.college_or_university_degree,
         dem.a_levelsas_levels_or_equivalent,
         dem.o_levelsgcses_or_equivalent,
         dem.cses_or_equivalent,
         dem.nvq_or_hnd_or_hnc_or_equivalent,
         dem.other_professional_qualifications,
         dem.other_professional_qualifications_text.txt,
         dem.none_of_the_above_education = dem.none_of_the_above,
         transgender = dem.do_you_identify_as_transgender
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.dem3.raw.id)
# Inspect colnames
colnames(glad.dem3.raw.id)
#Differences
dim(glad.dem3.raw)[1]-dim(glad.dem3.raw.id)[1]
}

```

# Demographics 
## EDGI 
### Read in data
```{r edgi dem cols}
if(EDGI == TRUE){
edgi.coping.dem.raw <- readRDS(file = "../data_raw/edgi/dem_coping_edgi.rds")
dim(edgi.coping.dem.raw)
colnames(edgi.coping.dem.raw)
}
```

### Select variables
```{r edgi dem select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem.raw.id <- edgi.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_weight,
         weight_lb_unc = dem.current_weight_provide_weight.1,
         weight_kg_unc = dem.current_weight_provide_weight.2,
         highest_weight_st_unc = dem.provide_weighed_pregnant_weight,
         highest_weight_lb_unc = dem.provide_weighed_pregnant_weight.1,
         highest_weight_kg_unc = dem.provide_weighed_pregnant_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.lowest_weight_adult_height.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem.raw.id)
# Inspect colnames
colnames(edgi.coping.dem.raw.id)
#Differences
dim(edgi.coping.dem.raw)[1]-dim(edgi.coping.dem.raw.id)[1]
}

```
###Summarise 
```{r edgi dem summarise}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## EDGI 2
### Read in data
```{r edgi dem2 cols}
if(EDGI == TRUE){
edgi.coping.dem2.raw <- readRDS(file = "../data_raw/edgi/dem2_coping_edgi.rds")
dim(edgi.coping.dem2.raw)
colnames(edgi.coping.dem2.raw)
}
```

### Select variables
```{r edgi dem2 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem2.raw.id <- edgi.coping.dem2.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital, #To match name in GLAD
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1,
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem2.raw.id)
# Inspect colnames
colnames(edgi.coping.dem2.raw.id)
#Differences
dim(edgi.coping.dem2.raw)[1]-dim(edgi.coping.dem2.raw.id)[1]
}

```

###Summarise 
```{r edgi dem2 summarise, eval=FALSE, include=FALSE}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.coping.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## EDGI 3  [sign up]
### Read in data
```{r EDGI dem3 cols}
if(EDGI == TRUE){
edgi.dem3.raw <- readRDS(file = "../data_raw/edgi/demographics_edgi.rds")
dim(edgi.dem3.raw)
colnames(edgi.dem3.raw)
}
```

### Select variables
```{r edgi dem3 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.dem3.raw.id <- edgi.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         age_unc = dem.how_old_are_you_now.txt,
         ethnicity_unc = demographics.what_is_your_ethnic_origin,
         ethnicity_unc_text = demographics.what_is_your_ethnic_origin.txt,
         transgender = demographics.do_you_consider_yourself_to_be_transgender,
         demographics.collegeuniversity,
         demographics.asa_levels,
         demographics.cse,
         demographics.gcse,
         demographics.nvq,
         demographics.other.1,
         demographics.none_of_the_above,
         demographics.other_text.txt.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.dem3.raw.id)
# Inspect colnames
colnames(edgi.dem3.raw.id)
#Differences
dim(edgi.dem3.raw)[1]-dim(edgi.dem3.raw.id)[1]
}

```

# Demographics 
## GLAD 4 employment 
### Read in data
```{r GLAD dem4 cols}
if(GLAD == TRUE){
glad.coping.dem4.employ.raw <- readRDS(file = "../data_raw/glad/employ_coping_glad.rds")
dim(glad.coping.dem4.employ.raw)
colnames(glad.coping.dem4.employ.raw)
}

```
### Select variables
```{r glad dem4 select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role = employ.role_type, #renamed to be same as edgi
         employ.type_role.txt = employ.role_type.txt, #renamed to be same as edgi
         employ.type_role.1 = employ.role_type.1, #renamed to be same as edgi
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.job_due_losing_risk, #renamed to be same as edgi
         employ.increased_due_job_pandemic = employ.increased_job_due_pandemic #renamed to be same as edgi
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem4.employ.raw.id)
# Inspect colnames
colnames(glad.coping.dem4.employ.raw.id)
#Differences
dim(glad.coping.dem4.employ.raw)[1]-dim(glad.coping.dem4.employ.raw.id)[1]
}

```

# Demographics 
## EDGI 4 employment
### Read in data
```{r EDGI dem4 cols}
if(EDGI == TRUE){
edgi.coping.dem4.employ.raw <- readRDS(file = "../data_raw/edgi/employ_coping_edgi.rds")
dim(edgi.coping.dem4.employ.raw)
colnames(edgi.coping.dem4.employ.raw)
}
```

### Select variables
```{r edgi dem4 select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt,
         employ.type_role.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk,
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem4.employ.raw.id)
# Inspect colnames
colnames(edgi.coping.dem4.employ.raw.id)
#Differences
dim(edgi.coping.dem4.employ.raw)[1]-dim(edgi.coping.dem4.employ.raw.id)[1]

}

```
# Demographics 
## NBR 1
### Read in data
```{r nbr dem1 cols}
if(NBR == TRUE){
nbr.dem.raw <- readRDS(file = "../data_raw/nbr/demographics_coping_nbr.rds")
dim(nbr.dem.raw)
colnames(nbr.dem.raw)
}

```

### Select variables
```{r nbr dem1 select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem.raw.id <- nbr.dem.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = demographics.which_gender_do_you_identify_with, # Gender
         sex = demographics.select_questionnaire_items_medical, #Sex
         pregnant_binary = demographics.baby_pregnant_months,
         birthday_day = demographics.day,
         birthday_month = demographics.month,
         birthday_year = demographics.year,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = demographics.what_is_your_current_height,
         height_inch_unc = demographics.what_is_your_current_height.1,
         height_cm_unc = demographics.what_is_your_current_height.2,
         weight_st_unc = demographics.provide_current_weight_pregnant,
         weight_lb_unc = demographics.provide_current_weight_pregnant.1,
         weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         highest_weight_st_unc = demographics.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = demographics.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         lowest_weight_st_unc = demographics.adult_height_reaching_weighed,
         lowest_weight_lb_unc = demographics.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = demographics.adult_height_reaching_weighed.2,
         age_highest_weight_unc = demographics.highest_weight.txt,
         age_lowest_weight_unc = demographics.adult_height_lowest_weight.txt,
         uk_location = demographics.live,
         current_country = demographics.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem.raw.id)
# Inspect colnames
colnames(nbr.dem.raw.id)
#Differences
dim(nbr.dem.raw)[1]-dim(nbr.dem.raw.id)[1]
}

```

# Demographics 
## NBR 2
### Read in data
```{r nbr dem2 cols}
if(NBR == TRUE){
nbr.dem2.raw <- readRDS(file = "../data_raw/nbr/dem_coping_nbr.rds")
dim(nbr.dem2.raw)
colnames(nbr.dem2.raw)
}
```

### Select variables
```{r nbr dem2 select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem2.raw.id <- nbr.dem2.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid,# ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living = dem2.spouse_members_partner_living, #Renamed to be same as edgi/glad
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1 = dem2.spouse_members_partner_living.1, #Renamed to be same as edgi/glad
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.household_living_place_answer,
         dem2.include_living_areas_count,
         dem2.relationships_describe_question_place = dem2.relationships_describe_place_question, #Renamed to be same as edgi/glad
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.none,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.do_you_have_any_children,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.adult_children_home_living,
         dem2.adult_children_pandemic_returned,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital, #To match name in GLAD
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         dem2.adult_children_home_living.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem2.raw.id)
# Inspect colnames
colnames(nbr.dem2.raw.id)
#Differences
dim(nbr.dem2.raw)[1]-dim(nbr.dem2.raw.id)[1]
}

```

###Summarise 
```{r nbr dem2 summary, eval=FALSE, include=FALSE}
if(NBR == TRUE) {
summarytools::dfSummary(
  nbr.dem2.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## NBR employment 
### Read in data
```{r nbr dem employ cols}
if(NBR == TRUE){
nbr.dem.employ.raw <- readRDS(file = "../data_raw/nbr/employ_coping_nbr.rds")
dim(nbr.dem.employ.raw)
colnames(nbr.dem.employ.raw)
}
```

### Select variables
```{r nbr dem employ select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem.employ.raw.id <- nbr.dem.employ.raw%>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.other_professional_qualifications_e.g._nursing_teaching,
         employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         employ.taking_unpaid_leave,
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work,
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt,
         employ.type_role.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.job_due_losing_risk, #renamed to same as edgi
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem.employ.raw.id)
# Inspect colnames
colnames(nbr.dem.employ.raw.id)
#Differences
dim(nbr.dem.employ.raw)[1]-dim(nbr.dem.employ.raw.id)[1]
}

```

# Demographics 
## RAMP
### Read in data
```{r ramp dem cols}
if(RAMP == TRUE){
ramp.dem.raw <- readRDS(file = "../data_raw/ramp/dem_ramp.rds")
dim(ramp.dem.raw)
colnames(ramp.dem.raw)
}
```

### Select variables
```{r ramp dem select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

ramp.dem.raw.id <- ramp.dem.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column
  select(
         ID = `Login ID`,# ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         #endDate,
         age_unc = dem2.how_old_are_you,
         gender_unc = dem2.which_gender_do_you_identify_with, # Gender
         pregnant_binary = dem2.are_you_pregnant, 
         #dem2.what_is_your_current_maritalrelationship_status #Not in COPING 
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3 = dem2.living_children_under_the_age_of_18, #Renamed to be same as coping glad/edgi
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_members_partner_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.relationships_describe_question_place = dem2.describe_relationships_live_living, #Rename to be same as coping glad/edgi
         dem2.household_living_place_answer, 
         dem2.include_living_areas_count = dem2.count_bathrooms_bedrooms_hallways,
         dem2.cats,
         dem2.dogs,
         dem2.fish,
         dem2.bird,
         dem2.reptile,
         dem2.small_rodent,
         dem2.other_please_specify_species,
         dem2.other_please_specify_species_text.txt,
         dem2.none,
         dem2.02_years,
         dem2.35_years,
         dem2.610_years,
         dem2.1115_years,
         dem2.1618_years,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant = dem2.significant_heart_disease_congenital,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure,
         transgender = dem2.do_you_identify_as_transgender,
         dem2.adult_children_pandemic_returned,
         dem2.adult_children_pandemic_returned.txt,
         dem.live = dem2.where_in_the_uk_do_you_live.txt, #changed wording to match glad edgi dem
         ethnicity_unc_text = dem2.what_is_your_ethnic_origin.txt,
         ethnicity_unc = dem2.what_is_your_ethnic_origin,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.living_children_under_the_age_of_18.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_members_partner_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.household_living_place_answer,
         dem2.do_you_have_any_children,
         dem2.adult_children_home_living.1,
         dem2.under_50_years,
         dem2.5060_years,
         dem2.6170_years,
         dem2.7180_years,
         dem2.81_years,
         dem2.ramp_study_hear.txt,
         dem2.ramp_study_hear
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp.dem.raw.id)
# Inspect colnames
colnames(ramp.dem.raw.id)
#Differences
dim(ramp.dem.raw)[1]-dim(ramp.dem.raw.id)[1]
}

```
# Demographics 
## RAMP employment
### Read in data
```{r ramp dem employ cols}
if(RAMP == TRUE){
ramp.dem.employ.raw <- readRDS(file = "../data_raw/ramp/employ_ramp.rds")
dim(ramp.dem.employ.raw)
colnames(ramp.dem.employ.raw)
}
```

### Select variables
```{r ramp dem employ select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

ramp.dem.employ.raw.id <- ramp.dem.employ.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #employ.phd,
         #employ.masters_degree_or_equivalent,
         #employ.postgraduate_degree_or_equivalent,
         #employ.bachelors_degree_or_equivalent,
         #employ.a_levelsas_levels_or_equivalent,
         #employ.o_levelsgcses_or_equivalent,
         #employ.cses_or_equivalent,
         #employ.nvq_or_hnd_or_hnc_or_equivalent,
         #employ.other_professional_qualifications_e.g._nursing_teaching,
         #employ.other_professional_qualifications_e.g._nursing_teaching_text.txt,
         employ.what_is_your_highest_level_of_education,
         #employ.none_of_the_above,
         employ.fulltime_employed,
         employ.parttime_employed,
         employ.unemployed,
         employ.zerohours_contract,
         employ.stayathome_parent_or_carer,
         employ.selfemployed,
         employ.contract_or_freelance_work,
         employ.small_business_owner,
         employ.receiving_state_income,
         employ.retired,
         employ.student_gcse_or_a_level,
         employ.student_university,
         employ.my_employment_status_has_not_changed,
         employ.became_unemployed,
         employ.reduction_in_hours,
         employ.reduction_in_salary,
         employ.benefits_increased,
         employ.benefits_decreased,
         employ.change_in_duties_or_responsibilities,
         employ.became_employed,
         employ.increased_hours,
         employ.increased_salary,
         employ.furloughed_or_paid_leave_government_funded,
         employ.furloughed_or_paid_leave_company_funded,
         employ.paid_leave_furloughed,
         #employ.taking_unpaid_leave, #Not in RAMP
         employ.other,
         employ.other_text.txt,
         employ.no_impact,
         employ.cancelled_exams,
         employ.change_in_format_of_exams,
         employ.automatic_pass,
         employ.change_in_deadlines,
         employ.change_in_lesson_delivery,
         employ.past_performance_grade_decided,
         employ.cancelled_classes,
         employ.impact_on_studies_still_unknown,
         employ.other.1,
         employ.other_text.txt.1,
         employ.complete_home_work,
         employ.are_you_currently_working_from_home,
         employ.attend_work_encouraged_work = employ.work_attend_work_encouraged, #renamed to same as edgi and glsd
         employ.government_work_key_workers.txt,
         employ.government_work_key_workers,
         employ.type_role,
         employ.type_role.txt = employ.role_type.txt,
         employ.type_role.1 = employ.role_type.1,
         employ.does_your_job_include_caring_for_others,
         employ.is_your_job_public_facing_,
         employ.losing_job_due_risk = employ.scale_line_losing_click,
         employ.increased_due_job_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp.dem.employ.raw.id)
# Inspect colnames
colnames(ramp.dem.employ.raw.id)
#Differences
dim(ramp.dem.employ.raw)[1]-dim(ramp.dem.employ.raw.id)[1]
}

```
# EDEQ
## COPING follow up b [nbr, glad + edgi]
### Read in data
```{r coping edeq follow up b cols}
if(COPING == TRUE){
edeq.coping.followupb.raw <- readRDS(file = "../data_raw/coping/edeq_coping_followupb.rds")
dim(edeq.coping.followupb.raw)
colnames(edeq.coping.followupb.raw)
}
```

### Select variables
```{r edeq coping select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edeq.coping.followupb.raw.id <- edeq.coping.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_wavesB = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence_followupB = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape_followupB = edeq.calories_made_body_shape,
         edeq.weight_influenced_person_followupB = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight_followupB = edeq.dissatisfied_shape_weight,
         edeq.actively_been_monitoring_your_shape_or_weight_followupB = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten_followupB = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape_followupB = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape_followupB = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories_followupB = edeq.compulsive_driven_burn_calories,
         edeq.eating_behaviours_distressed_concerns_followupB = edeq.eating_behaviours_distressed_concerns,
         edeq.nibbled_picked_snacks_grazed_followupB = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored_followupB = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1_followupB = edeq.felt_anxious_blue_bored.1,
         edeq.experiences_pandemic_followupB = edeq.experiences_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.coping.followupb.raw.id)
# Inspect colnames
colnames(edeq.coping.followupb.raw.id)
#Differences
dim(edeq.coping.followupb.raw)[1]-dim(edeq.coping.followupb.raw.id)[1]
}
```

# EDEQ
## RAMP baseline
### Read in data
```{r RAMP edeq baseline cols}
if(RAMP == TRUE){
edeq.ramp.baseline.raw <- readRDS(file = "../data_raw/ramp/edeq_ramp.rds")
dim(edeq.ramp.baseline.raw)
colnames(edeq.ramp.baseline.raw)
}
```
### Select variables
```{r ramp edeq baseline select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edeq.ramp.baseline.raw.id <- edeq.ramp.baseline.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence_baseline = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape_baseline = edeq.calories_made_body_shape,
         edeq.weight_influenced_person_baseline = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight_baseline = edeq.dissatisfied_shape_weight,
         edeq.nibbled_picked_snacks_grazed_baseline = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored_baseline = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1_baseline = edeq.felt_anxious_blue_bored.1,
         edeq.eating_behaviours_concerns_distressed_baseline = edeq.eating_behaviours_concerns_distressed,
         edeq.deliberately_limit_amount_influence.1_baseline = edeq.deliberately_limit_amount_influence.1,
         edeq.calories_made_body_shape.1_baseline = edeq.calories_made_body_shape.1,
         edeq.weight_influenced_person.1_baseline = edeq.weight_influenced_person.1,
         edeq.dissatisfied_shape_weight.1_baseline = edeq.dissatisfied_shape_weight.1,
         edeq.eating_behaviours_concerns_distressed.1_baseline = edeq.eating_behaviours_concerns_distressed.1,
         edeq.feelings_pandemic_felt_baseline = edeq.feelings_pandemic_felt,
         edeq.actively_been_monitoring_your_shape_or_weight_baseline = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten_baseline = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape_baseline = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape_baseline = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories_baseline = edeq.compulsive_driven_burn_calories,
         edeq.nibbled_picked_snacks_grazed.1_baseline = edeq.nibbled_picked_snacks_grazed.1,
         edeq.felt_anxious_blue_bored.2_baseline = edeq.felt_anxious_blue_bored.2,
         edeq.felt_anxious_blue_bored.3_baseline = edeq.felt_anxious_blue_bored.3,
         edeq.actively_been_monitoring_your_shape_or_weight_.1_baseline = edeq.actively_been_monitoring_your_shape_or_weight_.1,
         edeq.regard_lost_control_eaten.1_baseline = edeq.regard_lost_control_eaten.1,
         edeq.sick_means_made_shape.1_baseline = edeq.sick_means_made_shape.1,
         edeq.diuretics_laxatives_means_shape.1_baseline = edeq.diuretics_laxatives_means_shape.1,
         edeq.compulsive_driven_burn_calories.1_baseline = edeq.compulsive_driven_burn_calories.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.ramp.baseline.raw.id)
# Inspect colnames
colnames(edeq.ramp.baseline.raw.id)
#Differences
dim(edeq.ramp.baseline.raw)[1]-dim(edeq.ramp.baseline.raw.id)[1]
}
```

# EDEQ
## RAMP follow up b
### Read in data
```{r RAMP edeq follow up b cols}
if(RAMP == TRUE){
edeq.ramp.followupb.raw <- readRDS(file = "../data_raw/ramp/edeq_ramp_followupb.rds")
dim(edeq.ramp.followupb.raw)
colnames(edeq.ramp.followupb.raw)
}
```
### Select variables
```{r ramp edeq follow up b select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edeq.ramp.followupb.raw.id <- edeq.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_wavesB_edeq = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence_followupB = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape_followupB = edeq.calories_made_body_shape,
         edeq.weight_influenced_person_followupB = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight_followupB = edeq.dissatisfied_shape_weight,
         edeq.actively_been_monitoring_your_shape_or_weight_followupB = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten_followupB = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape_followupB = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape_followupB = edeq.diuretics_laxatives_means_shape,
         edeq.compulsive_driven_burn_calories_followupB = edeq.compulsive_driven_burn_calories,
         edeq.eating_behaviours_distressed_concerns_followupB = edeq.eating_behaviours_distressed_concerns,
         edeq.nibbled_picked_snacks_grazed_followupB = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored_followupB = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1_followupB = edeq.felt_anxious_blue_bored.1,
         #edeq.experiences_pandemic #not in ramp but in coping
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq.ramp.followupb.raw.id)
# Inspect colnames
colnames(edeq.ramp.followupb.raw.id)
#Differences
dim(edeq.ramp.followupb.raw)[1]-dim(edeq.ramp.followupb.raw.id)[1]
}
```
The EDE, and its self-report version, the EDE-Q, generate two types of data. First, they provide
frequency data on key behavioural features of eating disorders in terms of number of episodes of the
behaviour and in some instances number of days on which the behaviour has occurred. Second, they
provide subscale scores reflecting the severity of aspects of the psychopathology of eating disorders.
The subscales are Restraint, Eating Concern, Shape Concern and Weight Concern. To obtain a
particular subscale score, the ratings for the relevant items (listed below) are added together and the sum
divided by the total number of items forming the subscale. If ratings are only available on some items, a
score may nevertheless be obtained by dividing the resulting total by the number of rated items so long
as more than half the items have been rated. To obtain an overall or ‘global’ score, the four subscales
scores are summed and the resulting total divided by the number of subscales (i.e. four). Subscale
scores are reported as means and standard deviations.



# TAF - baseline 
## GLAD 
### Read in data
```{r GLAD taf sign up cols}
if(GLAD == TRUE){
taf.glad.coping.baseline.raw <- readRDS(file = "../data_raw/glad/taf_coping_glad.rds")
dim(taf.glad.coping.baseline.raw)
colnames(taf.glad.coping.baseline.raw)
}

```
### Select variables
```{r GLAD sign up taf select variables}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.glad.coping.baseline.raw.id <- taf.glad.coping.baseline.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_life_thoughts, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.glad.coping.baseline.raw.id)
# Inspect colnames
colnames(taf.glad.coping.baseline.raw.id)
#Differences
dim(taf.glad.coping.baseline.raw)[1]-dim(taf.glad.coping.baseline.raw.id)[1]
}
```
# TAF - baseline
## EDGI  
### Read in data
```{r EDGI taf sign up cols}
if(EDGI == TRUE){
taf.edgi.coping.baseline.raw <- readRDS(file = "../data_raw/edgi/taf_coping_edgi.rds")
dim(taf.edgi.coping.baseline.raw)
colnames(taf.edgi.coping.baseline.raw)
}
```
### Select variables
```{r EDGI sign up taf select variables}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.edgi.coping.baseline.raw.id <- taf.edgi.coping.baseline.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.weeks_past_felt,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.weeks_past_felt.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_weeks_life, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.edgi.coping.baseline.raw.id)
# Inspect colnames
colnames(taf.edgi.coping.baseline.raw.id)
#Differences
dim(taf.edgi.coping.baseline.raw)[1]-dim(taf.edgi.coping.baseline.raw.id)[1]
}
```
# TAF - baseline 
## NBR 
### Read in data
```{r NBR taf sign up cols}
if(NBR == TRUE){
taf.nbr.baseline.raw <- readRDS(file = "../data_raw/nbr/taf_coping_nbr.rds")
dim(taf.nbr.baseline.raw)
colnames(taf.nbr.baseline.raw)
}

```
### Select variables
```{r NBR sign up taf select variables}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.nbr.baseline.raw.id <- taf.nbr.baseline.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.nbr.baseline.raw.id)
# Inspect colnames
colnames(taf.nbr.baseline.raw.id)
#Differences
dim(taf.nbr.baseline.raw)[1]-dim(taf.nbr.baseline.raw.id)[1]
}
```
# TAF - baseline 
## RAMP
### Read in data
```{r RAMP taf sign up cols}
if(RAMP == TRUE){
taf.ramp.baseline.raw <- readRDS(file = "../data_raw/ramp/taf_ramp.rds")
dim(taf.ramp.baseline.raw)
colnames(taf.ramp.baseline.raw)
}
```

### Select variables
```{r RAMP sign up taf select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.ramp.baseline.raw.id <- taf.ramp.baseline.raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         cohort_name, # Sample
         #startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_baseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_baseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_baseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_baseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_baseline = taf.weeks_past_felt.1, #renamed to same as follow up
         taf.pandemic_felt.1_baseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_baseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_baseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.baseline.raw.id)
# Inspect colnames
colnames(taf.ramp.baseline.raw.id)
#Differences
dim(taf.ramp.baseline.raw)[1]-dim(taf.ramp.baseline.raw.id)[1]
}
```

# TAF - follow up A
## COPING
### Read in data
```{r COPING taf follow up a cols}
if(COPING == TRUE){
taf.coping.followupa.raw <- readRDS(file = "../data_raw/coping/taf_coping_followupa.rds")
dim(taf.coping.followupa.raw)
colnames(taf.coping.followupa.raw)
}
```

### Select variables
```{r COPING taf follow up a select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.coping.followupa.raw.id <- taf.coping.followupa.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_wavesA = startDate,
         #endDate,
         taf.worth_living_life_people_followupA = taf.worth_living_life_people,
         taf.felt_weeks_past_followupA = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself_followupA = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_followupA = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks_followupA = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupa.raw.id)
# Inspect colnames
colnames(taf.coping.followupa.raw.id)
#Differences
dim(taf.coping.followupa.raw)[1]-dim(taf.coping.followupa.raw.id)[1]
}
```
# TAF - follow up b
## COPING
### Read in data
```{r COPING taf follow up b cols}
if(COPING == TRUE){
taf.coping.followupb.raw <- readRDS(file = "../data_raw/coping/taf_coping_followupb.rds")
dim(taf.coping.followupb.raw)
colnames(taf.coping.followupb.raw)
}
```

### Select variables
```{r COPING taf follow up b select variables}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.coping.followupb.raw.id <- taf.coping.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_wavesB = startDate,
         #endDate,
         taf.worth_living_life_people_followupB = taf.worth_living_life_people,
         taf.felt_weeks_past_followupB = taf.weeks_past_felt, #renamed to same follow up a
         taf.have_you_contemplated_harming_yourself_followupB = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_followupB = taf.weeks_past_felt.1, #renamed to same follow up a
         taf.meant_life_end_weeks_followupB = taf.deliberately_harmed_meant_end #renamed to same follow up a
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.coping.followupb.raw.id)
# Inspect colnames
colnames(taf.coping.followupb.raw.id)
#Differences
dim(taf.coping.followupb.raw)[1]-dim(taf.coping.followupb.raw.id)[1]
}
```
# TAF - follow up A
## RAMP
### Read in data
```{r RAMP taf follow up a cols}
if(RAMP == TRUE){
taf.ramp.followupa.raw <- readRDS(file = "../data_raw/ramp/taf_ramp_followupa.rds")
dim(taf.ramp.followupa.raw)
colnames(taf.ramp.followupa.raw)
}
```

### Select variables
```{r RAMP taf follow up a select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

taf.ramp.followupa.raw.id <- taf.ramp.followupa.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_wavesA_taf = startDate,
         #endDate,
         taf.worth_living_life_people_followupA = taf.worth_living_life_people,
         taf.felt_weeks_past_followupA = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself_followupA = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_followupA = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks_followupA = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.followupa.raw.id)
# Inspect colnames
colnames(taf.ramp.followupa.raw.id)
#Differences
dim(taf.ramp.followupa.raw)[1]-dim(taf.ramp.followupa.raw.id)[1]
}
```
# TAF - follow up B
## RAMP
### Read in data
```{r RAMP taf follow up b cols}
if(RAMP == TRUE){
taf.ramp.followupb.raw <- readRDS(file = "../data_raw/ramp/taf_ramp_followupb.rds")
dim(taf.ramp.followupb.raw)
colnames(taf.ramp.followupb.raw)
}
```
### Select variables
```{r RAMP taf follow up b select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate_waves",
                  "endDate")

taf.ramp.followupb.raw.id <- taf.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_wavesB_taf = startDate,
         #endDate,
         taf.worth_living_life_people_followupB = taf.worth_living_life_people,
         taf.felt_weeks_past_followupB = taf.weeks_past_felt, #renamed to match follow up a
         taf.have_you_contemplated_harming_yourself_followupB = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_followupB = taf.weeks_past_felt.1, #renamed to match follow up a
         taf.meant_life_end_weeks_followupB = taf.deliberately_harmed_meant_end #renamed to match follow up a
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(taf.ramp.followupb.raw.id)
# Inspect colnames
colnames(taf.ramp.followupb.raw.id)
#Differences
dim(taf.ramp.followupb.raw)[1]-dim(taf.ramp.followupb.raw.id)[1]
}
```
#CREATING AGE variable (age_unc)
##NBR
###age from birthday

```{r nbr dem calculating age from birthday}
if(NBR == TRUE) {
#add 1900 to birthyear
nbr.dem.raw.id$birthday_year_numeric <- nbr.dem.raw.id$birthday_year_numeric + 1900

#create dob as date format
nbr.dem.raw.id$Birthdate <- as.Date(paste(nbr.dem.raw.id$birthday_year_numeric,
                                  nbr.dem.raw.id$birthday_month_numeric,
                                  nbr.dem.raw.id$birthday_day_numeric,
                                  sep = "-"))

head(nbr.dem.raw.id$Birthdate)


#Calculate dem.age(remove NAs as it throws an error)
ages <- eeptools::age_calc(na.omit(nbr.dem.raw.id$Birthdate), enddate = Sys.Date(), units = "years")

#Create dem.agecolumn
nbr.dem.raw.id$age_unc<- NA

#Populate with values (excluding NAs)
nbr.dem.raw.id$age_unc[!is.na(nbr.dem.raw.id$Birthdate)] <- ages

#Round age down
nbr.dem.raw.id$age_unc <- floor(nbr.dem.raw.id$age_unc)

#Visualise
head(nbr.dem.raw.id$age_unc)
head(nbr.dem.raw.id$Birthdate)
}
```

# Gender categories synchronised - GLAD
RAMP has the correct Gender categories so does not need editing.
```{r gender recoding for GLAD}
if(GLAD == TRUE) {
glad.coping.dem.raw.id <- glad.coping.dem.raw.id %>%
  mutate(
    gender_unc =
      recode_factor(gender_unc,
        "Male" = "Male",
        "Female" = "Female",
        "Non-binary" = "Non-binary",
        "self-define" = "Prefer to self-define"
      ))
}
```

# Gender categories synchronised - EDGI
RAMP has the correct Gender categories so does not need editing.
```{r gender recoding for EDGI}
if(EDGI == TRUE) {
edgi.coping.dem.raw.id <- edgi.coping.dem.raw.id %>%
  mutate(
    gender_unc =
      recode_factor(gender_unc,
        "Male" = "Male",
        "Female" = "Female",
        "Non-binary" = "Non-binary",
        "self-define" = "Prefer to self-define"
      ))
}
```

# Gender categories synchronised - NBR
RAMP has the correct Gender categories so does not need editing.
```{r gender recoding for NBR}
if(NBR == TRUE) {
nbr.dem.raw.id <- nbr.dem.raw.id %>%
  mutate(
    gender_unc =
      recode_factor(gender_unc,
        "Male" = "Male",
        "Female" = "Female",
        "Non-binary" = "Non-binary",
        "Self-define" = "Prefer to self-define"
      ))
}
```


### Ethnicity information NBR 
```{r nbr ethnicity information}
if(NBR == TRUE){
  nbr.ethnicity.raw <- read_csv("../data_raw/nbr/coping_participants_export_20200730_hashed.csv")
  dim(nbr.ethnicity.raw)
  colnames(nbr.ethnicity.raw)
  }
```

```{r nbr cohort cleaning}
if(NBR == TRUE) {
exclude_cols_ethnicity_nbr <- c("ID")

nbr.ethnicity.raw.id <- nbr.ethnicity.raw %>%
  drop_na(`NBR ID`) %>% # Drop NAs
  distinct(`NBR ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  #add_column(cohort_name = "nbr", .after = "`NBR ID`") %>% #create new column 
  select(
         ID = `NBR ID`, # ID
         #cohort_name, # Sample
         #endDate,
         ethnicity.unc = ethnicity # Ethnicity
         ) %>%
  add_numeric(., exclude = exclude_cols_ethnicity_nbr) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
# Inspect dimensions
dim(nbr.ethnicity.raw.id)
# Inspect colnames
colnames(nbr.ethnicity.raw.id)
#Differences
dim(nbr.ethnicity.raw)[1]-dim(nbr.ethnicity.raw.id)[1]
}


```

```{r nbr cohort recode ethnicity}
if(NBR == TRUE) {
#Recode details ethnicity info
nbr.ethnicity.raw.id$ethnicity_full <- recode_factor(nbr.ethnicity.raw.id$ethnicity.unc,
                                             "A" = "White - British",
                                             "B" = "White - Irish",
                                             "C" = "White - Other",
                                             "D" = "Mixed - White & Black Caribbean",
                                             "E" = "Mixed - White & Black African",
                                             "F" = "Mixed - White & Asian",
                                             "G" = "Mixed - Other",
                                             "H" = "Asian - Indian",
                                             "J" = "Asian - Pakistani",
                                             "K" = "Asian - Bangladeshi",
                                             "L" = "Asian - Other",
                                             "M" = "Black - Caribbean",
                                             "N" = "Black - African",
                                             "P" = "Black - Other",
                                             "R" = "Chinese - Chinese",
                                             "S" = "Chinese - Other",
                                             "W" = "White - not disclosed", ## Asking NBR what this level means
                                             "Z" = NULL,
                                             "99" = NULL)

#Match GLAD/EDGI/RAMP categories
nbr.ethnicity.raw.id$ethnicity_unc <- recode_factor(nbr.ethnicity.raw.id$ethnicity.unc,
                                             "A" = "White, white European or Caucasian",
                                             "B" = "White, white European or Caucasian",
                                             "C" = "White, white European or Caucasian",
                                             "D" = "Mixed or multiple ethnic origins",
                                             "E" = "Mixed or multiple ethnic origins",
                                             "F" = "Mixed or multiple ethnic origins",
                                             "G" = "Mixed or multiple ethnic origins",
                                             "H" = "Asian or Asian British (including Chinese)",
                                             "J" = "Asian or Asian British (including Chinese)",
                                             "K" = "Asian or Asian British (including Chinese)",
                                             "L" = "Asian or Asian British (including Chinese)",
                                             "M" = "Black or Black British",
                                             "N" = "Black or Black British",
                                             "P" = "Black or Black British",
                                             "R" = "Asian or Asian British (including Chinese)",
                                             "S" = "Asian or Asian British (including Chinese)",
                                             "W" = "White, white European or Caucasian",
                                             "Z" = NULL,
                                             "99" = NULL)
}
```

###Combine ethnicity info with nbr demographics 
```{r nbr combine demographics}
if(NBR == TRUE){
nbr.dem.raw.id.complete <- left_join(nbr.dem.raw.id, nbr.ethnicity.raw.id, by = c("ID"))
# Inspect dimensions
dim(nbr.dem.raw.id.complete)
# Inspect colnames
colnames(nbr.dem.raw.id.complete)
#Differences
dim(nbr.dem.raw.id)[1]-dim(nbr.dem.raw.id.complete)[1]
}

```
###Ethnicity recoding - all datasets
# Ethnicity recoding EDGI
```{r ethnicity recoding for EDGI}
if(EDGI == TRUE) {
edgi.dem3.raw.id <- edgi.dem3.raw.id %>%
  mutate(
    ethnicity =
      recode_factor(ethnicity_unc,
        "White" = "White",
        "Mixed" = "Mixed or multiple ethnic origins",
        "Asian or Asian British" = "Asian or Asian British",
        "Black or Black British" = "Black or Black British",
        "Arab" = "Arab",
        "Other ethnic group:" = "Other ethnic group"
      )
  )
}


```

# Ethnicity recoding GLAD
```{r ethnicity recoding for GLAD}
if(GLAD == TRUE) {
glad.dem3.raw.id <- glad.dem3.raw.id %>%
  mutate(
    ethnicity =
      recode_factor(ethnicity_unc,
        "White" = "White",
        "Mixed" = "Mixed or multiple ethnic origins",
        "Asian or Asian British" = "Asian or Asian British",
        "Black or Black British" = "Black or Black British",
        "Arab" = "Arab",
        "Other ethnic group:" = "Other ethnic group"
      )
  )
}
```

# Ethnicity recoding RAMP
```{r ethnicity recoding for RAMP}
if(RAMP == TRUE) {
ramp.dem.raw.id <- ramp.dem.raw.id %>%
  mutate(
    ethnicity =
      recode_factor(ethnicity_unc,
        "White" = "White",
        "Mixed" = "Mixed or multiple ethnic origins",
        "Asian or Asian British" = "Asian or Asian British",
        "Black or Black British" = "Black or Black British",
        "Arab" = "Arab",
        "Other ethnic group:" = "Other ethnic group"
      )
  )
}
```

# Ethnicity recoding NBR
```{r ethnicity recoding for NBR}
if(NBR == TRUE) {
nbr.dem.raw.id.complete <- nbr.dem.raw.id.complete %>%
  mutate(
    ethnicity =
      recode_factor(ethnicity_unc,
        "White, white European or Caucasian" = "White",
        "Mixed or multiple ethnic origins" = "Mixed or multiple ethnic origins",
        "Asian or Asian British (including Chinese)" = "Asian or Asian British",
        "Black or Black British" = "Black or Black British",
        "Arab" = "Arab",
        "Other ethnic group (please specify)" = "Other ethnic group"
      )
  ) %>%
  mutate(
    ethnicity_numeric =
      recode(ethnicity.unc_numeric,
        "White" = 1,
        "Mixed or multiple ethnic origins" = 2,
        "Asian or Asian British" = 3,
        "Black or Black British" = 4,
        "Arab" = 5,
        "Other ethnic group" = 6
      )
  )
}

```


#CLEANING DEMOGRAPHICS 
##GLAD
###Cleaning age
```{r coping glad cleaning age}
# Clean Age variable
#Age outlier
if(GLAD == TRUE) {
# Define age limits
age_upper_limit = 117 # The oldest person in the world is 117 years
age_lower_limit = 16

#Identify number of outliers
length(
  which(
  glad.dem3.raw.id$age_unc_numeric > age_upper_limit |
    glad.dem3.raw.id$age_unc_numeric < age_lower_limit
     )
)

#Remove age outliers
glad.dem3.raw.id <- glad.dem3.raw.id %>%
  mutate(
    age =
      if_else(
        age_unc_numeric > age_upper_limit |
        age_unc_numeric < age_lower_limit,
        true = NA_real_,
        false = age_unc_numeric,
        missing = NA_real_
      )
  )
  
# Inspect variable
glad.dem3.raw.id %>%
  descr(
    age,
    #stats = "common"
    )
}
```

##EDGI
###Cleaning age
```{r coping EDGI cleaning age}
# Clean Age variable
#Age outlier
if(EDGI == TRUE) {
# Define age limits
age_upper_limit = 117 # The oldest person in the world is 117 years
age_lower_limit = 16

#Identify number of outliers
length(
  which(
  edgi.dem3.raw.id$age_unc_numeric > age_upper_limit |
    edgi.dem3.raw.id$age_unc_numeric < age_lower_limit
     )
)

#Remove age outliers
edgi.dem3.raw.id <- edgi.dem3.raw.id %>%
  mutate(
    age =
      if_else(
        age_unc_numeric > age_upper_limit |
        age_unc_numeric < age_lower_limit,
        true = NA_real_,
        false = age_unc_numeric,
        missing = NA_real_
      )
  )
  
# Inspect variable
edgi.dem3.raw.id %>%
  descr(
    age,
    #stats = "common"
    )
}
```
##NBR
###Cleaning age
```{r coping NBR cleaning age}
# Clean Age variable
#Age outlier
if(NBR == TRUE) {
# Define age limits
age_upper_limit = 117 # The oldest person in the world is 117 years
age_lower_limit = 16

#Identify number of outliers
length(
  which(
  nbr.dem.raw.id.complete$age_unc > age_upper_limit |
   nbr.dem.raw.id.complete$age_unc < age_lower_limit
     )
)

#Remove age outliers
nbr.dem.raw.id.complete <- nbr.dem.raw.id.complete %>%
  mutate(
    age =
      if_else(
        age_unc > age_upper_limit |
        age_unc < age_lower_limit,
        true = NA_real_,
        false = age_unc,
        missing = NA_real_
      )
  )
  
# Inspect variable
nbr.dem.raw.id.complete %>%
  descr(
    age,
    #stats = "common"
    )
}
```

## Categorise age into groups
In RAMP, age is indicated categorically: 16-18, 19-25, 26-35, 36-45, 46-55, 56-65, 66-70, 71-75, 76-80, 81-85, 86-90, 91-100, 100+
Age categories in GLAD, EDGI and NBR have been created to reflect this
```{r Age groups GLAD}
if(GLAD == TRUE) {
# Create categorical age groups per 10 years
glad.dem3.raw.id <- glad.dem3.raw.id %>%
  mutate(
    age_category_numeric =
      case_when(
          age >= 16 & age <= 18 ~ 1,
          age >= 19 & age <= 25 ~ 2,
          age >= 26 & age <= 35 ~ 3,
          age >= 36 & age <= 45 ~ 4,
          age >= 46 & age <= 55 ~ 5,
          age >= 56 & age <= 65 ~ 6,
          age >= 66 & age <= 70 ~ 7,
          age >= 71 & age <= 75 ~ 8,
          age >= 76 & age <= 80 ~ 9,
          age >= 81 & age <= 85 ~ 10,
          age >= 86 & age <= 90 ~ 11,
          age >= 91 & age <= 100 ~ 12,
          age >= 101 & age <= 120 ~ 13 # oldest person in the world is 117 years
                )
      )

glad.dem3.raw.id <- glad.dem3.raw.id %>%
    mutate(
      age_category =
        recode_factor(
          age_category_numeric,
          "1" = "16-18",
          "2" = "19-25",
          "3" = "26-35",
          "4" = "36-45",
          "5" = "46-55",
          "6" = "56-65",
          "7" = "66-70",
          "8" = "71-75",
          "9" = "76-80",
          "10" = "81-85",
          "11" = "86-90",
          "12" = "91-100",
          "13" = "100+"
          )
    )
glad.dem3.raw.id %>%
  freq(age_category)
}
```


## Categorise age into groups EDGI
In RAMP, age is indicated categorically: 16-18, 19-25, 26-35, 36-45, 46-55, 56-65, 66-70, 71-75, 76-80, 81-85, 86-90, 91-100, 100+
Age categories in GLAD, EDGI and NBR have been created to reflect this
```{r Age groups EDGI}
if(EDGI == TRUE) {
# Create categorical age groups per 10 years
edgi.dem3.raw.id <- edgi.dem3.raw.id %>%
  mutate(
    age_category_numeric =
      case_when(
          age >= 16 & age <= 18 ~ 1,
          age >= 19 & age <= 25 ~ 2,
          age >= 26 & age <= 35 ~ 3,
          age >= 36 & age <= 45 ~ 4,
          age >= 46 & age <= 55 ~ 5,
          age >= 56 & age <= 65 ~ 6,
          age >= 66 & age <= 70 ~ 7,
          age >= 71 & age <= 75 ~ 8,
          age >= 76 & age <= 80 ~ 9,
          age >= 81 & age <= 85 ~ 10,
          age >= 86 & age <= 90 ~ 11,
          age >= 91 & age <= 100 ~ 12,
          age >= 101 & age <= 120 ~ 13 # oldest person in the world is 117 years
                )
      )

  edgi.dem3.raw.id <-   edgi.dem3.raw.id %>%
    mutate(
      age_category =
        recode_factor(
          age_category_numeric,
          "1" = "16-18",
          "2" = "19-25",
          "3" = "26-35",
          "4" = "36-45",
          "5" = "46-55",
          "6" = "56-65",
          "7" = "66-70",
          "8" = "71-75",
          "9" = "76-80",
          "10" = "81-85",
          "11" = "86-90",
          "12" = "91-100",
          "13" = "100+"
          )
    )
edgi.dem3.raw.id %>%
  freq(age_category)
}
```
## Categorise age into groups NBR
In RAMP, age is indicated categorically: 16-18, 19-25, 26-35, 36-45, 46-55, 56-65, 66-70, 71-75, 76-80, 81-85, 86-90, 91-100, 100+
Age categories in GLAD, EDGI and NBR have been created to reflect this
```{r Age groups NBR}
if(NBR == TRUE) {
# Create categorical age groups per 10 years
nbr.dem.raw.id.complete <- nbr.dem.raw.id.complete %>%
  mutate(
    age_category_numeric =
      case_when(
          age >= 16 & age <= 18 ~ 1,
          age >= 19 & age <= 25 ~ 2,
          age >= 26 & age <= 35 ~ 3,
          age >= 36 & age <= 45 ~ 4,
          age >= 46 & age <= 55 ~ 5,
          age >= 56 & age <= 65 ~ 6,
          age >= 66 & age <= 70 ~ 7,
          age >= 71 & age <= 75 ~ 8,
          age >= 76 & age <= 80 ~ 9,
          age >= 81 & age <= 85 ~ 10,
          age >= 86 & age <= 90 ~ 11,
          age >= 91 & age <= 100 ~ 12,
          age >= 101 & age <= 120 ~ 13 # oldest person in the world is 117 years
                )
      )

nbr.dem.raw.id.complete <- nbr.dem.raw.id.complete %>%
    mutate(
      age_category =
        recode_factor(
          age_category_numeric,
          "1" = "16-18",
          "2" = "19-25",
          "3" = "26-35",
          "4" = "36-45",
          "5" = "46-55",
          "6" = "56-65",
          "7" = "66-70",
          "8" = "71-75",
          "9" = "76-80",
          "10" = "81-85",
          "11" = "86-90",
          "12" = "91-100",
          "13" = "100+"
          )
    )
nbr.dem.raw.id.complete %>%
  freq(age_category)
}
```
## Highest education (prepandemic, GLAD)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
Assumes University degree > Other professional qualification/A level > NVQ > GCSE/O Level/CSE
```{r Highest education prepandemic}
if(GLAD == TRUE) {
  #create numeric version of the highest education variable
glad.dem3.raw.id <- glad.dem3.raw.id %>%
  mutate(
    highest_education_prepan_numeric =
      case_when(
        dem.college_or_university_degree_numeric == "1" ~ 5,
        #dem.other_professional_qualifications_numeric == "1" ~ 5, #Not in EDGI
        dem.a_levelsas_levels_or_equivalent_numeric == "1" ~ 4,
        dem.nvq_or_hnd_or_hnc_or_equivalent_numeric == "1" ~ 3,
        dem.o_levelsgcses_or_equivalent_numeric == "1" ~ 2,
        dem.cses_or_equivalent_numeric == "1" ~ 2,
        dem.none_of_the_above_education_numeric == "1" ~ 1
    )
  )
#recode the numeric version into a factor
glad.dem3.raw.id <- glad.dem3.raw.id %>%
  mutate(
    highest_education_prepan =
      recode_factor(
        highest_education_prepan_numeric,
        `1` = "No formal qualifications",
        `2` = "GCSE/CSE",
        `3` = "NVQ",
        `4` = "A-levels",
        `5` = "University")
    )
glad.dem3.raw.id %>%
  freq(highest_education_prepan)
}

```

Check highest education coding GLAD
```{r Highest education prepandemic check GLAD}
if(GLAD == TRUE) {
glad.dem3.raw.id %>%
  select(highest_education_prepan,
        dem.college_or_university_degree,
        dem.a_levelsas_levels_or_equivalent,
        dem.nvq_or_hnd_or_hnc_or_equivalent,
        dem.o_levelsgcses_or_equivalent,
       # dem.other_professional_qualifications_numeric,
        dem.cses_or_equivalent,
        dem.none_of_the_above_education
  )
}
```

## Highest education (prepandemic, EDGI)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
Assumes University degree > A level > NVQ > GCSE/O Level/CSE
```{r Highest education prepandemic}
if(EDGI == TRUE) {

  #create numeric version of the highest education variable
edgi.dem3.raw.id <- edgi.dem3.raw.id %>%
  mutate(
    highest_education_prepan_numeric =
      case_when(
         demographics.collegeuniversity_numeric == "1" ~ 5,
         demographics.asa_levels_numeric == "1" ~ 4,
         demographics.nvq_numeric == "1" ~ 3,
         demographics.cse_numeric == "1" ~ 2,
         demographics.gcse_numeric == "1" ~ 2,
        demographics.none_of_the_above_numeric == "1" ~ 1
    )
  )
#recode the numeric version into a factor
edgi.dem3.raw.id <- edgi.dem3.raw.id %>%
  mutate(
    highest_education_prepan =
      recode_factor(
        highest_education_prepan_numeric,
        `1` = "No formal qualifications",
        `2` = "GCSE/CSE",
        `3` = "NVQ",
        `4` = "A-levels",
        `5` = "University")
    )
edgi.dem3.raw.id %>%
  freq(highest_education_prepan)
}

```

Check highest education coding EDGI
```{r Highest education prepandemic check GLAD}
if(EDGI == TRUE) {
edgi.dem3.raw.id %>%
  select(highest_education_prepan,
        demographics.collegeuniversity,
        demographics.asa_levels_numeric,
        demographics.nvq_numeric,
        demographics.cse_numeric,
        demographics.gcse_numeric,
        demographics.none_of_the_above_numeric
  )
}
```

```{r dem summary EDGI}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.dem3.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

## Highest education (baseline, GLAD)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
Assumes University degree > A level > NVQ > GCSE/O Level/CSE
```{r Highest education baseline}
if(GLAD == TRUE) {
#create numeric version of the highest education variable
glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw.id  %>%
  mutate(
    highest_education_numeric =
      case_when(
        employ.phd_numeric == "1" ~ 5,
        employ.masters_degree_or_equivalent_numeric == "1" ~ 5,
        employ.postgraduate_degree_or_equivalent_numeric == "1" ~ 5,
        employ.bachelors_degree_or_equivalent_numeric == "1" ~ 5,
        employ.a_levelsas_levels_or_equivalent_numeric == "1" ~ 4,
        employ.nvq_or_hnd_or_hnc_or_equivalent_numeric == "1" ~ 3,
        employ.o_levelsgcses_or_equivalent_numeric == "1" ~ 2,
        employ.cses_or_equivalent_numeric == "1" ~ 2,
        employ.none_of_the_above_numeric == "1" ~ 1
      )
  )
  
    
#recode the numeric version into a factor
glad.coping.dem4.employ.raw.id  <- glad.coping.dem4.employ.raw.id %>%
  mutate(
    highest_education =
      recode_factor(
        highest_education_numeric,
        `1` = "No formal qualifications",
        `2` = "GCSE/CSE",
        `3` = "NVQ",
        `4` = "A-levels",
        `5` = "University")
    )
glad.coping.dem4.employ.raw.id  %>%
  freq(highest_education)
}


```
Check highest education coding
```{r Highest education check GLAD}
if(GLAD == TRUE) {
glad.coping.dem4.employ.raw.id %>%
  select(highest_education,
         highest_education_numeric,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent
  )
}
```

# Employment
## Highest education (baseline, EDGI)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
Assumes University degree > A level > NVQ > GCSE/O Level/CSE
```{r Highest education baseline}
if(EDGI == TRUE) {

  #create numeric version of the highest education variable
edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id %>%
  mutate(
    highest_education_numeric =
      case_when(
        employ.phd_numeric == "1" ~ 5,
        employ.masters_degree_or_equivalent_numeric == "1" ~ 5,
        employ.postgraduate_degree_or_equivalent_numeric == "1" ~ 5,
        employ.bachelors_degree_or_equivalent_numeric == "1" ~ 5,
        employ.a_levelsas_levels_or_equivalent_numeric == "1" ~ 4,
        employ.nvq_or_hnd_or_hnc_or_equivalent_numeric == "1" ~ 3,
        employ.o_levelsgcses_or_equivalent_numeric == "1" ~ 2,
        employ.cses_or_equivalent_numeric == "1" ~ 2,
        employ.none_of_the_above_numeric == "1" ~ 1
      )
  )
  
    
#recode the numeric version into a factor
edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id %>%
  mutate(
    highest_education =
      recode_factor(
        highest_education_numeric,
        `1` = "No formal qualifications",
        `2` = "GCSE/CSE",
        `3` = "NVQ",
        `4` = "A-levels",
        `5` = "University")
    )
edgi.coping.dem4.employ.raw.id %>%
  freq(highest_education)
}


```
Check highest education coding
```{r Highest education check EDGI}
if(EDGI == TRUE) {
edgi.coping.dem4.employ.raw.id %>%
  select(highest_education,
         highest_education_numeric,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent
  )
}
```
# Employment
## Highest education (baseline, NBR)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
Assumes University degree > A level > NVQ > GCSE/O Level/CSE
```{r Highest education baseline}
if(NBR == TRUE) {
  #create numeric version of the highest education variable
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id %>%
  mutate(
    highest_education_numeric =
      case_when(
        employ.phd_numeric == "1" ~ 5,
        employ.masters_degree_or_equivalent_numeric == "1" ~ 5,
        employ.postgraduate_degree_or_equivalent_numeric == "1" ~ 5,
        employ.bachelors_degree_or_equivalent_numeric == "1" ~ 5,
        employ.a_levelsas_levels_or_equivalent_numeric == "1" ~ 4,
        employ.nvq_or_hnd_or_hnc_or_equivalent_numeric == "1" ~ 3,
        employ.o_levelsgcses_or_equivalent_numeric == "1" ~ 2,
        employ.cses_or_equivalent_numeric == "1" ~ 2,
        employ.none_of_the_above_numeric == "1" ~ 1
      )
  )
  
    
#recode the numeric version into a factor
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id %>%
  mutate(
    highest_education =
      recode_factor(
        highest_education_numeric,
        `1` = "No formal qualifications",
        `2` = "GCSE/CSE",
        `3` = "NVQ",
        `4` = "A-levels",
        `5` = "University")
    )
nbr.dem.employ.raw.id %>%
  freq(highest_education)
}


```
Check highest education coding
```{r Highest education check nbr}
if(NBR == TRUE) {
nbr.dem.employ.raw.id %>%
  select(highest_education,
         highest_education_numeric,
         employ.phd,
         employ.masters_degree_or_equivalent,
         employ.postgraduate_degree_or_equivalent,
         employ.bachelors_degree_or_equivalent,
         employ.a_levelsas_levels_or_equivalent,
         employ.nvq_or_hnd_or_hnc_or_equivalent,
         employ.o_levelsgcses_or_equivalent,
         employ.cses_or_equivalent
  )
}
```

## Highest education (baseline, RAMP)
```{r highest level of education for ramp}
if(RAMP == TRUE){
  #create numeric version of the highest education variable
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id %>%
  mutate(
    highest_education_numeric =
      case_when(
        employ.what_is_your_highest_level_of_education == "PhD" ~ 4,
        employ.what_is_your_highest_level_of_education == "Postgraduate degree or equivalent" ~ 4,
        employ.what_is_your_highest_level_of_education == "Master's degree or equivalent" ~ 4,
        employ.what_is_your_highest_level_of_education == "Bachelor's degree or equivalent" ~ 4,
        employ.what_is_your_highest_level_of_education == "A-level or equivalent" ~ 3,
        employ.what_is_your_highest_level_of_education == "GCSE or equivalent" ~ 1,
        employ.what_is_your_highest_level_of_education == "None of these" ~ 5
      )
    )
#recode the numeric version into a factor
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id %>%
  mutate(
    highest_education =
      recode_factor(
        highest_education_numeric,
        `1` = "GCSE/CSE",
        `2` = NA_character_,
        `3` = "A-levels",
        `4` = "University",
        `5` = "No formal qualifications")
    )
ramp.dem.employ.raw.id %>%
  freq(highest_education)
}

```


Check highest education coding for RAMP
```{r Highest education check for RAMP}
if(RAMP == TRUE) {
ramp.dem.employ.raw.id %>%
  select(highest_education,
         highest_education_numeric,
         employ.what_is_your_highest_level_of_education,
         employ.what_is_your_highest_level_of_education_numeric
  )
}
```

## Employment prior to pandemic (baseline, GLAD)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
```{r Employment prior to pandemic baseline GLAD}
if(GLAD == TRUE) {
#create numeric version of the highest education variable
glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw.id %>%
  mutate(
    employment_prior_covid_numeric =
      case_when(
        employ.fulltime_employed_numeric == "1" ~ 1,
        employ.parttime_employed_numeric == "1" ~ 1,
        employ.unemployed_numeric == "1" ~ 2,
        employ.zerohours_contract_numeric == "1" ~ 1,
        employ.selfemployed_numeric == "1" ~ 1,
        employ.contract_or_freelance_work_numeric == "1" ~ 1,
        employ.small_business_owner_numeric == "1" ~ 1,
        employ.retired_numeric  ==  "1" ~ 4,
        employ.student_gcse_or_a_level_numeric == "1" ~ 3,
        employ.student_university_numeric == "1" ~ 3
      )
    )
#recode the numeric version into a factor
glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw.id %>%
  mutate(
    employment_prior_covid =
      recode_factor(
        employment_prior_covid_numeric,
        `1` = "Employed",
        `2` = "Unemployed",
        `3` = "Student",
        `4` = "Retired")
    )
glad.coping.dem4.employ.raw.id %>%
  freq(employment_prior_covid)
}

```
Check Employment prior to pandemic coding
```{r Employment prior to pandemic check GLAD}
if(GLAD == TRUE) {
glad.coping.dem4.employ.raw.id %>%
  select(employment_prior_covid,
         employment_prior_covid_numeric,
        employ.fulltime_employed_numeric,
        employ.parttime_employed_numeric,
        employ.unemployed_numeric,
        employ.zerohours_contract_numeric,
        employ.selfemployed_numeric,
        employ.contract_or_freelance_work_numeric,
        employ.small_business_owner_numeric,
        employ.retired_numeric,
        employ.student_gcse_or_a_level_numeric,
        employ.student_university_numeric
  )
}
```

## Employment prior to pandemic (baseline, EDGI)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
```{r Employment prior to pandemic baseline GLAD}
if(EDGI == TRUE) {
#create numeric version of the highest education variable

edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id %>%
  mutate(
    employment_prior_covid_numeric =
      case_when(
        employ.fulltime_employed_numeric == "1" ~ 1,
        employ.parttime_employed_numeric == "1" ~ 1,
        employ.unemployed_numeric == "1" ~ 2,
        employ.zerohours_contract_numeric == "1" ~ 1,
        employ.selfemployed_numeric == "1" ~ 1,
        employ.contract_or_freelance_work_numeric == "1" ~ 1,
        employ.small_business_owner_numeric == "1" ~ 1,
        employ.retired_numeric  ==  "1" ~ 4,
        employ.student_gcse_or_a_level_numeric == "1" ~ 3,
        employ.student_university_numeric == "1" ~ 3
      )
    )
#recode the numeric version into a factor
edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id %>%
  mutate(
    employment_prior_covid =
      recode_factor(
        employment_prior_covid_numeric,
        `1` = "Employed",
        `2` = "Unemployed",
        `3` = "Student",
        `4` = "Retired")
    )
edgi.coping.dem4.employ.raw.id %>%
  freq(employment_prior_covid)
}
```

Check Employment prior to pandemic coding
```{r Employment prior to pandemic check EDGI}
if(EDGI == TRUE) {
edgi.coping.dem4.employ.raw.id %>%
  select(employment_prior_covid,
         employment_prior_covid_numeric,
        employ.fulltime_employed_numeric,
        employ.parttime_employed_numeric,
        employ.unemployed_numeric,
        employ.zerohours_contract_numeric,
        employ.selfemployed_numeric,
        employ.contract_or_freelance_work_numeric,
        employ.small_business_owner_numeric,
        employ.retired_numeric,
        employ.student_gcse_or_a_level_numeric,
        employ.student_university_numeric
  )
}
```

## Employment prior to pandemic (baseline, nbr)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
```{r Employment prior to pandemic baseline GLAD}
if(NBR == TRUE) {
#create numeric version of the highest education variable
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id %>%
  mutate(
    employment_prior_covid_numeric =
      case_when(
        employ.fulltime_employed_numeric == "1" ~ 1,
        employ.parttime_employed_numeric == "1" ~ 1,
        employ.unemployed_numeric == "1" ~ 2,
        employ.zerohours_contract_numeric == "1" ~ 1,
        employ.selfemployed_numeric == "1" ~ 1,
        employ.contract_or_freelance_work_numeric == "1" ~ 1,
        employ.small_business_owner_numeric == "1" ~ 1,
        employ.retired_numeric  ==  "1" ~ 4,
        employ.student_gcse_or_a_level_numeric == "1" ~ 3,
        employ.student_university_numeric == "1" ~ 3
      )
    )
#recode the numeric version into a factor
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id %>%
  mutate(
    employment_prior_covid =
      recode_factor(
        employment_prior_covid_numeric,
        `1` = "Employed",
        `2` = "Unemployed",
        `3` = "Student",
        `4` = "Retired")
    )
nbr.dem.employ.raw.id %>%
  freq(employment_prior_covid)
}
```

Check Employment prior to pandemic coding
```{r Employment prior to pandemic check nbr}
if(NBR == TRUE) {
nbr.dem.employ.raw.id %>%
  select(employment_prior_covid,
         employment_prior_covid_numeric,
        employ.fulltime_employed_numeric,
        employ.parttime_employed_numeric,
        employ.unemployed_numeric,
        employ.zerohours_contract_numeric,
        employ.selfemployed_numeric,
        employ.contract_or_freelance_work_numeric,
        employ.small_business_owner_numeric,
        employ.retired_numeric,
        employ.student_gcse_or_a_level_numeric,
        employ.student_university_numeric
  )
}
```

## Employment prior to pandemic (baseline, RAMP)
```{r highest level of education for ramp}
if(RAMP == TRUE) {
#create numeric version of the highest education variable
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id %>%
  mutate(
    employment_prior_covid_numeric =
      case_when(
        employ.fulltime_employed_numeric == "1" ~ 1,
        employ.parttime_employed_numeric == "1" ~ 1,
        employ.unemployed_numeric == "1" ~ 2,
        employ.zerohours_contract_numeric == "1" ~ 1,
        employ.selfemployed_numeric == "1" ~ 1,
        employ.contract_or_freelance_work_numeric == "1" ~ 1,
        employ.small_business_owner_numeric == "1" ~ 1,
        employ.retired_numeric  ==  "1" ~ 4,
        employ.student_gcse_or_a_level_numeric == "1" ~ 3,
        employ.student_university_numeric == "1" ~ 3
      )
    )
#recode the numeric version into a factor
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id %>%
  mutate(
    employment_prior_covid =
      recode_factor(
        employment_prior_covid_numeric,
        `1` = "Employed",
        `2` = "Unemployed",
        `3` = "Student",
        `4` = "Retired")
    )
ramp.dem.employ.raw.id %>%
  freq(employment_prior_covid)
}
```

Check Employment prior to pandemic coding for RAMP
```{r Employment prior to pandemic check for RAMP}
if(RAMP == TRUE) {
ramp.dem.employ.raw.id %>%
  select(employment_prior_covid,
         employment_prior_covid_numeric,
        employ.fulltime_employed_numeric,
        employ.parttime_employed_numeric,
        employ.unemployed_numeric,
        employ.zerohours_contract_numeric,
        employ.selfemployed_numeric,
        employ.contract_or_freelance_work_numeric,
        employ.small_business_owner_numeric,
        employ.retired_numeric,
        employ.student_gcse_or_a_level_numeric,
        employ.student_university_numeric
  )
}
```

## Employment change (baseline, GLAD)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
```{r Employment change baseline GLAD}
if(GLAD == TRUE) {
#create numeric version of the highest education variable
glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw.id %>%
  mutate(
    employment_change_numeric =
      case_when(
        employ.reduction_in_hours_numeric == "1" ~ 1,
        employ.reduction_in_salary_numeric == "1" ~ 1,
        employ.became_unemployed_numeric == "1" ~ 1,
        employ.benefits_decreased_numeric == "1" ~ 1,
        employ.increased_hours_numeric == "1" ~ 2,
        employ.increased_salary_numeric == "1" ~ 3,
        employ.became_employed_numeric == "1" ~ 3,
        employ.benefits_increased_numeric  ==  "1" ~ 2,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 3,
        employ.furloughed_or_paid_leave_company_funded_numeric == "1" ~ 3,
        employ.paid_leave_furloughed_numeric == "1" ~ 3,
        employ.my_employment_status_has_not_changed_numeric == "1" ~ 4
      )
    )

#recode the numeric version into a factor
glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw.id %>%
  mutate(
    employment_change =
      recode_factor(
        employment_change_numeric,
        `1` = "Decreased employment",
        `2` = "Increased employment",
        `3` = "Furloughed",
        `4` = "Employment not changed")
    )
glad.coping.dem4.employ.raw.id %>%
  freq(employment_change)
}

```

Check Employment change coding
```{r Employment change check}
if(GLAD == TRUE) {
glad.coping.dem4.employ.raw.id %>%
  select(employment_change,
         employment_change_numeric,
        employ.reduction_in_hours_numeric,
        employ.reduction_in_salary_numeric,
        employ.became_unemployed_numeric,
        employ.benefits_decreased_numeric,
        employ.increased_hours_numeric,
        employ.increased_salary_numeric,
        employ.became_employed_numeric,
        employ.benefits_increased_numeric,
        employ.furloughed_or_paid_leave_government_funded_numeric,
        employ.furloughed_or_paid_leave_company_funded_numeric,
        employ.paid_leave_furloughed_numeric,
        employ.my_employment_status_has_not_changed_numeric
  )
}
```


## Employment change (baseline, EDGI)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
```{r Employment change baseline EDGI}
if(EDGI == TRUE) {
#create numeric version of the highest education variable
edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id %>%
  mutate(
    employment_change_numeric =
      case_when(
        employ.reduction_in_hours_numeric == "1" ~ 1,
        employ.reduction_in_salary_numeric == "1" ~ 1,
        employ.became_unemployed_numeric == "1" ~ 1,
        employ.benefits_decreased_numeric == "1" ~ 1,
        employ.increased_hours_numeric == "1" ~ 2,
        employ.increased_salary_numeric == "1" ~ 3,
        employ.became_employed_numeric == "1" ~ 3,
        employ.benefits_increased_numeric  ==  "1" ~ 2,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 3,
        employ.furloughed_or_paid_leave_company_funded_numeric == "1" ~ 3,
        employ.paid_leave_furloughed_numeric == "1" ~ 3,
        employ.my_employment_status_has_not_changed_numeric == "1" ~ 4
      )
    )

#recode the numeric version into a factor
edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id %>%
  mutate(
    employment_change =
      recode_factor(
        employment_change_numeric,
        `1` = "Decreased employment",
        `2` = "Increased employment",
        `3` = "Furloughed",
        `4` = "Employment not changed")
    )
edgi.coping.dem4.employ.raw.id %>%
  freq(employment_change)
}

```

Check Employment change coding
```{r Employment change check}
if(EDGI == TRUE) {
edgi.coping.dem4.employ.raw.id %>%
  select(employment_change,
         employment_change_numeric,
        employ.reduction_in_hours_numeric,
        employ.reduction_in_salary_numeric,
        employ.became_unemployed_numeric,
        employ.benefits_decreased_numeric,
        employ.increased_hours_numeric,
        employ.increased_salary_numeric,
        employ.became_employed_numeric,
        employ.benefits_increased_numeric,
        employ.furloughed_or_paid_leave_government_funded_numeric,
        employ.furloughed_or_paid_leave_company_funded_numeric,
        employ.paid_leave_furloughed_numeric,
        employ.my_employment_status_has_not_changed_numeric
  )
}
```
## Employment change (baseline, NBR)
Proceed along qualifications fields. If field is not blank, take that as highest qual. If field is blank, check next field. If all fields are blank, NA
```{r Employment change baseline NBR}
if(NBR == TRUE) {
#create numeric version of the highest education variable
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id %>%
  mutate(
    employment_change_numeric =
      case_when(
        employ.reduction_in_hours_numeric == "1" ~ 1,
        employ.reduction_in_salary_numeric == "1" ~ 1,
        employ.became_unemployed_numeric == "1" ~ 1,
        employ.benefits_decreased_numeric == "1" ~ 1,
        employ.increased_hours_numeric == "1" ~ 2,
        employ.increased_salary_numeric == "1" ~ 3,
        employ.became_employed_numeric == "1" ~ 3,
        employ.benefits_increased_numeric  ==  "1" ~ 2,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 3,
        employ.furloughed_or_paid_leave_company_funded_numeric == "1" ~ 3,
        employ.paid_leave_furloughed_numeric == "1" ~ 3,
        employ.my_employment_status_has_not_changed_numeric == "1" ~ 4
      )
    )

#recode the numeric version into a factor
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id %>%
  mutate(
    employment_change =
      recode_factor(
        employment_change_numeric,
        `1` = "Decreased employment",
        `2` = "Increased employment",
        `3` = "Furloughed",
        `4` = "Employment not changed")
    )
nbr.dem.employ.raw.id %>%
  freq(employment_change)
}

```

Check Employment change coding
```{r Employment change check}
if(NBR == TRUE) {
nbr.dem.employ.raw.id %>%
  select(employment_change,
         employment_change_numeric,
        employ.reduction_in_hours_numeric,
        employ.reduction_in_salary_numeric,
        employ.became_unemployed_numeric,
        employ.benefits_decreased_numeric,
        employ.increased_hours_numeric,
        employ.increased_salary_numeric,
        employ.became_employed_numeric,
        employ.benefits_increased_numeric,
        employ.furloughed_or_paid_leave_government_funded_numeric,
        employ.furloughed_or_paid_leave_company_funded_numeric,
        employ.paid_leave_furloughed_numeric,
        employ.my_employment_status_has_not_changed_numeric
  )
}
```
## Employment change (baseline, RAMP)
```{r employment change for ramp}
if(RAMP == TRUE) {
#create numeric version of the highest education variable
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id %>%
  mutate(
    employment_change_numeric =
      case_when(
        employ.reduction_in_hours_numeric == "1" ~ 1,
        employ.reduction_in_salary_numeric == "1" ~ 1,
        employ.became_unemployed_numeric == "1" ~ 1,
        employ.benefits_decreased_numeric == "1" ~ 1,
        employ.increased_hours_numeric == "1" ~ 2,
        employ.increased_salary_numeric == "1" ~ 3,
        employ.became_employed_numeric == "1" ~ 3,
        employ.benefits_increased_numeric  ==  "1" ~ 2,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 3,
        employ.furloughed_or_paid_leave_company_funded_numeric== "1" ~ 3,
        employ.paid_leave_furloughed_numeric == "1" ~ 3,
        employ.my_employment_status_has_not_changed_numeric == "1" ~ 4
      )
    )
#recode the numeric version into a factor
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id %>%
  mutate(
    employment_change =
      recode_factor(
        employment_change_numeric,
        `1` = "Decreased employment",
        `2` = "Increased employment",
        `3` = "Furloughed",
        `4` = "Employment not changed")
    )
ramp.dem.employ.raw.id %>%
  freq(employment_change)
}
```
Check Employment changen coding for RAMP
```{r Employment change check for RAMP}
if(RAMP == TRUE) {
ramp.dem.employ.raw.id %>%
  select(employment_change,
         employment_change_numeric,
        employ.reduction_in_hours_numeric,
        employ.reduction_in_salary_numeric,
        employ.became_unemployed_numeric,
        employ.benefits_decreased_numeric,
        employ.increased_hours_numeric,
        employ.increased_salary_numeric,
        employ.became_employed_numeric,
        employ.benefits_increased_numeric,
        employ.furloughed_or_paid_leave_government_funded_numeric,
        employ.furloughed_or_paid_leave_company_funded_numeric,
        employ.paid_leave_furloughed_numeric,
        employ.my_employment_status_has_not_changed_numeric
  )
}
```


## Key worker status GLAD
```{r Key worker GLAD}
if(GLAD == TRUE) {
#create numeric version of the variable
glad.coping.dem4.employ.raw.id <- glad.coping.dem4.employ.raw.id  %>%
  mutate(
    key_worker_numeric =
      case_when(
        employ.government_work_key_workers_numeric == "0" ~ 0,
        employ.government_work_key_workers_numeric > 0 ~ 1,
        employ.unemployed_numeric == "1" ~ 0,
        employ.stayathome_parent_or_carer_numeric == "1" ~ 0,
        employ.retired_numeric == "1" ~ 0,
        employ.became_unemployed_numeric == "0" ~ 0,
        employ.student_gcse_or_a_level_numeric == "1" ~ 0,
        employ.student_university_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_company_funded_numeric == "1" ~ 0,
        employ.paid_leave_furloughed_numeric == "1" ~ 0
      )
    )
#recode the numeric version into a factor
glad.coping.dem4.employ.raw.id  <- glad.coping.dem4.employ.raw.id  %>%
  mutate(
    key_worker =
      recode_factor(
        key_worker_numeric,
        `0` = "No key worker",
        `1` = "Key worker"
        )
    )
glad.coping.dem4.employ.raw.id  %>%
  freq(key_worker)
}
```

## Key worker status edgi
```{r Key worker EDGI}
if(EDGI == TRUE) {
#create numeric version of the variable
edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id  %>%
  mutate(
    key_worker_numeric =
      case_when(
        employ.government_work_key_workers_numeric == "0" ~ 0,
        employ.government_work_key_workers_numeric > 0 ~ 1,
        employ.unemployed_numeric == "1" ~ 0,
        employ.stayathome_parent_or_carer_numeric == "1" ~ 0,
        employ.retired_numeric == "1" ~ 0,
        employ.became_unemployed_numeric == "0" ~ 0,
        employ.student_gcse_or_a_level_numeric == "1" ~ 0,
        employ.student_university_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_company_funded_numeric == "1" ~ 0,
        employ.paid_leave_furloughed_numeric == "1" ~ 0
      )
    )
#recode the numeric version into a factor
edgi.coping.dem4.employ.raw.id <- edgi.coping.dem4.employ.raw.id  %>%
  mutate(
    key_worker =
      recode_factor(
        key_worker_numeric,
        `0` = "No key worker",
        `1` = "Key worker"
        )
    )
edgi.coping.dem4.employ.raw.id  %>%
  freq(key_worker)
}
```


## Key worker status NBR
```{r Key worker NBR}
if(NBR == TRUE) {
#create numeric version of the variable
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id  %>%
  mutate(
    key_worker_numeric =
      case_when(
        employ.government_work_key_workers_numeric == "0" ~ 0,
        employ.government_work_key_workers_numeric > 0 ~ 1,
        employ.unemployed_numeric == "1" ~ 0,
        employ.stayathome_parent_or_carer_numeric == "1" ~ 0,
        employ.retired_numeric == "1" ~ 0,
        employ.became_unemployed_numeric == "0" ~ 0,
        employ.student_gcse_or_a_level_numeric == "1" ~ 0,
        employ.student_university_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_company_funded_numeric == "1" ~ 0,
        employ.paid_leave_furloughed_numeric == "1" ~ 0
      )
    )
#recode the numeric version into a factor
nbr.dem.employ.raw.id <- nbr.dem.employ.raw.id  %>%
  mutate(
    key_worker =
      recode_factor(
        key_worker_numeric,
        `0` = "No key worker",
        `1` = "Key worker"
        )
    )
nbr.dem.employ.raw.id  %>%
  freq(key_worker)
}
```

## Key worker status RAMP
```{r Key worker RAMP}
if(RAMP == TRUE) {
#create numeric version of the variable
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id  %>%
  mutate(
    key_worker_numeric =
      case_when(
        employ.government_work_key_workers_numeric == "0" ~ 0,
        employ.government_work_key_workers_numeric > 0 ~ 1,
        employ.unemployed_numeric == "1" ~ 0,
        employ.stayathome_parent_or_carer_numeric == "1" ~ 0,
        employ.retired_numeric == "1" ~ 0,
        employ.became_unemployed_numeric == "0" ~ 0,
        employ.student_gcse_or_a_level_numeric == "1" ~ 0,
        employ.student_university_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_government_funded_numeric == "1" ~ 0,
        employ.furloughed_or_paid_leave_company_funded_numeric == "1" ~ 0,
        employ.paid_leave_furloughed_numeric == "1" ~ 0
      )
    )
#recode the numeric version into a factor
ramp.dem.employ.raw.id <- ramp.dem.employ.raw.id %>%
  mutate(
    key_worker =
      recode_factor(
        key_worker_numeric,
        `0` = "No key worker",
        `1` = "Key worker"
        )
    )
ramp.dem.employ.raw.id %>%
  freq(key_worker)
}
```


# MHD - MENTAL HEALTH DIAGNOSIS
# Columns to exclude from add_numeric
```{r cols to exclude}
exclude_cols <- c("cohort_name",
                  "ID")
```
## GLAD
```{r glad mhd cols}
if(GLAD == TRUE) {
glad.mhd.raw <- readRDS(file = "../data_raw/glad/mhd_glad.rds")
dim(glad.mhd.raw)
colnames(glad.mhd.raw)
}

```

```{r glad mhd cleaning}
if(GLAD == TRUE) {
glad.mhd.raw.id <- glad.mhd.raw %>%
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
 # mutate(ID = as.numeric(ID)) %>%
  add_column(cohort_name = "glad", .before = "startDate") %>% #create new column 
  select(
    ID = externalDataReference, # ID
    cohort_name, # Sample
    #startDate_prepandemic = startDate,
    starts_with("mhd."),
    mhd.depression_signup = mhd.mdd,
    mhd.pmdd_signup = mhd.pmdd,
    mhd.bipolar_disorder_signup = mhd.bipolar_disorder,
    mhd.gad_signup = mhd.gad,
    mhd.social_anxiety_signup = mhd.social_anxiety,
    mhd.specific_phobia_signup = mhd.specific_phobia,
    mhd.agoraphobia_signup = mhd.agoraphobia,
    mhd.panic_disorder_signup = mhd.panic_disorder,
    mhd.panic_attacks_signup = mhd.panic_attacks,
    mhd.ptsd_signup = mhd.ptsd,
    mhd.ocd_signup = mhd.ocd,
    mhd.bdd_signup = mhd.bdd,
    mhd.other_ocd_signup = mhd.other_ocd,
    mhd.anorexia_signup = mhd.an,
    mhd.atypical_anorexia_signup = mhd.atypical_an,
    mhd.bulimia_signup = mhd.bn,
    mhd.bed_signup = mhd.bed,
    mhd.schizophrenia_signup = mhd.schizophrenia,
    mhd.psychosis_signup = mhd.psychosis,
    mhd.personality_disorder_signup = mhd.personality_disorder,
    mhd.asd_signup = mhd.asd,
    mhd.addadhd_signup = mhd.addadhd,
    mhd.other_signup = mhd.other,
    mhd.perinatal_depression, #Not in glad coping mhd (so don't need to make signup copy)
    mhd.schizoaffective_disorder = mhd.schizoaffective, #Not in glad coping mhd (so don't need to make signup copy)
    mhd.none_of_the_above.1 = mhd.none_of_the_above,
    mhd.none_of_the_above.2 = mhd.none_of_the_above.1
    ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
# Inspect dimensions
dim(glad.mhd.raw.id)
# Inspect colnames
colnames(glad.mhd.raw.id)
#Differences
dim(glad.mhd.raw)[1]-dim(glad.mhd.raw.id)[1]
}

```

```{r glad mhd copy}
if(GLAD == TRUE) {
  mhd.raw.id <- glad.mhd.raw.id
}
```

## GLAD
```{r glad mhd cols}
if(GLAD == TRUE) {
glad.coping.mhd.raw <- readRDS(file = "../data_raw/glad/mhd_coping_glad.rds")
dim(glad.coping.mhd.raw)
colnames(glad.coping.mhd.raw)
}

```

```{r GLAD mhd cleaning}
if(GLAD == TRUE) {
glad.coping.mhd.raw.id <- glad.coping.mhd.raw  %>%
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
 # mutate(ID = as.numeric(ID)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
    ID = externalDataReference, # ID
    cohort_name, # Sample
    #startDate_baseline = startDate,
    mhd.depression_coping = mhd.depression,
    mhd.pregnancy_depression = mhd.postnatal_depression, #Only perinatal depression in glad signup so don't need to make coping copy
    mhd.pmdd_coping = mhd.pmdd,
    mhd.bdd_coping = mhd.bdd,
    mhd.ptsd_coping = mhd.ptsd,
    mhd.psychosis_coping = mhd.psychosis_type_psychotic_illness,
    mhd.personality_disorder_coping = mhd.personality_disorder,
    mhd.asd_coping = mhd.autism_spectrum_disorder_asd,
    mhd.addadhd_coping = mhd.attention_deficit_hyperactivity_disorder,
    mhd.other_coping = mhd.other,
    mhd.bipolar_disorder_coping = mhd.mania_hypomania_bipolar_or_manicdepression, 
    mhd.gad_coping = mhd.anxiety_nerves_or_generalised_anxiety_disorder,
    mhd.social_anxiety_coping = mhd.social_anxiety_or_social_phobia,
    mhd.specific_phobia_coping = mhd.specific_phobia,
    mhd.agoraphobia_coping = mhd.agoraphobia,
    mhd.panic_disorder_coping = mhd.panic_disorder,
    mhd.panic_attacks_coping = mhd.panic_attacks,
    mhd.schizophrenia_coping = mhd.schizophrenia,
    mhd.ocd_coping = mhd.obsessivecompulsive_disorder_ocd,
    mhd.other_ocd_coping = mhd.other_ocd,
    mhd.anorexia_coping = mhd.anorexia_nervosa,
    mhd.atypical_anorexia_coping = mhd.atypical_anorexia_nervosa,
    mhd.bulimia_coping = mhd.bulimia_nervosa,
    mhd.atypical_bulimia_nervosa_unc = mhd.atypical_bulimia_nervosa, #Not in glad signup so don't need to make coping copy
    mhd.bed_coping = mhd.bingeeating_disorder,
    mhd.atypical_bingeeating_disorder_unc = mhd.atypical_bingeeating_disorder, #Not in glad signup so don't need to make coping copy
    mhd.purging_disorder_unc = mhd.purging_disorder, #Not in glad signup so don't need to make coping copy
    mhd.night_eating_syndrome_unc = mhd.night_eating_syndrome, #Not in glad signup so don't need to make coping copy
    mhd.pica_unc = mhd.pica, #Not in glad signup so don't need to make coping copy
    mhd.avoidantrestrictive_food_intake_disorder_unc = mhd.avoidantrestrictive_food_intake_disorder, #Not in glad signup so don't need to make coping copy
    mhd.rumination_disorder_unc = mhd.rumination_disorder,  #Not in glad signup so don't need to make coping copy
    mhd.feeding_eating_disorder_unc = mhd.feeding_eating_disorder, #Not in glad signup so don't need to make coping copy
    mhd.other_eating_disorder_unc = mhd.other_eating_disorder, #Not in glad signup so don't need to make coping copy
    mhd.none_of_the_above_eating_disorder_unc = mhd.none, 
    mhd.dont_know_eating_disorder_unc = mhd.dont_know,
    mhd.prefer_not_to_answer_eating_disorder_unc = mhd.prefer_not_to_answer,
    mhd.none_of_the_above.3 = mhd.none_of_the_above,
    mhd.none_of_the_above.4 = mhd.none_of_the_above.1,
    mhd.suspected_eating_disorder_diagnosed
    ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
# Inspect dimensions
dim(glad.coping.mhd.raw.id)
# Inspect colnames
colnames(glad.coping.mhd.raw.id)
#Differences
dim(glad.coping.mhd.raw)[1]-dim(glad.coping.mhd.raw.id)[1]
}


```

```{r GLAD combine mhd copy}
if(GLAD == TRUE){
mhd.raw.id <- left_join(
  x = glad.coping.mhd.raw.id,
  y = glad.mhd.raw.id,
  by = c("ID", "cohort_name")
  )
# Inspect dimensions
dim(mhd.raw.id)
# Inspect colnames
colnames(mhd.raw.id)

}

```

##GLAD + COPING, recoding
For some disorders, participants are asked both in GLAD and COPING whether or not they have a mental heatlh diagnosis. The code below captures anyone who endorsed a mental health disorder in at least one of these questions.
#Depression
```{r glad recoding mhd depression}
if(GLAD == TRUE){

  #Depression
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.depression_numeric =
      case_when(
        (mhd.depression_coping_numeric  == "1" & mhd.depression_signup_numeric == "1" ~ 1),
        (mhd.depression_coping_numeric  == "1" | mhd.depression_signup_numeric == "1" ~ 1),
        (mhd.depression_coping_numeric  == "0" & mhd.depression_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.depression =
      recode_factor(mhd.depression_numeric,
                    "0" = "Not Depression",
                    "1" = "Depression",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.depression,
       cumul = F)
}
```

#PMDD
```{r glad recoding mhd pmdd}
if(GLAD == TRUE){

  #Premenstrual dysphoric disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.premenstrual_dysphoric_disorder_pmdd_numeric =
      case_when(
        (mhd.pmdd_coping_numeric  == "1" & mhd.pmdd_signup_numeric == "1" ~ 1),
        (mhd.pmdd_coping_numeric  == "1" | mhd.pmdd_signup_numeric == "1" ~ 1),
        (mhd.pmdd_coping_numeric  == "0" & mhd.pmdd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.premenstrual_dysphoric_disorder_pmdd =
      recode_factor(mhd.premenstrual_dysphoric_disorder_pmdd_numeric,
                    "0" = "Not PMDD",
                    "1" = "PMDD",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.premenstrual_dysphoric_disorder_pmdd,
       cumul = F)

}
```

#BDD
```{r glad recoding mhd bdd}
if(GLAD == TRUE){

  #Body dysmorphic disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.body_dysmorphic_disorder_bdd_numeric =
      case_when(
        (mhd.bdd_coping_numeric  == "1" & mhd.bdd_signup_numeric == "1" ~ 1),
        (mhd.bdd_coping_numeric  == "1" | mhd.bdd_signup_numeric == "1" ~ 1),
        (mhd.bdd_coping_numeric  == "0" & mhd.bdd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.body_dysmorphic_disorder_bdd =
      recode_factor(mhd.body_dysmorphic_disorder_bdd_numeric,
                    "0" = "Not BDD",
                    "1" = "BDD",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.body_dysmorphic_disorder_bdd,
       cumul = F)

}
```
#BDD
```{r glad recoding mhd bdd}
if(GLAD == TRUE){

  #Body dysmorphic disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.body_dysmorphic_disorder_bdd_numeric =
      case_when(
        (mhd.bdd_coping_numeric  == "1" & mhd.bdd_signup_numeric == "1" ~ 1),
        (mhd.bdd_coping_numeric  == "1" | mhd.bdd_signup_numeric == "1" ~ 1),
        (mhd.bdd_coping_numeric  == "0" & mhd.bdd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.body_dysmorphic_disorder_bdd =
      recode_factor(mhd.body_dysmorphic_disorder_bdd_numeric,
                    "0" = "Not BDD",
                    "1" = "BDD",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.body_dysmorphic_disorder_bdd,
       cumul = F)

}
```
#PTSD
```{r glad recoding mhd ptsd}
if(GLAD == TRUE){

  #Post traumatic stress disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.posttraumatic_stress_disorder_ptsd_numeric =
      case_when(
        (mhd.ptsd_coping_numeric  == "1" & mhd.ptsd_signup_numeric == "1" ~ 1),
        (mhd.ptsd_coping_numeric  == "1" | mhd.ptsd_signup_numeric == "1" ~ 1),
        (mhd.ptsd_coping_numeric  == "0" & mhd.ptsd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.posttraumatic_stress_disorder_ptsd =
      recode_factor(mhd.posttraumatic_stress_disorder_ptsd_numeric,
                    "0" = "Not PTSD",
                    "1" = "PTSD",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.posttraumatic_stress_disorder_ptsd,
       cumul = F)

}
```   
    
#Psychosis
```{r glad recoding mhd psychosis}
if(GLAD == TRUE){

  #Psychotic type illness
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.type_psychosis_psychotic_illness_numeric =
      case_when(
        (mhd.psychosis_coping_numeric  == "1" & mhd.psychosis_signup_numeric == "1" ~ 1),
        (mhd.psychosis_coping_numeric  == "1" | mhd.psychosis_signup_numeric == "1" ~ 1),
        (mhd.psychosis_coping_numeric  == "0" & mhd.psychosis_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.type_psychosis_psychotic_illness =
      recode_factor(mhd.type_psychosis_psychotic_illness_numeric,
                    "0" = "Any other type of psychosis or psychotic illness",
                    "1" = "Not Any other type of psychosis or psychotic illness",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.type_psychosis_psychotic_illness,
       cumul = F)

}
```   

#Personality disorder
```{r glad recoding mhd personality disorder}
if(GLAD == TRUE){

  #Personality disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.personality_disorder_numeric =
      case_when(
        (mhd.personality_disorder_coping_numeric  == "1" & mhd.personality_disorder_signup_numeric == "1" ~ 1),
        (mhd.personality_disorder_coping_numeric  == "1" | mhd.personality_disorder_signup_numeric == "1" ~ 1),
        (mhd.personality_disorder_coping_numeric  == "0" & mhd.personality_disorder_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.personality_disorder =
      recode_factor(mhd.personality_disorder_numeric,
                    "0" = "Not Personality disorder",
                    "1" = "Personality disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.personality_disorder,
       cumul = F)

}
```   
#Autism spectrum disorder
```{r glad recoding mhd asd}
if(GLAD == TRUE){

  #Autism spectrum disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric =
      case_when(
        (mhd.asd_coping_numeric  == "1" & mhd.asd_signup_numeric == "1" ~ 1),
        (mhd.asd_coping_numeric  == "1" | mhd.asd_signup_numeric == "1" ~ 1),
        (mhd.asd_coping_numeric  == "0" & mhd.asd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.autism_aspergers_or_autistic_spectrum_disorder =
      recode_factor(mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric,
                    "0" = "Not Autism spectrum disorder",
                    "1" = "Autism spectrum disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.autism_aspergers_or_autistic_spectrum_disorder,
       cumul = F)

}
```   
#Attention deficit hyperactivity disorder
```{r glad recoding mhd adhd}
if(GLAD == TRUE){

  #ADHD
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.attention_deficit_hyperactivity_disorder_numeric =
      case_when(
        (mhd.addadhd_coping_numeric  == "1" & mhd.addadhd_signup_numeric == "1" ~ 1),
        (mhd.addadhd_coping_numeric  == "1" | mhd.addadhd_signup_numeric == "1" ~ 1),
        (mhd.addadhd_coping_numeric  == "0" & mhd.addadhd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.attention_deficit_hyperactivity_disorder =
      recode_factor(mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric,
                    "0" = "Not Attention deficit hyperactivity disorder",
                    "1" = "Attention deficit hyperactivity disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.attention_deficit_hyperactivity_disorder,
       cumul = F)

}
```   
#Attention deficit hyperactivity disorder
```{r glad recoding mhd adhd}
if(GLAD == TRUE){

  #ADHD
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.attention_deficit_hyperactivity_disorder_numeric =
      case_when(
        (mhd.addadhd_coping_numeric  == "1" & mhd.addadhd_signup_numeric == "1" ~ 1),
        (mhd.addadhd_coping_numeric  == "1" | mhd.addadhd_signup_numeric == "1" ~ 1),
        (mhd.addadhd_coping_numeric  == "0" & mhd.addadhd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.attention_deficit_hyperactivity_disorder =
      recode_factor(mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric,
                    "0" = "Not Attention deficit hyperactivity disorder",
                    "1" = "Attention deficit hyperactivity disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.attention_deficit_hyperactivity_disorder,
       cumul = F)

}
```   

#Other mental health or neurodevelopmental disorder
```{r glad recoding mhd other}
if(GLAD == TRUE){

  #Other
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.other_please_tell_us_more_numeric =
      case_when(
        (mhd.other_coping_numeric  == "1" & mhd.other_signup_numeric == "1" ~ 1),
        (mhd.other_coping_numeric  == "1" | mhd.other_signup_numeric == "1" ~ 1),
        (mhd.other_coping_numeric  == "0" & mhd.other_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.other_please_tell_us_more =
      recode_factor(mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric,
                    "0" = "Not Other mental health or neurodevelopmental disorder",
                    "1" = "Other mental health or neurodevelopmental disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.other_please_tell_us_more,
       cumul = F)

}
```   
#Mania, hypomania, bipolar or manic-depression
```{r glad recoding mhd mania, hypomania, bipolar or manic-depression}
if(GLAD == TRUE){

  #Bipolar disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric =
      case_when(
        (mhd.bipolar_disorder_coping_numeric  == "1" & mhd.bipolar_disorder_signup_numeric == "1" ~ 1),
        (mhd.bipolar_disorder_coping_numeric  == "1" | mhd.bipolar_disorder_signup_numeric == "1" ~ 1),
        (mhd.bipolar_disorder_coping_numeric  == "0" & mhd.bipolar_disorder_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.mania_hypomania_bipolar_or_manicdepression =
      recode_factor(mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
                    "0" = "Not Mania, hypomania, bipolar or manic-depression",
                    "1" = "Mania, hypomania, bipolar or manic-depression",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.mania_hypomania_bipolar_or_manicdepression,
       cumul = F)

}
```   

#Anxiety, nerves or generalised anxiety disorder
```{r glad recoding mhd Anxiety, nerves or generalised anxiety disorder}
if(GLAD == TRUE){

  #Anxiety, nerves or generalised anxiety disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.anxiety_nerves_or_generalised_anxiety_disorder_numeric =
      case_when(
        (mhd.gad_coping_numeric  == "1" & mhd.gad_signup_numeric == "1" ~ 1),
        (mhd.gad_coping_numeric  == "1" | mhd.gad_signup_numeric == "1" ~ 1),
        (mhd.gad_coping_numeric  == "0" & mhd.gad_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.anxiety_nerves_or_generalised_anxiety_disorder =
      recode_factor(mhd.anxiety_nerves_or_generalised_anxiety_disorder_numeric,
                    "0" = "Not Anxiety, nerves or generalised anxiety disorder",
                    "1" = "Anxiety, nerves or generalised anxiety disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.anxiety_nerves_or_generalised_anxiety_disorder,
       cumul = F)

}
``` 
#Social anxiety or social phobia
```{r glad recoding mhd Social anxiety}
if(GLAD == TRUE){

  #Social anxiety
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.social_anxiety_or_social_phobia_numeric =
      case_when(
        (mhd.social_anxiety_coping_numeric  == "1" & mhd.social_anxiety_signup_numeric == "1" ~ 1),
        (mhd.social_anxiety_coping_numeric  == "1" | mhd.social_anxiety_signup_numeric == "1" ~ 1),
        (mhd.social_anxiety_coping_numeric  == "0" & mhd.social_anxiety_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.social_anxiety_or_social_phobia =
      recode_factor(mhd.social_anxiety_or_social_phobia_numeric,
                    "0" = "Not Social anxiety or social phobia",
                    "1" = "Social anxiety or social phobia",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.social_anxiety_or_social_phobia,
       cumul = F)

}
``` 
#Specific phobia
```{r glad recoding mhd specific phobia}
if(GLAD == TRUE){

  #Social anxiety
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.specific_phobia_e.g._phobia_of_flying_numeric =
      case_when(
        (mhd.specific_phobia_coping_numeric  == "1" & mhd.specific_phobia_signup_numeric == "1" ~ 1),
        (mhd.specific_phobia_coping_numeric  == "1" | mhd.specific_phobia_signup_numeric == "1" ~ 1),
        (mhd.specific_phobia_coping_numeric  == "0" & mhd.specific_phobia_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.specific_phobia_e.g._phobia_of_flying =
      recode_factor(mhd.specific_phobia_e.g._phobia_of_flying_numeric,
                    "0" = "Not Specific phobia",
                    "1" = "Specific phobia",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.specific_phobia_e.g._phobia_of_flying,
       cumul = F)

}
``` 
#Agoraphobia
```{r glad recoding mhd agoraphobia}
if(GLAD == TRUE){

  #Agoraphobia
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.agoraphobia_numeric =
      case_when(
        (mhd.agoraphobia_coping_numeric  == "1" & mhd.agoraphobia_signup_numeric == "1" ~ 1),
        (mhd.agoraphobia_coping_numeric  == "1" | mhd.agoraphobia_signup_numeric == "1" ~ 1),
        (mhd.agoraphobia_coping_numeric  == "0" & mhd.agoraphobia_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.agoraphobia =
      recode_factor(mhd.agoraphobia_numeric,
                    "0" = "Not Agoraphobia",
                    "1" = "Agoraphobia",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.agoraphobia,
       cumul = F)

}
``` 
#Panic disorder
```{r glad recoding mhd panic disorder}
if(GLAD == TRUE){

  #Panic disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.panic_disorder_numeric =
      case_when(
        (mhd.panic_disorder_coping_numeric  == "1" & mhd.panic_disorder_signup_numeric == "1" ~ 1),
        (mhd.panic_disorder_coping_numeric  == "1" | mhd.panic_disorder_signup_numeric == "1" ~ 1),
        (mhd.panic_disorder_coping_numeric  == "0" & mhd.panic_disorder_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.panic_disorder =
      recode_factor(mhd.panic_disorder_numeric,
                    "0" = "Not Panic disorder",
                    "1" = "Panic disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.panic_disorder,
       cumul = F)

}
``` 
#Panic attacks
```{r glad recoding mhd panic attacks}
if(GLAD == TRUE){

  #Panic attacks
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.panic_attacks_numeric =
      case_when(
        (mhd.panic_attacks_coping_numeric  == "1" & mhd.panic_attacks_signup_numeric == "1" ~ 1),
        (mhd.panic_attacks_coping_numeric  == "1" | mhd.panic_attacks_signup_numeric == "1" ~ 1),
        (mhd.panic_attacks_coping_numeric  == "0" & mhd.panic_attacks_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.panic_attacks =
      recode_factor(mhd.panic_attacks_numeric,
                    "0" = "Not Panic attacks",
                    "1" = "Panic attacks",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.panic_attacks,
       cumul = F)

}
``` 
#Schizophrenia
```{r glad recoding mhd schizophrenia}
if(GLAD == TRUE){

  #Panic attacks
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.schizophrenia_numeric =
      case_when(
        (mhd.schizophrenia_coping_numeric  == "1" & mhd.schizophrenia_signup_numeric == "1" ~ 1),
        (mhd.schizophrenia_coping_numeric  == "1" | mhd.schizophrenia_signup_numeric == "1" ~ 1),
        (mhd.schizophrenia_coping_numeric  == "0" & mhd.schizophrenia_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.schizophrenia =
      recode_factor(mhd.schizophrenia_numeric,
                    "0" = "Not Schizophrenia",
                    "1" = "Schizophrenia",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.schizophrenia,
       cumul = F)

}
``` 
#Obsessive-compulsive disorder
```{r glad recoding mhd ocd}
if(GLAD == TRUE){

  #OCD
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.obsessivecompulsive_disorder_ocd_numeric =
      case_when(
        (mhd.ocd_coping_numeric  == "1" & mhd.ocd_signup_numeric == "1" ~ 1),
        (mhd.ocd_coping_numeric  == "1" | mhd.ocd_signup_numeric == "1" ~ 1),
        (mhd.ocd_coping_numeric  == "0" & mhd.ocd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.obsessivecompulsive_disorder_ocd =
      recode_factor(mhd.obsessivecompulsive_disorder_ocd_numeric,
                    "0" = "Not OCD",
                    "1" = "OCD",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.obsessivecompulsive_disorder_ocd,
       cumul = F)

}
``` 


#Other related obsessive-compulsive disorders
```{r glad recoding mhd other ocd}
if(GLAD == TRUE){

  #Other OCD
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.obsessive_compulsive_related_disorders_numeric =
      case_when(
        (mhd.other_ocd_coping_numeric  == "1" & mhd.other_ocd_signup_numeric == "1" ~ 1),
        (mhd.other_ocd_coping_numeric  == "1" | mhd.other_ocd_signup_numeric == "1" ~ 1),
        (mhd.other_ocd_coping_numeric  == "0" & mhd.other_ocd_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.obsessive_compulsive_related_disorders =
      recode_factor(mhd.obsessive_compulsive_related_disorders_numeric,
                    "0" = "Not Other OCD",
                    "1" = "Other OCD",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.obsessive_compulsive_related_disorders,
       cumul = F)

}
``` 
#Anorexia nervosa
```{r glad recoding mhd other anorexia}
if(GLAD == TRUE){

  #Anorexia nervosa
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.anorexia_nervosa_unc_numeric =
      case_when(
        (mhd.anorexia_coping_numeric  == "1" & mhd.anorexia_signup_numeric == "1" ~ 1),
        (mhd.anorexia_coping_numeric  == "1" | mhd.anorexia_signup_numeric == "1" ~ 1),
        (mhd.anorexia_coping_numeric  == "0" & mhd.anorexia_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.anorexia_nervosa_unc =
      recode_factor(mhd.anorexia_nervosa_unc_numeric,
                    "0" = "Not Anorexia nervosa",
                    "1" = "Anorexia nervosa",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.anorexia_nervosa_unc,
       cumul = F)

}
``` 
#Atypical anorexia nervosa
```{r glad recoding mhd other atypical anorexia}
if(GLAD == TRUE){

  #Atypical anorexia nervosa
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.atypical_anorexia_nervosa_unc_numeric =
      case_when(
        (mhd.atypical_anorexia_coping_numeric  == "1" & mhd.atypical_anorexia_signup_numeric == "1" ~ 1),
        (mhd.atypical_anorexia_coping_numeric  == "1" | mhd.atypical_anorexia_signup_numeric == "1" ~ 1),
        (mhd.atypical_anorexia_coping_numeric  == "0" & mhd.atypical_anorexia_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.atypical_anorexia_nervosa_unc =
      recode_factor(mhd.atypical_anorexia_nervosa_unc_numeric,
                    "0" = "Not Atypical anorexia nervosa",
                    "1" = "Atypical anorexia nervosa",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.atypical_anorexia_nervosa_unc,
       cumul = F)

}
```   
#Bulimia nervosa
```{r glad recoding mhd other bulimia nervosa}
if(GLAD == TRUE){

  #Bulimia nervosa
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.bulimia_nervosa_unc_numeric =
      case_when(
        (mhd.bulimia_coping_numeric  == "1" & mhd.bulimia_signup_numeric == "1" ~ 1),
        (mhd.bulimia_coping_numeric  == "1" | mhd.bulimia_signup_numeric == "1" ~ 1),
        (mhd.bulimia_coping_numeric  == "0" & mhd.bulimia_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.bulimia_nervosa_unc =
      recode_factor(mhd.bulimia_nervosa_unc_numeric,
                    "0" = "Not Bulimia nervosa",
                    "1" = "Bulimia nervosa",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.bulimia_nervosa_unc,
       cumul = F)

}
```   
#Binge-eating disorder
```{r glad recoding mhd other bed}
if(GLAD == TRUE){

  #Binge-eating disorder
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.bingeeating_disorder_unc_numeric =
      case_when(
        (mhd.bed_coping_numeric  == "1" & mhd.bed_signup_numeric == "1" ~ 1),
        (mhd.bed_coping_numeric  == "1" | mhd.bed_signup_numeric == "1" ~ 1),
        (mhd.bed_coping_numeric  == "0" & mhd.bed_signup_numeric == "0" ~ 0)
      ))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.bingeeating_disorder_unc =
      recode_factor(mhd.bingeeating_disorder_unc_numeric,
                    "0" = "Not Binge-eating disorder",
                    "1" = "Binge-eating disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(mhd.bingeeating_disorder_unc,
       cumul = F)

}
```      

## EDGI
```{r EDGI mhd cols}
if(EDGI == TRUE) {
edgi.mhd.raw <- readRDS(file = "../data_raw/edgi/mhd_edgi.rds")
dim(edgi.mhd.raw)
colnames(edgi.mhd.raw)
}


```

```{r EDGI mhd cleaning}
if(EDGI == TRUE) {
edgi.mhd.raw.id <- edgi.mhd.raw %>%
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
 # mutate(ID = as.numeric(ID)) %>%
  add_column(cohort_name = "edgi", .before = "startDate") %>% #create new column 
  select(
    ID = externalDataReference, # ID
    cohort_name, # Sample
    #startDate_prepandemic = startDate,
    mhd.anorexia_nervosa_unc = mhd.anorexia_nervosa,
    mhd.atypical_anorexia_nervosa_unc = mhd.atypical_anorexia_nervosa,
    mhd.bulimia_nervosa_unc = mhd.bulimia_nervosa,
    mhd.atypical_bulimia_nervosa_unc = mhd.atypical_bulimia_nervosa,
    mhd.bingeeating_disorder_unc = mhd.bingeeating_disorder,
    mhd.atypical_bingeeating_disorder_unc = mhd.atypical_bingeeating_disorder,
    mhd.purging_disorder_unc = mhd.purging_disorder,
    mhd.night_eating_syndrome_unc = mhd.night_eating_syndrome,
    mhd.pica_unc = mhd.pica,
    mhd.avoidantrestrictive_food_intake_disorder_unc = mhd.avoidantrestrictive_food_intake_disorder,
    mhd.rumination_disorder_unc = mhd.rumination_disorder,
    mhd.feeding_eating_disorder_unc = mhd.feeding_eating_disorder,
    mhd.other_eating_disorder_unc = mhd.other_eating_disorder,
    mhd.none_of_the_above_eating_disorder_unc = mhd.none,
    mhd.dont_know_eating_disorder_unc = mhd.dont_know,
    mhd.prefer_not_to_answer_eating_disorder_unc = mhd.prefer_not_to_answer,
    mhd.suspected_eating_disorder_diagnosed = an.1.diagnosed_suspected_eating_disorder
    ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
# Inspect dimensions
dim(edgi.mhd.raw.id)
# Inspect colnames
colnames(edgi.mhd.raw.id)
#Differences
dim(edgi.mhd.raw.id)[1]-dim(edgi.mhd.raw.id)[1]
}


```
```{r EDGI mhd copy}
if(EDGI == TRUE) {
  mhd.raw.id <- edgi.mhd.raw.id
}
```

```{r edgi mhd2 cols}
if(EDGI == TRUE) {
edgi.mhd2.raw <- readRDS(file = "../data_raw/edgi/demographics_edgi.rds")
dim(edgi.mhd2.raw)
colnames(edgi.mhd2.raw)
}

```


```{r edgi mhd2 cleaning}
if(EDGI == TRUE){
  exclude_cols_mhd2 <- c("ID",
                        "cohort_name",
                        "startDate.prepandemic",
                        "age_unc",
                        "EduYrs")
  
  edgi.mhd2.raw.id <- edgi.mhd2.raw %>%
    drop_na(externalDataReference) %>% # Drop NAs
    distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
    #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
    #mutate(ID = as.numeric(ID)) %>%
     add_column(cohort_name = "edgi", .before = "startDate") %>% #create new column 
  select(
    ID = externalDataReference, # ID
    cohort_name, # Sample
    #startDate_prepandemic = startDate,
    mhd.depression = demographics.depression,
    mhd.pregnancy_depression = demographics.postnatalantenatal_depression,
    mhd.premenstrual_dysphoric_disorder_pmdd = demographics.pmdd,
    mhd.anxiety_nerves_or_generalised_anxiety_disorder = demographics.anxiety_nerves_or_generalised_anxiety_disorder,
    mhd.social_anxiety_or_social_phobia = demographics.social_anxiety_or_social_phobia,
    mhd.specific_phobia_e.g._phobia_of_flying = demographics.specific_phobia, # fear instead of phobia
    mhd.agoraphobia = demographics.agoraphobia,
    mhd.panic_disorder = demographics.panic_disorder,
    mhd.panic_attacks = demographics.panic_attacks,
    mhd.ptsd = demographics.ptsd,
    mhd.obsessivecompulsive_disorder_ocd = demographics.obsessivecompulsive_disorder_ocd,
    mhd.obsessive_compulsive_related_disorders = demographics.other_ocd,
    mhd.body_dysmorphic_disorder_bdd = demographics.bdd,
    mhd.mania_hypomania_bipolar_or_manicdepression = demographics.mania_hypomania_bipolar_or_manicdepression,
    mhd.schizophrenia = demographics.schizophrenia,
    mhd.type_psychosis_psychotic_illness = demographics.psychosis_type_psychotic_illness, # word type psychosis changed order compared to GLAD
    mhd.personality_disorder_diagnosed = demographics.diagnosed_personality_disorder, # named differently in EDGI
    mhd.posttraumatic_stress_disorder_ptsd = demographics.ptsd,
    mhd.autism_aspergers_or_autistic_spectrum_disorder = demographics.autism_spectrum_disorder_asd, # different name in EDGI
    mhd.personality_disorder = demographics.personality_disorder, # routing variable in EDGI is named differently; renamed here to match GLAD
    mhd.attention_deficit_hyperactivity_disorder = demographics.attention_deficit_hyperactivity_disorder,
    mhd.none_of_the_above.1 = demographics.none_of_the_above.1,
    mhd.dont_know = demographics.dont_know,
    mhd.prefer_not_to_answer = demographics.prefer_not_to_answer.1,
    mhd.none_of_the_above.2 = demographics.none_of_the_above.2,
    mhd.dont_know.1 = demographics.dont_know.7,
    mhd.prefer_not_to_answer.1 = demographics.prefer_not_to_answer.4,
    mhd.other_please_tell_us_more = demographics.other.2
    ) %>%
    add_column(
      mhd.schizoaffective_disorder = NA_character_
    ) %>%
    add_numeric(., exclude = exclude_cols_mhd2) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(edgi.mhd2.raw.id)
  # Inspect colnames
  colnames(edgi.mhd2.raw.id)
  #Differences
  dim(edgi.mhd2.raw)[1]-dim(edgi.mhd2.raw.id)[1]
}

```
```{r edgi combine mhd copy}
if(EDGI == TRUE){
mhd.raw.id <- left_join(
  x = edgi.mhd.raw.id,
  y = edgi.mhd2.raw.id,
  by = c("cohort_name", "ID")
  )
# Inspect dimensions
dim(mhd.raw.id)
# Inspect colnames
colnames(mhd.raw.id) 
}
```

## NBR
```{r nbr mhd cols}
if(NBR == TRUE) {
nbr.mhd.raw <- readRDS(file = "../data_raw/nbr/mhd_coping_nbr.rds")
dim(nbr.mhd.raw)
colnames(nbr.mhd.raw)
}

```

```{r nbr mhd cleaning}
if(NBR == TRUE) {
exclude_cols <- c("cohort_name",
                  "ID")
nbr.mhd.raw.id <- nbr.mhd.raw %>%
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(subjectid, into = c("Sample", "ID.intm"), sep = 6) %>% # Split ID in Sample and Number
  #separate(ID.intm, into = "ID", sep = 7) %>%
  add_column(cohort_name = "coping_nbr", .before = "startDate") %>% #create new column 
  select(
    ID = externalDataReference, # ID
    cohort_name, # Sample
    #startDate_baseline = startDate,
    starts_with("mhd."),
    mhd.suspected_eating_disorder_diagnosed = mhd.suspected_eating_disorder_diagnosed,
    mhd.pregnancy_depression = mhd.postnatal_depression,
    mhd.posttraumatic_stress_disorder_ptsd_numeric = mhd.ptsd,
    mhd.specific_phobia_e.g._phobia_of_flying = mhd.specific_phobia,
    mhd.premenstrual_dysphoric_disorder_pmdd = mhd.pmdd,
    mhd.body_dysmorphic_disorder_bdd = mhd.bdd,
    mhd.obsessive_compulsive_related_disorders = mhd.other_ocd,
    mhd.purging_disorder_unc = mhd.purging_disorder,
    mhd.night_eating_syndrome_unc = mhd.night_eating_syndrome,
    mhd.pica_unc = mhd.pica,
    mhd.avoidantrestrictive_food_intake_disorder_unc = mhd.avoidantrestrictive_food_intake_disorder,
    mhd.rumination_disorder_unc = mhd.rumination_disorder,
    mhd.feeding_eating_disorder_unc = mhd.feeding_eating_disorder,
    mhd.other_eating_disorder_unc = mhd.other_eating_disorder,
    mhd.type_psychosis_psychotic_illness = mhd.psychosis_type_psychotic_illness,
    mhd.autism_aspergers_or_autistic_spectrum_disorder = mhd.autism_spectrum_disorder_asd,
    mhd.other_please_tell_us_more = mhd.other,
    mhd.anorexia_nervosa_unc = mhd.anorexia_nervosa,
    mhd.atypical_anorexia_nervosa_unc = mhd.atypical_anorexia_nervosa,
    mhd.atypical_bulimia_nervosa_unc = mhd.atypical_bulimia_nervosa,
    mhd.atypical_bingeeating_disorder_unc = mhd.atypical_bingeeating_disorder,
    mhd.bulimia_nervosa_unc = mhd.bulimia_nervosa,
    mhd.bingeeating_disorder_unc = mhd.bingeeating_disorder,
    mhd.other_eating_disorder_unc = mhd.other_eating_disorder,
    mhd.none_of_the_above_eating_disorder_unc = mhd.none,
    mhd.dont_know_eating_disorder_unc = mhd.dont_know.2,
    mhd.prefer_not_to_answer_eating_disorder_unc = mhd.prefer_not_to_answer.2,
    mhd.none_of_the_above.1 = mhd.none_of_the_above,
    mhd.none_of_the_above.2 = mhd.none_of_the_above.1
  ) %>%
  add_column(
    mhd.schizoaffective_disorder = NA #NBR doesn't ask about schizoaffective disorder. This means the column das not exist in the data set
  ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
# Inspect dimensions
dim(nbr.mhd.raw.id)
# Inspect colnames
colnames(nbr.mhd.raw.id)
#Differences
dim(nbr.mhd.raw)[1]-dim(nbr.mhd.raw.id)[1]
}

```

```{r nbr mhd copy}
if(NBR == TRUE) {
  mhd.raw.id <- nbr.mhd.raw.id
}
```

## RAMP
```{r ramp mhd cols}
if(RAMP == TRUE) {
ramp.mhd.raw <- readRDS(file = "../data_raw/ramp/health_mhq_ramp.rds")
dim(ramp.mhd.raw)
colnames(ramp.mhd.raw)
}
```


```{r ramp mhd cleaning}
if(RAMP == TRUE) {

exclude_cols <- c("cohort_name",
                  "ID")

ramp.mhd.raw.id <- ramp.mhd.raw %>%
  drop_na(`Login ID`) %>% # Drop NAs
  distinct(`Login ID`, .keep_all = TRUE) %>% # Remove duplicates based on ID
  separate(`Login ID`, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  separate(ID, into = "ID", sep = 7) %>%
  add_column(cohort_name = "ramp", .before = "startDate") %>% #create new column 
  select(
    ID = externalDataReference, # ID
    cohort_name, # Sample
    #startDate_baseline = startDate,
    mhd.depression = mhq.depression,
    mhd.pregnancy_depression = mhq.pregnancy_depression,
    mhd.premenstrual_dysphoric_disorder_pmdd = mhq.premenstrual_dysphoric_disorder_pmdd,
    mhd.mania_hypomania_bipolar_or_manicdepression = mhq.mania_hypomania_bipolar_or_manicdepression,
    mhd.anxiety_nerves_or_generalised_anxiety_disorder = mhq.anxiety_nerves_or_generalised_anxiety_disorder,
    mhd.social_anxiety_or_social_phobia = mhq.social_anxiety_or_social_phobia,
    mhd.specific_phobia_e.g._phobia_of_flying = mhq.specific_phobia_e.g._phobia_of_flying,
    mhd.agoraphobia = mhq.agoraphobia,
    mhd.panic_disorder = mhq.panic_disorder,
    mhd.panic_attacks = mhq.panic_attacks,
    mhd.posttraumatic_stress_disorder_ptsd = mhq.posttraumatic_stress_disorder_ptsd,
    mhd.obsessivecompulsive_disorder_ocd= mhq.obsessivecompulsive_disorder_ocd,
    mhd.body_dysmorphic_disorder_bdd = mhq.body_dysmorphic_disorder_bdd,
    mhd.obsessive_compulsive_related_disorders = mhq.skin_picking_obsessive_compulsive,
    mhd.anorexia_nervosa = mhq.anorexia_nervosa,
    mhd.atypical_anorexia_nervosa = mhq.atypical_anorexia_nervosa,
    mhd.bulimia_nervosa = mhq.bulimia_nervosa,
    mhd.bingeeating_disorder= mhq.psychological_overeating_or_bingeeating_disorder,
    mhd.schizophrenia = mhq.schizophrenia,
    mhd.schizoaffective_disorder = mhq.schizoaffective_disorder,
    mhd.type_psychosis_psychotic_illness = mhq.psychosis_type_psychotic_illness,
    mhd.personality_disorder = mhq.personality_disorder,
    mhd.autism_aspergers_or_autistic_spectrum_disorder = mhq.autism_aspergers_or_autistic_spectrum_disorder,
    mhd.attention_deficit_hyperactivity_disorder = mhq.attention_deficit_hyperactivity_disorder,
    mhd.personality_disorder_diagnosed = mhq.personality_disorder_diagnosed,
    mhd.none_of_the_above = mhq.none_of_these,
    mhd.dont_know = mhq.dont_know,
    mhd.prefer_not_to_answer = mhq.prefer_not_to_answer,
    mhd.none_of_the_above.1 = mhq.none_of_these.1,
    mhd.dont_know.1 = mhq.dont_know.1,
    mhd.prefer_not_to_answer.1 = mhq.prefer_not_to_answer.1,
    mhd.other_please_tell_us_more.1 = mhq.other_please_tell_us_more
  ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
# Inspect dimensions
dim(ramp.mhd.raw.id)
# Inspect colnames
colnames(ramp.mhd.raw.id)
#Differences
dim(ramp.mhd.raw)[1]-dim(ramp.mhd.raw.id)[1]
}
```
```{r ramp mhd copy}
if(RAMP == TRUE) {
  mhd.raw.id <- ramp.mhd.raw.id
      nrow(mhd.raw.id)
}
```

## Grouping mental health disorders
1. Depressive disorder group: major depression, antenatal/postnatal depression, premenstrual depression. The logic for this has been double checked for males - KT/MD.
2. Anxiety group: generalised anxiety, social anxiety, specific phobia, agoraphobia, panic_disorder, panic_attacks.
3. Agoraphobia and panic_disorder group: panic_disorder, agoraphobia, panic_attacks.
4. Eating disorders group: anorexianervosa, atypical anorexia nervosa, bulimia nervosa, overeating or bingeeating.
5. Obsessive complusive disorders: obsessive compulaive disorder, obsessive compulsive related disorders.
6. Psychotic disorders: schizophrenia, schizoaffective disorder, general psychosis or psychotic illness.
7. Personality disorders: cluster A, cluster B, cluster C
8. Control group: no diagnosed disorders.

### Depressive disorders
```{r mhd depressive_disorders}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    depressive_disorders_numeric =
      case_when(
        (mhd.depression_numeric == "0" &
        (mhd.pregnancy_depression_numeric == "0" | is.na(mhd.pregnancy_depression_numeric)) &
        (mhd.premenstrual_dysphoric_disorder_pmdd_numeric == "0" | is.na(mhd.premenstrual_dysphoric_disorder_pmdd_numeric))) ~ 0,
        mhd.depression_numeric == "1" ~ 1,
        mhd.pregnancy_depression_numeric == "1" ~ 1,
        mhd.premenstrual_dysphoric_disorder_pmdd_numeric == "1" ~ 1))
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    depressive_disorders =
      recode_factor(depressive_disorders_numeric,
                    "0" = "No depressive disorder",
                    "1" = "Depressive disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(depressive_disorders,
       cumul = F)

}
```

```{r Check depressive_disorders}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    depressive_disorders,
    depressive_disorders_numeric,
    mhd.depression_numeric,
    mhd.pregnancy_depression_numeric,
    mhd.premenstrual_dysphoric_disorder_pmdd_numeric,
    mhd.depression,
    mhd.pregnancy_depression,
    mhd.premenstrual_dysphoric_disorder_pmdd
  )
}
```
### Anxiety disorders
```{r mhd anxiety_disorders}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    anxiety_disorders_numeric =
      case_when(
        mhd.anxiety_nerves_or_generalised_anxiety_disorder_numeric == "1" ~ 1,
        mhd.social_anxiety_or_social_phobia_numeric == "1" ~ 1,
        mhd.specific_phobia_e.g._phobia_of_flying_numeric == "1" ~ 1,
        mhd.agoraphobia_numeric == "1" ~ 1,
        mhd.panic_disorder_numeric == "1" ~ 1,
        mhd.panic_attacks_numeric == "1" ~ 1,
        (mhd.anxiety_nerves_or_generalised_anxiety_disorder_numeric == "0" &
        mhd.social_anxiety_or_social_phobia_numeric == "0" &
        mhd.specific_phobia_e.g._phobia_of_flying_numeric == "0" &
        mhd.agoraphobia_numeric == "0" &
        mhd.panic_disorder_numeric == "0" &
        mhd.panic_attacks_numeric == "0") ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    anxiety_disorders =
      recode_factor(anxiety_disorders_numeric,
                    "0" = "No anxiety disorder",
                    "1" = "Anxiety disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(anxiety_disorders,
       cumul = F)
}
```

```{r Check anxiety_disorders}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    anxiety_disorders,
    anxiety_disorders_numeric,
    mhd.anxiety_nerves_or_generalised_anxiety_disorder_numeric,
    mhd.social_anxiety_or_social_phobia_numeric,
    mhd.specific_phobia_e.g._phobia_of_flying_numeric,
    mhd.agoraphobia_numeric,
    mhd.panic_disorder_numeric,
    mhd.panic_attacks_numeric,
    mhd.anxiety_nerves_or_generalised_anxiety_disorder,
    mhd.social_anxiety_or_social_phobia,
    mhd.specific_phobia_e.g._phobia_of_flying,
    mhd.agoraphobia,
    mhd.panic_disorder,
    mhd.panic_attacks
  )
}
```
Agoraphobia and panic disorder group
```{r mhd agoraphobia_panic_disorder}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    agoraphobia_panic_disorder_numeric =
      case_when(
        mhd.agoraphobia_numeric == "1" ~ 1,
        mhd.panic_disorder_numeric == "1" ~ 1,
        mhd.panic_attacks_numeric == "1" ~ 1,
        (mhd.agoraphobia_numeric == "0" &
        mhd.panic_disorder_numeric == "0" &
        mhd.panic_attacks_numeric == "0") ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    agoraphobia_panic_disorder =
      recode_factor(agoraphobia_panic_disorder_numeric,
                    "0" = "No agoraphobia/panic disorder",
                    "1" = "Agoraphobia/panic disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(agoraphobia_panic_disorder)
}
```

```{r Check agoraphobia_panic_disorder}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    agoraphobia_panic_disorder,
    agoraphobia_panic_disorder_numeric,
    mhd.agoraphobia_numeric,
    mhd.panic_disorder_numeric,
    mhd.panic_attacks_numeric,
    mhd.agoraphobia,
    mhd.panic_disorder,
    mhd.panic_attacks
  )
}

```
Depression and anxiety comorbidity
```{r mhd depression_anxiety}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    depression_and_anxiety_numeric =
      case_when(
        depressive_disorders_numeric == 0 &
          anxiety_disorders_numeric == 0 ~ 0,
        depressive_disorders_numeric == 1 &
          anxiety_disorders_numeric == 1 ~ 1,
        depressive_disorders_numeric == 1 &
          anxiety_disorders_numeric == 0 ~ 2,
        depressive_disorders_numeric == 0 &
          anxiety_disorders_numeric == 1 ~ 3
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    depression_and_anxiety =
      recode_factor(depression_and_anxiety_numeric,
                    "0" = "No depressive or anxiety disorder",
                    "1" = "Depressive and anxiety disorder",
                    "2" = "Only depressive disorder",
                    "3" = "Only anxiety disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(depression_and_anxiety,
       cumul = F)
}
```

### Eating disorders
There is routing questionnaire if participants have been diagnosed with an eating disorder and afterwards they get asked the specific disorders. Therefore, mhd.suspected_eating_disorder_diagnosed_numeric needs to be recoded as 0 otherwise they would be NAs.
```{r nbr cleaning eating disorders}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE) { 
#Recode as 0 if ppt responds no to screening question (mhd.suspected_eating_disorder_diagnosed_numeric)
  mhd.raw.id <- mhd.raw.id %>%
  mutate(
    mhd.anorexia_nervosa_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.anorexia_nervosa_unc_numeric == "0" ~ 0,
                mhd.anorexia_nervosa_unc_numeric == "1" ~ 1),
    mhd.atypical_anorexia_nervosa_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.atypical_anorexia_nervosa_unc_numeric == "0" ~ 0,
                mhd.atypical_anorexia_nervosa_unc_numeric == "1" ~ 1),
    mhd.bulimia_nervosa_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.bulimia_nervosa_unc_numeric == "0" ~ 0,
                mhd.bulimia_nervosa_unc_numeric == "1" ~ 1),
    mhd.atypical_bulimia_nervosa_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.atypical_bulimia_nervosa_unc_numeric == "0" ~ 0,
                mhd.atypical_bulimia_nervosa_unc_numeric == "1" ~ 1),
    mhd.bingeeating_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.bingeeating_disorder_unc_numeric == "0" ~ 0,
                mhd.bingeeating_disorder_unc_numeric == "1" ~ 1),
    mhd.atypical_bingeeating_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.atypical_bingeeating_disorder_unc_numeric == "0" ~ 0,
                mhd.atypical_bingeeating_disorder_unc_numeric == "1" ~ 1),
    mhd.purging_disorder_numeric =
          case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.purging_disorder_unc_numeric == "0" ~ 0,
                mhd.purging_disorder_unc_numeric == "1" ~ 1),
    mhd.night_eating_syndrome_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.night_eating_syndrome_unc_numeric == "0" ~ 0,
                mhd.night_eating_syndrome_unc_numeric == "1" ~ 1),
    mhd.pica_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.pica_unc_numeric == "0" ~ 0,
                mhd.pica_unc_numeric == "1" ~ 1),
    mhd.avoidantrestrictive_food_intake_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.avoidantrestrictive_food_intake_disorder_unc_numeric == "0" ~ 0,
                mhd.avoidantrestrictive_food_intake_disorder_unc_numeric == "1" ~ 1),
    mhd.rumination_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.rumination_disorder_unc_numeric == "0" ~ 0,
                mhd.rumination_disorder_unc_numeric == "1" ~ 1),
    mhd.feeding_eating_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.feeding_eating_disorder_unc_numeric == "0" ~ 0,
                mhd.feeding_eating_disorder_unc_numeric == "1" ~ 1), 
    mhd.none_of_the_above_eating_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.none_of_the_above_eating_disorder_unc_numeric == "0" ~ 0,
                mhd.none_of_the_above_eating_disorder_unc_numeric == "1" ~ 1),
    mhd.dont_know_eating_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.dont_know_eating_disorder_unc_numeric == "0" ~ 0,
                mhd.dont_know_eating_disorder_unc_numeric == "1" ~ 1),
    mhd.prefer_not_to_answer_eating_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.prefer_not_to_answer_eating_disorder_unc_numeric == "0" ~ 0,
                mhd.prefer_not_to_answer_eating_disorder_unc_numeric == "1" ~ 1),
    mhd.other_eating_disorder_numeric =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ 0,
                mhd.other_eating_disorder_unc_numeric == "0" ~ 0,
                mhd.other_eating_disorder_unc_numeric == "1" ~ 1),
    mhd.anorexia_nervosa =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Anorexia nervosa",
                mhd.anorexia_nervosa_unc_numeric == "0" ~ "Not Anorexia nervosa",
                mhd.anorexia_nervosa_unc_numeric == "1" ~ "Anorexia nervosa"),
    mhd.atypical_anorexia_nervosa =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Atypical anorexia nervosa",
                mhd.atypical_anorexia_nervosa_unc_numeric == "0" ~ "Not Atypical anorexia nervosa",
                mhd.atypical_anorexia_nervosa_unc_numeric == "1" ~ "Atypical anorexia nervosa"),
    mhd.bulimia_nervosa =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Bulimia nervosa",
                mhd.bulimia_nervosa_unc_numeric == "0" ~ "Not Bulimia nervosa",
                mhd.bulimia_nervosa_unc_numeric == "1" ~ "Bulimia nervosa"),
    mhd.atypical_bulimia_nervosa =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Atypical bulimia nervosa",
                mhd.atypical_bulimia_nervosa_unc_numeric == "0" ~ "Atypical bulimia nervosa",
                mhd.atypical_bulimia_nervosa_unc_numeric == "1" ~ "Atypical bulimia nervosa"),
    mhd.bingeeating_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Binge-eating disorder",
                mhd.bingeeating_disorder_unc_numeric == "0" ~ "Not Binge-eating disorder",
                mhd.bingeeating_disorder_unc_numeric == "1" ~ "Binge-eating disorder"),
    mhd.atypical_bingeeating_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Atypical binge-eating disorder",
                mhd.atypical_bingeeating_disorder_unc_numeric == "0" ~ "Not Atypical binge-eating disorder",
                mhd.atypical_bingeeating_disorder_unc_numeric == "1" ~ "Atypical binge-eating disorder"),
     mhd.purging_disorder =
          case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not purging disorder",
                mhd.purging_disorder_unc_numeric == "0" ~ "Not purging disorder",
                mhd.purging_disorder_unc_numeric == "1" ~ "Purging disorder"),
    mhd.night_eating_syndrome =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not night eating syndrome",
                mhd.night_eating_syndrome_unc_numeric == "0" ~ "Not night eating syndrome",
                mhd.night_eating_syndrome_unc_numeric == "1" ~ "Night eating syndrome"),
    mhd.pica =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not pica",
                mhd.pica_unc_numeric == "0" ~ "Not pica",
                mhd.pica_unc_numeric == "1" ~ "Pica"),
    mhd.avoidantrestrictive_food_intake_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not ARFID",
                mhd.avoidantrestrictive_food_intake_disorder_unc_numeric == "0" ~ "Not ARFID",
                mhd.avoidantrestrictive_food_intake_disorder_unc_numeric == "1" ~ "ARFID"),
    mhd.rumination_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not rumination disorder",
                mhd.rumination_disorder_unc_numeric == "0" ~ "Not rumination disorder",
                mhd.rumination_disorder_unc_numeric == "1" ~ "Rumination disorder"),
    mhd.feeding_eating_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not feeding disorder",
                mhd.feeding_eating_disorder_unc_numeric == "0" ~ "Not feeding disorder",
                mhd.feeding_eating_disorder_unc_numeric == "1" ~ "Feeding disorder"), 
    mhd.none_of_the_above_eating_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not None of the above",
                mhd.none_of_the_above_eating_disorder_unc == "0" ~ "Not None of the above",
                mhd.none_of_the_above_eating_disorder_unc == "1" ~ "None of the above"),
    mhd.dont_know_eating_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Don't know",
                mhd.dont_know_eating_disorder_numeric == "0" ~ "Not Don't know",
                mhd.dont_know_eating_disorder_numeric == "1" ~ "Don't know"),
    mhd.prefer_not_to_answer_eating_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Prefer not to answer",
                mhd.prefer_not_to_answer_eating_disorder_unc == "0" ~ "Not Prefer not to answer",
                mhd.prefer_not_to_answer_eating_disorder_unc == "1" ~ "Prefer not to answer"),
    mhd.other_eating_disorder =
      case_when(mhd.suspected_eating_disorder_diagnosed_numeric == "0" ~ "Not Other eating disorder:",
                mhd.other_eating_disorder_unc_numeric == "0" ~ "Not Other eating disorder:",
                mhd.other_eating_disorder_unc_numeric == "1" ~ "Other eating disorder:")
    )
}
```

###EDGI, GLAD, NBR eating disorders
```{r edgi mhd eating_disorders}
if(EDGI == TRUE | NBR == TRUE | GLAD == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    eating_disorders_numeric =
      case_when(
        mhd.anorexia_nervosa_numeric == "1" ~ 1,
        mhd.atypical_anorexia_nervosa_numeric == "1" ~ 1,
        mhd.bulimia_nervosa_numeric == "1" ~ 1,
        mhd.atypical_bulimia_nervosa_numeric == "1" ~ 1, # additional diagnosis in EDGI but not in GLAD
        mhd.bingeeating_disorder_numeric == "1" ~ 1,
        mhd.atypical_bingeeating_disorder_numeric == "1" ~ 1, # additional diagnosis in EDGI
        mhd.purging_disorder_numeric == "1" ~ 1,
        mhd.night_eating_syndrome_numeric  == "1" ~ 1,
        mhd.pica_numeric == "1" ~ 1,
        mhd.avoidantrestrictive_food_intake_disorder_numeric == "1" ~ 1,
        mhd.rumination_disorder_numeric == "1" ~ 1,
        mhd.feeding_eating_disorder_numeric == "1" ~ 1,
        mhd.other_eating_disorder_numeric == "1" ~ 1,
        (mhd.anorexia_nervosa_numeric == "0" &
        mhd.atypical_anorexia_nervosa_numeric == "0" &
        mhd.atypical_anorexia_nervosa_numeric == "0" &
        mhd.bulimia_nervosa_numeric == "0" &
        mhd.atypical_bulimia_nervosa_numeric == "0" &
        mhd.bingeeating_disorder_numeric == "0" &
        mhd.atypical_bingeeating_disorder_numeric == "0" &
        mhd.purging_disorder_numeric == "0" &
        mhd.night_eating_syndrome_numeric  == "0" &
        mhd.pica_numeric == "0" &
        mhd.avoidantrestrictive_food_intake_disorder_numeric == "0" &
        mhd.rumination_disorder_numeric == "0" &
        mhd.feeding_eating_disorder_numeric == "0" &
        mhd.other_eating_disorder_numeric == "0") ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    eating_disorders =
      recode_factor(eating_disorders_numeric,
                    "0" = "No eating disorder",
                    "1" = "Eating disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(eating_disorders,
       cumul = F)
}

```

###RAMP eating disorders
```{r ramp mhd eating_disorders}
if(RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    eating_disorders_numeric =
      case_when(
        mhd.anorexia_nervosa_numeric == "1" ~ 1,
        mhd.atypical_anorexia_nervosa_numeric == "1" ~ 1,
        mhd.bulimia_nervosa_numeric == "1" ~ 1,
        mhd.bingeeating_disorder_numeric == "1" ~ 1,
        (mhd.anorexia_nervosa_numeric == "0" &
        mhd.atypical_anorexia_nervosa_numeric == "0" &
        mhd.bulimia_nervosa_numeric == "0" &
        mhd.bingeeating_disorder_numeric == "0") ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    eating_disorders =
      recode_factor(eating_disorders_numeric,
                    "0" = "No eating disorder",
                    "1" = "Eating disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(eating_disorders,
       cumul = F)
}

```
### Obsessive compulsive disorders
```{r mhd obsessive_compulsive_disorders}
if(NBR == TRUE | RAMP == TRUE| EDGI == TRUE | GLAD == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    obsessive_compulsive_disorders_numeric =
      case_when(
        mhd.obsessivecompulsive_disorder_ocd_numeric == "1" ~ 1,
        mhd.obsessive_compulsive_related_disorders_numeric == "1" ~ 1,
        mhd.body_dysmorphic_disorder_bdd_numeric == "1" ~ 1,
        (mhd.obsessivecompulsive_disorder_ocd_numeric == "0" &
        mhd.obsessive_compulsive_related_disorders_numeric == "0" &
        mhd.body_dysmorphic_disorder_bdd_numeric == "0") ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    obsessive_compulsive_disorders =
      recode_factor(obsessive_compulsive_disorders_numeric,
                    "0" = "No obsessive compulsive disorder",
                    "1" = "Obsessive compulsive disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(obsessive_compulsive_disorders)
}
```


```{r Check obsessive_compulsive_disorders}
if(NBR == TRUE | RAMP == TRUE| EDGI == TRUE | GLAD == TRUE) {
mhd.raw.id %>%
  select(
    obsessive_compulsive_disorders,
    obsessive_compulsive_disorders_numeric,
    mhd.obsessivecompulsive_disorder_ocd,
    mhd.obsessivecompulsive_disorder_ocd_numeric,
    mhd.obsessive_compulsive_related_disorders,
    mhd.obsessive_compulsive_related_disorders_numeric,
    mhd.body_dysmorphic_disorder_bdd,
    mhd.body_dysmorphic_disorder_bdd_numeric
  )
}
```

### Psychotic disorders
```{r mhd psychotic_disorders}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    psychotic_disorders_numeric =
      case_when(
        mhd.schizophrenia_numeric == "1" ~ 1,
        mhd.schizoaffective_disorder_numeric == "1" ~ 1,
        mhd.type_psychosis_psychotic_illness_numeric == "1" ~ 1,
        (mhd.schizophrenia_numeric == "0" &
        (mhd.schizoaffective_disorder_numeric == "0" | is.na(mhd.schizoaffective_disorder_numeric == "0") & #NA included because some cohorts don't have schizoaffective disorder
        mhd.type_psychosis_psychotic_illness_numeric == "0") ~ 0)
        )
    )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    psychotic_disorders =
      recode_factor(psychotic_disorders_numeric,
                    "0" = "No psychotic disorder",
                    "1" = "Psychotic disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(psychotic_disorders)
}
```

# Overlap between self-report schizophrenia and bipolar disorder
```{r mhd bipolar_and_schizophrenia_numeric}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    bipolar_and_schizophrenia_numeric =
      case_when(
        psychotic_disorders_numeric == 0 &
          mhd.mania_hypomania_bipolar_or_manicdepression_numeric == 0 ~ 0,
        psychotic_disorders_numeric == 1 &
          mhd.mania_hypomania_bipolar_or_manicdepression_numeric == 1 ~ 1,
        psychotic_disorders_numeric == 1 &
          mhd.mania_hypomania_bipolar_or_manicdepression_numeric == 0 ~ 2,
        psychotic_disorders_numeric == 0 &
          mhd.mania_hypomania_bipolar_or_manicdepression_numeric == 1 ~ 3
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    bipolar_and_schizophrenia =
      recode_factor(bipolar_and_schizophrenia_numeric,
                    "0" = "No psychotic or bipolar disorder",
                    "1" = "Psychotic and bipolar disorder",
                    "2" = "Only psychotic disorder",
                    "3" = "Only bipolar disorder",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(bipolar_and_schizophrenia,
       cumul = F)
}
```

```{r Check psychotic_disorders}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    psychotic_disorders,
    psychotic_disorders_numeric,
    bipolar_and_schizophrenia,
    bipolar_and_schizophrenia_numeric,
    mhd.schizophrenia_numeric,
    mhd.schizoaffective_disorder_numeric,
    mhd.mania_hypomania_bipolar_or_manicdepression,
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
    mhd.type_psychosis_psychotic_illness_numeric,
    mhd.schizophrenia,
    mhd.schizoaffective_disorder,
    mhd.type_psychosis_psychotic_illness
  )
}
```

### Autism spectrum disorder
```{r mhd autism_spectrum_disorder}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE){
  mhd.raw.id <- mhd.raw.id %>%
    mutate(
      autism_spectrum_disorder_numeric =
        case_when(
          mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric == 0 ~ 0,
          mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric == 1 ~ 1
        )
    )
  mhd.raw.id <- mhd.raw.id %>%
    mutate(
      autism_spectrum_disorder =
        recode_factor(
          autism_spectrum_disorder_numeric,
          `0` = "No autism spectrum disorder",
          `1` = "Autism spectrum disorder"
        )
    )
  mhd.raw.id %>%
    freq(autism_spectrum_disorder)
}
```

```{r Check autism_spectrum_disorder}
if(GLAD == TRUE | EDGI == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    autism_spectrum_disorder,
    autism_spectrum_disorder_numeric,
    mhd.autism_aspergers_or_autistic_spectrum_disorder,
    mhd.autism_aspergers_or_autistic_spectrum_disorder_numeric
  ) %>%
    filter(autism_spectrum_disorder == "Autism spectrum disorder")
}
```
### Personality disorders
Cluster a
1. Paranoid                        
2. Schizoid                      
3. Schizotypal                      
```{r mhd personality_cluster_a}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE) {
  mhd.raw.id <- mhd.raw.id %>%
  mutate(
    personality_cluster_a_numeric =
      case_when(
        mhd.personality_disorder_diagnosed_numeric == "1" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "2" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "3" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "4" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "5" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "6" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "7" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "8" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "9" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "10" ~ 0,
        mhd.personality_disorder_numeric == "0" ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    personality_cluster_a =
      recode_factor(personality_cluster_a_numeric,
                    "0" = "No personality disorder cluster A",
                    "1" = "Personality disorder cluster A",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(personality_cluster_a,
       cumul = F)
}
```

```{r Check personality_cluster_a}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    personality_cluster_a,
    personality_cluster_a_numeric,
    mhd.personality_disorder_diagnosed,
    mhd.personality_disorder_diagnosed_numeric
  )
}
```

Cluster B
4. Antisocial                       
5. Borderline                     
6. Histrionic                        
7. Narcissistic                      

```{r mhd personality_cluster_b}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    personality_cluster_b_numeric =
      case_when(
        mhd.personality_disorder_diagnosed_numeric == "1" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "2" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "3" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "4" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "5" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "6" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "7" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "8" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "9" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "10" ~ 0,
        mhd.personality_disorder_numeric == "0" ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    personality_cluster_b =
      recode_factor(personality_cluster_b_numeric,
                    "0" = "No personality disorder cluster B",
                    "1" = "Personality disorder cluster B",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(personality_cluster_b,
       cumul = F)
}
```

```{r Check personality_cluster_b}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    personality_cluster_b,
    personality_cluster_b_numeric,
    mhd.personality_disorder_diagnosed,
    mhd.personality_disorder_diagnosed_numeric
  )
}
```

Cluster C
8. Avoidant/anxious                
9. Dependent                        
10. Obsessive-compulsive
```{r glad mhd personality_cluster_c}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    personality_cluster_c_numeric =
      case_when(
        mhd.personality_disorder_diagnosed_numeric == "1" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "2" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "3" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "4" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "5" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "6" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "7" ~ 0,
        mhd.personality_disorder_diagnosed_numeric == "8" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "9" ~ 1,
        mhd.personality_disorder_diagnosed_numeric == "10" ~ 1,
        mhd.personality_disorder_numeric == "0" ~ 0
      )
  )
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    personality_cluster_c =
      recode_factor(personality_cluster_c_numeric,
                    "0" = "No personality disorder cluster C",
                    "1" = "Personality disorder cluster C",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(personality_cluster_c,
       cumul = F)
}
```

```{r Check personality_cluster_c}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE) {
mhd.raw.id %>%
  select(
    personality_cluster_c,
    personality_cluster_c_numeric,
    mhd.personality_disorder_diagnosed,
    mhd.personality_disorder_diagnosed_numeric
  )
}
```

### Controls
##EDGI & NBR controls **NEED to check this for NBR - getting no controls?
These individuals have no self report diagnosis of any kind that we measure.
```{r mhd control EDGI NBR}
if(EDGI == TRUE | NBR == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_eating_disorder_numeric  == "0" & #**Need to ask why these are here??
    mhd.prefer_not_to_answer_eating_disorder_numeric  == "0" &
    mhd.dont_know_numeric  == "0" &
    mhd.prefer_not_to_answer_numeric  == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric  == "0" &
    (mhd.none_of_the_above.1_numeric == "1" | is.na(mhd.none_of_the_above.1_numeric)) &
    (mhd.none_of_the_above.2_numeric == "1" | is.na(mhd.none_of_the_above.2_numeric)) &
    (mhd.none_of_the_above_eating_disorder_numeric == "1" | is.na(mhd.none_of_the_above_eating_disorder_numeric)), #Check this - this would mean 'controls' may have answered 'None of the above' to all but one, in which the remaining one is NA. Does this really make them a control?
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}

```

```{r EDGI NBR mhd check none of the above}
if(EDGI == TRUE | NBR == TRUE) {
mhd.raw.id %>%
  group_by(control) %>%
  count(
    mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above_eating_disorder
  )
}

```



##GLAD controls
```{r mhd control GLAD }
if(GLAD == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.dont_know_eating_disorder_numeric == "0" &
    mhd.prefer_not_to_answer_eating_disorder_numeric == "0" &
    mhd.none_of_the_above.1_numeric != "0" &
    mhd.none_of_the_above.2_numeric != "0" &
    mhd.none_of_the_above.3_numeric != "0" &
    mhd.none_of_the_above.4_numeric != "0" &
    mhd.none_of_the_above_eating_disorder_numeric != "0", #Check this - this would mean 'controls' may have answered 'None of the above' to all but one, in which the remaining one is NA. Does this really make them a control?
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}
```

```{r GLAD mhd check none of the above}
if(GLAD == TRUE) {
mhd.raw.id %>%
  select(
    control,
    mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above.3,
    mhd.none_of_the_above.4,
    mhd.none_of_the_above_eating_disorder
  )
mhd.raw.id %>%
  group_by(control) %>%
  count(
     mhd.none_of_the_above.1,
    mhd.none_of_the_above.2,
    mhd.none_of_the_above.3,
    mhd.none_of_the_above.4,
    mhd.none_of_the_above_eating_disorder 
  )
}
```

##RAMP controls
```{r mhd control GLAD RAMP}
if(RAMP == TRUE) {
mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control_numeric =
      if_else(
    depressive_disorders_numeric == "0" &
    anxiety_disorders_numeric == "0" &
    eating_disorders_numeric == "0" &
    obsessive_compulsive_disorders_numeric == "0" &
    psychotic_disorders_numeric == "0" &
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric == "0" &
    mhd.posttraumatic_stress_disorder_ptsd_numeric == "0" &
    autism_spectrum_disorder_numeric == "0" &
    mhd.attention_deficit_hyperactivity_disorder_numeric == "0" &
    mhd.personality_disorder_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.dont_know_numeric == "0" &
    mhd.prefer_not_to_answer_numeric == "0" &
    mhd.dont_know.1_numeric == "0" &
    mhd.prefer_not_to_answer.1_numeric == "0" &
    mhd.none_of_the_above_numeric  != "0" &
    mhd.none_of_the_above.1_numeric != "0",
    true = 1,
    false = 0,
    NA_real_)
  )

mhd.raw.id <- mhd.raw.id %>%
  mutate(
    control =
      recode_factor(control_numeric,
                    "0" = "No control",
                    "1" = "Control",
                    missing = NA_character_
                    )
  )
mhd.raw.id %>%
  freq(control,
       cumul = F)
}
```

```{r RAMP mhd check none of the above}
if(RAMP == TRUE) {
mhd.raw.id %>%
  select(
    control,
    mhd.none_of_the_above,
    mhd.none_of_the_above.1
  )
mhd.raw.id %>%
  group_by(control) %>%
  count(
    mhd.none_of_the_above,
     mhd.none_of_the_above.1
  )
}
```


**Check - does this work with EDGI?
```{r Check control columns}
if(GLAD == TRUE | NBR == TRUE | RAMP == TRUE | EDGI == TRUE) {
mhd.raw.id %>%
  select(
    control,
    depressive_disorders_numeric,
    anxiety_disorders_numeric,
    eating_disorders_numeric,
    obsessive_compulsive_disorders_numeric,
    psychotic_disorders_numeric,
    mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
    mhd.posttraumatic_stress_disorder_ptsd_numeric,
    autism_spectrum_disorder_numeric,
    mhd.attention_deficit_hyperactivity_disorder_numeric,
    mhd.personality_disorder_numeric
  )
}
```


###JOINING DATASETS
##EDGI data frame list
```{r EDGI data frame list}
if(EDGI == TRUE) {
dfs.list <- list(
  edgi.coping.dem.raw.id,
edgi.coping.dem2.raw.id,
edgi.dem3.raw.id,
edgi.coping.dem4.employ.raw.id,
taf.edgi.coping.baseline.raw.id,
mhd.raw.id
#ADD EDEQ/TAF COPING
)
}
```

##GLAD data frame list
```{r GLAD data frame list}
if(GLAD == TRUE) {
dfs.list <- list(
    glad.coping.dem.raw.id,
glad.coping.dem2.raw.id,
glad.dem3.raw.id,
glad.coping.dem4.employ.raw.id,
taf.glad.coping.baseline.raw.id,
mhd.raw.id
#ADD EDEQ/TAF COPING
)
}
```

##NBR data frame list
```{r NBR data frame list}
if(NBR == TRUE) {
dfs.list <- list(
    nbr.dem.employ.raw.id,
nbr.dem.raw.id.complete,
nbr.dem2.raw.id,
mhd.raw.id,
taf.nbr.baseline.raw.id
#ADD EDEQ/TAF COPING
)
}

```

##RAMP data frame list
```{r RAMP data frame list}
if(RAMP == TRUE) {
dfs.list <- list(
    ramp.dem.employ.raw.id,
    ramp.dem.raw.id,
    mhd.raw.id,
    edeq.ramp.baseline.raw.id,
    edeq.ramp.followupb.raw.id,
    taf.ramp.baseline.raw.id,
    taf.ramp.followupa.raw.id,
    taf.ramp.followupb.raw.id
  
)

}
```

```{r Join all questionnaires}
dat.raw <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name") # Alternatively you can join by several columns EDGI -> "Age", "Sex", "Birthyear"
  )

#look at the data
colnames(dat.raw)
```

```{r Check duplicates}
dat.raw$ID.dup <- duplicated(dat.raw$ID)

summary(as.factor(dat.raw$ID.dup))

select(dat.raw)

 #Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw)))
names_freq[names_freq$Freq > 1, ]

##Filter out duplicate column names
 dat.dup <- dat.raw %>%
  filter(ID.dup == TRUE)

dat.raw.no.dup <- dat.raw %>%
  filter(ID.dup == FALSE)

colnames(dat.raw.no.dup)

```





