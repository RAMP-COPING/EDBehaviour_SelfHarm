---
title: "Exposures in all models"
author: "Helena Davies"
date: "21/04/2022"
output: html_document
---

This script derives exposure variables present in all regression models. 

Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Read in file with path to data channel
```{r Read in file with path to data channel}
source(file = "../credentials/paths.R")
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = paste0(filepath_functions, "add_numeric.R"))
source(file = paste0(filepath_functions, "remove_duplicates.R"))
source(file = paste0(filepath_functions, "package_check.R"))
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

# Read in data
```{r Read in dataset}
dat <- readRDS(paste0(filepath_saved_data, "final_dat_no_dup_entries2022-09-27.rds"))
```

# EXPOSURES / EXPLANATORY VARIABLES
[NB: only need to get the below within one script as will not change depending on outcome]
  •	Age
  •	Gender
  •	Racialised minority
  •	Highest education level 
  •	Psychiatric disorder 
  • Key worker status 
  • Loneliness
  • Pandemic worry
  • Defined as vulnerable person according to Government 
  • OCD screeners (for low weight model only)
  
[NB: for the below exposures, will need to derive these differently depending on the outcome because they were reported at every/every other phase and we are taking only those reported BEFORE or in the SAME PHASE as the outcome. These exposure variables are generated separately in each outcome script]
  • Positive COVID test or ill due to COVID  
  • Loss of loved one due to COVID
  • Change in economic activity
  • Change in living situation
## Age
```{r Age as exposure}
# Collapse age categories of 16-18 and 19-25 to 16-25, and over 71 to 71+ (very small categories otherwise)
dat <- dat   %>%
   mutate(age_category_COVID_baseline = 
           case_when(
               as.character(age_category) == "16-18" |
               as.character(age_category) == "19-25" ~ "16-25",
             
               as.character(age_category) == "26-35" ~ "26-35",
             
               as.character(age_category) == "36-45" ~ "36-45",
             
               as.character(age_category) == "46-55" ~ "46-55",
             
               as.character(age_category) == "56-65" ~ "56-65",
             
               as.character(age_category) == "66-70" ~ "66-70",
             
              (as.character(age_category) == "71-75" |
              as.character(age_category) == "76-80" |
              as.character(age_category) == "81-85" |
              as.character(age_category) == "86-90" |
              as.character(age_category) == "91-100" |
              as.character(age_category) == "+100" |
              as.character(age_category) == "100+") ~ "71+",
             
              (age_numeric >= 16 &
                 age_numeric <= 25) ~ "16-25",
          
             (age_numeric >= 26 &
                 age_numeric <= 35) ~ "26-35",
            
               (age_numeric >= 36 &
                 age_numeric <= 45) ~ "36-45",
            
            (age_numeric >= 46 &
                 age_numeric <= 55) ~ "46-55",
            
              (age_numeric >= 56 &
                 age_numeric <= 65) ~ "56-65",
             
              (age_numeric >= 66 &
                 age_numeric <= 70) ~ "66-70",
            
               age_numeric >= 71  ~ "71+"
             )
         )

# Check
dat %>%
  freq(age_category_COVID_baseline)


# Re-order for regression analyses with largest age group as reference
dat <- dat %>%
  mutate(age_category_COVID_baseline = factor(age_category_COVID_baseline,
                       levels = c("56-65",
                                  "16-25",
                                  "26-35",
                                  "36-45",
                                  "46-55",
                                   "66-70",
                                   "71+"
                                  
                         
          )))

# Check (NB: lots of missing GLAD and EDGI but that's probably because we are only looking at people who did the COPING survey). Lots of people in RAMP and NBR did not provide their DOB therefore we don't know their age.
dat %>%
  freq(age_category_COVID_baseline)

# Check NAs
dat %>%
  filter(is.na(age_category_COVID_baseline)) %>%
  freq(age_numeric)

# Check NAs
dat %>%
  filter(is.na(age_category_COVID_baseline)) %>%
  freq(age_category)
```

## Minoritised gender
```{r minoritised gender as exposure variable}
# Recode 
dat <- dat %>%
  mutate(minoritised_gender = 
           case_when(transgender == "Yes" | 
                     gender == "Non-binary" |
                     gender == "Self-define" ~ "Yes",
            
                     gender == "Male" |
                     gender == "Female" ~ "No")
                     
                     
         )

# Check
dat %>%
  freq(minoritised_gender) # NAs are people who did not answer the gender question (or from GLAD/EDGI signup only)

dat %>%
  filter(is.na(minoritised_gender)) %>%
  freq(gender)
```

## Sex (male = 0, female = 1)
```{r Sex as exposure variable}
# Recode to binary sex
dat <- dat %>%
  mutate(sex_binary = 
           case_when(sex  == "Male" ~ "Male",
                     
                     sex == "Female" ~ "Female",
                     
                     # NB: RAMP does not have sex, but does have whether someone is transgender
                    
                     # Non-transgender male
                      sample == "RAMP" &
                       gender == "Male" &
                       transgender == "No" ~"Male",
                     
                     # Transgender male, assigned female at birth
                     sample == "RAMP" &
                       gender == "Male" &
                       transgender == "Yes" ~"Female",
                     
                     # Non-transgender female
                      sample == "RAMP" &
                       gender == "Female" &
                       transgender == "No" ~ "Female",
                     
                     # Transgender female, assigned male at birth
                     sample == "RAMP" &
                       gender == "Female" &
                       transgender == "Yes" ~ "Male"
                     
            )
         )

dat %>%
 freq(sex_binary) # NB: Missing data is because we are only looking at EDGI AND GLAD COPING and ~7000 NBR participants did not answer the sex question.

dat %>%
  filter(is.na(sex_binary)) %>%
  freq(sample)
```

## Race
```{r Race as exposure variable}
# Recode to binary
dat <- dat %>%
  mutate(race_binary = 
           case_when(ethnicity == "Arab" |
                     ethnicity == "Asian or Asian British" |
                       ethnicity == "Asian or Asian British (including Chinese)" |
                       ethnicity == "Black or Black British" |
                       ethnicity == "Mixed" |
                       ethnicity == "Mixed or multiple ethnic origins" |
                       ethnicity == "Other" |
                       ethnicity == "Other ethnic group (please specify)" ~ "Racially minoritised",
                     
                      ethnicity == "White" |
                      ethnicity == "White, white European or Caucasian" ~ "White"
                      
            )
         )

# Check
dat %>%
  freq(race_binary)

# Check NAs
dat %>%
  filter(is.na(race_binary)) %>%
  freq(ethnicity)

# Reorder so that 'White' is reference category
dat <- dat %>%
  mutate(race_binary = factor(race_binary,
                       levels = c("White",
                                  "Racially minoritised"
                                  )))
dat %>%
  freq(race_binary)

# Create another variable that keeps all categories - if groups are big enough, should use this.
dat <- dat %>%
  mutate(race_categories = 
           case_when(ethnicity == "Arab" ~ "Arab",
                     ethnicity == "Asian or Asian British" |
                       ethnicity == "Asian or Asian British (including Chinese)" ~ "Asian",
                       ethnicity == "Black or Black British" ~ "Black",
                       ethnicity == "Mixed" |
                       ethnicity == "Mixed or multiple ethnic origins" ~ "Mixed race",
                       ethnicity == "Other" |
                       ethnicity == "Other ethnic group (please specify)" ~ "Other",
                     
                      ethnicity == "White" |
                      ethnicity == "White, white European or Caucasian" ~ "White"
                      
            )
         )

# Check
dat %>%
  freq(race_categories)

```

## Education
This is from baseline COPING and RAMP data (i.e., not GLAD or EDGI signups). 
```{r Education as exposure variable}
# Convert to binary variable to reduce number of exposure variables and maximise likelihood of models running.
dat <- dat %>%
  mutate(A_Levels_higher =
           case_when( 
                    highest_education == "No formal qualifications" ~ "No",
                     highest_education == "GCSE/CSE" &
                     age_numeric <= 18 ~ "Education not finished",
                     highest_education == "GCSE/CSE" ~ "No",
                     highest_education == "NVQ" ~ "No",
                     highest_education == "A-levels" ~"Yes",
                     highest_education == "University/Other professional qualifications" ~ "Yes"
              
           ))

# Check
dat %>%
  freq(A_Levels_higher) 

# Check NAs
dat %>%
  filter(is.na(A_Levels_higher)) %>%
  freq(highest_education)

# will also keep 'highest education' variable in case categories are big enough.
```

## Psychiatric disorder
This is from EDGI and GLAD sign-up data, as well as data from COPING and RAMP baseline. This was generated in the preprocessing script.
```{r Psychiatric disorder as exposure}
# Convert PNTA or don't know to NA
dat <- dat %>% 
  mutate(mental_health_diagnosis =
           case_when(mental_health_diagnosis == "PNTA or don't know" ~ NA_character_,
                     TRUE  ~  mental_health_diagnosis         
           ))
  
# Check
dat %>%
  freq(mental_health_diagnosis)

dat %>%
  filter(is.na(mental_health_diagnosis)) %>%
  freq(sample)
```

## Employed & key worker status
I have separated out those who are a key worker (and thus employed), those who are not a key worker but are employed, those who are unemployed (and thus not a key worker), and those who are students. This is from baseline COPING and RAMP data and was generated in the preprocessing script.
```{r Employed / key-worker status as exposure}
dat <- dat %>%
  mutate(paid_employment_key_worker =
           case_when(
                     key_worker == "Key worker" ~ "Key worker", # Employed and key worker
                     
                      baseline_paid_employment == "Paid employment" ~ "Paid employment", # In paid employment but did not endorse being a key worker (may be missing for that question) 
                     baseline_paid_employment == "Not in paid employment" ~ "Not paid employment", # Not in paid employment (and therefore not key worker)
                     baseline_paid_employment == "Student" ~ "Student", # Student (and therefore not key worker),
                     
                     baseline_paid_employment == "Retired" ~ "Retired" # Retired (and therefore not key worker),
                     )
           )
# Check
dat %>%
  freq(paid_employment_key_worker)

# Check NAs
dat %>%
  filter(is.na(paid_employment_key_worker)) %>%
  freq(baseline_paid_employment)

dat %>%
  filter(is.na(paid_employment_key_worker)) %>%
  freq(key_worker)

# Re-order for regression analysis
dat <- dat %>%
  mutate(paid_employment_key_worker = factor(paid_employment_key_worker,
                       levels = c("Paid employment",
                                  "Key worker",
                                  "Not paid employment",
                                  "Student",
                                  "Retired"
                                  )))
dat %>%
  freq(paid_employment_key_worker)
```


## Member of vulnerable group
This is baseline COPING and RAMP data (this is not asked at follow ups).
```{r Member of vulnerable group exposure}
# Recode / rename
dat <- dat %>%
  mutate(vulnerable_group_member =
           case_when(dem2.member_vulnerable_group == "Not I am not a member of a vulnerable group" ~ "Yes",
                     dem2.member_vulnerable_group == "I am not a member of a vulnerable group" ~ "No"
             
           ))

# Check
dat %>%
  freq(vulnerable_group_member)

# Check NAs
dat %>%
  filter(is.na(vulnerable_group_member)) %>%
  freq(dem2.member_vulnerable_group)
```

## Increased loneliness at baseline
First, create numeric variable that demonstrates baseline PANDEMIC loneliness score
All questions begin with: Over the past two weeks, how often have you felt that the following statements apply to you?
```{r Baseline pandemic loneliness score}
dat <- dat %>%
  mutate(across(starts_with("lone.felt"),
                ~case_when(
                  . == "Hardly ever" ~ 0,
                  . == "Some of the time" ~ 1,
                  .  == "Often" ~ 2,
                  TRUE ~ NA_real_)))
```

Calculate PANDEMIC loneliness score
```{r Loneliness baseline score}
dat$loneliness_pandemic_count <- rowSums(dat[ ,
                                 c("lone.felt_alone",
                                   "lone.felt_isolated_from_others",
                                   "lone.felt_left_out",
                                   "lone.felt_that_you_lack_companionship")],
                                  na.rm = FALSE)

# Check
dat %>%
  freq(loneliness_pandemic_count)
```

Create numeric variable that demonstrates PREPANDEMIC loneliness score
Score of loneliness pre-pandemic
 All questions start with: Before the pandemic, how often have you felt that the following statements apply to you?
```{r Loneliness prepandemic score}
dat$loneliness_prepandemic_count <- rowSums(dat[ ,
                                 c("lone.felt_alone.1",
                                   "lone.felt_isolated_from_others.1",
                                   "lone.felt_left_out.1",
                                   "lone.felt_that_you_lack_companionship.1")],
                                  na.rm = FALSE)

# Check
dat %>%
  freq(loneliness_prepandemic_count)
```

Calculate whether they have experienced an increase in loneliness during the pandemic or not 
```{r Loneliness increased during pandemic}
dat <- dat %>%
  mutate(increased_loneliness_during_pandemic =
           case_when(
             lone.similar_felt_pandemic == "No different" ~ "No", # These people did not get asked about their pre-pandemic loneliness, because they indicated that there had been no change (i.e., did not pass the screener)
           loneliness_pandemic_count > loneliness_prepandemic_count ~ "Yes", # These people have higher loneliness scores at baseline than retrospective prepandemic loneliness scores
         loneliness_pandemic_count <= loneliness_prepandemic_count ~ "No" # These people have lower or the same loneliness scores at baseline than retrospective prepandemic loneliness scores
         )
  )

# Check
dat %>%
  freq(increased_loneliness_during_pandemic)

# Check NAs
dat %>%
  filter(is.na(increased_loneliness_during_pandemic) &
          (!is.na(loneliness_prepandemic_count) &
           !is.na(loneliness_pandemic_count))) # There should not be anyone who has scores for both prepandemic and pandemic loneliness who were not assigned a final variable

dat %>%
  filter(is.na(increased_loneliness_during_pandemic))%>%
         freq(lone.similar_felt_pandemic)  # There should not be anyone who answered "No different" who does not have a value for 'increased loneliness during pandemic'
```

## Pandemic worry at baseline 
Participants are asked how worried they are about different factors, e.g., mental health, or employment. Before working out total score - First need to work out if participants answered any of these as 'not applicable' or if they did not answer (i.e., missing).

First need to create new variables in which '5' i.e., 'Not applicable' = 0, so that it is not included in final calculation of score. We can think of something not being applicable to someone in the same way as it not worrying them.
```{r Pandemic worry recode 'Not applicable' to 0}
dat <- dat %>%
  mutate(across(starts_with("panworry.") &
                  contains("numeric"),
                ~case_when(
                  . == 5 ~ 0,
                  TRUE ~ .)))
```

```{r check missingness}
panworry <- dat %>%
  select("panworry.impact_on_your_employment_status_numeric",
                                   "panworry.household_employment_status_key_numeric",
                                   "panworry.impact_on_your_education_or_exams_numeric",
                                   "panworry.exams_impact_education_children_numeric",
                                   "panworry.financial_impact_numeric",
                                   "panworry.contracting_the_virus_numeric",
                                   "panworry.people_you_know_contracting_the_virus_numeric",
                                   "panworry.people_you_dont_know_contracting_the_virus_numeric",
                                   "panworry.impact_mental_health_wellbeing_numeric",
                                   "panworry.childrens_mental_health_impact_numeric",
                                   "panworry.relatives_impact_mental_health_numeric",
                                   "panworry.being_socially_isolated_numeric",
                                   "panworry.people_you_know_being_socially_isolated_numeric",
                                   "panworry.shortage_of_essential_supplies_numeric",
                                   "panworry.shortage_of_medication_or_access_to_healthcare_numeric",
                                   "panworry.healthcare_people_essential_supplies_numeric",
                                   "panworry.information_virus_government_accuracy_numeric",
                                   "panworry.the_governments_response_to_the_pandemic_numeric",
                                   "panworry.separation_from_family_members_numeric",
                                   "panworry.global_recession_economy_longstanding_numeric",
                                   "panworry.other__numeric")



colMeans(is.na(panworry))*100
```


The 'other' item on the pandemic worry measure has higher missigness than all other variables. This is probably because the question asked people to 'Please specify' within a text box. I am not going to count this item in the final score.
```{r set missing for other to 0}
dat <- dat %>%
  mutate(panworry.other__numeric =
           case_when(is.na(panworry.other__numeric) ~ 0,
                     !is.na(panworry.other__numeric) ~ panworry.other__numeric
                     )
  )
```

Sum score of answers (e.g., score of 4 on a question = "Extremely worried")
```{r Pandemic worry sum score actual answers}
dat$panworry_total_score <- rowSums(dat[ ,
                                 c("panworry.impact_on_your_employment_status_numeric",
                                   "panworry.household_employment_status_key_numeric",
                                   "panworry.impact_on_your_education_or_exams_numeric",
                                   "panworry.exams_impact_education_children_numeric",
                                   "panworry.financial_impact_numeric",
                                   "panworry.contracting_the_virus_numeric",
                                   "panworry.people_you_know_contracting_the_virus_numeric",
                                   "panworry.people_you_dont_know_contracting_the_virus_numeric",
                                   "panworry.impact_mental_health_wellbeing_numeric",
                                   "panworry.childrens_mental_health_impact_numeric",
                                   "panworry.relatives_impact_mental_health_numeric",
                                   "panworry.being_socially_isolated_numeric",
                                   "panworry.people_you_know_being_socially_isolated_numeric",
                                   "panworry.shortage_of_essential_supplies_numeric",
                                   "panworry.shortage_of_medication_or_access_to_healthcare_numeric",
                                   "panworry.healthcare_people_essential_supplies_numeric",
                                   "panworry.information_virus_government_accuracy_numeric",
                                   "panworry.the_governments_response_to_the_pandemic_numeric",
                                   "panworry.separation_from_family_members_numeric",
                                   "panworry.global_recession_economy_longstanding_numeric"
                                   )],
                                   na.rm = FALSE)

# Check
dat %>%
  freq(panworry_total_score)    

# Check (no one should not be missing for all items but not have been assigned a final score)
dat %>%
  filter(is.na(panworry_total_score) &
          
          (!is.na(panworry.impact_on_your_employment_status_numeric) &
          !is.na(panworry.household_employment_status_key_numeric) &
          !is.na(panworry.impact_on_your_education_or_exams_numeric) &
          !is.na(panworry.exams_impact_education_children_numeric) &
          !is.na(panworry.financial_impact_numeric) &
          !is.na(panworry.contracting_the_virus_numeric) &
          !is.na(panworry.people_you_know_contracting_the_virus_numeric) &
          !is.na(panworry.people_you_dont_know_contracting_the_virus_numeric) &
          !is.na(panworry.impact_mental_health_wellbeing_numeric) &
          !is.na(panworry.childrens_mental_health_impact_numeric) &
          !is.na(panworry.relatives_impact_mental_health_numeric) &
          !is.na(panworry.being_socially_isolated_numeric) &
          !is.na(panworry.people_you_know_being_socially_isolated_numeric) &
          !is.na(panworry.shortage_of_essential_supplies_numeric) &
          !is.na(panworry.shortage_of_medication_or_access_to_healthcare_numeric) &
          !is.na(panworry.healthcare_people_essential_supplies_numeric) &
          !is.na(panworry.information_virus_government_accuracy_numeric) &
          !is.na(panworry.the_governments_response_to_the_pandemic_numeric) &
          !is.na(panworry.separation_from_family_members_numeric) &
          !is.na(panworry.global_recession_economy_longstanding_numeric))
            ) 

```

## OCD screener
```{r ocd screener}
# Check
dat %>%
  freq(ocd.repetitive_unpleasant_thoughts_binary)

# Check
dat %>%
  freq(ocd.compulsive_beh_mental_act_binary)

# These variables are highly correlated (0.76). Need to merge.
dat <- dat %>%
  mutate(OCD_symptoms =
           case_when(
             ocd.repetitive_unpleasant_thoughts_binary == "Yes" |
             ocd.compulsive_beh_mental_act_binary == "Yes" ~ "Yes", # Any 'Yes'
             
             ocd.repetitive_unpleasant_thoughts_binary == "No" &
             ocd.compulsive_beh_mental_act_binary == "No" ~ "No"  
             
           ))

# Check
dat %>%
  freq(OCD_symptoms
       )
```

# For all models, we need to know in which phase they first experienced an exposure (for those that are measured repeatedly).
## Positive covid test - three questionnaires (virus, resp, & dem)
NB: For the 'virus' questionnaire, there is no baseline assessment. However, there is a 'resp' questionnaire that is asked at baseline and at every follow up phase, so will include positive tests indicated in this questionnaire too, as well as people who indicated they were unwell with coronavirus in any of the demographic questionnaires (no baseline assessment).

Need to ensure COVID test occurred BEFORE outcomes - create new variable for COVID test that only counts positive tests as ones that occurred BEFORE each outcome. Will exclude anyone from the analysis if they experienced outcome before exposure, EVEN if it went: outcome → exposure → outcome. Should look at whether their FIRST experience of outcome came before (or at the same time of) their FIRST experience of exposure

Will also include co-occurring symptoms, but as a sensitivity analysis will get rid to further assess causal hypothesis.

### Identify at which phase they first experienced the exposure
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - positive COVID test - virus, dem and resp Q}
dat <- dat %>%
  mutate(exposure_phase_positive_covid_test =
           case_when(
              # Screener to virus questionnaire
             (is.na(virus.past_surveys_include_covid19_.Wave_1b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_2b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_3b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_4b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_6b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_8b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_10b) &
                       is.na(virus.past_surveys_include_covid19_.Wave_12b) &
                       is.na(virus.past_surveys_include_covid19_.Wave_14b) &
                       is.na(virus.past_surveys_include_covid19_.Wave_16b) & 
           
            # Screener to resp questionnaire
               is.na(resp.screener_baseline)  &
              is.na(resp.screener_followup_.Wave_1a)  &
              is.na(resp.screener_followup_.Wave_1b)  &
              is.na(resp.screener_followup_.Wave_2a)  &
              is.na(resp.screener_followup_.Wave_2b)  &
              is.na(resp.screener_followup_.Wave_3a)  &
              is.na(resp.screener_followup_.Wave_3b)  &
              is.na(resp.screener_followup_.Wave_4a)  &
              is.na(resp.screener_followup_.Wave_4b)  &
              is.na(resp.screener_followup_.Wave_5a)  &
              is.na(resp.screener_followup_.Wave_6b)  &
              is.na(resp.screener_followup_.Wave_7a)  &
              is.na(resp.screener_followup_.Wave_8b)  &
              is.na(resp.screener_followup_.Wave_9a)  &
              is.na(resp.screener_followup_.Wave_10b)  &
              is.na(resp.screener_followup_.Wave_11a)  &
              is.na(resp.screener_followup_.Wave_12b)  &
              is.na(resp.screener_followup_.Wave_13a)  &
              is.na(resp.screener_followup_.Wave_14b)  &
              is.na(resp.screener_followup_.Wave_15a)  &
              is.na(resp.screener_followup_.Wave_16b)  &
            
              # Screener to dem questionnaire
              is.na(dem.physical_health_.Wave_1a)  & 
              is.na(dem.physical_health_.Wave_1b)  &
              is.na(dem.physical_health_.Wave_2a)  &
              is.na(dem.physical_health_.Wave_2b)  &
              is.na(dem.physical_health_.Wave_3a)  &
              is.na(dem.physical_health_.Wave_3b)  &
              is.na(dem.physical_health_.Wave_4a)  &
              is.na(dem.physical_health_.Wave_4b)  &
              is.na(dem.physical_health_.Wave_5a)  &
              is.na(dem.physical_health_.Wave_6b)  &
              is.na(dem.physical_health_.Wave_7a)  &
              is.na(dem.physical_health_.Wave_8b)  &
              is.na(dem.physical_health_.Wave_9a)  &
              is.na(dem.physical_health_.Wave_10b)  &
              is.na(dem.physical_health_.Wave_11a)  &
              is.na(dem.physical_health_.Wave_12b)  &
              is.na(dem.physical_health_.Wave_13a)  &
              is.na(dem.physical_health_.Wave_14b)  &
              is.na(dem.physical_health_.Wave_15a)  &
              is.na(dem.physical_health_.Wave_16b)) ~ NA_character_, # Never answered screeners to either resp or virus or dem questionnaire
              
              # BASELINE indication of positive COVID test and/or being ill with COVID
               resp.results_nosethroat_swab_test == "Positive" | 
                resp.results_antibody_test == "Positive"  ~ "Baseline",
      
              # FOLLOW-UP indication of positive COVID test and/or being ill with COVID
          resp.results_nosethroat_swab_test_.Wave_1a == "Positive" | 
          resp.results_antibody_test_.Wave_1a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_1a == "Yes"  ~ "1a",

          virus.back_positive_antibodies_tests_.Wave_1b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_1b == "Positive" | 
           resp.results_antibody_test_.Wave_1b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_1b =="Yes" ~ "1b",
           
           resp.results_nosethroat_swab_test_.Wave_2a == "Positive" | 
          resp.results_antibody_test_.Wave_2a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_2a == "Yes"  ~ "2a",
           
          virus.back_positive_antibodies_tests_.Wave_2b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_2b == "Positive" | 
           resp.results_antibody_test_.Wave_2b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_2b == "Yes" ~ "2b",
           
           resp.results_nosethroat_swab_test_.Wave_3a == "Positive" | 
          resp.results_antibody_test_.Wave_3a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_3a == "Yes"  ~ "3a",
           
           virus.back_positive_antibodies_tests_.Wave_3b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_3b == "Positive" | 
           resp.results_antibody_test_.Wave_3b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_3b =="Yes" ~ "3b",
           
           resp.results_nosethroat_swab_test_.Wave_4a == "Positive" | 
          resp.results_antibody_test_.Wave_4a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_4a == "Yes"  ~ "4a",
           
           virus.back_positive_antibodies_tests_.Wave_4b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_4b == "Positive" | 
           resp.results_antibody_test_.Wave_4b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_4b =="Yes" ~ "4b",
           
            resp.results_nosethroat_swab_test_.Wave_5a == "Positive" | 
          resp.results_antibody_test_.Wave_5a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_5a == "Yes"  ~ "5a",
           
             virus.back_positive_antibodies_tests_.Wave_6b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_6b == "Positive" | 
           resp.results_antibody_test_.Wave_6b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_6b =="Yes" ~ "6b",

            resp.results_nosethroat_swab_test_.Wave_7a == "Positive" | 
          resp.results_antibody_test_.Wave_7a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_7a == "Yes"  ~ "7a",
           
             virus.back_positive_antibodies_tests_.Wave_8b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_8b == "Positive" | 
           resp.results_antibody_test_.Wave_8b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_8b =="Yes" ~ "8b",
           
            resp.results_nosethroat_swab_test_.Wave_9a == "Positive" | 
          resp.results_antibody_test_.Wave_9a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_9a == "Yes"  ~ "9a",
           
           virus.back_positive_antibodies_tests_.Wave_10b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_10b == "Positive" | 
           resp.results_antibody_test_.Wave_10b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_10b =="Yes" ~ "10b",
           
            resp.results_nosethroat_swab_test_.Wave_11a == "Positive" | 
          resp.results_antibody_test_.Wave_11a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_11a == "Yes"  ~ "11a",
           
            virus.back_positive_antibodies_tests_.Wave_12b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_12b == "Positive" | 
           resp.results_antibody_test_.Wave_12b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_12b =="Yes" ~ "12b",
           
           resp.results_nosethroat_swab_test_.Wave_13a == "Positive" | 
          resp.results_antibody_test_.Wave_13a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_13a == "Yes"  ~ "13a",
           
           virus.back_positive_antibodies_tests_.Wave_14b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_14b == "Positive" | 
           resp.results_antibody_test_.Wave_14b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_14b =="Yes" ~ "14b",
           
           resp.results_nosethroat_swab_test_.Wave_15a == "Positive" | 
          resp.results_antibody_test_.Wave_15a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_15a == "Yes"  ~ "15a",
           
            virus.back_positive_antibodies_tests_.Wave_16b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_16b == "Positive" | 
           resp.results_antibody_test_.Wave_16b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_16b =="Yes" ~ "16b",
              
              # No at least once
               ## BASELINE 
               resp.screener_baseline == "No" | # Not passed screener at baseline
               
                resp.coronavirus_test_nosethroat_swab == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test == "No" | # Not had an antibody test / not passed screener
                resp.results_antibody_test == "Negative" | # Negative antibody test result
      
              # FOLLOW-UPS
               dem.unwell_coronavirus_weeks_physical_.Wave_1a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_1a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_1a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_1a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_1a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_1a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_1a == "Negative" | # Negative antibody test result
                 
               
                 dem.unwell_coronavirus_weeks_physical_.Wave_1b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_1b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_1b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_1b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_1b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_1b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_1b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_1b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
               virus.back_positive_antibodies_tests_.Wave_1b == "Unsure/inconclusive" |
                
               dem.unwell_coronavirus_weeks_physical_.Wave_2a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_2a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_2a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_2a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_2a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_2a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_2a == "Negative" | # Negative antibody test result
               
               dem.unwell_coronavirus_weeks_physical_.Wave_2b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_2b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_2b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_2b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_2b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_2b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_2b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_2b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
               virus.back_positive_antibodies_tests_.Wave_2b == "Unsure/inconclusive" |
              
                  dem.unwell_coronavirus_weeks_physical_.Wave_3a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_3a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_3a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_3a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_3a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_3a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_3a == "Negative" | # Negative antibody test result
               
                 dem.unwell_coronavirus_weeks_physical_.Wave_3b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_3b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_3b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_3b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_3b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_3b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_3b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_3b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
                 virus.back_positive_antibodies_tests_.Wave_3b == "Unsure/inconclusive" |
                 
               dem.unwell_coronavirus_weeks_physical_.Wave_4a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_4a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_4a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_4a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_4a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_4a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_4a == "Negative" | # Negative antibody test result
               
                dem.unwell_coronavirus_weeks_physical_.Wave_4b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_4b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_4b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_4b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_4b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_4b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_4b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_4b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
               virus.back_positive_antibodies_tests_.Wave_4b == "Unsure/inconclusive" |
                 
                dem.unwell_coronavirus_weeks_physical_.Wave_5a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_5a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_5a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_5a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_5a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_5a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_5a == "Negative" | # Negative antibody test result
               
                 dem.unwell_coronavirus_weeks_physical_.Wave_6b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_6b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_6b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_6b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_6b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_6b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_6b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_6b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
                  virus.back_positive_antibodies_tests_.Wave_6b == "Unsure/inconclusive" |
               
               
                 dem.unwell_coronavirus_weeks_physical_.Wave_7a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_7a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_7a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_7a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_7a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_7a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_7a == "Negative" | # Negative antibody test result
               
                dem.unwell_coronavirus_weeks_physical_.Wave_8b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_8b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_8b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_8b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_8b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_8b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_8b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_8b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
            
                  dem.unwell_coronavirus_weeks_physical_.Wave_9a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_9a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_9a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_9a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_9a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_9a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_9a == "Negative" | # Negative antibody test result
               
                  dem.unwell_coronavirus_weeks_physical_.Wave_10b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_10b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_10b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_10b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_10b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_10b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_10b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_10b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
               virus.back_positive_antibodies_tests_.Wave_10b == "Unsure/inconclusive" |
                 
                  dem.unwell_coronavirus_weeks_physical_.Wave_11a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_11a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_11a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_11a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_11a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_11a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_11a == "Negative" | # Negative antibody test result
               
                    dem.unwell_coronavirus_weeks_physical_.Wave_12b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_12b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_12b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_12b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_12b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_12b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_12b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_12b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
               virus.back_positive_antibodies_tests_.Wave_12b == "Unsure/inconclusive" |
               
                  dem.unwell_coronavirus_weeks_physical_.Wave_13a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_13a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_13a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_13a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_13a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_13a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_13a == "Negative" | # Negative antibody test result
               
                  dem.unwell_coronavirus_weeks_physical_.Wave_14b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_14b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_14b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_14b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_14b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_14b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_14b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_14b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
                   virus.back_positive_antibodies_tests_.Wave_14b == "Unsure/inconclusive" |
                     
                   dem.unwell_coronavirus_weeks_physical_.Wave_15a == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_15a == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_15a == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_15a == "Negative" | # Negative nose throat swab
                 resp.coronavirus_antibody_test_.Wave_15a == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_15a == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_15a == "Negative" | # Negative antibody test result
               
                  dem.unwell_coronavirus_weeks_physical_.Wave_16b == "No" | # Not been unwell with coronavirus / not passed screener
                resp.coronavirus_test_nosethroat_swab_.Wave_16b == "No" | # Not had an nose throat swab test / not passed screener
                resp.results_nosethroat_swab_test_.Wave_16b == "Not passed screener" | # Not passed screener
                resp.results_nosethroat_swab_test_.Wave_16b == "Negative" | # Negative nose throat swab
                resp.coronavirus_antibody_test_.Wave_16b == "No" | # Not had an antibody test / not passed screener
                 resp.results_antibody_test_.Wave_16b == "Not passed screener" | # Not passed antibody screener
                resp.results_antibody_test_.Wave_16b == "Negative" | # Negative antibody test result
                 virus.back_positive_antibodies_tests_.Wave_16b == "No" | # Not had any tests back positive for COVID-19 / not passed screener
               virus.back_positive_antibodies_tests_.Wave_16b == "Unsure/inconclusive" ~ "Not experienced"
              )
              )
                  
                  
# Check
dat %>%
  freq(exposure_phase_positive_covid_test)

# Check
dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  select(starts_with("virus"))

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  select(starts_with("dem.unwell_coronavirus_weeks_physical"))


# Check random waves
dat %>%
  filter(is.na(exposure_phase_positive_covid_test) &
           (!is.na(dem.unwell_coronavirus_weeks_physical_.Wave_6b) &
                !is.na( resp.coronavirus_test_nosethroat_swab_.Wave_7a) &
                !is.na( resp.results_nosethroat_swab_test_.Wave_8b) &
                !is.na( resp.results_nosethroat_swab_test_.Wave_9a) &
                !is.na( resp.coronavirus_antibody_test_.Wave_10b) &
                !is.na( resp.results_antibody_test_.Wave_11a) &
                !is.na( resp.results_antibody_test_.Wave_12b) &
                !is.na(  virus.back_positive_antibodies_tests_.Wave_14b) &
             !is.na( virus.back_positive_antibodies_tests_.Wave_14b))
             )

```
NB: Those who have only ever put "Result awaited" have been coded as NA as we can not be sure whether they had COVID-19 or not.

## Losing someone due to COVID-19 (grief)
There are two questions in COPING that capture whether someone has lost someone due to COVID. 
1) in the 'grief' questionnaire which is in follow up B only and baseline ("In the past month, have you lost someone close to you due to COVID-19?")

2) the demographics questionnaire ("Has a relative that was previously ill with coronavirus or suspected coronavirus passed away?") in follow up A and B [not at baseline]

### Identify at which phase they first experienced the exposure
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - losing someone}
dat <- dat %>%
  mutate(exposure_phase_losing_someone =
           case_when( 
                       ( # In the past month, have you lost someone close to you due to COVID-19?
                          (is.na(grief.covid_lost_due_close) |
                         grief.covid_lost_due_close == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_1b) |
                         grief.due_past_month_lost_.Wave_1b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_2b) |
                         grief.due_past_month_lost_.Wave_2b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_3b) |
                         grief.due_past_month_lost_.Wave_3b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_4b) |
                         grief.due_past_month_lost_.Wave_4b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_6b) |
                         grief.due_past_month_lost_.Wave_6b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_8b) |
                         grief.due_past_month_lost_.Wave_8b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_10b) |
                         grief.due_past_month_lost_.Wave_10b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_12b) |
                         grief.due_past_month_lost_.Wave_12b == "Prefer not to say") &
                          (is.na(grief.due_past_month_lost_.Wave_14b) |
                         grief.due_past_month_lost_.Wave_14b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_16b) |
                         grief.due_past_month_lost_.Wave_16b == "Prefer not to say") &
                        
                    # Has a relative that was previously ill with coronavirus or suspected coronavirus passed away?
                         
                        (dem.coronavirus_relative_previously_ill.1_.Wave_1a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_1a) # Not answered screener question
                           ) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_1b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_1b )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_2a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_2a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_2b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_2b )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_3a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_3a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_3b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_3b )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_4a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_4a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_4b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_4b )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_5a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_5a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_6b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_6b)) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_7a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_7a)) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_8b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_8b )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_9a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_9a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_10b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_10b )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_11a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_11a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_12b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_12b)) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_13a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_13a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_14b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_14b )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_15a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_15a )) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_16b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_16b))
                        )  ~ "Not answered or PNTA", 
                       
                       grief.covid_lost_due_close == "Yes" ~ "Baseline",
                       dem.coronavirus_relative_previously_ill.1_.Wave_1a == "Yes" ~ "1a", 
                       grief.due_past_month_lost_.Wave_1b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_1b == "Yes" ~ "1b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_2a == "Yes" ~ "2a",
                       grief.due_past_month_lost_.Wave_2b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_2b == "Yes" ~ "2b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_3a == "Yes" ~ "3a",
                       grief.due_past_month_lost_.Wave_3b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_3b == "Yes" ~ "3b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_4a == "Yes" ~ "4a",
                       grief.due_past_month_lost_.Wave_4b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_4b == "Yes" ~ "4b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_5a == "Yes" ~ "5a",
                       grief.due_past_month_lost_.Wave_6b  == "Yes" |
                        dem.coronavirus_relative_previously_ill.1_.Wave_6b == "Yes" ~ "6b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_7a == "Yes" ~ "7a",
                       grief.due_past_month_lost_.Wave_8b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_8b == "Yes" ~ "8b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_9a == "Yes" ~ "9a",
                       grief.due_past_month_lost_.Wave_10b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_10b == "Yes" ~ "10b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_11a == "Yes" ~ "11a",
                       grief.due_past_month_lost_.Wave_12b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_12b == "Yes" ~ "12b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_13a == "Yes" ~ "13a",
                       grief.due_past_month_lost_.Wave_14b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_14b == "Yes" ~ "14b",
                       dem.coronavirus_relative_previously_ill.1_.Wave_15a == "Yes" ~ "15a",
                       grief.due_past_month_lost_.Wave_16b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_16b == "Yes" ~ "16b",
                       
              # Not lost someone
                     
                     grief.covid_lost_due_close == "No" |
                      
                     (dem.health_of_a_relative_.Wave_1a == "Not Health of a relative" | # Screener question
                        dem.coronavirus_relative_previously_ill.1_.Wave_1a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_1a == "No") | # Relative not passed

                      (dem.health_of_a_relative_.Wave_1b == "Not Health of a relative" | # Screener question
                       dem.coronavirus_relative_previously_ill.1_.Wave_1b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_1b == "No" |  # Relative not passed
                      grief.due_past_month_lost_.Wave_1b  == "No" ) |

                      (dem.health_of_a_relative_.Wave_2a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_2a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_2a == "No" ) | # Ill relative not passed away

                      (dem.health_of_a_relative_.Wave_2b == "Not Health of a relative" | # Screener question
                       dem.coronavirus_relative_previously_ill.1_.Wave_2b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_2b == "No" | # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_2b  == "No" ) |

                     (dem.health_of_a_relative_.Wave_3a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_3a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_3a == "No" ) | # # Ill relative not passed 

                      (dem.health_of_a_relative_.Wave_3b == "Not Health of a relative" | # Screener question
                          dem.coronavirus_relative_previously_ill.1_.Wave_3b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_3b == "No" | # # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_3b  == "No" ) |

                     (dem.health_of_a_relative_.Wave_4a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_4a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_4a == "No" ) | # # Ill relative not passed 
                     
                      (dem.health_of_a_relative_.Wave_4b == "Not Health of a relative" | # Screener question
                          dem.coronavirus_relative_previously_ill.1_.Wave_4b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_4b == "No" | # # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_4b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_5a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_5a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_5a == "No" ) | # # Ill relative not passed 
                     
                     (dem.health_of_a_relative_.Wave_6b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_6b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_6b == "No" | # # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_6b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_7a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_7a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_7a == "No" ) | # # Ill relative not passed 
                     
                     (dem.health_of_a_relative_.Wave_8b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_8b  == "Unsure" | # Unsure if relative has passed
                       dem.coronavirus_relative_previously_ill.1_.Wave_8b == "No" | #  Ill relative not passed 
                      grief.due_past_month_lost_.Wave_8b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_9a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_9a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_9a == "No" ) | # # Ill relative not passed 
                     
                     (dem.health_of_a_relative_.Wave_10b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_10b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_10b == "No" | # # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_10b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_11a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_11a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_11a == "No" ) | # # Ill relative not passed 
                     
                      (dem.health_of_a_relative_.Wave_12b == "Not Health of a relative" | # Screener question
                          dem.coronavirus_relative_previously_ill.1_.Wave_12b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_12b == "No" | # # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_12b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_13a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_13a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_13a == "No" ) | # # Ill relative not passed 
                     
                     (dem.health_of_a_relative_.Wave_14b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_14b  == "Unsure" | # Unsure if relative has passed
                       dem.coronavirus_relative_previously_ill.1_.Wave_14b == "No" | # # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_14b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_15a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_15a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_15a == "No" ) | # # Ill relative not passed 
                     
                       (dem.health_of_a_relative_.Wave_16b == "Not Health of a relative" | # Screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_16b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_previously_ill.1_.Wave_16b == "No" | # # Ill relative not passed 
                      grief.due_past_month_lost_.Wave_16b  == "No" )   ~ "Not lost someone" 
                   
                   
                       )
         )

# Check
dat %>%
  freq(exposure_phase_losing_someone)
```


## Change in main eco activity (work/education)
Baseline:
employ.my_employment_status_has_not_changed = Has your employment status changed since the pandemic began? [My employment status has not changed]
employ.no_impact = How has this impacted your studies? [No impact]
employ.impact_on_studies_still_unknown = How has this impacted your studies? [Impact on studies still unknown]

Follow ups:
dem.household_employment_status_key: Has anything changed in the following domains in the last two weeks: Employment status of a key earner in your household
dem.employment: Has anything changed in the following domains in the last two weeks: Employment 
NB: No follow-up questions about studying.

Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - change in main eco activity}
dat <- dat %>%
  mutate(exposure_phase_main_eco_change =
           case_when(
                     # Change in employment at baseline
                     employ.my_employment_status_has_not_changed == "Not My employment status has not changed" ~ "Baseline",
                     
                     # (for students) Change in school/studies/exams at baseline
                     employ.no_impact == "Not No impact" &  
                     employ.impact_on_studies_still_unknown == "Not Impact on studies still unknown" ~ "Baseline", # Indicated that the pandemic has impacted their studies in some way at baseline
                     
                     # Missing at baseline and all phases
                       is.na(employ.no_impact) & # Not answered impact on studies at baseline
                      is.na(employ.my_employment_status_has_not_changed) & # Not answered whether employment has changed at baseline
                       
                    # Has anything changed in the following domains in the last two weeks: Employment
                       is.na(dem.employment_.Wave_1a) &  
                       is.na(dem.employment_.Wave_1b) &
                       is.na(dem.employment_.Wave_2a) &
                       is.na(dem.employment_.Wave_2b) &
                       is.na(dem.employment_.Wave_3a) &
                       is.na(dem.employment_.Wave_3b) &
                       is.na(dem.employment_.Wave_4a) &
                       is.na(dem.employment_.Wave_4b) &
                       is.na(dem.employment_.Wave_5a) &
                       is.na(dem.employment_.Wave_6b) &
                       is.na(dem.employment_.Wave_7a) &
                       is.na(dem.employment_.Wave_8b) &
                       is.na(dem.employment_.Wave_9a) &
                       is.na(dem.employment_.Wave_10b) &
                       is.na(dem.employment_.Wave_11a) &
                       is.na(dem.employment_.Wave_12b) &
                       is.na(dem.employment_.Wave_13a) &
                       is.na(dem.employment_.Wave_14b) &
                       is.na(dem.employment_.Wave_15a) &
                       is.na(dem.employment_.Wave_16b) &

                    # Has anything changed in the following domains in the last two weeks: Employment status of a key earner in your household   
                       is.na(dem.household_employment_status_key_.Wave_1a) &  
                       is.na(dem.household_employment_status_key_.Wave_1b) &
                       is.na(dem.household_employment_status_key_.Wave_2a) &
                       is.na(dem.household_employment_status_key_.Wave_2b) &
                       is.na(dem.household_employment_status_key_.Wave_3a) &
                       is.na(dem.household_employment_status_key_.Wave_3b) &
                       is.na(dem.household_employment_status_key_.Wave_4a) &
                       is.na(dem.household_employment_status_key_.Wave_4b) &
                       is.na(dem.household_employment_status_key_.Wave_5a) &
                       is.na(dem.household_employment_status_key_.Wave_6b) &
                       is.na(dem.household_employment_status_key_.Wave_7a) &
                       is.na(dem.household_employment_status_key_.Wave_8b) &
                       is.na(dem.household_employment_status_key_.Wave_9a) &
                       is.na(dem.household_employment_status_key_.Wave_10b) &
                       is.na(dem.household_employment_status_key_.Wave_11a) &
                       is.na(dem.household_employment_status_key_.Wave_12b) &
                       is.na(dem.household_employment_status_key_.Wave_13a) &
                       is.na(dem.household_employment_status_key_.Wave_14b) &
                       is.na(dem.household_employment_status_key_.Wave_15a) &
                       is.na(dem.household_employment_status_key_.Wave_16b)  ~ "Missing at every phase", # Not answered whether employment has changed in the last two weeks 
            
                       dem.employment_.Wave_1a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_1a == "Employment status of a key earner in your household" ~ "1a",
                       dem.employment_.Wave_1b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_1b == "Employment status of a key earner in your household" ~ "1b",
                       dem.employment_.Wave_2a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_2a == "Employment status of a key earner in your household"~ "2a",
                       dem.employment_.Wave_2b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_2b == "Employment status of a key earner in your household"~ "2b",
                       dem.employment_.Wave_3a == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_3a == "Employment status of a key earner in your household" ~ "3a",
                       dem.employment_.Wave_3b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_3b == "Employment status of a key earner in your household"~ "3b",
                       dem.employment_.Wave_4a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_4a == "Employment status of a key earner in your household"~ "4a",
                       dem.employment_.Wave_4b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_4b == "Employment status of a key earner in your household"~ "4b",
                       dem.employment_.Wave_5a == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_5a == "Employment status of a key earner in your household" ~ "5a",
                       dem.employment_.Wave_6b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_6b == "Employment status of a key earner in your household"~ "6b",
                       dem.employment_.Wave_7a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_7a == "Employment status of a key earner in your household" ~ "7a",
                       dem.employment_.Wave_8b == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_8b == "Employment status of a key earner in your household" ~ "8b",
                       dem.employment_.Wave_9a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_9a == "Employment status of a key earner in your household"~ "9a",
                       dem.employment_.Wave_10b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_10b == "Employment status of a key earner in your household"~ "10b",
                       dem.employment_.Wave_11a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_11a == "Employment status of a key earner in your household"~ "11a",
                       dem.employment_.Wave_12b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_12b == "Employment status of a key earner in your household"~ "12b",
                       dem.employment_.Wave_13a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_13a == "Employment status of a key earner in your household"~ "13a",
                       dem.employment_.Wave_14b == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_14b == "Employment status of a key earner in your household" ~ "14b",
                       dem.employment_.Wave_15a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_15a == "Employment status of a key earner in your household"~ "15a",
                       dem.employment_.Wave_16b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_16b == "Employment status of a key earner in your household"~ "16b",
                       
                      baseline_paid_employment == "Retired" | # Not asked question about change in employment
                       employ.my_employment_status_has_not_changed == "My employment status has not changed" | # Not experienced change in employment at baseline
                       employ.no_impact == "No impact"  | # Not impacted studies at baseline
                       employ.impact_on_studies_still_unknown == "Impact on studies still unknown" | # Not sure about impact yet
                       dem.employment_.Wave_1a == "Not Employment" |
                       dem.employment_.Wave_1b == "Not Employment" |
                       dem.employment_.Wave_2a == "Not Employment" |
                       dem.employment_.Wave_2b == "Not Employment" |
                       dem.employment_.Wave_3a == "Not Employment" |
                       dem.employment_.Wave_3b == "Not Employment" |
                       dem.employment_.Wave_4a == "Not Employment" |
                       dem.employment_.Wave_4b == "Not Employment" |
                       dem.employment_.Wave_5a == "Not Employment" |
                       dem.employment_.Wave_6b == "Not Employment" |
                       dem.employment_.Wave_7a == "Not Employment" |
                       dem.employment_.Wave_8b == "Not Employment" |
                       dem.employment_.Wave_9a == "Not Employment" |
                       dem.employment_.Wave_10b == "Not Employment" |
                       dem.employment_.Wave_11a == "Not Employment" |
                       dem.employment_.Wave_12b == "Not Employment" |
                       dem.employment_.Wave_13a == "Not Employment" |
                       dem.employment_.Wave_14b == "Not Employment" |
                       dem.employment_.Wave_15a == "Not Employment" |
                       dem.employment_.Wave_16b == "Not Employment" |

                      dem.household_employment_status_key_.Wave_1a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_1b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_2a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_2b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_3a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_3b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_4a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_4b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_5a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_6b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_7a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_8b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_9a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_10b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_11a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_12b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_13a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_14b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_15a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_16b == "Not Employment status of a key earner in your household"~ "No change in eco activity" # Have experienced change but not in the employment domain
                     
                   ))

dat %>%
  freq(exposure_phase_main_eco_change)
```

## Change in living situation
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - change in living situation}
dat <- dat %>%
  mutate(exposure_phase_living_situation_change =
           case_when(
                     # Change in employment
                     dem2.living_situation_change_pandemic == "Yes" ~ "Baseline", # Indicated change in living situation at baseline
                  
                     # Missing at baseline and all phases
                       is.na(dem2.living_situation_change_pandemic) & # Not answered at baseline
                      is.na(dem.living_situation_.Wave_1a) &  # Has anything changed in the following domains in the last two weeks: Living situation
                       is.na(dem.living_situation_.Wave_1b) &
                       is.na(dem.living_situation_.Wave_2a) &
                       is.na(dem.living_situation_.Wave_2b) &
                       is.na(dem.living_situation_.Wave_3a) &
                       is.na(dem.living_situation_.Wave_3b) &
                       is.na(dem.living_situation_.Wave_4a) &
                       is.na(dem.living_situation_.Wave_4b) &
                       is.na(dem.living_situation_.Wave_5a) &
                       is.na(dem.living_situation_.Wave_6b) &
                       is.na(dem.living_situation_.Wave_7a) &
                       is.na(dem.living_situation_.Wave_8b) &
                       is.na(dem.living_situation_.Wave_9a) &
                       is.na(dem.living_situation_.Wave_10b) &
                       is.na(dem.living_situation_.Wave_11a) &
                       is.na(dem.living_situation_.Wave_12b)&
                       is.na(dem.living_situation_.Wave_13a) &
                       is.na(dem.living_situation_.Wave_14b) &
                       is.na(dem.living_situation_.Wave_15a) &
                       is.na(dem.living_situation_.Wave_16b) ~ "Missing at every phase", # Not answered whether living situation has changed in the last two weeks 
            
                       dem.living_situation_.Wave_1a == "Living situation" ~ "1a",
                       dem.living_situation_.Wave_1b == "Living situation" ~ "1b",
                       dem.living_situation_.Wave_2a == "Living situation" ~ "2a",
                       dem.living_situation_.Wave_2b == "Living situation" ~ "2b",
                       dem.living_situation_.Wave_3a == "Living situation" ~ "3a",
                       dem.living_situation_.Wave_3b == "Living situation" ~ "3b",
                       dem.living_situation_.Wave_4a == "Living situation" ~ "4a",
                       dem.living_situation_.Wave_4b == "Living situation" ~ "4b",
                       dem.living_situation_.Wave_5a == "Living situation" ~ "5a",
                       dem.living_situation_.Wave_6b == "Living situation" ~ "6b",
                       dem.living_situation_.Wave_7a == "Living situation" ~ "7a",
                       dem.living_situation_.Wave_8b == "Living situation" ~ "8b",
                       dem.living_situation_.Wave_9a == "Living situation" ~ "9a",
                       dem.living_situation_.Wave_10b == "Living situation" ~ "10b",
                       dem.living_situation_.Wave_11a == "Living situation" ~ "11a",
                       dem.living_situation_.Wave_12b == "Living situation" ~ "12b",
                       dem.living_situation_.Wave_13a == "Living situation" ~ "13a",
                       dem.living_situation_.Wave_14b == "Living situation" ~ "14b",
                       dem.living_situation_.Wave_15a == "Living situation" ~ "15a",
                       dem.living_situation_.Wave_16b == "Living situation" ~ "16b",

                       dem2.living_situation_change_pandemic == "No" | # Not experienced change in living situation at baseline
                       dem.living_situation_.Wave_1a == "Not Living situation" |
                       dem.living_situation_.Wave_1b == "Not Living situation" |
                       dem.living_situation_.Wave_2a == "Not Living situation" |
                       dem.living_situation_.Wave_2b == "Not Living situation" |
                       dem.living_situation_.Wave_3a == "Not Living situation" |
                       dem.living_situation_.Wave_3b == "Not Living situation" |
                       dem.living_situation_.Wave_4a == "Not Living situation" |
                       dem.living_situation_.Wave_4b == "Not Living situation" |
                       dem.living_situation_.Wave_5a == "Not Living situation" |
                       dem.living_situation_.Wave_6b == "Not Living situation" |
                       dem.living_situation_.Wave_7a == "Not Living situation" |
                       dem.living_situation_.Wave_8b == "Not Living situation" |
                       dem.living_situation_.Wave_9a == "Not Living situation" |
                       dem.living_situation_.Wave_10b == "Not Living situation" |
                       dem.living_situation_.Wave_11a == "Not Living situation" |
                       dem.living_situation_.Wave_12b == "Not Living situation" |
                       dem.living_situation_.Wave_13a == "Not Living situation" |
                       dem.living_situation_.Wave_14b == "Not Living situation" |
                       dem.living_situation_.Wave_15a == "Not Living situation" |
                       dem.living_situation_.Wave_16b == "Not Living situation"  ~ "No change in living situation" # Have experienced change but not in the employment domain
                     
                   ))


dat %>%
  freq(exposure_phase_living_situation_change)
```


# Saving dataset
## Select & save variables needed for analysis
```{r Select final variables ready for regression analyses}
final_dat <- dat %>%
  select(ID,
         sample,
        
         # Exposures only in low weight models
         ocd.repetitive_unpleasant_thoughts_binary,
         ocd.compulsive_beh_mental_act_binary,
         OCD_symptoms,
         
         # Exposures in all models
         age_category_COVID_baseline,
         minoritised_gender,
         sex_binary,
         race_binary,
         A_Levels_higher,
         mental_health_diagnosis,
         paid_employment_key_worker,
         vulnerable_group_member,
         panworry_total_score,
         increased_loneliness_during_pandemic,
          
         # Phase in which they first experienced the exposure
         exposure_phase_positive_covid_test,
         exposure_phase_losing_someone,
         exposure_phase_main_eco_change,
         exposure_phase_living_situation_change,
        
         # Extra variables (more categories - will use for Descriptives)
        highest_education,
        race_categories,
        transgender,
        gender
        )
```

Save final dataset 
Save dataset
```{r save dataset}
saveRDS(object = final_dat,
       file = paste0(filepath_saved_data, "exposures_all_models", date, ".rds"))
```
