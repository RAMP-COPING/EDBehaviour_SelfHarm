---
title: "Preprocessing"
author: "Helena Davies"
date: "21/04/2021"
output: html_document
---

Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Read in file with path to data channel
```{r Read in file with path to data channel}
source(file = "../credentials/paths.R")
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = paste0(filepath_functions, "add_numeric.R"))
source(file = paste0(filepath_functions, "remove_duplicates.R"))
source(file = paste0(filepath_functions, "package_check.R"))
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

Specify cohort
I have added this for my own ease of running the script, i.e., I can run and troubleshoot one cohort at a time.
```{r Specify cohort}
GLAD = FALSE
EDGI = TRUE
RAMP = FALSE
NBR = FALSE
COPING = FALSE
```

# Read in cleaned data 
## Age
- AGE AT COVID ASSESSMENT (i.e., EDGI and GLAD COPING baseline questionnaire NOT GLAD/EDGI signup)
```{r read in age cleaned data}
if(EDGI == TRUE){
age_dat_edgi_coping <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_edgi/demographics/age_coping_edgi_clean.rds"))
dim(age_dat_edgi_coping)
colnames(age_dat_edgi_coping)
}

if(GLAD == TRUE){
age_dat_glad_coping <- readRDS(file =  paste0(filepath_cleaned_latest_freeze, "coping_glad/demographics/age_coping_glad_clean.rds"))
dim(age_dat_glad_coping)
colnames(age_dat_glad_coping)
}

if(NBR == TRUE){
# NBR
age_dat_nbr <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_nbr/demographics/age_coping_nbr_clean.rds"))
dim(age_dat_nbr)
colnames(age_dat_nbr)
}

if(RAMP == TRUE){
# RAMP
age_dat_ramp <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "ramp/demographics/age_ramp_clean.rds"))
dim(age_dat_ramp)
colnames(age_dat_ramp)
}
```

## Gender & sex
- GENDER AT COVID ASSESSMENT (i.e., EDGI and GLAD COPING baseline questionnaire NOT GLAD/EDGI signup)
NB: The question about being transgender is only available in GLAD/EDGI signup, not the COPING baseline questionnaire AND is therefore not asked in NBR.
```{r read in gender/sex cleaned data}
if(EDGI == TRUE){
# EDGI
gender_sex_edgi_dat <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_edgi/demographics/sex_gender_sexuality_coping_edgi_clean.rds"))
dim(gender_sex_edgi_dat)
colnames(gender_sex_edgi_dat)

transgender_edgi_dat <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "edgi/demographics/sex_gender_sexuality_edgi_clean.rds"))
dim(transgender_edgi_dat)
colnames(transgender_edgi_dat)

# Merge
gender_sex_edgi_transgender_dat <- dplyr::full_join(gender_sex_edgi_dat,
                                                    transgender_edgi_dat,
                                                    by = c("ID",
                                                           "sample"
                                                           )
                                                    )

}

if(GLAD == TRUE){
# GLAD
gender_sex_glad_dat <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_glad/demographics/sex_gender_sexuality_coping_glad_clean.rds"))
dim(gender_sex_glad_dat)
colnames(gender_sex_glad_dat)

transgender_glad_dat <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "glad/demographics/sex_gender_sexuality_glad_clean.rds"))
dim(transgender_glad_dat)
colnames(transgender_glad_dat)

# Merge
gender_sex_glad_transgender_dat <- dplyr::full_join(gender_sex_glad_dat,
                                                    transgender_glad_dat,
                                                    by = c("ID",
                                                           "sample"
                                                           ) 
                                                    )


}

if(NBR == TRUE){
# NBR
gender_sex_nbr_dat <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_nbr/demographics/sex_gender_sexuality_coping_nbr_clean.rds"))
dim(gender_sex_nbr_dat)
colnames(gender_sex_nbr_dat)
}

if(RAMP == TRUE){
# RAMP
gender_sex_dat_ramp <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "ramp/demographics/sex_gender_sexuality_ramp_clean.rds"))
dim(gender_sex_dat_ramp)
colnames(gender_sex_dat_ramp)

}
```

## Ethnicity 
```{r read in ethnicity cleaned data}
if(EDGI == TRUE){
# EDGI
ethnicity_dat_edgi <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "edgi/demographics/ethnicity_edgi_clean.rds"))
dim(ethnicity_dat_edgi)
colnames(ethnicity_dat_edgi)
}

if(GLAD == TRUE){
# GLAD
ethnicity_dat_glad <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "glad/demographics/ethnicity_glad_clean.rds"))
dim(ethnicity_dat_glad)
colnames(ethnicity_dat_glad)
}

if(NBR == TRUE){
# NBR
ethnicity_dat_nbr <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_nbr/demographics/ethnicity_coping_nbr_clean.rds"))
dim(ethnicity_dat_nbr)
colnames(ethnicity_dat_nbr)
}

if(RAMP == TRUE){
# RAMP
ethnicity_dat_ramp <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "ramp/demographics/ethnicity_ramp_clean.rds"))
dim(ethnicity_dat_ramp)
colnames(ethnicity_dat_ramp)
}
```

# Highest education
NB: highest education AT COVID ASSESSMENT (i.e., EDGI and GLAD COPING baseline questionnaire NOT GLAD/EDGI signup)
## Read in EDGI highest education data
```{r read in highest education cleaned data EDGI}
if(EDGI == TRUE){
# EDGI
highest_education_edgi_coping_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/employ_coping_edgi.rds"))
dim(highest_education_edgi_coping_raw)
colnames(highest_education_edgi_coping_raw)

highest_education_edgi_coping <- highest_education_edgi_coping_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         everything()
         ) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(highest_education_edgi_coping)
# Inspect colnames
colnames(highest_education_edgi_coping)
#Differences
dim(highest_education_edgi_coping)[1]-dim(highest_education_edgi_coping_raw)[1]
}
```

## Read in GLAD highest education data
```{r read in highest education cleaned data GLAD}
if(GLAD == TRUE){
# GLAD
highest_education_glad_coping_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/employ_coping_glad.rds"))
dim(highest_education_glad_coping_raw)
colnames(highest_education_glad_coping_raw)

highest_education_glad_coping <- highest_education_glad_coping_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "GLAD", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         everything()
         ) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(highest_education_glad_coping)
# Inspect colnames
colnames(highest_education_glad_coping)
#Differences
dim(highest_education_glad_coping)[1]-dim(highest_education_glad_coping_raw)[1]
}
```

## Read in NBR highest education data
```{r read in highest education cleaned data NBR}
if(NBR == TRUE){
# NBR
highest_education_nbr_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/employ_coping_nbr.rds"))
dim(highest_education_nbr_raw)
colnames(highest_education_nbr_raw)

highest_education_nbr <- highest_education_nbr_raw%>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% # Remove duplicates based on ID
  add_column(sample = "NBR", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         sample, # Sample
         everything()
         ) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(highest_education_nbr)
# Inspect colnames
colnames(highest_education_nbr)
#Differences
dim(highest_education_nbr)[1]-dim(highest_education_nbr_raw)[1]
}
```

## Read in RAMP highest education data
```{r read in highest education cleaned data RAMP}
if(RAMP == TRUE){
# RAMP
highest_education_ramp_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/employ_ramp.rds"))
dim(highest_education_ramp_raw)
colnames(highest_education_ramp_raw)

highest_education_ramp <- highest_education_ramp_raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  remove_duplicates("Login ID") %>% # Remove duplicates based on ID
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
         everything()
         ) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(highest_education_ramp)
# Inspect colnames
colnames(highest_education_ramp)
#Differences
dim(highest_education_ramp)[1]-dim(highest_education_ramp_raw)[1]
}
```

### Run highest education cleaning source script
```{r highest education source script}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./highest_education.R")
}
```

# Employment
Read in employment data & clean
NB: This has been cleaned separately but will use my own source script to identify key workers etc
```{r exclude cols demographics}
if(RAMP == TRUE | GLAD == TRUE | EDGI == TRUE | NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate",
                  "endDate")
}
```

## Read in RAMP employment data
```{r Read in data RAMP employment}
if(RAMP == TRUE){
ramp_dem_employ_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/employ_ramp.rds"))
dim(ramp_dem_employ_raw)
colnames(ramp_dem_employ_raw)
}
```

Select variables RAMP employment
```{r Select variables RAMP employment}
if(RAMP == TRUE){
ramp_dem_employ_raw_id <- ramp_dem_employ_raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  remove_duplicates("Login ID") %>% # Remove duplicates based on ID
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp_dem_employ_raw_id)
# Inspect colnames
colnames(ramp_dem_employ_raw_id)
#Differences
dim(ramp_dem_employ_raw)[1]-dim(ramp_dem_employ_raw_id)[1]
}
```

## Read in NBR employment data
```{r Read in data NBR employment}
if(NBR == TRUE){
nbr_dem_employ_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/employ_coping_nbr.rds"))
dim(nbr_dem_employ_raw)
colnames(nbr_dem_employ_raw)

}
```

Select variables NBR employment
```{r Select variables NBR employment}
if(NBR == TRUE){
nbr_dem_employ_raw_id <- nbr_dem_employ_raw%>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% # Remove duplicates based on ID
  add_column(sample = "NBR", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         sample, # Sample
         #startDate_baseline = startDate,
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr_dem_employ_raw_id)
# Inspect colnames
colnames(nbr_dem_employ_raw_id)
#Differences
dim(nbr_dem_employ_raw)[1]-dim(nbr_dem_employ_raw_id)[1]
}
```

## Read in EDGI COPING employment data
```{r Read in data EDGI COPING employment}
if(EDGI == TRUE){
edgi_coping_employment_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/employ_coping_edgi.rds"))
dim(edgi_coping_employment_raw)
colnames(edgi_coping_employment_raw)

}
```

Select variables
```{r Select variables EDGI employment}
if(EDGI == TRUE){
edgi_coping_employment_id <- edgi_coping_employment_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi_coping_employment_id)
# Inspect colnames
colnames(edgi_coping_employment_id)
#Differences
dim(edgi_coping_employment_raw)[1]-dim(edgi_coping_employment_id)[1]

}
```

## Read in GLAD COPING employment data
```{r Read in data GLAD employment}
if(GLAD == TRUE){
glad_coping_employment_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/employ_coping_glad.rds"))
dim(glad_coping_employment_raw)
colnames(glad_coping_employment_raw)
}
```

Select variables
```{r Select variables GLAD employment}
if(GLAD == TRUE){
glad_coping_employment_id <- glad_coping_employment_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "GLAD", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad_coping_employment_id)
# Inspect colnames
colnames(glad_coping_employment_id)
#Differences
dim(glad_coping_employment_raw)[1]-dim(glad_coping_employment_id)[1]
}
```

### Run employment cleaning source script
Employment and key worker source script
```{r employment and key worker source script}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./employment_key_worker.R")
}
```

# Mental health diagnosis
```{r read in mental health diagnosis cleaned data}
if(EDGI == TRUE){
# EDGI
mhd_dat_id <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "edgi/clinical/mhd_edgi_clean.rds"))
dim(mhd_dat_id)
colnames(mhd_dat_id)
}

if(GLAD == TRUE){
# GLAD
mhd_dat_glad <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "glad/clinical/mhd_glad_clean.rds"))
dim(mhd_dat_glad)
colnames(mhd_dat_glad)

# GLAD COPING 
mhd_dat_glad_coping  <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_glad/clinical/mhd_coping_glad_clean.rds"))
dim(mhd_dat_glad_coping)
colnames(mhd_dat_glad_coping)

# Merge
mhd_dat_id <- dplyr::full_join(mhd_dat_glad,
                               mhd_dat_glad_coping,
                               by = c("ID",
                                      "sample"
                                      )
                               )
}

if(NBR == TRUE){
# NBR
mhd_dat_id <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_nbr/clinical/mhd_coping_nbr_clean.rds"))
dim(mhd_dat_id)
colnames(mhd_dat_id)


  
}

if(RAMP == TRUE){
mhd_dat_id <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "ramp/clinical/mhd_ramp_clean.rds"))
dim(mhd_dat_id)
colnames(mhd_dat_id)
}
```

### GLAD ED100K self-reported diagnosis
```{r read in GLAD ED100K self reported diagnosis}
if(GLAD == TRUE){
glad_ed100k_selfreport <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "glad/eating/selfreported_ed100k_diagnoses_glad_clean.rds"))
dim(glad_ed100k_selfreport)
colnames(glad_ed100k_selfreport)
}
```

### Algorithms
```{r read in algorithms for each dataset}
# Eating disorders (NB: not in RAMP or EDGI COPING)

## GLAD & COPING GLAD 
if(GLAD == TRUE){
ed_algorithms_coping_glad <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_glad/algorithms/ed_algorithms_diagnostics_coping_glad_clean.rds"))
dim(ed_algorithms_coping_glad)
colnames(ed_algorithms_coping_glad)

ed_algorithms_glad_signup <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "glad/algorithms/ed_algorithms_diagnostics_glad_clean.rds"))
dim(ed_algorithms_glad_signup)
colnames(ed_algorithms_glad_signup)

# Merge GLAD and GLAD COPING
ed_algorithms_glad <- dplyr::full_join(ed_algorithms_coping_glad,
                               ed_algorithms_glad_signup,
                               by = c("ID",
                                      "sample"
                                      )
                               )
}

## NBR 
if(NBR == TRUE){
ed_algorithms_nbr <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "coping_nbr/algorithms/ed_algorithms_diagnostics_coping_nbr_clean.rds"))
dim(ed_algorithms_nbr)
colnames(ed_algorithms_nbr) 
} 

if(EDGI == TRUE){
## EDGI
ed_algorithms_edgi <- readRDS(file = paste0(filepath_cleaned_latest_freeze, "edgi/algorithms/ed_algorithms_diagnostics_edgi_clean.rds"))
dim(ed_algorithms_edgi)
colnames(ed_algorithms_edgi)
}
```

### Run mental health diagnosis cleaning source script
```{r mental health diagnosis source script}
if(NBR == TRUE | EDGI == TRUE | GLAD == TRUE | RAMP == TRUE) {
source("./mental_health_diagnosis.R")
}
```

# Demographics - Living situation & vulnerable member
## GLAD 
### Read in data
```{r Read in data GLAD COPING living situation}
if(GLAD == TRUE){
glad_living_situation_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/dem2_coping_glad.rds"))
dim(glad_living_situation_raw)
colnames(glad_living_situation_raw)
}
```

Select variables GLAD COPING living situation
```{r Select variables GLAD COPING living situation}
if(GLAD == TRUE){
glad_living_situation_id <- glad_living_situation_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "GLAD", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         sample, # Sample
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad_living_situation_id)
# Inspect colnames
colnames(glad_living_situation_id)
#Differences
dim(glad_living_situation_raw)[1]-dim(glad_living_situation_id)[1]
}
```

# Demographics - Living situation & vulnerable member
## EDGI 
### Read in data
```{r Read in data EDGI COPING living situation}
if(EDGI == TRUE){
edgi_living_situation_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/dem2_coping_edgi.rds"))
dim(edgi_living_situation_raw)
colnames(edgi_living_situation_raw)
}
```

Select variables EDGI COPING living situation
```{r Select variables EDGI COPING living situation}
if(EDGI == TRUE){
edgi_living_situation_id <- edgi_living_situation_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         sample, # Sample
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi_living_situation_id)
# Inspect colnames
colnames(edgi_living_situation_id)
#Differences
dim(edgi_living_situation_raw)[1]-dim(edgi_living_situation_id)[1]
}
```

# Demographics- Living situation & vulnerable member
## NBR 
### Read in data
```{r Read in data NBR living situation}
if(NBR == TRUE){
nbr_living_situation_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/dem_coping_nbr.rds"))
dim(nbr_living_situation_raw)
colnames(nbr_living_situation_raw)
}
```

Select variables
```{r Select variables NBR living situation}
if(NBR == TRUE){
nbr_living_situation_id <- nbr_living_situation_raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% # Remove duplicates based on ID
  add_column(sample = "NBR", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid,# ID
         sample, # Sample
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr_living_situation_id)
# Inspect colnames
colnames(nbr_living_situation_id)
#Differences
dim(nbr_living_situation_raw)[1]-dim(nbr_living_situation_id)[1]
}
```

# Demographics - Living situation & vulnerable member
## RAMP
### Read in data
```{r Read in data RAMP living situation}
if(RAMP == TRUE){
ramp_living_situation_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/dem_ramp.rds"))
dim(ramp_living_situation_raw)
colnames(ramp_living_situation_raw)
}
```

Select variables
```{r Select variables RAMP living situation}
if(RAMP == TRUE){
ramp_living_situation_id <- ramp_living_situation_raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  remove_duplicates("Login ID") %>% # Remove duplicates based on ID
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column
  select(
         ID = `Login ID`,# ID
         sample, # Sample
         startDate_baseline = startDate,
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
# Inspect dimensions
dim(ramp_living_situation_id)
# Inspect colnames
colnames(ramp_living_situation_id)
#Differences
dim(ramp_living_situation_raw)[1]-dim(ramp_living_situation_id)[1]
}
```

# Pandemic worry at baseline
## EDGI
### Read in data 
```{r Read in data EDGI baseline pandemic worry}
if(EDGI == TRUE){
edgi_pan_worry <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/panworry_coping_edgi.rds"))
dim(edgi_pan_worry)
colnames(edgi_pan_worry)
}
```

Select variables EDGI baseline pandemic worry
```{r Select variables EDGI baseline pandemic worry}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                      "sample")

edgi_pan_worry.id <- edgi_pan_worry %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "EDGI", .before = "panworry.impact_on_your_employment_status") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample,
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi_pan_worry.id)
# Inspect colnames
colnames(edgi_pan_worry.id)
#Differences
dim(edgi_pan_worry)[1]-dim(edgi_pan_worry.id)[1]
}
```

# Pandemic worry at baseline
## GLAD
### Read in data 
```{r Read in data GLAD baseline pandemic worry}
if(GLAD == TRUE){
glad_pan_worry <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/panworry_coping_glad.rds"))
dim(glad_pan_worry)
colnames(glad_pan_worry)
}
```

Select variables GLAD baseline pandemic worry
```{r Select variables GLAD baseline pandemic worry}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                      "sample")

glad_pan_worry.id <- glad_pan_worry %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "GLAD", .before = "panworry.impact_on_your_employment_status") %>% #create new column
  select(
         ID = externalDataReference, # ID
         sample,
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad_pan_worry.id)
# Inspect colnames
colnames(glad_pan_worry.id)
#Differences
dim(glad_pan_worry)[1]-dim(glad_pan_worry.id)[1]
}
```

# Pandemic worry at baseline
## NBR
### Read in data 
```{r Read in data NBR baseline pandemic worry}
if(NBR == TRUE){
nbr_pan_worry <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/panworry_coping_nbr.rds"))
dim(nbr_pan_worry)
colnames(nbr_pan_worry)
}
```

Select variables NBR baseline pandemic worry
```{r Select variables NBR baseline pandemic worry}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                      "sample")

nbr_pan_worry.id <- nbr_pan_worry %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% # Remove duplicates based on ID
  add_column(sample = "NBR", .before = "panworry.impact_on_your_employment_status") %>% #create new column
  select(
     ID = subjectid, # ID
     sample,
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr_pan_worry.id)
# Inspect colnames
colnames(nbr_pan_worry.id)
#Differences
dim(nbr_pan_worry)[1]-dim(nbr_pan_worry.id)[1]
}
```

# Pandemic worry at baseline
## RAMP
### Read in data 
```{r Read in data RAMP baseline pandemic worry}
if(RAMP == TRUE){
ramp_pan_worry <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/panworry_ramp.rds"))
dim(ramp_pan_worry)
colnames(ramp_pan_worry)
}
```

Select variables
```{r Select variables RAMP baseline pandemic worry}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                      "sample")

ramp_pan_worry.id <- ramp_pan_worry %>% #new dataset with ID
  drop_na("Login ID") %>% # Drop NAs
  remove_duplicates("Login ID") %>% # Remove duplicates based on ID
  add_column(sample = "RAMP", .before = "panworry.impact_on_your_employment_status") %>% #create new column
  select(
         ID = `Login ID`, # ID
         sample,
         everything()
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(ramp_pan_worry.id)
# Inspect colnames
colnames(ramp_pan_worry.id)
#Differences
dim(ramp_pan_worry)[1]-dim(ramp_pan_worry.id)[1]
}
```

# Read in EDEQ baseline data (although note that is only present in RAMP)
## RAMP 
### Read in data
```{r Read in data RAMP EDEQ screener baseline}
if(RAMP == TRUE){
edeq_ramp_screener_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/ed_scid5_ramp.rds"))
dim(edeq_ramp_screener_baseline_raw)
colnames(edeq_ramp_screener_baseline_raw)
}
```

Select variables RAMP EDEQ baseline
```{r Select variables RAMP EDEQ screener baseline}
if(RAMP == TRUE){
edeq_ramp_screener_baseline_raw_id <- edeq_ramp_screener_baseline_raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  remove_duplicates("Login ID") %>% # Remove duplicates based on ID
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
         startDate_baseline = startDate,
         #endDate,
         ed_scid5.weigh_weighed_past_month_.Wavebaseline = ed_scid5.weigh_weighed_past_month,
         ed_scid5.regular_episodes_eating_binges_.Wavebaseline = ed_scid5.regular_episodes_eating_binges,
  ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% #
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) 

# Inspect dimensions
dim(edeq_ramp_screener_baseline_raw_id)
# Inspect colnames
colnames(edeq_ramp_screener_baseline_raw_id)
#Differences
dim(edeq_ramp_screener_baseline_raw)[1]-dim(edeq_ramp_screener_baseline_raw_id)[1]
}
```

```{r Read in data RAMP EDEQ baseline}
if(RAMP == TRUE){
edeq_ramp_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/edeq_ramp.rds"))
dim(edeq_ramp_baseline_raw)
colnames(edeq_ramp_baseline_raw)
}
```

Select variables RAMP EDEQ baseline
```{r Select variables RAMP EDEQ baseline}
if(RAMP == TRUE){
edeq_ramp_baseline_id <- edeq_ramp_baseline_raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  remove_duplicates("Login ID") %>% # Remove duplicates based on ID
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
         startDate_baseline = startDate,
         #endDate,
         edeq.deliberately_limit_amount_influence_.Wavebaseline = edeq.deliberately_limit_amount_influence,
         edeq.calories_made_body_shape_.Wavebaseline = edeq.calories_made_body_shape,
         edeq.weight_influenced_person_.Wavebaseline = edeq.weight_influenced_person,
         edeq.dissatisfied_shape_weight_.Wavebaseline = edeq.dissatisfied_shape_weight,
         edeq.nibbled_picked_snacks_grazed_.Wavebaseline = edeq.nibbled_picked_snacks_grazed,
         edeq.felt_anxious_blue_bored_.Wavebaseline = edeq.felt_anxious_blue_bored,
         edeq.felt_anxious_blue_bored.1_.Wavebaseline = edeq.felt_anxious_blue_bored.1,
         edeq.eating_behaviours_concerns_distressed_.Wavebaseline = edeq.eating_behaviours_concerns_distressed,
         edeq.deliberately_limit_amount_influence.1_.Wavebaseline = edeq.deliberately_limit_amount_influence.1,
         edeq.calories_made_body_shape.1_.Wavebaseline = edeq.calories_made_body_shape.1,
         edeq.weight_influenced_person.1_.Wavebaseline = edeq.weight_influenced_person.1,
         edeq.dissatisfied_shape_weight.1_.Wavebaseline = edeq.dissatisfied_shape_weight.1,
         edeq.eating_behaviours_concerns_distressed.1_.Wavebaseline = edeq.eating_behaviours_concerns_distressed.1,
         edeq.feelings_pandemic_felt_.Wavebaseline = edeq.feelings_pandemic_felt,
         edeq.actively_been_monitoring_your_shape_or_weight_.Wavebaseline = edeq.actively_been_monitoring_your_shape_or_weight_,
         edeq.regard_lost_control_eaten_.Wavebaseline = edeq.regard_lost_control_eaten,
         edeq.sick_means_made_shape_.Wavebaseline = edeq.sick_means_made_shape,
         edeq.diuretics_laxatives_means_shape_.Wavebaseline = edeq.laxatives_diuretics_means_shape,
         edeq.compulsive_driven_burn_calories_.Wavebaseline = edeq.burn_calories_exercised_fat,
         edeq.nibbled_picked_snacks_grazed.1_.Wavebaseline = edeq.nibbled_picked_snacks_grazed.1,
         edeq.felt_anxious_blue_bored.2_.Wavebaseline = edeq.felt_anxious_blue_bored.2,
         edeq.felt_anxious_blue_bored.3_.Wavebaseline = edeq.felt_anxious_blue_bored.3,
         edeq.actively_been_monitoring_your_shape_or_weight_.1_.Wavebaseline = edeq.actively_been_monitoring_your_shape_or_weight_.1,
         edeq.regard_lost_control_eaten.1_.Wavebaseline = edeq.regard_lost_control_eaten.1,
         edeq.sick_means_made_shape.1_.Wavebaseline = edeq.sick_means_made_shape.1,
         edeq.diuretics_laxatives_means_shape.1_.Wavebaseline = edeq.laxatives_diuretics_means_shape.1,
         edeq.compulsive_driven_burn_calories.1_.Wavebaseline = edeq.burn_calories_exercised_fat.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  #mutate_if(is.numeric, ~na_if(., -99)) %>%
  #mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 # mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  #mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  #mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
 # mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edeq_ramp_baseline_id)
# Inspect colnames
colnames(edeq_ramp_baseline_id)
#Differences
dim(edeq_ramp_baseline_raw)[1]-dim(edeq_ramp_baseline_id)[1]
}
```

# EDEQ screener follow up B
## COPING
### Read in data
NB: The EDEQ screener is only available in follow up B across both RAMP and COPING.
```{r Read in data COPING follow up B EDEQ screener}
if(COPING == TRUE){
edeq.coping.followupb.screener.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupb/ed_scid5_coping_followupb.rds"))
dim(edeq.coping.followupb.screener.raw)
colnames(edeq.coping.followupb.screener.raw)
}
```

Select variables COPING follow up B EDEQ screener
```{r Select variables COPING follow up B EDEQ screener}
if(COPING == TRUE){
  exclude_cols_dem <- c("ID",
                      "sample")
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         ed_scid5.regular_episodes_eating_binges,
         ed_scid5.weigh_weighed_past_month
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(edeq.coping.followupb.screener.raw.id)
# Inspect colnames
colnames(edeq.coping.followupb.screener.raw.id)
#Differences
dim(edeq.coping.followupb.screener.raw)[1]-dim(edeq.coping.followupb.screener.raw.id)[1]
}
```

# EDEQ screener follow up B
## RAMP
### Read in data
```{r Read in data RAMP follow up B EDEQ screener}
if(RAMP == TRUE){
edeq.ramp.followupb.screener.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupb/ed_scid5_ramp_followupb.rds"))
dim(edeq.ramp.followupb.screener.raw)
colnames(edeq.ramp.followupb.screener.raw)
}
```

Select variables RAMP follow up B EDEQ screener
```{r Select variables RAMP follow up B EDEQ screener}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         ed_scid5.regular_episodes_eating_binges,
         ed_scid5.weigh_weighed_past_month
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
  
# Inspect dimensions
dim(edeq.ramp.followupb.screener.raw.id)
# Inspect colnames
colnames(edeq.ramp.followupb.screener.raw.id)
#Differences
dim(edeq.ramp.followupb.screener.raw)[1]-dim(edeq.ramp.followupb.screener.raw.id)[1]
}
```

There are data on whether people have taken a COVID test and what result they have received in two datasets: "Virus" and "Resp", as well as data on whether they have been previously ill with the coronavirus from the "demographics" questionnaire. "Virus" questionnaire is asked only at follow up B. The "resp" questionnaire is asked at baseline and every single follow up. I will use all to find whether someone has been ill with COVID.

# Virus follow up B
## COPING
### Read in data
```{r Read in data COPING follow up B virus}
if(COPING == TRUE){
coping.followupb.virus <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupb/virus_coping_followupb.rds"))
dim(coping.followupb.virus)
colnames(coping.followupb.virus)
}
```

Select variables COPING follow up B virus
```{r Select variables COPING follow up B virus}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

coping.followupb.virus.id <- coping.followupb.virus %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         virus.back_positive_antibodies_tests, 
         virus.past_surveys_include_covid19 
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(coping.followupb.virus.id)
# Inspect colnames
colnames(coping.followupb.virus.id)
#Differences
dim(coping.followupb.virus)[1]-dim(coping.followupb.virus.id)[1]
}
```

# Virus follow up B
## RAMP
### Read in data
```{r Read in data RAMP follow up B virus}
if(RAMP == TRUE){
ramp.followupb.virus <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupb/virus_ramp_followupb.rds"))
dim(ramp.followupb.virus)
colnames(ramp.followupb.virus)
}
```

Select variables RAMP follow up B virus
```{r Select variables RAMP follow up B virus}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

ramp.followupb.virus.id <- ramp.followupb.virus %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         virus.back_positive_antibodies_tests,
         virus.past_surveys_include_covid19
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(ramp.followupb.virus.id)
# Inspect colnames
colnames(ramp.followupb.virus.id)
#Differences
dim(ramp.followupb.virus.id)[1]-dim(ramp.followupb.virus.id)[1]
}
```

# Resp baseline
## GLAD
### Read in data
```{r Read in data GLAD baseline resp}
if(GLAD == TRUE){
glad_baseline_resp_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/resp_coping_glad.rds"))
dim(glad_baseline_resp_raw)
colnames(glad_baseline_resp_raw)
}
```

Select variables GLAD baseline resp
```{r Select variables GLAD baseline resp}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_baseline",
                  "endDate")

glad_baseline_resp_id <- glad_baseline_resp_raw %>% #new dataset with ID
  remove_duplicates("externalDataReference") %>%
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "GLAD", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_baseline = startDate,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
   mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(glad_baseline_resp_id)
# Inspect colnames
colnames(glad_baseline_resp_id)
#Differences
dim(glad_baseline_resp_raw)[1]-dim(glad_baseline_resp_id)[1]
}
```

# Resp baseline
## EDGI
### Read in data
```{r Read in data EDGI baseline resp}
if(EDGI == TRUE){
edgi_baseline_resp_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/resp_coping_edgi.rds"))
dim(edgi_baseline_resp_raw)
colnames(edgi_baseline_resp_raw)
}

```

Select variables EDGI baseline resp
```{r Select variables EDGI baseline resp}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_baseline",
                  "endDate")

edgi_baseline_resp_id <- edgi_baseline_resp_raw %>% #new dataset with ID
    remove_duplicates("externalDataReference") %>%
  drop_na(externalDataReference) %>% # Drop NAs
   add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_baseline = startDate,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
   mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(edgi_baseline_resp_id)
# Inspect colnames
colnames(edgi_baseline_resp_id)
#Differences
dim(edgi_baseline_resp_raw)[1]-dim(edgi_baseline_resp_id)[1]
}
```

# Resp baseline
## NBR
### Read in data
```{r Read in data NBR baseline resp}
if(NBR == TRUE){
nbr_baseline_resp_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/resp_coping_nbr.rds"))
dim(nbr_baseline_resp_raw)
colnames(nbr_baseline_resp_raw)
}
```

Select variables NBR baseline resp
```{r Select variables NBR baseline resp}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_baseline",
                  "endDate")

nbr_baseline_resp_id <- nbr_baseline_resp_raw %>% #new dataset with ID
  remove_duplicates("subjectid") %>%
  drop_na(subjectid) %>% # Drop NAs
  add_column(sample = "NBR", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         sample, # Sample
         startDate_baseline = startDate,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
   mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(nbr_baseline_resp_id)
# Inspect colnames
colnames(nbr_baseline_resp_id)
#Differences
dim(nbr_baseline_resp_raw)[1]-dim(nbr_baseline_resp_id)[1]
}
```

# Resp baseline
## RAMP
### Read in data
NB: In the RAMP baseline, participants are asked whether they've had tests in the last week, rather than ever as in GLAD, NBR, and EDGI.
```{r Read in data RAMP baseline resp}
if(RAMP == TRUE){
ramp_baseline_resp_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/resp_ramp.rds"))
dim(ramp_baseline_resp_raw)
colnames(ramp_baseline_resp_raw)
}
```

Select variables RAMP baseline resp
```{r Select variables RAMP baseline resp}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_baseline",
                  "endDate")

ramp_baseline_resp_id <- ramp_baseline_resp_raw %>% #new dataset with ID
  remove_duplicates("Login ID") %>%
  drop_na(`Login ID`) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
         startDate_baseline = startDate,
         resp.coronavirus_test_nosethroat_swab = resp.coronavirus_test_week_nosethroat,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test = resp.coronavirus_week_antibody_test,
         resp.results_antibody_test
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(ramp_baseline_resp_id)
# Inspect colnames
colnames(ramp_baseline_resp_id)
#Differences
dim(ramp_baseline_resp_raw)[1]-dim(ramp_baseline_resp_id)[1]
}
```

# Resp follow up A
## COPING 1
### Read in data
```{r Read in data COPING follow up A resp}
if(COPING == TRUE){
coping.followupa1.resp <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupa/resp_coping_followupa.rds"))
dim(coping.followupa1.resp)
colnames(coping.followupa1.resp)
}
```

Select variables COPING follow up A resp
```{r Select variables COPING follow up A resp}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

coping.followupa1.resp.id <- coping.followupa1.resp %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
   add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         resp.coronavirus_test_nosethroat_swab = resp.test_coronavirus_week_nosethroat,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test = resp.coronavirus_week_antibody_test,
         resp.results_antibody_test
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
   mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(coping.followupa1.resp.id)
# Inspect colnames
colnames(coping.followupa1.resp.id)
#Differences
dim(coping.followupa1.resp)[1]-dim(coping.followupa1.resp.id)[1]
}
```

# Resp follow up A
## COPING 2 ongoing
### Read in data
```{r Read in data COPING follow up A ongoing resp}
if(COPING == TRUE){
coping.followupa2.resp <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupa_ongoing/resp_coping_followupa_ongoing.rds"))
dim(coping.followupa2.resp)
colnames(coping.followupa2.resp)
}
```

Select variables COPING follow up A ongoing resp
```{r Select variables COPING follow up A ongoing resp}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

coping.followupa2.resp.id <- coping.followupa2.resp %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         resp.coronavirus_test_nosethroat_swab = resp.test_coronavirus_week_nosethroat,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test = resp.coronavirus_week_antibody_test,
         resp.results_antibody_test
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(coping.followupa2.resp.id)
# Inspect colnames
colnames(coping.followupa2.resp.id)
#Differences
dim(coping.followupa2.resp)[1]-dim(coping.followupa2.resp.id)[1]
}
```

Combine resp COPING follow up A datasets 
```{r Combine COPING follow up A resp datasets}
if(COPING == TRUE){
    coping.followupa.resp.id <- rbind(coping.followupa1.resp.id,
                                      coping.followupa2.resp.id) 
    # **Note that some people may be in both datasets, i.e. answered the questionnaire using the original link during the time period that is considered the start of the 'ongoing' dataset, before realising and answering through the correct link. Example - questionnaires answered on the 29th July are present in both datasets. This is fine - as long as it's different people. Will need to filter by duplicate ID and duplicate wave once wave variable is created.
  
# Inspect dimensions
  dim(coping.followupa.resp.id)
# Inspect colnames
  colnames(coping.followupa.resp.id)
}
```

# Resp follow up B
## COPING 
### Read in data
```{r Read in data COPING follow up B resp}
if(COPING == TRUE){
coping.followupb.resp <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupb/resp_coping_followupb.rds"))
dim(coping.followupb.resp)
colnames(coping.followupb.resp)
}
```

Select variables COPING follow up B resp
```{r Select variables COPING follow up B resp}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

coping.followupb.resp.id <- coping.followupb.resp %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         resp.coronavirus_test_nosethroat_swab = resp.coronavirus_test_week_nosethroat,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test = resp.antibody_test_coronavirus_week,
         resp.results_antibody_test = resp.antibody_test_results
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(coping.followupb.resp.id)
# Inspect colnames
colnames(coping.followupb.resp.id)
#Differences
dim(coping.followupb.resp)[1]-dim(coping.followupb.resp.id)[1]
}
```

# Resp follow up A
## RAMP 
### Read in data
```{r Read in data RAMP follow up A resp}
if(RAMP == TRUE){
ramp.followupa.resp <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupa/resp_ramp_followupa.rds"))
dim(ramp.followupa.resp)
colnames(ramp.followupa.resp)
}
```

Select variables RAMP follow up A resp
```{r Select variables RAMP follow up A resp}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

ramp.followupa.resp.id <- ramp.followupa.resp %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         resp.coronavirus_test_nosethroat_swab = resp.test_coronavirus_weeks_nosethroat,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test = resp.coronavirus_weeks_antibody_test,
         resp.results_antibody_test
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
   mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(ramp.followupa.resp.id)
# Inspect colnames
colnames(ramp.followupa.resp.id)
#Differences
dim(ramp.followupa.resp)[1]-dim(ramp.followupa.resp.id)[1]
}
```

# Resp follow up B
## RAMP 
### Read in data
```{r Read in data RAMP follow up B resp}
if(RAMP == TRUE){
ramp.followupb.resp <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupb/resp_ramp_followupb.rds"))
dim(ramp.followupb.resp)
colnames(ramp.followupb.resp)
}
```

Select variables RAMP follow up B resp
```{r Select variables RAMP follow up B resp}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

ramp.followupb.resp.id <- ramp.followupb.resp %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         resp.coronavirus_test_nosethroat_swab = resp.coronavirus_test_weeks_nosethroat,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test = resp.antibody_test_coronavirus_weeks,
         resp.results_antibody_test = resp.antibody_test_results
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(ramp.followupb.resp.id)
# Inspect colnames
colnames(ramp.followupb.resp.id)
#Differences
dim(ramp.followupb.resp)[1]-dim(ramp.followupb.resp.id)[1]
}
```

# TAF - baseline (Thoughts & Feelings questionnaires from UKB that contains questions about self-harm thoughts & behaviours)
## GLAD 
### Read in data
```{r Read in data GLAD TAF baseline}
if(GLAD == TRUE){
taf_glad_coping_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/taf_coping_glad.rds"))
dim(taf_glad_coping_baseline_raw)
colnames(taf_glad_coping_baseline_raw)
}

```

Select variables GLAD TAF baseline
```{r Select variables GLAD TAF baseline}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate",
                  "endDate")

taf_glad_coping_baseline_id <- taf_glad_coping_baseline_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "GLAD", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_life_thoughts, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(taf_glad_coping_baseline_id)
# Inspect colnames
colnames(taf_glad_coping_baseline_id)
#Differences
dim(taf_glad_coping_baseline_raw)[1]-dim(taf_glad_coping_baseline_id)[1]
}
```

# TAF - baseline
## EDGI  
### Read in data
```{r Read in data EDGI TAF baseline}
if(EDGI == TRUE){
taf_edgi_coping_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/taf_coping_edgi.rds"))
dim(taf_edgi_coping_baseline_raw)
colnames(taf_edgi_coping_baseline_raw)
}
```

Select variables - EDGI TAF baseline
```{r Select variables EDGI TAF baseline}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate",
                  "endDate")


taf_edgi_coping_baseline_id <- taf_edgi_coping_baseline_raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.weeks_past_felt,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.weeks_past_felt.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_weeks_life, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_life_pandemic
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels

# Inspect dimensions
dim(taf_edgi_coping_baseline_id)
# Inspect colnames
colnames(taf_edgi_coping_baseline_id)
#Differences
dim(taf_edgi_coping_baseline_raw)[1]-dim(taf_edgi_coping_baseline_id)[1]
}
```

# TAF - baseline 
## NBR 
### Read in data
```{r Read in data NBR TAF baseline}
if(NBR == TRUE){
taf_nbr_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/taf_coping_nbr.rds"))
dim(taf_nbr_baseline_raw)
colnames(taf_nbr_baseline_raw)
}
```

Select variables NBR TAF baseline
```{r Select variables NBR TAF baseline}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate",
                  "endDate")

taf_nbr_baseline_id <- taf_nbr_baseline_raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% # Remove duplicates based on ID
  add_column(sample = "NBR", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         sample, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(taf_nbr_baseline_id)
# Inspect colnames
colnames(taf_nbr_baseline_id)
#Differences
dim(taf_nbr_baseline_raw)[1]-dim(taf_nbr_baseline_id)[1]
}
```

# TAF - baseline 
## RAMP
### Read in data
```{r Read in data RAMP TAF baseline}
if(RAMP == TRUE){
taf_ramp_baseline_raw <- readRDS(file =paste0(filepath_raw_latest_freeze, "ramp/taf_ramp.rds"))
dim(taf_ramp_baseline_raw)
colnames(taf_ramp_baseline_raw)
}
```

Select variables RAMP TAF baseline
```{r Select variables RAMP TAF baseline}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_baseline",
                  "endDate")

taf_ramp_baseline_id <- taf_ramp_baseline_raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  remove_duplicates("Login ID") %>% # Remove duplicates based on ID
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
         startDate_baseline = startDate,
         #endDate,
         taf.worth_living_life_people_.Wavebaseline = taf.worth_living_thoughts_life, #renamed to same as follow up
         taf.felt_weeks_past_.Wavebaseline = taf.past_felt_weeks,#renamed to same as follow up
         taf.pandemic_felt_.Wavebaseline = taf.pandemic_felt,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1_.Wavebaseline = taf.past_felt_weeks.1, #renamed to same as follow up
         taf.pandemic_felt.1_.Wavebaseline = taf.pandemic_felt.1,
         taf.meant_life_end_weeks_.Wavebaseline = taf.meant_end_life_weeks, #renamed to same as follow up
         taf.meant_end_life_pandemic_.Wavebaseline = taf.meant_end_pandemic_life #renamed to same as follow up
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(taf_ramp_baseline_id)
# Inspect colnames
colnames(taf_ramp_baseline_id)
#Differences
dim(taf_ramp_baseline_raw)[1]-dim(taf_ramp_baseline_id)[1]
}
```

# TAF - follow up A
## COPING (first 2 phases)
### Read in data
```{r Read in data COPING follow up A TAF first two phases}
if(COPING == TRUE){
taf.coping.followupa.raw.1 <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupa/taf_coping_followupa.rds"))
dim(taf.coping.followupa.raw.1)
colnames(taf.coping.followupa.raw.1)
}
```

Select variables COPING follow up A TAF first two phases
```{r Select variables COPING follow up A TAF first two phases}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

taf.coping.followupa.raw.id.1 <- taf.coping.followupa.raw.1 %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_felt,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(taf.coping.followupa.raw.id.1)
# Inspect colnames
colnames(taf.coping.followupa.raw.id.1)
#Differences
dim(taf.coping.followupa.raw.1)[1]-dim(taf.coping.followupa.raw.id.1)[1]
}
```

# TAF - follow up A
## COPING (subsequent phases)
### Read in data
```{r Read in data COPING follow up A TAF first subsequent phases}
if(COPING == TRUE){
taf.coping.followupa.raw.2 <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupa_ongoing/taf_coping_followupa_ongoing.rds"))
dim(taf.coping.followupa.raw.2)
colnames(taf.coping.followupa.raw.2)
}
```

Select variables COPING follow up A TAF first subsequent phases
```{r Select variables COPING follow up A TAF first subsequent phases}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

taf.coping.followupa.raw.id.2 <- taf.coping.followupa.raw.2 %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels

# Inspect dimensions
dim(taf.coping.followupa.raw.id.2)
# Inspect colnames
colnames(taf.coping.followupa.raw.id.2)
#Differences
dim(taf.coping.followupa.raw.2)[1]-dim(taf.coping.followupa.raw.id.2)[1]
}
```

Combine TAF COPING follow up A datasets 
```{r Combine COPING follow up A TAF datasets}
if(COPING == TRUE){
    taf.coping.followupa.raw.id <- rbind(taf.coping.followupa.raw.id.2, taf.coping.followupa.raw.id.1) # **Note that some people may be in both datasets, i.e. answered the questionnaire using the original link during the time period that is considered the start of the 'ongoing' dataset, before realising and answering through the correct link. Example - questionnaires answered on the 29th July are present in both datasets. This is fine - as long as it's different people. Will need to filter by duplicate ID and duplicate wave once wave variable is created.
  
# Inspect dimensions
  dim(taf.coping.followupa.raw.id)
# Inspect colnames
  colnames(taf.coping.followupa.raw.id)
}
```

# TAF - follow up b
## COPING
### Read in data
```{r Read in data COPING follow up B TAF}
if(COPING == TRUE){
taf.coping.followupb.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupb/taf_coping_followupb.rds"))
dim(taf.coping.followupb.raw)
colnames(taf.coping.followupb.raw)
}
```

Select variables COPING follow up B TAF
```{r Select variables COPING follow up B TAF}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

taf.coping.followupb.raw.id <- taf.coping.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
 add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_people,
         taf.felt_weeks_past = taf.weeks_past_felt, #renamed to same follow up a
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.weeks_past_felt.1, #renamed to same follow up a
         taf.meant_life_end_weeks = taf.deliberately_harmed_meant_end #renamed to same follow up a
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
   mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered"))  # Drop empty factor levels

# Inspect dimensions
dim(taf.coping.followupb.raw.id)
# Inspect colnames
colnames(taf.coping.followupb.raw.id)
#Differences
dim(taf.coping.followupb.raw)[1]-dim(taf.coping.followupb.raw.id)[1]
}
```

# TAF - follow up A
## RAMP
### Read in data
```{r Read in data RAMP follow up A TAF}
if(RAMP == TRUE){
taf.ramp.followupa.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupa/taf_ramp_followupa.rds"))
dim(taf.ramp.followupa.raw)
colnames(taf.ramp.followupa.raw)
}
```

Select variables RAMP follow up A TAF
```{r Select variables RAMP follow up A TAF}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

taf.ramp.followupa.raw.id <- taf.ramp.followupa.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people = taf.worth_living_life_felt,
         taf.felt_weeks_past = taf.felt_weeks_past,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.felt_weeks_past.1,
         taf.meant_life_end_weeks = taf.meant_life_end_weeks
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
   mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(taf.ramp.followupa.raw.id)
# Inspect colnames
colnames(taf.ramp.followupa.raw.id)
#Differences
dim(taf.ramp.followupa.raw)[1]-dim(taf.ramp.followupa.raw.id)[1]
}
```

# TAF - follow up B
## RAMP
### Read in data
```{r Read in data RAMP follow up B TAF}
if(RAMP == TRUE){
taf.ramp.followupb.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupb/taf_ramp_followupb.rds"))
dim(taf.ramp.followupb.raw)
colnames(taf.ramp.followupb.raw)
}
```

Select variables RAMP follow up B TAF
```{r Select variables RAMP follow up B TAF}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

taf.ramp.followupb.raw.id <- taf.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         taf.worth_living_life_people,
         taf.felt_weeks_past = taf.weeks_past_felt,
         taf.have_you_contemplated_harming_yourself = taf.have_you_contemplated_harming_yourself_,
         taf.felt_weeks_past.1 = taf.weeks_past_felt.1,
         taf.meant_life_end_weeks = taf.deliberately_harmed_meant_end
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(taf.ramp.followupb.raw.id)
# Inspect colnames
colnames(taf.ramp.followupb.raw.id)
#Differences
dim(taf.ramp.followupb.raw)[1]-dim(taf.ramp.followupb.raw.id)[1]
}
```

# Demographics follow up A
## RAMP
### Read in data 
```{r Read in data RAMP follow up A demographics}
if(RAMP == TRUE) {
dem.ramp.followupa.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupa/dem_ramp_followupa.rds"))
dim(dem.ramp.followupa.raw)
colnames(dem.ramp.followupa.raw)
}
```

Select variables RAMP follow up A demographics
```{r Select variables RAMP follow up A demographics}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

dem.ramp.followupa.raw.id <- dem.ramp.followupa.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         dem.nothing_has_changed,                                     
         dem.living_situation,
         dem.employment,
         dem.physical_health,
         dem.health_of_a_relative,
         dem.household_employment_status_key,
         dem.children__dependants_returning_to_school__other_education,
         dem.living_alone,
         dem.living_with_partner_or_spouse ,
         dem.living_with_housemates,
         dem.age_children_living,
         dem.age_children_living.1,
         dem.living_with_other_members_of_my_family,
         dem.spouse_partner_members_living = dem.members_living_partner_spouse,
         dem.staying_live,
         dem.staying_live.1,
         dem.prefer_not_to_say,
         dem.made_redundant,
         dem.became_unemployed = dem.become_unemployed,
         dem.reduction_in_hours,
         dem.reduction_in_salary,
         dem.benefits_increased,
         # dem.benefits_decreased,
         dem.change_in_duties_or_responsibilites = dem.change_in_duties_or_responsibilities,
         dem.became_employed,
         dem.increased_hours,
         dem.increased_salary,
         dem.furloughed_or_paid_leave_government_funded = dem.furloughed_or_paid_leave_,
         dem.furloughed_or_paid_leave_company_funded = dem.furloughed_or_paid_leave_.1,
         dem.paid_leave_furloughed = dem.paid_leave_furloughed,
         dem.paid_leave_returned_work,
         dem.retired,
         dem.unwell_coronavirus_weeks_physical,
         dem.coronavirus_relative_previously_ill.1,
         dem.coronavirus_relative_ill_suspected
        
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(dem.ramp.followupa.raw.id)
# Inspect colnames
colnames(dem.ramp.followupa.raw.id)
#Differences
dim(dem.ramp.followupa.raw.id)[1]-dim(dem.ramp.followupa.raw)[1]
}
```

# Demographics follow up B
## RAMP
### Read in data 
```{r Read in data RAMP follow up B demographics} 
if(RAMP == TRUE) {
dem.ramp.followupb.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupb/dem_ramp_followupb.rds"))
dim(dem.ramp.followupb.raw)
colnames(dem.ramp.followupb.raw)
}
```

Select variables RAMP follow up B demographics
```{r Select variables RAMP follow up B demographics}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

dem.ramp.followupb.raw.id <- dem.ramp.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         dem.nothing_has_changed,                                     
         dem.living_situation,
         dem.employment,
         dem.physical_health,
         dem.health_of_a_relative,
         dem.household_employment_status_key,
         dem.children__dependants_returning_to_school__other_education,
         dem.living_alone,
         dem.living_with_partner_or_spouse ,
         dem.living_with_housemates,
         dem.age_children_living,
         dem.age_children_living.1,
         dem.living_with_other_members_of_my_family,
         dem.spouse_partner_members_living = dem.members_living_partner_spouse,
         dem.staying_live,
         dem.staying_live.1,
         dem.prefer_not_to_say,
         dem.made_redundant,
         dem.became_unemployed = dem.become_unemployed,
         dem.reduction_in_hours,
         dem.reduction_in_salary,
         dem.benefits_increased,
         # dem.benefits_decreased, 
         dem.change_in_duties_or_responsibilites = dem.change_in_duties_or_responsibilities,
         dem.became_employed,
         dem.increased_hours,
         dem.increased_salary,
         dem.furloughed_or_paid_leave_government_funded = dem.furloughed_or_paid_leave_,
         dem.furloughed_or_paid_leave_company_funded = dem.furloughed_or_paid_leave_.1,
         dem.paid_leave_furloughed = dem.paid_leave_furloughed,
         dem.paid_leave_returned_work = dem.paid_leave_returned_furlough,
         dem.retired,
         dem.unwell_coronavirus_weeks_physical,
         dem.coronavirus_relative_previously_ill.1,
         dem.coronavirus_relative_ill_suspected
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(dem.ramp.followupb.raw.id)
# Inspect colnames
colnames(dem.ramp.followupb.raw.id)
#Differences
dim(dem.ramp.followupb.raw)[1]-dim(dem.ramp.followupb.raw.id)[1]
}
```

# Demographics follow up A first two phases
## COPING
### Read in data 
```{r Read in data COPING follow up A demographics first two phases}
if(COPING == TRUE) {
coping.dem.followupa.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupa/dem_coping_followupa.rds"))
dim(coping.dem.followupa.raw)
colnames(coping.dem.followupa.raw)
}
```

Select variables COPING follow up A demographics
```{r Select variables COPING follow up A demographics first two phases}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

coping.dem.followupa.raw.id.1 <- coping.dem.followupa.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
   add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         dem.nothing_has_changed,                                     
         dem.living_situation,
         dem.employment,
         dem.physical_health,
         dem.health_of_a_relative,
         dem.household_employment_status_key,
         dem.children__dependants_returning_to_school__other_education = dem.school_childrendependants_returning_education,
         dem.living_alone,
         dem.living_with_partner_or_spouse,
         dem.living_with_housemates,
         dem.age_children_living,
         dem.age_children_living.1,
         dem.living_with_other_members_of_my_family,
         dem.spouse_partner_members_living = dem.members_living_partner_spouse,
         dem.staying_live,
         dem.staying_live.1,
         dem.prefer_not_to_say,
         dem.made_redundant,
         dem.became_unemployed,
         dem.reduction_in_hours,
         dem.reduction_in_salary,
         dem.benefits_increased,
         dem.benefits_decreased,
         dem.change_in_duties_or_responsibilites,
         dem.became_employed,
         dem.increased_hours,
         dem.increased_salary,
         dem.furloughed_or_paid_leave_government_funded = dem.furloughed_or_paid_leave_,
         dem.furloughed_or_paid_leave_company_funded = dem.furloughed_or_paid_leave_.1,
         dem.paid_leave_furloughed = dem.paid_leave_furloughed,
         dem.paid_leave_returned_work,
         dem.retired,
         dem.unwell_coronavirus_weeks_physical,
         dem.coronavirus_relative_previously_ill.1,
         dem.coronavirus_relative_ill_suspected
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(coping.dem.followupa.raw.id.1)
# Inspect colnames
colnames(coping.dem.followupa.raw.id.1)
#Differences
dim(coping.dem.followupa.raw.id.1)[1]-dim(coping.dem.followupa.raw)[1]
}
```

# Demographics follow up A subsequent phases
## COPING
### Read in data 
```{r Read in data COPING follow up A demographics subsequent phases}
if(COPING == TRUE) {
coping.dem.followupa.ongoing.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupa_ongoing/dem_coping_followupa_ongoing.rds"))
dim(coping.dem.followupa.ongoing.raw)
colnames(coping.dem.followupa.ongoing.raw)
}
```

Select variables COPING follow up B demographics
```{r Select variables COPING follow up A demographics subsequent phases}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

coping.dem.followupa.ongoing.raw.id <- coping.dem.followupa.ongoing.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
 add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         dem.nothing_has_changed,                                     
         dem.living_situation,
         dem.employment,
         dem.physical_health,
         dem.health_of_a_relative,
         dem.household_employment_status_key,
         dem.children__dependants_returning_to_school__other_education = dem.school_childrendependants_returning_education,
         dem.living_alone,
         dem.living_with_partner_or_spouse,
         dem.living_with_housemates,
         dem.age_children_living,
         dem.age_children_living.1,
         dem.living_with_other_members_of_my_family,
         dem.spouse_partner_members_living = dem.members_living_partner_spouse,
         dem.staying_live,
         dem.staying_live.1,
         dem.prefer_not_to_say,
         dem.made_redundant,
         dem.became_unemployed,
         dem.reduction_in_hours,
         dem.reduction_in_salary,
         dem.benefits_increased,
         dem.benefits_decreased,
         dem.change_in_duties_or_responsibilites,
         dem.became_employed,
         dem.increased_hours,
         dem.increased_salary,
         dem.furloughed_or_paid_leave_government_funded = dem.furloughed_or_paid_leave_,
         dem.furloughed_or_paid_leave_company_funded = dem.furloughed_or_paid_leave_.1,
         dem.paid_leave_furloughed = dem.paid_leave_furloughed,
         dem.paid_leave_returned_work,
         dem.retired,
         dem.unwell_coronavirus_weeks_physical,
         dem.coronavirus_relative_previously_ill.1,
         dem.coronavirus_relative_ill_suspected
        
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
 mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(coping.dem.followupa.ongoing.raw.id)
# Inspect colnames
colnames(coping.dem.followupa.ongoing.raw.id)
#Differences
dim(coping.dem.followupa.ongoing.raw)[1]-dim(coping.dem.followupa.ongoing.raw.id)[1]
}
```

Combine demographics COPING follow up A datasets 
```{r Combine demographics COPING follow up A datasets}
if(COPING == TRUE){
    coping.dem.followupa.raw.id <- rbind(coping.dem.followupa.raw.id.1,
                                         coping.dem.followupa.ongoing.raw.id) 
# Inspect dimensions
  dim(coping.dem.followupa.raw.id)
# Inspect colnames
  colnames(coping.dem.followupa.raw.id)
}
```

# Demographics follow up B
## COPING
### Read in data 
```{r Read in data COPING follow up B demographics}
if(COPING == TRUE) {
coping.dem.followupb.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupb/dem_coping_followupb.rds"))
dim(coping.dem.followupb.raw)
colnames(coping.dem.followupb.raw)
}
```

Select variables COPING follow up B demographics
```{r Select variables COPING follow up B demographics}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")

coping.dem.followupb.raw.id <- coping.dem.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         dem.nothing_has_changed,                                     
         dem.living_situation,
         dem.employment,
         dem.physical_health,
         dem.health_of_a_relative,
         dem.household_employment_status_key,
         dem.children__dependants_returning_to_school__other_education =
         dem.school_childrendependants_returning_education,
         dem.living_alone,
         dem.living_with_partner_or_spouse,
         dem.living_with_housemates,
         dem.age_children_living,
         dem.age_children_living.1,
         dem.living_with_other_members_of_my_family,
         dem.spouse_partner_members_living = dem.members_living_partner_spouse,
         dem.staying_live,
         dem.staying_live.1,
         dem.prefer_not_to_say,
         dem.made_redundant,
         dem.became_unemployed,
         dem.reduction_in_hours,
         dem.reduction_in_salary,
         dem.benefits_increased,
         dem.benefits_decreased,
         dem.change_in_duties_or_responsibilites,
         dem.became_employed,
         dem.increased_hours,
         dem.increased_salary,
         dem.furloughed_or_paid_leave_government_funded = dem.furloughed_or_paid_leave_,
         dem.furloughed_or_paid_leave_company_funded = dem.furloughed_or_paid_leave_.1,
         dem.paid_leave_furloughed = dem.paid_leave_furloughed,
         dem.paid_leave_returned_work = dem.paid_leave_returned_furlough,
         dem.retired,
         dem.unwell_coronavirus_weeks_physical,
         dem.coronavirus_relative_previously_ill.1,
         dem.coronavirus_relative_ill_suspected
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels
 
# Inspect dimensions
dim(coping.dem.followupb.raw.id)
# Inspect colnames
colnames(coping.dem.followupb.raw.id)
#Differences
dim(coping.dem.followupb.raw)[1]-dim(coping.dem.followupb.raw.id)[1]
}
```

# Losing someone due to COVID 
## GLAD
### Read in data
```{r Read in data GLAD losing someone due to COVID}
if(GLAD == TRUE) {
glad_loss_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/grief_coping_glad.rds"))
dim(glad_loss_baseline_raw)
colnames(glad_loss_baseline_raw)
}
```

Select variables GLAD losing someone due to COVID
```{r Select variables GLAD losing someone due to COVID} 
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate"
                  )

glad_loss_baseline_id <- glad_loss_baseline_raw %>% #new dataset with ID
  remove_duplicates("externalDataReference") %>%
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "GLAD", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
       grief.covid_lost_due_close = grief.lost_due_close_past,
       grief.suffered_past_month_loss
       
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(glad_loss_baseline_id)
# Inspect colnames
colnames(glad_loss_baseline_id)
#Differences
dim(glad_loss_baseline_id)[1]-dim(glad_loss_baseline_raw)[1]
}
```

# Losing someone due to COVID 
## EDGI
### Read in data
```{r Read in dat EDGI losing someone due to COVID}
if(EDGI == TRUE) {
edgi_loss_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/grief_coping_edgi.rds"))
dim(edgi_loss_baseline_raw)
colnames(edgi_loss_baseline_raw)
}
```

Select variables
```{r Select variables EDGI losing someone due to COVID}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate")
edgi_loss_baseline_id <- edgi_loss_baseline_raw %>% #new dataset with ID
  remove_duplicates("externalDataReference") %>%
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
       grief.covid_lost_due_close = grief.due_lost_past_month,
       grief.suffered_past_month_loss = grief.significant_relationship_suffered_loss
       
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(edgi_loss_baseline_id)
# Inspect colnames
colnames(edgi_loss_baseline_id)
#Differences
dim(edgi_loss_baseline_id)[1]-dim(edgi_loss_baseline_raw)[1]
}
```

# Losing someone due to COVID 
## NBR
### Read in data
```{r Read in dat NBR losing someone due to COVID}
if(NBR == TRUE) {
nbr_loss_baseline_raw<- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/grief_coping_nbr.rds"))
dim(nbr_loss_baseline_raw)
colnames(nbr_loss_baseline_raw)
}
```

Select variables NBR losing someone due to COVID
```{r Select variables NBR losing someone due to COVID}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate")
nbr_loss_baseline_id <- nbr_loss_baseline_raw %>% #new dataset with ID
  remove_duplicates("subjectid") %>%
  drop_na(subjectid) %>% # Drop NAs
  add_column(sample = "NBR", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         sample, # Sample
       grief.covid_lost_due_close = grief.lost_due_close_past,
       grief.suffered_past_month_loss = grief.significant_relationship_suffered_past
       ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels


# Inspect dimensions
dim(nbr_loss_baseline_id)
# Inspect colnames
colnames(nbr_loss_baseline_id)
#Differences
dim(nbr_loss_baseline_id)[1]-dim(nbr_loss_baseline_raw)[1]
}
```

# Losing someone due to COVID 
## RAMP
### Read in data
```{r Read in data RAMP losing someone due to COVID}
if(RAMP == TRUE) {
ramp_loss_baseline_raw<- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/grief_ramp.rds"))
dim(ramp_loss_baseline_raw)
colnames(ramp_loss_baseline_raw)
}
```

Select variables RAMP losing someone due to COVID
```{r RAMP losing somone due to COVID baseline select variables}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate")
ramp_loss_baseline_id <- ramp_loss_baseline_raw %>% #new dataset with ID
    remove_duplicates("Login ID") %>%
  drop_na(`Login ID`) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
         grief.covid_lost_due_close = grief.lost_due_close_past,
         grief.suffered_past_month_loss = grief.significant_relationship_suffered_past
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(ramp_loss_baseline_id)
# Inspect colnames
colnames(ramp_loss_baseline_id)
#Differences
dim(ramp_loss_baseline_id)[1]-dim(ramp_loss_baseline_raw)[1]
}
```

# Losing someone due to COVID - follow up
## COPING 
### Read in data
```{r Read in data losing someone due to COVID COPING follow up}
if(COPING == TRUE) {
coping.loss.followupb.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_followupb/grief_coping_followupb.rds"))
dim(coping.loss.followupb.raw)
colnames(coping.loss.followupb.raw)
}
```

Select variables losing someone due to COVID COPING follow up
```{r Select variables losing someone due to COVID COPING follow up}
if(COPING == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")
coping.loss.followupb.raw.id <- coping.loss.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "COPING", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         grief.due_past_month_lost,
         grief.suffered_past_month_loss
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(coping.loss.followupb.raw.id)
# Inspect colnames
colnames(coping.loss.followupb.raw.id)
#Differences
dim(coping.loss.followupb.raw.id)[1]-dim(coping.loss.followupb.raw)[1]
}
```

# Losing someone due to COVID - follow up
## RAMP 
### Read in data
```{r Read in data losing someone due to RAMP COPING follow up}
if(RAMP == TRUE) {
ramp.loss.followupb.raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp_followupb/grief_ramp_followupb.rds"))
dim(ramp.loss.followupb.raw)
colnames(ramp.loss.followupb.raw)
}
```

Select variables losing someone due to RAMP COPING follow up
```{r Select variables losing someone due to RAMP COPING follow up}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "startDate_waves",
                  "endDate")
ramp.loss.followupb.raw.id <- ramp.loss.followupb.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
         startDate_waves = startDate,
         #endDate,
         grief.due_past_month_lost,
         grief.suffered_past_month_loss
        
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
 mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(ramp.loss.followupb.raw.id)
# Inspect colnames
colnames(ramp.loss.followupb.raw.id)
#Differences
dim(ramp.loss.followupb.raw.id)[1]-dim(ramp.loss.followupb.raw)[1]
}
```

# Loneliness at baseline
## GLAD
### Read in data
```{r Read in data GLAD loneliness at baseline}
if(GLAD == TRUE) {
glad_loneliness_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_glad/lone_coping_glad.rds"))
dim(glad_loneliness_baseline_raw)
colnames(glad_loneliness_baseline_raw)
}
```

Select variables GLAD loneliness at baseline
```{r Select variables GLAD loneliness at baseline}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate")

glad_loneliness_baseline_id <- glad_loneliness_baseline_raw %>% #new dataset with ID
  remove_duplicates("externalDataReference") %>%
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "GLAD", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
        lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,
        lone.similar_felt_pandemic = lone.similar_felt_pandemici_felt,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(glad_loneliness_baseline_id)
# Inspect colnames
colnames(glad_loneliness_baseline_id)
#Differences
dim(glad_loneliness_baseline_raw)[1]-dim(glad_loneliness_baseline_id)[1]
}
```

# Loneliness at baseline
## EDGI
### Read in data
```{r Read in data EDGI loneliness at baseline}
if(EDGI == TRUE) {
edgi_loneliness_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_edgi/lone_coping_edgi.rds"))
dim(edgi_loneliness_baseline_raw)
colnames(edgi_loneliness_baseline_raw)
}
```

Select variables EDGI loneliness at baseline
```{r Select variables EDGI loneliness at baseline}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate")
edgi_loneliness_baseline_id <- edgi_loneliness_baseline_raw %>% #new dataset with ID
  remove_duplicates("externalDataReference") %>%
  drop_na(externalDataReference) %>% # Drop NAs
  add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         sample, # Sample
        lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,
        lone.similar_felt_pandemic = lone.similar_felt_pandemici_felt,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(edgi_loneliness_baseline_id)
# Inspect colnames
colnames(edgi_loneliness_baseline_id)
#Differences
dim(edgi_loneliness_baseline_id)[1]-dim(edgi_loneliness_baseline_id)[1]
}
```

# Loneliness at baseline
## RAMP
### Read in data
```{r Read in data RAMP loneliness at baseline}
if(RAMP == TRUE) {
  ramp_loneliness_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "ramp/lone_ramp.rds"))
dim(ramp_loneliness_baseline_raw)
colnames(ramp_loneliness_baseline_raw)
}
```

Select variables RAMP loneliness at baseline
```{r Select variables RAMP loneliness at baseline}
if(RAMP == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate")
ramp_loneliness_baseline_id <- ramp_loneliness_baseline_raw %>% #new dataset with ID
  drop_na(`Login ID`) %>% # Drop NAs
  remove_duplicates("Login ID") %>%
  add_column(sample = "RAMP", .before = "startDate") %>% #create new column 
  select(
         ID = `Login ID`, # ID
         sample, # Sample
        lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,
        lone.similar_felt_pandemic = lone.similar_felt_pandemici_felt,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(ramp_loneliness_baseline_id)
# Inspect colnames
colnames(ramp_loneliness_baseline_id)
#Differences
dim(ramp_loneliness_baseline_id)[1]-dim(ramp_loneliness_baseline_raw)[1]
}
```

# Loneliness at baseline
## NBR
### Read in data
```{r Read in data NBR loneliness at baseline}
if(NBR == TRUE) {
nbr_loneliness_baseline_raw <- readRDS(file = paste0(filepath_raw_latest_freeze, "coping_nbr/lone_coping_nbr.rds"))
dim(nbr_loneliness_baseline_raw)
colnames(nbr_loneliness_baseline_raw)
}
  
```

Select variables NBR loneliness at baseline
```{r Select variables NBR loneliness at baseline}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "sample",
                  "endDate")
nbr_loneliness_baseline_id <- nbr_loneliness_baseline_raw %>% #new dataset with ID
  remove_duplicates("subjectid") %>%
  drop_na(subjectid) %>% # Drop NAs
  add_column(sample = "NBR", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         sample, # Sample
        lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,
        lone.similar_felt_pandemic = lone.similar_felt_pandemici_felt,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) # Drop empty factor levels

# Inspect dimensions
dim(nbr_loneliness_baseline_id)
# Inspect colnames
colnames(nbr_loneliness_baseline_id)
#Differences
dim(nbr_loneliness_baseline_raw)[1]-dim(nbr_loneliness_baseline_id)[1]
}
```

# *JOINING & SAVING DATASETS - baseline*
## Select same variables from each dataset
EDGI select variables from each dataset
```{r EDGI select variables for final dataset}
if(EDGI == TRUE) {

# Age
edgi.1 <- age_dat_edgi_coping %>% 
  select(ID,
  sample,
  age_numeric = dem.age_likely_cop,
  age_category = dem.age_category_cop
  )

# Gender
edgi.2 <- gender_sex_edgi_transgender_dat %>% 
  select(ID,
  sample,
  gender = dem.which_gender_do_you_identify_with_cop,
  sex = dem.sex_cop, 
  transgender = dem.do_you_identify_as_transgender # Need the version from EDGI sign-up as not asked in COPING baseline.
 )

# Join age and gender
edgi_A <- dplyr::full_join(edgi.1,
                           edgi.2,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Ethnicity
edgi.3 <- ethnicity_dat_edgi %>% 
  select(ID,
  sample,
  ethnicity = dem.what_is_your_ethnic_origin
  )

# Employment / key worker  
edgi.4 <- edgi_coping_employment_id %>% 
  select(ID,
  sample,
  key_worker,
  baseline_paid_employment,
  employ.my_employment_status_has_not_changed,
  employ.no_impact,
  employ.impact_on_studies_still_unknown
  )
  
# Join ethnciry and employment
edgi_B <- dplyr::full_join(edgi.3,
                           edgi.4,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Highest education
edgi.5 <- highest_education_edgi_coping %>%
  select(ID,
  sample,
  highest_education,
  highest_education_numeric
  )
  
# Thoughts and feelings (self-harm baseline)
edgi.6 <- taf_edgi_coping_baseline_id %>% 
  select(ID,
  sample,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
 
   # Retro pre-pan
  taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline
  )


# Join highest education & TAF
edgi_C <- dplyr::full_join(edgi.5,
                           edgi.6,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Mental health diagnosis
edgi.7 <- edgi_diagnostics %>%
  select(ID,
         sample,
         mental_health_diagnosis)


# Demographics (living situation, member vulnerable group, etc.)
edgi.8 <- edgi_living_situation_id %>%
  select(ID,
         sample,
         dem2.living_situation_change_pandemic,
         dem2.member_vulnerable_group
         )
  
# Join mhd & dem 
edgi_D <- dplyr::full_join(edgi.7,
                           edgi.8,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Pandemic worry (baseline)
edgi.9 <- edgi_pan_worry.id %>%
  select(ID,
         sample,
         panworry.impact_on_your_employment_status,                                    
         panworry.household_employment_status_key = panworry.employment_status_household_key,   # Rename to same as GLAD            
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.childrens_mental_health_impact,               
         panworry.relatives_impact_mental_health = panworry.impact_relatives_mental_health,           
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.global_recession_economy_longstanding,
         panworry.other_,
         
         panworry.impact_on_your_employment_status_numeric,
         panworry.impact_on_your_education_or_exams_numeric,                                    
         panworry.household_employment_status_key_numeric = panworry.employment_status_household_key_numeric,  # Rename to same as GLAD            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.childrens_mental_health_impact_numeric,               
         panworry.relatives_impact_mental_health_numeric = panworry.impact_relatives_mental_health_numeric,           
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.global_recession_economy_longstanding_numeric,
         panworry.other__numeric)
  
# Loneliness (baseline)
edgi.10 <- edgi_loneliness_baseline_id %>%
  select(ID,
         sample,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )

# Join pan worry & loneliness
edgi_E <- dplyr::full_join(edgi.9,
                           edgi.10,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Loss (baseline)
edgi.11 <- edgi_loss_baseline_id %>%
  select(ID, 
         sample,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss)


# Respiratory questionnaire (COVID test baseline)
edgi.12 <- edgi_baseline_resp_id %>%
  select(ID, 
         sample,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test)

# Join loss & resp
edgi_F <- dplyr::full_join(edgi.11,
                           edgi.12,
                           by = c("ID",
                                  "sample"
                           )
                           )

}
```

Join all EDGI
```{r Join all EDGI questionnaires}
if(EDGI == TRUE) {
  
dat_edgi_merged <- list(edgi_A,
                edgi_B,
                edgi_C,
                edgi_D,
                edgi_E,
                edgi_F
                ) %>%
reduce(full_join,
         by = c("ID",
         "sample"))
      
}
```

Get rid of duplicates in EDGI
```{r Check duplicates EDGI final dataset}
if(EDGI == TRUE) {
dat_edgi_merged$ID.dup <- duplicated(dat_edgi_merged$ID)
summary(as.factor(dat_edgi_merged$ID.dup))

 # Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat_edgi_merged)))
names_freq[names_freq$Freq > 1, ]
}
```

GLAD data frame list
```{r GLAD data frame list}
if(GLAD == TRUE) {

# Age
glad.1 <- age_dat_glad_coping %>% 
  select(ID,
   sample,
  age_numeric = dem.age_likely_cop,
  age_category = dem.age_category_cop
  )

# Gender
glad.2 <- gender_sex_glad_transgender_dat %>% 
  select(ID,
  sample,
  gender = dem.which_gender_do_you_identify_with_cop,
  sex = dem.sex_cop, 
  transgender =dem.do_you_identify_as_transgender # Need version from GLAD sign-up as it wasn't asked in COPING baseline
  )

# Join age and gender
glad_A <- dplyr::full_join(glad.1,
                           glad.2,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Ethnicity
glad.3 <- ethnicity_dat_glad %>% 
  select(ID,
  sample,
  ethnicity = dem.what_is_your_ethnic_origin
  )

# Employment / key worker  
glad.4 <- glad_coping_employment_id  %>% 
  select(ID,
  sample,
  key_worker,
  baseline_paid_employment,
   employ.my_employment_status_has_not_changed,
  employ.no_impact,
  employ.impact_on_studies_still_unknown
  )

# Join ethnicity & employ 
glad_B <- dplyr::full_join(glad.3,
                           glad.4,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Highest education
glad.5 <- highest_education_glad_coping %>%
  select(ID,
  sample,
  highest_education,
  highest_education_numeric
  )

# Thoughts and feelings (self-harm baseline)
glad.6 <- taf_glad_coping_baseline_id %>%
  select(ID,
  sample,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
  # Retro pre-pan
  taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline
  )


# Join highest education & TAF
glad_C <- dplyr::full_join(glad.5,
                           glad.6,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Mental health diagnosis
glad.7 <- glad_diagnostics %>%
  select(ID,
         sample,
         mental_health_diagnosis)

# Demographics (living situation, vulnerable member, etc)
glad.8 <- glad_living_situation_id %>%
  select(ID,
         sample,
         dem2.living_situation_change_pandemic,
         dem2.member_vulnerable_group)

# Join mhd & dem
glad_D <- dplyr::full_join(glad.7,
                           glad.8,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Pandemic worry (baseline)  
glad.9 <- glad_pan_worry.id %>%
  select(ID,
         sample,
         panworry.impact_on_your_employment_status,                                    
         panworry.household_employment_status_key,              
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.childrens_mental_health_impact,               
         panworry.relatives_impact_mental_health,           
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.global_recession_economy_longstanding,
         panworry.other_,
         
         panworry.impact_on_your_employment_status_numeric,                                    
         panworry.household_employment_status_key_numeric,              
         panworry.impact_on_your_education_or_exams_numeric,            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.childrens_mental_health_impact_numeric,               
         panworry.relatives_impact_mental_health_numeric,           
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.global_recession_economy_longstanding_numeric,
         panworry.other__numeric)

# Loneliness (baseline)
glad.10 <- glad_loneliness_baseline_id %>%
  select(ID,
         sample,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )


# Join mhd & dem
glad_E <- dplyr::full_join(glad.9,
                           glad.10,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Loss (baseline)
glad.11 <- glad_loss_baseline_id %>%
  select(ID, 
         sample,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss
         )


# Respiratory (COVID test - baseline)
glad.12 <- glad_baseline_resp_id %>%
  select(ID, 
         sample,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test
         )

# Join loss & resp
glad_F <- dplyr::full_join(glad.11,
                           glad.12,
                           by = c("ID",
                                  "sample"
                                  )
                           )
}
```

Join all GLAD
```{r Join all GLAD questionnaires}
if(GLAD == TRUE) {
dat_glad_merged <- list(glad_A,
                glad_B,
                glad_C,
                glad_D,
                glad_E,
                glad_F
                ) %>%
reduce(full_join,
         by = c("ID",
         "sample"))
      
}
```

Get rid of duplicates in GLAD
```{r Check duplicates GLAD final dataset}
if(GLAD == TRUE) {
dat_glad_merged$ID.dup <- duplicated(dat_glad_merged$ID)
summary(as.factor(dat_glad_merged$ID.dup))

# Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat_glad_merged)))
names_freq[names_freq$Freq > 1, ]

dat_glad_merged %>%
  dim()
}
```

NBR selected variables
```{r NBR selected variables final dataset}
if(NBR == TRUE) {
# Age
nbr.1 <- age_dat_nbr %>% 
  select(ID,
  sample,
  age_category = dem.age_category_cop,
  age_numeric = dem.dob_age_cop
  )


# Gender
nbr.2 <- gender_sex_nbr_dat %>% 
  select(ID,
  sample,
  gender = dem.which_gender_do_you_identify_with_cop,
  sex = dem.sex_cop, 
  transgender = dem.do_you_identify_as_transgender_cop # NB this technically doesn't exist in COPING but including for merging
  )

# Join age & gender 
nbr_A <- dplyr::full_join(nbr.1,
                           nbr.2,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Ethnicity
nbr.3 <- ethnicity_dat_nbr %>% 
  select(ID,
  sample,
  ethnicity = dem.what_is_your_ethnic_origin_cop
  )

# Employment / key worker  
nbr.4 <- nbr_dem_employ_raw_id %>% 
  select(ID,
  sample,
  key_worker,
  baseline_paid_employment,
   employ.my_employment_status_has_not_changed,
  employ.no_impact,
  employ.impact_on_studies_still_unknown
  )
  

# Join ethnicity & employment
nbr_B <- dplyr::full_join(nbr.3,
                           nbr.4,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Highest education
nbr.5 <- highest_education_nbr %>%
  select(ID,
  sample,
  highest_education,
  highest_education_numeric
  )

# Thoughts and feelings (self-harm baseline)
nbr.6 <- taf_nbr_baseline_id %>%
  select(ID,
  sample,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
  # Retro pre-pan
  taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline
  )

# Join highest education & TAF
nbr_C <- dplyr::full_join(nbr.5,
                           nbr.6,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Mental health diagnosis
nbr.7 <- nbr_diagnostics %>%
  select(ID,
         sample,
         mental_health_diagnosis)

# Demographics (living situation, vulnerable memer)
nbr.8 <- nbr_living_situation_id %>%
  select(ID,
         sample,
         dem2.living_situation_change_pandemic,
         dem2.member_vulnerable_group)


# Join mhd & dem
nbr_D <- dplyr::full_join(nbr.7,
                           nbr.8,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Pandemic worry (baseline)
nbr.9 <- nbr_pan_worry.id %>%
  select(ID,
         sample,
         panworry.impact_on_your_employment_status,                                    
         panworry.household_employment_status_key = panworry.employment_status_household_key, # Rename to same as GLAD             
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.childrens_mental_health_impact,               
         panworry.relatives_impact_mental_health = panworry.impact_relatives_mental_health, # Rename to same as GLAD           
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.global_recession_economy_longstanding,
         panworry.other_,
         
         panworry.impact_on_your_employment_status_numeric,                                    
         panworry.household_employment_status_key_numeric = panworry.employment_status_household_key_numeric, # Rename to same as GLAD              
         panworry.impact_on_your_education_or_exams_numeric,            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.childrens_mental_health_impact_numeric,               
         panworry.relatives_impact_mental_health_numeric = panworry.impact_relatives_mental_health_numeric, # Rename to same as GLAD           
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.global_recession_economy_longstanding_numeric,
         panworry.other__numeric
         )

# Loneliness (baseline)
nbr.10 <- nbr_loneliness_baseline_id %>%
  select(ID,
         sample,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )

# Join loneliness & pan worry
nbr_E <- dplyr::full_join(nbr.9,
                           nbr.10,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Loss (baseline)
nbr.11 <- nbr_loss_baseline_id %>%
  select(ID, 
         sample,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss)

# Resp questionnaire (COVID test baseline)
nbr.12 <- nbr_baseline_resp_id %>%
  select(ID, 
         sample,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test
         )


# Join loneliness & pan worry
nbr_F <- dplyr::full_join(nbr.11,
                           nbr.12,
                           by = c("ID",
                                  "sample"
                                  )
                           )
}
```

Join all NBR
```{r Join all NBR questionnaires}
if(NBR == TRUE) {
dat_nbr_merged <- list(nbr_A,
                nbr_B,
                nbr_C,
                nbr_D,
                nbr_E,
                nbr_F
                ) %>%
reduce(full_join,
         by = c("ID",
         "sample"))
}
```

Get rid of duplicates in NBR
```{r Check duplicates NBR final dataset}
if(NBR == TRUE) {
dat_nbr_merged$ID.dup <- duplicated(dat_nbr_merged$ID)
summary(as.factor(dat_nbr_merged$ID.dup))

# Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat_nbr_merged)))
names_freq[names_freq$Freq > 1, ]
}
```

RAMP variable list
```{r RAMP variable list}
if(RAMP == TRUE) {
# Age
ramp.1 <- age_dat_ramp %>% 
  select(ID,
  sample,
  age_category = dem.age_category
  )


# Gender
ramp.2 <- gender_sex_dat_ramp %>% 
  select(ID,
  sample,
  gender = dem.which_gender_do_you_identify_with_cop,
  sex = dem.sex_cop, 
  transgender = dem.do_you_identify_as_transgender_cop # 'COP' here means RAMP. This variable is available in RAMP.
 )

# Join age & gender
ramp_A <- dplyr::full_join(ramp.1,
                           ramp.2,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Ethnicity
ramp.3 <- ethnicity_dat_ramp %>% 
  select(ID,
  sample,
  ethnicity = dem.what_is_your_ethnic_origin_cop
  )

# Employment / key worker  
ramp.4 <- ramp_dem_employ_raw_id %>% 
  select(ID,
  sample,
  key_worker,
  baseline_paid_employment,
  employ.my_employment_status_has_not_changed,
  employ.no_impact,
  employ.impact_on_studies_still_unknown
  )

# Join ethnicity & employment
ramp_B <- dplyr::full_join(ramp.3,
                           ramp.4,
                           by = c("ID",
                                  "sample"
                                  )
                           )
  
# Highest education
ramp.5 <- highest_education_ramp %>%
  select(ID,
  sample,
  highest_education,
  highest_education_numeric
  )

# EDEQ baseline (only in RAMP)
ramp.6_edeq_screener <- edeq_ramp_screener_baseline_raw_id %>%
  select(ID,
          sample,
         ed_scid5.weigh_weighed_past_month_.Wavebaseline,
         ed_scid5.weigh_weighed_past_month_.Wavebaseline_numeric,
         ed_scid5.regular_episodes_eating_binges_.Wavebaseline,
         ed_scid5.regular_episodes_eating_binges_.Wavebaseline_numeric
  )
  
ramp.6_edeq <- edeq_ramp_baseline_id %>%
    select(ID,
           sample,
           edeq.deliberately_limit_amount_influence.1_.Wavebaseline,
           edeq.calories_made_body_shape.1_.Wavebaseline,
           edeq.weight_influenced_person.1_.Wavebaseline,
           edeq.dissatisfied_shape_weight.1_.Wavebaseline,
           edeq.eating_behaviours_concerns_distressed.1_.Wavebaseline,
           edeq.nibbled_picked_snacks_grazed.1_.Wavebaseline,
           edeq.felt_anxious_blue_bored.2_.Wavebaseline,
           edeq.felt_anxious_blue_bored.3_.Wavebaseline,
           edeq.actively_been_monitoring_your_shape_or_weight_.1_.Wavebaseline,
           edeq.regard_lost_control_eaten.1_.Wavebaseline,
           edeq.sick_means_made_shape.1_.Wavebaseline,
           edeq.diuretics_laxatives_means_shape.1_.Wavebaseline,
           edeq.compulsive_driven_burn_calories.1_.Wavebaseline,
           edeq.deliberately_limit_amount_influence.1_.Wavebaseline_numeric,
           edeq.calories_made_body_shape.1_.Wavebaseline_numeric,
           edeq.weight_influenced_person.1_.Wavebaseline_numeric,
           edeq.dissatisfied_shape_weight.1_.Wavebaseline_numeric,
           edeq.eating_behaviours_concerns_distressed.1_.Wavebaseline_numeric,
           edeq.nibbled_picked_snacks_grazed.1_.Wavebaseline_numeric,
           edeq.felt_anxious_blue_bored.2_.Wavebaseline_numeric,
           edeq.felt_anxious_blue_bored.3_.Wavebaseline_numeric,
           edeq.actively_been_monitoring_your_shape_or_weight_.1_.Wavebaseline_numeric,
           edeq.regard_lost_control_eaten.1_.Wavebaseline_numeric,
           edeq.sick_means_made_shape.1_.Wavebaseline_numeric,
           edeq.diuretics_laxatives_means_shape.1_.Wavebaseline_numeric,
           edeq.compulsive_driven_burn_calories.1_.Wavebaseline_numeric,
           edeq.deliberately_limit_amount_influence_.Wavebaseline,
          edeq.calories_made_body_shape_.Wavebaseline ,
          edeq.weight_influenced_person_.Wavebaseline,
          edeq.dissatisfied_shape_weight_.Wavebaseline ,
         edeq.nibbled_picked_snacks_grazed_.Wavebaseline ,
         edeq.felt_anxious_blue_bored_.Wavebaseline ,
         edeq.felt_anxious_blue_bored.1_.Wavebaseline ,
         edeq.eating_behaviours_concerns_distressed_.Wavebaseline,
         edeq.actively_been_monitoring_your_shape_or_weight_.Wavebaseline,
         edeq.regard_lost_control_eaten_.Wavebaseline,
         edeq.sick_means_made_shape_.Wavebaseline,
         edeq.diuretics_laxatives_means_shape_.Wavebaseline,
         edeq.compulsive_driven_burn_calories_.Wavebaseline,
         edeq.deliberately_limit_amount_influence_.Wavebaseline_numeric,
         edeq.calories_made_body_shape_.Wavebaseline_numeric,
         edeq.weight_influenced_person_.Wavebaseline_numeric,
         edeq.dissatisfied_shape_weight_.Wavebaseline_numeric ,
         edeq.nibbled_picked_snacks_grazed_.Wavebaseline_numeric ,
         edeq.felt_anxious_blue_bored_.Wavebaseline_numeric ,
         edeq.felt_anxious_blue_bored.1_.Wavebaseline_numeric ,
         edeq.eating_behaviours_concerns_distressed_.Wavebaseline_numeric ,
         edeq.actively_been_monitoring_your_shape_or_weight_.Wavebaseline_numeric,
         edeq.regard_lost_control_eaten_.Wavebaseline_numeric,
         edeq.sick_means_made_shape_.Wavebaseline_numeric,
         edeq.diuretics_laxatives_means_shape_.Wavebaseline_numeric ,
         edeq.compulsive_driven_burn_calories_.Wavebaseline_numeric 
  )

ramp.6 <- dplyr::full_join(ramp.6_edeq_screener,
                           ramp.6_edeq,
                           by = c("ID",
                                  "sample"))


# Join highest education & EDEQ (baseline)
ramp_C  <- dplyr::full_join(ramp.5,
                           ramp.6,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Living situation & vulnerable member
ramp.7 <- ramp_living_situation_id %>%
  select(ID,
         sample,
         dem2.living_situation_change_pandemic,
         dem2.member_vulnerable_group)

# Thoughts and feelings (self-harm baseline)
ramp.8 <- taf_ramp_baseline_id  %>% 
  select(ID,
         sample,
         taf.worth_living_life_people_.Wavebaseline,
         taf.felt_weeks_past_.Wavebaseline,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline,
         taf.felt_weeks_past.1_.Wavebaseline,
         taf.meant_life_end_weeks_.Wavebaseline,
         # Retro prepan
         taf.pandemic_felt_.Wavebaseline, 
         taf.pandemic_felt.1_.Wavebaseline,
         taf.meant_end_life_pandemic_.Wavebaseline
         )



# Join living situation & TAF
ramp_D  <- dplyr::full_join(ramp.7,
                           ramp.8,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Pandemic worry
ramp.9 <- ramp_pan_worry.id %>%
  select(ID,
         sample,
         panworry.impact_on_your_employment_status,                                    
         panworry.household_employment_status_key = panworry.employment_status_household_key,  # Rename to same as GLAD             
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.childrens_mental_health_impact,               
         panworry.relatives_impact_mental_health = panworry.impact_relatives_mental_health, # Rename to same as GLAD         
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.global_recession_economy_longstanding,
         panworry.other_,
         
         panworry.impact_on_your_employment_status_numeric,                                    
         panworry.household_employment_status_key_numeric = panworry.employment_status_household_key_numeric, # Rename to same as GLAD                 
         panworry.impact_on_your_education_or_exams_numeric,            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.childrens_mental_health_impact_numeric,               
         panworry.relatives_impact_mental_health_numeric = panworry.impact_relatives_mental_health_numeric, # Rename to same as GLAD             
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.global_recession_economy_longstanding_numeric,
         panworry.other__numeric
  )


# Loneliness (baseline)
ramp.10 <- ramp_loneliness_baseline_id %>%
  select(ID,
         sample,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )

# Join pan worry & loneliness
ramp_E  <- dplyr::full_join(ramp.9,
                           ramp.10,
                           by = c("ID",
                                  "sample"
                                  )
                           )


# Loss (baseline)
ramp.11 <- ramp_loss_baseline_id %>%
  select(ID, 
         sample,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss)

# Resp questionnaire (COVID test)
ramp.12 <- ramp_baseline_resp_id %>%
  select(ID, 
         sample,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test
         )

# Join resp & loss 
ramp_F  <- dplyr::full_join(ramp.11,
                           ramp.12,
                           by = c("ID",
                                  "sample"
                                  )
                           )

# Mental health diagnosis 
ramp.13 <- ramp_diagnostics %>%
  select(ID,
         sample,
         mental_health_diagnosis)
}
```

Join all RAMP
```{r Join all RAMP questionnaires}
if(RAMP == TRUE) {

dat_ramp_merged <- list(ramp_A,
                ramp_B,
                ramp_C,
                ramp_D,
                ramp_E,
                ramp_F
                ) %>%
reduce(full_join,
         by = c("ID",
         "sample"))

}
```

Get rid of duplicates in RAMP
```{r Check duplicates RAMP final dataset}
if(RAMP == TRUE) {
  
dat_ramp_merged$ID.dup <- duplicated(dat_ramp_merged$ID)
summary(as.factor(dat_ramp_merged$ID.dup))

# Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat_ramp_merged)))
names_freq[names_freq$Freq > 1, ]

}
```

# Export baseline data
```{r export data}
if(GLAD == TRUE) {
saveRDS(object = dat_glad_merged, file = paste0(filepath_saved_data, "BASELINE_glad", date, ".rds"))
}
if(EDGI == TRUE) {
saveRDS(object = dat_edgi_merged, file = paste0(filepath_saved_data, "BASELINE_edgi", date, ".rds"))
  
}
if(RAMP == TRUE) {
  saveRDS(object = dat_ramp_merged, file = paste0(filepath_saved_data, "BASELINE_ramp", date, ".rds"))
}
if(NBR == TRUE) {
  saveRDS(object = dat_nbr_merged, file = paste0(filepath_saved_data, "BASELINE_nbr", date, ".rds"))
}
```


# *CREATING PHASES* 
## TIMEPOINTS / PHASES - RAMP Demographics
Create phase columns in follow up data - RAMP
```{r Identify phases source script RAMP}
if (RAMP ==TRUE) {
source("./timepoints_RAMP.R")
}
```

Join demographics follow ups (RAMP)
```{r Merge RAMP follow up data demographics}
if(RAMP == TRUE) {
dat.raw.dem.ramp.followup <- dem.ramp.followupa.raw.id %>%
  bind_rows(dem.ramp.followupb.raw.id)

# Check column names
colnames(dat.raw.dem.ramp.followup)
}
```

Checking for number of entries per phase
```{r Check number of entries per phase RAMP demographics}
if(RAMP == TRUE) {
dat.raw.dem.ramp.followup %>%
  group_by(wave_dem) %>%
  count()
}
```

Identify duplicate IDs in a single timepoint
There are over 1,000 duplicated IDs at a single timepoint. Need to count both entries.
```{r Identify duplicate IDs in a single timepoint RAMP demographics}
if(RAMP == TRUE) {
# Identify dup IDs in a single wave 
dat.raw.dem.ramp.followup %>%
   group_by(wave_dem, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
  
}
```

```{r count both entries dup IDs single phase RAMP demographics}
if(RAMP == TRUE) {
# Confirm number of rows in current dataset 
nrow(dat.raw.dem.ramp.followup)

# Need to split duplicated IDs into separate datasets

# Identify IDs from the last entry
A_duplicated_IDS <- dat.raw.dem.ramp.followup %>%
  group_by(ID) %>% 
    filter(duplicated(wave_dem,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

# Identify IDs from the earlier entry
B_duplicated_IDS <- dat.raw.dem.ramp.followup %>%
  group_by(ID) %>% 
    filter(duplicated(wave_dem,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries


# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
dat.raw.dem.ramp.followup <- dat.raw.dem.ramp.followup %>%
   group_by(wave_dem,
            ID) %>%
    filter(
       (!duplicated(wave_dem,
                        fromLast = TRUE)) &
        (!duplicated(wave_dem,
                   fromLast = FALSE))
      ) 

dat.raw.dem.ramp.followup$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
dat.raw.dem.ramp.followup <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      dat.raw.dem.ramp.followup)


# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
dat.raw.dem.ramp.followup <- dat.raw.dem.ramp.followup %>%
  mutate(wave_dem =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_dem, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_dem 
          )
)

# Check
check <- dat.raw.dem.ramp.followup %>%
  filter(change_wave_name == "TRUE") 

check$wave_dem

check2 <- dat.raw.dem.ramp.followup %>%
  filter(change_wave_name != "TRUE") 

check2$wave_dem
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs dem ramp}
if(RAMP == TRUE) {
dat.raw.dem.ramp.followup <- dat.raw.dem.ramp.followup %>%
  group_by(wave_dem) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up RAMP demographics to wide format
```{r RAMP demographics wide format}
if(RAMP == TRUE) {
dat.raw.dem.ramp.followup <- dat.raw.dem.ramp.followup %>%
  group_by(wave_dem) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_dem, 
                     values_from = c(
         dem.living_situation,
         dem.employment,
         dem.household_employment_status_key,
         dem.unwell_coronavirus_weeks_physical,
         dem.coronavirus_relative_previously_ill.1,
         dem.health_of_a_relative,
         dem.coronavirus_relative_ill_suspected
         
         )
    ) 
}
```

Select variables for dataset RAMP demographics
```{r Select variables for dataset RAMP demographics}
if(RAMP == TRUE) {
dat.raw.dem.ramp.followup <- dat.raw.dem.ramp.followup %>%
  select(ID,
            
         `dem.living_situation_.Wave_1a`,
         `dem.living_situation_.Wave_1b`,
         `dem.living_situation_.Wave_2a`,
         `dem.living_situation_.Wave_2b`,
         `dem.living_situation_.Wave_3a`,
         `dem.living_situation_.Wave_3b`,
         `dem.living_situation_.Wave_4a`,
         `dem.living_situation_.Wave_4b`,
         `dem.living_situation_.Wave_5a`,
         `dem.living_situation_.Wave_6b`,
         `dem.living_situation_.Wave_7a`,
         `dem.living_situation_.Wave_8b`,
         `dem.living_situation_.Wave_9a`,
         `dem.living_situation_.Wave_10b`,
         `dem.living_situation_.Wave_11a`,
         `dem.living_situation_.Wave_12b`,
          `dem.living_situation_.Wave_13a`,
         `dem.living_situation_.Wave_14b`,
         `dem.living_situation_.Wave_15a`,
         `dem.living_situation_.Wave_16b`,

          `dem.employment_.Wave_1a`,
         `dem.employment_.Wave_1b`,
         `dem.employment_.Wave_2a`,
         `dem.employment_.Wave_2b`,
         `dem.employment_.Wave_3a`,
         `dem.employment_.Wave_3b`,
         `dem.employment_.Wave_4a`,
         `dem.employment_.Wave_4b`,
         `dem.employment_.Wave_5a`,
         `dem.employment_.Wave_6b`,
         `dem.employment_.Wave_7a`,
         `dem.employment_.Wave_8b`,
         `dem.employment_.Wave_9a`,
         `dem.employment_.Wave_10b`,
         `dem.employment_.Wave_11a`,
         `dem.employment_.Wave_12b`,
         `dem.employment_.Wave_13a`,
         `dem.employment_.Wave_14b`,
         `dem.employment_.Wave_15a`,
         `dem.employment_.Wave_16b`,
           
         `dem.health_of_a_relative_.Wave_1a`,
         `dem.health_of_a_relative_.Wave_1b`,
         `dem.health_of_a_relative_.Wave_2a`,
         `dem.health_of_a_relative_.Wave_2b`,
         `dem.health_of_a_relative_.Wave_3a`,
         `dem.health_of_a_relative_.Wave_3b`,
         `dem.health_of_a_relative_.Wave_4a`,
         `dem.health_of_a_relative_.Wave_4b`,
         `dem.health_of_a_relative_.Wave_5a`,
         `dem.health_of_a_relative_.Wave_6b`,
         `dem.health_of_a_relative_.Wave_7a`,
         `dem.health_of_a_relative_.Wave_8b`,
         `dem.health_of_a_relative_.Wave_9a`,
         `dem.health_of_a_relative_.Wave_10b`,
         `dem.health_of_a_relative_.Wave_11a`,
         `dem.health_of_a_relative_.Wave_12b`,
         `dem.health_of_a_relative_.Wave_13a`,
         `dem.health_of_a_relative_.Wave_14b`,
         `dem.health_of_a_relative_.Wave_15a`,
         `dem.health_of_a_relative_.Wave_16b`,
         
         `dem.household_employment_status_key_.Wave_1a`,
         `dem.household_employment_status_key_.Wave_1b`,
         `dem.household_employment_status_key_.Wave_2a`,
         `dem.household_employment_status_key_.Wave_2b`,
         `dem.household_employment_status_key_.Wave_3a`,
         `dem.household_employment_status_key_.Wave_3b`,
         `dem.household_employment_status_key_.Wave_4a`,
         `dem.household_employment_status_key_.Wave_4b`,
         `dem.household_employment_status_key_.Wave_5a`,
         `dem.household_employment_status_key_.Wave_6b`,
         `dem.household_employment_status_key_.Wave_7a`,
         `dem.household_employment_status_key_.Wave_8b`,
         `dem.household_employment_status_key_.Wave_9a`,
         `dem.household_employment_status_key_.Wave_10b`,
         `dem.household_employment_status_key_.Wave_11a`,
         `dem.household_employment_status_key_.Wave_12b`,
         `dem.household_employment_status_key_.Wave_13a`,
         `dem.household_employment_status_key_.Wave_14b`,
         `dem.household_employment_status_key_.Wave_15a`,
         `dem.household_employment_status_key_.Wave_16b`,
          
         `dem.unwell_coronavirus_weeks_physical_.Wave_1a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_1b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_2a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_2b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_5a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_6b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_7a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_8b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_9a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_10b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_11a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_12b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_13a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_14b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_15a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_16b`,
  
           `dem.coronavirus_relative_previously_ill.1_.Wave_1a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_1b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_2a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_2b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_5a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_6b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_7a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_8b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_9a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_10b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_11a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_12b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_13a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_14b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_15a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_16b`, 
     
       `dem.coronavirus_relative_ill_suspected_.Wave_1a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_1b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_2a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_2b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_5a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_6b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_7a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_8b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_9a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_10b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_11a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_12b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_13a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_14b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_15a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_16b`, 
     
     # Duplicated entries
       `dem.living_situation_.Wave_1a_dup`,
         `dem.living_situation_.Wave_1b_dup`,
         `dem.living_situation_.Wave_2a_dup`,
         `dem.living_situation_.Wave_2b_dup`,
         `dem.living_situation_.Wave_3a_dup`,
         `dem.living_situation_.Wave_3b_dup`,
         `dem.living_situation_.Wave_4a_dup`,
         `dem.living_situation_.Wave_4b_dup`,
         `dem.living_situation_.Wave_5a_dup`,
         `dem.living_situation_.Wave_6b_dup`,
         `dem.living_situation_.Wave_7a_dup`,
         `dem.living_situation_.Wave_8b_dup`,
         `dem.living_situation_.Wave_9a_dup`,
         `dem.living_situation_.Wave_10b_dup`,
         `dem.living_situation_.Wave_11a_dup`,
         `dem.living_situation_.Wave_12b_dup`,
          `dem.living_situation_.Wave_13a_dup`,
         `dem.living_situation_.Wave_14b_dup`,
         `dem.living_situation_.Wave_15a_dup`,
         `dem.living_situation_.Wave_16b_dup`,
         
         `dem.employment_.Wave_1a_dup`,
         `dem.employment_.Wave_1b_dup`,
         `dem.employment_.Wave_2a_dup`,
         `dem.employment_.Wave_2b_dup`,
         `dem.employment_.Wave_3a_dup`,
         `dem.employment_.Wave_3b_dup`,
         `dem.employment_.Wave_4a_dup`,
         `dem.employment_.Wave_4b_dup`,
         `dem.employment_.Wave_5a_dup`,
         `dem.employment_.Wave_6b_dup`,
         `dem.employment_.Wave_7a_dup`,
         `dem.employment_.Wave_8b_dup`,
         `dem.employment_.Wave_9a_dup`,
         `dem.employment_.Wave_10b_dup`,
         `dem.employment_.Wave_11a_dup`,
         `dem.employment_.Wave_12b_dup`,
         `dem.employment_.Wave_13a_dup`,
         `dem.employment_.Wave_14b_dup`,
         `dem.employment_.Wave_15a_dup`,
         `dem.employment_.Wave_16b_dup`,
       
         `dem.health_of_a_relative_.Wave_1a_dup`,
         `dem.health_of_a_relative_.Wave_1b_dup`,
         `dem.health_of_a_relative_.Wave_2a_dup`,
         `dem.health_of_a_relative_.Wave_2b_dup`,
         `dem.health_of_a_relative_.Wave_3a_dup`,
         `dem.health_of_a_relative_.Wave_3b_dup`,
         `dem.health_of_a_relative_.Wave_4a_dup`,
         `dem.health_of_a_relative_.Wave_4b_dup`,
         `dem.health_of_a_relative_.Wave_5a_dup`,
         `dem.health_of_a_relative_.Wave_6b_dup`,
         `dem.health_of_a_relative_.Wave_7a_dup`,
         `dem.health_of_a_relative_.Wave_8b_dup`,
         `dem.health_of_a_relative_.Wave_9a_dup`,
         `dem.health_of_a_relative_.Wave_10b_dup`,
         `dem.health_of_a_relative_.Wave_11a_dup`,
         `dem.health_of_a_relative_.Wave_12b_dup`,
         `dem.health_of_a_relative_.Wave_13a_dup`,
         `dem.health_of_a_relative_.Wave_14b_dup`,
         `dem.health_of_a_relative_.Wave_15a_dup`,
         `dem.health_of_a_relative_.Wave_16b_dup`,
        
         `dem.household_employment_status_key_.Wave_1a_dup`,
         `dem.household_employment_status_key_.Wave_1b_dup`,
         `dem.household_employment_status_key_.Wave_2a_dup`,
         `dem.household_employment_status_key_.Wave_2b_dup`,
         `dem.household_employment_status_key_.Wave_3a_dup`,
         `dem.household_employment_status_key_.Wave_3b_dup`,
         `dem.household_employment_status_key_.Wave_4a_dup`,
         `dem.household_employment_status_key_.Wave_4b_dup`,
         `dem.household_employment_status_key_.Wave_5a_dup`,
         `dem.household_employment_status_key_.Wave_6b_dup`,
         `dem.household_employment_status_key_.Wave_7a_dup`,
         `dem.household_employment_status_key_.Wave_8b_dup`,
         `dem.household_employment_status_key_.Wave_9a_dup`,
         `dem.household_employment_status_key_.Wave_10b_dup`,
         `dem.household_employment_status_key_.Wave_11a_dup`,
         `dem.household_employment_status_key_.Wave_12b_dup`,
         `dem.household_employment_status_key_.Wave_13a_dup`,
         `dem.household_employment_status_key_.Wave_14b_dup`,
         `dem.household_employment_status_key_.Wave_15a_dup`,
         `dem.household_employment_status_key_.Wave_16b_dup`,
       
         `dem.unwell_coronavirus_weeks_physical_.Wave_1a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_1b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_2a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_2b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_5a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_6b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_7a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_8b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_9a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_10b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_11a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_12b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_13a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_14b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_15a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_16b_dup`,
     
     `dem.coronavirus_relative_previously_ill.1_.Wave_1a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_1b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_2a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_2b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_5a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_6b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_7a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_8b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_9a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_10b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_11a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_12b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_13a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_14b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_15a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_16b_dup`,
     
        `dem.coronavirus_relative_ill_suspected_.Wave_1a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_1b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_2a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_2b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_5a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_6b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_7a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_8b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_9a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_10b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_11a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_12b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_13a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_14b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_15a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_16b_dup`
     
         )
}
```

Remove duplicate IDs RAMP demographics
```{r Remove duplicate IDs RAMP demographics}
if(RAMP == TRUE) {
# Check col names
colnames(dat.raw.dem.ramp.followup)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
dat.raw.dem.ramp.followup  <- dat.raw.dem.ramp.followup %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(dat.raw.dem.ramp.followup)
}
```

# TIMEPOINTS / PHASES - TAF RAMP
Create phase columns in follow up data - RAMP
```{r Identify phase datas RAMP TAF}
if (RAMP ==TRUE) {
source("./timepoints_RAMP.R")
}
```

Join TAF follow ups (RAMP)
```{r Merge follow up RAMP TAF}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- taf.ramp.followupa.raw.id %>%
  bind_rows(taf.ramp.followupb.raw.id)

# Check column names
colnames(dat.raw.taf.ramp)
}
```

Check for number of entries per wave
```{r Check number of entries per wave RAMP TAF}
if(RAMP == TRUE) {
dat.raw.taf.ramp %>%
  group_by(wave_taf) %>%
  count()
}
```

Identify duplicate IDs in a single timepoint
```{r Identify duplicate IDs in a single timepoint RAMP TAF}
if(RAMP == TRUE) {
# Identify dup IDs in a single wave 
dat.raw.taf.ramp %>%
   group_by(wave_taf, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase RAMP TAF}
if(RAMP == TRUE) {
# Confirm number of rows in current dataset 
nrow(dat.raw.taf.ramp)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- dat.raw.taf.ramp %>%
  group_by(ID) %>% 
    filter(duplicated(wave_taf,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- dat.raw.taf.ramp %>%
  group_by(ID) %>% 
    filter(duplicated(wave_taf,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
dat.raw.taf.ramp <- dat.raw.taf.ramp %>%
   group_by(wave_taf,
            ID) %>%
    filter(
       (!duplicated(wave_taf,
                        fromLast = TRUE)) &
        (!duplicated(wave_taf,
                   fromLast = FALSE))
      ) 

dat.raw.taf.ramp$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
dat.raw.taf.ramp <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      dat.raw.taf.ramp)


# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
dat.raw.taf.ramp <- dat.raw.taf.ramp %>%
  mutate(wave_taf =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_taf, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_taf 
          )
)

# Check
check <- dat.raw.taf.ramp %>%
  filter(change_wave_name == "TRUE") 

check$wave_taf

check2 <- dat.raw.taf.ramp %>%
  filter(change_wave_name != "TRUE") 

check2$wave_taf
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs taf ramp}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- dat.raw.taf.ramp %>%
  group_by(wave_taf) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up TAF RAMP to wide format
```{r TAF RAMP wide format}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- dat.raw.taf.ramp %>%
  group_by(wave_taf) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_taf, 
                     values_from = c(taf.worth_living_life_people,
                              taf.felt_weeks_past,
                              taf.have_you_contemplated_harming_yourself,
                              taf.felt_weeks_past.1,
                              taf.meant_life_end_weeks
                              )
    ) 
  
}
```

Select variables for dataset TAF RAMP
```{r Select variables for dataset TAF RAMP}
if(RAMP == TRUE) {
dat.raw.taf.ramp <- dat.raw.taf.ramp %>%
  select(ID,
         `taf.worth_living_life_people_.Wave_1a`,
         `taf.worth_living_life_people_.Wave_1b`,
         `taf.worth_living_life_people_.Wave_2a`,
         `taf.worth_living_life_people_.Wave_2b`,
         `taf.worth_living_life_people_.Wave_3a`,
         `taf.worth_living_life_people_.Wave_3b`,
         `taf.worth_living_life_people_.Wave_4a`,
         `taf.worth_living_life_people_.Wave_4b`,
         `taf.worth_living_life_people_.Wave_5a`,
         `taf.worth_living_life_people_.Wave_6b`,
         `taf.worth_living_life_people_.Wave_7a`,
         `taf.worth_living_life_people_.Wave_8b`,
         `taf.worth_living_life_people_.Wave_9a`,
         `taf.worth_living_life_people_.Wave_10b`,
         `taf.worth_living_life_people_.Wave_11a`,
         `taf.worth_living_life_people_.Wave_12b`,
         `taf.worth_living_life_people_.Wave_13a`,
         `taf.worth_living_life_people_.Wave_14b`,
         `taf.worth_living_life_people_.Wave_15a`,
         `taf.worth_living_life_people_.Wave_16b`,
         
        `taf.felt_weeks_past_.Wave_1a`,
         `taf.felt_weeks_past_.Wave_1b`,
         `taf.felt_weeks_past_.Wave_2a`,
         `taf.felt_weeks_past_.Wave_2b`,
         `taf.felt_weeks_past_.Wave_3a`,
         `taf.felt_weeks_past_.Wave_3b`,
         `taf.felt_weeks_past_.Wave_4a`,
         `taf.felt_weeks_past_.Wave_4b`,
         `taf.felt_weeks_past_.Wave_5a`,
         `taf.felt_weeks_past_.Wave_6b`,
         `taf.felt_weeks_past_.Wave_7a`,
         `taf.felt_weeks_past_.Wave_8b`,
         `taf.felt_weeks_past_.Wave_9a`,
         `taf.felt_weeks_past_.Wave_10b`,
         `taf.felt_weeks_past_.Wave_11a`,
         `taf.felt_weeks_past_.Wave_12b`,
         `taf.felt_weeks_past_.Wave_13a`,
         `taf.felt_weeks_past_.Wave_14b`,
         `taf.felt_weeks_past_.Wave_15a`,
         `taf.felt_weeks_past_.Wave_16b`,
         
         `taf.have_you_contemplated_harming_yourself_.Wave_1a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_1b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_2a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_2b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_5a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_6b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_7a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_8b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_9a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_10b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_11a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_12b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_13a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_14b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_15a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_16b`,
         
         `taf.felt_weeks_past.1_.Wave_1a`,
         `taf.felt_weeks_past.1_.Wave_1b`,
         `taf.felt_weeks_past.1_.Wave_2a`,
         `taf.felt_weeks_past.1_.Wave_2b`,
         `taf.felt_weeks_past.1_.Wave_3a`,
         `taf.felt_weeks_past.1_.Wave_3b`,
         `taf.felt_weeks_past.1_.Wave_4a`,
         `taf.felt_weeks_past.1_.Wave_4b`,
         `taf.felt_weeks_past.1_.Wave_5a`,
         `taf.felt_weeks_past.1_.Wave_6b`,
         `taf.felt_weeks_past.1_.Wave_7a`,
         `taf.felt_weeks_past.1_.Wave_8b`,
         `taf.felt_weeks_past.1_.Wave_9a`,
         `taf.felt_weeks_past.1_.Wave_10b`,
         `taf.felt_weeks_past.1_.Wave_11a`,
         `taf.felt_weeks_past.1_.Wave_12b`,
         `taf.felt_weeks_past.1_.Wave_13a`,
         `taf.felt_weeks_past.1_.Wave_14b`,
         `taf.felt_weeks_past.1_.Wave_15a`,
         `taf.felt_weeks_past.1_.Wave_16b`,
        
          `taf.meant_life_end_weeks_.Wave_1a`,
         `taf.meant_life_end_weeks_.Wave_1b`,
         `taf.meant_life_end_weeks_.Wave_2a`,
         `taf.meant_life_end_weeks_.Wave_2b`,
         `taf.meant_life_end_weeks_.Wave_3a`,
         `taf.meant_life_end_weeks_.Wave_3b`,
         `taf.meant_life_end_weeks_.Wave_4a`,
         `taf.meant_life_end_weeks_.Wave_4b`,
         `taf.meant_life_end_weeks_.Wave_5a`,
         `taf.meant_life_end_weeks_.Wave_6b`,
         `taf.meant_life_end_weeks_.Wave_7a`,
         `taf.meant_life_end_weeks_.Wave_8b`,
         `taf.meant_life_end_weeks_.Wave_9a`,
         `taf.meant_life_end_weeks_.Wave_10b`,
         `taf.meant_life_end_weeks_.Wave_11a`,
         `taf.meant_life_end_weeks_.Wave_12b`,
         `taf.meant_life_end_weeks_.Wave_13a`,
         `taf.meant_life_end_weeks_.Wave_14b`,
         `taf.meant_life_end_weeks_.Wave_15a`,
         `taf.meant_life_end_weeks_.Wave_16b`,
      
       `taf.worth_living_life_people_.Wave_1a_dup`,
         `taf.worth_living_life_people_.Wave_1b_dup`,
         `taf.worth_living_life_people_.Wave_2a_dup`,
         `taf.worth_living_life_people_.Wave_2b_dup`,
         `taf.worth_living_life_people_.Wave_3a_dup`,
         `taf.worth_living_life_people_.Wave_3b_dup`,
         `taf.worth_living_life_people_.Wave_4a_dup`,
         `taf.worth_living_life_people_.Wave_4b_dup`,
         `taf.worth_living_life_people_.Wave_5a_dup`,
         `taf.worth_living_life_people_.Wave_6b_dup`,
         `taf.worth_living_life_people_.Wave_7a_dup`,
         `taf.worth_living_life_people_.Wave_8b_dup`,
         `taf.worth_living_life_people_.Wave_9a_dup`,
         `taf.worth_living_life_people_.Wave_10b_dup`,
         `taf.worth_living_life_people_.Wave_11a_dup`,
         `taf.worth_living_life_people_.Wave_12b_dup`,
         `taf.worth_living_life_people_.Wave_13a_dup`,
         `taf.worth_living_life_people_.Wave_14b_dup`,
         `taf.worth_living_life_people_.Wave_15a_dup`,
         `taf.worth_living_life_people_.Wave_16b_dup`,
         
         # Duplicated entries
         `taf.felt_weeks_past_.Wave_1a_dup`,
         `taf.felt_weeks_past_.Wave_1b_dup`,
         `taf.felt_weeks_past_.Wave_2a_dup`,
         `taf.felt_weeks_past_.Wave_2b_dup`,
         `taf.felt_weeks_past_.Wave_3a_dup`,
         `taf.felt_weeks_past_.Wave_3b_dup`,
         `taf.felt_weeks_past_.Wave_4a_dup`,
         `taf.felt_weeks_past_.Wave_4b_dup`,
         `taf.felt_weeks_past_.Wave_5a_dup`,
         `taf.felt_weeks_past_.Wave_6b_dup`,
         `taf.felt_weeks_past_.Wave_7a_dup`,
         `taf.felt_weeks_past_.Wave_8b_dup`,
         `taf.felt_weeks_past_.Wave_9a_dup`,
         `taf.felt_weeks_past_.Wave_10b_dup`,
         `taf.felt_weeks_past_.Wave_11a_dup`,
         `taf.felt_weeks_past_.Wave_12b_dup`,
         `taf.felt_weeks_past_.Wave_13a_dup`,
         `taf.felt_weeks_past_.Wave_14b_dup`,
         `taf.felt_weeks_past_.Wave_15a_dup`,
         `taf.felt_weeks_past_.Wave_16b_dup`,

         `taf.have_you_contemplated_harming_yourself_.Wave_1a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_1b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_2a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_2b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_5a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_6b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_7a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_8b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_9a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_10b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_11a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_12b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_13a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_14b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_15a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_16b_dup`,

         `taf.felt_weeks_past.1_.Wave_1a_dup`,
         `taf.felt_weeks_past.1_.Wave_1b_dup`,
         `taf.felt_weeks_past.1_.Wave_2a_dup`,
         `taf.felt_weeks_past.1_.Wave_2b_dup`,
         `taf.felt_weeks_past.1_.Wave_3a_dup`,
         `taf.felt_weeks_past.1_.Wave_3b_dup`,
         `taf.felt_weeks_past.1_.Wave_4a_dup`,
         `taf.felt_weeks_past.1_.Wave_4b_dup`,
         `taf.felt_weeks_past.1_.Wave_5a_dup`,
         `taf.felt_weeks_past.1_.Wave_6b_dup`,
         `taf.felt_weeks_past.1_.Wave_7a_dup`,
         `taf.felt_weeks_past.1_.Wave_8b_dup`,
         `taf.felt_weeks_past.1_.Wave_9a_dup`,
         `taf.felt_weeks_past.1_.Wave_10b_dup`,
         `taf.felt_weeks_past.1_.Wave_11a_dup`,
         `taf.felt_weeks_past.1_.Wave_12b_dup`,
         `taf.felt_weeks_past.1_.Wave_13a_dup`,
         `taf.felt_weeks_past.1_.Wave_14b_dup`,
         `taf.felt_weeks_past.1_.Wave_15a_dup`,
         `taf.felt_weeks_past.1_.Wave_16b_dup`,

          `taf.meant_life_end_weeks_.Wave_1a_dup`,
         `taf.meant_life_end_weeks_.Wave_1b_dup`,
         `taf.meant_life_end_weeks_.Wave_2a_dup`,
         `taf.meant_life_end_weeks_.Wave_2b_dup`,
         `taf.meant_life_end_weeks_.Wave_3a_dup`,
         `taf.meant_life_end_weeks_.Wave_3b_dup`,
         `taf.meant_life_end_weeks_.Wave_4a_dup`,
         `taf.meant_life_end_weeks_.Wave_4b_dup`,
         `taf.meant_life_end_weeks_.Wave_5a_dup`,
         `taf.meant_life_end_weeks_.Wave_6b_dup`,
         `taf.meant_life_end_weeks_.Wave_7a_dup`,
         `taf.meant_life_end_weeks_.Wave_8b_dup`,
         `taf.meant_life_end_weeks_.Wave_9a_dup`,
         `taf.meant_life_end_weeks_.Wave_10b_dup`,
         `taf.meant_life_end_weeks_.Wave_11a_dup`,
         `taf.meant_life_end_weeks_.Wave_12b_dup`,
         `taf.meant_life_end_weeks_.Wave_13a_dup`,
         `taf.meant_life_end_weeks_.Wave_14b_dup`,
         `taf.meant_life_end_weeks_.Wave_15a_dup`,
         `taf.meant_life_end_weeks_.Wave_16b_dup`,
         )
}
```

Remove duplicate IDs TAF RAMP
```{r Remove duplicate IDs TAF RAMP}
if(RAMP == TRUE) {
# Check col names
colnames(dat.raw.taf.ramp)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
dat.raw.taf.ramp  <- dat.raw.taf.ramp %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 
# Check number of rows
nrow(dat.raw.taf.ramp)
}
```

# TIMEPOINTS / PHASES - RAMP - EDEQ SCREENER RAMP
Check number of entries per wave
```{r Check number of entries per wave RAMP EDEQ screener}
if(RAMP == TRUE) {
edeq.ramp.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>%
  count()
}
```

Idenfity duplicate IDs in a single wave
```{r Idenfity duplicate IDs in a single wave RAMP EDEQ screener}
if(RAMP == TRUE) {
# Identify dup IDs in a single wave
edeq.ramp.followupb.screener.raw.id %>%
   group_by(wave_edeq, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase RAMP EDEQ screener}
if(RAMP == TRUE) {
# Confirm number of rows in current dataset 
nrow(edeq.ramp.followupb.screener.raw.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- edeq.ramp.followupb.screener.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_edeq,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- edeq.ramp.followupb.screener.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_edeq,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw.id %>%
   group_by(wave_edeq,
            ID) %>%
    filter(
       (!duplicated(wave_edeq,
                        fromLast = TRUE)) &
        (!duplicated(wave_edeq,
                   fromLast = FALSE))
      ) 

edeq.ramp.followupb.screener.raw.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
edeq.ramp.followupb.screener.raw.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      edeq.ramp.followupb.screener.raw.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw.id %>%
  mutate(wave_edeq =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_edeq, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_edeq 
          )
)

# Check
check <- edeq.ramp.followupb.screener.raw.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_edeq)

check2 <- edeq.ramp.followupb.screener.raw.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_edeq)

# Now, identify dup IDs in a single wave  (think of the 'dup' IDs as completely different/new waves)
edeq.ramp.followupb.screener.raw.id %>%
   group_by(wave_edeq, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs edeq screener ramp}
if(RAMP == TRUE) {
edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up EDEQ RAMP screener to wide format
```{r RAMP EDEQ screener wide format}
if(RAMP == TRUE) {
edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_edeq, 
                     values_from = c(ed_scid5.regular_episodes_eating_binges,
                                     ed_scid5.weigh_weighed_past_month,
                                     ed_scid5.regular_episodes_eating_binges_numeric,
                                     ed_scid5.weigh_weighed_past_month_numeric)) 
  
}
```

Select variables for dataset EDEQ RAMP screener
```{r Select variables for dataset RAMP EDEQ screener}
if(RAMP == TRUE) {
edeq.ramp.followupb.screener.raw.id <- edeq.ramp.followupb.screener.raw.id  %>%
  select(ID,
         `ed_scid5.regular_episodes_eating_binges_.Wave_1b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_2b` ,    
         `ed_scid5.regular_episodes_eating_binges_.Wave_3b` ,       
         `ed_scid5.regular_episodes_eating_binges_.Wave_4b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_6b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_8b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_10b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_12b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_14b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_16b`,
         
         `ed_scid5.weigh_weighed_past_month_.Wave_1b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_2b` ,    
         `ed_scid5.weigh_weighed_past_month_.Wave_3b` ,       
         `ed_scid5.weigh_weighed_past_month_.Wave_4b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_6b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_8b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_10b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_12b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_14b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_16b`,
         
          `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_1b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_2b` ,    
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_3b` ,       
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_4b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_6b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_8b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_10b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_12b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_14b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_16b`,
         
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_1b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_2b` ,    
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_3b` ,       
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_4b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_6b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_8b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_10b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_12b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_14b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_16b`,
         
         # Duplicated entries
          `ed_scid5.regular_episodes_eating_binges_.Wave_1b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_2b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_3b_dup`,   
         `ed_scid5.regular_episodes_eating_binges_.Wave_4b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_6b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_8b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_10b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_12b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_14b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_16b_dup`,
         
         `ed_scid5.weigh_weighed_past_month_.Wave_1b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_2b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_3b_dup`,   
         `ed_scid5.weigh_weighed_past_month_.Wave_4b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_6b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_8b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_10b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_12b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_14b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_16b_dup`,
         
          `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_1b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_2b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_3b_dup`,   
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_4b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_6b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_8b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_10b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_12b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_14b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_16b_dup`,
         
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_1b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_2b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_3b_dup`,   
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_4b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_6b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_8b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_10b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_12b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_14b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_16b_dup`
         )
}
```

Remove duplicate IDs EDEQ RAMP screener
```{r Remove duplicate IDs RAMP EDEQ screener}
if(RAMP == TRUE) {
# Check col names
colnames(edeq.ramp.followupb.screener.raw.id)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
edeq.ramp.followupb.screener.raw.id  <- edeq.ramp.followupb.screener.raw.id  %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 
# Check number of rows
nrow(edeq.ramp.followupb.screener.raw.id)
}
```

# TIMEPOINTS / PHASES - loss of loved one due to COVID RAMP
```{r Check number of entries per phase loss of loved one due to COVID RAMP}
if(RAMP == TRUE) {
ramp.loss.followupb.raw.id %>%
  group_by(wave_loss) %>%
  count()
}
```

Identify duplicate IDs in a single timepoint
```{r Identify duplicate IDs in a single timepoint loss of loved one due to COVID RAMP}
if(RAMP == TRUE) {
##Identify dup IDs in a single wave 
ramp.loss.followupb.raw.id %>%
   group_by(wave_loss, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase RAMP loss}
if(RAMP == TRUE) {
# Confirm number of rows in current dataset 
nrow(ramp.loss.followupb.raw.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- ramp.loss.followupb.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_loss,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- ramp.loss.followupb.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_loss,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
ramp.loss.followupb.raw.id <- ramp.loss.followupb.raw.id %>%
   group_by(wave_loss,
            ID) %>%
    filter(
       (!duplicated(wave_loss,
                        fromLast = TRUE)) &
        (!duplicated(wave_loss,
                   fromLast = FALSE))
      ) 

ramp.loss.followupb.raw.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
ramp.loss.followupb.raw.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      ramp.loss.followupb.raw.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
ramp.loss.followupb.raw.id <- ramp.loss.followupb.raw.id %>%
  mutate(wave_loss =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_loss, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_loss 
          )
)

# Check
check <- ramp.loss.followupb.raw.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_loss)

check2 <- ramp.loss.followupb.raw.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_loss)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs loss ramp}
if(RAMP == TRUE) {
ramp.loss.followupb.raw.id <- ramp.loss.followupb.raw.id %>%
  group_by(wave_loss) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up loss of loved one due to COVID RAMP to wide format
```{r Loss of loved one due to COVID RAMP wide format}
if(RAMP == TRUE) {
ramp.loss.followupb.raw.id <- ramp.loss.followupb.raw.id %>%
  group_by(wave_loss) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_loss, 
                     values_from = c( grief.due_past_month_lost,
                                      grief.suffered_past_month_loss
                       )) 
  
}
```

Select variables for dataset loss of loved one due to COVID RAMP
```{r Select variable loss of loved one due to COVID RAMP}
if(RAMP == TRUE) {
ramp.loss.followupb.raw.id <- ramp.loss.followupb.raw.id %>%
  select(ID,
         `grief.due_past_month_lost_.Wave_1b`,
         `grief.due_past_month_lost_.Wave_2b`,
         `grief.due_past_month_lost_.Wave_3b`,
         `grief.due_past_month_lost_.Wave_4b`,
         `grief.due_past_month_lost_.Wave_6b`,
         `grief.due_past_month_lost_.Wave_8b`,
         `grief.due_past_month_lost_.Wave_10b`, 
         `grief.due_past_month_lost_.Wave_12b`,
         `grief.due_past_month_lost_.Wave_14b`,
         `grief.due_past_month_lost_.Wave_16b`,
         
         `grief.suffered_past_month_loss_.Wave_1b`,
         `grief.suffered_past_month_loss_.Wave_2b`,
         `grief.suffered_past_month_loss_.Wave_3b`,
         `grief.suffered_past_month_loss_.Wave_4b`,
         `grief.suffered_past_month_loss_.Wave_6b`,
         `grief.suffered_past_month_loss_.Wave_8b`,
         `grief.suffered_past_month_loss_.Wave_10b`,
         `grief.suffered_past_month_loss_.Wave_12b`,
         `grief.suffered_past_month_loss_.Wave_14b`,
         `grief.suffered_past_month_loss_.Wave_16b`,
         
         # Duplicated entries
          `grief.due_past_month_lost_.Wave_1b_dup`,
         `grief.due_past_month_lost_.Wave_2b_dup`,
         `grief.due_past_month_lost_.Wave_3b_dup`,
         `grief.due_past_month_lost_.Wave_4b_dup`,
         `grief.due_past_month_lost_.Wave_6b_dup`,
         `grief.due_past_month_lost_.Wave_8b_dup`,
         `grief.due_past_month_lost_.Wave_10b_dup`, 
         `grief.due_past_month_lost_.Wave_12b_dup`,
         `grief.due_past_month_lost_.Wave_14b_dup`,
         `grief.due_past_month_lost_.Wave_16b_dup`,
         
         `grief.suffered_past_month_loss_.Wave_1b_dup`,
         `grief.suffered_past_month_loss_.Wave_2b_dup`,
         `grief.suffered_past_month_loss_.Wave_3b_dup`,
         `grief.suffered_past_month_loss_.Wave_4b_dup`,
         `grief.suffered_past_month_loss_.Wave_6b_dup`,
         `grief.suffered_past_month_loss_.Wave_8b_dup`,
         `grief.suffered_past_month_loss_.Wave_10b_dup`,
         `grief.suffered_past_month_loss_.Wave_12b_dup`,
         `grief.suffered_past_month_loss_.Wave_14b_dup`,
         `grief.suffered_past_month_loss_.Wave_16b_dup`
         
         
         )
}
```

Remove duplicate IDs loss of loved one due to COVID RAMP
```{r Remove duplicate IDs loss of loved one due to COVID RAMP}
if(RAMP == TRUE) {
# Check col names
colnames(ramp.loss.followupb.raw.id)
# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
ramp.loss.followupb.raw.id  <- ramp.loss.followupb.raw.id %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(ramp.loss.followupb.raw.id)
}
```

# TIMEPOINTS / PHASES - RESP RAMP 

Join RAMP resp datasets follow ups
```{r Merge RAMP resp}
if(RAMP == TRUE) {
ramp.followup.resp.id <- ramp.followupa.resp.id %>%
  bind_rows(ramp.followupb.resp.id)

# Check column names
colnames(ramp.followup.resp.id)
}
```

Check number of entries per wave
```{r Check number of entries per wave RAMP resp}
if(RAMP == TRUE) {
ramp.followup.resp.id %>%
  group_by(wave_resp) %>%
  count()
}
```

Idenfity duplicate IDs in a single wave
```{r Idenfity duplicate IDs in a single wave RAMP resp}
if(RAMP == TRUE) {
# Identify dup IDs in a single wave
ramp.followup.resp.id %>%
   group_by(wave_resp, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase RAMP resp}
if(RAMP == TRUE) {
# Confirm number of rows in current dataset 
nrow(ramp.followup.resp.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- ramp.followup.resp.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_resp,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- ramp.followup.resp.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_resp,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
ramp.followup.resp.id <- ramp.followup.resp.id %>%
   group_by(wave_resp,
            ID) %>%
    filter(
       (!duplicated(wave_resp,
                        fromLast = TRUE)) &
        (!duplicated(wave_resp,
                   fromLast = FALSE))
      ) 

ramp.followup.resp.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
ramp.followup.resp.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      ramp.followup.resp.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
ramp.followup.resp.id <- ramp.followup.resp.id %>%
  mutate(wave_resp =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_resp, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_resp 
          )
)

# Check
check <- ramp.followup.resp.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_resp)

check2 <- ramp.followup.resp.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_resp)

# Now, identify dup IDs in a single wave  (think of the 'dup' IDs as completely different/new waves)
ramp.followup.resp.id %>%
   group_by(wave_resp, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs resp ramp}
if(RAMP == TRUE) {
ramp.followup.resp.id <- ramp.followup.resp.id %>%
  group_by(wave_resp) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up RAMP resp to wide format
```{r RAMP resp wide format}
if(RAMP == TRUE) {
ramp.followup.resp.id <- ramp.followup.resp.id %>%
  group_by(wave_resp) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_resp, 
                     values_from = c(resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_antibody_test
         )
    ) 
  
} 
```

Select variables for dataset RAMP resp
```{r Select variables for dataset RAMP resp}
if(RAMP == TRUE) {
ramp.followup.resp.id <- ramp.followup.resp.id  %>%
  select(ID,
         `resp.coronavirus_test_nosethroat_swab_.Wave_1a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_1b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_2a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_2b` ,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3b` , 
         `resp.coronavirus_test_nosethroat_swab_.Wave_4a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_4b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_5a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_6b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_7a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_8b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_9a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_10b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_11a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_12b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_13a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_14b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_15a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_16b`,
         
         `resp.results_nosethroat_swab_test_.Wave_1a`,
         `resp.results_nosethroat_swab_test_.Wave_1b`,
         `resp.results_nosethroat_swab_test_.Wave_2a`,
         `resp.results_nosethroat_swab_test_.Wave_2b` ,
         `resp.results_nosethroat_swab_test_.Wave_3a`,
         `resp.results_nosethroat_swab_test_.Wave_3b` , 
         `resp.results_nosethroat_swab_test_.Wave_4a`,
         `resp.results_nosethroat_swab_test_.Wave_4b`,
         `resp.results_nosethroat_swab_test_.Wave_5a`,
         `resp.results_nosethroat_swab_test_.Wave_6b`,
         `resp.results_nosethroat_swab_test_.Wave_7a`,
         `resp.results_nosethroat_swab_test_.Wave_8b`,
         `resp.results_nosethroat_swab_test_.Wave_9a`,
         `resp.results_nosethroat_swab_test_.Wave_10b`,
         `resp.results_nosethroat_swab_test_.Wave_11a`,
         `resp.results_nosethroat_swab_test_.Wave_12b`,
         `resp.results_nosethroat_swab_test_.Wave_13a`,
         `resp.results_nosethroat_swab_test_.Wave_14b`,
         `resp.results_nosethroat_swab_test_.Wave_15a`,
         `resp.results_nosethroat_swab_test_.Wave_16b`,
      
          `resp.coronavirus_antibody_test_.Wave_1a`,
         `resp.coronavirus_antibody_test_.Wave_1b`,
         `resp.coronavirus_antibody_test_.Wave_2a`,
         `resp.coronavirus_antibody_test_.Wave_2b` ,
         `resp.coronavirus_antibody_test_.Wave_3a`,
         `resp.coronavirus_antibody_test_.Wave_3b` , 
         `resp.coronavirus_antibody_test_.Wave_4a`,
         `resp.coronavirus_antibody_test_.Wave_4b`,
         `resp.coronavirus_antibody_test_.Wave_5a`,
         `resp.coronavirus_antibody_test_.Wave_6b`,
         `resp.coronavirus_antibody_test_.Wave_7a`,
         `resp.coronavirus_antibody_test_.Wave_8b`,
         `resp.coronavirus_antibody_test_.Wave_9a`,
         `resp.coronavirus_antibody_test_.Wave_10b`,
         `resp.coronavirus_antibody_test_.Wave_11a`,
         `resp.coronavirus_antibody_test_.Wave_12b`,
         `resp.coronavirus_antibody_test_.Wave_13a`,
         `resp.coronavirus_antibody_test_.Wave_14b`,
         `resp.coronavirus_antibody_test_.Wave_15a`,
         `resp.coronavirus_antibody_test_.Wave_16b`,
         
         `resp.results_antibody_test_.Wave_1a`,
         `resp.results_antibody_test_.Wave_1b`,
         `resp.results_antibody_test_.Wave_2a`,
         `resp.results_antibody_test_.Wave_2b` ,
         `resp.results_antibody_test_.Wave_3a`,
         `resp.results_antibody_test_.Wave_3b` , 
         `resp.results_antibody_test_.Wave_4a`,
         `resp.results_antibody_test_.Wave_4b`,
         `resp.results_antibody_test_.Wave_5a`,
         `resp.results_antibody_test_.Wave_6b`,
         `resp.results_antibody_test_.Wave_7a`,
         `resp.results_antibody_test_.Wave_8b`,
         `resp.results_antibody_test_.Wave_9a`,
         `resp.results_antibody_test_.Wave_10b`,
         `resp.results_antibody_test_.Wave_11a`,
         `resp.results_antibody_test_.Wave_12b`,
         `resp.results_antibody_test_.Wave_13a`,
         `resp.results_antibody_test_.Wave_14b`,
         `resp.results_antibody_test_.Wave_15a`,
         `resp.results_antibody_test_.Wave_16b`,
       
       # Duplicated entries
        `resp.coronavirus_test_nosethroat_swab_.Wave_1a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_1b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_2a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_2b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3b_dup`, 
         `resp.coronavirus_test_nosethroat_swab_.Wave_4a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_4b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_5a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_6b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_7a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_8b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_9a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_10b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_11a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_12b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_13a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_14b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_15a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_16b_dup`,

         `resp.results_nosethroat_swab_test_.Wave_1a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_1b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_2a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_2b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_3a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_3b_dup`, 
         `resp.results_nosethroat_swab_test_.Wave_4a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_4b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_5a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_6b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_7a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_8b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_9a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_10b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_11a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_12b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_13a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_14b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_15a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_16b_dup`,

        `resp.coronavirus_antibody_test_.Wave_1a_dup`,
         `resp.coronavirus_antibody_test_.Wave_1b_dup`,
         `resp.coronavirus_antibody_test_.Wave_2a_dup`,
         `resp.coronavirus_antibody_test_.Wave_2b_dup`,
         `resp.coronavirus_antibody_test_.Wave_3a_dup`,
         `resp.coronavirus_antibody_test_.Wave_3b_dup`, 
         `resp.coronavirus_antibody_test_.Wave_4a_dup`,
         `resp.coronavirus_antibody_test_.Wave_4b_dup`,
         `resp.coronavirus_antibody_test_.Wave_5a_dup`,
         `resp.coronavirus_antibody_test_.Wave_6b_dup`,
         `resp.coronavirus_antibody_test_.Wave_7a_dup`,
         `resp.coronavirus_antibody_test_.Wave_8b_dup`,
         `resp.coronavirus_antibody_test_.Wave_9a_dup`,
         `resp.coronavirus_antibody_test_.Wave_10b_dup`,
         `resp.coronavirus_antibody_test_.Wave_11a_dup`,
         `resp.coronavirus_antibody_test_.Wave_12b_dup`,
         `resp.coronavirus_antibody_test_.Wave_13a_dup`,
         `resp.coronavirus_antibody_test_.Wave_14b_dup`,
         `resp.coronavirus_antibody_test_.Wave_15a_dup`,
         `resp.coronavirus_antibody_test_.Wave_16b_dup`,

         `resp.results_antibody_test_.Wave_1a_dup`,
         `resp.results_antibody_test_.Wave_1b_dup`,
         `resp.results_antibody_test_.Wave_2a_dup`,
         `resp.results_antibody_test_.Wave_2b_dup`,
         `resp.results_antibody_test_.Wave_3a_dup`,
         `resp.results_antibody_test_.Wave_3b_dup`, 
         `resp.results_antibody_test_.Wave_4a_dup`,
         `resp.results_antibody_test_.Wave_4b_dup`,
         `resp.results_antibody_test_.Wave_5a_dup`,
         `resp.results_antibody_test_.Wave_6b_dup`,
         `resp.results_antibody_test_.Wave_7a_dup`,
         `resp.results_antibody_test_.Wave_8b_dup`,
         `resp.results_antibody_test_.Wave_9a_dup`,
         `resp.results_antibody_test_.Wave_10b_dup`,
         `resp.results_antibody_test_.Wave_11a_dup`,
         `resp.results_antibody_test_.Wave_12b_dup`,
         `resp.results_antibody_test_.Wave_13a_dup`,
         `resp.results_antibody_test_.Wave_14b_dup`,
         `resp.results_antibody_test_.Wave_15a_dup`,
         `resp.results_antibody_test_.Wave_16b_dup`
       )
}
```

Remove duplicate RAMP resp screener
```{r Remove duplicate IDs RAMP resp}
if(RAMP == TRUE) {
# Check col names
colnames(ramp.followup.resp.id)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
ramp.followup.resp.id  <- ramp.followup.resp.id  %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(ramp.followup.resp.id)
}
```

# TIMEPOINTS / PHASES - COPING demographics
Create a phase columns in follow up data
```{r Identify phase data COPING follow up demographics}
if (COPING ==TRUE) {
source("./timepoints_COPING.R")
}
```

Join COPING demographics datasets follow ups
```{r Merge COPING follow up demographics}
if(COPING == TRUE) {
dat.raw.dem.coping.followup <- coping.dem.followupb.raw.id %>%
  bind_rows(coping.dem.followupa.raw.id)

# Check column names
colnames(dat.raw.dem.coping.followup)
}
```

Check for number of entries per wave
```{r Check for number of entries per wave COPING follow up demographics}
if(COPING == TRUE) {
dat.raw.dem.coping.followup %>%
  group_by(wave_dem) %>%
  count()
}
```

Identify duplicate IDs in a single timepoint
```{r Identify duplicate IDs in a single timepoint COPING follow up demographics}
if(COPING == TRUE) {

# Identify dup IDs in a single wave 
dat.raw.dem.coping.followup %>%
   group_by(wave_dem, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase COPING dem}
if(COPING == TRUE) {
# Confirm number of rows in current dataset 
nrow(dat.raw.dem.coping.followup)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- dat.raw.dem.coping.followup %>%
  group_by(ID) %>% 
    filter(duplicated(wave_dem,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- dat.raw.dem.coping.followup %>%
  group_by(ID) %>% 
    filter(duplicated(wave_dem,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
dat.raw.dem.coping.followup <- dat.raw.dem.coping.followup %>%
   group_by(wave_dem,
            ID) %>%
    filter(
       (!duplicated(wave_dem,
                        fromLast = TRUE)) &
        (!duplicated(wave_dem,
                   fromLast = FALSE))
      ) 

dat.raw.dem.coping.followup$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
dat.raw.dem.coping.followup <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      dat.raw.dem.coping.followup)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
dat.raw.dem.coping.followup <- dat.raw.dem.coping.followup %>%
  mutate(wave_dem =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_dem, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_dem 
          )
)

# Check
check <- dat.raw.dem.coping.followup %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_dem)

check2 <- dat.raw.dem.coping.followup %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_dem)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs dem coping}
if(COPING == TRUE) {
dat.raw.dem.coping.followup <- dat.raw.dem.coping.followup %>%
  group_by(wave_dem) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up COPING demographics to wide format
```{r COPING follow up demographics wide format}
if(COPING == TRUE) {
dat.raw.dem.coping.followup <- dat.raw.dem.coping.followup %>%
  group_by(wave_dem) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_dem, 
                     values_from = c(
                        dem.living_situation,
         dem.employment,
         dem.household_employment_status_key,
         dem.unwell_coronavirus_weeks_physical,
         dem.coronavirus_relative_previously_ill.1,
         dem.health_of_a_relative,
         dem.coronavirus_relative_ill_suspected
         )) 
}
```

Select variables for dataset COPING follow up demographics
```{r Select variables COPING follow up demographics}
if(COPING == TRUE) {
dat.raw.dem.coping.followup <- dat.raw.dem.coping.followup %>%
  select(ID,
         `dem.living_situation_.Wave_2a`,
         `dem.living_situation_.Wave_2b`,
         `dem.living_situation_.Wave_3a`,
         `dem.living_situation_.Wave_3b`,
         `dem.living_situation_.Wave_4a`,
         `dem.living_situation_.Wave_4b`,
         `dem.living_situation_.Wave_5a`,
         `dem.living_situation_.Wave_6b`,
         `dem.living_situation_.Wave_7a`,
         `dem.living_situation_.Wave_8b`,
         `dem.living_situation_.Wave_9a`,
         `dem.living_situation_.Wave_10b`,
         `dem.living_situation_.Wave_11a`,
         `dem.living_situation_.Wave_12b`,
         `dem.living_situation_.Wave_13a`,
         `dem.living_situation_.Wave_14b`,
         `dem.living_situation_.Wave_15a`,
         `dem.living_situation_.Wave_16b`,

         `dem.employment_.Wave_2a`,
         `dem.employment_.Wave_2b`,
         `dem.employment_.Wave_3a`,
         `dem.employment_.Wave_3b`,
         `dem.employment_.Wave_4a`,
         `dem.employment_.Wave_4b`,
         `dem.employment_.Wave_5a`,
         `dem.employment_.Wave_6b`,
         `dem.employment_.Wave_7a`,
         `dem.employment_.Wave_8b`,
         `dem.employment_.Wave_9a`,
         `dem.employment_.Wave_10b`,
         `dem.employment_.Wave_11a`,
         `dem.employment_.Wave_12b`,
         `dem.employment_.Wave_13a`,
         `dem.employment_.Wave_14b`,
         `dem.employment_.Wave_15a`,
         `dem.employment_.Wave_16b`,

         `dem.health_of_a_relative_.Wave_2a`,
         `dem.health_of_a_relative_.Wave_2b`,
         `dem.health_of_a_relative_.Wave_3a`,
         `dem.health_of_a_relative_.Wave_3b`,
         `dem.health_of_a_relative_.Wave_4a`,
         `dem.health_of_a_relative_.Wave_4b`,
         `dem.health_of_a_relative_.Wave_5a`,
         `dem.health_of_a_relative_.Wave_6b`,
         `dem.health_of_a_relative_.Wave_7a`,
         `dem.health_of_a_relative_.Wave_8b`,
         `dem.health_of_a_relative_.Wave_9a`,
         `dem.health_of_a_relative_.Wave_10b`,
         `dem.health_of_a_relative_.Wave_11a`,
         `dem.health_of_a_relative_.Wave_12b`,
         `dem.health_of_a_relative_.Wave_13a`,
         `dem.health_of_a_relative_.Wave_14b`,
         `dem.health_of_a_relative_.Wave_15a`,
         `dem.health_of_a_relative_.Wave_16b`,

         `dem.household_employment_status_key_.Wave_2a`,
         `dem.household_employment_status_key_.Wave_2b`,
         `dem.household_employment_status_key_.Wave_3a`,
         `dem.household_employment_status_key_.Wave_3b`,
         `dem.household_employment_status_key_.Wave_4a`,
         `dem.household_employment_status_key_.Wave_4b`,
         `dem.household_employment_status_key_.Wave_5a`,
         `dem.household_employment_status_key_.Wave_6b`,
         `dem.household_employment_status_key_.Wave_7a`,
         `dem.household_employment_status_key_.Wave_8b`,
         `dem.household_employment_status_key_.Wave_9a`,
         `dem.household_employment_status_key_.Wave_10b`,
         `dem.household_employment_status_key_.Wave_11a`,
         `dem.household_employment_status_key_.Wave_12b`,
         `dem.household_employment_status_key_.Wave_13a`,
         `dem.household_employment_status_key_.Wave_14b`,
         `dem.household_employment_status_key_.Wave_15a`,
         `dem.household_employment_status_key_.Wave_16b`,

        `dem.unwell_coronavirus_weeks_physical_.Wave_2a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_2b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_5a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_6b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_7a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_8b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_9a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_10b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_11a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_12b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_13a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_14b`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_15a`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_16b`,

         `dem.coronavirus_relative_previously_ill.1_.Wave_2a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_2b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_5a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_6b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_7a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_8b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_9a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_10b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_11a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_12b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_13a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_14b`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_15a`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_16b`, 
     
          `dem.coronavirus_relative_ill_suspected_.Wave_2a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_2b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_5a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_6b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_7a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_8b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_9a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_10b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_11a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_12b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_13a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_14b`,
         `dem.coronavirus_relative_ill_suspected_.Wave_15a`,
         `dem.coronavirus_relative_ill_suspected_.Wave_16b`, 
     
     # Duplicated entries
         `dem.living_situation_.Wave_2a_dup`,
         `dem.living_situation_.Wave_2b_dup`,
         `dem.living_situation_.Wave_3a_dup`,
         `dem.living_situation_.Wave_3b_dup`,
         `dem.living_situation_.Wave_4a_dup`,
         `dem.living_situation_.Wave_4b_dup`,
         `dem.living_situation_.Wave_5a_dup`,
         `dem.living_situation_.Wave_6b_dup`,
         `dem.living_situation_.Wave_7a_dup`,
         `dem.living_situation_.Wave_8b_dup`,
         `dem.living_situation_.Wave_9a_dup`,
         `dem.living_situation_.Wave_10b_dup`,
         `dem.living_situation_.Wave_11a_dup`,
         `dem.living_situation_.Wave_12b_dup`,
         `dem.living_situation_.Wave_13a_dup`,
         `dem.living_situation_.Wave_14b_dup`,
         `dem.living_situation_.Wave_15a_dup`,
         `dem.living_situation_.Wave_16b_dup`,
    
         `dem.employment_.Wave_2a_dup`,
         `dem.employment_.Wave_2b_dup`,
         `dem.employment_.Wave_3a_dup`,
         `dem.employment_.Wave_3b_dup`,
         `dem.employment_.Wave_4a_dup`,
         `dem.employment_.Wave_4b_dup`,
         `dem.employment_.Wave_5a_dup`,
         `dem.employment_.Wave_6b_dup`,
         `dem.employment_.Wave_7a_dup`,
         `dem.employment_.Wave_8b_dup`,
         `dem.employment_.Wave_9a_dup`,
         `dem.employment_.Wave_10b_dup`,
         `dem.employment_.Wave_11a_dup`,
         `dem.employment_.Wave_12b_dup`,
         `dem.employment_.Wave_13a_dup`,
         `dem.employment_.Wave_14b_dup`,
         `dem.employment_.Wave_15a_dup`,
         `dem.employment_.Wave_16b_dup`,

          `dem.health_of_a_relative_.Wave_2a_dup`,
         `dem.health_of_a_relative_.Wave_2b_dup`,
         `dem.health_of_a_relative_.Wave_3a_dup`,
         `dem.health_of_a_relative_.Wave_3b_dup`,
         `dem.health_of_a_relative_.Wave_4a_dup`,
         `dem.health_of_a_relative_.Wave_4b_dup`,
         `dem.health_of_a_relative_.Wave_5a_dup`,
         `dem.health_of_a_relative_.Wave_6b_dup`,
         `dem.health_of_a_relative_.Wave_7a_dup`,
         `dem.health_of_a_relative_.Wave_8b_dup`,
         `dem.health_of_a_relative_.Wave_9a_dup`,
         `dem.health_of_a_relative_.Wave_10b_dup`,
         `dem.health_of_a_relative_.Wave_11a_dup`,
         `dem.health_of_a_relative_.Wave_12b_dup`,
         `dem.health_of_a_relative_.Wave_13a_dup`,
         `dem.health_of_a_relative_.Wave_14b_dup`,
         `dem.health_of_a_relative_.Wave_15a_dup`,
         `dem.health_of_a_relative_.Wave_16b_dup`,

         `dem.household_employment_status_key_.Wave_2a_dup`,
         `dem.household_employment_status_key_.Wave_2b_dup`,
         `dem.household_employment_status_key_.Wave_3a_dup`,
         `dem.household_employment_status_key_.Wave_3b_dup`,
         `dem.household_employment_status_key_.Wave_4a_dup`,
         `dem.household_employment_status_key_.Wave_4b_dup`,
         `dem.household_employment_status_key_.Wave_5a_dup`,
         `dem.household_employment_status_key_.Wave_6b_dup`,
         `dem.household_employment_status_key_.Wave_7a_dup`,
         `dem.household_employment_status_key_.Wave_8b_dup`,
         `dem.household_employment_status_key_.Wave_9a_dup`,
         `dem.household_employment_status_key_.Wave_10b_dup`,
         `dem.household_employment_status_key_.Wave_11a_dup`,
         `dem.household_employment_status_key_.Wave_12b_dup`,
         `dem.household_employment_status_key_.Wave_13a_dup`,
         `dem.household_employment_status_key_.Wave_14b_dup`,
         `dem.household_employment_status_key_.Wave_15a_dup`,
         `dem.household_employment_status_key_.Wave_16b_dup`,

        `dem.unwell_coronavirus_weeks_physical_.Wave_2a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_2b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_3b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_4b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_5a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_6b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_7a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_8b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_9a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_10b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_11a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_12b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_13a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_14b_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_15a_dup`,
         `dem.unwell_coronavirus_weeks_physical_.Wave_16b_dup`,

         `dem.coronavirus_relative_previously_ill.1_.Wave_2a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_2b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_3b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_4b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_5a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_6b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_7a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_8b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_9a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_10b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_11a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_12b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_13a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_14b_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_15a_dup`,
         `dem.coronavirus_relative_previously_ill.1_.Wave_16b_dup`,
     
         `dem.coronavirus_relative_ill_suspected_.Wave_2a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_2b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_3b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_4b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_5a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_6b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_7a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_8b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_9a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_10b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_11a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_12b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_13a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_14b_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_15a_dup`,
         `dem.coronavirus_relative_ill_suspected_.Wave_16b_dup`
     )
}
```

Remove duplicate IDs COPING follow up demographics
```{r Remove duplicate IDs COPING follow up demographics}
if(COPING == TRUE) {
# Check col names
colnames(dat.raw.dem.coping.followup)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
dat.raw.dem.coping.followup  <- dat.raw.dem.coping.followup %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(dat.raw.dem.coping.followup)
}
```

# TIMEPOINTS / PHASES - COPING TAF
Create a phase columns in follow up data 
```{r Identify phases COPING follow up TAF}
if (COPING ==TRUE) {
source("./timepoints_COPING.R")
}
```

Join TAF COPING follow ups 
```{r Merge COPING follow ups TAF}
if(COPING == TRUE) {
dat.raw.taf.coping <- taf.coping.followupa.raw.id %>%
  bind_rows(taf.coping.followupb.raw.id)

# Check col names
colnames(dat.raw.taf.coping)

# Check number of rows
nrow(dat.raw.taf.coping)

}
```

Check for number of entries per wave
```{r Check for number of entries per wave COPING follow up TAF}
if(COPING == TRUE) {
dat.raw.taf.coping %>%
  group_by(wave_taf) %>%
  count()
}
```

Identify duplicate IDs in a single wave
```{r Identify duplicate IDs in a single wave COPING follow up TAF}
if(COPING == TRUE) {

# Identify dup IDs in a single wave
dat.raw.taf.coping %>%
   group_by(wave_taf, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase COPING TAF}
if(COPING == TRUE) {
# Confirm number of rows in current dataset 
nrow(dat.raw.taf.coping)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- dat.raw.taf.coping %>%
  group_by(ID) %>% 
    filter(duplicated(wave_taf,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- dat.raw.taf.coping %>%
  group_by(ID) %>% 
    filter(duplicated(wave_taf,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
dat.raw.taf.coping <- dat.raw.taf.coping %>%
   group_by(wave_taf,
            ID) %>%
    filter(
       (!duplicated(wave_taf,
                        fromLast = TRUE)) &
        (!duplicated(wave_taf,
                   fromLast = FALSE))
      ) 

dat.raw.taf.coping$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
dat.raw.taf.coping <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      dat.raw.taf.coping)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
dat.raw.taf.coping <- dat.raw.taf.coping %>%
  mutate(wave_taf =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_taf, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_taf 
          )
)

# Check
check <- dat.raw.taf.coping %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_taf)

check2 <- dat.raw.taf.coping %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_taf)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs taf coping}
if(COPING == TRUE) {
dat.raw.taf.coping <- dat.raw.taf.coping %>%
  group_by(wave_taf) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up TAF COPING to wide format
```{r TAF COPING wide format}
if(COPING == TRUE) {
dat.raw.taf.coping.wide <- dat.raw.taf.coping %>%
  group_by(wave_taf) %>%
  tidyr::pivot_wider(id_cols = ID,
                     names_from = wave_taf,
                     values_from = c(taf.worth_living_life_people,
                              taf.felt_weeks_past,
                              taf.have_you_contemplated_harming_yourself,
                              taf.felt_weeks_past.1,
                              taf.meant_life_end_weeks))

}
```

Select variables for dataset TAF COPING
```{r Select variables COPING follow up TAF}
if(COPING == TRUE) {
dat.raw.taf.coping <- dat.raw.taf.coping.wide %>%
  select(ID,
         `taf.worth_living_life_people_.Wave_2a`,
         `taf.worth_living_life_people_.Wave_2b`,
         `taf.worth_living_life_people_.Wave_3a`,
         `taf.worth_living_life_people_.Wave_3b`,
         `taf.worth_living_life_people_.Wave_4a`,
         `taf.worth_living_life_people_.Wave_4b`,
         `taf.worth_living_life_people_.Wave_5a`,
         `taf.worth_living_life_people_.Wave_6b`,
         `taf.worth_living_life_people_.Wave_7a`,
         `taf.worth_living_life_people_.Wave_8b`,
         `taf.worth_living_life_people_.Wave_9a`,
         `taf.worth_living_life_people_.Wave_10b`,
         `taf.worth_living_life_people_.Wave_11a`,
         `taf.worth_living_life_people_.Wave_12b`,
         `taf.worth_living_life_people_.Wave_13a`,
         `taf.worth_living_life_people_.Wave_14b`,
         `taf.worth_living_life_people_.Wave_15a`,
         `taf.worth_living_life_people_.Wave_16b`,

         `taf.felt_weeks_past_.Wave_2a`,
         `taf.felt_weeks_past_.Wave_2b`,
         `taf.felt_weeks_past_.Wave_3a`,
         `taf.felt_weeks_past_.Wave_3b`,
         `taf.felt_weeks_past_.Wave_4a`,
         `taf.felt_weeks_past_.Wave_4b`,
         `taf.felt_weeks_past_.Wave_5a`,
         `taf.felt_weeks_past_.Wave_6b`,
         `taf.felt_weeks_past_.Wave_7a`,
         `taf.felt_weeks_past_.Wave_8b`,
         `taf.felt_weeks_past_.Wave_9a`,
         `taf.felt_weeks_past_.Wave_10b`,
         `taf.felt_weeks_past_.Wave_11a`,
          `taf.felt_weeks_past_.Wave_12b`,
         `taf.felt_weeks_past_.Wave_13a`,
         `taf.felt_weeks_past_.Wave_14b`,
         `taf.felt_weeks_past_.Wave_15a`,
         `taf.felt_weeks_past_.Wave_16b`,
       
           `taf.have_you_contemplated_harming_yourself_.Wave_2a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_2b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_5a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_6b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_7a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_8b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_9a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_10b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_11a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_12b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_13a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_14b`,
         `taf.have_you_contemplated_harming_yourself_.Wave_15a`,
         `taf.have_you_contemplated_harming_yourself_.Wave_16b`,

         `taf.felt_weeks_past.1_.Wave_2a`,
         `taf.felt_weeks_past.1_.Wave_2b`,
         `taf.felt_weeks_past.1_.Wave_3a`,
         `taf.felt_weeks_past.1_.Wave_3b`,
         `taf.felt_weeks_past.1_.Wave_4a`,
         `taf.felt_weeks_past.1_.Wave_4b`,
         `taf.felt_weeks_past.1_.Wave_5a`,
         `taf.felt_weeks_past.1_.Wave_6b`,
         `taf.felt_weeks_past.1_.Wave_7a`,
         `taf.felt_weeks_past.1_.Wave_8b`,
         `taf.felt_weeks_past.1_.Wave_9a`,
         `taf.felt_weeks_past.1_.Wave_10b`,
         `taf.felt_weeks_past.1_.Wave_11a`,
         `taf.felt_weeks_past.1_.Wave_12b`,
         `taf.felt_weeks_past.1_.Wave_13a`,
         `taf.felt_weeks_past.1_.Wave_14b`,
         `taf.felt_weeks_past.1_.Wave_15a`,
         `taf.felt_weeks_past.1_.Wave_16b`,

         `taf.meant_life_end_weeks_.Wave_2a`,
         `taf.meant_life_end_weeks_.Wave_2b`,
         `taf.meant_life_end_weeks_.Wave_3a`,
         `taf.meant_life_end_weeks_.Wave_3b`,
         `taf.meant_life_end_weeks_.Wave_4a`,
         `taf.meant_life_end_weeks_.Wave_4b`,
         `taf.meant_life_end_weeks_.Wave_5a`,
         `taf.meant_life_end_weeks_.Wave_6b`,
         `taf.meant_life_end_weeks_.Wave_7a`,
         `taf.meant_life_end_weeks_.Wave_8b`,
         `taf.meant_life_end_weeks_.Wave_9a`,
         `taf.meant_life_end_weeks_.Wave_10b`,
         `taf.meant_life_end_weeks_.Wave_11a`,
         `taf.meant_life_end_weeks_.Wave_12b`,
         `taf.meant_life_end_weeks_.Wave_13a`,
         `taf.meant_life_end_weeks_.Wave_14b`,
         `taf.meant_life_end_weeks_.Wave_15a`,
         `taf.meant_life_end_weeks_.Wave_16b`,
         `taf.meant_life_end_weeks_.Wave_17a`,
       
         `taf.worth_living_life_people_.Wave_2a_dup`,
         `taf.worth_living_life_people_.Wave_2b_dup`,
         `taf.worth_living_life_people_.Wave_3a_dup`,
         `taf.worth_living_life_people_.Wave_3b_dup`,
         `taf.worth_living_life_people_.Wave_4a_dup`,
         `taf.worth_living_life_people_.Wave_4b_dup`,
         `taf.worth_living_life_people_.Wave_5a_dup`,
         `taf.worth_living_life_people_.Wave_6b_dup`,
         `taf.worth_living_life_people_.Wave_7a_dup`,
         `taf.worth_living_life_people_.Wave_8b_dup`,
         `taf.worth_living_life_people_.Wave_9a_dup`,
         `taf.worth_living_life_people_.Wave_10b_dup`,
         `taf.worth_living_life_people_.Wave_11a_dup`,
         `taf.worth_living_life_people_.Wave_12b_dup`,
         `taf.worth_living_life_people_.Wave_13a_dup`,
         `taf.worth_living_life_people_.Wave_14b_dup`,
         `taf.worth_living_life_people_.Wave_15a_dup`,
         `taf.worth_living_life_people_.Wave_16b_dup`,
         
         `taf.felt_weeks_past_.Wave_2a_dup`,
         `taf.felt_weeks_past_.Wave_2b_dup`,
         `taf.felt_weeks_past_.Wave_3a_dup`,
         `taf.felt_weeks_past_.Wave_3b_dup`,
         `taf.felt_weeks_past_.Wave_4a_dup`,
         `taf.felt_weeks_past_.Wave_4b_dup`,
         `taf.felt_weeks_past_.Wave_5a_dup`,
         `taf.felt_weeks_past_.Wave_6b_dup`,
         `taf.felt_weeks_past_.Wave_7a_dup`,
         `taf.felt_weeks_past_.Wave_8b_dup`,
         `taf.felt_weeks_past_.Wave_9a_dup`,
         `taf.felt_weeks_past_.Wave_10b_dup`,
         `taf.felt_weeks_past_.Wave_11a_dup`,
          `taf.felt_weeks_past_.Wave_12b_dup`,
         `taf.felt_weeks_past_.Wave_13a_dup`,
         `taf.felt_weeks_past_.Wave_14b_dup`,
         `taf.felt_weeks_past_.Wave_15a_dup`,
         `taf.felt_weeks_past_.Wave_16b_dup`,
       
         `taf.have_you_contemplated_harming_yourself_.Wave_2a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_2b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_3b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_4b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_5a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_6b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_7a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_8b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_9a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_10b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_11a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_12b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_13a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_14b_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_15a_dup`,
         `taf.have_you_contemplated_harming_yourself_.Wave_16b_dup`,

         `taf.felt_weeks_past.1_.Wave_2a_dup`,
         `taf.felt_weeks_past.1_.Wave_2b_dup`,
         `taf.felt_weeks_past.1_.Wave_3a_dup`,
         `taf.felt_weeks_past.1_.Wave_3b_dup`,
         `taf.felt_weeks_past.1_.Wave_4a_dup`,
         `taf.felt_weeks_past.1_.Wave_4b_dup`,
         `taf.felt_weeks_past.1_.Wave_5a_dup`,
         `taf.felt_weeks_past.1_.Wave_6b_dup`,
         `taf.felt_weeks_past.1_.Wave_7a_dup`,
         `taf.felt_weeks_past.1_.Wave_8b_dup`,
         `taf.felt_weeks_past.1_.Wave_9a_dup`,
         `taf.felt_weeks_past.1_.Wave_10b_dup`,
         `taf.felt_weeks_past.1_.Wave_11a_dup`,
         `taf.felt_weeks_past.1_.Wave_12b_dup`,
         `taf.felt_weeks_past.1_.Wave_13a_dup`,
         `taf.felt_weeks_past.1_.Wave_14b_dup`,
         `taf.felt_weeks_past.1_.Wave_15a_dup`,
         `taf.felt_weeks_past.1_.Wave_16b_dup`,
       
         `taf.meant_life_end_weeks_.Wave_2a_dup`,
         `taf.meant_life_end_weeks_.Wave_2b_dup`,
         `taf.meant_life_end_weeks_.Wave_3a_dup`,
         `taf.meant_life_end_weeks_.Wave_3b_dup`,
         `taf.meant_life_end_weeks_.Wave_4a_dup`,
         `taf.meant_life_end_weeks_.Wave_4b_dup`,
         `taf.meant_life_end_weeks_.Wave_5a_dup`,
         `taf.meant_life_end_weeks_.Wave_6b_dup`,
         `taf.meant_life_end_weeks_.Wave_7a_dup`,
         `taf.meant_life_end_weeks_.Wave_8b_dup`,
         `taf.meant_life_end_weeks_.Wave_9a_dup`,
         `taf.meant_life_end_weeks_.Wave_10b_dup`,
         `taf.meant_life_end_weeks_.Wave_11a_dup`,
         `taf.meant_life_end_weeks_.Wave_12b_dup`,
         `taf.meant_life_end_weeks_.Wave_13a_dup`,
         `taf.meant_life_end_weeks_.Wave_14b_dup`,
         `taf.meant_life_end_weeks_.Wave_15a_dup`,
         `taf.meant_life_end_weeks_.Wave_16b_dup`
         )
}
```

Remove duplicate IDs TAF COPING
```{r Remove duplicate IDs TAF COPING}
if(COPING == TRUE) {
# Check col names
colnames(dat.raw.taf.coping)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
dat.raw.taf.coping  <- dat.raw.taf.coping  %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(dat.raw.taf.coping)
}

```


# TIMEPOINTS / PHASES - RESP COPING 
Join COPING resp datasets follow ups
```{r Merge COPING resp}
if(COPING == TRUE) {
coping.followup.resp.id <- coping.followupa.resp.id %>%
  bind_rows(coping.followupb.resp.id)

# Check column names
colnames(coping.followup.resp.id)
}
```

Check number of entries per wave
```{r Check number of entries per wave COPING resp}
if(COPING == TRUE) {
coping.followup.resp.id %>%
  group_by(wave_resp) %>%
  count()
}
```

Idenfity duplicate IDs in a single wave
```{r Idenfity duplicate IDs in a single wave COPING resp}
if(COPING == TRUE) {
# Identify dup IDs in a single wave
coping.followup.resp.id %>%
   group_by(wave_resp, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```
```{r count both entries dup IDs single phase COPING resp}
if(COPING == TRUE) {
# Confirm number of rows in current dataset 
nrow(coping.followup.resp.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- coping.followup.resp.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_resp,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- coping.followup.resp.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_resp,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
coping.followup.resp.id <- coping.followup.resp.id %>%
   group_by(wave_resp,
            ID) %>%
    filter(
       (!duplicated(wave_resp,
                        fromLast = TRUE)) &
        (!duplicated(wave_resp,
                   fromLast = FALSE))
      ) 

coping.followup.resp.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind COPING and bound duplicated IDs data
coping.followup.resp.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      coping.followup.resp.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
coping.followup.resp.id <- coping.followup.resp.id %>%
  mutate(wave_resp =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_resp, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_resp 
          )
)

# Check
check <- coping.followup.resp.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_resp)

check2 <- coping.followup.resp.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_resp)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs resp coping}
if(COPING == TRUE) {
coping.followup.resp.id <- coping.followup.resp.id %>%
  group_by(wave_resp) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up COPING resp to wide format
```{r COPING resp wide format}
if(COPING == TRUE) {
coping.followup.resp.id <- coping.followup.resp.id %>%
  group_by(wave_resp) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_resp, 
                     values_from = c(
                       resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.results_nosethroat_swab_test)) 
  
} 
```

Select variables for dataset COPING resp
```{r Select variables for dataset COPING resp}
if(COPING == TRUE) {
coping.followup.resp.id <- coping.followup.resp.id  %>%
  select(ID,
         `resp.coronavirus_test_nosethroat_swab_.Wave_2a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_2b` ,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3b` , 
         `resp.coronavirus_test_nosethroat_swab_.Wave_4a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_4b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_5a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_6b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_7a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_8b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_9a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_10b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_11a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_12b`,
        `resp.coronavirus_test_nosethroat_swab_.Wave_13a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_14b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_15a`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_16b`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_17a`,
         
         `resp.results_nosethroat_swab_test_.Wave_2a`,
         `resp.results_nosethroat_swab_test_.Wave_2b` ,
         `resp.results_nosethroat_swab_test_.Wave_3a`,
         `resp.results_nosethroat_swab_test_.Wave_3b` , 
         `resp.results_nosethroat_swab_test_.Wave_4a`,
         `resp.results_nosethroat_swab_test_.Wave_4b`,
         `resp.results_nosethroat_swab_test_.Wave_5a`,
         `resp.results_nosethroat_swab_test_.Wave_6b`,
         `resp.results_nosethroat_swab_test_.Wave_7a`,
         `resp.results_nosethroat_swab_test_.Wave_8b`,
         `resp.results_nosethroat_swab_test_.Wave_9a`,
         `resp.results_nosethroat_swab_test_.Wave_10b`,
         `resp.results_nosethroat_swab_test_.Wave_11a`,
         `resp.results_nosethroat_swab_test_.Wave_12b`,
        `resp.results_nosethroat_swab_test_.Wave_13a`,
         `resp.results_nosethroat_swab_test_.Wave_14b`,
         `resp.results_nosethroat_swab_test_.Wave_15a`,
         `resp.results_nosethroat_swab_test_.Wave_16b`,
         `resp.results_nosethroat_swab_test_.Wave_17a`,
         
         `resp.coronavirus_antibody_test_.Wave_2a`,
         `resp.coronavirus_antibody_test_.Wave_2b` ,
         `resp.coronavirus_antibody_test_.Wave_3a`,
         `resp.coronavirus_antibody_test_.Wave_3b` , 
         `resp.coronavirus_antibody_test_.Wave_4a`,
         `resp.coronavirus_antibody_test_.Wave_4b`,
         `resp.coronavirus_antibody_test_.Wave_5a`,
         `resp.coronavirus_antibody_test_.Wave_6b`,
         `resp.coronavirus_antibody_test_.Wave_7a`,
         `resp.coronavirus_antibody_test_.Wave_8b`,
         `resp.coronavirus_antibody_test_.Wave_9a`,
         `resp.coronavirus_antibody_test_.Wave_10b`,
         `resp.coronavirus_antibody_test_.Wave_11a`,
         `resp.coronavirus_antibody_test_.Wave_12b`,
         `resp.coronavirus_antibody_test_.Wave_13a`,
         `resp.coronavirus_antibody_test_.Wave_14b`,
         `resp.coronavirus_antibody_test_.Wave_15a`,
         `resp.coronavirus_antibody_test_.Wave_16b`,
         `resp.coronavirus_antibody_test_.Wave_17a`,
         
         `resp.coronavirus_antibody_test_.Wave_2a`,
         `resp.coronavirus_antibody_test_.Wave_2b` ,
         `resp.coronavirus_antibody_test_.Wave_3a`,
         `resp.coronavirus_antibody_test_.Wave_3b` , 
         `resp.coronavirus_antibody_test_.Wave_4a`,
         `resp.coronavirus_antibody_test_.Wave_4b`,
         `resp.coronavirus_antibody_test_.Wave_5a`,
         `resp.coronavirus_antibody_test_.Wave_6b`,
         `resp.coronavirus_antibody_test_.Wave_7a`,
         `resp.coronavirus_antibody_test_.Wave_8b`,
         `resp.coronavirus_antibody_test_.Wave_9a`,
         `resp.coronavirus_antibody_test_.Wave_10b`,
         `resp.coronavirus_antibody_test_.Wave_11a`,
         `resp.coronavirus_antibody_test_.Wave_12b`,
         `resp.coronavirus_antibody_test_.Wave_13a`,
         `resp.coronavirus_antibody_test_.Wave_14b`,
         `resp.coronavirus_antibody_test_.Wave_15a`,
         `resp.coronavirus_antibody_test_.Wave_16b`,
         `resp.coronavirus_antibody_test_.Wave_17a`,
       
         `resp.coronavirus_test_nosethroat_swab_.Wave_2a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_2b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_3b_dup`, 
         `resp.coronavirus_test_nosethroat_swab_.Wave_4a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_4b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_5a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_6b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_7a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_8b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_9a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_10b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_11a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_12b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_13a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_14b_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_15a_dup`,
         `resp.coronavirus_test_nosethroat_swab_.Wave_16b_dup`,
       
         `resp.results_nosethroat_swab_test_.Wave_2a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_2b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_3a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_3b_dup`, 
         `resp.results_nosethroat_swab_test_.Wave_4a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_4b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_5a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_6b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_7a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_8b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_9a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_10b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_11a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_12b_dup`,
        `resp.results_nosethroat_swab_test_.Wave_13a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_14b_dup`,
         `resp.results_nosethroat_swab_test_.Wave_15a_dup`,
         `resp.results_nosethroat_swab_test_.Wave_16b_dup`,
      
         `resp.coronavirus_antibody_test_.Wave_2a_dup`,
         `resp.coronavirus_antibody_test_.Wave_2b_dup`,
         `resp.coronavirus_antibody_test_.Wave_3a_dup`,
         `resp.coronavirus_antibody_test_.Wave_3b_dup`, 
         `resp.coronavirus_antibody_test_.Wave_4a_dup`,
         `resp.coronavirus_antibody_test_.Wave_4b_dup`,
         `resp.coronavirus_antibody_test_.Wave_5a_dup`,
         `resp.coronavirus_antibody_test_.Wave_6b_dup`,
         `resp.coronavirus_antibody_test_.Wave_7a_dup`,
         `resp.coronavirus_antibody_test_.Wave_8b_dup`,
         `resp.coronavirus_antibody_test_.Wave_9a_dup`,
         `resp.coronavirus_antibody_test_.Wave_10b_dup`,
         `resp.coronavirus_antibody_test_.Wave_11a_dup`,
         `resp.coronavirus_antibody_test_.Wave_12b_dup`,
        `resp.coronavirus_antibody_test_.Wave_13a_dup`,
         `resp.coronavirus_antibody_test_.Wave_14b_dup`,
         `resp.coronavirus_antibody_test_.Wave_15a_dup`,
         `resp.coronavirus_antibody_test_.Wave_16b_dup`,
       
         `resp.coronavirus_antibody_test_.Wave_2a_dup`,
         `resp.coronavirus_antibody_test_.Wave_2b_dup`,
         `resp.coronavirus_antibody_test_.Wave_3a_dup`,
         `resp.coronavirus_antibody_test_.Wave_3b_dup`, 
         `resp.coronavirus_antibody_test_.Wave_4a_dup`,
         `resp.coronavirus_antibody_test_.Wave_4b_dup`,
         `resp.coronavirus_antibody_test_.Wave_5a_dup`,
         `resp.coronavirus_antibody_test_.Wave_6b_dup`,
         `resp.coronavirus_antibody_test_.Wave_7a_dup`,
         `resp.coronavirus_antibody_test_.Wave_8b_dup`,
         `resp.coronavirus_antibody_test_.Wave_9a_dup`,
         `resp.coronavirus_antibody_test_.Wave_10b_dup`,
         `resp.coronavirus_antibody_test_.Wave_11a_dup`,
         `resp.coronavirus_antibody_test_.Wave_12b_dup`,
         `resp.coronavirus_antibody_test_.Wave_13a_dup`,
         `resp.coronavirus_antibody_test_.Wave_14b_dup`,
         `resp.coronavirus_antibody_test_.Wave_15a_dup`,
         `resp.coronavirus_antibody_test_.Wave_16b_dup`
       )
}
```

Remove duplicate COPING resp screener
```{r Remove duplicate IDs COPING resp}
if(COPING == TRUE) {
# Check col names
colnames(coping.followup.resp.id)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
coping.followup.resp.id  <- coping.followup.resp.id  %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(coping.followup.resp.id)
}

```

# TIMEPOINTS / PHASES - loss of a loved one due to COVID COPING
```{r Identify phase dates loss of a loved one due to COVID COPING}
if (COPING ==TRUE) {
source("./timepoints_COPING.R")
}
```

Count number of entries per phase loss of a loved one due to COVID COPING
```{r Count entries per phase loss of a loved one due to COVID COPING}
if(COPING == TRUE) {
coping.loss.followupb.raw.id %>%
  group_by(wave_loss) %>%
  count()
}
```

Identify duplicate IDs in a single timepoint
```{r Identify duplicate IDs in a single timepoint loss of a loved one due to COVID COPING}
if(COPING == TRUE) {
##Identify dup IDs in a single wave 
coping.loss.followupb.raw.id %>%
   group_by(wave_loss, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase COPING loss}
if(COPING == TRUE) {
# Confirm number of rows in current dataset 
nrow(coping.loss.followupb.raw.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- coping.loss.followupb.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_loss,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- coping.loss.followupb.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_loss,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
coping.loss.followupb.raw.id <- coping.loss.followupb.raw.id %>%
   group_by(wave_loss,
            ID) %>%
    filter(
       (!duplicated(wave_loss,
                        fromLast = TRUE)) &
        (!duplicated(wave_loss,
                   fromLast = FALSE))
      ) 

coping.loss.followupb.raw.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind COPING and bound duplicated IDs data
coping.loss.followupb.raw.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      coping.loss.followupb.raw.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
coping.loss.followupb.raw.id <- coping.loss.followupb.raw.id %>%
  mutate(wave_loss =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_loss, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_loss 
          )
)

# Check
check <- coping.loss.followupb.raw.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_loss)

check2 <- coping.loss.followupb.raw.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_loss)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs virus coping}
if(COPING == TRUE) {
coping.loss.followupb.raw.id <- coping.loss.followupb.raw.id %>%
  group_by(wave_loss) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up loss of a loved one due to COVID COPING to wide format
```{r Loss of a loved one due to COVID COPING wide format}
if(COPING == TRUE) {
coping.loss.followupb.raw.id <- coping.loss.followupb.raw.id %>%
  group_by(wave_loss) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_loss, 
                     values_from = c( grief.due_past_month_lost,
                                      grief.suffered_past_month_loss
                       )) 
  
}
```

Select variables for dataset loss of a loved one due to COVID COPING
```{r Select variables loss of a loved one due to COVID COPING}
if(COPING == TRUE) {
coping.loss.followupb.raw.id <- coping.loss.followupb.raw.id %>%
  select(ID,
         `grief.due_past_month_lost_.Wave_2b`,
         `grief.due_past_month_lost_.Wave_3b`,
         `grief.due_past_month_lost_.Wave_4b`,
         `grief.due_past_month_lost_.Wave_6b`,
         `grief.due_past_month_lost_.Wave_8b`,
         `grief.due_past_month_lost_.Wave_10b`,
         `grief.due_past_month_lost_.Wave_12b`,
         `grief.due_past_month_lost_.Wave_14b`,
         `grief.due_past_month_lost_.Wave_16b`,
         
         `grief.suffered_past_month_loss_.Wave_2b`,
         `grief.suffered_past_month_loss_.Wave_3b`,
         `grief.suffered_past_month_loss_.Wave_4b`,
         `grief.suffered_past_month_loss_.Wave_6b`,
         `grief.suffered_past_month_loss_.Wave_8b`,
         `grief.suffered_past_month_loss_.Wave_10b`,
         `grief.suffered_past_month_loss_.Wave_12b`,
         `grief.suffered_past_month_loss_.Wave_14b`,
         `grief.suffered_past_month_loss_.Wave_16b`,
       
       # Duplicated entries
         `grief.due_past_month_lost_.Wave_2b_dup`,
         `grief.due_past_month_lost_.Wave_3b_dup`,
         `grief.due_past_month_lost_.Wave_4b_dup`,
         `grief.due_past_month_lost_.Wave_6b_dup`,
         `grief.due_past_month_lost_.Wave_8b_dup`,
         `grief.due_past_month_lost_.Wave_10b_dup`,
         `grief.due_past_month_lost_.Wave_12b_dup`,
         `grief.due_past_month_lost_.Wave_14b_dup`,
         `grief.due_past_month_lost_.Wave_16b_dup`,
         
         `grief.suffered_past_month_loss_.Wave_2b_dup`,
         `grief.suffered_past_month_loss_.Wave_3b_dup`,
         `grief.suffered_past_month_loss_.Wave_4b_dup`,
         `grief.suffered_past_month_loss_.Wave_6b_dup`,
         `grief.suffered_past_month_loss_.Wave_8b_dup`,
         `grief.suffered_past_month_loss_.Wave_10b_dup`,
         `grief.suffered_past_month_loss_.Wave_12b_dup`,
         `grief.suffered_past_month_loss_.Wave_14b_dup`,
         `grief.suffered_past_month_loss_.Wave_16b_dup`
          
         )
}
```

Remove duplicate IDs loss of a loved one due to COVID COPING
```{r Remove duplicate IDs loss of a loved one due to COVID COPING}
if(COPING == TRUE) {
##Check col names
colnames(coping.loss.followupb.raw.id)
##Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
coping.loss.followupb.raw.id  <- coping.loss.followupb.raw.id %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 
##Check number of rows
nrow(coping.loss.followupb.raw.id)
}
```

# TIMEPOINTS / PHASES - COPING EDEQ SCREENER 
```{r Check number of entries per phase COPING EDEQ screener}
if(COPING == TRUE) {
edeq.coping.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>%
  count()
}
```

Idenfity duplicate IDs in a single phase COPING EDEQ screener 
```{r Idenfity duplicate IDs in a single phase COPING EDEQ screener }
if(COPING == TRUE) {

# Identify dup IDs in a single wave
edeq.coping.followupb.screener.raw.id %>%
   group_by(wave_edeq, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase COPING EDEQ screener}
if(COPING == TRUE) {
# Confirm number of rows in current dataset 
nrow(edeq.coping.followupb.screener.raw.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- edeq.coping.followupb.screener.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_edeq,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- edeq.coping.followupb.screener.raw.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_edeq,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw.id %>%
   group_by(wave_edeq,
            ID) %>%
    filter(
       (!duplicated(wave_edeq,
                        fromLast = TRUE)) &
        (!duplicated(wave_edeq,
                   fromLast = FALSE))
      ) 

edeq.coping.followupb.screener.raw.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind COPING and bound duplicated IDs data
edeq.coping.followupb.screener.raw.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      edeq.coping.followupb.screener.raw.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw.id %>%
  mutate(wave_edeq =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_edeq, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_edeq 
          )
)

# Check
check <- edeq.coping.followupb.screener.raw.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_edeq)

check2 <- edeq.coping.followupb.screener.raw.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_edeq)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs edeq screener coping}
if(COPING == TRUE) {
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up EDEQ COPING screener to wide format 
```{r COPING EDEQ screener wide format}
if(COPING == TRUE) {
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw.id %>%
  group_by(wave_edeq) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_edeq,
                     values_from = c(ed_scid5.regular_episodes_eating_binges,
                     ed_scid5.weigh_weighed_past_month,
                     ed_scid5.regular_episodes_eating_binges_numeric,
                     ed_scid5.weigh_weighed_past_month_numeric))
}
```

Select variables for dataset EDEQ COPING screener
```{r Select variables EDEQ COPING screener}
if(COPING == TRUE) {
edeq.coping.followupb.screener.raw.id <- edeq.coping.followupb.screener.raw.id  %>%
  select(ID,
         `ed_scid5.regular_episodes_eating_binges_.Wave_2b` ,    
         `ed_scid5.regular_episodes_eating_binges_.Wave_3b` ,       
         `ed_scid5.regular_episodes_eating_binges_.Wave_4b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_6b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_8b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_10b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_12b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_14b`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_16b`,
         
         `ed_scid5.weigh_weighed_past_month_.Wave_2b` ,    
         `ed_scid5.weigh_weighed_past_month_.Wave_3b` ,       
         `ed_scid5.weigh_weighed_past_month_.Wave_4b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_6b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_8b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_10b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_12b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_14b`,
         `ed_scid5.weigh_weighed_past_month_.Wave_16b`,
         
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_2b` ,    
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_3b` ,       
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_4b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_6b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_8b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_10b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_12b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_14b`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_16b`,
         
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_2b` ,    
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_3b` ,       
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_4b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_6b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_8b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_10b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_12b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_14b`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_16b`,
        
        # Duplicated entries
         `ed_scid5.regular_episodes_eating_binges_.Wave_2b_dup`,  
         `ed_scid5.regular_episodes_eating_binges_.Wave_3b_dup`,     
         `ed_scid5.regular_episodes_eating_binges_.Wave_4b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_6b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_8b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_10b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_12b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_14b_dup`,
         `ed_scid5.regular_episodes_eating_binges_.Wave_16b_dup`,
         
         `ed_scid5.weigh_weighed_past_month_.Wave_2b_dup`,  
         `ed_scid5.weigh_weighed_past_month_.Wave_3b_dup`,     
         `ed_scid5.weigh_weighed_past_month_.Wave_4b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_6b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_8b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_10b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_12b_dup`,
         `ed_scid5.weigh_weighed_past_month_.Wave_14b_dup`,
        `ed_scid5.weigh_weighed_past_month_.Wave_16b_dup`,
         
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_2b_dup`,  
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_3b_dup`,     
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_4b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_6b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_8b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_10b_dup`,
         `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_12b_dup`,
        `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_14b_dup`,
        `ed_scid5.regular_episodes_eating_binges_numeric_.Wave_16b_dup`,
         
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_2b_dup`,  
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_3b_dup`,     
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_4b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_6b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_8b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_10b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_12b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_14b_dup`,
         `ed_scid5.weigh_weighed_past_month_numeric_.Wave_16b_dup`
        )
}
```

Remove duplicate IDs EDEQ COPING screener
```{r Remove duplicate IDs EDEQ COPING screener}
if(COPING == TRUE) {
# Check col names
colnames(edeq.coping.followupb.screener.raw.id)

# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
edeq.coping.followupb.screener.raw.id  <- edeq.coping.followupb.screener.raw.id  %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(edeq.coping.followupb.screener.raw.id)
}

```

# TIMEPOINTS / PHASES - Virus info COPING
```{r Check number of entries per phase COPING EDEQ screener}
if(COPING == TRUE) {
coping.followupb.virus.id %>%
  group_by(wave_virus) %>%
  count()
}
```

Idenfity duplicate IDs in a single phase COPING EDEQ screener 
```{r Idenfity duplicate IDs in a single phase COPING EDEQ screener }
if(COPING == TRUE) {

# Identify dup IDs in a single wave
coping.followupb.virus.id %>%
   group_by(wave_virus, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase COPING EDEQ screener}
if(COPING == TRUE) {
# Confirm number of rows in current dataset 
nrow(coping.followupb.virus.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- coping.followupb.virus.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_virus,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- coping.followupb.virus.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_virus,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
coping.followupb.virus.id <- coping.followupb.virus.id %>%
   group_by(wave_virus,
            ID) %>%
    filter(
       (!duplicated(wave_virus,
                        fromLast = TRUE)) &
        (!duplicated(wave_virus,
                   fromLast = FALSE))
      ) 

coping.followupb.virus.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind COPING and bound duplicated IDs data
coping.followupb.virus.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      coping.followupb.virus.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
coping.followupb.virus.id <- coping.followupb.virus.id %>%
  mutate(wave_virus =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_virus, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_virus 
          )
)

# Check
check <- coping.followupb.virus.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_virus)

check2 <- coping.followupb.virus.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_virus)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs virus coping}
if(COPING == TRUE) {
coping.followupb.virus.id <- coping.followupb.virus.id %>%
  group_by(wave_virus) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up COPING VIRUS to wide format 
```{r Virus info COPING wide format}
if(COPING == TRUE) {
coping.followupb.virus.id <- coping.followupb.virus.id %>%
  group_by(wave_virus) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_virus,
                     values_from = c(virus.back_positive_antibodies_tests,
                     virus.back_positive_antibodies_tests_numeric,
                     virus.past_surveys_include_covid19,
                     virus.past_surveys_include_covid19_numeric))
  
}
```

Select variables for dataset COPING VIRUS
```{r Select variables COPING VIRUS}
if(COPING == TRUE) {
coping.followupb.virus.id <- coping.followupb.virus.id  %>%
  select(ID,
         `virus.back_positive_antibodies_tests_.Wave_2b` ,    
         `virus.back_positive_antibodies_tests_.Wave_3b` ,       
         `virus.back_positive_antibodies_tests_.Wave_4b`,
         `virus.back_positive_antibodies_tests_.Wave_6b`,
         `virus.back_positive_antibodies_tests_.Wave_8b`,
         `virus.back_positive_antibodies_tests_.Wave_10b`,
         `virus.back_positive_antibodies_tests_.Wave_12b`,
         `virus.back_positive_antibodies_tests_.Wave_14b`,
         `virus.back_positive_antibodies_tests_.Wave_16b`,
         
         `virus.back_positive_antibodies_tests_numeric_.Wave_2b` ,    
         `virus.back_positive_antibodies_tests_numeric_.Wave_3b` ,       
         `virus.back_positive_antibodies_tests_numeric_.Wave_4b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_6b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_8b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_10b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_12b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_14b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_16b`,
         
         `virus.past_surveys_include_covid19_.Wave_2b` ,    
         `virus.past_surveys_include_covid19_.Wave_3b` ,       
         `virus.past_surveys_include_covid19_.Wave_4b`,
         `virus.past_surveys_include_covid19_.Wave_6b`,
         `virus.past_surveys_include_covid19_.Wave_8b`,
         `virus.past_surveys_include_covid19_.Wave_10b`,
         `virus.past_surveys_include_covid19_.Wave_12b`,
         `virus.past_surveys_include_covid19_.Wave_14b`,
         `virus.past_surveys_include_covid19_.Wave_16b`,
         
         `virus.past_surveys_include_covid19_numeric_.Wave_2b` ,    
         `virus.past_surveys_include_covid19_numeric_.Wave_3b` ,       
         `virus.past_surveys_include_covid19_numeric_.Wave_4b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_6b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_8b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_10b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_12b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_14b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_16b`,
         
         # Duplicated entries
          `virus.back_positive_antibodies_tests_.Wave_2b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_3b_dup`,   
         `virus.back_positive_antibodies_tests_.Wave_4b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_6b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_8b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_10b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_12b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_14b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_16b_dup`,
         
         `virus.back_positive_antibodies_tests_numeric_.Wave_2b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_3b_dup`,   
         `virus.back_positive_antibodies_tests_numeric_.Wave_4b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_6b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_8b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_10b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_12b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_14b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_16b_dup`,
         
          `virus.past_surveys_include_covid19_.Wave_2b_dup`,
         `virus.past_surveys_include_covid19_.Wave_3b_dup`,   
         `virus.past_surveys_include_covid19_.Wave_4b_dup`,
         `virus.past_surveys_include_covid19_.Wave_6b_dup`,
         `virus.past_surveys_include_covid19_.Wave_8b_dup`,
         `virus.past_surveys_include_covid19_.Wave_10b_dup`,
         `virus.past_surveys_include_covid19_.Wave_12b_dup`,
         `virus.past_surveys_include_covid19_.Wave_14b_dup`,
         `virus.past_surveys_include_covid19_.Wave_16b_dup`,
         
         `virus.past_surveys_include_covid19_numeric_.Wave_2b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_3b_dup`,   
         `virus.past_surveys_include_covid19_numeric_.Wave_4b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_6b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_8b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_10b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_12b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_14b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_16b_dup`
         
        )
}
```

Remove duplicate IDs COPING VIRUS
```{r Remove duplicate IDs COPING VIRUS}
if(COPING == TRUE) {
# Check col names
colnames(coping.followupb.virus.id)
# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
coping.followupb.virus.id  <- coping.followupb.virus.id  %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 

# Check number of rows
nrow(coping.followupb.virus.id)
}
```

# TIMEPOINTS / PHASES - Virus info RAMP
```{r Check number of entries per phase RAMP virus}
if(RAMP == TRUE) {
ramp.followupb.virus.id %>%
  group_by(wave_virus) %>%
  count()
}
```

Idenfity duplicate IDs in a single phase RAMP virus
```{r Idenfity duplicate IDs in a single phase RAMP virus}
if(RAMP == TRUE) {

# Identify dup IDs in a single wave
ramp.followupb.virus.id %>%
   group_by(wave_virus, ID) %>%
   summarize(N = n()) %>%
   filter(N > 1)
}
```

```{r count both entries dup IDs single phase RAMP virus}
if(RAMP == TRUE) {
# Confirm number of rows in current dataset 
nrow(ramp.followupb.virus.id)

# Need to split duplicated IDs into separate datasets

  # Identify IDs from the last entry
A_duplicated_IDS <- ramp.followupb.virus.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_virus,
                      fromLast = TRUE)
           ) 

A_duplicated_IDS$change_wave_name <- "FALSE" # Will not change wave name of entries

  # Identify IDs from the earlier entry
B_duplicated_IDS <- ramp.followupb.virus.id %>%
  group_by(ID) %>% 
    filter(duplicated(wave_virus,
                      fromLast = FALSE)
           )

B_duplicated_IDS$change_wave_name <- "TRUE" # Will change wave name of these entries

# Row bind duplicated IDs from A and B
dup_IDS_data <- bind_rows(A_duplicated_IDS,
                          B_duplicated_IDS)


# Create dataset of phases only answered ONCE
ramp.followupb.virus.id <- ramp.followupb.virus.id %>%
   group_by(wave_virus,
            ID) %>%
    filter(
       (!duplicated(wave_virus,
                        fromLast = TRUE)) &
        (!duplicated(wave_virus,
                   fromLast = FALSE))
      ) 

ramp.followupb.virus.id$change_wave_name <- "NOT_DUP" # These are people who have NOT answered twice within a single phase

# Row bind RAMP and bound duplicated IDs data
ramp.followupb.virus.id <- bind_rows(A_duplicated_IDS,
                      B_duplicated_IDS,
                      ramp.followupb.virus.id)

# Change wave name of one duplicated set of entries
## NB: Can keep the name of the wave variable the same in one group of data (change_wave_name = FALSE), but will need to change it for the other (doesn't matter which as will be counting both, i.e., change_wave_name = TRUE)
ramp.followupb.virus.id <- ramp.followupb.virus.id %>%
  mutate(wave_virus =
           case_when(change_wave_name == "TRUE" ~ paste0(wave_virus, "_dup"), # add "dup" to wave name to indicate it is a duplicated entry
          change_wave_name == "NOT_DUP" |
          change_wave_name == "FALSE"   ~ wave_virus 
          )
)

# Check
check <- ramp.followupb.virus.id %>%
  filter(change_wave_name == "TRUE") 

freq(check$wave_virus)

check2 <- ramp.followupb.virus.id %>%
  filter(change_wave_name != "TRUE") 

freq(check2$wave_virus)
}
```

Remove any left-over duplicated IDs 
```{r remove leftover dup IDs virus ramp}
if(RAMP == TRUE) {
ramp.followupb.virus.id <- ramp.followupb.virus.id %>%
  group_by(wave_virus) %>% 
    filter(!duplicated(ID,
                      fromLast = TRUE)
           ) 
}
```

Change follow up COPING VIRUS RAMP to wide format 
```{r RAMP VIRUS info wide format}
if(RAMP == TRUE) {
ramp.followupb.virus.id <- ramp.followupb.virus.id %>%
  group_by(wave_virus) %>%
  tidyr::pivot_wider(id_cols = ID,
    names_from = wave_virus,
                     values_from = c(virus.back_positive_antibodies_tests,
                     virus.back_positive_antibodies_tests_numeric,
                     virus.past_surveys_include_covid19,
                     virus.past_surveys_include_covid19_numeric))
  
}

```

Select variables for dataset RAMP VIRUS
```{r Select variables for RAMP VIRUS}
if(RAMP == TRUE) {
ramp.followupb.virus.id <- ramp.followupb.virus.id %>%
  select(ID,
         `virus.back_positive_antibodies_tests_.Wave_1b`,
         `virus.back_positive_antibodies_tests_.Wave_2b` ,    
         `virus.back_positive_antibodies_tests_.Wave_3b` ,       
         `virus.back_positive_antibodies_tests_.Wave_4b`,
         `virus.back_positive_antibodies_tests_.Wave_6b`,
         `virus.back_positive_antibodies_tests_.Wave_8b`,
         `virus.back_positive_antibodies_tests_.Wave_10b`,
         `virus.back_positive_antibodies_tests_.Wave_12b`,
         `virus.back_positive_antibodies_tests_.Wave_14b`,
         `virus.back_positive_antibodies_tests_.Wave_16b`,
         
         `virus.back_positive_antibodies_tests_numeric_.Wave_1b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_2b` ,    
         `virus.back_positive_antibodies_tests_numeric_.Wave_3b` ,       
         `virus.back_positive_antibodies_tests_numeric_.Wave_4b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_6b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_8b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_10b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_12b`,
          `virus.back_positive_antibodies_tests_numeric_.Wave_14b`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_16b`,
         
       
        `virus.past_surveys_include_covid19_.Wave_1b`,
         `virus.past_surveys_include_covid19_.Wave_2b` ,    
         `virus.past_surveys_include_covid19_.Wave_3b` ,       
         `virus.past_surveys_include_covid19_.Wave_4b`,
         `virus.past_surveys_include_covid19_.Wave_6b`,
         `virus.past_surveys_include_covid19_.Wave_8b`,
         `virus.past_surveys_include_covid19_.Wave_10b`,
         `virus.past_surveys_include_covid19_.Wave_12b`,
        `virus.past_surveys_include_covid19_.Wave_14b`,
         `virus.past_surveys_include_covid19_.Wave_16b`,
         
         `virus.past_surveys_include_covid19_numeric_.Wave_1b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_2b` ,    
         `virus.past_surveys_include_covid19_numeric_.Wave_3b` ,       
         `virus.past_surveys_include_covid19_numeric_.Wave_4b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_6b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_8b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_10b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_12b`,
        `virus.past_surveys_include_covid19_numeric_.Wave_14b`,
         `virus.past_surveys_include_covid19_numeric_.Wave_16b`,
        
        # Duplicated entries
        `virus.back_positive_antibodies_tests_.Wave_1b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_2b_dup`,    
         `virus.back_positive_antibodies_tests_.Wave_3b_dup`,       
         `virus.back_positive_antibodies_tests_.Wave_4b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_6b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_8b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_10b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_12b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_14b_dup`,
         `virus.back_positive_antibodies_tests_.Wave_16b_dup`,
         
         `virus.back_positive_antibodies_tests_numeric_.Wave_1b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_2b_dup`,    
         `virus.back_positive_antibodies_tests_numeric_.Wave_3b_dup`,       
         `virus.back_positive_antibodies_tests_numeric_.Wave_4b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_6b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_8b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_10b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_12b_dup`,
          `virus.back_positive_antibodies_tests_numeric_.Wave_14b_dup`,
         `virus.back_positive_antibodies_tests_numeric_.Wave_16b_dup`,
         
       
        `virus.past_surveys_include_covid19_.Wave_1b_dup`,
         `virus.past_surveys_include_covid19_.Wave_2b_dup`,    
         `virus.past_surveys_include_covid19_.Wave_3b_dup`,       
         `virus.past_surveys_include_covid19_.Wave_4b_dup`,
         `virus.past_surveys_include_covid19_.Wave_6b_dup`,
         `virus.past_surveys_include_covid19_.Wave_8b_dup`,
         `virus.past_surveys_include_covid19_.Wave_10b_dup`,
         `virus.past_surveys_include_covid19_.Wave_12b_dup`,
         `virus.past_surveys_include_covid19_.Wave_14b_dup`,
         `virus.past_surveys_include_covid19_.Wave_16b_dup`,
         
         `virus.past_surveys_include_covid19_numeric_.Wave_1b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_2b_dup`,    
         `virus.past_surveys_include_covid19_numeric_.Wave_3b_dup`,       
         `virus.past_surveys_include_covid19_numeric_.Wave_4b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_6b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_8b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_10b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_12b_dup`,
        `virus.past_surveys_include_covid19_numeric_.Wave_14b_dup`,
         `virus.past_surveys_include_covid19_numeric_.Wave_16b_dup`
        )
}
```

Remove duplicate IDs RAMP VIRUS
```{r remove duplicate IDs RAMP VIRUS}
if(RAMP == TRUE) {
# Check col names
colnames(ramp.followupb.virus.id)
# Remove dupilcate IDs (as each wave is now a column, there should be NO dup IDs)
ramp.followupb.virus.id  <- ramp.followupb.virus.id  %>%
  filter(., !duplicated(ID),
         fromLast = TRUE) 
# Check number of rows
nrow(ramp.followupb.virus.id)
}
```

# Export all follow up data
```{r Export follow up data}
if(COPING == TRUE) {

saveRDS(object = dat.raw.taf.coping, file = paste0(filepath_saved_data, "TAF_coping", date, ".rds"))
  
  saveRDS(object = edeq.coping.followupb.screener.raw.id, file = paste0(filepath_saved_data, "EDEQ_screener_coping", date, ".rds"))
  
  saveRDS(object = dat.raw.dem.coping.followup, file = paste0(filepath_saved_data, "DEM_followup_coping", date, ".rds"))
  
  saveRDS(object = coping.loss.followupb.raw.id, file = paste0(filepath_saved_data, "LOSS_coping_followup", date, ".rds"))
  
   saveRDS(object = coping.followupb.virus.id, file = paste0(filepath_saved_data, "VIRUS_coping_followup", date, ".rds"))

     saveRDS(object = coping.followup.resp.id, file = paste0(filepath_saved_data, "RESP_coping_followup", date, ".rds"))
}

if(RAMP == TRUE) {
  
  saveRDS(object = dat.raw.taf.ramp, file = paste0(filepath_saved_data, "TAF_ramp", date, ".rds"))
  
  saveRDS(object = edeq.ramp.followupb.screener.raw.id, file = paste0(filepath_saved_data, "EDEQ_screener_ramp", date, ".rds"))
  
   saveRDS(object = dat.raw.dem.ramp.followup, file = paste0(filepath_saved_data, "DEM_followup_ramp", date, ".rds"))

   saveRDS(object = ramp.loss.followupb.raw.id, file = paste0(filepath_saved_data, "LOSS_ramp_followup", date, ".rds"))
   
    saveRDS(object = ramp.followupb.virus.id, file = paste0(filepath_saved_data, "VIRUS_ramp_followup", date, ".rds"))
   
    saveRDS(object = ramp.followup.resp.id, file = paste0(filepath_saved_data, "RESP_ramp_followup", date, ".rds"))
}
```
