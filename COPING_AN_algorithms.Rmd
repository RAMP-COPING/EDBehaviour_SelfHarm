---
title: "COPING ED algorithms"
author: "Helena Davies"
date: "22/03/2021"
output: html_document
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

#### Call in library script

```{r source files}
source("./libraries.R")
```

#### Call in functions script

```{r source files}
source("./functions.R")
```

### Read in ED data: AN GLAD COPING
```{r}
dat.an.glad.coping <- readRDS(file = "../data_raw/diagnostics/an_coping_glad.rds")

# Inspect dimensions
dim(dat.an.glad.coping)
# Inspect colnames
colnames(dat.an.glad.coping)

nrow(dat.an.glad.coping)

```

### Select variables: GLAD AN
```{r glad select variables}

exclude_cols_dem <- c("ID",
                  "cohort_name")

dat.an.glad.coping.id <- dat.an.glad.coping %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% 
  add_column(cohort_name = "coping_glad", .before = "an.1.lowest_weight_weigh_weighed") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
         an.1.lowest_weight_weigh_weighed,           
         an.1.what_was_the_illness.txt,                
         an.1.low_weight_time,                         
         an.1.low_weight_time.1,                        
         an.1.low_weight_time.2,                       
         an.1.how_old_were_you_then.txt,                
         an.1.how_tall_were_you_then,                  
         an.1.how_tall_were_you_then.1,                 
         an.1.how_tall_were_you_then.2,                
         an.1.feel_fat_low_weight,                      
         an.1.gain_weight_low_weight,                  
         an.1.anorexia_nervosa_low_weight,              
         an.1.anorexia_nervosa_low_weight.1,           
         an.1.not_at_all_dependentcompletely_dependent, 
         an.1.low_weight_health_negative,              
         an.1.body_larger_low_weight,                   
         an.1.started_time_periods,                    
         an.1.low_weight_periods_stop,                  
         an.1.roughly_periods_stopped.txt,             
         an.1.for_how_long_did_your_periods_stop,       
         an.1.for_how_long_did_your_periods_stop.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.an.glad.coping.id)
# Inspect colnames
colnames(dat.an.glad.coping.id)
#Differences
dim(dat.an.glad.coping)[1]-dim(dat.an.glad.coping.id)[1]


```
### Read in ED data: AN GLAD ED100K 
```{r}
dat.an.glad.ed100k <- readRDS(file = "../data_raw/diagnostics/an_glad_ed.rds")

# Inspect dimensions
dim(dat.an.glad.ed100k)
# Inspect colnames
colnames(dat.an.glad.ed100k)

nrow(dat.an.glad.ed100k)

```



### Select variables: GLAD ED100K  ***Need to find the equivalent in the NBR dataset
```{r glad select variables}

exclude_cols_dem <- c("ID",
                  "cohort_name")

dat.an.glad.ed100k.id <- dat.an.glad.ed100k %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% 
  add_column(cohort_name = "coping_glad", .before = "an.1.people_thought_weigh_weighed") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         cohort_name, # Sample
        an.1.people_thought_weigh_weighed       
       ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.an.glad.ed100k.id)
# Inspect colnames
colnames(dat.an.glad.ed100k.id)
#Differences
dim(dat.an.glad.ed100k)[1]-dim(dat.an.glad.ed100k.id)[1]

```

### Read in ED data: GLAD ICB 
```{r}
dat.icb.glad <- readRDS(file = "../data_raw/diagnostics/icb_coping_glad.rds")

# Inspect dimensions
dim(dat.icb.glad)
# Inspect colnames
colnames(dat.icb.glad)

nrow(dat.icb.glad)

```

### Select variables: GLAD ICB
```{r glad select variables}

exclude_cols_dem <- c("ID",
                  "cohort_name")

dat.icb.glad.id <- dat.icb.glad %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% 
#  add_column(cohort_name = "coping_glad", .before = "icb.making_yourself_vomit") %>% #create new column 
  select(
         ID = externalDataReference,# ID
     #    cohort_name, # Sample
        icb.making_yourself_vomit,
        icb.laxatives,
        icb.diuretics,
        icb.weight_loss_pills,
        icb.excessive_exercise,
        icb.fasting,
        icb.other_methods,
        icb.none,
        icb.making_yourself_vomit.1,
        icb.laxatives.1,
        icb.diuretics.1,
        icb.weight_loss_pills.1,
        icb.excessive_exercise.1,
        icb.fasting.1,
        icb.other_methods.1,
        icb.none.1,
        icb.average_made_low_weight                      
       
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.icb.glad.id)
# Inspect colnames
colnames(dat.icb.glad.id)
#Differences
dim(dat.icb.glad)[1]-dim(dat.icb.glad.id)[1]

```


### Read in ED data: GLAD BE
```{r}
dat.be.glad <- readRDS(file = "../data_raw/diagnostics/be_coping_glad.rds")

# Inspect dimensions
dim(dat.be.glad)
# Inspect colnames
colnames(dat.be.glad)

nrow(dat.be.glad)

```


### Select variables: GLAD BE
```{r glad select variables}

exclude_cols_dem <- c("ID",
                  "cohort_name")

dat.be.glad.id <- dat.be.glad %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% 
 # add_column(cohort_name = "coping_glad", .before = "be.experience_regular_episodes_binge") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       #  cohort_name, # Sample
        be.experience_regular_episodes_binge                    
       
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.be.glad.id )
# Inspect colnames
colnames(dat.be.glad.id )
#Differences
dim(dat.be.glad)[1]-dim(dat.be.glad.id )[1]

```


### Read in ED data: AN NBR COPING
```{r}
dat.an.nbr.coping <- readRDS(file = "../data_raw/diagnostics/an_coping_nbr.rds")

# Inspect dimensions
dim(dat.an.nbr.coping)
# Inspect colnames
colnames(dat.an.nbr.coping)

nrow(dat.an.nbr.coping)

```

### Select variables: NBR AN
```{r glad select variables}

exclude_cols_dem <- c("ID",
                  "cohort_name")

dat.an.nbr.coping.id <- dat.an.nbr.coping %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% 
  add_column(cohort_name = "coping_nbr", .before = "an.1.lowest_weight_weigh_weighed") %>% #create new column 
  select(
         ID = subjectid,# ID
         cohort_name, # Sample
         an.1.lowest_weight_weigh_weighed,           
         an.1.what_was_the_illness.txt,                
         an.1.low_weight_time,                         
         an.1.low_weight_time.1,                        
         an.1.low_weight_time.2,                       
         an.1.how_old_were_you_then.txt,                
         an.1.how_tall_were_you_then,                  
         an.1.how_tall_were_you_then.1,                 
         an.1.how_tall_were_you_then.2,                
         an.1.feel_fat_low_weight,                      
         an.1.gain_weight_low_weight,                  
         an.1.anorexia_nervosa_low_weight,              
         an.1.anorexia_nervosa_low_weight.1,           
         an.1.not_at_all_dependentcompletely_dependent, 
         an.1.low_weight_health_negative,              
         an.1.body_larger_low_weight = an.1.body_larger_people_thought, #Rename to same as GLAD               
         an.1.started_time_periods,                    
         an.1.low_weight_periods_stop = an.1.periods_stop_low_weight, #Rename to same as GLAD                   
         an.1.roughly_periods_stopped.txt,             
         an.1.for_how_long_did_your_periods_stop,       
         an.1.for_how_long_did_your_periods_stop.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.an.nbr.coping.id)
# Inspect colnames
colnames(dat.an.nbr.coping.id)
#Differences
dim(dat.an.nbr.coping)[1]-dim(dat.an.nbr.coping.id)[1]


```



### Read in ED data: NBR ICB 
```{r}
dat.icb.nbr <- readRDS(file = "../data_raw/diagnostics/icb_coping_nbr.rds")

# Inspect dimensions
dim(dat.icb.nbr)
# Inspect colnames
colnames(dat.icb.nbr)

nrow(dat.icb.nbr)

```

### Select variables: NBR ICB
```{r glad select variables}

exclude_cols_dem <- c("ID",
                  "cohort_name")

dat.icb.nbr.id <- dat.icb.nbr %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% 
 # add_column(cohort_name = "coping_nbr", .before = "icb.making_yourself_vomit") %>% #create new column 
  select(
         ID = subjectid,# ID
      #   cohort_name, # Sample
        icb.making_yourself_vomit,
        icb.laxatives,
        icb.diuretics,
        icb.weight_loss_pills,
        icb.excessive_exercise,
        icb.fasting,
        icb.other_methods,
        icb.none,
        icb.making_yourself_vomit.1,
        icb.laxatives.1,
        icb.diuretics.1,
        icb.weight_loss_pills.1,
        icb.excessive_exercise.1,
        icb.fasting.1,
        icb.other_methods.1,
        icb.none.1,
        icb.average_made_low_weight = icb.made_average_low_weight                
       
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.icb.nbr.id)
# Inspect colnames
colnames(dat.icb.nbr.id)
#Differences
dim(dat.icb.nbr)[1]-dim(dat.icb.nbr.id)[1]

```


### Read in ED data: GLAD BE
```{r}
dat.be.nbr <- readRDS(file = "../data_raw/diagnostics/be_coping_nbr.rds")

# Inspect dimensions
dim(dat.be.nbr)
# Inspect colnames
colnames(dat.be.nbr)

nrow(dat.be.nbr)

```


### Select variables: NBR BE
```{r glad select variables}

exclude_cols_dem <- c("ID",
                  "cohort_name")

dat.be.nbr.id <- dat.be.nbr %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% 
  #add_column(cohort_name = "coping_nbr", .before = "be.experience_regular_episodes_binge") %>% #create new column 
  select(
         ID = subjectid,# ID
        # cohort_name, # Sample
        be.experience_regular_episodes_binge                    
       
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.be.nbr.id )
# Inspect colnames
colnames(dat.be.nbr.id )
#Differences
dim(dat.be.nbr)[1]-dim(dat.be.nbr.id )[1]

```







##Merge data
```{r}

##AN data
dat.an1 <- rbind(dat.an.nbr.coping.id,
                  dat.an.glad.coping.id
                )

##colnames 
colnames(dat.an1)

##number of people
nrow(dat.an1)


#BE data
dat.an2 <- rbind(dat.be.nbr.id,
                  dat.be.glad.id
                )

##colnames 
colnames(dat.an2)

##number of people
nrow(dat.an2)


##ICB data
dat.an3 <- rbind(dat.icb.nbr.id,
                  dat.icb.glad.id
                )

##colnames 
colnames(dat.an3)

##number of people
nrow(dat.an3)

##First merge             
dat.an4 <- merge(dat.an1,
                  dat.an2,
                  by = "ID")

colnames(dat.an4)

##Final merge
dat.an <- merge(dat.an4,
                dat.an3,
                by = "ID")

##check columns
colnames(dat.an)

##check number of rows
nrow(dat.an)
```

############# AN RESTRICTING #####################

#Work out BMI 
BMI = kg/m2 

##Weight in kg
```{r}

##First need all numeric variables (lbs and kg are character for some reason)
dat.an$weight_lbs_raw <- as.numeric(dat.an$an.1.low_weight_time.1_numeric)

dat.an$weight_kg_raw <- as.numeric(dat.an$an.1.low_weight_time.2_numeric)
  
##To convert stone to kg, multiply by 6.35029
dat.an$weight_kg <- NA_real_

dat.an$weight_kg <-
  if_else(condition = is.na(dat.an$weight_kg), 
         true = (
           (dat.an$an.1.low_weight_time_numeric*6.35029) + 
             (dat.an$weight_lbs_raw*0.453592)
           ), #weight in st and lbs converted to kg
         false = NA_real_,
         missing = NA_real_)


# Kilograms
dat.an$weight_kg_unc <- 
  if_else(condition = is.na(dat.an$weight_kg), 
         true = dat.an$weight_kg_raw, #weight in kilos
         false = dat.an$weight_kg,
         missing = NA_real_) 

# Summary
summary(dat.an$weight_kg_unc)

```
## Clean weight in kg
```{r}
#Weight outlier
  # Define weight limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  weight_upper_limit = 150 
  weight_lower_limit = 25
  
  #Identify number of outliers
  length(
    which(
      dat.an$weight_kg_unc > weight_upper_limit |
        dat.an$weight_kg_unc < weight_lower_limit
    )
  )
  
  #Remove weight outliers
  dat.an <- dat.an %>%
    mutate(
      weight_kg_final =
        if_else(
          weight_kg_unc > weight_upper_limit |
            weight_kg_unc < weight_lower_limit,
          true = NA_real_,
          false = weight_kg_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.an %>%
    freq(weight_kg_final)
  
  
```

##Height in m
```{r}

##Change character variables to numeric
dat.an$height_inches_numeric <- as.numeric(dat.an$an.1.how_tall_were_you_then.1_numeric)

dat.an$height_cm_numeric <- as.numeric(dat.an$an.1.how_tall_were_you_then.2_numeric)


# Feet and inches to metres
dat.an$height_m <- NA


dat.an$height_m <- 
  if_else(
    condition = is.na(dat.an$height_m),
    true = (
      (dat.an$an.1.how_tall_were_you_then_numeric*0.3048) +
      (dat.an$height_inches_numeric*0.0254)
       ),
    false = NA_real_,
    missing = NA_real_
    )

# Centimetres to metres
dat.an$height_m_unc <- 
  if_else(
    condition = is.na(dat.an$height_m),
    true = dat.an$height_cm_numeric/100,
    false = dat.an$height_m)

# Summary
summary(dat.an$height_m_unc)
```
## Clean height in m
```{r}
#Height outlier
  # Define height limits ***These are fairly arbitary and taken from the ED100K issue log. Will need to make final decisions soon.
  height_upper_limit = 2.31 ##tallest person in the world is 2.31 metres
  height_lower_limit = 1
  
  #Identify number of outliers
  length(
    which(
      dat.an$weight_kg_unc > height_upper_limit |
        dat.an$weight_kg_unc < height_lower_limit
    )
  )
  
  #Remove height outliers
  dat.an <- dat.an %>%
    mutate(
     height_m_final =
        if_else(
          height_m_unc > height_upper_limit |
            height_m_unc < height_lower_limit,
          true = NA_real_,
          false = height_m_unc,
          missing = NA_real_
        )
    )
  
  ##Check
  dat.an %>%
    freq(height_m_final)
  
  
```

## Work out BMI
```{r}

# Calculated from height and weight **This should be based on min weight and height - have quite low values <10 - need to check
dat.an$bmi_unc <- NA

dat.an$bmi_unc <- 
  if_else(condition = is.na(dat.an$bmi_unc), 
         true = dat.an$weight_kg_final/dat.an$height_m_final^2, 
         false = NA_real_,
         missing = NA_real_)

# Summary
summary(dat.an$bmi_unc)

```
### AN RESTRICTING ALGORITHM ###
```{r}

dat.an$ed.DSM5_AN_restricting_binary_numeric <- 
  with(dat.an,
  dplyr::if_else(
   ##**Add actual screener question (need to find this in NBR)
    
    ##When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?
    dat.an$an.1.lowest_weight_weigh_weighed == "No" &
    
    #BMI of under 18.55 when at this low weight
    (dat.an$bmi_unc <= 18.55 |
       dat.an$bmi_unc <= 18.55 |
       dat.an$bmi_unc <= 18.55) &
      
    #Roughly how old were you at your lowest weight? **Topher
      
      
      #Fear of gaining weight (During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?_
      (
        dat.an$an.1.gain_weight_low_weight == "Slightly afraid" |
      dat.an$an.1.gain_weight_low_weight == "Somewhat afraid" |
      dat.an$an.1.gain_weight_low_weight == "Very afraid" |
      dat.an$an.1.gain_weight_low_weight == "Extremely afraid"
      ) &
      
    #INAPPROPRIATE COMPENSATORY BEH - fasting and excessive exercise but NOT vomit or laxatives/diet pills/drugs/diuretics etc (During your period of low weight, have you?)
      dat.an$icb.laxatives.1
      
      
      icb.making_yourself_vomit.1
icb.laxatives.1
icb.diuretics.1
icb.weight_loss_pills.1
icb.excessive_exercise.1
icb.fasting.1
icb.other_methods.1
icb.none.1



1E During your period of low weight, have you?
(Select all responses that apply)
•	a) Fasted for 8 waking hours or longer - YES
•	b) Made yourself vomit - NO
•	c) Used diet pills, laxatives, diuretics, drugs - NO
•	d) Exercised excessively or compulsively - YES

   
#Self-worth dependent on body shape or weight
   ((ed.AN_lowt_selfworth == "4" | #***CHECK SCALE #***Ask Molly re. logic 
      ed.AN_lowt_selfworth == "5" |
      ed.AN_lowt_selfworth == "6" |
      ed.AN_lowt_selfworth == "7 Completely dependent") | 
#Felt fat at low weight 
   (ed.AN_feel_fat == "Somewhat" |
      ed.AN_feel_fat == "Very" |
      ed.AN_feel_fat == "Extremely") |
#Perceived no negative consequences of low weight
      ed.AN_lowt_negconseq == "Not at all" |
#Perceived body parts to be larger than they were 
  (ed.AN_lowt_bodydysmorphia == "Somewhat" | 
     ed.AN_lowt_bodydysmorphia == "Very much")) &
#the individual has not engaged in recurrent episodes of binge eating at low weight
  (ed.BE_onlylowt == "No" |
     is.na(ed.BE_onlylowt)) & #***Perhaps don't include NA??
##No vomiting, laxatives, or diuretics to control body shape or weight (at low weight)
  (ed.ICB_lowt_vomit == "No" |
     is.na(ed.ICB_lowt_vomit)) & #***HLD: Added NA - 100 more cases!
  (ed.ICB_lowt_laxative == "No"
| is.na(ed.ICB_lowt_laxative)) &
  (ed.ICB_lowt_diuretic == "No" |
     is.na(ed.ICB_lowt_diuretic)) &  #+++CH: lots of them seem to use diuretics (n = 63)
#This subtype describes presentations in which weight loss is accomplished primarily through dieting, fasting, and/or excessive exercise
  (ed.ICB_lowt_exercise == "Yes" |
     ed.ICB_lowt_fasting == "Yes"),
    true = 1,
    false = 0,
    missing = NA_real_)
  )
  
#Recode numeric to factor
ED.cc$ed.DSM5_AN_restricting_binary <-
  recode_factor(ED.cc$ed.DSM5_AN_restricting_binary_numeric,
                "0" = "No DSM5 AN restricting",
                "1" = "DSM5 AN restricting"
                )

#Summary
freq(ED.cc$ed.DSM5_AN_restricting_binary)
```



1. LOW WEIGHT:
1A Have you had a period of time when you weighed much less than other people thought you should weigh? [an.1.people_thought_weigh_weighed from GLAD ED AN]
(Exclude medical illnesses other than an eating disorder.) - YES

an.1.lowest_weight_weigh_weighed = When you weighed much less than other people thought you ought to weigh or were at your lowest weight, was this due to an illness other than an eating disorder?

AND

1C Roughly how much did you weigh at your lowest weight? / HEIGHT ^ 2 


AND 

1D Roughly how old were you at your lowest weight?
●	___ years

[an.1.how_old_were_you_then.txt]

2. RESTRICTION

1E During your period of low weight, have you? 
(Select all responses that apply)
•	a) Fasted for 8 waking hours or longer - YES

icb.fasting.1

3. FEAR OF GAINING WEIGHT
During the time when you were at this low weight, did you either feel fat or were you afraid that you might gain weight or become fat? - YES

an.1.gain_weight_low_weight = During the time when you were at this low weight, how afraid were you that you might gain weight or become fat?

4. INAPPROPRIATE COMPENSATORY BEH
1E During your period of low weight, have you?
(Select all responses that apply)
•	a) Fasted for 8 waking hours or longer - YES
•	b) Made yourself vomit - NO
•	c) Used diet pills, laxatives, diuretics, drugs - NO
•	d) Exercised excessively or compulsively - YES

icb.making_yourself_vomit.1
icb.laxatives.1
icb.diuretics.1
icb.weight_loss_pills.1
icb.excessive_exercise.1
icb.fasting.1
icb.other_methods.1
icb.none.1

AND
2E To compensate for overeating, have you used any of the following at least once a week for at least 3 months? 
(Select all responses that apply)
•	b) Made yourself vomit - NO
•	c) Used diet pills, laxatives, diuretics, drugs - NO

icb.making_yourself_vomit
icb.laxatives
icb.diuretics
icb.weight_loss_pills
icb.excessive_exercise
icb.fasting
icb.other_methods
icb.none



AND
4 Independent from low weight or excessive overeating, have you used any of the following at least once a week for at least 3 months, to control your weight or shape?
 (Select all responses that apply)
•	B) Made yourself vomit - NO
•	C) Used diet pills, laxatives, diuretics, drugs - NO 

icb.average_made_low_weight = Was there ever a time when you made yourself vomit, used laxatives, or used diuretics, on average, at least once a week for 3 months when you were not at low weight?

3. SELF-ESTEEM
3 In general, how dependent has your self-esteem been on your body shape or weight?
●	A great deal
●	A moderate amount

[an.1.not_at_all_dependentcompletely_dependent]

4. NO BINGE EATING (shouldn't this be just at low weight?)
2A Have you ever had recurrent episodes of excessive overeating or binge eating (i.e., eating significantly more than what most people eat in a similar period of time, for example, 2 hours)?
●	No

be.experience_regular_episodes_binge = Did you experience regular episodes of binge eating while at your lowest weight?

Severity
Mild: BMI ≥ 17kg/m2
Moderate: BMI 16-16.99 kg/m2
Severe: BMI 15-15.99 kg/m2
Extreme: BMI < 15 kg/m2






