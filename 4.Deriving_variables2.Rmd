---
title: "Deriving variables V2"
author: "Helena Davies"
date: "24/05/2021"
output: html_document
---

This script derives variables ready for regression analyses.
Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/add_numeric.R")
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/remove_duplicates.R")
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/package_check.R")
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

# Read in data
## data.final is generated from the "3.Merging" script
+++HLD: NEED TO UPDATE!
```{r Read in data}
dat <- readRDS(file = "../data_cleaned/dat.final2021-07-25.rds")

# Check
dim(dat)
colnames(dat)
```

OUTCOMES

•	NEW Eating disorder behaviour:
    o	binge eating during the COVID-19 pandemic: binary (1,0)
    o	low weight during the COVID-19 pandemic: binary (1,0)

•	NEW Self-harm thoughts/behaviour:
    o	passive suicidal ideation during COVID-19 pandemic: binary (1,0)
    o	self-harm ideation during the COVID-19 pandemic: binary (1,0)
    o	self-harm during the COVID-19 pandemic: binary (1,0)

•	Frequency of all the above behaviors:

o	Cumulative score; 
    	scores of 3 indicate someone has experienced all of the above during the pandemic
    	scores of 2 indicate someone has experienced two of the above during the pandemic
    	scores of 1 indicate someone has experienced one of the above during the pandemic
    	scores of 0 indicate someone has experienced none of the above during the pandemic

# Outcome = Binge eating
## Derive ANY Binge eating during the COVID-19 pandemic
```{r Derive any binge eating during the pandemic}

dat <- dat %>%
  mutate(pandemic_binge_eating =
           case_when(ed_scid5.regular_episodes_eating_binges_.Wave_1b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_2b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_3b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_4b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_6b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_8b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_10b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_12b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_14b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_16b == "Yes" ~ 1, # Answered yes at least once to the binge eating screener
                     
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_1b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_2b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_3b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_4b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_6b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_8b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_10b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_12b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_14b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_16b)  ~ NA_real_, # Captures anyone who did not answer any of the binge eating screeners at any phase
                     
                      (ed_scid5.regular_episodes_eating_binges_.Wave_1b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_1b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_2b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_2b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_3b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_3b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_4b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_4b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_6b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_6b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_8b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_8b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_10b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_10b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_12b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_12b)) &
                        (ed_scid5.regular_episodes_eating_binges_.Wave_14b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_14b)) 
                      (ed_scid5.regular_episodes_eating_binges_.Wave_16b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_16b)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

# Check
dat %>%
  freq(pandemic_binge_eating)
```

NEW binge eating experience, i.e., those who at baseline indicated no lifetime experience of binge eating
```{r Derive NEW binge eating experience}

dat <- dat %>%
  mutate(NEW_binge_eating_pandemic =
           case_when(lifetime_binge_eating_baseline_numeric == 0 & # No lifetime binge eating at baseline, but occured at least once during the pandemic
                     pandemic_binge_eating == 1 ~ 1,
                     
                     lifetime_binge_eating_baseline_numeric == 0 &  # No lifetime binge eating at baseline, and no binge eating during the pandemic
                     pandemic_binge_eating == 0 ~ 0
           )
  )

dat %>%
  freq(NEW_binge_eating_pandemic) # NAs are because the sample is restricted to those who did NOT report binge eating at baseline

```

# Outcome = Low weight
## Derive ANY low weight during the COVID-19 pandemic
```{r Derive ANY low weight during pandemic}

dat <- dat %>%
  mutate(pandemic_low_weight =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "Yes" ~ 1, # Answered yes at least once to the low weight screener
                     
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b) ~ NA_real_, # Captures anyone who did not answer any of the low weight screeners at any phase
                     
                       (ed_scid5.weigh_weighed_past_month_.Wave_1b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_2b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_3b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_4b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_6b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_8b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_10b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_12b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_14b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_16b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

#Check
dat %>%
  freq(pandemic_low_weight)

```

NEW low weight experience, i.e., those who at baseline indicated no lifetime experience of binge eating
```{r Derive NEW low weight experience during pandemic}

dat <- dat %>%
  mutate(NEW_low_weight_pandemic =
           case_when(lifetime_low_weight_baseline_numeric == 0 & #No lifetime low weight at baseline, but occured at least once during the pandemic
                     pandemic_low_weight == 1 ~ 1,
                     
                     lifetime_low_weight_baseline_numeric == 0 &  #No lifetime low weight at baseline, and no low weight during the pandemic
                     pandemic_low_weight == 0 ~ 0
            )
  )

dat %>%
  freq(NEW_low_weight_pandemic) # NAs are because the sample is restricted to those who did NOT report low weight at baseline
```

# Outcome = Passive suicidal ideation
## Derive ANY passive suicidal ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Many people have thoughts that life is not worth living. Have you felt that way in the past two weeks?"
```{r Passive suicdal ideation in the past two weeks}

dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation =
           case_when(
                     taf.felt_weeks_past_.Wave_1a == "Yes" |
                       taf.felt_weeks_past_.Wave_1b == "Yes" |
                       taf.felt_weeks_past_.Wave_2a == "Yes" |
                       taf.felt_weeks_past_.Wave_2b == "Yes" |
                       taf.felt_weeks_past_.Wave_3a == "Yes" |
                       taf.felt_weeks_past_.Wave_3b == "Yes" |
                       taf.felt_weeks_past_.Wave_4a == "Yes" |
                       taf.felt_weeks_past_.Wave_4b == "Yes" |
                       taf.felt_weeks_past_.Wave_5a == "Yes" |
                       taf.felt_weeks_past_.Wave_6b == "Yes" |
                       taf.felt_weeks_past_.Wave_7a == "Yes" |
                       taf.felt_weeks_past_.Wave_8b == "Yes" |
                       taf.felt_weeks_past_.Wave_9a == "Yes" |
                       taf.felt_weeks_past_.Wave_10b == "Yes" |
                       taf.felt_weeks_past_.Wave_11a == "Yes" |
                       taf.felt_weeks_past_.Wave_12b == "Yes" |
                       taf.felt_weeks_past_.Wave_13a == "Yes" |
                       taf.felt_weeks_past_.Wave_14b == "Yes" |
                       taf.felt_weeks_past_.Wave_15a == "Yes" |
                       taf.felt_weeks_past_.Wave_16b == "Yes" |
                       taf.felt_weeks_past_.Wave_17a == "Yes" ~ 1, # Said 'Yes' at least once during the pandemic
                        
              
                       is.na(taf.felt_weeks_past_.Wave_1a) &
                       is.na(taf.felt_weeks_past_.Wave_1b) &
                       is.na(taf.felt_weeks_past_.Wave_2a) &
                       is.na(taf.felt_weeks_past_.Wave_2b) &
                       is.na(taf.felt_weeks_past_.Wave_3a) &
                       is.na(taf.felt_weeks_past_.Wave_3b) &
                       is.na(taf.felt_weeks_past_.Wave_4a) &
                       is.na(taf.felt_weeks_past_.Wave_4b) &
                       is.na(taf.felt_weeks_past_.Wave_5a) &
                       is.na(taf.felt_weeks_past_.Wave_6b) &
                       is.na(taf.felt_weeks_past_.Wave_7a) &
                       is.na(taf.felt_weeks_past_.Wave_8b) &
                       is.na(taf.felt_weeks_past_.Wave_9a) &
                       is.na(taf.felt_weeks_past_.Wave_10b) &
                       is.na(taf.felt_weeks_past_.Wave_11a) &
                       is.na(taf.felt_weeks_past_.Wave_12b) &
                       is.na(taf.felt_weeks_past_.Wave_13a) &
                       is.na(taf.felt_weeks_past_.Wave_14b) &
                       is.na(taf.felt_weeks_past_.Wave_15a) &
                       is.na(taf.felt_weeks_past_.Wave_16b) &
                       is.na(taf.felt_weeks_past_.Wave_17a) ~ NA_real_, # Captures anyone who did not answer any of the passive suicidal questions at any phase
                     
                      
                       (taf.felt_weeks_past_.Wave_1a == "No" | is.na(taf.felt_weeks_past_.Wave_1a)) &
                       (taf.felt_weeks_past_.Wave_1b == "No" | is.na(taf.felt_weeks_past_.Wave_1b)) &
                       (taf.felt_weeks_past_.Wave_2a == "No" | is.na(taf.felt_weeks_past_.Wave_2a)) &
                       (taf.felt_weeks_past_.Wave_2b == "No" | is.na(taf.felt_weeks_past_.Wave_2b)) &
                       (taf.felt_weeks_past_.Wave_3a == "No" | is.na(taf.felt_weeks_past_.Wave_3a)) &
                       (taf.felt_weeks_past_.Wave_3b == "No" | is.na(taf.felt_weeks_past_.Wave_3b)) &
                       (taf.felt_weeks_past_.Wave_4a == "No" | is.na(taf.felt_weeks_past_.Wave_4a)) &
                       (taf.felt_weeks_past_.Wave_4b == "No" | is.na(taf.felt_weeks_past_.Wave_4b)) &
                       (taf.felt_weeks_past_.Wave_5a == "No" | is.na(taf.felt_weeks_past_.Wave_5a)) &
                       (taf.felt_weeks_past_.Wave_6b == "No" | is.na(taf.felt_weeks_past_.Wave_6b)) &
                       (taf.felt_weeks_past_.Wave_7a == "No" | is.na(taf.felt_weeks_past_.Wave_7a)) &
                       (taf.felt_weeks_past_.Wave_8b == "No" | is.na(taf.felt_weeks_past_.Wave_8b)) &
                       (taf.felt_weeks_past_.Wave_9a == "No" | is.na(taf.felt_weeks_past_.Wave_9a)) &
                       (taf.felt_weeks_past_.Wave_10b == "No" | is.na(taf.felt_weeks_past_.Wave_10b)) &
                       (taf.felt_weeks_past_.Wave_11a == "No" | is.na(taf.felt_weeks_past_.Wave_11a)) &
                       (taf.felt_weeks_past_.Wave_12b == "No" | is.na(taf.felt_weeks_past_.Wave_12b)) &
                       (taf.felt_weeks_past_.Wave_13a == "No" | is.na(taf.felt_weeks_past_.Wave_13a)) &
                     (taf.felt_weeks_past_.Wave_14b == "No" | is.na(taf.felt_weeks_past_.Wave_14b)) &
                     (taf.felt_weeks_past_.Wave_15a == "No" | is.na(taf.felt_weeks_past_.Wave_15a)) &
                     (taf.felt_weeks_past_.Wave_16b == "No" | is.na(taf.felt_weeks_past_.Wave_16b)) &
                     (taf.felt_weeks_past_.Wave_17a == "No" | is.na(taf.felt_weeks_past_.Wave_17a)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)
```

### Experience ever
In the follow ups, participants are also asked: "Many people have thoughts that life is not worth living. Have you felt that way". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Passive suicidal ideation ever}

# Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_passive_suicidal_ideation =
           case_when(
                     taf.worth_living_life_people_.Wave_1a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_13a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_14b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_15a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_16b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_17a == "Yes, once" |
                       
                       taf.worth_living_life_people_.Wave_1a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_13a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_14b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_15a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_16b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_17a == "Yes, more than once"  ~ 1, # Answered yes at least once
                        
              
                       is.na(taf.worth_living_life_people_.Wave_1a) &
                       is.na(taf.worth_living_life_people_.Wave_1b) &
                       is.na(taf.worth_living_life_people_.Wave_2a) &
                       is.na(taf.worth_living_life_people_.Wave_2b) &
                       is.na(taf.worth_living_life_people_.Wave_3a) &
                       is.na(taf.worth_living_life_people_.Wave_3b) &
                       is.na(taf.worth_living_life_people_.Wave_4a) &
                       is.na(taf.worth_living_life_people_.Wave_4b) &
                       is.na(taf.worth_living_life_people_.Wave_5a) &
                       is.na(taf.worth_living_life_people_.Wave_6b) &
                       is.na(taf.worth_living_life_people_.Wave_7a) &
                       is.na(taf.worth_living_life_people_.Wave_8b) &
                       is.na(taf.worth_living_life_people_.Wave_9a) &
                       is.na(taf.worth_living_life_people_.Wave_10b) &
                       is.na(taf.worth_living_life_people_.Wave_11a) &
                       is.na(taf.worth_living_life_people_.Wave_12b) &
                        is.na(taf.worth_living_life_people_.Wave_13a) &
                       is.na(taf.worth_living_life_people_.Wave_14b) &
                       is.na(taf.worth_living_life_people_.Wave_15a) &
                       is.na(taf.worth_living_life_people_.Wave_16b) &
                       is.na(taf.worth_living_life_people_.Wave_17a) ~ NA_real_, # Captures those missing at every phase
                     
                      
                       (taf.worth_living_life_people_.Wave_1a == "No" | is.na(taf.worth_living_life_people_.Wave_1a)) &
                       (taf.worth_living_life_people_.Wave_1b == "No" | is.na(taf.worth_living_life_people_.Wave_1b)) &
                       (taf.worth_living_life_people_.Wave_2a == "No" | is.na(taf.worth_living_life_people_.Wave_2a)) &
                       (taf.worth_living_life_people_.Wave_2b == "No" | is.na(taf.worth_living_life_people_.Wave_2b)) &
                       (taf.worth_living_life_people_.Wave_3a == "No" | is.na(taf.worth_living_life_people_.Wave_3a)) &
                       (taf.worth_living_life_people_.Wave_3b == "No" | is.na(taf.worth_living_life_people_.Wave_3b)) &
                       (taf.worth_living_life_people_.Wave_4a == "No" | is.na(taf.worth_living_life_people_.Wave_4a)) &
                       (taf.worth_living_life_people_.Wave_4b == "No" | is.na(taf.worth_living_life_people_.Wave_4b)) &
                       (taf.worth_living_life_people_.Wave_5a == "No" | is.na(taf.worth_living_life_people_.Wave_5a)) &
                       (taf.worth_living_life_people_.Wave_6b == "No" | is.na(taf.worth_living_life_people_.Wave_6b)) &
                       (taf.worth_living_life_people_.Wave_7a == "No" | is.na(taf.worth_living_life_people_.Wave_7a)) &
                       (taf.worth_living_life_people_.Wave_8b == "No" | is.na(taf.worth_living_life_people_.Wave_8b)) &
                       (taf.worth_living_life_people_.Wave_9a == "No" | is.na(taf.worth_living_life_people_.Wave_9a)) &
                       (taf.worth_living_life_people_.Wave_10b == "No" | is.na(taf.worth_living_life_people_.Wave_10b)) &
                       (taf.worth_living_life_people_.Wave_11a == "No" | is.na(taf.worth_living_life_people_.Wave_11a)) &
                       (taf.worth_living_life_people_.Wave_12b == "No" | is.na(taf.worth_living_life_people_.Wave_12b)) &
                       (taf.worth_living_life_people_.Wave_13a == "No" | is.na(taf.worth_living_life_people_.Wave_13a)) &
                       (taf.worth_living_life_people_.Wave_14b == "No" | is.na(taf.worth_living_life_people_.Wave_14b)) &
                       (taf.worth_living_life_people_.Wave_15a == "No" | is.na(taf.worth_living_life_people_.Wave_15a)) &
                       (taf.worth_living_life_people_.Wave_16b == "No" | is.na(taf.worth_living_life_people_.Wave_16b)) &
                       (taf.worth_living_life_people_.Wave_17a == "No" | is.na(taf.worth_living_life_people_.Wave_17a)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

# Check
dat %>%
  freq(EVER_PANDEMIC_passive_suicidal_ideation)
here!!
```

### Baseline passive suicidal ideation
At baseline, participants are also asked whether they have experienced passive suicidal ideation in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.
taf.felt_weeks_past_.Wavebaseline = Many people have thoughts that life is not worth living. Have you felt that way in the past two weeks?
```{r Passive suicidal ideation baseline experience past two weeks}
dat <- dat %>%
  mutate(baseline_passive_suicidal_ideation =
           case_when(
                    taf.felt_weeks_past_.Wavebaseline == "No" ~ 0, # Not experienced in past two weeks
                    taf.felt_weeks_past_.Wavebaseline == "Yes" ~ 1 # Experienced in past two weeks
               )
  )

# Check 
dat %>%
  freq(baseline_passive_suicidal_ideation)
```

### PREPANDEMIC passive suicidal ideation 
At baseline, participants are first asked: "Many people have thoughts that life is not worth living. Have you felt that way?" (taf.worth_living_thoughts_life_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.
```{r Passive suicidal ideation baseline pre-pandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_passive_suicidal_ideation =
           case_when(
             
                  taf.worth_living_life_people_.Wavebaseline == "No" ~ 0, # Never experienced it (lifetime)
                  
                    taf.pandemic_felt_.Wavebaseline == "No" ~ 0, # Have in their life but not before the pandemic
                    taf.pandemic_felt_.Wavebaseline == "Yes" ~ 1 # Have in their life AND before the pandemic
                  )
                      
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_passive_suicidal_ideation)
```


Combined - passive suicidal ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)
```{r Combine pandemic and baseline experience into pandemic experience}
dat <- dat %>%
  mutate(passive_suicidal_ideation_PANDEMIC =
           case_when(
             
             (TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1 | # Experience DURING pandemic (answered yes to 2 week question during pandemic) OR
                EVER_PANDEMIC_passive_suicidal_ideation == 1 ) ~ 1, # Experience DURING pandemic (answered yes to EVER question during pandemic)
           
             baseline_passive_suicidal_ideation == 1 ~ 1, # Experience DURING pandemic (indicated at baseline)

          baseline_passive_suicidal_ideation == 0 |
             EVER_PANDEMIC_passive_suicidal_ideation == 0 ~ 0, # Baseline never experienced, and/or NO to EVER experiencing at ANY phase (people who have endorsed it EVER during the pandemic will be captured above, so this can be an OR rather than an AND, i.e., we will allow it if some people are NA for one)
           )
  )

# Check
dat %>%
  freq(passive_suicidal_ideation_PANDEMIC)

```


# Outcome = Self-harm ideation
## Derive ANY self-harm ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Have you contemplated harming yourself?" [If "Yes"] then asked "Have you felt that way in the past two weeks?" (taf.felt_weeks_past.1_.Wave_1a etc)
```{r Self-harm ideation ANY past two weeks pandemic}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_selfharm_ideation =
           case_when(
             taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_13a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_14b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_15a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_16b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_17a == "Yes" ~ 1, # Said "Yes" at any point to the two week question
                        
              
                       is.na(taf.felt_weeks_past.1_.Wave_1a) &
                       is.na(taf.felt_weeks_past.1_.Wave_1b) &
                       is.na(taf.felt_weeks_past.1_.Wave_2a) &
                       is.na(taf.felt_weeks_past.1_.Wave_2b) &
                       is.na(taf.felt_weeks_past.1_.Wave_3a) &
                       is.na(taf.felt_weeks_past.1_.Wave_3b) &
                       is.na(taf.felt_weeks_past.1_.Wave_4a) &
                       is.na(taf.felt_weeks_past.1_.Wave_4b) &
                       is.na(taf.felt_weeks_past.1_.Wave_5a) &
                       is.na(taf.felt_weeks_past.1_.Wave_6b) &
                       is.na(taf.felt_weeks_past.1_.Wave_7a) &
                       is.na(taf.felt_weeks_past.1_.Wave_8b) &
                       is.na(taf.felt_weeks_past.1_.Wave_9a) &
                       is.na(taf.felt_weeks_past.1_.Wave_10b) &
                       is.na(taf.felt_weeks_past.1_.Wave_11a) &
                       is.na(taf.felt_weeks_past.1_.Wave_12b) &
                       is.na(taf.felt_weeks_past.1_.Wave_13a) &
                       is.na(taf.felt_weeks_past.1_.Wave_14b) &
                       is.na(taf.felt_weeks_past.1_.Wave_15a) &
                       is.na(taf.felt_weeks_past.1_.Wave_16b) &
                       is.na(taf.felt_weeks_past.1_.Wave_17a) ~ NA_real_, # NA for all waves (i.e., never answered the two week question during the pandemic)
                     
                      
                       (taf.felt_weeks_past.1_.Wave_1a == "No" | is.na(taf.felt_weeks_past.1_.Wave_1a)) &
                       (taf.felt_weeks_past.1_.Wave_1b == "No" | is.na(taf.felt_weeks_past.1_.Wave_1b)) &
                       (taf.felt_weeks_past.1_.Wave_2a == "No" | is.na(taf.felt_weeks_past.1_.Wave_2a)) &
                       (taf.felt_weeks_past.1_.Wave_2b == "No" | is.na(taf.felt_weeks_past.1_.Wave_2b)) &
                       (taf.felt_weeks_past.1_.Wave_3a == "No" | is.na(taf.felt_weeks_past.1_.Wave_3a)) &
                       (taf.felt_weeks_past.1_.Wave_3b == "No" | is.na(taf.felt_weeks_past.1_.Wave_3b)) &
                       (taf.felt_weeks_past.1_.Wave_4a == "No" | is.na(taf.felt_weeks_past.1_.Wave_4a)) &
                       (taf.felt_weeks_past.1_.Wave_4b == "No" | is.na(taf.felt_weeks_past.1_.Wave_4b)) &
                       (taf.felt_weeks_past.1_.Wave_5a == "No" | is.na(taf.felt_weeks_past.1_.Wave_5a)) &
                       (taf.felt_weeks_past.1_.Wave_6b == "No" | is.na(taf.felt_weeks_past.1_.Wave_6b)) &
                       (taf.felt_weeks_past.1_.Wave_7a == "No" | is.na(taf.felt_weeks_past.1_.Wave_7a)) &
                       (taf.felt_weeks_past.1_.Wave_8b == "No" | is.na(taf.felt_weeks_past.1_.Wave_8b)) &
                       (taf.felt_weeks_past.1_.Wave_9a == "No" | is.na(taf.felt_weeks_past.1_.Wave_9a)) &
                       (taf.felt_weeks_past.1_.Wave_10b == "No" | is.na(taf.felt_weeks_past.1_.Wave_10b)) &
                       (taf.felt_weeks_past.1_.Wave_11a == "No" | is.na(taf.felt_weeks_past.1_.Wave_11a)) &
                       (taf.felt_weeks_past.1_.Wave_12b == "No" | is.na(taf.felt_weeks_past.1_.Wave_12b)) &
               (taf.felt_weeks_past.1_.Wave_13a == "No" | is.na(taf.felt_weeks_past.1_.Wave_13a)) &
               (taf.felt_weeks_past.1_.Wave_14b == "No" | is.na(taf.felt_weeks_past.1_.Wave_14b)) &
               (taf.felt_weeks_past.1_.Wave_15a == "No" | is.na(taf.felt_weeks_past.1_.Wave_15a)) &
               (taf.felt_weeks_past.1_.Wave_16b == "No" | is.na(taf.felt_weeks_past.1_.Wave_16b)) &
               (taf.felt_weeks_past.1_.Wave_17a == "No" | is.na(taf.felt_weeks_past.1_.Wave_17a))~ 0 # Said "No" at least once and did not say "Yes" once
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)
```

### Experience ever
In the follow ups, participants are also asked lifetime self-harm ideation: "Have you contemplated harming yourself?". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Self-harm ideation EVER pandemic}
#Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_selfharm_ideation =
           case_when(
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                         taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, once" |
                       
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, more than once" ~ 1, # "Yes" at at least one phase
                       
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) &
                        is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_17a) ~ NA_real_, # Missing at every phase
                     
                      
                       (taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a)) & (taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_12b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b)) &
                         (taf.have_you_contemplated_harming_yourself_.Wave_13a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_14b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_15a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_16b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_17b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_17b)) ~ 0 # "No" at least once and never said "Yes"
                    
           ))

#Check
dat %>%
  freq(EVER_PANDEMIC_selfharm_ideation)
```

### Baseline self-harm ideation
At baseline, participants are also asked whether they have experienced self-harm ideation in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.

taf.felt_weeks_past.1_.Wavebaseline = Have you contemplated harming yourself...in the past two weeks?
```{r Self-harm ideation baseline experience past two weeks}
dat <- dat %>%
  mutate(baseline_selfharm_ideation =
           case_when(
                    taf.felt_weeks_past.1_.Wavebaseline == "No" ~ 0, # Not experienced in the past two weeks
                    taf.felt_weeks_past.1_.Wavebaseline == "Yes" ~ 1 # Experienced in the past two weeks
             )
  )

# Check 
dat %>%
  freq(baseline_selfharm_ideation)
```

### PREPANDEMIC self-harm ideation 
At baseline, participants are first asked: "Have you contemplated harming yourself ?" (taf.have_you_contemplated_harming_yourself_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt.1_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.

```{r Self-harm ideation prepandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_ideation =
           case_when(
                     taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" ~ 0, # Never experienced it in their life
                     
                     taf.pandemic_felt.1_.Wavebaseline == "No" ~ 0, # Have experienced it in their life but not before the pandemic
                     taf.pandemic_felt.1_.Wavebaseline == "Yes" ~ 1 # Have experienced it before in their life and during the pandemic
                     )
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_selfharm_ideation)
```

Combined - self-harm ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)
```{r Combined baseline self-harm ideation experience and/or follow up experience pandemic}
dat <- dat %>%
  mutate(selfharm_ideation_PANDEMIC =
           case_when(
         
             (TWO_WEEKS_PANDEMIC_selfharm_ideation == 1 | # Experience DURING pandemic (answered yes to 2 week question during pandemic)
                EVER_PANDEMIC_selfharm_ideation == 1 ) ~ 1, # Experience DURING pandemic (answered yes to EVER question during pandemic)
           
              baseline_selfharm_ideation == 1 ~ 1, # Experience DURING pandemic (indicated at baseline)
             
             baseline_selfharm_ideation == 0 |
             EVER_PANDEMIC_selfharm_ideation == 0 ~ 0 # Baseline never experienced, and/or NO to EVER experiencing at ANY phase (people who have endorsed it EVER during the pandemic will be captured above, so this can be an OR rather than an AND, i.e., we will allow it if some people are NA for one)
          )
    
  )

#Check
dat %>%
  freq(selfharm_ideation_PANDEMIC)
```

# Outcome = Self-harm 
## Derive ANY self-harm during the COVID-19 pandemic
### Experience during past two weeks 
NB: There is no 'ever' question for self-harm
```{r Self-harm experience ANY past two weeks}
dat <- dat %>%
mutate(TWO_WEEKS_PANDEMIC_selfharm =
           case_when(
                     taf.meant_life_end_weeks_.Wave_1a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_1b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_2a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_2b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_3a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_3b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_4a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_4b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_5a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_6b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_7a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_8b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_9a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_10b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_11a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_12b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_13a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_14b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_15a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_16b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_17a == "Yes" ~ 1, # "Yes" at least once
                        
              
                       is.na(taf.meant_life_end_weeks_.Wave_1a) &
                       is.na(taf.meant_life_end_weeks_.Wave_1b) &
                       is.na(taf.meant_life_end_weeks_.Wave_2a) &
                       is.na(taf.meant_life_end_weeks_.Wave_2b) &
                       is.na(taf.meant_life_end_weeks_.Wave_3a) &
                       is.na(taf.meant_life_end_weeks_.Wave_3b) &
                       is.na(taf.meant_life_end_weeks_.Wave_4a) &
                       is.na(taf.meant_life_end_weeks_.Wave_4b) &
                       is.na(taf.meant_life_end_weeks_.Wave_5a) &
                       is.na(taf.meant_life_end_weeks_.Wave_6b) &
                       is.na(taf.meant_life_end_weeks_.Wave_7a) &
                       is.na(taf.meant_life_end_weeks_.Wave_8b) &
                       is.na(taf.meant_life_end_weeks_.Wave_9a) &
                       is.na(taf.meant_life_end_weeks_.Wave_10b) &
                       is.na(taf.meant_life_end_weeks_.Wave_11a) &
                       is.na(taf.meant_life_end_weeks_.Wave_12b) &
                       is.na(taf.meant_life_end_weeks_.Wave_13a) &
                       is.na(taf.meant_life_end_weeks_.Wave_14b) &
                       is.na(taf.meant_life_end_weeks_.Wave_15a) &
                       is.na(taf.meant_life_end_weeks_.Wave_16b) &
                       is.na(taf.meant_life_end_weeks_.Wave_17a) ~ NA_real_, # Missing at every phase
                     
                      
                       (taf.meant_life_end_weeks_.Wave_1a == "No" | is.na(taf.meant_life_end_weeks_.Wave_1a)) &
                       (taf.meant_life_end_weeks_.Wave_1b == "No" | is.na(taf.meant_life_end_weeks_.Wave_1b)) &
                       (taf.meant_life_end_weeks_.Wave_2a == "No" | is.na(taf.meant_life_end_weeks_.Wave_2a)) &
                       (taf.meant_life_end_weeks_.Wave_2b == "No" | is.na(taf.meant_life_end_weeks_.Wave_2b)) &
                       (taf.meant_life_end_weeks_.Wave_3a == "No" | is.na(taf.meant_life_end_weeks_.Wave_3a)) &
                       (taf.meant_life_end_weeks_.Wave_3b == "No" | is.na(taf.meant_life_end_weeks_.Wave_3b)) &
                       (taf.meant_life_end_weeks_.Wave_4a == "No" | is.na(taf.meant_life_end_weeks_.Wave_4a)) &
                       (taf.meant_life_end_weeks_.Wave_4b == "No" | is.na(taf.meant_life_end_weeks_.Wave_4b)) &
                       (taf.meant_life_end_weeks_.Wave_5a == "No" | is.na(taf.meant_life_end_weeks_.Wave_5a)) &
                       (taf.meant_life_end_weeks_.Wave_6b == "No" | is.na(taf.meant_life_end_weeks_.Wave_6b)) &
                       (taf.meant_life_end_weeks_.Wave_7a == "No" | is.na(taf.meant_life_end_weeks_.Wave_7a)) &
                       (taf.meant_life_end_weeks_.Wave_8b == "No" | is.na(taf.meant_life_end_weeks_.Wave_8b)) &
                       (taf.meant_life_end_weeks_.Wave_9a == "No" | is.na(taf.meant_life_end_weeks_.Wave_9a)) &
                       (taf.meant_life_end_weeks_.Wave_10b == "No" | is.na(taf.meant_life_end_weeks_.Wave_10b)) &
                       (taf.meant_life_end_weeks_.Wave_11a == "No" | is.na(taf.meant_life_end_weeks_.Wave_11a)) &
                       (taf.meant_life_end_weeks_.Wave_12b == "No" | is.na(taf.meant_life_end_weeks_.Wave_12b)) &
                       (taf.meant_life_end_weeks_.Wave_13a == "No" | is.na(taf.meant_life_end_weeks_.Wave_13a)) &
                       (taf.meant_life_end_weeks_.Wave_14b == "No" | is.na(taf.meant_life_end_weeks_.Wave_14b)) &
                       (taf.meant_life_end_weeks_.Wave_15a == "No" | is.na(taf.meant_life_end_weeks_.Wave_15a)) &
                       (taf.meant_life_end_weeks_.Wave_16b == "No" | is.na(taf.meant_life_end_weeks_.Wave_16b)) &
                       (taf.meant_life_end_weeks_.Wave_17a == "No" | is.na(taf.meant_life_end_weeks_.Wave_17a)) ~ 0 # Said "No" to at least one phase and never said "Yes"
                    
           ))
                    
   
# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm)
```

### Baseline self-harm 
At baseline, participants are also asked whether they have experienced self-harm in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.

taf.meant_life_end_weeks_.Wavebaseline = In the last two weeks, have you deliberately harmed yourself, whether or not you meant to end your life? (at baseline)
```{r Baseline self-harm experience last two weeks}
dat <- dat %>%
  mutate(baseline_pandemic_selfharm =
           case_when(
             
              taf.meant_life_end_weeks_.Wavebaseline ==  "Yes" ~  1, # Self harmed during past two weeks (at baseline)
              taf.meant_life_end_weeks_.Wavebaseline == "No" ~ 0) # Not self harmed during past two weeks (at baseline)
               
              )

# Check 
dat %>%
  freq(baseline_pandemic_selfharm)
```

### PREPANDEMIC self-harm 
At baseline, participants are asked: "Before the pandemic, had you deliberately harmed yourself, whether or not you meant to end your life?" (taf.meant_end_life_pandemic_.Wavebaseline). Note again, there is no lifetime assessment of self-harm.
```{r Prepandemic self-harm experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm =
           case_when(
                    taf.meant_end_life_pandemic_.Wavebaseline == "No" ~ 0, # Not experienced self-harm before the pandemic
                    taf.meant_end_life_pandemic_.Wavebaseline == "Yes" ~ 1 # Experienced self-harm during the pandemic 
            )
  )

# Check 
dat %>%
  freq(PREPANDEMIC_selfharm)
```

Combined - self-harm ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)

NB: This question "Before the pandemic, had you deliberately harmed yourself, whether or not you meant to end your life?" is shown to everyone, so I don't need to use the same logic as with the other baseline questions (i.e., there is no screener question that asks about lifetime self-harm: "Have you deliberately harmed yourself, whether or not you meant to end your life?) 
```{r Combined self-harm baseline and follow up experience}
dat <- dat %>%
  mutate(selfharm_PANDEMIC =
           case_when(
            baseline_pandemic_selfharm == 1 ~ 1, # Experience DURING pandemic (indicated at baseline)
             
            TWO_WEEKS_PANDEMIC_selfharm == 1 ~ 1,# Experienced DURING pandemic (answered yes to 2 week question during pandemic)
                     
            baseline_pandemic_selfharm == 0 |  
            TWO_WEEKS_PANDEMIC_selfharm == 0 ~ 0 # Had not experienced at baseline (in the last two weeks) and had not indicated experiencing at any follow up phase. NB: Because there is no lifetime assessment of self-harm, there might be some people who joined the study later (e.g., in November 2020) and had self-harmed earlier in the pandemic (e.g., July) but we would not capture them.
                     
           )
  )

# Check
dat %>%
  freq(selfharm_PANDEMIC)
```

# Identify at which phase they first experienced the outcome
Exposure must come before the outcome. Need to identify at which wave participants experienced each outcome, to ensure that their experience of the exposure happened BEFORE the outcome.

Binge eating
```{r Identify phase at which outcome first experienced - binge eating}

dat <- dat %>%
  mutate(outcome_phase_binge_eating =
           case_when( is.na(ed_scid5.regular_episodes_eating_binges_.Wave_1b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_2b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_3b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_4b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_6b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_8b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_10b)  &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_12b) &
                        is.na(ed_scid5.regular_episodes_eating_binges_.Wave_14b)  &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_16b) ~ "Not answered", 
                      
                       (NEW_binge_eating_pandemic == 1 & # new experience
                      ed_scid5.regular_episodes_eating_binges_.Wave_1b == "Yes") ~ "1b",
                       (NEW_binge_eating_pandemic == 1 & # new experience
                      ed_scid5.regular_episodes_eating_binges_.Wave_2b == "Yes") ~ "2b",
                       (NEW_binge_eating_pandemic == 1 & # new experience
                      ed_scid5.regular_episodes_eating_binges_.Wave_3b == "Yes") ~ "3b",
                       (NEW_binge_eating_pandemic == 1 & # new experience
                      ed_scid5.regular_episodes_eating_binges_.Wave_4b == "Yes") ~ "4b",
                      (NEW_binge_eating_pandemic == 1 & # new experience
                       ed_scid5.regular_episodes_eating_binges_.Wave_6b == "Yes") ~ "6b",
                      (NEW_binge_eating_pandemic == 1 & # new experience
                        ed_scid5.regular_episodes_eating_binges_.Wave_8b == "Yes") ~ "8b",
                       (NEW_binge_eating_pandemic == 1 & # new experience
                       ed_scid5.regular_episodes_eating_binges_.Wave_10b == "Yes") ~ "10b",
                       (NEW_binge_eating_pandemic == 1 & # new experience
                       ed_scid5.regular_episodes_eating_binges_.Wave_12b == "Yes") ~ "12b",
                      (NEW_binge_eating_pandemic == 1 & # new experience
                       ed_scid5.regular_episodes_eating_binges_.Wave_14b == "Yes") ~ "14b",
                      (NEW_binge_eating_pandemic == 1 & # new experience
                       ed_scid5.regular_episodes_eating_binges_.Wave_16b == "Yes") ~ "16b",
                      
                      TRUE ~ "Not experienced" # Then, everyone else will have answered "No" at least once, even if they are missing for all other phases. The only people we can not assume an answer for (i.e., has experienced or has not experienced) is those who never answered the question throughout the whole time period. Also, there is no PNTA option on the binge eating question, only "Yes" or "No"
           )
  )

# Check
dat %>%
  freq(outcome_phase_binge_eating)
```

Low weight
```{r Identify phase at which outcome first experienced - low weight}

dat <- dat %>%
  mutate(outcome_phase_low_weight =
           case_when(is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b ) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b) ~ "Not answered", 
                     
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes") ~ "1b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes") ~ "2b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes") ~ "3b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes") ~ "4b",
                      (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes") ~ "6b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes") ~ "8b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes") ~ "10b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes") ~ "12b",
                     (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_14b == "Yes") ~ "14b",
                     (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_16b == "Yes") ~ "16b",
                     
                     TRUE~ "Not experienced" # Then, everyone else will have answered "No" at least once, even if they are missing for all other phases. The only people we can not assume an answer for (i.e., has experienced or has not experienced) is those who never answered the question throughout the whole time period. Also, there is no PNTA option on the low weight question, only "Yes" or "No
           )
  )

# Check
dat %>%
  freq(outcome_phase_low_weight)

```

Passive suicidal ideation
```{r Identify phase at which outcome first experienced - passive suicidal ideation}

dat <- dat %>%
  mutate(outcome_phase_passive_suicidal_ideation =
           case_when( 
                      # Either hasn't answered or is PNTA for 1a
                      (
                        ((is.na(taf.felt_weeks_past_.Wave_1a) |
                         taf.felt_weeks_past_.Wave_1a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_1a) |
                        taf.worth_living_life_people_.Wave_1a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 1b
                      ((is.na(taf.felt_weeks_past_.Wave_1b) |
                         taf.felt_weeks_past_.Wave_1b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_1b) |
                        taf.worth_living_life_people_.Wave_1b == "Prefer not to answer")) &
                        
                      # Either hasn't answered or is PNTA for 2a
                      ((is.na(taf.felt_weeks_past_.Wave_2a) |
                         taf.felt_weeks_past_.Wave_2a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_2a) |
                        taf.worth_living_life_people_.Wave_2a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 2b
                      ((is.na(taf.felt_weeks_past_.Wave_2b) |
                         taf.felt_weeks_past_.Wave_2b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_2b) |
                        taf.worth_living_life_people_.Wave_2b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 3a
                      ((is.na(taf.felt_weeks_past_.Wave_3a) |
                         taf.felt_weeks_past_.Wave_3a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_3a) |
                        taf.worth_living_life_people_.Wave_3a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 3b
                      ((is.na(taf.felt_weeks_past_.Wave_3b) |
                         taf.felt_weeks_past_.Wave_3b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_3b) |
                        taf.worth_living_life_people_.Wave_3b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 4a
                      ((is.na(taf.felt_weeks_past_.Wave_4a) |
                         taf.felt_weeks_past_.Wave_4a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_4a) |
                        taf.worth_living_life_people_.Wave_4a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 4b
                      ((is.na(taf.felt_weeks_past_.Wave_4b) |
                         taf.felt_weeks_past_.Wave_4b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_4b) |
                        taf.worth_living_life_people_.Wave_4b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 5a
                      ((is.na(taf.felt_weeks_past_.Wave_5a) |
                         taf.felt_weeks_past_.Wave_5a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_5a) |
                        taf.worth_living_life_people_.Wave_5a == "Prefer not to answer")) &
                    
                     # Either hasn't answered or is PNTA for 6b
                      ((is.na(taf.felt_weeks_past_.Wave_6b) |
                         taf.felt_weeks_past_.Wave_6b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_6b) |
                        taf.worth_living_life_people_.Wave_6b == "Prefer not to answer")) &
                     
                     # Either hasn't answered or is PNTA for 7a
                      ((is.na(taf.felt_weeks_past_.Wave_7a) |
                         taf.felt_weeks_past_.Wave_7a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_7a) |
                        taf.worth_living_life_people_.Wave_7a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 8b
                      ((is.na(taf.felt_weeks_past_.Wave_8b) |
                         taf.felt_weeks_past_.Wave_8b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_8b) |
                        taf.worth_living_life_people_.Wave_8b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 9a
                      ((is.na(taf.felt_weeks_past_.Wave_9a) |
                         taf.felt_weeks_past_.Wave_9a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_9a) |
                        taf.worth_living_life_people_.Wave_9a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 10b
                      ((is.na(taf.felt_weeks_past_.Wave_10b) |
                         taf.felt_weeks_past_.Wave_10b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_10b) |
                        taf.worth_living_life_people_.Wave_10b == "Prefer not to answer")) &
                         
                    # Either hasn't answered or is PNTA for 11a
                      ((is.na(taf.felt_weeks_past_.Wave_11a) |
                         taf.felt_weeks_past_.Wave_11a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_11a) |
                        taf.worth_living_life_people_.Wave_11a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 12b
                      ((is.na(taf.felt_weeks_past_.Wave_12b) |
                         taf.felt_weeks_past_.Wave_12b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_12b) |
                        taf.worth_living_life_people_.Wave_12b == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 13a
                      ((is.na(taf.felt_weeks_past_.Wave_13a) |
                         taf.felt_weeks_past_.Wave_13a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_13a) |
                        taf.worth_living_life_people_.Wave_13a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 14b
                      ((is.na(taf.felt_weeks_past_.Wave_14b) |
                         taf.felt_weeks_past_.Wave_14b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_14b) |
                        taf.worth_living_life_people_.Wave_14b == "Prefer not to answer")) &
                      
                       # Either hasn't answered or is PNTA for 15a
                      ((is.na(taf.felt_weeks_past_.Wave_15a) |
                         taf.felt_weeks_past_.Wave_15a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_15a) |
                        taf.worth_living_life_people_.Wave_15a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 16b
                      ((is.na(taf.felt_weeks_past_.Wave_16b) |
                         taf.felt_weeks_past_.Wave_16b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_16b) |
                        taf.worth_living_life_people_.Wave_16b == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 17a
                      ((is.na(taf.felt_weeks_past_.Wave_17a) |
                         taf.felt_weeks_past_.Wave_17a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_17a) |
                        taf.worth_living_life_people_.Wave_17a == "Prefer not to answer")) 
                  
                       ) ~ "Not answered or PNTA",
                     
                     taf.felt_weeks_past_.Wavebaseline == "Yes" |
                      taf.worth_living_life_people_.Wavebaseline == "Yes, once" | 
                      taf.worth_living_life_people_.Wavebaseline == "Yes, more than once" ~ "Baseline",
                    
                    taf.felt_weeks_past_.Wave_1a == "Yes" |
                      taf.worth_living_life_people_.Wave_1a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_1a == "Yes, more than once" ~ "1a",
                       
                      taf.felt_weeks_past_.Wave_1b == "Yes" |
                      taf.worth_living_life_people_.Wave_1b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_1b == "Yes, more than once" ~ "1b", 
                     
                     taf.felt_weeks_past_.Wave_2b == "Yes" |
                      taf.worth_living_life_people_.Wave_2b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_2b == "Yes, more than once" ~ "2b",
                      
                     taf.felt_weeks_past_.Wave_3a == "Yes" |
                      taf.worth_living_life_people_.Wave_3a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_3a == "Yes, more than once" ~ "3a",
                     
                     taf.felt_weeks_past_.Wave_3b == "Yes" |
                      taf.worth_living_life_people_.Wave_3b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_3b == "Yes, more than once" ~ "3b",
                     
                     taf.felt_weeks_past_.Wave_4a == "Yes" |
                      taf.worth_living_life_people_.Wave_4a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_4a == "Yes, more than once" ~ "4a",
                     
                     taf.felt_weeks_past_.Wave_4b == "Yes" |
                      taf.worth_living_life_people_.Wave_4b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_4b == "Yes, more than once" ~ "4b",
                     
                     taf.felt_weeks_past_.Wave_5a == "Yes" |
                      taf.worth_living_life_people_.Wave_5a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_5a == "Yes, more than once" ~ "5a",
                     
                     taf.felt_weeks_past_.Wave_6b == "Yes" |
                      taf.worth_living_life_people_.Wave_6b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_6b == "Yes, more than once" ~ "6b",
                     
                     taf.felt_weeks_past_.Wave_7a == "Yes" |
                      taf.worth_living_life_people_.Wave_7a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_7a == "Yes, more than once" ~ "7a",
                     
                     taf.felt_weeks_past_.Wave_8b == "Yes" |
                      taf.worth_living_life_people_.Wave_8b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_8b == "Yes, more than once" ~ "8b",
                     
                     taf.felt_weeks_past_.Wave_9a == "Yes" |
                      taf.worth_living_life_people_.Wave_9a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_9a == "Yes, more than once" ~ "9a",
                     
                     taf.felt_weeks_past_.Wave_10b == "Yes" |
                      taf.worth_living_life_people_.Wave_10b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_10b == "Yes, more than once" ~ "10b",
                   
                     taf.felt_weeks_past_.Wave_11a == "Yes" |
                      taf.worth_living_life_people_.Wave_11a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_11a == "Yes, more than once" ~ "11a",
                     
                     taf.felt_weeks_past_.Wave_12b == "Yes" |
                      taf.worth_living_life_people_.Wave_12b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_12b == "Yes, more than once" ~ "12b",
                    
                    taf.felt_weeks_past_.Wave_13a == "Yes" |
                      taf.worth_living_life_people_.Wave_13a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_13a == "Yes, more than once" ~ "13a",
                    
                     taf.felt_weeks_past_.Wave_14b == "Yes" |
                      taf.worth_living_life_people_.Wave_14b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_14b == "Yes, more than once" ~ "14b",
                    
                    taf.felt_weeks_past_.Wave_15a == "Yes" |
                      taf.worth_living_life_people_.Wave_15a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_15a == "Yes, more than once" ~ "15a",
                    
                    taf.felt_weeks_past_.Wave_16b == "Yes" |
                      taf.worth_living_life_people_.Wave_16b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_16b == "Yes, more than once" ~ "16b",
                    
                    taf.felt_weeks_past_.Wave_17a == "Yes" |
                      taf.worth_living_life_people_.Wave_17a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_17a == "Yes, more than once" ~ "17a",
                    
                    
                    TRUE ~ "Not experienced"
                    
                    )
         )
  

# Check
dat %>%
  freq(outcome_phase_passive_suicidal_ideation)
```

Self-harm ideation
```{r Identify phase at which outcome first experienced - self-harm ideation}

dat <- dat %>%
  mutate(outcome_phase_selfharm_ideation =
           case_when( 
                      (
                        # Either hasn't answered or is PNTA for 1a
                        ((is.na(taf.felt_weeks_past.1_.Wave_1a) |
                         taf.felt_weeks_past.1_.Wave_1a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_1a == "Prefer not to answer")) &
                          
                        # Either hasn't answered or is PNTA for 1b
                        ((is.na(taf.felt_weeks_past.1_.Wave_1b) |
                         taf.felt_weeks_past.1_.Wave_1b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_1b == "Prefer not to answer")) &
                           
                          # Either hasn't answered or is PNTA for 2a
                        ((is.na(taf.felt_weeks_past.1_.Wave_2a) |
                         taf.felt_weeks_past.1_.Wave_2a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_2a == "Prefer not to answer")) &
                        
                           # Either hasn't answered or is PNTA for 2b
                        ((is.na(taf.felt_weeks_past.1_.Wave_2b) |
                         taf.felt_weeks_past.1_.Wave_2b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_2b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 3a
                        ((is.na(taf.felt_weeks_past.1_.Wave_3a) |
                         taf.felt_weeks_past.1_.Wave_3a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_3a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 3b
                        ((is.na(taf.felt_weeks_past.1_.Wave_3b) |
                         taf.felt_weeks_past.1_.Wave_3b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_3b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 4a
                        ((is.na(taf.felt_weeks_past.1_.Wave_4a) |
                         taf.felt_weeks_past.1_.Wave_4a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_4a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 4b
                        ((is.na(taf.felt_weeks_past.1_.Wave_4b) |
                         taf.felt_weeks_past.1_.Wave_4b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_4b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 5a
                        ((is.na(taf.felt_weeks_past.1_.Wave_5a) |
                         taf.felt_weeks_past.1_.Wave_5a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_5a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 6b
                        ((is.na(taf.felt_weeks_past.1_.Wave_6b) |
                         taf.felt_weeks_past.1_.Wave_6b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_6b == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 7a
                        ((is.na(taf.felt_weeks_past.1_.Wave_7a) |
                         taf.felt_weeks_past.1_.Wave_7a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_7a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 8b
                        ((is.na(taf.felt_weeks_past.1_.Wave_8b) |
                         taf.felt_weeks_past.1_.Wave_8b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_8b == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 9a
                        ((is.na(taf.felt_weeks_past.1_.Wave_9a) |
                         taf.felt_weeks_past.1_.Wave_9a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_9a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 10b
                        ((is.na(taf.felt_weeks_past.1_.Wave_10b) |
                         taf.felt_weeks_past.1_.Wave_10b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_10b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 11a
                        ((is.na(taf.felt_weeks_past.1_.Wave_11a) |
                         taf.felt_weeks_past.1_.Wave_11a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_11a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 12b
                        ((is.na(taf.felt_weeks_past.1_.Wave_12b) |
                         taf.felt_weeks_past.1_.Wave_12b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_12b == "Prefer not to answer")) &
                      
                        # Either hasn't answered or is PNTA for 13a
                        ((is.na(taf.felt_weeks_past.1_.Wave_13a) |
                         taf.felt_weeks_past.1_.Wave_13a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_13a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 14b
                        ((is.na(taf.felt_weeks_past.1_.Wave_14b) |
                         taf.felt_weeks_past.1_.Wave_14b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_14b == "Prefer not to answer")) &
                        
                        # Either hasn't answered or is PNTA for 15a
                        ((is.na(taf.felt_weeks_past.1_.Wave_15a) |
                         taf.felt_weeks_past.1_.Wave_15a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_15a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 16b
                        ((is.na(taf.felt_weeks_past.1_.Wave_16b) |
                         taf.felt_weeks_past.1_.Wave_16b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_16b == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 17a
                        ((is.na(taf.felt_weeks_past.1_.Wave_17a) |
                         taf.felt_weeks_past.1_.Wave_17a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_17a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_17a == "Prefer not to answer")) 
                        ) ~ "Not answered or PNTA",
                     
                      taf.felt_weeks_past.1_.Wavebaseline == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once" ~ "Baseline", 

                      taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" ~ "1a", 

                     taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" ~ "1b",
                     
                     taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" ~ "2a",
                     
                     taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" ~ "2b",
                     
                     taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" ~ "3a",
                     
                     taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" ~ "3b",
                     
                     taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" ~ "4a",
                     
                     taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" ~ "4b",
                     
                     taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" ~ "5a",
                     
                     taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" ~ "6b",
                     
                     taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" ~ "7a",
                     
                     taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" ~ "8b",
                     
                     taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" ~ "9a",
                     
                     taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" ~ "10b",
                     
                     taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" ~ "11a",
                     
                     taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" ~ "12b",
                     
                     taf.felt_weeks_past.1_.Wave_13a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once" ~ "13a",
                     
                     taf.felt_weeks_past.1_.Wave_14b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once" ~ "14b",
                     
                     taf.felt_weeks_past.1_.Wave_15a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once" ~ "15a",
                     
                      taf.felt_weeks_past.1_.Wave_16b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once" ~ "16b",
                     
                     taf.felt_weeks_past.1_.Wave_17a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, more than once" ~ "17a",
                     
                     
                     TRUE ~ "Not experienced"
           )
  )

# Check
dat %>%
  freq(outcome_phase_selfharm_ideation)
```

Self-harm 
```{r Identify phase at which outcome first experienced - self-harm}

dat <- dat %>%
  mutate(outcome_phase_selfharm =
           case_when( 
             ( # Either hasn't answered or is PNTA for 1a
               (is.na(taf.meant_life_end_weeks_.Wave_1a) |
                 taf.meant_life_end_weeks_.Wave_1a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 1b
               (is.na(taf.meant_life_end_weeks_.Wave_1b) |
                 taf.meant_life_end_weeks_.Wave_1b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 2a
               (is.na(taf.meant_life_end_weeks_.Wave_2a) |
                 taf.meant_life_end_weeks_.Wave_2a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 2b
               (is.na(taf.meant_life_end_weeks_.Wave_2b) |
                 taf.meant_life_end_weeks_.Wave_2b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 3a
               (is.na(taf.meant_life_end_weeks_.Wave_3a) |
                 taf.meant_life_end_weeks_.Wave_3a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 3b
               (is.na(taf.meant_life_end_weeks_.Wave_3b) |
                 taf.meant_life_end_weeks_.Wave_3b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 4a
               (is.na(taf.meant_life_end_weeks_.Wave_4a) |
                 taf.meant_life_end_weeks_.Wave_4a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 4b
               (is.na(taf.meant_life_end_weeks_.Wave_4b) |
                 taf.meant_life_end_weeks_.Wave_4b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 5a
               (is.na(taf.meant_life_end_weeks_.Wave_5a) |
                 taf.meant_life_end_weeks_.Wave_5a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 6b
               (is.na(taf.meant_life_end_weeks_.Wave_6b) |
                 taf.meant_life_end_weeks_.Wave_6b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 7a
               (is.na(taf.meant_life_end_weeks_.Wave_7a) |
                 taf.meant_life_end_weeks_.Wave_7a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 8b
               (is.na(taf.meant_life_end_weeks_.Wave_8b) |
                 taf.meant_life_end_weeks_.Wave_8b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 9a
               (is.na(taf.meant_life_end_weeks_.Wave_9a) |
                 taf.meant_life_end_weeks_.Wave_9a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 10b
               (is.na(taf.meant_life_end_weeks_.Wave_10b) |
                 taf.meant_life_end_weeks_.Wave_10b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 11a
               (is.na(taf.meant_life_end_weeks_.Wave_11a) |
                 taf.meant_life_end_weeks_.Wave_11a == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 12b
               (is.na(taf.meant_life_end_weeks_.Wave_12b) |
                 taf.meant_life_end_weeks_.Wave_12b == "Prefer not to answer") &
                 
                 # Either hasn't answered or is PNTA for 13a
               (is.na(taf.meant_life_end_weeks_.Wave_13a) |
                 taf.meant_life_end_weeks_.Wave_13a == "Prefer not to answer") &
                 
                  # Either hasn't answered or is PNTA for 14b
               (is.na(taf.meant_life_end_weeks_.Wave_14b) |
                 taf.meant_life_end_weeks_.Wave_14b == "Prefer not to answer") &
                 
                  # Either hasn't answered or is PNTA for 15a
               (is.na(taf.meant_life_end_weeks_.Wave_15a) |
                 taf.meant_life_end_weeks_.Wave_15a == "Prefer not to answer") &
                 
                  # Either hasn't answered or is PNTA for 16b
               (is.na(taf.meant_life_end_weeks_.Wave_16b) |
                 taf.meant_life_end_weeks_.Wave_16b == "Prefer not to answer") &
                 
                  # Either hasn't answered or is PNTA for 17a
               (is.na(taf.meant_life_end_weeks_.Wave_17a) |
                 taf.meant_life_end_weeks_.Wave_17a == "Prefer not to answer") 
                 ) ~ "Not answered or PNTA",
                      
                       taf.meant_life_end_weeks_.Wavebaseline == "Yes" ~ "Baseline",
                       taf.meant_life_end_weeks_.Wave_1a == "Yes" ~ "1a",
                       taf.meant_life_end_weeks_.Wave_1b == "Yes" ~ "1b",
                       taf.meant_life_end_weeks_.Wave_2a == "Yes" ~ "2a",
                       taf.meant_life_end_weeks_.Wave_2b == "Yes" ~ "2b",
                       taf.meant_life_end_weeks_.Wave_3a == "Yes" ~ "3a",
                       taf.meant_life_end_weeks_.Wave_3b == "Yes" ~ "3b",
                       taf.meant_life_end_weeks_.Wave_4a == "Yes" ~ "4a",
                       taf.meant_life_end_weeks_.Wave_4b == "Yes" ~ "4b",
                       taf.meant_life_end_weeks_.Wave_5a == "Yes" ~ "5a",
                       taf.meant_life_end_weeks_.Wave_6b == "Yes" ~ "6b",
                       taf.meant_life_end_weeks_.Wave_7a == "Yes" ~ "7a",
                       taf.meant_life_end_weeks_.Wave_8b == "Yes" ~ "8b",
                       taf.meant_life_end_weeks_.Wave_9a == "Yes" ~ "9a",
                       taf.meant_life_end_weeks_.Wave_10b == "Yes" ~ "10b",
                       taf.meant_life_end_weeks_.Wave_11a == "Yes" ~ "11a",
                       taf.meant_life_end_weeks_.Wave_12b == "Yes" ~ "12b",
                       taf.meant_life_end_weeks_.Wave_13a == "Yes" ~ "13a",
                       taf.meant_life_end_weeks_.Wave_14b == "Yes" ~ "14b",
                       taf.meant_life_end_weeks_.Wave_15a == "Yes" ~ "15a",
                       taf.meant_life_end_weeks_.Wave_16b == "Yes" ~ "16b",
                       taf.meant_life_end_weeks_.Wave_17a == "Yes" ~ "17a",
             
                      TRUE ~ "Not experienced"
           )
  )

# Check
dat %>%
  freq(outcome_phase_selfharm)

```


# EXPOSURES / EXPLANATORY VARIABLES
NB: For exposures assessed at baseline, I should include one model which includes 'baseline' new experiences of outcome, and another without (i.e., one with co-occuring exposure and outcome, the other with all outcomes occurring after exposure).

BASIC MODEL:
  •	Age
  •	Gender
  •	Racialised minority
  •	Highest education level 
  •	Pre-pandemic experience (for self-harm only) 
  •	Psychiatric disorder (*will do sensitivty analysis without EDs or disorders that include self-harm)
  • Key worker status 
  • Defined as vulnerable person according to Government 
  • Positive COVID test 
  • Change in economic activity
  • Change in living situation
  • Loneliness
  • Pandemic worry

  o	Sensitivity analysis; Other mental health diagnosis pre-pandemic, i.e., not ED
    	Count
    	Group (Dep, Anx, Dep+Anx, Psychotic, ADHD, ASD, PTSD)
    
  o	Sensitivity analysis: Sex

### Age
NB: RAMP and NBR can use the variable "age_category" as age was assessed only once, at COVID baseline. For GLAD and EDGI, age has been assessed twice: once at GLAD/EDGI sign up, and once at COVID baseline (COPING questionnaire baseline). For the purposes of the regression analyses, I will be using 'age at COVID assessment' i.e., age at COVID baseline (I have worked this out for GLAD and EDGI from their DOBs and their end dates for completing the COPING baseline demographics questions = age_category_COPING)
```{r Age as exposure}

# Collapse age categories of 16-18 and 19-25 to 16-25, and over 71 to 71+ (very small categories otherwise)

dat <- dat %>%
  mutate(age_category_COVID_baseline = 
           case_when(
                     
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                     age_category == "16-18" ~ "16-25"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                     age_category == "19-25" ~ "16-25"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "26-35" ~ "26-35"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "36-45" ~ "36-45"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "46-55" ~ "46-55"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "56-65" ~ "56-65"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "66-70" ~ "66-70"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "71-75" ~ "71+"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "76-80" ~ "71+"),
             
            (( cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "81-85" ~ "71+"),
            
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "86-90" ~ "71+"),
            
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "91-100" ~ "71+"),
            
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "100+" ~ "71+"),
             
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                     age_category_COPING == "16-18" ~ "16-25"),
             
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                     age_category_COPING == "19-25" ~ "16-25"),
              
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "26-35" ~ "26-35"),
              
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "36-45" ~ "36-45"),
             
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "46-55" ~ "46-55"),
             
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "56-65" ~ "56-65"),
              
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "66-70" ~ "66-70"),
              
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "71-75" ~ "71+"),
             
            ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "76-80" ~ "71+"),
             
            ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "81-85" ~ "71+"),
            
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "86-90" ~ "71+"),
            
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "91-100" ~ "71+")
            )
         )

# Check
dat %>%
  freq(age_category_COVID_baseline)

# Re-order for regression analyses with largest age group as reference
dat <- dat %>%
  mutate(age_category_COVID_baseline = factor(age_category_COVID_baseline,
                       levels = c("56-65",
                                  "16-25",
                                  "26-35",
                                  "36-45",
                                  "46-55",
                                   "66-70",
                                   "71+"
                                  
                         
          )))

# Check
dat %>%
  freq(age_category_COVID_baseline)
```

### Gender
```{r Gender as exposure variable}
# Recode 
dat <- dat %>%
  mutate(gender_cleaned = 
           case_when(transgender == "Yes" ~ "Minoritised gender",
                     
                     gender_unc == "Male" ~ "Man",
                     gender_unc == "Female" ~ "Woman",
                     
                     gender_unc == "Non-binary" ~ "Minoritised gender",
                     gender_unc == "Prefer to self-define" ~ "Minoritised gender"
            )
         )

# Check
dat %>%
  freq(gender_cleaned) # NAs are people who did not answer the gender question
```

### Sex (male = 0, female = 1)
```{r Sex as exposure variable}

# Recode to binary sex
dat <- dat %>%
  mutate(sex_binary_numeric = 
           case_when(sex == "0" |
                       sex == "Male" ~ 0,
                     
                     sex == "1" |
                       sex == "Female" ~ 1,
                     
                     # NB: RAMP does not have sex, but does have whether someone is transgender
                    
                     # Non-transgender male
                      cohort_name == "ramp" &
                       gender_unc == "Male" &
                       transgender == "No" ~ 0,
                     
                     # Transgender male, assigned female at birth
                     cohort_name == "ramp" &
                       gender_unc == "Male" &
                       transgender == "Yes" ~ 1,
                     
                     # Non-transgender female
                      cohort_name == "ramp" &
                       gender_unc == "Female" &
                       transgender == "No" ~ 1,
                     
                     # Transgender female, assigned male at birth
                     cohort_name == "ramp" &
                       gender_unc == "Female" &
                       transgender == "Yes" ~ 0
                     
            )
         )

dat %>%
  freq(sex_binary_numeric)
```

### Race
```{r Race as exposure variable}

# Recode to binary
dat <- dat %>%
  mutate(race_binary = 
           case_when(ethnicity == "Mixed or multiple ethnic origins" ~ "Racially minoritised",
                      ethnicity == "Asian or Asian British" ~ "Racially minoritised",
                      ethnicity == "Black or Black British" ~ "Racially minoritised",
                      ethnicity == "Arab" ~ "Racially minoritised",
                      ethnicity == "Other" ~ "Racially minoritised",
                      ethnicity == "Other ethnic group" ~ "Racially minoritised",
                     ethnicity == "White" ~ "White"
            )
         )

# Check
dat %>%
  freq(race_binary)

# Reorder so that 'White' is reference category
dat <- dat %>%
  mutate(race_binary = factor(race_binary,
                       levels = c("White",
                                  "Racially minoritised"
                                  )))
dat %>%
  freq(race_binary)
```

### Education
This is from baseline COPING and RAMP data (i.e., not GLAD or EDGI signups, which is "highest_education_prepan"). This is to get their most recent education data.
```{r Education as exposure variable}
# Convert to binary variable to reduce number of exposure variables and maximise likelihood of models running.
dat <- dat %>%
  mutate(A_Levels_higher =
           case_when(highest_education == "No formal qualifications" ~ "No",
                     highest_education == "GCSE/CSE" ~ "No",
                     highest_education == "NVQ" ~ "No",
                       highest_education == "A-levels" ~"Yes",
                       highest_education == "University/Other professional qualifications" ~ "Yes"
             
           ))

# Check
dat %>%
  freq(A_Levels_higher)
```

### Psychiatric disorder
This is from EDGI and GLAD sign-up data, as well as data from COPING and RAMP baseline. 
```{r Psychiatric disorder as exposure}
# Covert numeric control (from the preprocessing script) to psych disorder factor
dat <- dat %>% 
  mutate(psych_disorder_factor =
           case_when(control_numeric == 1 ~ "No psychiatric disorder",
                     control_numeric == 0 ~ "Psychiatric disorder"
             
           ))
  
# Check
dat %>%
  freq(psych_disorder_factor)
```

### Employed & key worker status
I have separated out those who are a key worker (and thus employed), those who are not a key worker but are employed, those who are unemployed (and thus not a key worker), and those who are students. This is from baseline COPING and RAMP data.
```{r Employed / key-worker status as exposure}
dat <- dat %>%
  mutate(employed_key =
           case_when(key_worker == "Key worker" ~ "Yes, key", # Employed and key worker
                     
                     key_worker == "No key worker" & # Employed but not key worker
                      employed == "Employed" ~ "Yes",
                     
                     employed == "Unemployed" ~ "No", # Unemployed (and therefore not key worker)
                     
                      employed == "Student" ~ "Student" # Student (and therefore not key worker)
                     )
           )
# Check
dat %>%
  freq(employed_key)

# Re-order for regression analysis
dat <- dat %>%
  mutate(employed_key = factor(employed_key,
                       levels = c("Yes",
                                  "Yes, key",
                                  "No",
                                  "Student"
                                  )))
dat %>%
  freq(employed_key)
```

### Member of vulnerable group
This is baseline COPING and RAMP data (this is not asked at follow ups).
```{r Member of vulnerable group exposure}
# Recode / rename
dat <- dat %>%
  mutate(vulnerable_group_member =
           case_when(dem2.member_vulnerable_group == "Not I am not a member of a vulnerable group" ~ "Yes",
                     dem2.member_vulnerable_group == "I am not a member of a vulnerable group" ~ "No"
             
           ))

# Check
dat %>%
  freq(vulnerable_group_member)
```
                           
### Positive covid test - virus questionnaire
NB: For the 'virus' questionnaire, there is no baseline assessment. However, there is a 'resp' questionnaire that is asked at baseline and at every follow up phase, so will include positive tests indicated in this questionnaire too.

Need to ensure COVID test occurred BEFORE outcomes - create new variable for COVID test that only counts positive tests as ones that occurred BEFORE each outcome. Will exclude anyone from the analysis if they experienced outcome before exposure, EVEN if it went: outcome → exposure → outcome. Should look at whether their FIRST experience of outcome came before (or at the same time of) their FIRST experience of exposure

Will also include co-occurring symptoms, but as a sensitivity analysis will get rid to further assess causal hypothesis.

# Identify at which phase they first experienced the exposure
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
+++ Why are first 4 waves empty?
```{r First experience of exposure - positive COVID test - virus Q}

dat <- dat %>%
  mutate(exposure_phase_positive_covid_test =
           case_when(  is.na(virus.past_surveys_include_reported_.Wave_1b)  &
                       is.na(virus.past_surveys_include_reported_.Wave_2b) &
                       is.na(virus.past_surveys_include_reported_.Wave_3b) &
                       is.na(virus.past_surveys_include_reported_.Wave_4b) &
                       is.na(virus.past_surveys_include_reported_.Wave_6b) &
                       is.na(virus.past_surveys_include_reported_.Wave_8b) &
                       is.na(virus.past_surveys_include_reported_.Wave_10b)   &
                       is.na(virus.past_surveys_include_reported_.Wave_12b) &
                         is.na(virus.past_surveys_include_reported_.Wave_14b)   &
                       is.na(virus.past_surveys_include_reported_.Wave_16b) ~ "Not answered whether test taken", 
                       
                       (is.na(virus.past_surveys_include_reported_.Wave_1b ) |
                        virus.past_surveys_include_reported_.Wave_1b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_2b ) |
                        virus.past_surveys_include_reported_.Wave_2b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_3b ) |
                        virus.past_surveys_include_reported_.Wave_3b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_4b ) |
                        virus.past_surveys_include_reported_.Wave_4b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_6b ) |
                        virus.past_surveys_include_reported_.Wave_6b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_8b ) |
                        virus.past_surveys_include_reported_.Wave_8b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_10b ) |
                        virus.past_surveys_include_reported_.Wave_10b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_12b ) |
                        virus.past_surveys_include_reported_.Wave_12b == "No")  
                       
                       (is.na(virus.past_surveys_include_reported_.Wave_14b ) |
                        virus.past_surveys_include_reported_.Wave_14b == "No") &
                         (is.na(virus.past_surveys_include_reported_.Wave_16b ) |
                        virus.past_surveys_include_reported_.Wave_16b == "No")  ~ "Not taken test", 
                       
                       is.na(virus.back_positive_antibodies_covid_.Wave_1b ) &
                       is.na(virus.back_positive_antibodies_covid_.Wave_2b ) &
                       is.na(virus.back_positive_antibodies_covid_.Wave_3b ) &
                       is.na(virus.back_positive_antibodies_covid_.Wave_4b ) &
                       is.na(virus.back_positive_antibodies_covid_.Wave_6b ) &
                       is.na(virus.back_positive_antibodies_covid_.Wave_8b ) &
                       is.na(virus.back_positive_antibodies_covid_.Wave_10b)  &
                       is.na(virus.back_positive_antibodies_covid_.Wave_12b)  &
                         is.na(virus.back_positive_antibodies_covid_.Wave_14b)  &
                       is.na(virus.back_positive_antibodies_covid_.Wave_16b)  ~ "Test taken but not answered test result", 
                       
                       virus.back_positive_antibodies_covid_.Wave_1b == "Yes" ~ "1b",
                       virus.back_positive_antibodies_covid_.Wave_2b == "Yes" ~ "2b",
                       virus.back_positive_antibodies_covid_.Wave_3b == "Yes" ~ "3b",
                       virus.back_positive_antibodies_covid_.Wave_4b == "Yes" ~ "4b",
                       virus.back_positive_antibodies_covid_.Wave_6b == "Yes" ~ "6b",
                       virus.back_positive_antibodies_covid_.Wave_8b == "Yes" ~ "8b",
                       virus.back_positive_antibodies_covid_.Wave_10b == "Yes" ~ "10b",
                       virus.back_positive_antibodies_covid_.Wave_12b == "Yes" ~ "12b",
                       virus.back_positive_antibodies_covid_.Wave_14b == "Yes" ~ "14b",
                       virus.back_positive_antibodies_covid_.Wave_16b == "Yes" ~ "16b",
                       
                       TRUE ~ "Not positive" # Then, everyone who is left over, i.e., NA will have answered "No" or "Unsure/inconclusive" at least once, even if they are missing for all other phases. The only people we can not assume an answer for (i.e., has experienced or has not experienced) is those who never answered the question throughout the whole time period
                   )
  )

# Check
dat %>%
  freq(exposure_phase_positive_covid_test)
```

Binge eating 
```{r Positve COVID test result exposure BEFORE outcome BE - virus Q}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_BE_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                        exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                      (outcome_phase_binge_eating == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                        outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_BE_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     outcome_phase_binge_eating == "1b"  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_BE_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_BE_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                       (outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_BE_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop
                    
                      exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                       (outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_BE_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_binge_eating == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_BE_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_BE_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                       )  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                      (outcome_phase_binge_eating == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_BE_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                      (outcome_phase_binge_eating == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "12b" |
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_BE_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_12b)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_BE_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                      outcome_phase_binge_eating == "12b" )  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    (outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_14b)

# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_BE_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                      outcome_phase_binge_eating == "12b" |
                      outcome_phase_binge_eating == "14b" )  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_binge_eating == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_16b)
```

Positive COVID test BEFORE binge eating

NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ Why are first 4 waves empty?
+++ Need to drop people who had a positive COVID test AFTER binge eating 
```{r Positve COVID test result exposure BE - virus Q}
dat <- dat %>%
  mutate(positive_covid_test_before_BE =
           case_when(# First positive test NOT before first experience of binge eating
                    positive_covid_test_BE_1b == "To drop" |
                    positive_covid_test_BE_2b == "To drop" |
                    positive_covid_test_BE_3b == "To drop" |
                    positive_covid_test_BE_4b == "To drop" |
                    positive_covid_test_BE_6b == "To drop" |
                    positive_covid_test_BE_8b == "To drop" |
                    positive_covid_test_BE_10b == "To drop" |
                    positive_covid_test_BE_12b == "To drop" |
                    positive_covid_test_BE_14b == "To drop" |
                      positive_covid_test_BE_16b == "To drop" ~ "Positive test after binge eating",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether test taken" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Test taken but not answered test result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "Missing whether experienced binge eating", # Need to be dropped
                    
                    # First positive test BEFORE first experience of binge eating
                    positive_covid_test_BE_1b == "Yes" |
                    positive_covid_test_BE_2b == "Yes" |
                    positive_covid_test_BE_3b == "Yes" |
                    positive_covid_test_BE_4b == "Yes" |
                    positive_covid_test_BE_6b == "Yes" |
                    positive_covid_test_BE_8b == "Yes" |
                    positive_covid_test_BE_10b == "Yes" |
                    positive_covid_test_BE_12b == "Yes" |
                    positive_covid_test_BE_14b == "Yes" |
                    positive_covid_test_BE_16b == "Yes" ~ "Positive test before binge eating",
                    
                   # Experienced exposure but not outcome
                    positive_covid_test_BE_1b == "No outcome" |
                    positive_covid_test_BE_2b == "No outcome" |
                    positive_covid_test_BE_3b == "No outcome" |
                    positive_covid_test_BE_4b == "No outcome" |
                    positive_covid_test_BE_6b == "No outcome" |
                    positive_covid_test_BE_8b == "No outcome" |
                    positive_covid_test_BE_10b == "No outcome" |
                    positive_covid_test_BE_12b == "No outcome" |
                     positive_covid_test_BE_14b == "No outcome" |
                    positive_covid_test_BE_16b == "No outcome" ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_binge_eating != "Not answered" |
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_binge_eating == "Not experienced" ~ "Neither exposure nor outcome"
                   
      )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_BE)


# Create final variable of positive COVID test before BE outcome
dat <- dat %>%
  mutate(positive_covid_test_before_BE_final =
           case_when(positive_covid_test_before_BE == "Positive test after binge eating" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_BE == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test
                     positive_covid_test_before_BE == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_BE == "Missing whether experienced binge eating" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced binge eating
                     
                     positive_covid_test_before_BE == "Not taken test" |
                      positive_covid_test_before_BE ==  "Outcome but no exposure" |
                     positive_covid_test_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                     
                     positive_covid_test_before_BE == "Exposure but no outcome" |
                     positive_covid_test_before_BE == "Positive test before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_BE_final) 
```

Low weight
```{r Positve COVID test result exposure BEFORE outcome LOW WEIGHT - virus Q}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_LW_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_low_weight == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes") # Not experienced low weight before phase 1b
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_LW_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     outcome_phase_low_weight == "1b"  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                      outcome_phase_low_weight == "Not experienced" ~  "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "2b" & 
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_LW_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_low_weight == "1b"  |
                     outcome_phase_low_weight == "2b")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                  
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      outcome_phase_low_weight == "Not experienced" ~  "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                       (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                      )
         )
  
# Check
dat %>%
  freq(positive_covid_test_LW_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_LW_4b =
           case_when( exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_low_weight == "1b"  |
                     outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                     outcome_phase_low_weight == "Not experienced" ~  "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                       (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_LW_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b")  ~ "To drop",# First experience of low weight occurred before first COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                       (outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" | 
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_LW_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_LW_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                       (outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_LW_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b" )  ~ "To drop", # Low weight occurred before COVID test
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                       (outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_LW_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_LW_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b" |
                      outcome_phase_low_weight == "10b" )  ~ "To drop", # Low weight occurred before COVID test
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Not experienced low weight during COPING
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                       (outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Co-occurring outcome and exposure
                     )
         )
      
                     
# Check
dat %>%
  freq(positive_covid_test_LW_12b)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_LW_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b" |
                      outcome_phase_low_weight == "10b"|
                       outcome_phase_low_weight == "12b")  ~ "To drop", # Low weight occurred before COVID test
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Not experienced low weight during COPING
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                       (outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Co-occurring outcome and exposure
                     )
         )
      
                     
# Check
dat %>%
  freq(positive_covid_test_LW_14b)

# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_LW_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b" |
                      outcome_phase_low_weight == "10b"|
                       outcome_phase_low_weight == "12b" |
                      outcome_phase_low_weight == "14b")  ~ "To drop", # Low weight occurred before COVID test
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Not experienced low weight during COPING
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                       outcome_phase_low_weight == "16b" ~ "Yes"  # Co-occurring outcome and exposure
                     )
         )
      
                     
# Check
dat %>%
  freq(positive_covid_test_LW_16b)
```

Positive COVID test before low weight

NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ See above comments for BE
```{r Positve COVID test result exposure LOW WEIGHT - virus Q}
dat <- dat %>%
  mutate(positive_covid_test_before_LW =
           case_when(# First positive test NOT before first experience of low weight
                    positive_covid_test_LW_1b == "To drop" |
                    positive_covid_test_LW_2b == "To drop" |
                    positive_covid_test_LW_3b == "To drop" |
                    positive_covid_test_LW_4b == "To drop" |
                    positive_covid_test_LW_6b == "To drop" |
                    positive_covid_test_LW_8b == "To drop" |
                    positive_covid_test_LW_10b == "To drop" |
                    positive_covid_test_LW_12b == "To drop" |
                      positive_covid_test_LW_14b == "To drop" |
                    positive_covid_test_LW_16b == "To drop" ~ "Positive test after low weight",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether test taken" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Test taken but not answered test result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced low weight
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                    # First positive test BEFORE first experience of low weight
                    positive_covid_test_LW_1b == "Yes" |
                    positive_covid_test_LW_2b == "Yes" |
                    positive_covid_test_LW_3b == "Yes" |
                    positive_covid_test_LW_4b == "Yes" |
                    positive_covid_test_LW_6b == "Yes" |
                    positive_covid_test_LW_8b == "Yes" |
                    positive_covid_test_LW_10b == "Yes" |
                    positive_covid_test_LW_12b == "Yes" |
                      positive_covid_test_LW_14b == "Yes" |
                    positive_covid_test_LW_16b == "Yes"~ "Positive test before low weight",
                    
                   # Experienced exposure but not outcome
                    positive_covid_test_LW_1b == "No outcome" |
                    positive_covid_test_LW_2b == "No outcome" |
                    positive_covid_test_LW_3b == "No outcome" |
                    positive_covid_test_LW_4b == "No outcome" |
                    positive_covid_test_LW_6b == "No outcome" |
                    positive_covid_test_LW_8b == "No outcome" |
                    positive_covid_test_LW_10b == "No outcome" |
                    positive_covid_test_LW_12b == "No outcome" |
                     positive_covid_test_LW_14b == "No outcome" |
                    positive_covid_test_LW_16b == "No outcome" ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_low_weight == "Not experienced" ~ "Neither exposure nor outcome"
                   
      )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_LW)


# Create final variable of positive COVID test before low weight outcome
dat <- dat %>%
  mutate(positive_covid_test_before_LW_final =
           case_when(positive_covid_test_before_LW == "Positive test after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_LW == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test                    
                       positive_covid_test_before_LW == "Missing test result" | # Taken a test but not indicated result of test

                     positive_covid_test_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced low weight
                     
                     positive_covid_test_before_LW == "Not taken test" |
                     positive_covid_test_before_LW ==  "Outcome but no exposure" |
                     positive_covid_test_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     positive_covid_test_before_LW == "Exposure but no outcome" |
                    positive_covid_test_before_LW == "Positive test before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_LW_final) 
```

Passive suicidal ideation
NB: Passive suicidal ideation was asked at EVERY phase, whereas positive COVID test was asked only at follow up B. 
```{r Positive COVID test result exposure BEFORE outcome PASSIVE SUICIDAL IDEATION - virus Q}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_PSS_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA/PNTA are coded as "Not answered or PNTA")
                     
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                     outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop",  # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_passive_suicidal_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_PSS_2b =
           case_when(exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                      outcome_phase_passive_suicidal_ideation == "2a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                      exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
# Check
dat %>%
  freq(positive_covid_test_PSS_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_PSS_3b =
           case_when(exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" | 
                        outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "3b" &  # First positive COVID test at phase 3b
                     (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_PSS_4b =
           case_when(exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                       exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                       (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
              
# Check
dat %>%
  freq(positive_covid_test_PSS_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_PSS_6b =
           case_when(exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" | 
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a") ~ "To drop",  # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                      (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_PSS_8b =
           case_when(exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b 
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                     outcome_phase_passive_suicidal_ideation == "Baseline" |
                       (outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_passive_suicidal_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_PSS_10b =
           case_when(exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b 
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "10b" & # Positive COVID test at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                      )
         )
  
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_PSS_12b =
           case_when(exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "12b" & # Positive COVID test at phase 12b
                     (outcome_phase_passive_suicidal_ideation == "12b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_PSS_13a =
           case_when(exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "13a" & # Positive COVID test at phase 13a
                     ( outcome_phase_passive_suicidal_ideation == "13a" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_PSS_14b =
           case_when(exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "14b" & # Positive COVID test at phase 14b
                     (outcome_phase_passive_suicidal_ideation == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_14b)


# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_PSS_15a =
           case_when(exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" ) ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "15a" & # Positive COVID test at phase 15a
                     ( outcome_phase_passive_suicidal_ideation == "15a" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_PSS_16b =
           case_when(exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                         outcome_phase_passive_suicidal_ideation == "15a") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "16b" & # Positive COVID test at phase 16b
                     ( outcome_phase_passive_suicidal_ideation == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_16b)


# Phase 17a
dat <- dat %>%
  mutate(positive_covid_test_PSS_17a =
           case_when(exposure_phase_positive_covid_test == "17a" & # First positive COVID test at phase 17a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "17a" & # First positive COVID test at phase 17a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" | 
                       outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                         outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b") ~ "To drop", # First passive suicidal ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "17a" & # Positive COVID test at phase 17a
                     outcome_phase_passive_suicidal_ideation == "17a" ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_17a)
```

Positive COVID test before passive suicidal ideation
NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ See comments above
```{r Positve COVID test result exposure passive suicidal ideation - virus Q}
dat <- dat %>%
  mutate(positive_covid_test_before_PSS =
           case_when(# First positive test NOT before first experience of outcome
                    positive_covid_test_PSS_1b == "To drop" |
                    positive_covid_test_PSS_2b == "To drop" |
                    positive_covid_test_PSS_3b == "To drop" |
                    positive_covid_test_PSS_4b == "To drop" |
                    positive_covid_test_PSS_6b == "To drop" |
                    positive_covid_test_PSS_8b == "To drop" |
                    positive_covid_test_PSS_10b == "To drop" |
                    positive_covid_test_PSS_12b == "To drop" |
                    positive_covid_test_PSS_14b == "To drop" |
                    positive_covid_test_PSS_16b == "To drop" ~ "Positive test after passive suicidal ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether test taken" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Test taken but not answered test result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced outcome
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of outcome
                    positive_covid_test_PSS_1b == "Yes" |
                    positive_covid_test_PSS_2b == "Yes" |
                    positive_covid_test_PSS_3b == "Yes" |
                    positive_covid_test_PSS_4b == "Yes" |
                    positive_covid_test_PSS_6b == "Yes" |
                    positive_covid_test_PSS_8b == "Yes" |
                    positive_covid_test_PSS_10b == "Yes" |
                    positive_covid_test_PSS_12b == "Yes" |
                      positive_covid_test_PSS_14b == "Yes" |
                    positive_covid_test_PSS_16b == "Yes" ~ "Positive test before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    positive_covid_test_PSS_1b == "No outcome" |
                    positive_covid_test_PSS_2b == "No outcome" |
                    positive_covid_test_PSS_3b == "No outcome" |
                    positive_covid_test_PSS_4b == "No outcome" |
                    positive_covid_test_PSS_6b == "No outcome" |
                    positive_covid_test_PSS_8b == "No outcome" |
                    positive_covid_test_PSS_10b == "No outcome" |
                    positive_covid_test_PSS_12b == "No outcome" |
                     positive_covid_test_PSS_14b == "No outcome" |
                    positive_covid_test_PSS_16b == "No outcome" ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "Neither exposure nor outcome"
                   
      )
)

# Check 
dat %>%
  freq(positive_covid_test_before_PSS)

                   
# Create final variable of positive COVID test before passive suicidal ideation outcome
dat <- dat %>%
  mutate(positive_covid_test_before_PSS_final =
           case_when(positive_covid_test_before_PSS == "Positive test after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_PSS == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_PSS  == "Missing test result" | # Taken test but given test result 
                     positive_covid_test_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced passive suicidal ideation
                     
                     positive_covid_test_before_PSS == "Negative test" |
                     positive_covid_test_before_PSS == "Not taken test" |
                     positive_covid_test_before_PSS == "Inconclusive test" |
                     positive_covid_test_before_PSS ==  "Outcome but no exposure" |
                     positive_covid_test_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                    
                    positive_covid_test_before_PSS == "Exposure but no outcome" |
                    positive_covid_test_before_PSS == "Positive test before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_PSS_final) 
```
Self-harm ideation
NB: Self-harm ideation was asked at EVERY phase, whereas positive COVID test was asked only at follow up B. 
```{r Positive COVID test result exposure BEFORE outcome SELF-HARM IDEATION - virus Q}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_SHI_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA/PNTA are coded as "Not answered or PNTA")
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                      outcome_phase_selfharm_ideation == "1a") ~ "To drop",  # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_selfharm_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )


      
# Check
dat %>%
  freq(positive_covid_test_SHI_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_SHI_2b =
           case_when(exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     (exposure_phase_positive_covid_test == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" | 
                      outcome_phase_selfharm_ideation == "2a") ~ "To drop", # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                      exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
# Check
dat %>%
  freq(positive_covid_test_SHI_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_SHI_3b =
           case_when(exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                       (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" | 
                        outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a") ~ "To drop", # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "3b" &  # First positive COVID test at phase 3b
                     (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_SHI_4b =
           case_when(exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                       (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a") ~ "To drop", # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                       exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                       (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
              
# Check
dat %>%
  freq(positive_covid_test_SHI_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_SHI_6b =
           case_when(exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" | 
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a") ~ "To drop",  # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                      (outcome_phase_selfharm_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_SHI_8b =
           case_when(exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b 
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a") ~ "To drop", # First self-harm ideation occurred before foutcome_phase_selfharm_ideation
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_selfharm_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_SHI_10b =
           case_when(exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b 
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a") ~ "To drop", # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "10b" & # Positive COVID test at phase 10b
                      (outcome_phase_selfharm_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                      )
         )
  
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_SHI_12b =
           case_when(exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                      (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                          ) ~ "To drop", # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "12b" & # Positive COVID test at phase 12b
                     (outcome_phase_selfharm_ideation == "12b" | # Co-occurring outcome and exposure
                        outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_12b)

# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_SHI_14b =
           case_when(exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                      (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" 
                      ) ~ "To drop", # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "14b" & # Positive COVID test at phase 14b
                     (outcome_phase_selfharm_ideation == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a")  ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_14b)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_SHI_16b =
           case_when(exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                      (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" | 
                       outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" |
                      outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a") ~ "To drop", # First self-harm ideation occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "16b" & # Positive COVID test at phase 16b
                     (outcome_phase_selfharm_ideation == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "17a")  ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_16b)
```

Positive COVID test before self-harm ideation
NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ See comments above
```{r Positve COVID test result exposure self-harm ideation - virus Q}

dat <- dat %>%
  mutate(positive_covid_test_before_SHI =
           case_when(# First positive test NOT before first experience of outcome
                    positive_covid_test_SHI_1b == "To drop" |
                    positive_covid_test_SHI_2b == "To drop" |
                    positive_covid_test_SHI_3b == "To drop" |
                    positive_covid_test_SHI_4b == "To drop" |
                    positive_covid_test_SHI_6b == "To drop" |
                    positive_covid_test_SHI_8b == "To drop" |
                    positive_covid_test_SHI_10b == "To drop" |
                    positive_covid_test_SHI_12b == "To drop" |
                      positive_covid_test_SHI_14b == "To drop" |
                    positive_covid_test_SHI_16b == "To drop" ~ "Positive test after self-harm ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether test taken" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Test taken but not answered test result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of outcome
                    positive_covid_test_SHI_1b == "Yes" |
                    positive_covid_test_SHI_2b == "Yes" |
                    positive_covid_test_SHI_3b == "Yes" |
                    positive_covid_test_SHI_4b == "Yes" |
                    positive_covid_test_SHI_6b == "Yes" |
                    positive_covid_test_SHI_8b == "Yes" |
                    positive_covid_test_SHI_10b == "Yes" |
                    positive_covid_test_SHI_12b == "Yes" |
                    positive_covid_test_SHI_14b == "Yes" |
                    positive_covid_test_SHI_16b == "Yes" ~ "Positive test before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    positive_covid_test_SHI_1b == "No outcome" |
                    positive_covid_test_SHI_2b == "No outcome" |
                    positive_covid_test_SHI_3b == "No outcome" |
                    positive_covid_test_SHI_4b == "No outcome" |
                    positive_covid_test_SHI_6b == "No outcome" |
                    positive_covid_test_SHI_8b == "No outcome" |
                    positive_covid_test_SHI_10b == "No outcome" |
                    positive_covid_test_SHI_12b == "No outcome" |
                     positive_covid_test_SHI_14b == "No outcome" |
                    positive_covid_test_SHI_16b == "No outcome"  ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "Neither exposure nor outcome"
                   
      )
)

# Check 
dat %>%
  freq(positive_covid_test_before_SHI)


# Create final variable of positive COVID test before self-harm ideation outcome
dat <- dat %>%
  mutate(positive_covid_test_before_SHI_final =
           case_when(positive_covid_test_before_SHI == "Positive test after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_SHI == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_SHI == "Missing test result" |
                     positive_covid_test_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                     positive_covid_test_before_SHI == "Negative test" |
                     positive_covid_test_before_SHI == "Not taken test" |
                     positive_covid_test_before_SHI == "Inconclusive test" |
                      positive_covid_test_before_SHI ==  "Outcome but no exposure" |
                     positive_covid_test_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                    
                       positive_covid_test_before_SHI == "Exposure but no outcome" |
                    positive_covid_test_before_SHI == "Positive test before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_SHI_final) 

```

Self-harm 
NB: Self-harm was asked at EVERY phase, whereas positive COVID test was asked only at follow up B. 
```{r Positive COVID test result exposure BEFORE outcome SELF-HARM  - virus Q}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_SH_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA/PNTA are coded as "Not answered or PNTA")
                     
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     (outcome_phase_selfharm == "Baseline" |
                      outcome_phase_selfharm == "1a") ~ "To drop",  # First self-harm occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_selfharm == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                         outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_SH_2b =
           case_when(exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" | 
                      outcome_phase_selfharm == "2a") ~ "To drop", # First self-harm occurred before first positive COVID test - need to drop
                     
                      exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                         outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
# Check
dat %>%
  freq(positive_covid_test_SH_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_SH_3b =
           case_when(exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                       (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" | 
                        outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a") ~ "To drop", # First self-harm occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "3b" &  # First positive COVID test at phase 3b
                     (outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                        outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_SH_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_SH_4b =
           case_when(exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                       (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a") ~ "To drop", # First self-harm occurred before first positive COVID test - need to drop
                     
                       exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4B
                       (outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                         outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
              
# Check
dat %>%
  freq(positive_covid_test_SH_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_SH_6b =
           case_when(exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" | 
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a") ~ "To drop",  # First self-harm occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                      (outcome_phase_selfharm == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                         outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_SH_8b =
           case_when(exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b 
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a") ~ "To drop", # First self-harm occurred before foutcome_phase_selfharm_ideation
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_selfharm == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_SH_10b =
           case_when(exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b 
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a") ~ "To drop", # First self-harm occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "10b" & # Positive COVID test at phase 10b
                      (outcome_phase_selfharm == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                         outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                      )
         )
  
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_SH_12b =
           case_when(exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                      (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a") ~ "To drop", # First self-harm occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "12b" & # Positive COVID test at phase 12b
                     (outcome_phase_selfharm == "12b" |
                        outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a")  ~ "Yes" # Co-occurring outcome and exposure
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_12b)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_SH_14b =
           case_when(exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                      (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                         outcome_phase_selfharm == "12b" |
                        outcome_phase_selfharm == "13a" ) ~ "To drop", # First self-harm occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "14b" & # Positive COVID test at phase 14b
                     (outcome_phase_selfharm == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a")  ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_14b)

# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_SH_16b =
           case_when(exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")

                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                      (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" | 
                       outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                         outcome_phase_selfharm == "12b" |
                        outcome_phase_selfharm == "13a"  |
                         outcome_phase_selfharm == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "15a" 
                      ) ~ "To drop", # First self-harm occurred before first positive COVID test - need to drop
                     
                     exposure_phase_positive_covid_test == "16b" & # Positive COVID test at phase 16b
                     (outcome_phase_selfharm == "16b" | # co-occuring
                       outcome_phase_selfharm == "17a")  ~ "Yes" 
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_16b)
```

Positive COVID test before self-harm
NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ See comments above
```{r Positve COVID test result exposure self-harm - virus Q}

dat <- dat %>%
  mutate(positive_covid_test_before_SH =
           case_when(# First positive test NOT before first experience of outcome
                    positive_covid_test_SH_1b == "To drop" |
                    positive_covid_test_SH_2b == "To drop" |
                    positive_covid_test_SH_3b == "To drop" |
                    positive_covid_test_SH_4b == "To drop" |
                    positive_covid_test_SH_6b == "To drop" |
                    positive_covid_test_SH_8b == "To drop" |
                    positive_covid_test_SH_10b == "To drop" |
                    positive_covid_test_SH_12b == "To drop" |
                    positive_covid_test_SH_14b == "To drop" |
                    positive_covid_test_SH_16b == "To drop"  ~ "Positive test after self-harm",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether test taken" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Test taken but not answered test result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm== "Not answered or PNTA" ~ "Missing whether experienced self-harm", # Need to be dropped
                    
                    # First positive test BEFORE first experience of outcome
                    positive_covid_test_SH_1b == "Yes" |
                    positive_covid_test_SH_2b == "Yes" |
                    positive_covid_test_SH_3b == "Yes" |
                    positive_covid_test_SH_4b == "Yes" |
                    positive_covid_test_SH_6b == "Yes" |
                    positive_covid_test_SH_8b == "Yes" |
                    positive_covid_test_SH_10b == "Yes" |
                    positive_covid_test_SH_12b == "Yes" |
                      positive_covid_test_SH_14b == "Yes" |
                    positive_covid_test_SH_16b == "Yes" ~ "Positive test before self-harm",
                    
                   # Experienced exposure but not outcome
                    positive_covid_test_SH_1b == "No outcome" |
                    positive_covid_test_SH_2b == "No outcome" |
                    positive_covid_test_SH_3b == "No outcome" |
                    positive_covid_test_SH_4b == "No outcome" |
                    positive_covid_test_SH_6b == "No outcome" |
                    positive_covid_test_SH_8b == "No outcome" |
                    positive_covid_test_SH_10b == "No outcome" |
                    positive_covid_test_SH_12b == "No outcome" |
                     ositive_covid_test_SH_14b == "No outcome" |
                    positive_covid_test_SH_16b == "No outcome" ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_selfharm != "Not answered or PNTA" |
                        outcome_phase_selfharm != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_selfharm == "Not experienced" ~ "Neither exposure nor outcome"
                   
      )
)

# Check 
dat %>%
  freq(positive_covid_test_before_SH)


# Create final variable of positive COVID test before self-harm outcome
dat <- dat %>%
  mutate(positive_covid_test_before_SH_final =
           case_when(positive_covid_test_before_SH == "Positive test after self-harm" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_SH == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_SH == "Missing test result" |
                     positive_covid_test_before_SH == "Missing whether experienced self-harm" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm
                     
                     positive_covid_test_before_SH == "Negative test" |
                     positive_covid_test_before_SH == "Not taken test" |
                     positive_covid_test_before_SH == "Inconclusive test" |
                     positive_covid_test_before_SH ==  "Outcome but no exposure" |
                     positive_covid_test_before_SH ==  "Neither exposure nor outcome" ~ "No",
                    
                     
                       positive_covid_test_before_SH == "Exposure but no outcome" |
                    positive_covid_test_before_SH == "Positive test before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_SH_final) 
```

### Positive COVID test - resp questionnaire
NB: The 'resp' questionnaire is asked at baseline and at every follow up phase, so will include positive tests indicated in this questionnaire as well as in the 'virus' questionnaire.

# Identify at which phase they first experienced the exposure
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.

resp.nose_throat_swab_test = TAKEN swab test
resp.results_nose_throat_swab_test = results of swab test
resp.antibody_test = TAKEN antibody test
resp.results_antibody_test = results of antibody test
```{r First experience of exposure - positive COVID test resp Q}
dat <- dat %>%
  mutate(exposure_phase_positive_covid_test2 =
           case_when(  
             # Questions about whether they have taken a test - all missing
                       is.na(resp.nose_throat_swab_test) &
                       is.na(resp.antibody_test) &
                       is.na(resp.nose_throat_swab_test_.Wave_1a) &
                       is.na(resp.antibody_test_.Wave_1a) &
                        is.na(resp.nose_throat_swab_test_.Wave_1b) &
                       is.na(resp.antibody_test_.Wave_1b) & 
                         is.na(resp.nose_throat_swab_test_.Wave_2a) &
                       is.na(resp.antibody_test_.Wave_2a) &
                         is.na(resp.nose_throat_swab_test_.Wave_2b) &
                       is.na(resp.antibody_test_.Wave_2b) &
                         is.na(resp.nose_throat_swab_test_.Wave_3a) &
                       is.na(resp.antibody_test_.Wave_3a) &
                         is.na(resp.nose_throat_swab_test_.Wave_3b) &
                       is.na(resp.antibody_test_.Wave_3b) &
                         is.na(resp.nose_throat_swab_test_.Wave_4a) &
                       is.na(resp.antibody_test_.Wave_4a) &
                         is.na(resp.nose_throat_swab_test_.Wave_4b) &
                       is.na(resp.antibody_test_.Wave_4b) &
                         is.na(resp.nose_throat_swab_test_.Wave_5a) &
                       is.na(resp.antibody_test_.Wave_5a) &
                         is.na(resp.nose_throat_swab_test_.Wave_6b) &
                       is.na(resp.antibody_test_.Wave_6b) &
                         is.na(resp.nose_throat_swab_test_.Wave_7a) &
                       is.na(resp.antibody_test_.Wave_7a) &
                         is.na(resp.nose_throat_swab_test_.Wave_8b) &
                       is.na(resp.antibody_test_.Wave_8b) &
                         is.na(resp.nose_throat_swab_test_.Wave_9a) &
                       is.na(resp.antibody_test_.Wave_9a) &
                         is.na(resp.nose_throat_swab_test_.Wave_10b) &
                       is.na(resp.antibody_test_.Wave_10b) &
                         is.na(resp.nose_throat_swab_test_.Wave_11a) &
                       is.na(resp.antibody_test_.Wave_11a) &
                         is.na(resp.nose_throat_swab_test_.Wave_12b) &
                       is.na(resp.antibody_test_.Wave_12b) &
                         is.na(resp.nose_throat_swab_test_.Wave_13a) &
                       is.na(resp.antibody_test_.Wave_13a) &
                         is.na(resp.nose_throat_swab_test_.Wave_14b) &
                       is.na(resp.antibody_test_.Wave_14b) &
                         is.na(resp.nose_throat_swab_test_.Wave_15a) &
                       is.na(resp.antibody_test_.Wave_15a) &
                         is.na(resp.nose_throat_swab_test_.Wave_16b) &
                       is.na(resp.antibody_test_.Wave_16b) &
                         is.na(resp.nose_throat_swab_test_.Wave_17a) &
                       is.na(resp.antibody_test_.Wave_17a) ~ "Not answered whether taken test",
         
         # Question about whether they have taken a test - No at least once and rest missing (i.e., never said yes to taking a test)
            (is.na(resp.nose_throat_swab_test) |
                       resp.nose_throat_swab_test == "No") &
                         
            (is.na(resp.antibody_test) |
                         resp.antibody_test == "No") &
                     
            (is.na(resp.nose_throat_swab_test_.Wave_1a) |
                       resp.nose_throat_swab_test_.Wave_1a == "No") &
                         
            (is.na(resp.antibody_test_.Wave_1a) |
                         resp.antibody_test_.Wave_1a == "No") &
           
            (is.na(resp.nose_throat_swab_test_.Wave_1b) |
                       resp.nose_throat_swab_test_.Wave_1b == "No") &
                         
             (is.na(resp.antibody_test_.Wave_1b) |
                         resp.antibody_test_.Wave_1b == "No") &
           
            (is.na(resp.nose_throat_swab_test_.Wave_2a) |
                       resp.nose_throat_swab_test_.Wave_2a == "No") &
                         
             (is.na(resp.antibody_test_.Wave_2a) |
                         resp.antibody_test_.Wave_2a == "No") &
           
            (is.na(resp.nose_throat_swab_test_.Wave_2b) |
                       resp.nose_throat_swab_test_.Wave_2b == "No") &
                         
           (is.na(resp.antibody_test_.Wave_2b) |
                         resp.antibody_test_.Wave_2b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_3a) |
                       resp.nose_throat_swab_test_.Wave_3a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_3a) |
                         resp.antibody_test_.Wave_3a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_3b) |
                       resp.nose_throat_swab_test_.Wave_3b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_3b) |
                         resp.antibody_test_.Wave_3b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_4a) |
                       resp.nose_throat_swab_test_.Wave_4a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_4a) |
                         resp.antibody_test_.Wave_4a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_4b) |
                       resp.nose_throat_swab_test_.Wave_4b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_4b) |
                         resp.antibody_test_.Wave_4b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_5a) |
                       resp.nose_throat_swab_test_.Wave_5a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_5a) |
                         resp.antibody_test_.Wave_5a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_6b) |
                       resp.nose_throat_swab_test_.Wave_6b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_6b) |
                         resp.antibody_test_.Wave_6b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_7a) |
                       resp.nose_throat_swab_test_.Wave_7a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_7a) |
                         resp.antibody_test_.Wave_7a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_8b) |
                       resp.nose_throat_swab_test_.Wave_8b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_8b) |
                         resp.antibody_test_.Wave_8b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_9a) |
                       resp.nose_throat_swab_test_.Wave_9a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_9a) |
                         resp.antibody_test_.Wave_9a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_10b) |
                       resp.nose_throat_swab_test_.Wave_10b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_10b) |
                         resp.antibody_test_.Wave_10b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_11a) |
                       resp.nose_throat_swab_test_.Wave_11a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_11a) |
                         resp.antibody_test_.Wave_11a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_12b) |
                       resp.nose_throat_swab_test_.Wave_12b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_12b) |
                         resp.antibody_test_.Wave_12b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_13a) |
                       resp.nose_throat_swab_test_.Wave_13a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_13a) |
                         resp.antibody_test_.Wave_13a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_14b) |
                       resp.nose_throat_swab_test_.Wave_14b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_14b) |
                         resp.antibody_test_.Wave_14b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_15a) |
                       resp.nose_throat_swab_test_.Wave_15a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_15a) |
                         resp.antibody_test_.Wave_15a == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_16b) |
                       resp.nose_throat_swab_test_.Wave_16b == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_16b) |
                         resp.antibody_test_.Wave_16b == "No") &
           
           (is.na(resp.nose_throat_swab_test_.Wave_17a) |
                       resp.nose_throat_swab_test_.Wave_17a == "No") &
                         
                        (is.na(resp.antibody_test_.Wave_17a) |
                         resp.antibody_test_.Wave_17a == "No") ~ "Not taken test",
         
         # Question about results of their test
            is.na(resp.results_nose_throat_swab_test) &
                        is.na(resp.results_antibody_test) &
           is.na(resp.results_nose_throat_swab_test_.Wave_1a) &
                        is.na(resp.results_antibody_test_.Wave_1a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_1b) &
                        is.na(resp.results_antibody_test_.Wave_1b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_2a) &
                        is.na(resp.results_antibody_test_.Wave_2a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_2b) &
                        is.na(resp.results_antibody_test_.Wave_2b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_3a) &
                        is.na(resp.results_antibody_test_.Wave_3a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_3b) &
                        is.na(resp.results_antibody_test_.Wave_3b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_4a) &
                        is.na(resp.results_antibody_test_.Wave_4a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_4b) &
                        is.na(resp.results_antibody_test_.Wave_4b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_5a) &
                        is.na(resp.results_antibody_test_.Wave_5a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_6b) &
                        is.na(resp.results_antibody_test_.Wave_6b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_7a) &
                        is.na(resp.results_antibody_test_.Wave_7a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_8b) &
                        is.na(resp.results_antibody_test_.Wave_8b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_9a) &
                        is.na(resp.results_antibody_test_.Wave_9a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_10b) &
                        is.na(resp.results_antibody_test_.Wave_10b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_11a) &
                        is.na(resp.results_antibody_test_.Wave_11a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_12b) &
                        is.na(resp.results_antibody_test_.Wave_12b) &
          is.na(resp.results_nose_throat_swab_test_.Wave_13a) &
                        is.na(resp.results_antibody_test_.Wave_13a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_14b) &
                        is.na(resp.results_antibody_test_.Wave_14b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_15a) &
                        is.na(resp.results_antibody_test_.Wave_15a) &
           is.na(resp.results_nose_throat_swab_test_.Wave_16b) &
                        is.na(resp.results_antibody_test_.Wave_16b) &
           is.na(resp.results_nose_throat_swab_test_.Wave_17a) &
                        is.na(resp.results_antibody_test_.Wave_17a) ~ "Taken test but not indicated result", 
                       
                       resp.results_nose_throat_swab_test == "Positive" | 
                       resp.results_antibody_test == "Positive"  ~ "Baseline",
                       
                       resp.results_nose_throat_swab_test_.Wave_1a == "Positive" | 
                       resp.results_antibody_test_.Wave_1a == "Positive"  ~ "1a",
                       
                       resp.results_nose_throat_swab_test_.Wave_1b == "Positive" | 
                       resp.results_antibody_test_.Wave_1b == "Positive"  ~ "1b",
                       
                       resp.results_nose_throat_swab_test_.Wave_2a == "Positive" | 
                       resp.results_antibody_test_.Wave_2a == "Positive"  ~ "2a",
                       
                       resp.results_nose_throat_swab_test_.Wave_2b == "Positive" | 
                       resp.results_antibody_test_.Wave_2b == "Positive"  ~ "2b",
                       
                       resp.results_nose_throat_swab_test_.Wave_3a == "Positive" | 
                       resp.results_antibody_test_.Wave_3a == "Positive"  ~ "3a",
                       
                       resp.results_nose_throat_swab_test_.Wave_3b == "Positive" | 
                       resp.results_antibody_test_.Wave_3b == "Positive"  ~ "3b",
                       
                       resp.results_nose_throat_swab_test_.Wave_4a == "Positive" | 
                       resp.results_antibody_test_.Wave_4a == "Positive"  ~ "4a",
                       
                       resp.results_nose_throat_swab_test_.Wave_4b == "Positive" | 
                       resp.results_antibody_test_.Wave_4b == "Positive"  ~ "4b",
                       
                       resp.results_nose_throat_swab_test_.Wave_5a == "Positive" | 
                       resp.results_antibody_test_.Wave_5a == "Positive"  ~ "5a",
                       
                       resp.results_nose_throat_swab_test_.Wave_6b == "Positive" | 
                       resp.results_antibody_test_.Wave_6b == "Positive"  ~ "6b",
                       
                       resp.results_nose_throat_swab_test_.Wave_7a == "Positive" | 
                       resp.results_antibody_test_.Wave_7a == "Positive"  ~ "7a",
                       
                       resp.results_nose_throat_swab_test_.Wave_8b == "Positive" | 
                       resp.results_antibody_test_.Wave_8b == "Positive"  ~ "8b",
                       
                       resp.results_nose_throat_swab_test_.Wave_9a == "Positive" | 
                       resp.results_antibody_test_.Wave_9a == "Positive"  ~ "9a",
                       
                       resp.results_nose_throat_swab_test_.Wave_10b == "Positive" | 
                       resp.results_antibody_test_.Wave_10b == "Positive"  ~ "10b",
                       
                       resp.results_nose_throat_swab_test_.Wave_11a == "Positive" | 
                       resp.results_antibody_test_.Wave_11a == "Positive"  ~ "11a",
                       
                       resp.results_nose_throat_swab_test_.Wave_12b == "Positive" | 
                       resp.results_antibody_test_.Wave_12b == "Positive"  ~ "12b",
         
                     resp.results_nose_throat_swab_test_.Wave_13a == "Positive" | 
                       resp.results_antibody_test_.Wave_13a == "Positive"  ~ "13a",
         
                 resp.results_nose_throat_swab_test_.Wave_14b == "Positive" | 
                       resp.results_antibody_test_.Wave_14b == "Positive"  ~ "14b",
         
         resp.results_nose_throat_swab_test_.Wave_15a == "Positive" | 
                       resp.results_antibody_test_.Wave_15a == "Positive"  ~ "15a",
         
         resp.results_nose_throat_swab_test_.Wave_16b == "Positive" | 
                       resp.results_antibody_test_.Wave_16b == "Positive"  ~ "16b",
         
         resp.results_nose_throat_swab_test_.Wave_17a == "Positive" | 
                       resp.results_antibody_test_.Wave_17a == "Positive"  ~ "17a",
         
                TRUE ~ "Not positive"  # Then, everyone who is left over, i.e., NA, will have answered "No" or "Unsure/inconclusive" at least once to whether the test was positive, even if they are missing for all other phases. The only people we can not assume an answer for (i.e., has experienced or has not experienced) is those who never answered the question throughout the whole time period
         )
  )

# Check
dat %>%
  freq(exposure_phase_positive_covid_test2)
```

Binge eating 
```{r Positve COVID test result exposure BEFORE outcome BE - resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_BE_baseline =
           case_when(exposure_phase_positive_covid_test2 == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of BE
                        exposure_phase_positive_covid_test2 == "Baseline" & 
                       (outcome_phase_binge_eating == "1b" | 
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_BE_1a2 =
           case_when(exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of BE
                        exposure_phase_positive_covid_test2 == "1a" & 
                       (outcome_phase_binge_eating == "1b" | 
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_1a2)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_BE_1b2 =
           case_when(exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_binge_eating == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_BE_1b2)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_BE_2a2 =
           case_when(exposure_phase_positive_covid_test2 == "2a" &
                     (outcome_phase_binge_eating == "1b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_binge_eating == "2b" | 
                        outcome_phase_binge_eating == "3b" | 
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_2a2)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_BE_2b2 =
           case_when(exposure_phase_positive_covid_test2 == "2b" &
                     (outcome_phase_binge_eating == "1b" )  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop
                    
                      exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                         outcome_phase_binge_eating == "3b" |
                         outcome_phase_binge_eating == "4b" | 
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_2b2)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_BE_3a2 =
           case_when(exposure_phase_positive_covid_test2 == "3a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                      outcome_phase_binge_eating == "6b" | 
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_BE_3a2)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_BE_3b2 =
           case_when(exposure_phase_positive_covid_test2 == "3b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" )  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                    
                      exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                        outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_3b2)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_BE_4a2 =
           case_when(exposure_phase_positive_covid_test2 == "4a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                        outcome_phase_binge_eating == "10b" | 
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_4a2)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_BE_4b2 =
           case_when(exposure_phase_positive_covid_test2 == "4b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_4b2)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_BE_5a2 =
           case_when(exposure_phase_positive_covid_test2 == "5a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_5a2)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_BE_6b2 =
           case_when(exposure_phase_positive_covid_test2 == "6b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_binge_eating == "6b" | # Co-occuring symptom and exposure
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_6b2)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_BE_7a2 =
           case_when(exposure_phase_positive_covid_test2 == "7a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_7a2)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_BE_8b2 =
           case_when(exposure_phase_positive_covid_test2 == "8b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                   outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_binge_eating == "8b" |  # Co-occuring symptom and exposure
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_8b2)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_BE_9a2 =
           case_when(exposure_phase_positive_covid_test2 == "9a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_9a2)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_BE_10b2 =
           case_when(exposure_phase_positive_covid_test2 == "10b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    (outcome_phase_binge_eating == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_10b2)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_BE_11a2 =
           case_when(exposure_phase_positive_covid_test2 == "11a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                   outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_11a2)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_BE_12b2 =
           case_when(exposure_phase_positive_covid_test2 == "12b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                   (outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occuring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_12b2)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_BE_13a2 =
           case_when(exposure_phase_positive_covid_test2 == "13a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                   (outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
                             
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_13a2)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_BE_14b2 =
           case_when(exposure_phase_positive_covid_test2 == "14b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                   (outcome_phase_binge_eating == "14b" | # Co-occuring symptom and exposure
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_14b2)


# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_BE_15a2 =
           case_when(exposure_phase_positive_covid_test2 == "15a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" )  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                     outcome_phase_binge_eating == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_15a2)

# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_BE_16b2 =
           case_when(exposure_phase_positive_covid_test2 == "16b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                   outcome_phase_binge_eating == "16b" ~ "Yes" # Co-occuring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_16b2)

# Phase 17a
dat <- dat %>%
  mutate(positive_covid_test_BE_17a2 =
           case_when(exposure_phase_positive_covid_test2 == "17a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                        outcome_phase_binge_eating == "16b")  ~ "To drop", # First experience of binge eating occurred before first COVID test - need to drop 
                     exposure_phase_positive_covid_test2 == "17a" & # First positive COVID test at phase 17a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_17a2)
```

Binge eating & Positive COVID test result
```{r Positve COVID test result exposure BE - resp Q}

dat <- dat %>%
  mutate(positive_covid_test_before_BE2 =
           case_when(# First exposure NOT before first experience of outcome
                positive_covid_test_BE_baseline == "To drop" |
                            positive_covid_test_BE_1a2 == "To drop" |
                    positive_covid_test_BE_1b2 == "To drop" |
               positive_covid_test_BE_2a2 == "To drop" |
                    positive_covid_test_BE_2b2 == "To drop" |
               positive_covid_test_BE_3a2 == "To drop" |
                    positive_covid_test_BE_3b2 == "To drop" |
               positive_covid_test_BE_4a2 == "To drop" |
                    positive_covid_test_BE_4b2 == "To drop" |
               positive_covid_test_BE_5a2 == "To drop" |
                    positive_covid_test_BE_6b2 == "To drop" |
               positive_covid_test_BE_7a2 == "To drop" |
                    positive_covid_test_BE_8b2 == "To drop" |
               positive_covid_test_BE_9a2 == "To drop" |
                    positive_covid_test_BE_10b2 == "To drop" |
              positive_covid_test_BE_11a2 == "To drop" |
                    positive_covid_test_BE_12b2 == "To drop" |
                positive_covid_test_BE_13a2 == "To drop" |
                    positive_covid_test_BE_14b2 == "To drop" |
                positive_covid_test_BE_15a2 == "To drop" |
                    positive_covid_test_BE_16b2 == "To drop" |
                positive_covid_test_BE_17a2 == "To drop" ~ "Positive test after binge eating",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test2 == "Not answered whether taken test" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test2 == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test2 == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "Missing whether experienced binge eating", # Need to be dropped
                    
                    # First positive test BEFORE first experience of binge eating
             positive_covid_test_BE_baseline == "Yes" |
                    positive_covid_test_BE_1a2 == "Yes" |
             positive_covid_test_BE_1b2 == "Yes" |
               positive_covid_test_BE_2a2 == "Yes" |
              positive_covid_test_BE_2b2 == "Yes" |
               positive_covid_test_BE_3a2== "Yes" |
                    positive_covid_test_BE_3b2 == "Yes" |
               positive_covid_test_BE_4a2 == "Yes" |
                    positive_covid_test_BE_4b2 == "Yes" |
               positive_covid_test_BE_5a2 == "Yes" |
                    positive_covid_test_BE_6b2 == "Yes" |
               positive_covid_test_BE_7a2 == "Yes" |
                    positive_covid_test_BE_8b2 == "Yes" |
               positive_covid_test_BE_9a2 == "Yes" |
                    positive_covid_test_BE_10b2== "Yes" |
               positive_covid_test_BE_11a2 == "Yes" |
                    positive_covid_test_BE_12b2 == "Yes" |
               positive_covid_test_BE_13a2 == "Yes" |
                    positive_covid_test_BE_14b2 == "Yes" |
               positive_covid_test_BE_15a2 == "Yes" |
                    positive_covid_test_BE_16b2 == "Yes" |
               positive_covid_test_BE_17a2 == "Yes"  ~ "Positive test before binge eating",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_BE_baseline == "No outcome" |
             positive_covid_test_BE_1a2 == "No outcome" |
                    positive_covid_test_BE_1b2 == "No outcome" |
               positive_covid_test_BE_2a2 == "No outcome" |
                    positive_covid_test_BE_2b2 == "No outcome" |
               positive_covid_test_BE_3a2 == "No outcome" |
                    positive_covid_test_BE_3b2 == "No outcome" |
               positive_covid_test_BE_4a2 == "No outcome" |
                    positive_covid_test_BE_4b == "No outcome" |
               positive_covid_test_BE_5a2 == "No outcome" |
                    positive_covid_test_BE_6b2 == "No outcome" |
               positive_covid_test_BE_7a2 == "No outcome" |
                    positive_covid_test_BE_8b2 == "No outcome" |
               positive_covid_test_BE_9a2 == "No outcome" |
                    positive_covid_test_BE_10b2 == "No outcome" |
               positive_covid_test_BE_11a2 == "No outcome" |
                    positive_covid_test_BE_12b2 == "No outcome" |
               positive_covid_test_BE_13a2 == "No outcome" |
                    positive_covid_test_BE_14b2 == "No outcome" |
               positive_covid_test_BE_15a2 == "No outcome" |
                    positive_covid_test_BE_16b2 == "No outcome" |
               positive_covid_test_BE_17a2 == "No outcome" ~ "Exposure but no outcome",
             
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     (outcome_phase_binge_eating != "Not answered" |
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     outcome_phase_binge_eating == "Not experienced" ~ "Neither exposure nor outcome"
  
      )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_BE2) 


# Create final variable of positive COVID test before BE outcome
dat <- dat %>%
  mutate(positive_covid_test_before_BE_final2 =
           case_when(positive_covid_test_before_BE2 == "Positive test after binge eating" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_BE2 == "Missing whether taken test" | # Need to drop people who never answered whether they'd experienced the exposure
                       positive_covid_test_before_BE2 == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_BE2 == "Missing whether experienced binge eating" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                     positive_covid_test_before_BE2 == "Awaiting result or negative" |
                     positive_covid_test_before_BE2 == "Not taken test" |
                     positive_covid_test_before_BE2 ==  "Outcome but no exposure" |
                     positive_covid_test_before_BE2 ==  "Neither exposure nor outcome" ~ "No",
                    
                     
                       positive_covid_test_before_BE2 == "Exposure but no outcome" |
                    positive_covid_test_before_BE2 == "Positive test before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_BE_final2) 

```

Low weight 
```{r Positve COVID test result exposure BEFORE outcome LW - resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_LW_baseline =
           case_when(exposure_phase_positive_covid_test2 == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of LW
                        exposure_phase_positive_covid_test2 == "Baseline" & 
                       (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_LW_1a2 =
           case_when(exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of LW
                        exposure_phase_positive_covid_test2 == "1a" & 
                       (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_1a2)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_LW_1b2 =
           case_when(exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_low_weight == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_LW_1b2)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_LW_2a2 =
           case_when(exposure_phase_positive_covid_test2 == "2a" &
                     (outcome_phase_low_weight == "1b")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_low_weight == "2b" | 
                        outcome_phase_low_weight == "3b" | 
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2a2)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_LW_2b2 =
           case_when(exposure_phase_positive_covid_test2 == "2b" &
                     (outcome_phase_low_weight == "1b" )  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                         outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" | 
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2b2)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_LW_3a2 =
           case_when(exposure_phase_positive_covid_test2 == "3a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" | 
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_LW_3a2)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_LW_3b2 =
           case_when(exposure_phase_positive_covid_test2 == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" )  ~ "To drop", # First experience of  low weightoccurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_3b2)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_LW_4a2 =
           case_when(exposure_phase_positive_covid_test2 == "4a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" | 
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_4a2)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_LW_4b2 =
           case_when(exposure_phase_positive_covid_test2 == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_4b2)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_LW_5a2 =
           case_when(exposure_phase_positive_covid_test2 == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_5a2)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_LW_6b2 =
           case_when(exposure_phase_positive_covid_test2 == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_low_weight == "6b" | # Co-occuring symptom and exposure
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_6b2)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_LW_7a2 =
           case_when(exposure_phase_positive_covid_test2 == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_7a2)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_LW_8b2 =
           case_when(exposure_phase_positive_covid_test2 == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_low_weight == "8b" |  # Co-occuring symptom and exposure
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_8b2)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_LW_9a2 =
           case_when(exposure_phase_positive_covid_test2 == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_9a2)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_LW_10b2 =
           case_when(exposure_phase_positive_covid_test2 == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight== "2b" |
                     outcome_phase_low_weight== "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    (outcome_phase_low_weight == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_10b2)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_LW_11a2 =
           case_when(exposure_phase_positive_covid_test2 == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_11a2)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_LW_12b2 =
           case_when(exposure_phase_positive_covid_test2 == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_12b2)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_LW_13a2 =
           case_when(exposure_phase_positive_covid_test2 == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    (outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_13a2)

# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_LW_14b2 =
           case_when(exposure_phase_positive_covid_test2 == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                    (outcome_phase_low_weight == "14b" | # Co-occurring symptom and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_14b2)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_LW_15a2 =
           case_when(exposure_phase_positive_covid_test2 == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" 
                     )  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                     outcome_phase_low_weight == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_15a2)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_LW_16b2 =
           case_when(exposure_phase_positive_covid_test2 == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" 
                     )  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                     outcome_phase_low_weight == "16b" ~ "Yes"  # Co-occurring
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_16b2)


# Phase 17a
dat <- dat %>%
  mutate(positive_covid_test_LW_17a2 =
           case_when(exposure_phase_positive_covid_test2 == "17a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"
                     )  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "17a" & # First positive COVID test at phase 17a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_17a2)
```

Low weight & Positive COVID test result
```{r Positve COVID test result exposure LW - resp Q}

dat <- dat %>%
  mutate(positive_covid_test_before_LW2 =
           case_when(# First exposure NOT before first experience of outcome
                positive_covid_test_LW_baseline == "To drop" |
                            positive_covid_test_LW_1a2 == "To drop" |
                    positive_covid_test_LW_1b2 == "To drop" |
               positive_covid_test_LW_2a2 == "To drop" |
                    positive_covid_test_LW_2b2 == "To drop" |
               positive_covid_test_LW_3a2 == "To drop" |
                    positive_covid_test_LW_3b2 == "To drop" |
               positive_covid_test_LW_4a2 == "To drop" |
                    positive_covid_test_LW_4b2 == "To drop" |
               positive_covid_test_LW_5a2 == "To drop" |
                    positive_covid_test_LW_6b2 == "To drop" |
               positive_covid_test_LW_7a2 == "To drop" |
                    positive_covid_test_LW_8b2 == "To drop" |
               positive_covid_test_LW_9a2 == "To drop" |
                    positive_covid_test_LW_10b2 == "To drop" |
              positive_covid_test_LW_11a2 == "To drop" |
                    positive_covid_test_LW_12b2 == "To drop" |
                positive_covid_test_LW_13a2 == "To drop" |
                    positive_covid_test_LW_14b2 == "To drop" |
                 positive_covid_test_LW_15a2 == "To drop" |
                    positive_covid_test_LW_16b2 == "To drop" |
                 positive_covid_test_LW_17a2 == "To drop" ~ "Positive test after low weight",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test2 == "Not answered whether taken test" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test2 == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test2 == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced binge eating 
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                    # First exposure BEFORE first experience of outcome
             positive_covid_test_LW_baseline == "Yes" |
                    positive_covid_test_LW_1a2 == "Yes" |
             positive_covid_test_LW_1b2 == "Yes" |
               positive_covid_test_LW_2a2 == "Yes" |
              positive_covid_test_LW_2b2 == "Yes" |
               positive_covid_test_LW_3a2== "Yes" |
                    positive_covid_test_LW_3b2 == "Yes" |
               positive_covid_test_LW_4a2 == "Yes" |
                    positive_covid_test_LW_4b2 == "Yes" |
               positive_covid_test_LW_5a2 == "Yes" |
                    positive_covid_test_LW_6b2 == "Yes" |
               positive_covid_test_LW_7a2 == "Yes" |
                    positive_covid_test_LW_8b2 == "Yes" |
               positive_covid_test_LW_9a2 == "Yes" |
                    positive_covid_test_LW_10b2== "Yes" |
               positive_covid_test_LW_11a2 == "Yes" |
                    positive_covid_test_LW_12b2 == "Yes" |
               positive_covid_test_LW_13a2 == "Yes" |
                    positive_covid_test_LW_14b2 == "Yes" |
               positive_covid_test_LW_15a2 == "Yes" |
                    positive_covid_test_LW_16b2 == "Yes" |
               positive_covid_test_LW_17a2 == "Yes" ~ "Positive test before low weight",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_LW_baseline == "No outcome" |
             positive_covid_test_LW_1a2 == "No outcome" |
                    positive_covid_test_LW_1b2 == "No outcome" |
               positive_covid_test_LW_2a2 == "No outcome" |
                    positive_covid_test_LW_2b2 == "No outcome" |
               positive_covid_test_LW_3a2 == "No outcome" |
                    positive_covid_test_LW_3b2 == "No outcome" |
               positive_covid_test_LW_4a2 == "No outcome" |
                    positive_covid_test_LW_4b == "No outcome" |
               positive_covid_test_LW_5a2 == "No outcome" |
                    positive_covid_test_LW_6b2 == "No outcome" |
               positive_covid_test_LW_7a2 == "No outcome" |
                    positive_covid_test_LW_8b2 == "No outcome" |
               positive_covid_test_LW_9a2 == "No outcome" |
                    positive_covid_test_LW_10b2 == "No outcome" |
               positive_covid_test_LW_11a2 == "No outcome" |
                    positive_covid_test_LW_12b2 == "No outcome" |
               positive_covid_test_LW_13a2 == "No outcome" |
                    positive_covid_test_LW_14b2 == "No outcome" |
               positive_covid_test_LW_15a2 == "No outcome" |
                    positive_covid_test_LW_16b2 == "No outcome" |
               positive_covid_test_LW_17a2 == "No outcome"  ~ "Exposure but no outcome",
             
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     outcome_phase_low_weight == "Not experienced" ~ "Neither exposure nor outcome"
  
      )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_LW2) 


# Create final variable of positive COVID test before LW outcome
dat <- dat %>%
  mutate(positive_covid_test_before_LW_final2 =
           case_when(positive_covid_test_before_LW2 == "Positive test after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_LW2 == "Missing whether taken test" | # Need to drop people who never answered whether they'd experienced the exposure
                       positive_covid_test_before_LW2 == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_LW2 == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                     positive_covid_test_before_LW2 ==  "Outcome but no exposure" |
                     positive_covid_test_before_LW2 ==  "Neither exposure nor outcome" ~ "No",
                    
                     
                       positive_covid_test_before_LW2 == "Exposure but no outcome" |
                    positive_covid_test_before_LW2 == "Positive test before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_LW_final2) 
```
                  
Passive suicidal ideation
```{r Positve COVID test result exposure BEFORE outcome PSS - resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_PSS_baseline =
           case_when(exposure_phase_positive_covid_test2 == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of PSS
                        exposure_phase_positive_covid_test2 == "Baseline" & 
                       (outcome_phase_passive_suicidal_ideation == "Baseline" | # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1a" | 
                         outcome_phase_passive_suicidal_ideation == "1b" |
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_PSS_1a2 =
           case_when(exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a
                     outcome_phase_passive_suicidal_ideation == "Baseline" ~ "To drop",
                      
                     # These people will have experienced a positive COVID test before their first experience of PSS
                        exposure_phase_positive_covid_test2 == "1a" & 
                       (outcome_phase_passive_suicidal_ideation == "1a" |  # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1b" | 
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_1a2)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_PSS_1b2 =
           case_when(exposure_phase_positive_covid_test2 == "1b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_passive_suicidal_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_PSS_1b2)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_PSS_2a2 =
           case_when(exposure_phase_positive_covid_test2 == "2a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2a" |  # Co-occurring symptom & exposure
                         outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" | 
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_2a2)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_PSS_2b2 =
           case_when(exposure_phase_positive_covid_test2 == "2b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" | 
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_2b2)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_PSS_3a2 =
           case_when(exposure_phase_positive_covid_test2 == "3a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_passive_suicidal_ideation == "3a" |  # Co-occurring exposure and outcome
                      outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" | 
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3a2)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_PSS_3b2 =
           case_when(exposure_phase_positive_covid_test2 == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of  passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3b2)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_PSS_4a2 =
           case_when(exposure_phase_positive_covid_test2 == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_passive_suicidal_ideation == "4a" |  # Co-occurring exposure and outcome
                        outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" | 
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_4a2)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_PSS_4b2 =
           case_when(exposure_phase_positive_covid_test2 == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_4b2)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_PSS_5a2 =
           case_when(exposure_phase_positive_covid_test2 == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_passive_suicidal_ideation == "5a" |  # Co-occurring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_5a2)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_PSS_6b2 =
           case_when(exposure_phase_positive_covid_test2 == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_6b2)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_PSS_7a2 =
           case_when(exposure_phase_positive_covid_test2 == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_passive_suicidal_ideation == "7a" | # Co-occurring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_7a2)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_PSS_8b2 =
           case_when(exposure_phase_positive_covid_test2 == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_passive_suicidal_ideation == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_8b2)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_PSS_9a2 =
           case_when(exposure_phase_positive_covid_test2 == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_passive_suicidal_ideation == "9a" | # Co-occuring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_9a2)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_PSS_10b2 =
           case_when(exposure_phase_positive_covid_test2 == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" | 
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" | 
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" | 
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" | 
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    ( outcome_phase_passive_suicidal_ideation == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_10b2)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_PSS_11a2 =
           case_when(exposure_phase_positive_covid_test2 == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_passive_suicidal_ideation == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_11a2)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_PSS_12b2 =
           case_when(exposure_phase_positive_covid_test2 == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_passive_suicidal_ideation == "12b" | # Co-occurring symptom and exposure
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_12b2)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_PSS_13a2 =
           case_when(exposure_phase_positive_covid_test2 == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    ( outcome_phase_passive_suicidal_ideation == "13a" | # Co-occurring symptom and exposure
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_13a2)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_PSS_14b2 =
           case_when(exposure_phase_positive_covid_test2 == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                    ( outcome_phase_passive_suicidal_ideation == "14b" |  # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_14b2)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_PSS_15a2 =
           case_when(exposure_phase_positive_covid_test2 == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                    (  outcome_phase_passive_suicidal_ideation == "15a" |  # Co-occurring symptom and exposure
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_15a2)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_PSS_16b2 =
           case_when(exposure_phase_positive_covid_test2 == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                        (outcome_phase_passive_suicidal_ideation == "16b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_16b2)


# Phase 17a
dat <- dat %>%
  mutate(positive_covid_test_PSS_17a2 =
           case_when(exposure_phase_positive_covid_test2 == "17a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                          outcome_phase_passive_suicidal_ideation == "16b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "17a" & # First positive COVID test at phase 17a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "17a" & # First positive COVID test at phase 17a
                      outcome_phase_passive_suicidal_ideation == "17a" ~ "Yes"   # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_17a2)
``` 


Passive suicidal ideation & Positive COVID test result
```{r Positve COVID test result exposure PSS - resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_PSS2 =
           case_when(# First positive test NOT before first experience of passive suicidal ideation
                positive_covid_test_PSS_baseline == "To drop" |
                            positive_covid_test_PSS_1a2 == "To drop" |
                    positive_covid_test_PSS_1b2 == "To drop" |
               positive_covid_test_PSS_2a2 == "To drop" |
                    positive_covid_test_PSS_2b2 == "To drop" |
               positive_covid_test_PSS_3a2 == "To drop" |
                    positive_covid_test_PSS_3b2 == "To drop" |
               positive_covid_test_PSS_4a2 == "To drop" |
                    positive_covid_test_PSS_4b2 == "To drop" |
               positive_covid_test_PSS_5a2 == "To drop" |
                    positive_covid_test_PSS_6b2 == "To drop" |
               positive_covid_test_PSS_7a2 == "To drop" |
                    positive_covid_test_PSS_8b2 == "To drop" |
               positive_covid_test_PSS_9a2 == "To drop" |
                    positive_covid_test_PSS_10b2 == "To drop" |
              positive_covid_test_PSS_11a2 == "To drop" |
                    positive_covid_test_PSS_12b2 == "To drop" |
                 positive_covid_test_PSS_13a2 == "To drop" |
                    positive_covid_test_PSS_14b2 == "To drop" |
                 positive_covid_test_PSS_15a2 == "To drop" |
                    positive_covid_test_PSS_16b2 == "To drop" |
                 positive_covid_test_PSS_17a2 == "To drop" ~ "Positive test after passive suicidal ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test2 == "Not answered whether taken test" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test2 == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test2 == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced passive suicidal ideation
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of passsive suicidal ideation
             positive_covid_test_PSS_baseline == "Yes" |
                    positive_covid_test_PSS_1a2 == "Yes" |
             positive_covid_test_PSS_1b2 == "Yes" |
               positive_covid_test_PSS_2a2 == "Yes" |
              positive_covid_test_PSS_2b2 == "Yes" |
               positive_covid_test_PSS_3a2== "Yes" |
                    positive_covid_test_PSS_3b2 == "Yes" |
               positive_covid_test_PSS_4a2 == "Yes" |
                    positive_covid_test_PSS_4b2 == "Yes" |
               positive_covid_test_PSS_5a2 == "Yes" |
                    positive_covid_test_PSS_6b2 == "Yes" |
               positive_covid_test_PSS_7a2 == "Yes" |
                    positive_covid_test_PSS_8b2 == "Yes" |
               positive_covid_test_PSS_9a2 == "Yes" |
                    positive_covid_test_PSS_10b2== "Yes" |
               positive_covid_test_PSS_11a2 == "Yes" |
                    positive_covid_test_PSS_12b2 == "Yes"|
               positive_covid_test_PSS_13a2 == "Yes" |
                    positive_covid_test_PSS_14b2 == "Yes"|
               positive_covid_test_PSS_15a2 == "Yes" |
                    positive_covid_test_PSS_16b2 == "Yes"|
               positive_covid_test_PSS_17a2 == "Yes"  ~ "Positive test before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_PSS_baseline == "No outcome" |
             positive_covid_test_PSS_1a2 == "No outcome" |
                    positive_covid_test_PSS_1b2 == "No outcome" |
               positive_covid_test_PSS_2a2 == "No outcome" |
                    positive_covid_test_PSS_2b2 == "No outcome" |
               positive_covid_test_PSS_3a2 == "No outcome" |
                    positive_covid_test_PSS_3b2 == "No outcome" |
               positive_covid_test_PSS_4a2 == "No outcome" |
                    positive_covid_test_PSS_4b == "No outcome" |
               positive_covid_test_PSS_5a2 == "No outcome" |
                    positive_covid_test_PSS_6b2 == "No outcome" |
               positive_covid_test_PSS_7a2 == "No outcome" |
                    positive_covid_test_PSS_8b2 == "No outcome" |
               positive_covid_test_PSS_9a2 == "No outcome" |
                    positive_covid_test_PSS_10b2 == "No outcome" |
               positive_covid_test_PSS_11a2 == "No outcome" |
                    positive_covid_test_PSS_12b2 == "No outcome" |
               positive_covid_test_PSS_13a2 == "No outcome" |
                    positive_covid_test_PSS_14b2 == "No outcome" |
               positive_covid_test_PSS_15a2 == "No outcome" |
                    positive_covid_test_PSS_16b2 == "No outcome" |
               positive_covid_test_PSS_17a2 == "No outcome" ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_PSS2) 

# Create final variable of positive COVID test before PSS outcome
dat <- dat %>%
  mutate(positive_covid_test_before_PSS_final2 =
           case_when(positive_covid_test_before_PSS2 == "Positive test after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_PSS2 == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_PSS2 == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_PSS2 == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced passive suicidal ideation
                     
                     positive_covid_test_before_PSS2 ==  "Outcome but no exposure" |
                    positive_covid_test_before_PSS2 ==  "Neither exposure nor outcome" ~ "No",
                     
                     positive_covid_test_before_PSS2 == "Exposure but no outcome" |
                    positive_covid_test_before_PSS2 == "Positive test before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_PSS_final2) 
```
Self-harm ideation
```{r Positve COVID test result exposure BEFORE outcome SHI - resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_SHI_baseline =
           case_when(exposure_phase_positive_covid_test2 == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of SHI
                        exposure_phase_positive_covid_test2 == "Baseline" & 
                       (outcome_phase_selfharm_ideation == "Baseline" | # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1a" | 
                         outcome_phase_selfharm_ideation == "1b" |
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_SHI_1a2 =
           case_when(exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a
                     outcome_phase_selfharm_ideation == "Baseline" ~ "To drop",
                     
                     # These people will have experienced a positive COVID test before their first experience of SHI
                        exposure_phase_positive_covid_test2 == "1a" & 
                       (outcome_phase_selfharm_ideation == "1a" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1b" | 
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_1a2)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_SHI_1b2 =
           case_when(exposure_phase_positive_covid_test2 == "1b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_selfharm_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_SHI_1b2)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_SHI_2a2 =
           case_when(exposure_phase_positive_covid_test2 == "2a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_selfharm_ideation == "2a" |  # Co-occurring symptom & exposure
                         outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" | 
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_2a2)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_SHI_2b2 =
           case_when(exposure_phase_positive_covid_test2 == "2b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" | 
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_2b2)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_SHI_3a2 =
           case_when(exposure_phase_positive_covid_test2 == "3a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_selfharm_ideation == "3a" |  # Co-occurring exposure and outcome
                      outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" | 
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_3a2)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_SHI_3b2 =
           case_when(exposure_phase_positive_covid_test2 == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of  self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_3b2)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_SHI_4a2 =
           case_when(exposure_phase_positive_covid_test2 == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_selfharm_ideation == "4a" |  # Co-occurring exposure and outcome
                        outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" | 
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_4a2)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_SHI_4b2 =
           case_when(exposure_phase_positive_covid_test2 == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_4b2)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_SHI_5a2 =
           case_when(exposure_phase_positive_covid_test2 == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_selfharm_ideation == "5a" |  # Co-occurring exposure & outcome
                      outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_5a2)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_SHI_6b2 =
           case_when(exposure_phase_positive_covid_test2 == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_6b2)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_SHI_7a2 =
           case_when(exposure_phase_positive_covid_test2 == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_selfharm_ideation == "7a" | # Co-occurring exposure & outcome
                      outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_7a2)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_SHI_8b2 =
           case_when(exposure_phase_positive_covid_test2 == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_selfharm_ideation == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_8b2)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_SHI_9a2 =
           case_when(exposure_phase_positive_covid_test2 == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_selfharm_ideation == "9a" | # Co-occuring exposure & outcome
                      outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_9a2)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_SHI_10b2 =
           case_when(exposure_phase_positive_covid_test2 == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" | 
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" | 
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" | 
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" | 
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    ( outcome_phase_selfharm_ideation == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_10b2)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_SHI_11a2 =
           case_when(exposure_phase_positive_covid_test2 == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_selfharm_ideation == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_11a2)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_SHI_12b2 =
           case_when(exposure_phase_positive_covid_test2 == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_selfharm_ideation == "12b" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_12b2)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_SHI_13a2 =
           case_when(exposure_phase_positive_covid_test2 == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    (  outcome_phase_selfharm_ideation == "13a" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_13a2)



# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_SHI_14b2 =
           case_when(exposure_phase_positive_covid_test2 == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "14b" & # First positive COVID test at phase 14b
                    ( outcome_phase_selfharm_ideation == "14b" |   # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_14b2)


# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_SHI_15a2 =
           case_when(exposure_phase_positive_covid_test2 == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "15a" & # First positive COVID test at phase 15a
                    ( outcome_phase_selfharm_ideation == "15a" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_15a2)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_SHI_16b2 =
           case_when(exposure_phase_positive_covid_test2 == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "16b" & # First positive COVID test at phase 16b
                    ( outcome_phase_selfharm_ideation == "16b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_16b2)


# Phase 17a
dat <- dat %>%
  mutate(positive_covid_test_SHI_17a2 =
           case_when(exposure_phase_positive_covid_test2 == "17a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" |
                        outcome_phase_selfharm_ideation == "16b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "17a" & # First positive COVID test at phase 17a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "17a" & # First positive COVID test at phase 17a
                    outcome_phase_selfharm_ideation == "17a" ~ "Yes"  # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_17a2)
```


Self-harm ideation & Positive COVID test result
```{r Positve COVID test result exposure SHI - resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_SHI2 =
           case_when(# First positive test NOT before first experience of self-harm ideation
                positive_covid_test_SHI_baseline == "To drop" |
                            positive_covid_test_SHI_1a2 == "To drop" |
                    positive_covid_test_SHI_1b2 == "To drop" |
               positive_covid_test_SHI_2a2 == "To drop" |
                    positive_covid_test_SHI_2b2 == "To drop" |
               positive_covid_test_SHI_3a2 == "To drop" |
                    positive_covid_test_SHI_3b2 == "To drop" |
               positive_covid_test_SHI_4a2 == "To drop" |
                    positive_covid_test_SHI_4b2 == "To drop" |
               positive_covid_test_SHI_5a2 == "To drop" |
                    positive_covid_test_SHI_6b2 == "To drop" |
               positive_covid_test_SHI_7a2 == "To drop" |
                    positive_covid_test_SHI_8b2 == "To drop" |
               positive_covid_test_SHI_9a2 == "To drop" |
                    positive_covid_test_SHI_10b2 == "To drop" |
              positive_covid_test_SHI_11a2 == "To drop" |
                    positive_covid_test_SHI_12b2 == "To drop" |
                positive_covid_test_SHI_13a2 == "To drop" |
                    positive_covid_test_SHI_14b2 == "To drop" |
                positive_covid_test_SHI_15a2 == "To drop" |
                    positive_covid_test_SHI_16b2 == "To drop" |
                positive_covid_test_SHI_17a2 == "To drop"  ~ "Positive test after self-harm ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test2 == "Not answered whether taken test" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test2 == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test2 == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced self-harm ideation
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of self-harm ideation
             positive_covid_test_SHI_baseline == "Yes" |
                    positive_covid_test_SHI_1a2 == "Yes" |
             positive_covid_test_SHI_1b2 == "Yes" |
               positive_covid_test_SHI_2a2 == "Yes" |
              positive_covid_test_SHI_2b2 == "Yes" |
               positive_covid_test_SHI_3a2== "Yes" |
                    positive_covid_test_SHI_3b2 == "Yes" |
               positive_covid_test_SHI_4a2 == "Yes" |
                    positive_covid_test_SHI_4b2 == "Yes" |
               positive_covid_test_SHI_5a2 == "Yes" |
                    positive_covid_test_SHI_6b2 == "Yes" |
               positive_covid_test_SHI_7a2 == "Yes" |
                    positive_covid_test_SHI_8b2 == "Yes" |
               positive_covid_test_SHI_9a2 == "Yes" |
                    positive_covid_test_SHI_10b2== "Yes" |
               positive_covid_test_SHI_11a2 == "Yes" |
                    positive_covid_test_SHI_12b2 == "Yes" |
               positive_covid_test_SHI_13a2 == "Yes" |
               positive_covid_test_SHI_14b2 == "Yes" |
                    positive_covid_test_SHI_15a2== "Yes" |
               positive_covid_test_SHI_16b2 == "Yes" |
                    positive_covid_test_SHI_17a2 == "Yes" ~ "Positive test before self-harm ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_SHI_baseline == "No outcome" |
             positive_covid_test_SHI_1a2 == "No outcome" |
                    positive_covid_test_SHI_1b2 == "No outcome" |
               positive_covid_test_SHI_2a2 == "No outcome" |
                    positive_covid_test_SHI_2b2 == "No outcome" |
               positive_covid_test_SHI_3a2 == "No outcome" |
                    positive_covid_test_SHI_3b2 == "No outcome" |
               positive_covid_test_SHI_4a2 == "No outcome" |
                    positive_covid_test_SHI_4b == "No outcome" |
               positive_covid_test_SHI_5a2 == "No outcome" |
                    positive_covid_test_SHI_6b2 == "No outcome" |
               positive_covid_test_SHI_7a2 == "No outcome" |
                    positive_covid_test_SHI_8b2 == "No outcome" |
               positive_covid_test_SHI_9a2 == "No outcome" |
                    positive_covid_test_SHI_10b2 == "No outcome" |
               positive_covid_test_SHI_11a2 == "No outcome" |
                    positive_covid_test_SHI_12b2 == "No outcome" |
               positive_covid_test_SHI_13a2 == "No outcome" |
               positive_covid_test_SHI_14b2 == "No outcome" |
                    positive_covid_test_SHI_15a2 == "No outcome" |
               positive_covid_test_SHI_16b2 == "No outcome" |
                    positive_covid_test_SHI_17a2 == "No outcome" ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_SHI2) 

# Create final variable of positive COVID test before SHI outcome
dat <- dat %>%
  mutate(positive_covid_test_before_SHI_final2 =
           case_when(positive_covid_test_before_SHI2 == "Positive test after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_SHI2 == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_SHI2 == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_SHI2 == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                     positive_covid_test_before_SHI2 ==  "Outcome but no exposure" |
                     positive_covid_test_before_SHI2 ==  "Neither exposure nor outcome" ~ "No",
                    
                    positive_covid_test_before_SHI2 == "Exposure but no outcome" |
                    positive_covid_test_before_SHI2 == "Positive test before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_SHI_final2) 

```
Self-harm 
```{r Positve COVID test result exposure BEFORE outcome SH - resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_SH_baseline =
           case_when(exposure_phase_positive_covid_test2 == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of SH
                        exposure_phase_positive_covid_test2 == "Baseline" & 
                       (outcome_phase_selfharm == "Baseline" | # Co-occurring exposure & outcome
                         outcome_phase_selfharm == "1a" | 
                         outcome_phase_selfharm == "1b" |
                          outcome_phase_selfharm == "2a" | 
                        outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_SH_1a2 =
           case_when(exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_positive_covid_test2 == "1a" & # First positive COVID test at phase 1a  
                     outcome_phase_selfharm == "Baseline" ~ "To drop",
                      
                     # These people will have experienced a positive COVID test before their first experience of SH
                        exposure_phase_positive_covid_test2 == "1a" & 
                       (outcome_phase_selfharm == "1a" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm == "1b" | 
                          outcome_phase_selfharm == "2a" | 
                        outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_1a2)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_SH_1b2 =
           case_when(exposure_phase_positive_covid_test2 == "1b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_selfharm == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "2a" | 
                          outcome_phase_selfharm == "2b" | 
                         outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_SH_1b2)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_SH_2a2 =
           case_when(exposure_phase_positive_covid_test2 == "2a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test2 == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_selfharm == "2a" |  # Co-occurring symptom & exposure
                         outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" | 
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_2a2)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_SH_2b2 =
           case_when(exposure_phase_positive_covid_test2 == "2b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a")  ~ "To drop", # First experience of self-harm  occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" | 
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_2b2)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_SH_3a2 =
           case_when(exposure_phase_positive_covid_test2 == "3a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b")  ~ "To drop", # First experience of self-harm  occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test2 == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_selfharm == "3a" |  # Co-occurring exposure and outcome
                      outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                     outcome_phase_selfharm == "6b" | 
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_SH_3a2)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_SH_3b2 =
           case_when(exposure_phase_positive_covid_test2 == "3b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test2 == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" | 
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_3b2)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_SH_4a2 =
           case_when(exposure_phase_positive_covid_test2 == "4a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_selfharm == "4a" |  # Co-occurring exposure and outcome
                        outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" | 
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SH_4a2)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_SH_4b2 =
           case_when(exposure_phase_positive_covid_test2 == "4b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_4b2)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_SH_5a2 =
           case_when(exposure_phase_positive_covid_test2 == "5a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_selfharm == "5a" |  # Co-occurring exposure & outcome
                      outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_5a2)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_SH_6b2 =
           case_when(exposure_phase_positive_covid_test2 == "6b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_selfharm == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_6b2)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_SH_7a2 =
           case_when(exposure_phase_positive_covid_test2 == "7a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                     outcome_phase_selfharm == "6b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_selfharm == "7a" | # Co-occurring exposure & outcome
                      outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_7a2)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_SH_8b2 =
           case_when(exposure_phase_positive_covid_test2 == "8b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_selfharm == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_selfharm == "9a" | 
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_8b2)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_SH_9a2 =
           case_when(exposure_phase_positive_covid_test2 == "9a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" | 
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" | 
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" | 
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" | 
                     outcome_phase_selfharm == "8b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_selfharm == "9a" | # Co-occuring exposure & outcome
                      outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" | 
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_9a2)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_SH_10b2 =
           case_when(exposure_phase_positive_covid_test2 == "10b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" | 
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" | 
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" | 
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" | 
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" | 
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" | 
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "10b" & # First positive COVID test at phase 10b
                    ( outcome_phase_selfharm == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_10b2)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_SH_11a2 =
           case_when(exposure_phase_positive_covid_test2 == "11a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_selfharm == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_11a2)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_SH_12b2 =
           case_when(exposure_phase_positive_covid_test2 == "12b" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_12b2)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_SH_13a2 =
           case_when(exposure_phase_positive_covid_test2 == "13a" &
                     (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                      outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                      outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                      outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                        outcome_phase_selfharm == "12b")  ~ "To drop", # First experience of self-harm occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test2 == "13a" & # First positive COVID test at phase 13a
                    (outcome_phase_selfharm == "13a" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SH_13a2)
```


Self-harm & Positive COVID test result
```{r Positve COVID test result exposure SH - resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_SH2 =
           case_when(# First positive test NOT before first experience of self-harm 
                positive_covid_test_SH_baseline == "To drop" |
                            positive_covid_test_SH_1a2 == "To drop" |
                    positive_covid_test_SH_1b2 == "To drop" |
               positive_covid_test_SH_2a2 == "To drop" |
                    positive_covid_test_SH_2b2 == "To drop" |
               positive_covid_test_SH_3a2 == "To drop" |
                    positive_covid_test_SH_3b2 == "To drop" |
               positive_covid_test_SH_4a2 == "To drop" |
                    positive_covid_test_SH_4b2 == "To drop" |
               positive_covid_test_SH_5a2 == "To drop" |
                    positive_covid_test_SH_6b2 == "To drop" |
               positive_covid_test_SH_7a2 == "To drop" |
                    positive_covid_test_SH_8b2 == "To drop" |
               positive_covid_test_SH_9a2 == "To drop" |
                    positive_covid_test_SH_10b2 == "To drop" |
              positive_covid_test_SH_11a2 == "To drop" |
                    positive_covid_test_SH_12b2 == "To drop" |
                positive_covid_test_SH_13a2 == "To drop" |
               positive_covid_test_SH_14b2 == "To drop" |
                    positive_covid_test_SH_15a2 == "To drop" |
              positive_covid_test_SH_16b2 == "To drop" |
                    positive_covid_test_SH_17ab == "To drop" ~ "Positive test after self-harm",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test2 == "Not answered whether taken test" ~ "Missing whether taken test", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test2 == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test2 == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced self-harm
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "Missing whether experienced self-harm", # Need to be dropped
                    
                    # First positive test BEFORE first experience of self-harm
             positive_covid_test_SH_baseline == "Yes" |
                    positive_covid_test_SH_1a2 == "Yes" |
             positive_covid_test_SH_1b2 == "Yes" |
               positive_covid_test_SH_2a2 == "Yes" |
              positive_covid_test_SH_2b2 == "Yes" |
               positive_covid_test_SH_3a2== "Yes" |
                    positive_covid_test_SH_3b2 == "Yes" |
               positive_covid_test_SH_4a2 == "Yes" |
                    positive_covid_test_SH_4b2 == "Yes" |
               positive_covid_test_SH_5a2 == "Yes" |
                    positive_covid_test_SH_6b2 == "Yes" |
               positive_covid_test_SH_7a2 == "Yes" |
                    positive_covid_test_SH_8b2 == "Yes" |
               positive_covid_test_SH_9a2 == "Yes" |
                    positive_covid_test_SH_10b2== "Yes" |
               positive_covid_test_SH_11a2 == "Yes" |
                    positive_covid_test_SH_12b2 == "Yes" |
                positive_covid_test_SH_13a2 == "Yes" |
               positive_covid_test_SH_14n2 == "Yes" |
                    positive_covid_test_SH_15a2== "Yes" |
               positive_covid_test_SH_16b2 == "Yes" |
                    positive_covid_test_SH_17a2 == "Yes" ~ "Positive test before self-harm",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_SH_baseline == "No outcome" |
             positive_covid_test_SH_1a2 == "No outcome" |
                    positive_covid_test_SH_1b2 == "No outcome" |
               positive_covid_test_SH_2a2 == "No outcome" |
                    positive_covid_test_SH_2b2 == "No outcome" |
               positive_covid_test_SH_3a2 == "No outcome" |
                    positive_covid_test_SH_3b2 == "No outcome" |
               positive_covid_test_SH_4a2 == "No outcome" |
                    positive_covid_test_SH_4b == "No outcome" |
               positive_covid_test_SH_5a2 == "No outcome" |
                    positive_covid_test_SH_6b2 == "No outcome" |
               positive_covid_test_SH_7a2 == "No outcome" |
                    positive_covid_test_SH_8b2 == "No outcome" |
               positive_covid_test_SH_9a2 == "No outcome" |
                    positive_covid_test_SH_10b2 == "No outcome" |
               positive_covid_test_SH_11a2 == "No outcome" |
                    positive_covid_test_SH_12b2 == "No outcome" |
               positive_covid_test_SH_13a2 == "No outcome" |
               positive_covid_test_SH_14b2 == "No outcome" |
                    positive_covid_test_SH_15a2 == "No outcome" |
               positive_covid_test_SH_16b2 == "No outcome" |
                    positive_covid_test_SH_17a2 == "No outcome" ~ "Exposure but no outcome",
                   
                   # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     (outcome_phase_selfharm != "Not answered or PNTA" |
                        outcome_phase_selfharm != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test2 == "Not positive" &
                     outcome_phase_selfharm == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_SH2) 

# Create final variable of positive COVID test before SH outcome
dat <- dat %>%
  mutate(positive_covid_test_before_SH_final2 =
           case_when(positive_covid_test_before_SH2 == "Positive test after self-harm" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_SH2 == "Missing whether taken test" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_SH2 == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_SH2 == "Missing whether experienced self-harm" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm 
               
                    positive_covid_test_before_SH2 ==  "Outcome but no exposure" |
                     positive_covid_test_before_SH2 ==  "Neither exposure nor outcome" ~ "No",
                     
                    positive_covid_test_before_SH2 == "Exposure but no outcome" |
                    positive_covid_test_before_SH2 == "Positive test before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_SH_final2) 

```

### Positive COVID test: using both variables
```{r Positive COVID test using both variables}
# Binge eating
dat <- dat %>%
  mutate(positive_covid_test_before_BE_merged =
           case_when(
             positive_covid_test_before_BE_final == "Yes" |
             positive_covid_test_before_BE_final2 == "Yes" ~ "Yes",
             
             positive_covid_test_before_BE_final == "No" |
             positive_covid_test_before_BE_final2 == "No" ~ "No",
             
             TRUE ~ NA_character_
           )
           )

# Check
dat %>%
  freq(positive_covid_test_before_BE_merged)

# Low weight
dat <- dat %>%
  mutate(positive_covid_test_before_LW_merged =
           case_when(
             positive_covid_test_before_LW_final == "Yes" |
             positive_covid_test_before_LW_final2 == "Yes" ~ "Yes",
             
             positive_covid_test_before_LW_final == "No" |
             positive_covid_test_before_LW_final2 == "No" ~ "No",
             
             TRUE ~ NA_character_
           )
           )

# Check
dat %>%
  freq(positive_covid_test_before_LW_merged)

# Passive suicidal ideation
dat <- dat %>%
  mutate(positive_covid_test_before_PSS_merged =
           case_when(
             positive_covid_test_before_PSS_final == "Yes" |
             positive_covid_test_before_PSS_final2 == "Yes" ~ "Yes",
             
             positive_covid_test_before_PSS_final == "No" |
             positive_covid_test_before_PSS_final2 == "No" ~ "No",
             
             TRUE ~ NA_character_
           )
           )

# Check
dat %>%
  freq(positive_covid_test_before_PSS_merged)

# Self-harm ideation
dat <- dat %>%
  mutate(positive_covid_test_before_SHI_merged =
           case_when(
             positive_covid_test_before_SHI_final == "Yes" |
             positive_covid_test_before_SHI_final2 == "Yes" ~ "Yes",
             
             positive_covid_test_before_SHI_final == "No" |
             positive_covid_test_before_SHI_final2 == "No" ~ "No",
             
             TRUE ~ NA_character_
           )
           )

# Check
dat %>%
  freq(positive_covid_test_before_SHI_merged)

# Self-harm
dat <- dat %>%
  mutate(positive_covid_test_before_SH_merged =
           case_when(
             positive_covid_test_before_SH_final == "Yes" |
             positive_covid_test_before_SH_final2 == "Yes" ~ "Yes",
             
             positive_covid_test_before_SH_final == "No" |
             positive_covid_test_before_SH_final2 == "No" ~ "No",
             
             TRUE ~ NA_character_
           )
           )

# Check
dat %>%
  freq(positive_covid_test_before_SH_merged)

```

### Pandemic worry at baseline 
++NB: This needs work! Need to discuss how to score this; the below code was something I very quickly put together before my Centre talk. Participants are asked pandemic worry at follow up too, however I wonder if it would be best to just look at baseline as the exposure (as per Moritz's suggestion).

Participants are asked how worried they are about different factors, e.g., mental health, or employment. Before working out total score - First need to work out if participants answered any of these as 'not applicable' or if they did not answer (i.e., missing).
```{r Pandemic worry as exposure, identifying not applicable or missing data}

# Own Employment
dat <- dat %>%
  mutate(not_applicable_or_missing_own_employment =
           case_when(panworry.impact_on_your_employment_status == "Not applicable" |
                       is.na(panworry.impact_on_your_employment_status) ~ 1
             
           ))
# Check 
dat %>%
  freq(not_applicable_or_missing_own_employment)

# Household employment
dat <- dat %>%
  mutate(not_applicable_or_missing_household_employment =
           case_when(panworry.employment_status_household_key == "Not applicable" |
                       is.na(panworry.employment_status_household_key) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_household_employment)

# Own education / exams
dat <- dat %>%
  mutate(not_applicable_or_missing_own_education_exams =
           case_when(panworry.impact_on_your_education_or_exams == "Not applicable" |
                       is.na(panworry.impact_on_your_education_or_exams) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_own_education_exams)

# Children's exams
dat <- dat %>%
  mutate(not_applicable_or_missing_childrens_education_exams =
           case_when(panworry.exams_impact_education_children == "Not applicable" |
                       is.na(panworry.exams_impact_education_children) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_childrens_education_exams)

# Financial impact
dat <- dat %>%
  mutate(not_applicable_or_missing_financial_impact =
           case_when(panworry.financial_impact == "Not applicable" |
                       is.na(panworry.financial_impact) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_financial_impact)

# Contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_contracting_virus =
           case_when(panworry.contracting_the_virus == "Not applicable" |
                       is.na(panworry.contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_contracting_virus)

# People you know contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_people_know_contracting_virus =
           case_when(panworry.people_you_know_contracting_the_virus == "Not applicable" |
                       is.na(panworry.people_you_know_contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_know_contracting_virus)


# People you don't know contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_people_dont_know_contracting_virus =
           case_when(panworry.people_you_dont_know_contracting_the_virus == "Not applicable" |
                       is.na(panworry.people_you_dont_know_contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_dont_know_contracting_virus)

# Mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_mental_health =
           case_when(panworry.impact_mental_health_wellbeing == "Not applicable" |
                       is.na(panworry.impact_mental_health_wellbeing) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_mental_health)

# Children's mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_childrens_mental_health =
           case_when(panworry.impact_mental_health_childrens == "Not applicable" |
                       is.na(panworry.impact_mental_health_childrens) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_childrens_mental_health)

# Relative's mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_relatives_mental_health =
           case_when(panworry.impact_relatives_mental_health == "Not applicable" |
                       is.na(panworry.impact_relatives_mental_health) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_relatives_mental_health)

# Social isolation
dat <- dat %>%
  mutate(not_applicable_or_missing_social_isolation =
           case_when(panworry.being_socially_isolated == "Not applicable" |
                       is.na(panworry.being_socially_isolated) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_social_isolation)


# People you know social isolation
dat <- dat %>%
  mutate(not_applicable_or_missing_people_know_social_isolation =
           case_when(panworry.people_you_know_being_socially_isolated == "Not applicable" |
                       is.na(panworry.people_you_know_being_socially_isolated) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_know_social_isolation)

# Shortage of essentials
dat <- dat %>%
  mutate(not_applicable_or_missing_shortage_essentials =
           case_when(panworry.shortage_of_essential_supplies == "Not applicable" |
                       is.na(panworry.shortage_of_essential_supplies) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_shortage_essentials)

# Shortage of medication / accesss to healthcare
dat <- dat %>%
  mutate(not_applicable_or_missing_shortage_medication_access_healthcare =
           case_when(panworry.shortage_of_medication_or_access_to_healthcare == "Not applicable" |
                       is.na(panworry.shortage_of_medication_or_access_to_healthcare) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_shortage_medication_access_healthcare)

# People healthcare/shortage essentials
dat <- dat %>%
  mutate(not_applicable_or_missing_healthcare_people_essentials =
           case_when(panworry.healthcare_people_essential_supplies == "Not applicable" |
                       is.na(panworry.healthcare_people_essential_supplies) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_healthcare_people_essentials)

# Government info accuracy
dat <- dat %>%
  mutate(not_applicable_or_missing_gov_info_accurary =
           case_when(panworry.information_virus_government_accuracy == "Not applicable" |
                       is.na(panworry.information_virus_government_accuracy) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_gov_info_accurary)

# Government response to pandemic
dat <- dat %>%
  mutate(not_applicable_or_missing_gov_response_pandemic =
           case_when(panworry.the_governments_response_to_the_pandemic == "Not applicable" |
                       is.na(panworry.the_governments_response_to_the_pandemic) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_gov_response_pandemic)

# Separation from family members
dat <- dat %>%
  mutate(not_applicable_or_missing_separation_family =
           case_when(panworry.separation_from_family_members == "Not applicable" |
                       is.na(panworry.separation_from_family_members) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_separation_family)

# Impact global recession
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_global_recession =
           case_when(panworry.standing_impact_global_recession == "Not applicable" |
                       is.na(panworry.standing_impact_global_recession) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_global_recession)


# Other worry
dat <- dat %>%
  mutate(not_applicable_or_missing_other_worry =
           case_when(panworry.other_ == "Not applicable" |
                       is.na(panworry.other_) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_other_worry)

```

Pandemic worry - Sum score of 'missingness/not applicable'
```{r Pandemic worry as exposure, missingness score}

dat$panworry_sumscore_missingness_not_applicable <- rowSums(dat[ ,
                                 c("not_applicable_or_missing_own_employment",
                                   "not_applicable_or_missing_household_employment",
                                   "not_applicable_or_missing_own_education_exams",
                                   "not_applicable_or_missing_childrens_education_exams",
                                   "not_applicable_or_missing_financial_impact",
                                   "not_applicable_or_missing_contracting_virus",
                                   "not_applicable_or_missing_people_know_contracting_virus",
                                   "not_applicable_or_missing_people_dont_know_contracting_virus",
                                   "not_applicable_or_missing_impact_mental_health",
                                   "not_applicable_or_missing_impact_childrens_mental_health",
                                   "not_applicable_or_missing_impact_relatives_mental_health",
                                   "not_applicable_or_missing_social_isolation",
                                   "not_applicable_or_missing_people_know_social_isolation",
                                   "not_applicable_or_missing_shortage_essentials",
                                   "not_applicable_or_missing_shortage_medication_access_healthcare",
                                   "not_applicable_or_missing_healthcare_people_essentials",
                                   "not_applicable_or_missing_gov_info_accurary",
                                   "not_applicable_or_missing_gov_response_pandemic",
                                   "not_applicable_or_missing_separation_family",
                                   "not_applicable_or_missing_impact_global_recession",
                                   "not_applicable_or_missing_other_worry")],
                                  na.rm = TRUE)

# Check
dat %>%
  freq(panworry_sumscore_missingness_not_applicable)    
```

Work out the total number of questions about pandemic worry each participant answered 
```{r Pandemic worry total number of questions answered}

dat$panworry_total_applicable <- 21 - dat$panworry_sumscore_missingness_not_applicable

# Check
dat %>%
  freq(panworry_total_applicable)    
```

Highest possible score for each participant (i.e., multiply the number of questions they answered with the highest score they could possibly get on each question, i.e., 4)
```{r Pandemic worry highest possible score}

dat$panworry_total_possible_score <- dat$panworry_total_applicable * 4 # The highest score for each question is '4' = Extremely worried

# Check
dat %>%
  freq(panworry_total_possible_score)    
```

Actual scores 
First need to create new variables in which '5' i.e., 'Not applicable' = 0, so that it is not included in final calculation of score.
```{r Pandemic worry recode 'Not applicable' to 0}

# Own Employment
dat$panworry.impact_on_your_employment_status_numeric[dat$panworry.impact_on_your_employment_status_numeric == 5] <- 0

# Household employment
dat$panworry.employment_status_household_key_numeric[dat$panworry.employment_status_household_key_numeric == 5] <- 0

# Own education / exams
dat$panworry.impact_on_your_education_or_exams_numeric[dat$panworry.impact_on_your_education_or_exams_numeric == 5] <- 0

# Children's exams
dat$panworry.exams_impact_education_children_numeric[dat$panworry.exams_impact_education_children_numeric == 5] <- 0

# Financial impact
dat$panworry.financial_impact_numeric[dat$panworry.financial_impact_numeric == 5] <- 0

# Contracting virus
dat$panworry.contracting_the_virus_numeric[dat$panworry.contracting_the_virus_numeric == 5] <- 0

# People you know contracting virus
dat$panworry.people_you_know_contracting_the_virus_numeric[dat$panworry.people_you_know_contracting_the_virus_numeric == 5] <- 0

# People you don't know contracting virus
dat$panworry.people_you_dont_know_contracting_the_virus_numeric[dat$panworry.people_you_dont_know_contracting_the_virus_numeric == 5] <- 0

# Mental health
dat$panworry.impact_mental_health_wellbeing_numeric[dat$panworry.impact_mental_health_wellbeing_numeric == 5] <- 0

# Children's mental health
dat$panworry.impact_mental_health_childrens_numeric[dat$panworry.impact_mental_health_childrens_numeric == 5] <- 0

# Relative's mental health
dat$panworry.impact_relatives_mental_health_numeric[dat$panworry.impact_relatives_mental_health_numeric == 5] <- 0

# Social isolation
dat$panworry.being_socially_isolated_numeric[dat$panworry.being_socially_isolated_numeric == 5] <- 0

# People you know social isolation
dat$panworry.people_you_know_being_socially_isolated_numeric[dat$panworry.people_you_know_being_socially_isolated_numeric == 5] <- 0

# Shortage of essentials
dat$panworry.shortage_of_essential_supplies_numeric[dat$panworry.shortage_of_essential_supplies_numeric == 5] <- 0

# Shortage of medication / accesss to healthcare
dat$panworry.shortage_of_medication_or_access_to_healthcare_numeric[dat$panworry.shortage_of_medication_or_access_to_healthcare_numeric == 5] <- 0

# People healthcare/shortage essentials
dat$panworry.healthcare_people_essential_supplies_numeric[dat$panworry.healthcare_people_essential_supplies_numeric == 5] <- 0

# Government info accuracy
dat$panworry.information_virus_government_accuracy_numeric[dat$panworry.information_virus_government_accuracy_numeric == 5] <- 0

# Government response to pandemic
dat$panworry.the_governments_response_to_the_pandemic_numeric[dat$panworry.the_governments_response_to_the_pandemic_numeric == 5] <- 0

# Separation from family members
dat$panworry.separation_from_family_members_numeric[dat$panworry.separation_from_family_members_numeric == 5] <- 0

# Impact global recession
dat$panworry.standing_impact_global_recession_numeric[dat$panworry.standing_impact_global_recession_numeric == 5] <- 0

# Other worry
dat$panworry.other__numeric[dat$panworry.other__numeric == 5] <- 0
```

Sum score of actual answers (e.g., score of 4 on a question = "Extremely worried")
```{r Pandemic worry sum score actual answers}

dat$panworry_total_raw_score <- rowSums(dat[ ,
                                 c("panworry.impact_on_your_employment_status_numeric",
                                   "panworry.employment_status_household_key_numeric",
                                   "panworry.impact_on_your_education_or_exams_numeric",
                                   "panworry.exams_impact_education_children_numeric",
                                   "panworry.financial_impact_numeric",
                                   "panworry.contracting_the_virus_numeric",
                                   "panworry.people_you_know_contracting_the_virus_numeric",
                                   "panworry.people_you_dont_know_contracting_the_virus_numeric",
                                   "panworry.impact_mental_health_wellbeing_numeric",
                                   "panworry.impact_mental_health_childrens_numeric",
                                   "panworry.impact_relatives_mental_health_numeric",
                                   "panworry.being_socially_isolated_numeric",
                                   "panworry.people_you_know_being_socially_isolated_numeric",
                                   "panworry.shortage_of_essential_supplies_numeric",
                                   "panworry.shortage_of_medication_or_access_to_healthcare_numeric",
                                   "panworry.healthcare_people_essential_supplies_numeric",
                                   "panworry.information_virus_government_accuracy_numeric",
                                   "panworry.the_governments_response_to_the_pandemic_numeric",
                                   "panworry.separation_from_family_members_numeric",
                                   "panworry.standing_impact_global_recession_numeric",
                                   "panworry.other__numeric")],
                                  na.rm = TRUE)

# Check
dat %>%
  freq(panworry_total_raw_score)    
```

Answers as a percentage of possible scores (i.e., divide their actual score by their highest possible score, as calculated by the number of questions that were applicable to them/they answered)
```{r Pandemic worry answers as percentage}
dat$panworry_total_score_percent <- (dat$panworry_total_raw_score/dat$panworry_total_possible_score)*100

# Check 
dat %>%
  freq(panworry_total_score_percent)  
```

Answers as factors (0-20, 20-40, 40-50, 60-80, 80-100)
NB: I have included this as just another idea of grouping pandemic worry scores.
```{r Pandemic worry answers as factors}

dat <- dat %>%
  mutate(panworry_factor =
           case_when(
             panworry_total_score_percent >= 0 & panworry_total_score_percent <= 20 ~ "0-20",
             panworry_total_score_percent >= 21 & panworry_total_score_percent <= 40 ~ "21-40",
             panworry_total_score_percent >= 41 & panworry_total_score_percent <= 60 ~ "41-60",
             panworry_total_score_percent >= 61 & panworry_total_score_percent <= 80 ~ "61-80",
             panworry_total_score_percent >= 81 & panworry_total_score_percent <= 100 ~ "81-100"
           )
    
  )

# Change to factor
dat$panworry_factor <- as.factor(dat$panworry_factor)

dat %>%
  freq(panworry_factor)
```


### Losing someone due to COVID-19 (grief)

Losing someone due to COVID as indicated at baseline
grief.covid_lost_due_close = In the past month, have you lost someone close to you due to COVID-19?

# Identify at which phase they first experienced the exposure
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - positive COVID test}
dat <- dat %>%
  mutate(exposure_phase_losing_someone =
           case_when( 
                        (
                          (is.na(grief.covid_lost_due_close) |
                         grief.covid_lost_due_close == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_1b) |
                         grief.due_past_month_lost_.Wave_1b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_2b) |
                         grief.due_past_month_lost_.Wave_2b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_3b) |
                         grief.due_past_month_lost_.Wave_3b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_4b) |
                         grief.due_past_month_lost_.Wave_4b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_6b) |
                         grief.due_past_month_lost_.Wave_6b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_8b) |
                         grief.due_past_month_lost_.Wave_8b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_10b) |
                         grief.due_past_month_lost_.Wave_10b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_12b) |
                         grief.due_past_month_lost_.Wave_12b == "Prefer not to say") &
                          (is.na(grief.due_past_month_lost_.Wave_14b) |
                         grief.due_past_month_lost_.Wave_14b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_16b) |
                         grief.due_past_month_lost_.Wave_16b == "Prefer not to say") ) ~ "Not answered or PNTA", 
                        
                       grief.covid_lost_due_close == "Yes" ~ "Baseline",
                       grief.due_past_month_lost_.Wave_1b  == "Yes" ~ "1b",
                       grief.due_past_month_lost_.Wave_2b  == "Yes" ~ "2b",
                       grief.due_past_month_lost_.Wave_3b  == "Yes"~ "3b",
                       grief.due_past_month_lost_.Wave_4b  == "Yes" ~ "4b",
                       grief.due_past_month_lost_.Wave_6b  == "Yes" ~ "6b",
                       grief.due_past_month_lost_.Wave_8b  == "Yes" ~ "8b",
                       grief.due_past_month_lost_.Wave_10b  == "Yes" ~ "10b",
                       grief.due_past_month_lost_.Wave_12b  == "Yes" ~ "12b",
                       grief.due_past_month_lost_.Wave_14b  == "Yes" ~ "14b",
                       grief.due_past_month_lost_.Wave_16b  == "Yes" ~ "16b",
                       
                       TRUE ~ "Not lost someone" # Then, everyone who is left will have answered "No" at least once, even if they are missing or PNTA for all other phases. The only people we can not assume an answer for (i.e., has experienced or has not experienced) is those who never answered the question throughout the whole time period
                       )
         )

# Check
dat %>%
  freq(exposure_phase_losing_someone)
```

Binge eating 
```{r Lost someone exposure BEFORE outcome BE}

# Baseline
dat <- dat %>%
  mutate(lost_someone_BE_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of BE
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_binge_eating == "1b" | 
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_baseline)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_BE_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_binge_eating == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_binge_eating == "2b" | 
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_BE_1b)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_BE_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     outcome_phase_binge_eating == "1b"  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                         outcome_phase_binge_eating == "3b" |
                         outcome_phase_binge_eating == "4b" | 
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_2b)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_BE_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" )  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                        outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_BE_3b)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_BE_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_4b)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_BE_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_binge_eating == "6b" | # Co-occurring symptom and exposure
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_6b)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_BE_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_binge_eating == "8b" |  # Co-occurring symptom and exposure
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_8b)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_BE_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_binge_eating == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_10b)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_BE_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    (outcome_phase_binge_eating == "12b"|
                         outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_12b)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_BE_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b")  ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    (outcome_phase_binge_eating == "14b" | # Co-occurring symptom and exposure
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_14b)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_BE_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                      outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b")   ~ "To drop", # First experience of binge eating occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_binge_eating == "16b" ~ "Yes" # Co-occurring symptom and exposure
                       
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_BE_16b)
```

Binge eating & losing someone
```{r Losing someone exposure BE}
dat <- dat %>%
  mutate(losing_someone_before_BE =
           case_when(# First lost someone NOT before first experience of binge eating
                    lost_someone_BE_baseline == "To drop" |
                    lost_someone_BE_1b == "To drop" |
                    lost_someone_BE_2b == "To drop" |
                    lost_someone_BE_3b == "To drop" |
                    lost_someone_BE_4b == "To drop" |
                    lost_someone_BE_6b == "To drop" |
                    lost_someone_BE_8b == "To drop" |
                    lost_someone_BE_10b == "To drop" |
                    lost_someone_BE_12b == "To drop" |
                     lost_someone_BE_14b == "To drop" |
                    lost_someone_BE_16b == "To drop"  ~ "Lost someone after binge eating",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "Missing whether experienced binge eating", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of binge eating
                    lost_someone_BE_baseline == "Yes" |
                    lost_someone_BE_1b == "Yes" |
                    lost_someone_BE_2b == "Yes" |
                    lost_someone_BE_3b == "Yes" |
                    lost_someone_BE_4b == "Yes" |
                    lost_someone_BE_6b == "Yes" |
                    lost_someone_BE_8b == "Yes" |
                    lost_someone_BE_10b == "Yes" |
                    lost_someone_BE_12b == "Yes" |
                    lost_someone_BE_14b == "Yes" |
                    lost_someone_BE_16b == "Yes"~ "Lost someone before binge eating",
                    
                   # Experienced exposure but not outcome
                    lost_someone_BE_baseline == "No outcome" |
                    lost_someone_BE_1b == "No outcome" |
                    lost_someone_BE_2b == "No outcome" |
                    lost_someone_BE_3b == "No outcome" |
                    lost_someone_BE_4b == "No outcome" |
                    lost_someone_BE_6b == "No outcome" |
                    lost_someone_BE_8b == "No outcome" |
                    lost_someone_BE_10b == "No outcome" |
                    lost_someone_BE_12b == "No outcome"  |
                     lost_someone_BE_14b == "No outcome" |
                    lost_someone_BE_16b == "No outcome" ~ "Exposure but no outcome",
                   
                   # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_binge_eating != "Not answered" |
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_binge_eating == "Not experienced" ~ "Neither exposure nor outcome"
                  
            
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_BE) 


# Create final variable of lost someone before BE outcome
dat <- dat %>%
  mutate(lost_someone_before_BE_final =
           case_when(losing_someone_before_BE == "Lost someone after binge eating" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_BE == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_BE == "Missing whether experienced binge eating" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced binge eating
                     
                       losing_someone_before_BE ==  "Outcome but no exposure" |
                      losing_someone_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_BE == "Exposure but no outcome" |
                    losing_someone_before_BE == "Lost someone before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_BE_final) 
```

Low weight 
```{r Lost someone exposure BEFORE outcome LW}

# Baseline
dat <- dat %>%
  mutate(lost_someone_LW_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of LW
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_baseline)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_LW_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_low_weight == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_LW_1b)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_LW_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_low_weight == "1b" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                         outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" | 
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_2b)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_LW_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_3b)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_LW_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_4b)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_LW_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_low_weight == "6b" | # Co-occurring symptom and exposure
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_6b)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_LW_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_low_weight == "8b" |  # Co-occurring symptom and exposure
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_8b)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_LW_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_low_weight == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_10b)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_LW_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    (outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_12b)


# Phase 14b
dat <- dat %>%
  mutate(lost_someone_LW_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                      (outcome_phase_low_weight == "14b" | # Co-occurring symptom and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_14b)


# Phase 16b
dat <- dat %>%
  mutate(lost_someone_LW_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                      outcome_phase_low_weight == "16b" ~ "Yes"  # Co-occurring symptom and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_16b)
```

Low weight & losing someone
```{r Losing someone exposure LW}
dat <- dat %>%
  mutate(losing_someone_before_LW =
           case_when(# First lost someone NOT before first experience of low weight
                    lost_someone_LW_baseline == "To drop" |
                    lost_someone_LW_1b == "To drop" |
                    lost_someone_LW_2b == "To drop" |
                    lost_someone_LW_3b == "To drop" |
                    lost_someone_LW_4b == "To drop" |
                    lost_someone_LW_6b == "To drop" |
                    lost_someone_LW_8b == "To drop" |
                    lost_someone_LW_10b == "To drop" |
                    lost_someone_LW_12b == "To drop"  |
                      lost_someone_LW_14b == "To drop" |
                    lost_someone_LW_16b == "To drop"~ "Lost someone after low weight",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced low weight
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of low weight
                    lost_someone_LW_baseline == "Yes" |
                    lost_someone_LW_1b == "Yes" |
                    lost_someone_LW_2b == "Yes" |
                    lost_someone_LW_3b == "Yes" |
                    lost_someone_LW_4b == "Yes" |
                    lost_someone_LW_6b == "Yes" |
                    lost_someone_LW_8b == "Yes" |
                    lost_someone_LW_10b == "Yes" |
                    lost_someone_LW_12b == "Yes" |
                    lost_someone_LW_14b == "Yes" |
                    lost_someone_LW_16b == "Yes"~ "Lost someone before low weight",
                    
                   # Experienced exposure but not outcome
                    lost_someone_LW_baseline == "No outcome" |
                    lost_someone_LW_1b == "No outcome" |
                    lost_someone_LW_2b == "No outcome" |
                    lost_someone_LW_3b == "No outcome" |
                    lost_someone_LW_4b == "No outcome" |
                    lost_someone_LW_6b == "No outcome" |
                    lost_someone_LW_8b == "No outcome" |
                    lost_someone_LW_10b == "No outcome" |
                    lost_someone_LW_12b == "No outcome" |
                    lost_someone_LW_14b == "No outcome" |
                    lost_someone_LW_16b == "No outcome" ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_low_weight == "Not experienced" ~ "Neither exposure nor outcome"
                  )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_LW) 


# Create final variable of lost someone before LW outcome
dat <- dat %>%
  mutate(lost_someone_before_LW_final =
           case_when(losing_someone_before_LW == "Lost someone after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_LW == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced low weight
                     
                      losing_someone_before_LW ==  "Outcome but no exposure" |
                    losing_someone_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     losing_someone_before_LW == "Exposure but no outcome" |
                    losing_someone_before_LW == "Lost someone before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_LW_final) 
```

Passive suicidal ideation
```{r Lost someone exposure BEFORE outcome PSS}

# Baseline
dat <- dat %>%
  mutate(lost_someone_PSS_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of PSS
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1a" | 
                          outcome_phase_passive_suicidal_ideation == "1b" | 
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b" |
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_PSS_baseline)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_PSS_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_passive_suicidal_ideation == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_PSS_1b)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_PSS_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_passive_suicidal_ideation == "3a" |
                         outcome_phase_passive_suicidal_ideation == "3b" |
                           outcome_phase_passive_suicidal_ideation == "4a" |
                         outcome_phase_passive_suicidal_ideation == "4b" | 
                           outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_2b)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_PSS_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_3b)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_PSS_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_4b)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_PSS_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_6b)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_PSS_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_passive_suicidal_ideation == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_8b)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_PSS_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_passive_suicidal_ideation == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_10b)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_PSS_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   (outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_12b)


# Phase 14b
dat <- dat %>%
  mutate(lost_someone_PSS_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   (outcome_phase_passive_suicidal_ideation == "14b" |  # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_14b)


# Phase 16b
dat <- dat %>%
  mutate(lost_someone_PSS_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |  
                       outcome_phase_passive_suicidal_ideation == "15a" 
                         )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                   (outcome_phase_passive_suicidal_ideation == "16b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_16b)
```

Passive suicidal ideation & losing someone
```{r Losing someone exposure PSS}
dat <- dat %>%
  mutate(losing_someone_before_PSS =
           case_when(# First lost someone NOT before first experience of passive suicidal ideation
                    lost_someone_PSS_baseline == "To drop" |
                    lost_someone_PSS_1b == "To drop" |
                    lost_someone_PSS_2b == "To drop" |
                    lost_someone_PSS_3b == "To drop" |
                    lost_someone_PSS_4b == "To drop" |
                    lost_someone_PSS_6b == "To drop" |
                    lost_someone_PSS_8b == "To drop" |
                    lost_someone_PSS_10b == "To drop" |
                    lost_someone_PSS_12b == "To drop" |
                      lost_someone_PSS_14b == "To drop" |
                    lost_someone_PSS_16b == "To drop"~ "Lost someone after passive suicidal ideation",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced passive suicidal ideation
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of passive suicidal ideation
                    lost_someone_PSS_baseline == "Yes" |
                    lost_someone_PSS_1b == "Yes" |
                    lost_someone_PSS_2b == "Yes" |
                    lost_someone_PSS_3b == "Yes" |
                    lost_someone_PSS_4b == "Yes" |
                    lost_someone_PSS_6b == "Yes" |
                    lost_someone_PSS_8b == "Yes" |
                    lost_someone_PSS_10b == "Yes" |
                    lost_someone_PSS_12b == "Yes"|
                    lost_someone_PSS_14b == "Yes" |
                    lost_someone_PSS_16b == "Yes" ~ "Lost someone before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_PSS_baseline == "No outcome" |
                    lost_someone_PSS_1b == "No outcome" |
                    lost_someone_PSS_2b == "No outcome" |
                    lost_someone_PSS_3b == "No outcome" |
                    lost_someone_PSS_4b == "No outcome" |
                    lost_someone_PSS_6b == "No outcome" |
                    lost_someone_PSS_8b == "No outcome" |
                    lost_someone_PSS_10b == "No outcome" |
                    lost_someone_PSS_12b == "No outcome" |
                    lost_someone_PSS_14b == "No outcome" |
                    lost_someone_PSS_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_PSS) 

# Create final variable of lost someone before PSS outcome
dat <- dat %>%
  mutate(lost_someone_before_PSS_final =
           case_when(losing_someone_before_PSS == "Lost someone after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_PSS == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced passive suicidal ideation
                     
                      losing_someone_before_PSS ==  "Outcome but no exposure" |
                     losing_someone_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_PSS == "Exposure but no outcome" |
                    losing_someone_before_PSS == "Lost someone before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_PSS_final) 
```

Self-harm ideation
```{r Lost someone exposure BEFORE outcome SHI}

# Baseline
dat <- dat %>%
  mutate(lost_someone_SHI_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of SHI
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_selfharm_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1a" | 
                          outcome_phase_selfharm_ideation == "1b" | 
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_SHI_baseline)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_SHI_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_selfharm_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_selfharm_ideation == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SHI_1b)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_SHI_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_selfharm_ideation == "3a" |
                         outcome_phase_selfharm_ideation == "3b" |
                           outcome_phase_selfharm_ideation == "4a" |
                         outcome_phase_selfharm_ideation == "4b" | 
                           outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_2b)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_SHI_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_3b)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_SHI_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_4b)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_SHI_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_6b)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_SHI_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_selfharm_ideation == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_8b)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_SHI_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_selfharm_ideation == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_10b)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_SHI_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                      (outcome_phase_selfharm_ideation == "12b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_14b)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_SHI_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "13a" 
                        )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                      ( outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_14b)


# Phase 16b
dat <- dat %>%
  mutate(lost_someone_SHI_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                      ( outcome_phase_selfharm_ideation == "16b" |  # Co-occurring
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_16b)
```

Self-harm ideation & losing someone
```{r Losing someone exposure SHI}
dat <- dat %>%
  mutate(losing_someone_before_SHI =
           case_when(# First lost someone NOT before first experience of self-harm ideation
                    lost_someone_SHI_baseline == "To drop" |
                    lost_someone_SHI_1b == "To drop" |
                    lost_someone_SHI_2b == "To drop" |
                    lost_someone_SHI_3b == "To drop" |
                    lost_someone_SHI_4b == "To drop" |
                    lost_someone_SHI_6b == "To drop" |
                    lost_someone_SHI_8b == "To drop" |
                    lost_someone_SHI_10b == "To drop" |
                    lost_someone_SHI_12b == "To drop" |
                    lost_someone_SHI_14b == "To drop" |
                    lost_someone_SHI_16b == "To drop" ~ "Lost someone after self-harm ideation",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced self-harm ideation
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of self-harm ideation
                    lost_someone_SHI_baseline == "Yes" |
                    lost_someone_SHI_1b == "Yes" |
                    lost_someone_SHI_2b == "Yes" |
                    lost_someone_SHI_3b == "Yes" |
                    lost_someone_SHI_4b == "Yes" |
                    lost_someone_SHI_6b == "Yes" |
                    lost_someone_SHI_8b == "Yes" |
                    lost_someone_SHI_10b == "Yes" |
                    lost_someone_SHI_12b == "Yes"|
                    lost_someone_SHI_14b == "Yes" |
                    lost_someone_SHI_16b == "Yes" ~ "Lost someone before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_SHI_baseline == "No outcome" |
                    lost_someone_SHI_1b == "No outcome" |
                    lost_someone_SHI_2b == "No outcome" |
                    lost_someone_SHI_3b == "No outcome" |
                    lost_someone_SHI_4b == "No outcome" |
                    lost_someone_SHI_6b == "No outcome" |
                    lost_someone_SHI_8b == "No outcome" |
                    lost_someone_SHI_10b == "No outcome" |
                    lost_someone_SHI_12b == "No outcome" |
                    lost_someone_SHI_14b == "No outcome" |
                    lost_someone_SHI_16b == "No outcome" ~ "Exposure but no outcome",
                  
                   # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_SHI) 


# Create final variable of lost someone before SHI outcome
dat <- dat %>%
  mutate(lost_someone_before_SHI_final =
           case_when(losing_someone_before_SHI == "Lost someone after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_SHI == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                      losing_someone_before_SHI ==  "Outcome but no exposure" |
                     losing_someone_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                     losing_someone_before_SHI == "Exposure but no outcome" |
                    losing_someone_before_SHI == "Lost someone before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_SHI_final) 
```

Self-harm 
```{r Lost someone exposure BEFORE outcome SH}

# Baseline
dat <- dat %>%
  mutate(lost_someone_SH_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of SH
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_selfharm == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm == "1a" | 
                          outcome_phase_selfharm == "1b" | 
                          outcome_phase_selfharm == "2a" | 
                        outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_SH_baseline)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_SH_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_selfharm == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_selfharm == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_selfharm == "2a" | 
                          outcome_phase_selfharm == "2b" | 
                          outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SH_1b)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_SH_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                    outcome_phase_selfharm == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_selfharm == "3a" |
                         outcome_phase_selfharm == "3b" |
                           outcome_phase_selfharm == "4a" |
                         outcome_phase_selfharm == "4b" | 
                           outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SH_2b)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_SH_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                        outcome_phase_selfharm == "8b" | 
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SH_3b)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_SH_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_4b)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_SH_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_selfharm == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_6b)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_SH_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_selfharm == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_8b)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_SH_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_selfharm == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_10b)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_SH_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a")  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    (outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_12b)


# Phase 14b
dat <- dat %>%
  mutate(lost_someone_SH_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "13a" 
                         )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    (outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_14b)


# Phase 16b
dat <- dat %>%
  mutate(lost_someone_SH_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                      outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" )  ~ "To drop", # First experience of self-harm occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    ( outcome_phase_selfharm == "16b" | # Co-occurring symptom and exposure
                      outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SH_16b)
```

Self-harm  & losing someone
```{r Losing someone exposure SH}
dat <- dat %>%
  mutate(losing_someone_before_SH =
           case_when(# First lost someone NOT before first experience of self-harm 
                    lost_someone_SH_baseline == "To drop" |
                    lost_someone_SH_1b == "To drop" |
                    lost_someone_SH_2b == "To drop" |
                    lost_someone_SH_3b == "To drop" |
                    lost_someone_SH_4b == "To drop" |
                    lost_someone_SH_6b == "To drop" |
                    lost_someone_SH_8b == "To drop" |
                    lost_someone_SH_10b == "To drop" |
                    lost_someone_SH_12b == "To drop" |
                    lost_someone_SH_14b == "To drop" |
                    lost_someone_SH_16b == "To drop" ~ "Lost someone after self-harm",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced self-harm
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "Missing whether experienced self-harm", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of self-harm
                    lost_someone_SH_baseline == "Yes" |
                    lost_someone_SH_1b == "Yes" |
                    lost_someone_SH_2b == "Yes" |
                    lost_someone_SH_3b == "Yes" |
                    lost_someone_SH_4b == "Yes" |
                    lost_someone_SH_6b == "Yes" |
                    lost_someone_SH_8b == "Yes" |
                    lost_someone_SH_10b == "Yes" |
                    lost_someone_SH_12b == "Yes"|
                    lost_someone_SH_14b == "Yes" |
                    lost_someone_SH_16b == "Yes" ~ "Lost someone before self-harm",
                    
                   # Experienced exposure but not outcome
                    lost_someone_SH_baseline == "No outcome" |
                    lost_someone_SH_1b == "No outcome" |
                    lost_someone_SH_2b == "No outcome" |
                    lost_someone_SH_3b == "No outcome" |
                    lost_someone_SH_4b == "No outcome" |
                    lost_someone_SH_6b == "No outcome" |
                    lost_someone_SH_8b == "No outcome" |
                    lost_someone_SH_10b == "No outcome" |
                    lost_someone_SH_12b == "No outcome" |
                    lost_someone_SH_14b == "No outcome" |
                    lost_someone_SH_16b == "No outcome" ~ "Exposure but no outcome",
                  
                   # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_selfharm != "Not answered or PNTA" |
                        outcome_phase_selfharm != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_selfharm  == "Not experienced" ~ "Neither exposure nor outcome"
           )
  )
# Check                      
dat %>%
  freq(losing_someone_before_SH) 

# Create final variable of lost someone before SH outcome
dat <- dat %>%
  mutate(lost_someone_before_SH_final =
           case_when(losing_someone_before_SH == "Lost someone after self-harm" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_SH == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_SH == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                       losing_someone_before_SH ==  "Outcome but no exposure" |
                     losing_someone_before_SH ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_SH == "Exposure but no outcome" |
                    losing_someone_before_SH == "Lost someone before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_SH_final)  
```
### Loneliness at baseline

Create numeric variable that demonstrates baseline loneliness score
NB: Again, need to think about how we would like to calculate this. Rough version below (need to think about NAs...)
```{r Baseline loneliness score}

# Score of loneliness at baseline
# All questions begin with: Over the past two weeks, how often have you felt that the following statements apply to you?

# Felt that you lack companionship 
dat <- dat %>%
  mutate(lack_companionship_numeric =
           case_when(
            lone.felt_that_you_lack_companionship == "Hardly ever" ~ 0,
           lone.felt_that_you_lack_companionship == "Some of the time" ~ 1,
           lone.felt_that_you_lack_companionship == "Often" ~ 2
  )
  )

# Felt left out
dat <- dat %>%
  mutate(felt_left_out_numeric =
           case_when(
           lone.felt_left_out == "Hardly ever" ~ 0,
           lone.felt_left_out == "Some of the time" ~ 1,
           lone.felt_left_out == "Often" ~ 2
  )
)

# Felt isolated from others
dat <- dat %>%
  mutate(felt_isolated_from_others_numeric =
           case_when(
           lone.felt_isolated_from_others == "Hardly ever" ~ 0,
           lone.felt_isolated_from_others == "Some of the time" ~ 1,
           lone.felt_isolated_from_others == "Often" ~ 2
  )
)

# Felt alone
dat <- dat %>%
  mutate(felt_alone_numeric =
           case_when(
           lone.felt_alone == "Hardly ever" ~ 0,
           lone.felt_alone == "Some of the time" ~ 1,
           lone.felt_alone == "Often" ~ 2
  )
)
```

Calculate baseline loneliness score
```{r Loneliness baseline score}
dat$loneliness_baseline_count <- rowSums(dat[ ,
                                 c("felt_alone_numeric",
                                   "felt_isolated_from_others_numeric",
                                   "felt_left_out_numeric",
                                   "lack_companionship_numeric")],
                                  na.rm = TRUE)

#Check
dat %>%
  freq(loneliness_baseline_count)
```

Create numeric variable that demonstrates pandemic loneliness score
```{r Loneliness prepandemic score}
# Score of loneliness pre-pandemic
# All questions start with: Before the pandemic, how often have you felt that the following statements apply to you?

# Felt that you lack companionship
dat <- dat %>%
  mutate(lack_companionship_prepandemic_numeric =
           case_when(
            lone.felt_that_you_lack_companionship.1 == "Hardly ever" ~ 0,
           lone.felt_that_you_lack_companionship.1 == "Some of the time" ~ 1,
           lone.felt_that_you_lack_companionship.1 == "Often" ~ 2
  )
  )

# Felt left out
dat <- dat %>%
  mutate(felt_left_out_prepandemic_numeric =
           case_when(
           lone.felt_left_out.1 == "Hardly ever" ~ 0,
           lone.felt_left_out.1 == "Some of the time" ~ 1,
           lone.felt_left_out.1 == "Often" ~ 2
  )
)

# Felt isolated from others
dat <- dat %>%
  mutate(felt_isolated_from_others_prepandemic_numeric =
           case_when(
           lone.felt_isolated_from_others.1 == "Hardly ever" ~ 0,
           lone.felt_isolated_from_others.1 == "Some of the time" ~ 1,
           lone.felt_isolated_from_others.1 == "Often" ~ 2
  )
)

# Felt alone
dat <- dat %>%
  mutate(felt_alone_prepandemic_numeric =
           case_when(
           lone.felt_alone.1 == "Hardly ever" ~ 0,
           lone.felt_alone.1 == "Some of the time" ~ 1,
           lone.felt_alone.1 == "Often" ~ 2
  )
)
            
```

Calculate prepandemic loneliness score
```{r Loneliness prepandemic score}
dat$loneliness_prepandemic_count <- rowSums(dat[ ,
                                 c("felt_alone_prepandemic_numeric",
                                   "felt_isolated_from_others_prepandemic_numeric",
                                   "felt_left_out_prepandemic_numeric",
                                   "lack_companionship_prepandemic_numeric")],
                                  na.rm = TRUE)

# Check
dat %>%
  freq(loneliness_prepandemic_count)
```

Calculate whether they have experienced an increase in loneliness during the pandemic or not 
```{r Loneliness increased during pandemic}
dat <- dat %>%
  mutate(increased_loneliness_during_pandemic =
           case_when(
           loneliness_baseline_count > loneliness_prepandemic_count ~ "Yes", # These people have higher loneliness scores at baseline than retrospective prepandemic loneliness scores
         loneliness_baseline_count <= loneliness_prepandemic_count ~ "No", # These people have lower or the same loneliness scores at baseline than retrospective prepandemic loneliness scores
         )
  )

# Check
dat %>%
  freq(increased_loneliness_during_pandemic)
```

### Change in main eco activity (work/education)
Identify at which phase they first experienced the exposure

Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - change in main eco activity}
dat <- dat %>%
  mutate(exposure_phase_main_eco_change =
           case_when(
                     # Change in employment
                     employ.my_employment_status_has_not_changed == "Not My employment status has not changed" ~ "Baseline", # Indicated change in employment status at baseline
                     
                     # Change in school/studies/exams
                     employ.no_impact == "Not No impact" &  
                     employ.impact_on_studies_still_unknown == "Not Impact on studies still unknown" ~ "Baseline", # Indicated that the pandemic has impacted their studies in some way at baseline
                     
                     # Missing at baseline and all phases
                       is.na(employ.no_impact) & # Not answered impact on studies at baseline
                      is.na(employ.my_employment_status_has_not_changed) & # Not answered whether employment has changed at baseline
                       
                       is.na(dem.employment_.Wave_1a) &  # Has anything changed in the following domains in the last two weeks: Employment
                       is.na(dem.employment_.Wave_1b) &
                       is.na(dem.employment_.Wave_2a) &
                       is.na(dem.employment_.Wave_2b) &
                       is.na(dem.employment_.Wave_3a) &
                       is.na(dem.employment_.Wave_3b) &
                       is.na(dem.employment_.Wave_4a) &
                       is.na(dem.employment_.Wave_4b) &
                       is.na(dem.employment_.Wave_5a) &
                       is.na(dem.employment_.Wave_6b) &
                       is.na(dem.employment_.Wave_7a) &
                       is.na(dem.employment_.Wave_8b) &
                       is.na(dem.employment_.Wave_9a) &
                       is.na(dem.employment_.Wave_10b) &
                       is.na(dem.employment_.Wave_11a) &
                       is.na(dem.employment_.Wave_12b) &
                       is.na(dem.employment_.Wave_13a) &
                       is.na(dem.employment_.Wave_14b) &
                       is.na(dem.employment_.Wave_15a) &
                       is.na(dem.employment_.Wave_16b) &
                       is.na(dem.employment_.Wave_17a) ~ "Missing at every phase", # Not answered whether employment has changed in the last two weeks 
            
                       dem.employment_.Wave_1a == "Employment" ~ "1a",
                       dem.employment_.Wave_1b == "Employment" ~ "1b",
                       dem.employment_.Wave_2a == "Employment" ~ "2a",
                       dem.employment_.Wave_2b == "Employment" ~ "2b",
                       dem.employment_.Wave_3a == "Employment" ~ "3a",
                       dem.employment_.Wave_3b == "Employment" ~ "3b",
                       dem.employment_.Wave_4a == "Employment" ~ "4a",
                       dem.employment_.Wave_4b == "Employment" ~ "4b",
                       dem.employment_.Wave_5a == "Employment" ~ "5a",
                       dem.employment_.Wave_6b == "Employment" ~ "6b",
                       dem.employment_.Wave_7a == "Employment" ~ "7a",
                       dem.employment_.Wave_8b == "Employment" ~ "8b",
                       dem.employment_.Wave_9a == "Employment" ~ "9a",
                       dem.employment_.Wave_10b == "Employment" ~ "10b",
                       dem.employment_.Wave_11a == "Employment" ~ "11a",
                       dem.employment_.Wave_12b == "Employment" ~ "12b",
                     dem.employment_.Wave_13a == "Employment" ~ "13a",
                       dem.employment_.Wave_14b == "Employment" ~ "14b",
                       dem.employment_.Wave_15a == "Employment" ~ "15a",
                       dem.employment_.Wave_16b == "Employment" ~ "16b",
                       dem.employment_.Wave_17a == "Employment" ~ "17a",

                      employ.my_employment_status_has_not_changed == "My employment status has not changed" | # Not experienced change in employment at baseline
                        employ.no_impact == "No impact"  | # Not impacted studies at baseline
                       employ.impact_on_studies_still_unknown == "Impact on studies still unknown" | # Not sure about impact yet
                       dem.employment_.Wave_1a == "Not Employment" |
                       dem.employment_.Wave_1b == "Not Employment" |
                       dem.employment_.Wave_2a == "Not Employment" |
                       dem.employment_.Wave_2b == "Not Employment" |
                       dem.employment_.Wave_3a == "Not Employment" |
                       dem.employment_.Wave_3b == "Not Employment" |
                       dem.employment_.Wave_4a == "Not Employment" |
                       dem.employment_.Wave_4b == "Not Employment" |
                       dem.employment_.Wave_5a == "Not Employment" |
                       dem.employment_.Wave_6b == "Not Employment" |
                       dem.employment_.Wave_7a == "Not Employment" |
                       dem.employment_.Wave_8b == "Not Employment" |
                       dem.employment_.Wave_9a == "Not Employment" |
                       dem.employment_.Wave_10b == "Not Employment" |
                       dem.employment_.Wave_11a == "Not Employment" |
                       dem.employment_.Wave_12b == "Not Employment" |
                       dem.employment_.Wave_13a == "Not Employment" |
                       dem.employment_.Wave_14b == "Not Employment" |
                       dem.employment_.Wave_15a == "Not Employment" |
                       dem.employment_.Wave_16b == "Not Employment" |
                       dem.employment_.Wave_17a == "Not Employment"~ "No change in eco activity" # Have experienced change but not in the employment domain
                     
                   ))

                     

dat %>%
  freq(exposure_phase_main_eco_change)

```

Binge eating 
```{r Change in main eco activity BEFORE outcome BE}
# Baseline
dat <- dat %>%
  mutate(main_eco_change_BE_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_BE_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_BE_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_binge_eating == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_BE_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       outcome_phase_binge_eating == "1b" ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_BE_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                     outcome_phase_binge_eating == "1b"  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_BE_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_BE_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_binge_eating == "1b" |
                       outcome_phase_binge_eating == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_BE_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_BE_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_BE_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_binge_eating == "1b" |
                      outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                    outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_BE_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_BE_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_BE_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_binge_eating == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_BE_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_BE_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_BE_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_BE_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_binge_eating == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_BE_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_BE_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_binge_eating == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_BE_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                   outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_binge_eating == "12b" | # Experienced outcome AFTER or at SAME TIME as exposure
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_BE_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_BE_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_binge_eating == "12b" | # Experienced outcome AFTER or at SAME TIME as exposure
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_BE_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_binge_eating == "14b" | 
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_BE_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_binge_eating == "14b" |  # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_BE_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_binge_eating == "16b"  ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_BE_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_binge_eating == "16b"  ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_16b)

# Phase 17a
dat <- dat %>%
  mutate(main_eco_change_BE_17a =
           case_when(exposure_phase_main_eco_change == "17a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                        outcome_phase_binge_eating == "16b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome"  # Never experienced outcome (people who are all NA are coded as "Not answered")
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_BE_17a)
    
```

Binge eating & change in main eco activity 
```{r Change in eco activity exposure BE}

dat <- dat %>%
  mutate(main_eco_change_before_BE =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_BE_baseline == "To drop" |
                    main_eco_change_BE_1a == "To drop" |
                    main_eco_change_BE_1b == "To drop" |
                      main_eco_change_BE_2a == "To drop" |
                    main_eco_change_BE_2b == "To drop" |
                      main_eco_change_BE_3a == "To drop" |
                    main_eco_change_BE_3b == "To drop" |
                      main_eco_change_BE_4a == "To drop" |
                    main_eco_change_BE_4b == "To drop" |
                      main_eco_change_BE_5a == "To drop" |
                    main_eco_change_BE_6b == "To drop" |
                      main_eco_change_BE_7a == "To drop" |
                    main_eco_change_BE_8b == "To drop" |
                      main_eco_change_BE_9a == "To drop" |
                    main_eco_change_BE_10b == "To drop" |
                      main_eco_change_BE_11a == "To drop" |
                    main_eco_change_BE_12b == "To drop" |
                    main_eco_change_BE_13a == "To drop" |
                      main_eco_change_BE_14b == "To drop" |
                    main_eco_change_BE_15a == "To drop" |
                      main_eco_change_BE_16b == "To drop" |
                    main_eco_change_BE_17a == "To drop"~ "Change in eco activity after binge eating",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "Missing whether experienced binge eating", # Need to be dropped
                    
                  # First exposure before first outcome
                    main_eco_change_BE_baseline == "Yes" |
                    main_eco_change_BE_1a == "Yes" |
                    main_eco_change_BE_1b == "Yes" |
                    main_eco_change_BE_2a == "Yes" |
                    main_eco_change_BE_2b == "Yes" |
                    main_eco_change_BE_3a == "Yes" |
                    main_eco_change_BE_3b == "Yes" |
                    main_eco_change_BE_4a == "Yes" |
                    main_eco_change_BE_4b == "Yes" |
                    main_eco_change_BE_5a == "Yes" |
                    main_eco_change_BE_6b == "Yes" |
                    main_eco_change_BE_7a == "Yes" |
                    main_eco_change_BE_8b == "Yes" |
                    main_eco_change_BE_9a == "Yes" |
                    main_eco_change_BE_10b == "Yes" |
                    main_eco_change_BE_11a == "Yes" |
                    main_eco_change_BE_12b == "Yes" |
                    main_eco_change_BE_13a == "Yes" |
                    main_eco_change_BE_14b == "Yes" |
                    main_eco_change_BE_15a == "Yes" |
                    main_eco_change_BE_16b == "Yes" |
                    main_eco_change_BE_17a == "Yes" ~ "Change in eco activity before binge eating",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_BE_baseline == "No outcome" |
                    main_eco_change_BE_1a == "No outcome" |
                    main_eco_change_BE_1b == "No outcome" |
                    main_eco_change_BE_2a == "No outcome" |
                    main_eco_change_BE_2b == "No outcome" |
                    main_eco_change_BE_3a == "No outcome" |
                    main_eco_change_BE_3b == "No outcome" |
                    main_eco_change_BE_4a == "No outcome" |
                    main_eco_change_BE_4b == "No outcome" |
                    main_eco_change_BE_5a == "No outcome" |
                    main_eco_change_BE_6b == "No outcome" |
                    main_eco_change_BE_7a == "No outcome" |
                    main_eco_change_BE_8b == "No outcome" |
                    main_eco_change_BE_9a == "No outcome" |
                    main_eco_change_BE_10b == "No outcome" |
                    main_eco_change_BE_11a == "No outcome" |
                    main_eco_change_BE_12b == "No outcome" |
                    main_eco_change_BE_13a == "No outcome" |
                    main_eco_change_BE_14b == "No outcome" |
                    main_eco_change_BE_15a == "No outcome" |
                    main_eco_change_BE_16b == "No outcome" |
                    main_eco_change_BE_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_binge_eating != "Not answered" |
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_binge_eating  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_BE) 


# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_BE_final =
           case_when(main_eco_change_before_BE == "Change in eco activity after binge eating" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_BE == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                     main_eco_change_before_BE == "Missing whether experienced binge eating" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced binge eating
                     
                     main_eco_change_before_BE ==  "Outcome but no exposure" |
                      main_eco_change_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                     main_eco_change_before_BE == "Exposure but no outcome" |
                    main_eco_change_before_BE == "Change in eco activity before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_BE_final) 
```

Low weight
```{r Change in main eco activity BEFORE outcome LW}

# Baseline
dat <- dat %>%
  mutate(main_eco_change_LW_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_LW_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_LW_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_low_weight == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_LW_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       outcome_phase_low_weight == "1b" ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_LW_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                     outcome_phase_low_weight == "1b"  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_LW_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_low_weight == "1b" |
                       outcome_phase_low_weight == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_LW_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_LW_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_low_weight == "1b" |
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_LW_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_LW_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_LW_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_LW_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_LW_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_LW_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_LW_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_LW_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_LW_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_12b)


# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_LW_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_LW_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_low_weight == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_LW_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" 
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                     outcome_phase_low_weight == "16b" ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_LW_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" 
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                     outcome_phase_low_weight == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_16b)



# Phase 17a
dat <- dat %>%
  mutate(main_eco_change_LW_17a =
           case_when(exposure_phase_main_eco_change == "17a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" 
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome" # Never experienced outcome (people who are all NA are coded as "Not answered")
                  
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_17a)
```

Low weight & change in main eco activity 
```{r Change in eco activity exposure LW}

dat <- dat %>%
  mutate(main_eco_change_before_LW =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_LW_baseline == "To drop" |
                       main_eco_change_LW_1a == "To drop" |
                    main_eco_change_LW_1b == "To drop" |
                       main_eco_change_LW_2a == "To drop" |
                    main_eco_change_LW_2b == "To drop" |
                       main_eco_change_LW_3a == "To drop" |
                    main_eco_change_LW_3b == "To drop" |
                       main_eco_change_LW_4a == "To drop" |
                    main_eco_change_LW_4b == "To drop" |
                       main_eco_change_LW_5a == "To drop" |
                    main_eco_change_LW_6b == "To drop" |
                       main_eco_change_LW_7a == "To drop" |
                    main_eco_change_LW_8b == "To drop" |
                       main_eco_change_LW_9a == "To drop" |
                    main_eco_change_LW_10b == "To drop" |
                       main_eco_change_LW_11a == "To drop" |
                    main_eco_change_LW_12b == "To drop" |
                    main_eco_change_LW_13a == "To drop" |
                       main_eco_change_LW_14b == "To drop" |
                    main_eco_change_LW_15a == "To drop" |
                       main_eco_change_LW_16b == "To drop" |
                    main_eco_change_LW_17a == "To drop" ~ "Change in eco activity after low weight",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_LW_baseline == "Yes" |
                     main_eco_change_LW_1a == "Yes" |
                    main_eco_change_LW_1b == "Yes" |
                     main_eco_change_LW_2a == "Yes" |
                    main_eco_change_LW_2b == "Yes" |
                     main_eco_change_LW_3a == "Yes" |
                    main_eco_change_LW_3b == "Yes" |
                     main_eco_change_LW_4a == "Yes" |
                    main_eco_change_LW_4b == "Yes" |
                     main_eco_change_LW_5a == "Yes" |
                    main_eco_change_LW_6b == "Yes" |
                     main_eco_change_LW_7a == "Yes" |
                    main_eco_change_LW_8b == "Yes" |
                     main_eco_change_LW_9a == "Yes" |
                    main_eco_change_LW_10b == "Yes" |
                     main_eco_change_LW_11a == "Yes" |
                    main_eco_change_LW_12b == "Yes" |
                    main_eco_change_LW_13a == "Yes" |
                     main_eco_change_LW_14b == "Yes" |
                    main_eco_change_LW_15a == "Yes" |
                     main_eco_change_LW_16b == "Yes" |
                    main_eco_change_LW_17a == "Yes"~ "Change in eco activity before low weight",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_LW_baseline == "No outcome" |
                    main_eco_change_LW_1a == "No outcome" |
                    main_eco_change_LW_1b == "No outcome" |
                    main_eco_change_LW_2a == "No outcome" |
                    main_eco_change_LW_2b == "No outcome" |
                    main_eco_change_LW_3a == "No outcome" |
                    main_eco_change_LW_3b == "No outcome" |
                    main_eco_change_LW_4a == "No outcome" |
                    main_eco_change_LW_4b == "No outcome" |
                    main_eco_change_LW_5a == "No outcome" |
                    main_eco_change_LW_6b == "No outcome" |
                    main_eco_change_LW_7a == "No outcome" |
                    main_eco_change_LW_8b == "No outcome" |
                    main_eco_change_LW_9a == "No outcome" |
                    main_eco_change_LW_10b == "No outcome" |
                    main_eco_change_LW_11a == "No outcome" |
                    main_eco_change_LW_12b == "No outcome" |
                    main_eco_change_LW_13a == "No outcome" |
                    main_eco_change_LW_14b == "No outcome" |
                    main_eco_change_LW_15a == "No outcome" |
                    main_eco_change_LW_16b == "No outcome" |
                    main_eco_change_LW_17a == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_low_weight  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_LW) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_LW_final =
           case_when(main_eco_change_before_LW == "Change in eco activity after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_LW == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_LW ==  "Outcome but no exposure" |
                      main_eco_change_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                      main_eco_change_before_LW == "Exposure but no outcome" |
                      main_eco_change_before_LW == "Change in eco activity before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_LW_final)  

```

Passive suicidal ideation
```{r Change in main eco activity BEFORE outcome PSS}

# Baseline
dat <- dat %>%
  mutate(main_eco_change_PSS_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_passive_suicidal_ideation == "Baseline" | # Co-occurring 
                        outcome_phase_passive_suicidal_ideation == "1a" | 
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" | 
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_PSS_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Baseline"~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_passive_suicidal_ideation == "1a" |  # Co-occurring
                        outcome_phase_passive_suicidal_ideation == "1b" |  
                         outcome_phase_passive_suicidal_ideation == "2a" | 
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                          outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                          outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_PSS_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_passive_suicidal_ideation == "1b" |  # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "2a" |
                         outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_PSS_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "2b" |
                          outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_PSS_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_passive_suicidal_ideation == "Baseline" |
                           outcome_phase_passive_suicidal_ideation == "1a" |
                           outcome_phase_passive_suicidal_ideation == "1b" |
                          outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "3a" |
                          outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_PSS_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_passive_suicidal_ideation == "3a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_PSS_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "4a" |
                           outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_PSS_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_passive_suicidal_ideation == "4a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_PSS_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "5a" |
                          outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_PSS_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_passive_suicidal_ideation == "5a" |
                         outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_PSS_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_PSS_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_PSS_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_passive_suicidal_ideation == "7a" | # Co-occurring
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_PSS_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                        outcome_phase_passive_suicidal_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "9a" |
                          outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_PSS_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_passive_suicidal_ideation == "9a" | # Co-occurring
                        outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_PSS_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_PSS_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" | 
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "11a" | # Co-occurring
                    outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_PSS_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_passive_suicidal_ideation == "12b" |  # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_PSS_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_passive_suicidal_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_PSS_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 13a
                    (  outcome_phase_passive_suicidal_ideation == "14b" |   # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_14b)


# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_PSS_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_passive_suicidal_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_15a)



# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_PSS_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    ( outcome_phase_passive_suicidal_ideation == "16b" |   # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_16b)




# Phase 17a
dat <- dat %>%
  mutate(main_eco_change_PSS_17a =
           case_when(exposure_phase_main_eco_change == "17a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                        outcome_phase_passive_suicidal_ideation == "16b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                     outcome_phase_passive_suicidal_ideation == "17a" ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_17a)
```

Passive suicidal ideation & change in main eco activity 
```{r Change in eco activity exposure PSS}

dat <- dat %>%
  mutate(main_eco_change_before_PSS =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_PSS_baseline == "To drop" |
                       main_eco_change_PSS_1a == "To drop" |
                    main_eco_change_PSS_1b == "To drop" |
                       main_eco_change_PSS_2a == "To drop" |
                    main_eco_change_PSS_2b == "To drop" |
                       main_eco_change_PSS_3a == "To drop" |
                    main_eco_change_PSS_3b == "To drop" |
                       main_eco_change_PSS_4a == "To drop" |
                    main_eco_change_PSS_4b == "To drop" |
                       main_eco_change_PSS_5a == "To drop" |
                    main_eco_change_PSS_6b == "To drop" |
                       main_eco_change_PSS_7a == "To drop" |
                    main_eco_change_PSS_8b == "To drop" |
                       main_eco_change_PSS_9a == "To drop" |
                    main_eco_change_PSS_10b == "To drop" |
                       main_eco_change_PSS_11a == "To drop" |
                    main_eco_change_PSS_12b == "To drop" |
                    main_eco_change_PSS_13a == "To drop" |
                       main_eco_change_PSS_14b == "To drop" |
                    main_eco_change_PSS_15a == "To drop" |
                       main_eco_change_PSS_16b == "To drop" |
                    main_eco_change_PSS_17a == "To drop" ~ "Change in eco activity after passive suicidal ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_PSS_baseline == "Yes" |
                     main_eco_change_PSS_1a == "Yes" |
                    main_eco_change_PSS_1b == "Yes" |
                     main_eco_change_PSS_2a == "Yes" |
                    main_eco_change_PSS_2b == "Yes" |
                     main_eco_change_PSS_3a == "Yes" |
                    main_eco_change_PSS_3b == "Yes" |
                     main_eco_change_PSS_4a == "Yes" |
                    main_eco_change_PSS_4b == "Yes" |
                     main_eco_change_PSS_5a == "Yes" |
                    main_eco_change_PSS_6b == "Yes" |
                     main_eco_change_PSS_7a == "Yes" |
                    main_eco_change_PSS_8b == "Yes" |
                     main_eco_change_PSS_9a == "Yes" |
                    main_eco_change_PSS_10b == "Yes" |
                     main_eco_change_PSS_11a == "Yes" |
                    main_eco_change_PSS_12b == "Yes"|
                    main_eco_change_PSS_13a == "Yes" |
                     main_eco_change_PSS_14b == "Yes" |
                    main_eco_change_PSS_15a == "Yes" |
                     main_eco_change_PSS_16b == "Yes" |
                    main_eco_change_PSS_17a == "Yes" ~ "Change in eco activity before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_PSS_baseline == "No outcome" |
                    main_eco_change_PSS_1a == "No outcome" |
                    main_eco_change_PSS_1b == "No outcome" |
                    main_eco_change_PSS_2a == "No outcome" |
                    main_eco_change_PSS_2b == "No outcome" |
                    main_eco_change_PSS_3a == "No outcome" |
                    main_eco_change_PSS_3b == "No outcome" |
                    main_eco_change_PSS_4a == "No outcome" |
                    main_eco_change_PSS_4b == "No outcome" |
                    main_eco_change_PSS_5a == "No outcome" |
                    main_eco_change_PSS_6b == "No outcome" |
                    main_eco_change_PSS_7a == "No outcome" |
                    main_eco_change_PSS_8b == "No outcome" |
                    main_eco_change_PSS_9a == "No outcome" |
                    main_eco_change_PSS_10b == "No outcome" |
                    main_eco_change_PSS_11a == "No outcome" |
                    main_eco_change_PSS_12b == "No outcome" |
                    main_eco_change_PSS_13a == "No outcome" |
                    main_eco_change_PSS_14b == "No outcome" |
                    main_eco_change_PSS_15a == "No outcome" |
                    main_eco_change_PSS_16b == "No outcome" |
                    main_eco_change_PSS_17a == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_passive_suicidal_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_PSS) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_PSS_final =
           case_when(main_eco_change_before_PSS == "Change in eco activity after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_PSS == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_PSS ==  "Outcome but no exposure" |
                      main_eco_change_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                      
                     main_eco_change_before_PSS == "Exposure but no outcome" |
                      main_eco_change_before_PSS == "Change in eco activity before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_PSS_final)  

```
Self-harm ideation
```{r Change in main eco activity BEFORE outcome SHI} 
# Baseline
dat <- dat %>%
  mutate(main_eco_change_SHI_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_selfharm_ideation == "Baseline" | # Co-occurring 
                        outcome_phase_selfharm_ideation == "1a" | 
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" | 
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_SHI_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Baseline"~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_selfharm_ideation == "1a" |  # Co-occurring
                        outcome_phase_selfharm_ideation == "1b" |  
                         outcome_phase_selfharm_ideation == "2a" | 
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                          outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                          outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_SHI_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "1b" |  # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_SHI_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "2a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "2b" |
                          outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_SHI_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_selfharm_ideation == "Baseline" |
                           outcome_phase_selfharm_ideation == "1a" |
                           outcome_phase_selfharm_ideation == "1b" |
                          outcome_phase_selfharm_ideation == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "3a" |
                          outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_SHI_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_selfharm_ideation == "3a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_SHI_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "4a" |
                           outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_SHI_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_selfharm_ideation == "4a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_SHI_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "5a" |
                          outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_SHI_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_selfharm_ideation == "5a" |
                         outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_SHI_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_SHI_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_selfharm_ideation == "7a" | # Co-occurring
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_SHI_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                        outcome_phase_selfharm_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "9a" |
                          outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_SHI_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_selfharm_ideation == "9a" | # Co-occurring
                        outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_SHI_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "11a" |
                         outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_SHI_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" | 
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "11a" | # Co-occurring
                    outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_SHI_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_selfharm_ideation == "12b" |   # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") == "12b" ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_SHI_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_selfharm_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_SHI_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_selfharm_ideation == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_SHI_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (outcome_phase_selfharm_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_SHI_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    ( outcome_phase_selfharm_ideation == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_16b)

# Phase 17a
dat <- dat %>%
  mutate(main_eco_change_SHI_17a =
           case_when(exposure_phase_main_eco_change == "17a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                      outcome_phase_selfharm_ideation == "17a" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_17a)
```

Self-harm ideation & change in main eco activity 
```{r Change in eco activity exposure SHI}

dat <- dat %>%
  mutate(main_eco_change_before_SHI =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_SHI_baseline == "To drop" |
                       main_eco_change_SHI_1a == "To drop" |
                    main_eco_change_SHI_1b == "To drop" |
                       main_eco_change_SHI_2a == "To drop" |
                    main_eco_change_SHI_2b == "To drop" |
                       main_eco_change_SHI_3a == "To drop" |
                    main_eco_change_SHI_3b == "To drop" |
                       main_eco_change_SHI_4a == "To drop" |
                    main_eco_change_SHI_4b == "To drop" |
                       main_eco_change_SHI_5a == "To drop" |
                    main_eco_change_SHI_6b == "To drop" |
                       main_eco_change_SHI_7a == "To drop" |
                    main_eco_change_SHI_8b == "To drop" |
                       main_eco_change_SHI_9a == "To drop" |
                    main_eco_change_SHI_10b == "To drop" |
                       main_eco_change_SHI_11a == "To drop" |
                    main_eco_change_SHI_12b == "To drop" |
                    main_eco_change_SHI_13a == "To drop" |
                       main_eco_change_SHI_14b == "To drop" |
                    main_eco_change_SHI_15a == "To drop" |
                       main_eco_change_SHI_16b == "To drop" |
                    main_eco_change_SHI_17a == "To drop"~ "Change in eco activity after self-harm ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_SHI_baseline == "Yes" |
                     main_eco_change_SHI_1a == "Yes" |
                    main_eco_change_SHI_1b == "Yes" |
                     main_eco_change_SHI_2a == "Yes" |
                    main_eco_change_SHI_2b == "Yes" |
                     main_eco_change_SHI_3a == "Yes" |
                    main_eco_change_SHI_3b == "Yes" |
                     main_eco_change_SHI_4a == "Yes" |
                    main_eco_change_SHI_4b == "Yes" |
                     main_eco_change_SHI_5a == "Yes" |
                    main_eco_change_SHI_6b == "Yes" |
                     main_eco_change_SHI_7a == "Yes" |
                    main_eco_change_SHI_8b == "Yes" |
                     main_eco_change_SHI_9a == "Yes" |
                    main_eco_change_SHI_10b == "Yes" |
                     main_eco_change_SHI_11a == "Yes" |
                    main_eco_change_SHI_12b == "Yes" |
                    main_eco_change_SHI_13a == "Yes" |
                     main_eco_change_SHI_14b == "Yes" |
                    main_eco_change_SHI_15a == "Yes" |
                     main_eco_change_SHI_16b == "Yes" |
                    main_eco_change_SHI_17a == "Yes" ~ "Change in eco activity before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_SHI_baseline == "No outcome" |
                    main_eco_change_SHI_1a == "No outcome" |
                    main_eco_change_SHI_1b == "No outcome" |
                    main_eco_change_SHI_2a == "No outcome" |
                    main_eco_change_SHI_2b == "No outcome" |
                    main_eco_change_SHI_3a == "No outcome" |
                    main_eco_change_SHI_3b == "No outcome" |
                    main_eco_change_SHI_4a == "No outcome" |
                    main_eco_change_SHI_4b == "No outcome" |
                    main_eco_change_SHI_5a == "No outcome" |
                    main_eco_change_SHI_6b == "No outcome" |
                    main_eco_change_SHI_7a == "No outcome" |
                    main_eco_change_SHI_8b == "No outcome" |
                    main_eco_change_SHI_9a == "No outcome" |
                    main_eco_change_SHI_10b == "No outcome" |
                    main_eco_change_SHI_11a == "No outcome" |
                    main_eco_change_SHI_12b == "No outcome" 
                    main_eco_change_SHI_13a == "No outcome" |
                    main_eco_change_SHI_14b == "No outcome" |
                    main_eco_change_SHI_15a == "No outcome" |
                    main_eco_change_SHI_16b == "No outcome" |
                    main_eco_change_SHI_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_selfharm_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_SHI) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_SHI_final =
           case_when(main_eco_change_before_SHI == "Change in eco activity after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_SHI == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_SHI ==  "Outcome but no exposure" |
                      main_eco_change_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                      main_eco_change_before_SHI == "Exposure but no outcome" |
                      main_eco_change_before_SHI == "Change in eco activity before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_SHI_final)  

```
Self-harm
```{r Change in main eco activity BEFORE outcome SH}

# Baseline
dat <- dat %>%
  mutate(main_eco_change_SH_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_selfharm == "Baseline" | # Co-occurring 
                        outcome_phase_selfharm == "1a" | 
                        outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" | 
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_SH_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm == "Baseline"~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_selfharm == "1a" |  # Co-occurring
                        outcome_phase_selfharm == "1b" |  
                         outcome_phase_selfharm == "2a" | 
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" | 
                       outcome_phase_selfharm == "3b" |
                          outcome_phase_selfharm == "4a" | 
                       outcome_phase_selfharm == "4b" |
                          outcome_phase_selfharm == "5a" | 
                       outcome_phase_selfharm == "6b" |
                          outcome_phase_selfharm == "7a" | 
                       outcome_phase_selfharm == "8b" |
                          outcome_phase_selfharm == "9a" | 
                       outcome_phase_selfharm == "10b" |
                          outcome_phase_selfharm == "11a" | 
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_SH_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm == "1b" |  # Co-occurring outcome and exposure
                      outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                        outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_SH_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm == "Baseline" |
                       outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm == "2a" | # Co-occurring
                         outcome_phase_selfharm == "2b" |
                          outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_SH_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_selfharm == "Baseline" |
                           outcome_phase_selfharm == "1a" |
                           outcome_phase_selfharm == "1b" |
                          outcome_phase_selfharm == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "3a" |
                          outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SH_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_SH_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_selfharm == "3a" | # Co-occurring
                         outcome_phase_selfharm == "3b" |
                          outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SH_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_SH_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm == "4a" |
                           outcome_phase_selfharm == "4b" |
                        outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                        outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_SH_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_selfharm == "4a" | # Co-occurring
                         outcome_phase_selfharm == "4b" |
                          outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_SH_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "5a" |
                          outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_SH_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_selfharm == "5a" |
                         outcome_phase_selfharm == "6b" |
                          outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_SH_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm == "6b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm == "7a" |
                        outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SH_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_SH_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_selfharm == "7a" | # Co-occurring
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SH_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_SH_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                        outcome_phase_selfharm == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "9a" |
                          outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_SH_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_selfharm == "9a" | # Co-occurring
                        outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_SH_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "11a" |
                         outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_SH_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" | 
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_selfharm == "11a" | # Co-occurring
                    outcome_phase_selfharm == "12b"| 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SH_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_SH_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_selfharm == "12b" | 
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_SH_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_13a)

# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_SH_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_selfharm == "14b" | 
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_SH_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" | 
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_SH_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    (outcome_phase_selfharm == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_16b)


# Phase 17a
dat <- dat %>%
  mutate(main_eco_change_SH_17a =
           case_when(exposure_phase_main_eco_change == "17a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                       outcome_phase_selfharm == "16b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm == "17a"  ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SH_17a)
```


Self-harm ideation & change in main eco activity 
```{r Change in eco activity exposure SH}

dat <- dat %>%
  mutate(main_eco_change_before_SH =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_SH_baseline == "To drop" |
                       main_eco_change_SH_1a == "To drop" |
                    main_eco_change_SH_1b == "To drop" |
                       main_eco_change_SH_2a == "To drop" |
                    main_eco_change_SH_2b == "To drop" |
                       main_eco_change_SH_3a == "To drop" |
                    main_eco_change_SH_3b == "To drop" |
                       main_eco_change_SH_4a == "To drop" |
                    main_eco_change_SH_4b == "To drop" |
                       main_eco_change_SH_5a == "To drop" |
                    main_eco_change_SH_6b == "To drop" |
                       main_eco_change_SH_7a == "To drop" |
                    main_eco_change_SH_8b == "To drop" |
                       main_eco_change_SH_9a == "To drop" |
                    main_eco_change_SH_10b == "To drop" |
                       main_eco_change_SH_11a == "To drop" |
                    main_eco_change_SH_12b == "To drop"|
                    main_eco_change_SH_13a == "To drop" |
                       main_eco_change_SH_14b == "To drop" |
                    main_eco_change_SH_15a == "To drop" |
                       main_eco_change_SH_16b == "To drop" |
                    main_eco_change_SH_17a == "To drop" ~ "Change in eco activity after self-harm",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "Missing whether experienced self-harm", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_SH_baseline == "Yes" |
                     main_eco_change_SH_1a == "Yes" |
                    main_eco_change_SH_1b == "Yes" |
                     main_eco_change_SH_2a == "Yes" |
                    main_eco_change_SH_2b == "Yes" |
                     main_eco_change_SH_3a == "Yes" |
                    main_eco_change_SH_3b == "Yes" |
                     main_eco_change_SH_4a == "Yes" |
                    main_eco_change_SH_4b == "Yes" |
                     main_eco_change_SH_5a == "Yes" |
                    main_eco_change_SH_6b == "Yes" |
                     main_eco_change_SH_7a == "Yes" |
                    main_eco_change_SH_8b == "Yes" |
                     main_eco_change_SH_9a == "Yes" |
                    main_eco_change_SH_10b == "Yes" |
                     main_eco_change_SH_11a == "Yes" |
                    main_eco_change_SH_12b == "Yes"|
                    main_eco_change_SH_13a == "Yes" |
                     main_eco_change_SH_14b == "Yes" |
                    main_eco_change_SH_15a == "Yes" |
                     main_eco_change_SH_16b == "Yes" |
                    main_eco_change_SH_17a == "Yes" ~ "Change in eco activity before self-harm",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_SH_baseline == "No outcome" |
                    main_eco_change_SH_1a == "No outcome" |
                    main_eco_change_SH_1b == "No outcome" |
                    main_eco_change_SH_2a == "No outcome" |
                    main_eco_change_SH_2b == "No outcome" |
                    main_eco_change_SH_3a == "No outcome" |
                    main_eco_change_SH_3b == "No outcome" |
                    main_eco_change_SH_4a == "No outcome" |
                    main_eco_change_SH_4b == "No outcome" |
                    main_eco_change_SH_5a == "No outcome" |
                    main_eco_change_SH_6b == "No outcome" |
                    main_eco_change_SH_7a == "No outcome" |
                    main_eco_change_SH_8b == "No outcome" |
                    main_eco_change_SH_9a == "No outcome" |
                    main_eco_change_SH_10b == "No outcome" |
                    main_eco_change_SH_11a == "No outcome" |
                    main_eco_change_SH_12b == "No outcome" |
                    main_eco_change_SH_13a == "No outcome" |
                    main_eco_change_SH_14b == "No outcome" |
                    main_eco_change_SH_15a == "No outcome" |
                    main_eco_change_SH_16b == "No outcome" |
                    main_eco_change_SH_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_selfharm != "Not answered or PNTA" |
                        outcome_phase_selfharm!= "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_selfharm  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
   
# Check                      
dat %>%
  freq(main_eco_change_before_SH) 


# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_SH_final =
           case_when(main_eco_change_before_SH == "Change in eco activity after self-harm" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_SH == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_SH == "Missing whether experienced self-harm" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_SH ==  "Outcome but no exposure" |
                      main_eco_change_before_SH ==  "Neither exposure nor outcome" ~ "No",
                    
                     main_eco_change_before_SH == "Exposure but no outcome" |
                      main_eco_change_before_SH == "Change in eco activity before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_SH_final)  

```

### Change in living situation

Identify at which phase they first experienced the exposure

Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - change in living situation}
dat <- dat %>%
  mutate(exposure_phase_living_situation_change =
           case_when(
                     # Change in employment
                     dem2.living_situation_change_pandemic == "Yes" ~ "Baseline", # Indicated change in living situation at baseline
                  
                     # Missing at baseline and all phases
                       is.na(dem2.living_situation_change_pandemic) & # Not answered at baseline
                      is.na(dem.living_situation_.Wave_1a) &  # Has anything changed in the following domains in the last two weeks: Living situation
                       is.na(dem.living_situation_.Wave_1b) &
                       is.na(dem.living_situation_.Wave_2a) &
                       is.na(dem.living_situation_.Wave_2b) &
                       is.na(dem.living_situation_.Wave_3a) &
                       is.na(dem.living_situation_.Wave_3b) &
                       is.na(dem.living_situation_.Wave_4a) &
                       is.na(dem.living_situation_.Wave_4b) &
                       is.na(dem.living_situation_.Wave_5a) &
                       is.na(dem.living_situation_.Wave_6b) &
                       is.na(dem.living_situation_.Wave_7a) &
                       is.na(dem.living_situation_.Wave_8b) &
                       is.na(dem.living_situation_.Wave_9a) &
                       is.na(dem.living_situation_.Wave_10b) &
                       is.na(dem.living_situation_.Wave_11a) &
                       is.na(dem.living_situation_.Wave_12b)&
                       is.na(dem.living_situation_.Wave_13a) &
                       is.na(dem.living_situation_.Wave_14b) &
                       is.na(dem.living_situation_.Wave_15a) &
                       is.na(dem.living_situation_.Wave_16b) &
                       is.na(dem.living_situation_.Wave_17a) ~ "Missing at every phase", # Not answered whether living situation has changed in the last two weeks 
            
                       dem.living_situation_.Wave_1a == "Living situation" ~ "1a",
                       dem.living_situation_.Wave_1b == "Living situation" ~ "1b",
                       dem.living_situation_.Wave_2a == "Living situation" ~ "2a",
                       dem.living_situation_.Wave_2b == "Living situation" ~ "2b",
                       dem.living_situation_.Wave_3a == "Living situation" ~ "3a",
                       dem.living_situation_.Wave_3b == "Living situation" ~ "3b",
                       dem.living_situation_.Wave_4a == "Living situation" ~ "4a",
                       dem.living_situation_.Wave_4b == "Living situation" ~ "4b",
                       dem.living_situation_.Wave_5a == "Living situation" ~ "5a",
                       dem.living_situation_.Wave_6b == "Living situation" ~ "6b",
                       dem.living_situation_.Wave_7a == "Living situation" ~ "7a",
                       dem.living_situation_.Wave_8b == "Living situation" ~ "8b",
                       dem.living_situation_.Wave_9a == "Living situation" ~ "9a",
                       dem.living_situation_.Wave_10b == "Living situation" ~ "10b",
                       dem.living_situation_.Wave_11a == "Living situation" ~ "11a",
                       dem.living_situation_.Wave_12b == "Living situation" ~ "12b",
                     dem.living_situation_.Wave_13a == "Living situation" ~ "13a",
                       dem.living_situation_.Wave_14b == "Living situation" ~ "14b",
                       dem.living_situation_.Wave_15a == "Living situation" ~ "15a",
                       dem.living_situation_.Wave_16b == "Living situation" ~ "16b",
                       dem.living_situation_.Wave_17a == "Living situation" ~ "17a",

                      dem2.living_situation_change_pandemic == "No" | # Not experienced change in living situation at baseline
                       dem.living_situation_.Wave_1a == "Not Living situation" |
                       dem.living_situation_.Wave_1b == "Not Living situation" |
                       dem.living_situation_.Wave_2a == "Not Living situation" |
                       dem.living_situation_.Wave_2b == "Not Living situation" |
                       dem.living_situation_.Wave_3a == "Not Living situation" |
                       dem.living_situation_.Wave_3b == "Not Living situation" |
                       dem.living_situation_.Wave_4a == "Not Living situation" |
                       dem.living_situation_.Wave_4b == "Not Living situation" |
                       dem.living_situation_.Wave_5a == "Not Living situation" |
                       dem.living_situation_.Wave_6b == "Not Living situation" |
                       dem.living_situation_.Wave_7a == "Not Living situation" |
                       dem.living_situation_.Wave_8b == "Not Living situation" |
                       dem.living_situation_.Wave_9a == "Not Living situation" |
                       dem.living_situation_.Wave_10b == "Not Living situation" |
                       dem.living_situation_.Wave_11a == "Not Living situation" |
                       dem.living_situation_.Wave_12b == "Not Living situation" |
                       dem.living_situation_.Wave_13a == "Not Living situation" |
                       dem.living_situation_.Wave_14b == "Not Living situation" |
                       dem.living_situation_.Wave_15a == "Not Living situation" |
                       dem.living_situation_.Wave_16b == "Not Living situation" |
                       dem.living_situation_.Wave_17a == "Not Living situation" ~ "No change in living situation" # Have experienced change but not in the employment domain
                     
                   ))


dat %>%
  freq(exposure_phase_living_situation_change)

```

Binge eating 
```{r Change in living situation BEFORE outcome BE}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_BE_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_BE_1a =
           case_when(
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_binge_eating == "1b" |  
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_BE_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_binge_eating == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_BE_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       outcome_phase_binge_eating == "1b" ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_BE_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     outcome_phase_binge_eating == "1b"  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_BE_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_BE_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_binge_eating == "1b" |
                       outcome_phase_binge_eating == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_BE_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_BE_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_BE_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_binge_eating == "1b" |
                      outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_BE_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_BE_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_BE_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_binge_eating == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_BE_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_BE_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_BE_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_BE_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_binge_eating == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_BE_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_BE_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_binge_eating == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "12b"|
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_BE_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" | 
                       outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_binge_eating == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_BE_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_BE_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_12b)


# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_BE_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_BE_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_binge_eating == "14b" |  # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "16b") ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_14b)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_BE_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                      outcome_phase_binge_eating == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_16b)


# Phase 17a
dat <- dat %>%
  mutate(living_situation_change_BE_17a =
           case_when(exposure_phase_living_situation_change == "17a" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b" |
                       outcome_phase_binge_eating == "14b" |
                       outcome_phase_binge_eating == "16b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 16b
                    outcome_phase_binge_eating == "Not experienced" ~ "No outcome" # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_BE_17a)

```

Binge eating & change in living situation
```{r Change in eco activity exposure BE}

dat <- dat %>%
  mutate(living_situation_change_before_BE =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_BE_baseline == "To drop" |
                    living_situation_change_BE_1a == "To drop" |
                    living_situation_change_BE_1b == "To drop" |
                      living_situation_change_BE_2a == "To drop" |
                    living_situation_change_BE_2b == "To drop" |
                      living_situation_change_BE_3a == "To drop" |
                    living_situation_change_BE_3b == "To drop" |
                      living_situation_change_BE_4a == "To drop" |
                    living_situation_change_BE_4b == "To drop" |
                      living_situation_change_BE_5a == "To drop" |
                    living_situation_change_BE_6b == "To drop" |
                      living_situation_change_BE_7a == "To drop" |
                    living_situation_change_BE_8b == "To drop" |
                      living_situation_change_BE_9a == "To drop" |
                    living_situation_change_BE_10b == "To drop" |
                      living_situation_change_BE_11a == "To drop" |
                    living_situation_change_BE_12b == "To drop" |
                    living_situation_change_BE_13a == "To drop" |
                      living_situation_change_BE_14b == "To drop" |
                    living_situation_change_BE_15a == "To drop" |
                      living_situation_change_BE_16b == "To drop" |
                    living_situation_change_BE_17a == "To drop"~ "Change in living situation after binge eating",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced binge eating 
                    outcome_phase_binge_eating == "Not answered" ~ "Missing whether experienced binge eating", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_BE_baseline == "Yes" |
                    living_situation_change_BE_1a == "Yes" |
                    living_situation_change_BE_1b == "Yes" |
                    living_situation_change_BE_2a == "Yes" |
                    living_situation_change_BE_2b == "Yes" |
                    living_situation_change_BE_3a == "Yes" |
                    living_situation_change_BE_3b == "Yes" |
                    living_situation_change_BE_4a == "Yes" |
                    living_situation_change_BE_4b == "Yes" |
                    living_situation_change_BE_5a == "Yes" |
                    living_situation_change_BE_6b == "Yes" |
                    living_situation_change_BE_7a == "Yes" |
                    living_situation_change_BE_8b == "Yes" |
                    living_situation_change_BE_9a == "Yes" |
                    living_situation_change_BE_10b == "Yes" |
                    living_situation_change_BE_11a == "Yes" |
                    living_situation_change_BE_12b == "Yes" |
                    living_situation_change_BE_13a == "Yes" |
                    living_situation_change_BE_14b == "Yes" |
                    living_situation_change_BE_15a == "Yes" |
                    living_situation_change_BE_16b == "Yes" |
                    living_situation_change_BE_17a == "Yes"~ "Change in living situation before binge eating",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_BE_baseline == "No outcome" |
                    living_situation_change_BE_1a == "No outcome" |
                    living_situation_change_BE_1b == "No outcome" |
                    living_situation_change_BE_2a == "No outcome" |
                    living_situation_change_BE_2b == "No outcome" |
                    living_situation_change_BE_3a == "No outcome" |
                    living_situation_change_BE_3b == "No outcome" |
                    living_situation_change_BE_4a == "No outcome" |
                    living_situation_change_BE_4b == "No outcome" |
                    living_situation_change_BE_5a == "No outcome" |
                    living_situation_change_BE_6b == "No outcome" |
                    living_situation_change_BE_7a == "No outcome" |
                    living_situation_change_BE_8b == "No outcome" |
                    living_situation_change_BE_9a == "No outcome" |
                    living_situation_change_BE_10b == "No outcome" |
                    living_situation_change_BE_11a == "No outcome" |
                    living_situation_change_BE_12b == "No outcome" |
                    living_situation_change_BE_13a == "No outcome" |
                    living_situation_change_BE_14b == "No outcome" |
                    living_situation_change_BE_15a == "No outcome" |
                    living_situation_change_BE_16b == "No outcome" |
                    living_situation_change_BE_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_binge_eating != "Not answered" |
                        outcome_phase_binge_eating != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_binge_eating  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_BE) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_BE_final =
           case_when(living_situation_change_before_BE == "Change in living situation after binge eating" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_BE == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_BE == "Missing whether experienced binge eating" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced binge eating
                     
                       living_situation_change_before_BE ==  "Outcome but no exposure" |
                      living_situation_change_before_BE ==  "Neither exposure nor outcome" ~ "No",
                    
                      living_situation_change_before_BE == "Exposure but no outcome" |
                    living_situation_change_before_BE == "Change in living situation before binge eating" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_BE_final) 
```

Low weight
```{r Change in living situation BEFORE outcome LW}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_LW_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_LW_1a =
           case_when(
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_LW_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_low_weight == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_LW_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       outcome_phase_low_weight == "1b" ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_LW_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     outcome_phase_low_weight == "1b"  ~ "To drop", # First experience of outcome occurred LWfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_LW_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_low_weight == "1b" |
                       outcome_phase_low_weight == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_LW_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_LW_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_low_weight == "1b" |
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_LW_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_LW_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_LW_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_LW_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_LW_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_LW_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_LW_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_LW_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_LW_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_12b)




# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_LW_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_LW_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_low_weight == "14b" |  # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_14b)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_LW_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                      outcome_phase_low_weight == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_16b)


# Phase 17a
dat <- dat %>%
  mutate(living_situation_change_LW_17a =
           case_when(exposure_phase_living_situation_change == "17a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome" # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_17a)
```

Low weight & change in living situation
```{r Change in eco activity exposure LW}

dat <- dat %>%
  mutate(living_situation_change_before_LW =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_LW_baseline == "To drop" |
                    living_situation_change_LW_1a == "To drop" |
                    living_situation_change_LW_1b == "To drop" |
                      living_situation_change_LW_2a == "To drop" |
                    living_situation_change_LW_2b == "To drop" |
                      living_situation_change_LW_3a == "To drop" |
                    living_situation_change_LW_3b == "To drop" |
                      living_situation_change_LW_4a == "To drop" |
                    living_situation_change_LW_4b == "To drop" |
                      living_situation_change_LW_5a == "To drop" |
                    living_situation_change_LW_6b == "To drop" |
                      living_situation_change_LW_7a == "To drop" |
                    living_situation_change_LW_8b == "To drop" |
                      living_situation_change_LW_9a == "To drop" |
                    living_situation_change_LW_10b == "To drop" |
                      living_situation_change_LW_11a == "To drop" |
                    living_situation_change_LW_12b == "To drop"|
                    living_situation_change_LW_13a == "To drop" |
                      living_situation_change_LW_14b== "To drop" |
                    living_situation_change_LW_15a == "To drop" |
                      living_situation_change_LW_16b == "To drop" |
                    living_situation_change_LW_17a == "To drop" ~ "Change in living situation after low weight",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_LW_baseline == "Yes" |
                    living_situation_change_LW_1a == "Yes" |
                    living_situation_change_LW_1b == "Yes" |
                    living_situation_change_LW_2a == "Yes" |
                    living_situation_change_LW_2b == "Yes" |
                    living_situation_change_LW_3a == "Yes" |
                    living_situation_change_LW_3b == "Yes" |
                    living_situation_change_LW_4a == "Yes" |
                    living_situation_change_LW_4b == "Yes" |
                    living_situation_change_LW_5a == "Yes" |
                    living_situation_change_LW_6b == "Yes" |
                    living_situation_change_LW_7a == "Yes" |
                    living_situation_change_LW_8b == "Yes" |
                    living_situation_change_LW_9a == "Yes" |
                    living_situation_change_LW_10b == "Yes" |
                    living_situation_change_LW_11a == "Yes" |
                    living_situation_change_LW_12b == "Yes" |
                    living_situation_change_LW_13a == "Yes" |
                    living_situation_change_LW_14b == "Yes" |
                    living_situation_change_LW_15a == "Yes" |
                    living_situation_change_LW_16b == "Yes" |
                    living_situation_change_LW_17a == "Yes"~ "Change in living situation before low weight",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_LW_baseline == "No outcome" |
                    living_situation_change_LW_1a == "No outcome" |
                    living_situation_change_LW_1b == "No outcome" |
                    living_situation_change_LW_2a == "No outcome" |
                    living_situation_change_LW_2b == "No outcome" |
                    living_situation_change_LW_3a == "No outcome" |
                    living_situation_change_LW_3b == "No outcome" |
                    living_situation_change_LW_4a == "No outcome" |
                    living_situation_change_LW_4b == "No outcome" |
                    living_situation_change_LW_5a == "No outcome" |
                    living_situation_change_LW_6b == "No outcome" |
                    living_situation_change_LW_7a == "No outcome" |
                    living_situation_change_LW_8b == "No outcome" |
                    living_situation_change_LW_9a == "No outcome" |
                    living_situation_change_LW_10b == "No outcome" |
                    living_situation_change_LW_11a == "No outcome" |
                    living_situation_change_LW_12b == "No outcome" |
                    living_situation_change_LW_13a == "No outcome" |
                    living_situation_change_LW_14b == "No outcome" |
                    living_situation_change_LW_15a == "No outcome" |
                    living_situation_change_LW_16b == "No outcome" |
                    living_situation_change_LW_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_low_weight  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_LW) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_LW_final =
           case_when(living_situation_change_before_LW == "Change in living situation after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_LW == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                       living_situation_change_before_LW ==  "Outcome but no exposure" |
                     living_situation_change_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     living_situation_change_before_LW == "Exposure but no outcome" |
                    living_situation_change_before_LW == "Change in living situation before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_LW_final) 
```

Passive suicidal ideation
```{r Change in living situation BEFORE outcome PSS}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_PSS_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_passive_suicidal_ideation == "Baseline" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" |  
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_PSS_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Baseline" ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_passive_suicidal_ideation == "1a" | # Co-occurring
                        outcome_phase_passive_suicidal_ideation == "1b" | 
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_PSS_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_passive_suicidal_ideation == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "2a" |
                         outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_PSS_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |
                          outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2a" |
                         outcome_phase_passive_suicidal_ideation == "2b" |
                          outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_PSS_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a") ~ "To drop", # First experience of outcome occurred PSSfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "3a" |
                          outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_PSS_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_passive_suicidal_ideation == "3a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_PSS_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "4a" |
                          outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_PSS_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_passive_suicidal_ideation == "4a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_PSS_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "5a" |
                          outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_PSS_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_passive_suicidal_ideation == "5a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_PSS_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_PSS_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_PSS_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_passive_suicidal_ideation == "7a" | # Co-occurring
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_PSS_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_passive_suicidal_ideation == "8b" | # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "9a" |
                          outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_PSS_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_passive_suicidal_ideation == "9a" | # Co-occurring
                        outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_PSS_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "10b" | # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "11a" |
                          outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_PSS_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" | 
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "11a" | # Co-occurring
                     outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_PSS_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_12b)

# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_PSS_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_passive_suicidal_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_PSS_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_passive_suicidal_ideation == "14b" | | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_PSS_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_passive_suicidal_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_15a)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_PSS_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    (  outcome_phase_passive_suicidal_ideation == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_16b)


# Phase 17a
dat <- dat %>%
  mutate(living_situation_change_PSS_17a =
           case_when(exposure_phase_living_situation_change == "17a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                        outcome_phase_passive_suicidal_ideation == "16b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_passive_suicidal_ideation == "17a" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_17a)
```

Passive suicidal ideation & change in living situation
```{r Change in eco activity exposure PSS}

dat <- dat %>%
  mutate(living_situation_change_before_PSS =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_PSS_baseline == "To drop" |
                    living_situation_change_PSS_1a == "To drop" |
                    living_situation_change_PSS_1b == "To drop" |
                      living_situation_change_PSS_2a == "To drop" |
                    living_situation_change_PSS_2b == "To drop" |
                      living_situation_change_PSS_3a == "To drop" |
                    living_situation_change_PSS_3b == "To drop" |
                      living_situation_change_PSS_4a == "To drop" |
                    living_situation_change_PSS_4b == "To drop" |
                      living_situation_change_PSS_5a == "To drop" |
                    living_situation_change_PSS_6b == "To drop" |
                      living_situation_change_PSS_7a == "To drop" |
                    living_situation_change_PSS_8b == "To drop" |
                      living_situation_change_PSS_9a == "To drop" |
                    living_situation_change_PSS_10b == "To drop" |
                      living_situation_change_PSS_11a == "To drop" |
                    living_situation_change_PSS_12b == "To drop" |
                    living_situation_change_PSS_13a == "To drop" |
                      living_situation_change_PSS_14b == "To drop" |
                    living_situation_change_PSS_15a == "To drop" |
                      living_situation_change_PSS_16b == "To drop" |
                    living_situation_change_PSS_17a == "To drop"~ "Change in living situation after passive suicidal ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_PSS_baseline == "Yes" |
                    living_situation_change_PSS_1a == "Yes" |
                    living_situation_change_PSS_1b == "Yes" |
                    living_situation_change_PSS_2a == "Yes" |
                    living_situation_change_PSS_2b == "Yes" |
                    living_situation_change_PSS_3a == "Yes" |
                    living_situation_change_PSS_3b == "Yes" |
                    living_situation_change_PSS_4a == "Yes" |
                    living_situation_change_PSS_4b == "Yes" |
                    living_situation_change_PSS_5a == "Yes" |
                    living_situation_change_PSS_6b == "Yes" |
                    living_situation_change_PSS_7a == "Yes" |
                    living_situation_change_PSS_8b == "Yes" |
                    living_situation_change_PSS_9a == "Yes" |
                    living_situation_change_PSS_10b == "Yes" |
                    living_situation_change_PSS_11a == "Yes" |
                    living_situation_change_PSS_12b == "Yes"|
                    living_situation_change_PSS_13a == "Yes" |
                    living_situation_change_PSS_14b == "Yes" |
                    living_situation_change_PSS_15a == "Yes" |
                    living_situation_change_PSS_16b == "Yes" |
                    living_situation_change_PSS_17a == "Yes" ~ "Change in living situation before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_PSS_baseline == "No outcome" |
                    living_situation_change_PSS_1a == "No outcome" |
                    living_situation_change_PSS_1b == "No outcome" |
                    living_situation_change_PSS_2a == "No outcome" |
                    living_situation_change_PSS_2b == "No outcome" |
                    living_situation_change_PSS_3a == "No outcome" |
                    living_situation_change_PSS_3b == "No outcome" |
                    living_situation_change_PSS_4a == "No outcome" |
                    living_situation_change_PSS_4b == "No outcome" |
                    living_situation_change_PSS_5a == "No outcome" |
                    living_situation_change_PSS_6b == "No outcome" |
                    living_situation_change_PSS_7a == "No outcome" |
                    living_situation_change_PSS_8b == "No outcome" |
                    living_situation_change_PSS_9a == "No outcome" |
                    living_situation_change_PSS_10b == "No outcome" |
                    living_situation_change_PSS_11a == "No outcome" |
                    living_situation_change_PSS_12b == "No outcome" |
                    living_situation_change_PSS_13a == "No outcome" |
                    living_situation_change_PSS_14b == "No outcome" |
                    living_situation_change_PSS_15a == "No outcome" |
                    living_situation_change_PSS_16b == "No outcome" |
                    living_situation_change_PSS_17a == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_passive_suicidal_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_PSS) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_PSS_final =
           case_when(living_situation_change_before_PSS == "Change in living situation after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_PSS == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                       living_situation_change_before_PSS ==  "Outcome but no exposure" |
                      living_situation_change_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_PSS == "Exposure but no outcome" |
                    living_situation_change_before_PSS == "Change in living situation before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_PSS_final) 
```
Self-harm ideation
```{r Change in living situation BEFORE outcome SHI}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_SHI_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_selfharm_ideation == "Baseline" | # Co-occurring
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |  
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_SHI_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Baseline" ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_selfharm_ideation == "1a" | # Co-occurring
                        outcome_phase_selfharm_ideation == "1b" | 
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_SHI_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_SHI_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "Baseline" |
                          outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                          outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_SHI_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a") ~ "To drop", # First experience of outcome occurred SHIfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "3a" |
                          outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_SHI_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_selfharm_ideation == "3a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_SHI_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "4a" |
                          outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_SHI_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_selfharm_ideation == "4a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_SHI_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "5a" |
                          outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_SHI_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_selfharm_ideation == "5a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_SHI_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_SHI_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_selfharm_ideation == "7a" | # Co-occurring
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_SHI_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_selfharm_ideation == "8b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "9a" |
                          outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_SHI_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_selfharm_ideation == "9a" | # Co-occurring
                        outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_SHI_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "10b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "11a" |
                          outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_SHI_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" | 
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "11a" | # Co-occurring
                     outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_SHI_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_SHI_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_selfharm_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_SHI_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_selfharm_ideation == "14b" | | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_SHI_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_selfharm_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_SHI_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    (  outcome_phase_selfharm_ideation == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_16b)


# Phase 17a
dat <- dat %>%
  mutate(living_situation_change_SHI_17a =
           case_when(exposure_phase_living_situation_change == "17a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" |
                        outcome_phase_selfharm_ideation == "16b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm_ideation == "17a" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_17a)
```

Self-harm ideation & change in living situation
```{r Change in eco activity exposure SHI}

dat <- dat %>%
  mutate(living_situation_change_before_SHI =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_SHI_baseline == "To drop" |
                    living_situation_change_SHI_1a == "To drop" |
                    living_situation_change_SHI_1b == "To drop" |
                      living_situation_change_SHI_2a == "To drop" |
                    living_situation_change_SHI_2b == "To drop" |
                      living_situation_change_SHI_3a == "To drop" |
                    living_situation_change_SHI_3b == "To drop" |
                      living_situation_change_SHI_4a == "To drop" |
                    living_situation_change_SHI_4b == "To drop" |
                      living_situation_change_SHI_5a == "To drop" |
                    living_situation_change_SHI_6b == "To drop" |
                      living_situation_change_SHI_7a == "To drop" |
                    living_situation_change_SHI_8b == "To drop" |
                      living_situation_change_SHI_9a == "To drop" |
                    living_situation_change_SHI_10b == "To drop" |
                      living_situation_change_SHI_11a == "To drop" |
                    living_situation_change_SHI_12b == "To drop" |
                    living_situation_change_SHI_13a == "To drop" |
                      living_situation_change_SHI_14b == "To drop" |
                    living_situation_change_SHI_15a == "To drop" |
                      living_situation_change_SHI_16b == "To drop" |
                    living_situation_change_SHI_17a == "To drop"~ "Change in living situation after self-harm ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_SHI_baseline == "Yes" |
                    living_situation_change_SHI_1a == "Yes" |
                    living_situation_change_SHI_1b == "Yes" |
                    living_situation_change_SHI_2a == "Yes" |
                    living_situation_change_SHI_2b == "Yes" |
                    living_situation_change_SHI_3a == "Yes" |
                    living_situation_change_SHI_3b == "Yes" |
                    living_situation_change_SHI_4a == "Yes" |
                    living_situation_change_SHI_4b == "Yes" |
                    living_situation_change_SHI_5a == "Yes" |
                    living_situation_change_SHI_6b == "Yes" |
                    living_situation_change_SHI_7a == "Yes" |
                    living_situation_change_SHI_8b == "Yes" |
                    living_situation_change_SHI_9a == "Yes" |
                    living_situation_change_SHI_10b == "Yes" |
                    living_situation_change_SHI_11a == "Yes" |
                    living_situation_change_SHI_12b == "Yes"|
                    living_situation_change_SHI_13a == "Yes" |
                    living_situation_change_SHI_14b == "Yes" |
                    living_situation_change_SHI_15a == "Yes" |
                    living_situation_change_SHI_16b == "Yes" |
                    living_situation_change_SHI_17a == "Yes" ~ "Change in living situation before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_SHI_baseline == "No outcome" |
                    living_situation_change_SHI_1a == "No outcome" |
                    living_situation_change_SHI_1b == "No outcome" |
                    living_situation_change_SHI_2a == "No outcome" |
                    living_situation_change_SHI_2b == "No outcome" |
                    living_situation_change_SHI_3a == "No outcome" |
                    living_situation_change_SHI_3b == "No outcome" |
                    living_situation_change_SHI_4a == "No outcome" |
                    living_situation_change_SHI_4b == "No outcome" |
                    living_situation_change_SHI_5a == "No outcome" |
                    living_situation_change_SHI_6b == "No outcome" |
                    living_situation_change_SHI_7a == "No outcome" |
                    living_situation_change_SHI_8b == "No outcome" |
                    living_situation_change_SHI_9a == "No outcome" |
                    living_situation_change_SHI_10b == "No outcome" |
                    living_situation_change_SHI_11a == "No outcome" |
                    living_situation_change_SHI_12b == "No outcome" |
                    living_situation_change_SHI_13a == "No outcome" |
                    living_situation_change_SHI_14b == "No outcome" |
                    living_situation_change_SHI_15a == "No outcome" |
                    living_situation_change_SHI_16b == "No outcome" |
                    living_situation_change_SHI_17a == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_selfharm_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_SHI) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_SHI_final =
           case_when(living_situation_change_before_SHI == "Change in living situation after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_SHI == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                      living_situation_change_before_SHI ==  "Outcome but no exposure" |
                      living_situation_change_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_SHI == "Exposure but no outcome" |
                    living_situation_change_before_SHI == "Change in living situation before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_SHI_final) 
```

Self-harm 
```{r Change in living situation BEFORE outcome SH}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_SH_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_selfharm == "Baseline" | # Co-occurring
                         outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" |  
                         outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_SH_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm == "Baseline" ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_selfharm == "1a" | # Co-occurring
                        outcome_phase_selfharm == "1b" | 
                         outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_SH_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "2b" |
                         outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_SH_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm == "Baseline" |
                          outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm == "2a" |
                         outcome_phase_selfharm == "2b" |
                          outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_SH_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a") ~ "To drop", # First experience of outcome occurred SHfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_selfharm == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "3a" |
                          outcome_phase_selfharm == "3b" |
                         outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SH_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_SH_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_selfharm == "Baseline" |
                         outcome_phase_selfharm == "1a" |
                        outcome_phase_selfharm == "1b" |
                         outcome_phase_selfharm == "2a" |
                       outcome_phase_selfharm == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_selfharm == "3a" | # Co-occurring
                         outcome_phase_selfharm == "3b" |
                          outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SH_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_SH_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_selfharm == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "4a" |
                          outcome_phase_selfharm == "4b" |
                         outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_SH_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                      outcome_phase_selfharm == "2b" |
                        outcome_phase_selfharm == "3a" |
                       outcome_phase_selfharm == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_selfharm == "4a" | # Co-occurring
                         outcome_phase_selfharm == "4b" |
                          outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_SH_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_selfharm == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "5a" |
                          outcome_phase_selfharm == "6b" |
                         outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_SH_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                       outcome_phase_selfharm == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_selfharm == "5a" | # Co-occurring
                         outcome_phase_selfharm == "6b" |
                          outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                         outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_SH_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SH_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_SH_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                       outcome_phase_selfharm == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_selfharm == "7a" | # Co-occurring
                      outcome_phase_selfharm == "8b" |
                        outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SH_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_SH_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_selfharm == "8b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm == "9a" |
                          outcome_phase_selfharm == "10b" |
                        outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_SH_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                       outcome_phase_selfharm == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_selfharm == "9a" | # Co-occurring
                        outcome_phase_selfharm == "10b" |
                         outcome_phase_selfharm == "11a" |
                       outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_SH_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm == "10b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm == "11a" |
                          outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_SH_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" | 
                       outcome_phase_selfharm == "9a" |
                       outcome_phase_selfharm == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_selfharm == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_selfharm == "11a" | # Co-occurring
                     outcome_phase_selfharm == "12b"|
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SH_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_SH_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_12b)



# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_SH_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_selfharm == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm == "14b" |
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_SH_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_selfharm == "14b" | | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "15a" |
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_SH_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_selfharm == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm == "16b" |
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_15a)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_SH_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                        outcome_phase_selfharm == "15a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    (  outcome_phase_selfharm == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_16b)


# Phase 17a
dat <- dat %>%
  mutate(living_situation_change_SH_17a =
           case_when(exposure_phase_living_situation_change == "17a" &
                     (outcome_phase_selfharm == "Baseline" |
                        outcome_phase_selfharm == "1a" |
                       outcome_phase_selfharm == "1b" |
                        outcome_phase_selfharm == "2a" |
                     outcome_phase_selfharm == "2b" |
                       outcome_phase_selfharm == "3a" |
                     outcome_phase_selfharm == "3b" |
                       outcome_phase_selfharm == "4a" |
                     outcome_phase_selfharm == "4b" |
                       outcome_phase_selfharm == "5a" |
                     outcome_phase_selfharm == "6b" |
                       outcome_phase_selfharm == "7a" |
                     outcome_phase_selfharm == "8b" |
                       outcome_phase_selfharm == "9a" |
                     outcome_phase_selfharm == "10b" |
                       outcome_phase_selfharm == "11a"|
                       outcome_phase_selfharm == "12b" |
                       outcome_phase_selfharm == "13a" |
                       outcome_phase_selfharm == "14b" |
                        outcome_phase_selfharm == "15a" |
                        outcome_phase_selfharm == "16b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm == "17a" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SH_17a)
```

Self-harm & change in living situation
```{r Change in eco activity exposure SH}

dat <- dat %>%
  mutate(living_situation_change_before_SH =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_SH_baseline == "To drop" |
                    living_situation_change_SH_1a == "To drop" |
                    living_situation_change_SH_1b == "To drop" |
                      living_situation_change_SH_2a == "To drop" |
                    living_situation_change_SH_2b == "To drop" |
                      living_situation_change_SH_3a == "To drop" |
                    living_situation_change_SH_3b == "To drop" |
                      living_situation_change_SH_4a == "To drop" |
                    living_situation_change_SH_4b == "To drop" |
                      living_situation_change_SH_5a == "To drop" |
                    living_situation_change_SH_6b == "To drop" |
                      living_situation_change_SH_7a == "To drop" |
                    living_situation_change_SH_8b == "To drop" |
                      living_situation_change_SH_9a == "To drop" |
                    living_situation_change_SH_10b == "To drop" |
                      living_situation_change_SH_11a == "To drop" |
                    living_situation_change_SH_12b == "To drop" |
                    living_situation_change_SH_13a == "To drop" |
                      living_situation_change_SH_14b == "To drop" |
                    living_situation_change_SH_15a == "To drop" |
                      living_situation_change_SH_16b == "To drop" |
                    living_situation_change_SH_17a == "To drop" ~ "Change in living situation after self-harm",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm == "Not answered or PNTA" ~ "Missing whether experienced self-harm", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_SH_baseline == "Yes" |
                    living_situation_change_SH_1a == "Yes" |
                    living_situation_change_SH_1b == "Yes" |
                    living_situation_change_SH_2a == "Yes" |
                    living_situation_change_SH_2b == "Yes" |
                    living_situation_change_SH_3a == "Yes" |
                    living_situation_change_SH_3b == "Yes" |
                    living_situation_change_SH_4a == "Yes" |
                    living_situation_change_SH_4b == "Yes" |
                    living_situation_change_SH_5a == "Yes" |
                    living_situation_change_SH_6b == "Yes" |
                    living_situation_change_SH_7a == "Yes" |
                    living_situation_change_SH_8b == "Yes" |
                    living_situation_change_SH_9a == "Yes" |
                    living_situation_change_SH_10b == "Yes" |
                    living_situation_change_SH_11a == "Yes" |
                    living_situation_change_SH_12b == "Yes" |
                    living_situation_change_SH_13a == "Yes" |
                    living_situation_change_SH_14b == "Yes" |
                    living_situation_change_SH_15a == "Yes" |
                    living_situation_change_SH_16b == "Yes" |
                    living_situation_change_SH_17a == "Yes"~ "Change in living situation before self-harm",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_SH_baseline == "No outcome" |
                    living_situation_change_SH_1a == "No outcome" |
                    living_situation_change_SH_1b == "No outcome" |
                    living_situation_change_SH_2a == "No outcome" |
                    living_situation_change_SH_2b == "No outcome" |
                    living_situation_change_SH_3a == "No outcome" |
                    living_situation_change_SH_3b == "No outcome" |
                    living_situation_change_SH_4a == "No outcome" |
                    living_situation_change_SH_4b == "No outcome" |
                    living_situation_change_SH_5a == "No outcome" |
                    living_situation_change_SH_6b == "No outcome" |
                    living_situation_change_SH_7a == "No outcome" |
                    living_situation_change_SH_8b == "No outcome" |
                    living_situation_change_SH_9a == "No outcome" |
                    living_situation_change_SH_10b == "No outcome" |
                    living_situation_change_SH_11a == "No outcome" |
                    living_situation_change_SH_12b == "No outcome" |
                    living_situation_change_SH_13a == "No outcome" |
                    living_situation_change_SH_14b == "No outcome" |
                    living_situation_change_SH_15a == "No outcome" |
                    living_situation_change_SH_16b == "No outcome" |
                    living_situation_change_SH_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_selfharm != "Not answered or PNTA" |
                        outcome_phase_selfharm != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_selfharm  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_SH) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_SH_final =
           case_when(living_situation_change_before_SH == "Change in living situation after self-harm" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_SH == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_SH == "Missing whether experienced self-harm" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                       living_situation_change_before_SH ==  "Outcome but no exposure" |
                     living_situation_change_before_SH ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_SH == "Exposure but no outcome" |
                    living_situation_change_before_SH == "Change in living situation before self-harm" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_SH_final) 
```

# Saving dataset
## FOR NOW - select & save variables needed for interim analysis
```{r Select final variables ready for regression analyses}
test_dat <- dat %>%
  select(ID,
         cohort_name,
         NEW_binge_eating_pandemic,
         NEW_low_weight_pandemic,
         PREPANDEMIC_passive_suicidal_ideation,
         passive_suicidal_ideation_PANDEMIC,
         PREPANDEMIC_selfharm_ideation,
         selfharm_ideation_PANDEMIC,
         PREPANDEMIC_selfharm,
         selfharm_PANDEMIC,
         age_category_COVID_baseline,
         gender_cleaned,
         sex_binary_numeric,
         race_binary,
         A_Levels_higher,
         psych_disorder_factor,
         employed_key,
         vulnerable_group_member,
         positive_covid_test_before_BE_merged,
         positive_covid_test_before_LW_merged,
         positive_covid_test_before_PSS_merged,
         positive_covid_test_before_SHI_merged,
         positive_covid_test_before_SH_merged,
         panworry_total_score_percent,
         panworry_factor,
        lost_someone_before_BE_final,
        lost_someone_before_LW_final,
        lost_someone_before_PSS_final,
        lost_someone_before_SHI_final,
        lost_someone_before_SH_final,
         increased_loneliness_during_pandemic,
        main_eco_change_before_BE_final,
        main_eco_change_before_LW_final,
        main_eco_change_before_PSS_final,
        main_eco_change_before_SHI_final,
        main_eco_change_before_SH_final,
        living_situation_change_before_BE_final,
        living_situation_change_before_LW_final,
        living_situation_change_before_PSS_final,
        living_situation_change_before_SHI_final,
        living_situation_change_before_SH_final,
        outcome_phase_binge_eating,
        outcome_phase_low_weight
 )
```

Save final dataset (interim analysis)
Save dataset
```{r}
saveRDS(object = test_dat,
       file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/test_dat", date, ".rds"))

```




