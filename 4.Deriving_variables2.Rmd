---
title: "Deriving variables V2"
author: "Helena Davies"
date: "24/05/2021"
output: html_document
---

This script derives variables ready for regression analyses.

# Set up
```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

Call in library script
```{r Source libary}
source("./libraries.R")
```

Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

Call in R functions script
```{r Source functions}
source("./functions.R")
```

# Read in data
## data.final is generated from the "3.Merging" script
```{r Read in data}
dat <- readRDS(file = "../data_cleaned/dat.final2021-06-30.rds")

# Check
dim(dat)
colnames(dat)
```

OUTCOMES

•	NEW Eating disorder behaviour:
    o	binge eating during the COVID-19 pandemic: binary (1,0)
    o	low weight during the COVID-19 pandemic: binary (1,0)

•	NEW Self-harm thoughts/behaviour:
    o	passive suicidal ideation during COVID-19 pandemic: binary (1,0)
    o	self-harm ideation during the COVID-19 pandemic: binary (1,0)
    o	self-harm during the COVID-19 pandemic: binary (1,0)

•	Frequency of all the above behaviors:

o	Cumulative score; 
    	scores of 3 indicate someone has experienced all of the above during the pandemic
    	scores of 2 indicate someone has experienced two of the above during the pandemic
    	scores of 1 indicate someone has experienced one of the above during the pandemic
    	scores of 0 indicate someone has experienced none of the above during the pandemic

# Outcome = Binge eating
## Derive ANY Binge eating during the COVID-19 pandemic
```{r Derive any binge eating during the pandemic}

dat <- dat %>%
  mutate(pandemic_binge_eating =
           case_when(ed_scid5.regular_episodes_eating_binges_.Wave_1b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_2b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_3b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_4b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_6b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_8b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_10b == "Yes" |
                       ed_scid5.regular_episodes_eating_binges_.Wave_12b == "Yes" ~ 1, # Answered yes at least once to the binge eating screener
                     
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_1b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_2b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_3b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_4b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_6b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_8b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_10b) &
                       is.na(ed_scid5.regular_episodes_eating_binges_.Wave_12b) ~ NA_real_, # Captures anyone who did not answer any of the binge eating screeners at any phase
                     
                      (ed_scid5.regular_episodes_eating_binges_.Wave_1b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_1b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_2b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_2b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_3b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_3b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_4b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_4b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_6b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_6b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_8b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_8b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_10b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_10b)) &
                       (ed_scid5.regular_episodes_eating_binges_.Wave_12b == "No" | is.na(ed_scid5.regular_episodes_eating_binges_.Wave_12b)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

# Check
dat %>%
  freq(pandemic_binge_eating)
```

NEW binge eating experience, i.e., those who at baseline indicated no lifetime experience of binge eating
```{r Derive NEW binge eating experience}

dat <- dat %>%
  mutate(NEW_binge_eating_pandemic =
           case_when(lifetime_binge_eating_baseline_numeric == 0 & # No lifetime binge eating at baseline, but occured at least once during the pandemic
                     pandemic_binge_eating == 1 ~ 1,
                     
                     lifetime_binge_eating_baseline_numeric == 0 &  # No lifetime binge eating at baseline, and no binge eating during the pandemic
                     pandemic_binge_eating == 0 ~ 0
           )
  )

dat %>%
  freq(NEW_binge_eating_pandemic) # NAs are because the sample is restricted to those who did NOT report binge eating at baseline

```

# Outcome = Low weight
## Derive ANY low weight during the COVID-19 pandemic
```{r Derive ANY low weight during pandemic}

dat <- dat %>%
  mutate(pandemic_low_weight =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes" ~ 1, # Answered yes at least once to the low weight screener
                     
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) ~ NA_real_, # Captures anyone who did not answer any of the low weight screeners at any phase
                     
                       (ed_scid5.weigh_weighed_past_month_.Wave_1b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_2b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_3b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_4b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_6b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_8b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_10b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b)) &
                       (ed_scid5.weigh_weighed_past_month_.Wave_12b == "No" | is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

#Check
dat %>%
  freq(pandemic_low_weight)

```

NEW low weight experience, i.e., those who at baseline indicated no lifetime experience of binge eating
```{r Derive NEW low weight experience during pandemic}

dat <- dat %>%
  mutate(NEW_low_weight_pandemic =
           case_when(lifetime_low_weight_baseline_numeric == 0 & #No lifetime low weight at baseline, but occured at least once during the pandemic
                     pandemic_low_weight == 1 ~ 1,
                     
                     lifetime_low_weight_baseline_numeric == 0 &  #No lifetime low weight at baseline, and no low weight during the pandemic
                     pandemic_low_weight == 0 ~ 0
            )
  )

dat %>%
  freq(NEW_low_weight_pandemic) # NAs are because the sample is restricted to those who did NOT report low weight at baseline
```

# Outcome = Passive suicidal ideation
## Derive ANY passive suicidal ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Many people have thoughts that life is not worth living. Have you felt that way in the past two weeks?"
```{r Passive suicdal ideation in the past two weeks}

dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation =
           case_when(
                     taf.felt_weeks_past_.Wave_1a == "Yes" |
                       taf.felt_weeks_past_.Wave_1b == "Yes" |
                       taf.felt_weeks_past_.Wave_2a == "Yes" |
                       taf.felt_weeks_past_.Wave_2b == "Yes" |
                       taf.felt_weeks_past_.Wave_3a == "Yes" |
                       taf.felt_weeks_past_.Wave_3b == "Yes" |
                       taf.felt_weeks_past_.Wave_4a == "Yes" |
                       taf.felt_weeks_past_.Wave_4b == "Yes" |
                       taf.felt_weeks_past_.Wave_5a == "Yes" |
                       taf.felt_weeks_past_.Wave_6b == "Yes" |
                       taf.felt_weeks_past_.Wave_7a == "Yes" |
                       taf.felt_weeks_past_.Wave_8b == "Yes" |
                       taf.felt_weeks_past_.Wave_9a == "Yes" |
                       taf.felt_weeks_past_.Wave_10b == "Yes" |
                       taf.felt_weeks_past_.Wave_11a == "Yes" |
                       taf.felt_weeks_past_.Wave_12b == "Yes" ~ 1, # Said 'Yes' at least once during the pandemic
                        
              
                       is.na(taf.felt_weeks_past_.Wave_1a) &
                       is.na(taf.felt_weeks_past_.Wave_1b) &
                       is.na(taf.felt_weeks_past_.Wave_2a) &
                       is.na(taf.felt_weeks_past_.Wave_2b) &
                       is.na(taf.felt_weeks_past_.Wave_3a) &
                       is.na(taf.felt_weeks_past_.Wave_3b) &
                       is.na(taf.felt_weeks_past_.Wave_4a) &
                       is.na(taf.felt_weeks_past_.Wave_4b) &
                       is.na(taf.felt_weeks_past_.Wave_5a) &
                       is.na(taf.felt_weeks_past_.Wave_6b) &
                       is.na(taf.felt_weeks_past_.Wave_7a) &
                       is.na(taf.felt_weeks_past_.Wave_8b) &
                       is.na(taf.felt_weeks_past_.Wave_9a) &
                       is.na(taf.felt_weeks_past_.Wave_10b) &
                       is.na(taf.felt_weeks_past_.Wave_11a) &
                       is.na(taf.felt_weeks_past_.Wave_12b) ~ NA_real_, # Captures anyone who did not answer any of the passive suicidal questions at any phase
                     
                      
                       (taf.felt_weeks_past_.Wave_1a == "No" | is.na(taf.felt_weeks_past_.Wave_1a)) &
                       (taf.felt_weeks_past_.Wave_1b == "No" | is.na(taf.felt_weeks_past_.Wave_1b)) &
                       (taf.felt_weeks_past_.Wave_2a == "No" | is.na(taf.felt_weeks_past_.Wave_2a)) &
                       (taf.felt_weeks_past_.Wave_2b == "No" | is.na(taf.felt_weeks_past_.Wave_2b)) &
                       (taf.felt_weeks_past_.Wave_3a == "No" | is.na(taf.felt_weeks_past_.Wave_3a)) &
                       (taf.felt_weeks_past_.Wave_3b == "No" | is.na(taf.felt_weeks_past_.Wave_3b)) &
                       (taf.felt_weeks_past_.Wave_4a == "No" | is.na(taf.felt_weeks_past_.Wave_4a)) &
                       (taf.felt_weeks_past_.Wave_4b == "No" | is.na(taf.felt_weeks_past_.Wave_4b)) &
                       (taf.felt_weeks_past_.Wave_5a == "No" | is.na(taf.felt_weeks_past_.Wave_5a)) &
                       (taf.felt_weeks_past_.Wave_6b == "No" | is.na(taf.felt_weeks_past_.Wave_6b)) &
                       (taf.felt_weeks_past_.Wave_7a == "No" | is.na(taf.felt_weeks_past_.Wave_7a)) &
                       (taf.felt_weeks_past_.Wave_8b == "No" | is.na(taf.felt_weeks_past_.Wave_8b)) &
                       (taf.felt_weeks_past_.Wave_9a == "No" | is.na(taf.felt_weeks_past_.Wave_9a)) &
                       (taf.felt_weeks_past_.Wave_10b == "No" | is.na(taf.felt_weeks_past_.Wave_10b)) &
                       (taf.felt_weeks_past_.Wave_11a == "No" | is.na(taf.felt_weeks_past_.Wave_11a)) &
                       (taf.felt_weeks_past_.Wave_12b == "No" | is.na(taf.felt_weeks_past_.Wave_12b)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)
```

### Experience ever
In the follow ups, participants are also asked: "Many people have thoughts that life is not worth living. Have you felt that way". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Passive suicidal ideation ever}

# Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_passive_suicidal_ideation =
           case_when(
                     taf.worth_living_life_people_.Wave_1a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, once" |
                       
                       taf.worth_living_life_people_.Wave_1a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, more than once" ~ 1, # Answered yes at least once
                        
              
                       is.na(taf.worth_living_life_people_.Wave_1a) &
                       is.na(taf.worth_living_life_people_.Wave_1b) &
                       is.na(taf.worth_living_life_people_.Wave_2a) &
                       is.na(taf.worth_living_life_people_.Wave_2b) &
                       is.na(taf.worth_living_life_people_.Wave_3a) &
                       is.na(taf.worth_living_life_people_.Wave_3b) &
                       is.na(taf.worth_living_life_people_.Wave_4a) &
                       is.na(taf.worth_living_life_people_.Wave_4b) &
                       is.na(taf.worth_living_life_people_.Wave_5a) &
                       is.na(taf.worth_living_life_people_.Wave_6b) &
                       is.na(taf.worth_living_life_people_.Wave_7a) &
                       is.na(taf.worth_living_life_people_.Wave_8b) &
                       is.na(taf.worth_living_life_people_.Wave_9a) &
                       is.na(taf.worth_living_life_people_.Wave_10b) &
                       is.na(taf.worth_living_life_people_.Wave_11a) &
                       is.na(taf.worth_living_life_people_.Wave_12b) ~ NA_real_, # Captures those missing at every phase
                     
                      
                       (taf.worth_living_life_people_.Wave_1a == "No" | is.na(taf.worth_living_life_people_.Wave_1a)) &
                       (taf.worth_living_life_people_.Wave_1b == "No" | is.na(taf.worth_living_life_people_.Wave_1b)) &
                       (taf.worth_living_life_people_.Wave_2a == "No" | is.na(taf.worth_living_life_people_.Wave_2a)) &
                       (taf.worth_living_life_people_.Wave_2b == "No" | is.na(taf.worth_living_life_people_.Wave_2b)) &
                       (taf.worth_living_life_people_.Wave_3a == "No" | is.na(taf.worth_living_life_people_.Wave_3a)) &
                       (taf.worth_living_life_people_.Wave_3b == "No" | is.na(taf.worth_living_life_people_.Wave_3b)) &
                       (taf.worth_living_life_people_.Wave_4a == "No" | is.na(taf.worth_living_life_people_.Wave_4a)) &
                       (taf.worth_living_life_people_.Wave_4b == "No" | is.na(taf.worth_living_life_people_.Wave_4b)) &
                       (taf.worth_living_life_people_.Wave_5a == "No" | is.na(taf.worth_living_life_people_.Wave_5a)) &
                       (taf.worth_living_life_people_.Wave_6b == "No" | is.na(taf.worth_living_life_people_.Wave_6b)) &
                       (taf.worth_living_life_people_.Wave_7a == "No" | is.na(taf.worth_living_life_people_.Wave_7a)) &
                       (taf.worth_living_life_people_.Wave_8b == "No" | is.na(taf.worth_living_life_people_.Wave_8b)) &
                       (taf.worth_living_life_people_.Wave_9a == "No" | is.na(taf.worth_living_life_people_.Wave_9a)) &
                       (taf.worth_living_life_people_.Wave_10b == "No" | is.na(taf.worth_living_life_people_.Wave_10b)) &
                       (taf.worth_living_life_people_.Wave_11a == "No" | is.na(taf.worth_living_life_people_.Wave_11a)) &
                       (taf.worth_living_life_people_.Wave_12b == "No" | is.na(taf.worth_living_life_people_.Wave_12b)) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           ))

# Check
dat %>%
  freq(EVER_PANDEMIC_passive_suicidal_ideation)
```

### Baseline passive suicidal ideation
At baseline, participants are also asked whether they have experienced passive suicidal ideation in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.
taf.felt_weeks_past_.Wavebaseline = Many people have thoughts that life is not worth living. Have you felt that way in the past two weeks?
```{r Passive suicidal ideation baseline experience past two weeks}
dat <- dat %>%
  mutate(baseline_passive_suicidal_ideation =
           case_when(
                    taf.felt_weeks_past_.Wavebaseline == "No" ~ 0, # Not experienced in past two weeks
                    taf.felt_weeks_past_.Wavebaseline == "Yes" ~ 1 # Experienced in past two weeks
               )
  )

# Check 
dat %>%
  freq(baseline_passive_suicidal_ideation)
```

### PREPANDEMIC passive suicidal ideation 
At baseline, participants are first asked: "Many people have thoughts that life is not worth living. Have you felt that way?" (taf.worth_living_thoughts_life_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.
```{r Passive suicidal ideation baseline pre-pandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_passive_suicidal_ideation =
           case_when(
             
                  taf.worth_living_life_people_.Wavebaseline == "No" ~ 0, # Never experienced it (lifetime)
                  
                    taf.pandemic_felt_.Wavebaseline == "No" ~ 0, # Have in their life but not before the pandemic
                    taf.pandemic_felt_.Wavebaseline == "Yes" ~ 1 # Have in their life AND before the pandemic
                  )
                      
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_passive_suicidal_ideation)
```


Combined - passive suicidal ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)
```{r Combine pandemic and baseline experience into pandemic experience}
dat <- dat %>%
  mutate(passive_suicidal_ideation_PANDEMIC =
           case_when(
             
             (TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1 | # Experience DURING pandemic (answered yes to 2 week question during pandemic) OR
                EVER_PANDEMIC_passive_suicidal_ideation == 1 ) ~ 1, # Experience DURING pandemic (answered yes to EVER question during pandemic)
           
             baseline_passive_suicidal_ideation == 1 ~ 1, # Experience DURING pandemic (indicated at baseline)

          baseline_passive_suicidal_ideation == 0 |
             EVER_PANDEMIC_passive_suicidal_ideation == 0 ~ 0, # Baseline never experienced, and/or NO to EVER experiencing at ANY phase (people who have endorsed it EVER during the pandemic will be captured above, so this can be an OR rather than an AND, i.e., we will allow it if some people are NA for one)
           )
  )

# Check
dat %>%
  freq(passive_suicidal_ideation_PANDEMIC)

```


# Outcome = Self-harm ideation
## Derive ANY self-harm ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Have you contemplated harming yourself?" [If "Yes"] then asked "Have you felt that way in the past two weeks?" (taf.felt_weeks_past.1_.Wave_1a etc)
```{r Self-harm ideation ANY past two weeks pandemic}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_selfharm_ideation =
           case_when(
             taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_12b == "Yes" ~ 1, # Said "Yes" at any point to the two week question
                        
              
                       is.na(taf.felt_weeks_past.1_.Wave_1a) &
                       is.na(taf.felt_weeks_past.1_.Wave_1b) &
                       is.na(taf.felt_weeks_past.1_.Wave_2a) &
                       is.na(taf.felt_weeks_past.1_.Wave_2b) &
                       is.na(taf.felt_weeks_past.1_.Wave_3a) &
                       is.na(taf.felt_weeks_past.1_.Wave_3b) &
                       is.na(taf.felt_weeks_past.1_.Wave_4a) &
                       is.na(taf.felt_weeks_past.1_.Wave_4b) &
                       is.na(taf.felt_weeks_past.1_.Wave_5a) &
                       is.na(taf.felt_weeks_past.1_.Wave_6b) &
                       is.na(taf.felt_weeks_past.1_.Wave_7a) &
                       is.na(taf.felt_weeks_past.1_.Wave_8b) &
                       is.na(taf.felt_weeks_past.1_.Wave_9a) &
                       is.na(taf.felt_weeks_past.1_.Wave_10b) &
                       is.na(taf.felt_weeks_past.1_.Wave_11a) &
                       is.na(taf.felt_weeks_past.1_.Wave_12b) ~ NA_real_, # NA for all waves (i.e., never answered the two week question during the pandemic)
                     
                      
                       (taf.felt_weeks_past.1_.Wave_1a == "No" | is.na(taf.felt_weeks_past.1_.Wave_1a)) &
                       (taf.felt_weeks_past.1_.Wave_1b == "No" | is.na(taf.felt_weeks_past.1_.Wave_1b)) &
                       (taf.felt_weeks_past.1_.Wave_2a == "No" | is.na(taf.felt_weeks_past.1_.Wave_2a)) &
                       (taf.felt_weeks_past.1_.Wave_2b == "No" | is.na(taf.felt_weeks_past.1_.Wave_2b)) &
                       (taf.felt_weeks_past.1_.Wave_3a == "No" | is.na(taf.felt_weeks_past.1_.Wave_3a)) &
                       (taf.felt_weeks_past.1_.Wave_3b == "No" | is.na(taf.felt_weeks_past.1_.Wave_3b)) &
                       (taf.felt_weeks_past.1_.Wave_4a == "No" | is.na(taf.felt_weeks_past.1_.Wave_4a)) &
                       (taf.felt_weeks_past.1_.Wave_4b == "No" | is.na(taf.felt_weeks_past.1_.Wave_4b)) &
                       (taf.felt_weeks_past.1_.Wave_5a == "No" | is.na(taf.felt_weeks_past.1_.Wave_5a)) &
                       (taf.felt_weeks_past.1_.Wave_6b == "No" | is.na(taf.felt_weeks_past.1_.Wave_6b)) &
                       (taf.felt_weeks_past.1_.Wave_7a == "No" | is.na(taf.felt_weeks_past.1_.Wave_7a)) &
                       (taf.felt_weeks_past.1_.Wave_8b == "No" | is.na(taf.felt_weeks_past.1_.Wave_8b)) &
                       (taf.felt_weeks_past.1_.Wave_9a == "No" | is.na(taf.felt_weeks_past.1_.Wave_9a)) &
                       (taf.felt_weeks_past.1_.Wave_10b == "No" | is.na(taf.felt_weeks_past.1_.Wave_10b)) &
                       (taf.felt_weeks_past.1_.Wave_11a == "No" | is.na(taf.felt_weeks_past.1_.Wave_11a)) &
                       (taf.felt_weeks_past.1_.Wave_12b == "No" | is.na(taf.felt_weeks_past.1_.Wave_12b)) ~ 0 # Said "No" at least once and did not say "Yes" once
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)
```

### Experience ever
In the follow ups, participants are also asked lifetime self-harm ideation: "Have you contemplated harming yourself?". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Self-harm ideation EVER pandemic}
#Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_selfharm_ideation =
           case_when(
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                       
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" ~ 1, # "Yes" at at least one phase
                       
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) ~ NA_real_, # Missing at every phase
                     
                      
                       (taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_12b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b)) ~ 0 # "No" at least once and never said "Yes"
                    
           ))

#Check
dat %>%
  freq(EVER_PANDEMIC_selfharm_ideation)
```

### Baseline self-harm ideation
At baseline, participants are also asked whether they have experienced self-harm ideation in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.

taf.felt_weeks_past.1_.Wavebaseline = Have you contemplated harming yourself...in the past two weeks?
```{r Self-harm ideation baseline experience past two weeks}
dat <- dat %>%
  mutate(baseline_selfharm_ideation =
           case_when(
                    taf.felt_weeks_past.1_.Wavebaseline == "No" ~ 0, # Not experienced in the past two weeks
                    taf.felt_weeks_past.1_.Wavebaseline == "Yes" ~ 1 # Experienced in the past two weeks
             )
  )

# Check 
dat %>%
  freq(baseline_selfharm_ideation)
```

### PREPANDEMIC self-harm ideation 
At baseline, participants are first asked: "Have you contemplated harming yourself ?" (taf.have_you_contemplated_harming_yourself_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt.1_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.

```{r Self-harm ideation prepandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_ideation =
           case_when(
                     taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" ~ 0, # Never experienced it in their life
                     
                     taf.pandemic_felt.1_.Wavebaseline == "No" ~ 0, # Have experienced it in their life but not before the pandemic
                     taf.pandemic_felt.1_.Wavebaseline == "Yes" ~ 1 # Have experienced it before in their life and during the pandemic
                     )
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_selfharm_ideation)
```

Combined - self-harm ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)
```{r Combined baseline self-harm ideation experience and/or follow up experience pandemic}
dat <- dat %>%
  mutate(selfharm_ideation_PANDEMIC =
           case_when(
         
             (TWO_WEEKS_PANDEMIC_selfharm_ideation == 1 | # Experience DURING pandemic (answered yes to 2 week question during pandemic)
                EVER_PANDEMIC_selfharm_ideation == 1 ) ~ 1, # Experience DURING pandemic (answered yes to EVER question during pandemic)
           
              baseline_selfharm_ideation == 1 ~ 1, # Experience DURING pandemic (indicated at baseline)
             
             baseline_selfharm_ideation == 0 |
             EVER_PANDEMIC_selfharm_ideation == 0 ~ 0 # Baseline never experienced, and/or NO to EVER experiencing at ANY phase (people who have endorsed it EVER during the pandemic will be captured above, so this can be an OR rather than an AND, i.e., we will allow it if some people are NA for one)
          )
    
  )

#Check
dat %>%
  freq(selfharm_ideation_PANDEMIC)
```

# Outcome = Self-harm 
## Derive ANY self-harm during the COVID-19 pandemic
### Experience during past two weeks 
NB: There is no 'ever' question for self-harm
```{r Self-harm experience ANY past two weeks}
dat <- dat %>%
mutate(TWO_WEEKS_PANDEMIC_selfharm =
           case_when(
                     taf.meant_life_end_weeks_.Wave_1a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_1b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_2a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_2b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_3a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_3b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_4a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_4b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_5a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_6b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_7a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_8b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_9a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_10b == "Yes" |
                       taf.meant_life_end_weeks_.Wave_11a == "Yes" |
                       taf.meant_life_end_weeks_.Wave_12b == "Yes" ~ 1, # "Yes" at least once
                        
              
                       is.na(taf.meant_life_end_weeks_.Wave_1a) &
                       is.na(taf.meant_life_end_weeks_.Wave_1b) &
                       is.na(taf.meant_life_end_weeks_.Wave_2a) &
                       is.na(taf.meant_life_end_weeks_.Wave_2b) &
                       is.na(taf.meant_life_end_weeks_.Wave_3a) &
                       is.na(taf.meant_life_end_weeks_.Wave_3b) &
                       is.na(taf.meant_life_end_weeks_.Wave_4a) &
                       is.na(taf.meant_life_end_weeks_.Wave_4b) &
                       is.na(taf.meant_life_end_weeks_.Wave_5a) &
                       is.na(taf.meant_life_end_weeks_.Wave_6b) &
                       is.na(taf.meant_life_end_weeks_.Wave_7a) &
                       is.na(taf.meant_life_end_weeks_.Wave_8b) &
                       is.na(taf.meant_life_end_weeks_.Wave_9a) &
                       is.na(taf.meant_life_end_weeks_.Wave_10b) &
                       is.na(taf.meant_life_end_weeks_.Wave_11a) &
                       is.na(taf.meant_life_end_weeks_.Wave_12b) ~ NA_real_, # Missing at every phase
                     
                      
                       (taf.meant_life_end_weeks_.Wave_1a == "No" | is.na(taf.meant_life_end_weeks_.Wave_1a)) &
                       (taf.meant_life_end_weeks_.Wave_1b == "No" | is.na(taf.meant_life_end_weeks_.Wave_1b)) &
                       (taf.meant_life_end_weeks_.Wave_2a == "No" | is.na(taf.meant_life_end_weeks_.Wave_2a)) &
                       (taf.meant_life_end_weeks_.Wave_2b == "No" | is.na(taf.meant_life_end_weeks_.Wave_2b)) &
                       (taf.meant_life_end_weeks_.Wave_3a == "No" | is.na(taf.meant_life_end_weeks_.Wave_3a)) &
                       (taf.meant_life_end_weeks_.Wave_3b == "No" | is.na(taf.meant_life_end_weeks_.Wave_3b)) &
                       (taf.meant_life_end_weeks_.Wave_4a == "No" | is.na(taf.meant_life_end_weeks_.Wave_4a)) &
                       (taf.meant_life_end_weeks_.Wave_4b == "No" | is.na(taf.meant_life_end_weeks_.Wave_4b)) &
                       (taf.meant_life_end_weeks_.Wave_5a == "No" | is.na(taf.meant_life_end_weeks_.Wave_5a)) &
                       (taf.meant_life_end_weeks_.Wave_6b == "No" | is.na(taf.meant_life_end_weeks_.Wave_6b)) &
                       (taf.meant_life_end_weeks_.Wave_7a == "No" | is.na(taf.meant_life_end_weeks_.Wave_7a)) &
                       (taf.meant_life_end_weeks_.Wave_8b == "No" | is.na(taf.meant_life_end_weeks_.Wave_8b)) &
                       (taf.meant_life_end_weeks_.Wave_9a == "No" | is.na(taf.meant_life_end_weeks_.Wave_9a)) &
                       (taf.meant_life_end_weeks_.Wave_10b == "No" | is.na(taf.meant_life_end_weeks_.Wave_10b)) &
                       (taf.meant_life_end_weeks_.Wave_11a == "No" | is.na(taf.meant_life_end_weeks_.Wave_11a)) &
                       (taf.meant_life_end_weeks_.Wave_12b == "No" | is.na(taf.meant_life_end_weeks_.Wave_12b)) ~ 0 # Said "No" to at least one phase and never said "Yes"
                    
           ))
                    
   
# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm)
```

### Baseline self-harm 
At baseline, participants are also asked whether they have experienced self-harm in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.

taf.meant_life_end_weeks_.Wavebaseline = In the last two weeks, have you deliberately harmed yourself, whether or not you meant to end your life? (at baseline)
```{r Baseline self-harm experience last two weeks}
dat <- dat %>%
  mutate(baseline_pandemic_selfharm =
           case_when(
             
              taf.meant_life_end_weeks_.Wavebaseline ==  "Yes" ~  1, # Self harmed during past two weeks (at baseline)
              taf.meant_life_end_weeks_.Wavebaseline == "No" ~ 0) # Not self harmed during past two weeks (at baseline)
               
              )

# Check 
dat %>%
  freq(baseline_pandemic_selfharm)
```

### PREPANDEMIC self-harm 
At baseline, participants are asked: "Before the pandemic, had you deliberately harmed yourself, whether or not you meant to end your life?" (taf.meant_end_life_pandemic_.Wavebaseline). Note again, there is no lifetime assessment of self-harm.
```{r Prepandemic self-harm experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm =
           case_when(
                    taf.meant_life_end_weeks_.Wavebaseline == "No" ~ 0, # Not experienced self-harm before the pandemic
                    taf.meant_life_end_weeks_.Wavebaseline == "Yes" ~ 1 # Experienced self-harm during the pandemic 
            )
  )

# Check 
dat %>%
  freq(PREPANDEMIC_selfharm)
```

Combined - self-harm ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)

NB: This question "Before the pandemic, had you deliberately harmed yourself, whether or not you meant to end your life?" is shown to everyone, so I don't need to use the same logic as with the other baseline questions (i.e., there is no screener question that asks about lifetime self-harm: "Have you deliberately harmed yourself, whether or not you meant to end your life?) 
```{r Combined self-harm baseline and follow up experience}
dat <- dat %>%
  mutate(selfharm_PANDEMIC =
           case_when(
            baseline_pandemic_selfharm == 1 ~ 1, # Experience DURING pandemic (indicated at baseline)
             
            TWO_WEEKS_PANDEMIC_selfharm == 1 ~ 1,# Experienced DURING pandemic (answered yes to 2 week question during pandemic)
                     
            baseline_pandemic_selfharm == 0 |  
            TWO_WEEKS_PANDEMIC_selfharm == 0 ~ 0 # Had not experienced at baseline (in the last two weeks) and had not indicated experiencing at any follow up phase. NB: Because there is no lifetime assessment of self-harm, there might be some people who joined the study later (e.g., in November 2020) and had self-harmed earlier in the pandemic (e.g., July) but we would not capture them.
                     
           )
  )

# Check
dat %>%
  freq(selfharm_PANDEMIC)
```
# Identify at which phase they experienced the outcome
Exposure must come before the outcome. Need to identify at which wave participants experienced each outcome, to ensure that their experience of the exposure happened BEFORE the outcome.

Binge eating
```{r Identify phase at which outcome first experienced - binge eating}

dat <- dat %>%
  mutate(outcome_phase_binge_eating =
           case_when(ed_scid5.regular_episodes_eating_binges_.Wave_1b == "Yes" ~ "1b",
                       ed_scid5.regular_episodes_eating_binges_.Wave_2b == "Yes" ~ "2b",
                       ed_scid5.regular_episodes_eating_binges_.Wave_3b == "Yes" ~ "3b",
                       ed_scid5.regular_episodes_eating_binges_.Wave_4b == "Yes" ~ "4b",
                       ed_scid5.regular_episodes_eating_binges_.Wave_6b == "Yes" ~ "6b",
                       ed_scid5.regular_episodes_eating_binges_.Wave_8b == "Yes" ~ "8b",
                       ed_scid5.regular_episodes_eating_binges_.Wave_10b == "Yes" ~ "10b",
                       ed_scid5.regular_episodes_eating_binges_.Wave_12b == "Yes" ~ "12b"
           )
  )

# Check
dat %>%
  freq(outcome_phase_binge_eating)
```

Low weight
```{r Identify phase at which outcome first experienced - low weight}

dat <- dat %>%
  mutate(outcome_phase_low_weight =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes" ~ "1b",
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes" ~ "2b",
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes" ~ "3b",
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes" ~ "4b",
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes" ~ "6b",
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes" ~ "8b",
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes" ~ "10b",
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes" ~ "12b"
           )
  )

# Check
dat %>%
  freq(outcome_phase_low_weight)
```

Passive suicidal ideation
```{r Identify phase at which outcome first experienced - passive suicidal ideation}

dat <- dat %>%
  mutate(outcome_phase_passive_suicidal_ideation =
           case_when(taf.felt_weeks_past_.Wave_1a == "Yes" |
                      taf.worth_living_life_people_.Wave_1a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_1a == "Yes, more than once" ~ "1a",
                       
                     
                       taf.felt_weeks_past_.Wave_1b == "Yes" |
                      taf.worth_living_life_people_.Wave_1b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_1b == "Yes, more than once" ~ "1b", 
                     
                     taf.felt_weeks_past_.Wave_2b == "Yes" |
                      taf.worth_living_life_people_.Wave_2b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_2b == "Yes, more than once" ~ "2b",
                      
                     taf.felt_weeks_past_.Wave_3a == "Yes" |
                      taf.worth_living_life_people_.Wave_3a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_3a == "Yes, more than once" ~ "3a",
                     
                     taf.felt_weeks_past_.Wave_3b == "Yes" |
                      taf.worth_living_life_people_.Wave_3b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_3b == "Yes, more than once" ~ "3b",
                     
                     taf.felt_weeks_past_.Wave_4a == "Yes" |
                      taf.worth_living_life_people_.Wave_4a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_4a == "Yes, more than once" ~ "4a",
                     
                     taf.felt_weeks_past_.Wave_4b == "Yes" |
                      taf.worth_living_life_people_.Wave_4b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_4b == "Yes, more than once" ~ "4b",
                     
                     taf.felt_weeks_past_.Wave_5a == "Yes" |
                      taf.worth_living_life_people_.Wave_5a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_5a == "Yes, more than once" ~ "5a",
                     
                     taf.felt_weeks_past_.Wave_6b == "Yes" |
                      taf.worth_living_life_people_.Wave_6b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_6b == "Yes, more than once" ~ "6b",
                     
                     taf.felt_weeks_past_.Wave_7a == "Yes" |
                      taf.worth_living_life_people_.Wave_7a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_7a == "Yes, more than once" ~ "7a",
                     
                     taf.felt_weeks_past_.Wave_8b == "Yes" |
                      taf.worth_living_life_people_.Wave_8b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_8b == "Yes, more than once" ~ "8b",
                     
                     taf.felt_weeks_past_.Wave_9a == "Yes" |
                      taf.worth_living_life_people_.Wave_9a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_9a == "Yes, more than once" ~ "9a",
                     
                     taf.felt_weeks_past_.Wave_10b == "Yes" |
                      taf.worth_living_life_people_.Wave_10b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_10b == "Yes, more than once" ~ "10b",
                   
                     
                     taf.felt_weeks_past_.Wave_11a == "Yes" |
                      taf.worth_living_life_people_.Wave_11a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_11a == "Yes, more than once" ~ "11a",
                     
                     taf.felt_weeks_past_.Wave_12b == "Yes" |
                      taf.worth_living_life_people_.Wave_12b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_12b == "Yes, more than once" ~ "12b"
                     )
         )

# Check
dat %>%
  freq(outcome_phase_passive_suicidal_ideation)

```

Self-harm ideation
```{r Identify phase at which outcome first experienced - self-harm ideation}

dat <- dat %>%
  mutate(outcome_phase_selfharm_ideation =
           case_when(taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" ~ "1a", 

                     taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" ~ "1b",
                     
                     taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" ~ "2a",
                     
                     taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" ~ "2b",
                     
                     taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" ~ "3a",
                     
                     taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" ~ "3b",
                     
                     taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" ~ "4a",
                     
                     taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" ~ "4b",
                     
                     taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" ~ "5a",
                     
                     taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" ~ "6b",
                     
                     taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" ~ "7a",
                     
                     taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" ~ "8b",
                     
                     taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" ~ "9a",
                     
                     taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" ~ "10b",
                     
                     taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" ~ "11a",
                     
                     taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" ~ "12b"
           )
  )

# Check
dat %>%
  freq(outcome_phase_selfharm_ideation)
```

Self-harm 
```{r Identify phase at which outcome first experienced - self-harm}

dat <- dat %>%
  mutate(outcome_phase_selfharm =
           case_when( taf.meant_life_end_weeks_.Wave_1a == "Yes" ~ "1a",
                       taf.meant_life_end_weeks_.Wave_1b == "Yes" ~ "1b",
                       taf.meant_life_end_weeks_.Wave_2a == "Yes" ~ "2a",
                       taf.meant_life_end_weeks_.Wave_2b == "Yes" ~ "2b",
                       taf.meant_life_end_weeks_.Wave_3a == "Yes" ~ "3a",
                       taf.meant_life_end_weeks_.Wave_3b == "Yes" ~ "3b",
                       taf.meant_life_end_weeks_.Wave_4a == "Yes" ~ "4a",
                       taf.meant_life_end_weeks_.Wave_4b == "Yes" ~ "4b",
                       taf.meant_life_end_weeks_.Wave_5a == "Yes" ~ "5a",
                       taf.meant_life_end_weeks_.Wave_6b == "Yes" ~ "6b",
                       taf.meant_life_end_weeks_.Wave_7a == "Yes" ~ "7a",
                       taf.meant_life_end_weeks_.Wave_8b == "Yes" ~ "8b",
                       taf.meant_life_end_weeks_.Wave_9a == "Yes" ~ "9a",
                       taf.meant_life_end_weeks_.Wave_10b == "Yes" ~ "10b",
                       taf.meant_life_end_weeks_.Wave_11a == "Yes" ~ "11a",
                       taf.meant_life_end_weeks_.Wave_12b == "Yes" ~ "12b"
           )
  )

# Check
dat %>%
  freq(outcome_phase_selfharm)
```


# EXPOSURES / EXPLANATORY VARIABLES
NB: For exposures assessed at baseline, I should include one model which includes 'baseline' new experiences of outcome, and another without (i.e., one with co-occuring exposure and outcome, the other with all outcomes occurring after exposure).

BASIC MODEL:
  •	Age
  •	Gender
  •	Racialised minority
  •	Highest education level 
  •	Pre-pandemic experience (for self-harm only) 
  •	Psychiatric disorder (*will do sensitivty analysis without EDs or disorders that include self-harm)
  • Key worker status 
  • Defined as vulnerable person according to Government 
  • Positive COVID test 
  • Change in economic activity
  • Change in living situation
  • Loneliness
  • Pandemic worry

  o	Sensitivity analysis; Other mental health diagnosis pre-pandemic, i.e., not ED
    	Count
    	Group (Dep, Anx, Dep+Anx, Psychotic, ADHD, ASD, PTSD)
    
  o	Sensitivity analysis: Sex

### Age
NB: RAMP and NBR can use the variable "age_category" as age was assessed only once, at COVID baseline. For GLAD and EDGI, age has been assessed twice: once at GLAD/EDGI sign up, and once at COVID baseline (COPING questionnaire baseline). For the purposes of the regression analyses, I will be using 'age at COVID assessment' i.e., age at COVID baseline (I have worked this out for GLAD and EDGI from their DOBs and their end dates for completing the COPING baseline demographics questions = age_category_COPING)
```{r Age as exposure}

# Collapse age categories of 16-18 and 19-25 to 16-25, and over 71 to 71+ (very small categories otherwise)

dat <- dat %>%
  mutate(age_category_COVID_baseline = 
           case_when(
                     
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                     age_category == "16-18" ~ "16-25"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                     age_category == "19-25" ~ "16-25"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "26-35" ~ "26-35"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "36-45" ~ "36-45"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "46-55" ~ "46-55"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "56-65" ~ "56-65"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "66-70" ~ "66-70"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "71-75" ~ "71+"),
             
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "76-80" ~ "71+"),
             
            (( cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "81-85" ~ "71+"),
            
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "86-90" ~ "71+"),
            
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "91-100" ~ "71+"),
            
             ((cohort_name == "nbr" |
               cohort_name == "ramp") &
                      age_category == "100+" ~ "71+"),
             
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                     age_category_COPING == "16-18" ~ "16-25"),
             
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                     age_category_COPING == "19-25" ~ "16-25"),
              
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "26-35" ~ "26-35"),
              
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "36-45" ~ "36-45"),
             
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "46-55" ~ "46-55"),
             
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "56-65" ~ "56-65"),
              
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "66-70" ~ "66-70"),
              
             ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "71-75" ~ "71+"),
             
            ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "76-80" ~ "71+"),
             
            ((cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "81-85" ~ "71+"),
            
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "86-90" ~ "71+"),
            
            (( cohort_name == "coping_glad" |
               cohort_name == "coping_edgi") &
                      age_category_COPING == "91-100" ~ "71+")
            )
         )

# Check
dat %>%
  freq(age_category_COVID_baseline)

# Re-order for regression analyses with largest age group as reference
dat <- dat %>%
  mutate(age_category_COVID_baseline = factor(age_category_COVID_baseline,
                       levels = c("56-65",
                                  "16-25",
                                  "26-35",
                                  "36-45",
                                  "46-55",
                                   "66-70",
                                   "71+"
                                  
                         
          )))

# Check
dat %>%
  freq(age_category_COVID_baseline)
```

### Gender
```{r Gender as exposure variable}
# Recode 
dat <- dat %>%
  mutate(gender_cleaned = 
           case_when(transgender == "Yes" ~ "Minoritised gender",
                     
                     gender_unc == "Male" ~ "Man",
                     gender_unc == "Female" ~ "Woman",
                     
                     gender_unc == "Non-binary" ~ "Minoritised gender",
                     gender_unc == "Prefer to self-define" ~ "Minoritised gender"
            )
         )

# Check
dat %>%
  freq(gender_cleaned) # NAs are people who did not answer the gender question
```

### Sex (male = 0, female = 1)
```{r Sex as exposure variable}

# Recode to binary sex
dat <- dat %>%
  mutate(sex_binary_numeric = 
           case_when(sex == "0" |
                       sex == "Male" ~ 0,
                     
                     sex == "1" |
                       sex == "Female" ~ 1,
                     
                     # NB: RAMP does not have sex, but does have whether someone is transgender
                    
                     # Non-transgender male
                      cohort_name == "ramp" &
                       gender_unc == "Male" &
                       transgender == "No" ~ 0,
                     
                     # Transgender male, assigned female at birth
                     cohort_name == "ramp" &
                       gender_unc == "Male" &
                       transgender == "Yes" ~ 1,
                     
                     # Non-transgender female
                      cohort_name == "ramp" &
                       gender_unc == "Female" &
                       transgender == "No" ~ 1,
                     
                     # Transgender female, assigned male at birth
                     cohort_name == "ramp" &
                       gender_unc == "Female" &
                       transgender == "Yes" ~ 0
                     
            )
         )

dat %>%
  freq(sex_binary_numeric)
```

### Race
```{r Race as exposure variable}

# Recode to binary
dat <- dat %>%
  mutate(race_binary = 
           case_when(ethnicity == "Mixed or multiple ethnic origins" ~ "Racially minoritised",
                      ethnicity == "Asian or Asian British" ~ "Racially minoritised",
                      ethnicity == "Black or Black British" ~ "Racially minoritised",
                      ethnicity == "Arab" ~ "Racially minoritised",
                      ethnicity == "Other" ~ "Racially minoritised",
                      ethnicity == "Other ethnic group" ~ "Racially minoritised",
                     ethnicity == "White" ~ "White"
            )
         )

# Check
dat %>%
  freq(race_binary)

# Reorder so that 'White' is reference category
dat <- dat %>%
  mutate(race_binary = factor(race_binary,
                       levels = c("White",
                                  "Racially minoritised"
                                  )))
dat %>%
  freq(race_binary)
```

### Education
This is from baseline COPING and RAMP data (i.e., not GLAD or EDGI signups, which is "highest_education_prepan"). This is to get their most recent education data.
```{r Education as exposure variable}
# Convert to binary variable to reduce number of exposure variables and maximise likelihood of models running.
dat <- dat %>%
  mutate(A_Levels_higher =
           case_when(highest_education == "No formal qualifications" ~ "No",
                     highest_education == "GCSE/CSE" ~ "No",
                     highest_education == "NVQ" ~ "No",
                       highest_education == "A-levels" ~"Yes",
                       highest_education == "University/Other professional qualifications" ~ "Yes"
             
           ))

# Check
dat %>%
  freq(A_Levels_higher)
```

### Psychiatric disorder
This is from EDGI and GLAD sign-up data, as well as data from COPING and RAMP baseline. 
```{r Psychiatric disorder as exposure}
# Covert numeric control (from the preprocessing script) to psych disorder factor
dat <- dat %>% 
  mutate(psych_disorder_factor =
           case_when(control_numeric == 1 ~ "No psychiatric disorder",
                     control_numeric == 0 ~ "Psychiatric disorder"
             
           ))
  
# Check
dat %>%
  freq(psych_disorder_factor)
```

### Employed & key worker status
I have separated out those who are a key worker (and thus employed), those who are not a key worker but are employed, those who are unemployed (and thus not a key worker), and those who are students. This is from baseline COPING and RAMP data.
```{r Employed / key-worker status as exposure}
dat <- dat %>%
  mutate(employed_key =
           case_when(key_worker == "Key worker" ~ "Yes, key", # Employed and key worker
                     
                     key_worker == "No key worker" & # Employed but not key worker
                      employed == "Employed" ~ "Yes",
                     
                     employed == "Unemployed" ~ "No", # Unemployed (and therefore not key worker)
                     
                      employed == "Student" ~ "Student" # Student (and therefore not key worker)
                     )
           )
# Check
dat %>%
  freq(employed_key)

# Re-order for regression analysis
dat <- dat %>%
  mutate(employed_key = factor(employed_key,
                       levels = c("Yes",
                                  "Yes, key",
                                  "No",
                                  "Student"
                                  )))
dat %>%
  freq(employed_key)
```

### Member of vulnerable group
This is baseline COPING and RAMP data (this is not asked at follow ups).
```{r Member of vulnerable group exposure}
# Recode / rename
dat <- dat %>%
  mutate(vulnerable_group_member =
           case_when(dem2.member_vulnerable_group == "Not I am not a member of a vulnerable group" ~ "Yes",
                     dem2.member_vulnerable_group == "I am not a member of a vulnerable group" ~ "No"
             
           ))

# Check
dat %>%
  freq(vulnerable_group_member)
```
                           
### Positive covid test
Need to ensure COVID test occurred BEFORE outcomes - create new variable for COVID test that only counts positive tests as ones that occurred BEFORE each outcome

Will also include co-occurring symptoms, but as a sensitivity analysis will get rid to further assess causal hypothesis.

Binge eating 
```{r Positve COVID test result exposure BEFORE outcome BE}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_BE_1b =
           case_when(virus.back_positive_antibodies_covid_.Wave_1b == "Yes" & # Positive COVID test at phase 1b
                       
                       (is.na(outcome_phase_binge_eating) |
                       outcome_phase_binge_eating == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "2b" |
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b") ~ "Yes",  # Not experienced binge eating before phase 1b
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_BE_2b =
           case_when(virus.back_positive_antibodies_covid_.Wave_2b == "Yes" & # Positive COVID test at phase 2b
                       
                       (is.na(outcome_phase_binge_eating) |  
                       outcome_phase_binge_eating == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "3b" |
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b") ~ "Yes", # Not experienced binge eating before phase 2b
                        
                     virus.back_positive_antibodies_covid_.Wave_2b == "Yes" &
                     outcome_phase_binge_eating == "1b"  ~ "No" # Binge eating occurred before COVID test 
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_BE_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_BE_3b =
           case_when(virus.back_positive_antibodies_covid_.Wave_3b == "Yes" & # Positive COVID test at phase 3b
                       
                       (is.na(outcome_phase_binge_eating) |
                       outcome_phase_binge_eating == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "4b" |
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b") ~ "Yes", # Not experienced binge eating before phase 3b
                    
                     virus.back_positive_antibodies_covid_.Wave_3b == "Yes" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b")  ~ "No" # Binge eating occurred before COVID test 
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_BE_4b =
           case_when(virus.back_positive_antibodies_covid_.Wave_4b == "Yes" & # Positive COVID test at phase 4b
                       
                       (is.na(outcome_phase_binge_eating) |
                       outcome_phase_binge_eating == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "6b" |
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b") ~ "Yes", # Not experienced binge eating before phase 4b
         
                     virus.back_positive_antibodies_covid_.Wave_4b == "Yes" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b")  ~ "No" # Binge eating occurred before COVID test 
                       )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_BE_6b =
           case_when(virus.back_positive_antibodies_covid_.Wave_6b == "Yes" & # Positive COVID test at phase 6b
                       
                       (is.na(outcome_phase_binge_eating) |
                          outcome_phase_binge_eating == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "8b" |
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b") ~ "Yes", # Not experienced binge eating before phase 6b
         
                       virus.back_positive_antibodies_covid_.Wave_6b == "Yes" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b")  ~ "No" # Binge eating occurred before COVID test 
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_BE_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_BE_8b =
           case_when(virus.back_positive_antibodies_covid_.Wave_8b == "Yes" & # Positive COVID test at phase 8b
                       
                       (is.na(outcome_phase_binge_eating) |
                        outcome_phase_binge_eating == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "10b" |
                       outcome_phase_binge_eating == "12b") ~ "Yes",# Not experienced binge eating before phase 8b
         
                        virus.back_positive_antibodies_covid_.Wave_8b == "Yes" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b")  ~ "No" # Binge eating occurred before COVID test 
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_BE_10b =
           case_when(virus.back_positive_antibodies_covid_.Wave_10b == "Yes" & # Positive COVID test at phase 10b
                       
                       (is.na(outcome_phase_binge_eating) |
                          outcome_phase_binge_eating == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_binge_eating == "12b") ~ "Yes", # Not experienced binge eating before phase 10b
         
                        virus.back_positive_antibodies_covid_.Wave_10b == "Yes" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b")  ~ "No" # Binge eating occurred before COVID test
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_BE_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_BE_12b =
           case_when(virus.back_positive_antibodies_covid_.Wave_12b == "Yes" & # Positive COVID test at phase 12b
                     
                       is.na(outcome_phase_binge_eating) | # Not experienced binge eating during COPING
                       outcome_phase_binge_eating == "12b"~ "Yes", # Co-occurring outcome and exposure
         
                       virus.back_positive_antibodies_covid_.Wave_12b == "Yes" &
                     (outcome_phase_binge_eating == "1b" |
                     outcome_phase_binge_eating == "2b" |
                     outcome_phase_binge_eating == "3b" |
                     outcome_phase_binge_eating == "4b" |
                     outcome_phase_binge_eating == "6b" |
                     outcome_phase_binge_eating == "8b" |
                     outcome_phase_binge_eating == "10b")  ~ "No") # Binge eating occurred before COVID test 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_BE_12b)
```

Positive COVID test BEFORE binge eating

NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ Why are first 4 waves empty?
+++ Need to double check about the people who had a positive COVID test AFTER binge eating - I've coded them as "not positive test before binge eating" is this right? or should they be NA?
+++ Also, what if someone had binge eating, then positive test, then binge eating? Does it need to be the FIRST exposure needs to come before the FIRST outcome? --> the way i have written the code is that ANY experience of exposure BEFORE outcome is counted, event after you had ALSO experienced outcome BEFORE exposure. If I wanted to keep ONLY people who experience binge eating AFTER a positive COVID test, I would need to switch the order of the case_when around in the chunk above (i.e., "No" should trump "yes")
```{r Positve COVID test result exposure BE}
dat <- dat %>%
  mutate(positive_covid_test_before_BE =
           case_when(
                      # Had at least one positive covid test BEFORE first instance of binge eating
                    positive_covid_test_BE_1b == "Yes" |
                    positive_covid_test_BE_2b == "Yes" |
                    positive_covid_test_BE_3b == "Yes" |
                    positive_covid_test_BE_4b == "Yes" |
                    positive_covid_test_BE_6b == "Yes" |
                    positive_covid_test_BE_8b == "Yes" |
                    positive_covid_test_BE_10b == "Yes" |
                    positive_covid_test_BE_12b == "Yes" ~ "Positive test before BE",
                    
                    # Not answered whether they'd taken a test
                    is.na(virus.past_surveys_include_reported_.Wave_1b) &
                    is.na(virus.past_surveys_include_reported_.Wave_2b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_3b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_4b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_6b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_8b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_10b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_12b) ~ "Missing whether taken test",
                    
                    # Positive test but AFTER first instance of binge eating
                    positive_covid_test_BE_1b == "No" |
                    positive_covid_test_BE_2b == "No" |
                    positive_covid_test_BE_3b == "No" |
                    positive_covid_test_BE_4b == "No" |
                    positive_covid_test_BE_6b == "No" |
                    positive_covid_test_BE_8b == "No" |
                    positive_covid_test_BE_10b == "No" |
                    positive_covid_test_BE_12b == "No" ~ "Positive test after BE",
                   
                    # Not had a test
                     virus.past_surveys_include_reported_.Wave_1b == "No" |
                     virus.past_surveys_include_reported_.Wave_2b == "No" |
                     virus.past_surveys_include_reported_.Wave_3b == "No" |
                     virus.past_surveys_include_reported_.Wave_4b == "No" |
                     virus.past_surveys_include_reported_.Wave_6b == "No" |
                     virus.past_surveys_include_reported_.Wave_8b == "No" |
                     virus.past_surveys_include_reported_.Wave_10b == "No" |
                     virus.past_surveys_include_reported_.Wave_12b == "No"  ~ "Not had a test",
                    
                    # Unsure/inconclusive test result 
                     virus.back_positive_antibodies_covid_.Wave_1b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_2b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_3b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_4b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_6b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_8b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_10b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_12b == "Unsure/inconclusive"  ~ "Inconclusive test",
     
                     # Negative test result 
                     virus.back_positive_antibodies_covid_.Wave_1b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_2b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_3b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_4b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_6b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_8b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_10b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_12b == "No"  ~ "Negative test"
      )
)
                   
# Checl                      
dat %>%
  freq(positive_covid_test_before_BE) 


# Create final variable of positive COVID test before BE outcome
dat <- dat %>%
  mutate(positive_covid_test_before_BE_final =
           case_when(positive_covid_test_before_BE == "Negative test" |
                     positive_covid_test_before_BE == "Not had a test" |
                     positive_covid_test_before_BE == "Inconclusive test" |
                     positive_covid_test_before_BE == "Positive test after BE"~ "No",
                     
                     positive_covid_test_before_BE == "Positive test before BE" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_BE_final) 
```

Low weight
```{r Positve COVID test result exposure BEFORE outcome LOW WEIGHT}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_LW_1b =
           case_when(virus.back_positive_antibodies_covid_.Wave_1b == "Yes" & # Positive COVID test at phase 1b
                       
                       (is.na(outcome_phase_low_weight) |
                       outcome_phase_low_weight == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b") ~ "Yes") # Not experienced low weight before phase 1b
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_LW_2b =
           case_when(virus.back_positive_antibodies_covid_.Wave_2b == "Yes" & # Positive COVID test at phase 2b
                       
                       (is.na(outcome_phase_low_weight) |
                       outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b") ~ "Yes", # Not experienced low weight before phase 2b
                     
                     virus.back_positive_antibodies_covid_.Wave_2b == "Yes" &
                     outcome_phase_low_weight == "1b"  ~ "No" # Low weight occurred before COVID test 
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_LW_3b =
           case_when(virus.back_positive_antibodies_covid_.Wave_3b == "Yes" & # Positive COVID test at phase 3b
                       
                       (is.na(outcome_phase_low_weight) |
                       outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b") ~ "Yes", # Not experienced low weight before phase 3b
                     
                     virus.back_positive_antibodies_covid_.Wave_3b == "Yes" &
                     (outcome_phase_low_weight == "1b"  |
                     outcome_phase_low_weight == "2b")  ~ "No" # Low weight occurred before COVID test
                     )
         )
  
# Check
dat %>%
  freq(positive_covid_test_LW_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_LW_4b =
           case_when(virus.back_positive_antibodies_covid_.Wave_4b == "Yes" & # Positive COVID test at phase 4b
                       
                       (is.na(outcome_phase_low_weight) |
                       outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b") ~ "Yes", # Not experienced low weight before phase 4b
                     
                     virus.back_positive_antibodies_covid_.Wave_4b == "Yes" &
                     (outcome_phase_low_weight == "1b"  |
                     outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b")  ~ "No" # Low weight occurred before COVID test
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_LW_6b =
           case_when(virus.back_positive_antibodies_covid_.Wave_6b == "Yes" & # Positive COVID test at phase 6b
                       
                       (is.na(outcome_phase_low_weight) |
                       outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b") ~ "Yes", # Not experienced low weight before phase 6b
                     
                     virus.back_positive_antibodies_covid_.Wave_6b == "Yes" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b")  ~ "No" # Low weight occurred before COVID test
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_LW_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_LW_8b =
           case_when(virus.back_positive_antibodies_covid_.Wave_8b == "Yes" & # Positive COVID test at phase 8b
                       
                       (is.na(outcome_phase_low_weight) |
                       outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b") ~ "Yes", # Not experienced low weight before phase 8b
                     
                     virus.back_positive_antibodies_covid_.Wave_8b == "Yes" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b")  ~ "No" # Low weight occurred before COVID test
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_LW_10b =
           case_when(virus.back_positive_antibodies_covid_.Wave_10b == "Yes" & # Positive COVID test at phase 10b
                       
                       (is.na(outcome_phase_low_weight) |
                       outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "12b") ~ "Yes", # Not experienced low weight before phase 10b
                     
                     virus.back_positive_antibodies_covid_.Wave_10b == "Yes" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b" )  ~ "No" # Low weight occurred before COVID test
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_LW_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_LW_12b =
           case_when(virus.back_positive_antibodies_covid_.Wave_12b == "Yes" & # Positive COVID test at phase 12b
                     
                       is.na(outcome_phase_low_weight) | # Not experienced low weight during COPING
                       outcome_phase_low_weight == "12b"~ "Yes",  # Co-occurring outcome and exposure
                     
                      virus.back_positive_antibodies_covid_.Wave_12b == "Yes" &
                     (outcome_phase_low_weight == "1b"  |
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b" |
                      outcome_phase_low_weight == "10b" )  ~ "No" # Low weight occurred before COVID test
                     )
         )
      
                     
# Check
dat %>%
  freq(positive_covid_test_LW_12b)
```

Positive COVID test before low weight

NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ See above comments for BE
```{r Positve COVID test result exposure LOW WEIGHT}
dat <- dat %>%
  mutate(positive_covid_test_before_LW =
           case_when(
                      # Had at least one positive covid test before low weight
                    positive_covid_test_LW_1b == "Yes" |
                    positive_covid_test_LW_2b == "Yes" |
                    positive_covid_test_LW_3b == "Yes" |
                    positive_covid_test_LW_4b == "Yes" |
                    positive_covid_test_LW_6b == "Yes" |
                    positive_covid_test_LW_8b == "Yes" |
                    positive_covid_test_LW_10b == "Yes" |
                    positive_covid_test_LW_12b == "Yes" ~ "Positive test before low weight",
                    
                    # Not answered whether they'd taken a test
                    is.na(virus.past_surveys_include_reported_.Wave_1b) &
                    is.na(virus.past_surveys_include_reported_.Wave_2b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_3b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_4b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_6b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_8b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_10b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_12b) ~ "Missing whether taken test",
                   
                    positive_covid_test_LW_1b == "No" |
                    positive_covid_test_LW_2b == "No" |
                    positive_covid_test_LW_3b == "No" |
                    positive_covid_test_LW_4b == "No" |
                    positive_covid_test_LW_6b == "No" |
                    positive_covid_test_LW_8b == "No" |
                    positive_covid_test_LW_10b == "No" |
                    positive_covid_test_LW_12b == "No" ~ "Positive test after low weight",
                   
                    # Not had a test
                     virus.past_surveys_include_reported_.Wave_1b == "No" |
                     virus.past_surveys_include_reported_.Wave_2b == "No" |
                     virus.past_surveys_include_reported_.Wave_3b == "No" |
                     virus.past_surveys_include_reported_.Wave_4b == "No" |
                     virus.past_surveys_include_reported_.Wave_6b == "No" |
                     virus.past_surveys_include_reported_.Wave_8b == "No" |
                     virus.past_surveys_include_reported_.Wave_10b == "No" |
                     virus.past_surveys_include_reported_.Wave_12b == "No"  ~ "Not had a test",
                    
                    # Unsure/inconclusive test result 
                     virus.back_positive_antibodies_covid_.Wave_1b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_2b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_3b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_4b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_6b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_8b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_10b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_12b == "Unsure/inconclusive"  ~ "Inconclusive test",
     
                     # Negative test result 
                     virus.back_positive_antibodies_covid_.Wave_1b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_2b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_3b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_4b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_6b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_8b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_10b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_12b == "No"  ~ "Negative test"
      )
)
                   
# Checl                      
dat %>%
  freq(positive_covid_test_before_LW) 


# Create final variable of positive COVID test before low weight outcome
dat <- dat %>%
  mutate(positive_covid_test_before_LW_final =
           case_when(positive_covid_test_before_LW == "Negative test" |
                     positive_covid_test_before_LW == "Not had a test" |
                     positive_covid_test_before_LW == "Inconclusive test" |
                     positive_covid_test_before_LW ==  "Positive test after low weight" ~ "No",
                     
                     positive_covid_test_before_LW == "Positive test before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_LW_final) 
```
Passive suicidal ideation
```{r Positive COVID test result exposure BEFORE outcome Passive suicidal ideation}

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_PSS_1b =
           case_when(virus.back_positive_antibodies_covid_.Wave_1b == "Yes" & # Positive COVID test at phase 1b
                       
                       (is.na(outcome_phase_passive_suicidal_ideation) |
                       outcome_phase_passive_suicidal_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "12b") ~ "Yes") # Not experienced passive suicidal ideation before phase 1b
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_1b)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_PSS_2b =
           case_when(virus.back_positive_antibodies_covid_.Wave_2b == "Yes" & # Positive COVID test at phase 2b
                       
                       (is.na(outcome_phase_passive_suicidal_ideation) |
                       outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "12b") ~ "Yes", # Not experienced passive suicidal ideation before phase 2b
                     virus.back_positive_antibodies_covid_.Wave_2b == "Yes" &
                     outcome_phase_passive_suicidal_ideation == "1b"   ~ "No" # Passive suicidal ideation occurred before COVID test
                     )
         )
  
# Check
dat %>%
  freq(positive_covid_test_PSS_2b)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_PSS_3b =
           case_when(virus.back_positive_antibodies_covid_.Wave_3b == "Yes" & # Positive COVID test at phase 3b
                       
                       (is.na(outcome_phase_passive_suicidal_ideation) |
                       outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "12b") ~ "Yes", # Not experienced passive suicidal ideation before phase 3b
                     virus.back_positive_antibodies_covid_.Wave_3b == "Yes" &
                     (outcome_phase_passive_suicidal_ideation == "1b" |
                      outcome_phase_passive_suicidal_ideation == "2b") ~ "No" # Passive suicidal ideation occurred before COVID test
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3b)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_PSS_4b =
           case_when(virus.back_positive_antibodies_covid_.Wave_4b == "Yes" & # Positive COVID test at phase 4b
                       
                       (is.na(outcome_phase_passive_suicidal_ideation) |
                       outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "12b") ~ "Yes", # Not experienced passive suicidal ideation before phase 4b
                       virus.back_positive_antibodies_covid_.Wave_4b == "Yes" &
                     (outcome_phase_passive_suicidal_ideation == "1b" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                      outcome_phase_passive_suicidal_ideation == "3b") ~ "No" # Passive suicidal ideation occurred before COVID test
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_4b)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_PSS_6b =
           case_when(virus.back_positive_antibodies_covid_.Wave_6b == "Yes" & # Positive COVID test at phase 6b
                       
                       (is.na(outcome_phase_passive_suicidal_ideation) |
                       outcome_phase_passive_suicidal_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "12b") ~ "Yes", # Not experienced passive suicidal ideation before phase 6b
                     virus.back_positive_antibodies_covid_.Wave_6b == "Yes" &
                     (outcome_phase_passive_suicidal_ideation == "1b" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                      outcome_phase_passive_suicidal_ideation == "4b") ~ "No" # Passive suicidal ideation occurred before COVID test
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_6b)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_PSS_8b =
           case_when(virus.back_positive_antibodies_covid_.Wave_8b == "Yes" & # Positive COVID test at phase 8b
                       
                       (is.na(outcome_phase_passive_suicidal_ideation) |
                       outcome_phase_passive_suicidal_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "12b") ~ "Yes", # Not experienced passive suicidal ideation before phase 8b
                     virus.back_positive_antibodies_covid_.Wave_8b == "Yes" &
                     (outcome_phase_passive_suicidal_ideation == "1b" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                      outcome_phase_passive_suicidal_ideation == "6b") ~ "No" # Passive suicidal ideation occurred before COVID test
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_8b)

# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_PSS_10b =
           case_when(virus.back_positive_antibodies_covid_.Wave_10b == "Yes" & # Positive COVID test at phase 10b
                       
                       (is.na(outcome_phase_passive_suicidal_ideation) |
                       outcome_phase_passive_suicidal_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "12b") ~ "Yes", # Not experienced passive suicidal ideation before phase 10b
                     virus.back_positive_antibodies_covid_.Wave_10b == "Yes" &
                     (outcome_phase_passive_suicidal_ideation == "1b" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                      outcome_phase_passive_suicidal_ideation == "8b") ~ "No" # Passive suicidal ideation occurred before COVID test
                     )
         )
  
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_10b)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_PSS_12b =
           case_when(virus.back_positive_antibodies_covid_.Wave_12b == "Yes" & # Positive COVID test at phase 12b
                     
                       is.na(outcome_phase_passive_suicidal_ideation) | # Not experienced passive suicidal ideation during COPING
                       outcome_phase_passive_suicidal_ideation == "12b" ~ "Yes", # Co-occurring outcome and exposure
                     
                     virus.back_positive_antibodies_covid_.Wave_12b == "Yes" &
                     (outcome_phase_passive_suicidal_ideation == "1b" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                      outcome_phase_passive_suicidal_ideation == "10b") ~ "No" # Passive suicidal ideation occurred before COVID test
                     )
         )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_12b)
```

Positive COVID test before passive suicidal ideation

NB: Have combined "Not had a test", "Negative test", and "Inconclusive test" as "Not positive", i.e., the only thing we count as positive is if someone has a taken a test and had a positive result. Everything else is "Not positive test" other than those who had not answered whether they had taken a test.
+++ See comments above
```{r Positve COVID test result exposure passive suicidal ideation}
dat <- dat %>%
  mutate(positive_covid_test_before_PSS =
           case_when(
                      # Had at least one positive covid test before passive suicidal ideation
                    positive_covid_test_PSS_1b == "Yes" |
                    positive_covid_test_PSS_2b == "Yes" |
                    positive_covid_test_PSS_3b == "Yes" |
                    positive_covid_test_PSS_4b == "Yes" |
                    positive_covid_test_PSS_6b == "Yes" |
                    positive_covid_test_PSS_8b == "Yes" |
                    positive_covid_test_PSS_10b == "Yes" |
                    positive_covid_test_PSS_12b == "Yes" ~ "Positive test before passive suicidal ideation",
                    
                    # Not answered whether they'd taken a test
                    is.na(virus.past_surveys_include_reported_.Wave_1b) &
                    is.na(virus.past_surveys_include_reported_.Wave_2b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_3b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_4b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_6b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_8b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_10b)  &
                    is.na(virus.past_surveys_include_reported_.Wave_12b) ~ "Missing whether taken test",
                   
                    # Positive COVID test after passive suicidal ideation
                    positive_covid_test_PSS_1b == "No" |
                    positive_covid_test_PSS_2b == "No" |
                    positive_covid_test_PSS_3b == "No" |
                    positive_covid_test_PSS_4b == "No" |
                    positive_covid_test_PSS_6b == "No" |
                    positive_covid_test_PSS_8b == "No" |
                    positive_covid_test_PSS_10b == "No" |
                    positive_covid_test_PSS_12b == "No" ~ "Positive test after passive suicidal ideation",
                    
                    # Not had a test
                     virus.past_surveys_include_reported_.Wave_1b == "No" |
                     virus.past_surveys_include_reported_.Wave_2b == "No" |
                     virus.past_surveys_include_reported_.Wave_3b == "No" |
                     virus.past_surveys_include_reported_.Wave_4b == "No" |
                     virus.past_surveys_include_reported_.Wave_6b == "No" |
                     virus.past_surveys_include_reported_.Wave_8b == "No" |
                     virus.past_surveys_include_reported_.Wave_10b == "No" |
                     virus.past_surveys_include_reported_.Wave_12b == "No"  ~ "Not had a test",
                    
                    # Unsure/inconclusive test result 
                     virus.back_positive_antibodies_covid_.Wave_1b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_2b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_3b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_4b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_6b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_8b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_10b == "Unsure/inconclusive" |
                     virus.back_positive_antibodies_covid_.Wave_12b == "Unsure/inconclusive"  ~ "Inconclusive test",
     
                     # Negative test result 
                     virus.back_positive_antibodies_covid_.Wave_1b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_2b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_3b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_4b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_6b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_8b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_10b == "No" |
                     virus.back_positive_antibodies_covid_.Wave_12b == "No"  ~ "Negative test"
      )
)
                   
# Check                     
dat %>%
  freq(positive_covid_test_before_PSS) 


# Create final variable of positive covid test before passive suicidal ideation outcome
dat <- dat %>%
  mutate(positive_covid_test_before_PSS_final =
           case_when(positive_covid_test_before_PSS == "Negative test" |
                     positive_covid_test_before_PSS == "Not had a test" |
                     positive_covid_test_before_PSS == "Inconclusive test" |
                     positive_covid_test_before_PSS == "Positive test after passive suicidal ideation"  ~ "No",
                     
                     positive_covid_test_before_PSS == "Positive test before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_PSS_final) 
```

### Pandemic worry at baseline 
++NB: This needs work! Need to discuss how to score this; the below code was something I very quickly put toghether before my Centre talk. Participants are asked pandemic worry at follow up too, however I wonder if it would be best to just look at baseline as the exposure (as per Moritz's suggestion).

Participants are asked how worried they are about different factors, e.g., mental health, or employment. Before working out total score - First need to work out if participants answered any of thse as 'not applicable' or if they did not answer (i.e., missing).
```{r Pandemic worry as exposure, identifying not applicable or missing data}

# Own Employment
dat <- dat %>%
  mutate(not_applicable_or_missing_own_employment =
           case_when(panworry.impact_on_your_employment_status == "Not applicable" |
                       is.na(panworry.impact_on_your_employment_status) ~ 1
             
           ))
# Check 
dat %>%
  freq(not_applicable_or_missing_own_employment)

# Household employment
dat <- dat %>%
  mutate(not_applicable_or_missing_household_employment =
           case_when(panworry.employment_status_household_key == "Not applicable" |
                       is.na(panworry.employment_status_household_key) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_household_employment)

# Own education / exams
dat <- dat %>%
  mutate(not_applicable_or_missing_own_education_exams =
           case_when(panworry.impact_on_your_education_or_exams == "Not applicable" |
                       is.na(panworry.impact_on_your_education_or_exams) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_own_education_exams)

# Children's exams
dat <- dat %>%
  mutate(not_applicable_or_missing_childrens_education_exams =
           case_when(panworry.exams_impact_education_children == "Not applicable" |
                       is.na(panworry.exams_impact_education_children) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_childrens_education_exams)

# Financial impact
dat <- dat %>%
  mutate(not_applicable_or_missing_financial_impact =
           case_when(panworry.financial_impact == "Not applicable" |
                       is.na(panworry.financial_impact) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_financial_impact)

# Contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_contracting_virus =
           case_when(panworry.contracting_the_virus == "Not applicable" |
                       is.na(panworry.contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_contracting_virus)

# People you know contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_people_know_contracting_virus =
           case_when(panworry.people_you_know_contracting_the_virus == "Not applicable" |
                       is.na(panworry.people_you_know_contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_know_contracting_virus)


# People you don't know contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_people_dont_know_contracting_virus =
           case_when(panworry.people_you_dont_know_contracting_the_virus == "Not applicable" |
                       is.na(panworry.people_you_dont_know_contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_dont_know_contracting_virus)

# Mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_mental_health =
           case_when(panworry.impact_mental_health_wellbeing == "Not applicable" |
                       is.na(panworry.impact_mental_health_wellbeing) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_mental_health)

# Children's mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_childrens_mental_health =
           case_when(panworry.impact_mental_health_childrens == "Not applicable" |
                       is.na(panworry.impact_mental_health_childrens) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_childrens_mental_health)

# Relative's mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_relatives_mental_health =
           case_when(panworry.impact_relatives_mental_health == "Not applicable" |
                       is.na(panworry.impact_relatives_mental_health) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_relatives_mental_health)

# Social isolation
dat <- dat %>%
  mutate(not_applicable_or_missing_social_isolation =
           case_when(panworry.being_socially_isolated == "Not applicable" |
                       is.na(panworry.being_socially_isolated) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_social_isolation)


# People you know social isolation
dat <- dat %>%
  mutate(not_applicable_or_missing_people_know_social_isolation =
           case_when(panworry.people_you_know_being_socially_isolated == "Not applicable" |
                       is.na(panworry.people_you_know_being_socially_isolated) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_know_social_isolation)

# Shortage of essentials
dat <- dat %>%
  mutate(not_applicable_or_missing_shortage_essentials =
           case_when(panworry.shortage_of_essential_supplies == "Not applicable" |
                       is.na(panworry.shortage_of_essential_supplies) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_shortage_essentials)

# Shortage of medication / accesss to healthcare
dat <- dat %>%
  mutate(not_applicable_or_missing_shortage_medication_access_healthcare =
           case_when(panworry.shortage_of_medication_or_access_to_healthcare == "Not applicable" |
                       is.na(panworry.shortage_of_medication_or_access_to_healthcare) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_shortage_medication_access_healthcare)

# People healthcare/shortage essentials
dat <- dat %>%
  mutate(not_applicable_or_missing_healthcare_people_essentials =
           case_when(panworry.healthcare_people_essential_supplies == "Not applicable" |
                       is.na(panworry.healthcare_people_essential_supplies) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_healthcare_people_essentials)

# Government info accuracy
dat <- dat %>%
  mutate(not_applicable_or_missing_gov_info_accurary =
           case_when(panworry.information_virus_government_accuracy == "Not applicable" |
                       is.na(panworry.information_virus_government_accuracy) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_gov_info_accurary)

# Government response to pandemic
dat <- dat %>%
  mutate(not_applicable_or_missing_gov_response_pandemic =
           case_when(panworry.the_governments_response_to_the_pandemic == "Not applicable" |
                       is.na(panworry.the_governments_response_to_the_pandemic) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_gov_response_pandemic)

# Separation from family members
dat <- dat %>%
  mutate(not_applicable_or_missing_separation_family =
           case_when(panworry.separation_from_family_members == "Not applicable" |
                       is.na(panworry.separation_from_family_members) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_separation_family)

# Impact global recession
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_global_recession =
           case_when(panworry.standing_impact_global_recession == "Not applicable" |
                       is.na(panworry.standing_impact_global_recession) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_global_recession)


# Other worry
dat <- dat %>%
  mutate(not_applicable_or_missing_other_worry =
           case_when(panworry.other_ == "Not applicable" |
                       is.na(panworry.other_) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_other_worry)

```

Pandemic worry - Sum score of 'missingness/not applicable'
```{r Pandemic worry as exposure, missingness score}

dat$panworry_sumscore_missingness_not_applicable <- rowSums(dat[ ,
                                 c("not_applicable_or_missing_own_employment",
                                   "not_applicable_or_missing_household_employment",
                                   "not_applicable_or_missing_own_education_exams",
                                   "not_applicable_or_missing_childrens_education_exams",
                                   "not_applicable_or_missing_financial_impact",
                                   "not_applicable_or_missing_contracting_virus",
                                   "not_applicable_or_missing_people_know_contracting_virus",
                                   "not_applicable_or_missing_people_dont_know_contracting_virus",
                                   "not_applicable_or_missing_impact_mental_health",
                                   "not_applicable_or_missing_impact_childrens_mental_health",
                                   "not_applicable_or_missing_impact_relatives_mental_health",
                                   "not_applicable_or_missing_social_isolation",
                                   "not_applicable_or_missing_people_know_social_isolation",
                                   "not_applicable_or_missing_shortage_essentials",
                                   "not_applicable_or_missing_shortage_medication_access_healthcare",
                                   "not_applicable_or_missing_healthcare_people_essentials",
                                   "not_applicable_or_missing_gov_info_accurary",
                                   "not_applicable_or_missing_gov_response_pandemic",
                                   "not_applicable_or_missing_separation_family",
                                   "not_applicable_or_missing_impact_global_recession",
                                   "not_applicable_or_missing_other_worry")],
                                  na.rm = TRUE)

# Check
dat %>%
  freq(panworry_sumscore_missingness_not_applicable)    
```

Work out the total number of questions about pandemic worry each participant answered 
```{r Pandemic worry total number of questions answered}

dat$panworry_total_applicable <- 21 - dat$panworry_sumscore_missingness_not_applicable

# Check
dat %>%
  freq(panworry_total_applicable)    
```
Highest possible score for each participant (i.e., multiply the number of questions they answered with the highest score they could possibly get on each question, i.e., 4)
```{r Pandemic worry highest possible score}

dat$panworry_total_possible_score <- dat$panworry_total_applicable * 4 # The highest score for each question is '4' = Extremely worried

# Check
dat %>%
  freq(panworry_total_possible_score)    
```

Actual scores 
First need to create new variables in which '5' i.e., 'Not applicable' = 0, so that it is not included in final calculation of score.
```{r Pandemic worry recode 'Not applicable' to 0}

# Own Employment
dat$panworry.impact_on_your_employment_status_numeric[dat$panworry.impact_on_your_employment_status_numeric == 5] <- 0

# Household employment
dat$panworry.employment_status_household_key_numeric[dat$panworry.employment_status_household_key_numeric == 5] <- 0

# Own education / exams
dat$panworry.impact_on_your_education_or_exams_numeric[dat$panworry.impact_on_your_education_or_exams_numeric == 5] <- 0

# Children's exams
dat$panworry.exams_impact_education_children_numeric[dat$panworry.exams_impact_education_children_numeric == 5] <- 0

# Financial impact
dat$panworry.financial_impact_numeric[dat$panworry.financial_impact_numeric == 5] <- 0

# Contracting virus
dat$panworry.contracting_the_virus_numeric[dat$panworry.contracting_the_virus_numeric == 5] <- 0

# People you know contracting virus
dat$panworry.people_you_know_contracting_the_virus_numeric[dat$panworry.people_you_know_contracting_the_virus_numeric == 5] <- 0

# People you don't know contracting virus
dat$panworry.people_you_dont_know_contracting_the_virus_numeric[dat$panworry.people_you_dont_know_contracting_the_virus_numeric == 5] <- 0

# Mental health
dat$panworry.impact_mental_health_wellbeing_numeric[dat$panworry.impact_mental_health_wellbeing_numeric == 5] <- 0

# Children's mental health
dat$panworry.impact_mental_health_childrens_numeric[dat$panworry.impact_mental_health_childrens_numeric == 5] <- 0

# Relative's mental health
dat$panworry.impact_relatives_mental_health_numeric[dat$panworry.impact_relatives_mental_health_numeric == 5] <- 0

# Social isolation
dat$panworry.being_socially_isolated_numeric[dat$panworry.being_socially_isolated_numeric == 5] <- 0

# People you know social isolation
dat$panworry.people_you_know_being_socially_isolated_numeric[dat$panworry.people_you_know_being_socially_isolated_numeric == 5] <- 0

# Shortage of essentials
dat$panworry.shortage_of_essential_supplies_numeric[dat$panworry.shortage_of_essential_supplies_numeric == 5] <- 0

# Shortage of medication / accesss to healthcare
dat$panworry.shortage_of_medication_or_access_to_healthcare_numeric[dat$panworry.shortage_of_medication_or_access_to_healthcare_numeric == 5] <- 0

# People healthcare/shortage essentials
dat$panworry.healthcare_people_essential_supplies_numeric[dat$panworry.healthcare_people_essential_supplies_numeric == 5] <- 0

# Government info accuracy
dat$panworry.information_virus_government_accuracy_numeric[dat$panworry.information_virus_government_accuracy_numeric == 5] <- 0

# Government response to pandemic
dat$panworry.the_governments_response_to_the_pandemic_numeric[dat$panworry.the_governments_response_to_the_pandemic_numeric == 5] <- 0

# Separation from family members
dat$panworry.separation_from_family_members_numeric[dat$panworry.separation_from_family_members_numeric == 5] <- 0

# Impact global recession
dat$panworry.standing_impact_global_recession_numeric[dat$panworry.standing_impact_global_recession_numeric == 5] <- 0

# Other worry
dat$panworry.other__numeric[dat$panworry.other__numeric == 5] <- 0
```

Sum score of actual answers (e.g., score of 4 on a question = "Extremely worried")
```{r Pandemic worry sum score actual answers}

dat$panworry_total_raw_score <- rowSums(dat[ ,
                                 c("panworry.impact_on_your_employment_status_numeric",
                                   "panworry.employment_status_household_key_numeric",
                                   "panworry.impact_on_your_education_or_exams_numeric",
                                   "panworry.exams_impact_education_children_numeric",
                                   "panworry.financial_impact_numeric",
                                   "panworry.contracting_the_virus_numeric",
                                   "panworry.people_you_know_contracting_the_virus_numeric",
                                   "panworry.people_you_dont_know_contracting_the_virus_numeric",
                                   "panworry.impact_mental_health_wellbeing_numeric",
                                   "panworry.impact_mental_health_childrens_numeric",
                                   "panworry.impact_relatives_mental_health_numeric",
                                   "panworry.being_socially_isolated_numeric",
                                   "panworry.people_you_know_being_socially_isolated_numeric",
                                   "panworry.shortage_of_essential_supplies_numeric",
                                   "panworry.shortage_of_medication_or_access_to_healthcare_numeric",
                                   "panworry.healthcare_people_essential_supplies_numeric",
                                   "panworry.information_virus_government_accuracy_numeric",
                                   "panworry.the_governments_response_to_the_pandemic_numeric",
                                   "panworry.separation_from_family_members_numeric",
                                   "panworry.standing_impact_global_recession_numeric",
                                   "panworry.other__numeric")],
                                  na.rm = TRUE)

# Check
dat %>%
  freq(panworry_total_raw_score)    
```

Answers as a percentage of possible scores (i.e., divide their actual score by their highest possible score, as calculated by the number of questions that were applicable to them/they answered)
```{r Pandemic worry answers as percentage}
dat$panworry_total_score_percent <- (dat$panworry_total_raw_score/dat$panworry_total_possible_score)*100

# Check 
dat %>%
  freq(panworry_total_score_percent)  
```

Answers as factors (0-20, 20-40, 40-50, 60-80, 80-100)
NB: I have included this as just another idea of grouping pandemic worry scores.
```{r Pandemic worry answers as factors}

dat <- dat %>%
  mutate(panworry_factor =
           case_when(
             panworry_total_score_percent >= 0 & panworry_total_score_percent <= 20 ~ "0-20",
             panworry_total_score_percent >= 21 & panworry_total_score_percent <= 40 ~ "21-40",
             panworry_total_score_percent >= 41 & panworry_total_score_percent <= 60 ~ "41-60",
             panworry_total_score_percent >= 61 & panworry_total_score_percent <= 80 ~ "61-80",
             panworry_total_score_percent >= 81 & panworry_total_score_percent <= 100 ~ "81-100"
           )
    
  )

# Change to factor
dat$panworry_factor <- as.factor(dat$panworry_factor)

dat %>%
  freq(panworry_factor)
```

### Losing someone due to COVID-19 (grief)

Losing someone due to COVID as indicated at baseline
grief.covid_lost_due_close = In the past month, have you lost someone close to you due to COVID-19?
```{r Loss baseline}

dat <- dat %>%
  mutate(lost_someone_baseline = 
           case_when(grief.covid_lost_due_close == "Yes" ~ "Lost someone",
                     grief.covid_lost_due_close == "No" ~ "Not lost someone",
                     grief.covid_lost_due_close == "Prefer not to say" ~ "PNTA"
             
           ))
 
# Check
dat %>%
  freq(lost_someone_baseline)

```

Follow up questionniares - Losing someone
```{r Loss follow up}

dat <- dat %>%
  mutate(lost_someone_phases = 
           case_when(grief.due_past_month_lost_.Wave_1b  == "Yes" |
                       grief.due_past_month_lost_.Wave_2b  == "Yes" |
                       grief.due_past_month_lost_.Wave_3b  == "Yes" |
                       grief.due_past_month_lost_.Wave_4b  == "Yes" |
                       grief.due_past_month_lost_.Wave_6b  == "Yes" |
                       grief.due_past_month_lost_.Wave_8b  == "Yes" |
                       grief.due_past_month_lost_.Wave_10b  == "Yes" |
                       grief.due_past_month_lost_.Wave_12b  == "Yes" ~ "Lost someone", # Indicated "Yes" at at least one phase
                     
                       is.na(grief.due_past_month_lost_.Wave_1b) &
                       is.na(grief.due_past_month_lost_.Wave_2b)  &
                       is.na(grief.due_past_month_lost_.Wave_3b)  &
                       is.na(grief.due_past_month_lost_.Wave_4b)  &
                       is.na(grief.due_past_month_lost_.Wave_6b)  &
                       is.na(grief.due_past_month_lost_.Wave_8b)  &
                       is.na(grief.due_past_month_lost_.Wave_10b)  &
                       is.na(grief.due_past_month_lost_.Wave_12b)  ~ "Missing at every phase", # Missing all loss data
                       
                       grief.due_past_month_lost_.Wave_1b  == "Prefer not to say" |
                       grief.due_past_month_lost_.Wave_2b  == "Prefer not to say" |
                       grief.due_past_month_lost_.Wave_3b  == "Prefer not to say" |
                       grief.due_past_month_lost_.Wave_4b  == "Prefer not to say" |
                       grief.due_past_month_lost_.Wave_6b  == "Prefer not to say" |
                       grief.due_past_month_lost_.Wave_8b  == "Prefer not to say" |
                       grief.due_past_month_lost_.Wave_10b  == "Prefer not to say" |
                       grief.due_past_month_lost_.Wave_12b  == "Prefer not to say" ~ "PNTA at at least one phase", # These people with have a mix of PNTA, No, and NA
                       
                       grief.due_past_month_lost_.Wave_1b  == "No" |
                       grief.due_past_month_lost_.Wave_2b  == "No" |
                       grief.due_past_month_lost_.Wave_3b  == "No" |
                       grief.due_past_month_lost_.Wave_4b  == "No" |
                       grief.due_past_month_lost_.Wave_6b  == "No" |
                       grief.due_past_month_lost_.Wave_8b  == "No" |
                       grief.due_past_month_lost_.Wave_10b  == "No" |
                       grief.due_past_month_lost_.Wave_12b  == "No" ~ "Not lost someone" # These people with have a mix of No and NA
                     )
         )
 
# Check
dat %>%
  freq(lost_someone_phases)

```

Combined phases & baseline - Losing someone
```{r Loss combined phases & baseline }

dat <- dat %>%
  mutate(loss_of_loved_one_final = 
           case_when(lost_someone_phases == "Lost someone" |
                     lost_someone_baseline == "Lost someone" ~ "Yes",
                     
                     lost_someone_phases == "PNTA at at least one phase" |
                     lost_someone_baseline == "PNTA" ~ NA_character_, #Can't be sure that they have not lost someone as they have answered PNTA at least once
                     lost_someone_baseline == "Not lost someone" |
                    lost_someone_phases == "Not lost someone" ~ "No"
                      
             ))
 
# Check
dat %>%
  freq(panworry_total_score_percent)
```

### Loneliness at baseline

Create numeric variable that demonstrates pre-pandemic loneliness score
NB: Again, need to think about how we would like to calculate this. Rough version below (need to think about NAs...)
```{r Pre-pandemic loneliness score}

# Score of loneliness at baseline
# All questions begin with: Over the past two weeks, how often have you felt that the following statements apply to you?

# Felt that you lack companionship 
dat <- dat %>%
  mutate(lack_companionship_numeric =
           case_when(
            lone.felt_that_you_lack_companionship == "Hardly ever" ~ 0,
           lone.felt_that_you_lack_companionship == "Some of the time" ~ 1,
           lone.felt_that_you_lack_companionship == "Often" ~ 2
  )
  )

# Felt left out
dat <- dat %>%
  mutate(felt_left_out_numeric =
           case_when(
           lone.felt_left_out == "Hardly ever" ~ 0,
           lone.felt_left_out == "Some of the time" ~ 1,
           lone.felt_left_out == "Often" ~ 2
  )
)

# Felt isolated from others
dat <- dat %>%
  mutate(felt_isolated_from_others_numeric =
           case_when(
           lone.felt_isolated_from_others == "Hardly ever" ~ 0,
           lone.felt_isolated_from_others == "Some of the time" ~ 1,
           lone.felt_isolated_from_others == "Often" ~ 2
  )
)

# Felt alone
dat <- dat %>%
  mutate(felt_alone_numeric =
           case_when(
           lone.felt_alone == "Hardly ever" ~ 0,
           lone.felt_alone == "Some of the time" ~ 1,
           lone.felt_alone == "Often" ~ 2
  )
)
```

Calculate baseline loneliness score
```{r Loneliness baseline score}
dat$loneliness_prepan_count <- rowSums(dat[ ,
                                 c("felt_alone_numeric",
                                   "felt_isolated_from_others_numeric",
                                   "felt_left_out_numeric",
                                   "lack_companionship_numeric")],
                                  na.rm = TRUE)

#Check
dat %>%
  freq(loneliness_prepan_count)
```

Create numeric variable that demonstrates pandemic loneliness score
```{r Loneliness prepandemic score}
# Score of loneliness pre-pandemic
# All questions start with: Before the pandemic, how often have you felt that the following statements apply to you?

# Felt that you lack companionship
dat <- dat %>%
  mutate(lack_companionship_pandemic_numeric =
           case_when(
            lone.felt_that_you_lack_companionship.1 == "Hardly ever" ~ 0,
           lone.felt_that_you_lack_companionship.1 == "Some of the time" ~ 1,
           lone.felt_that_you_lack_companionship.1 == "Often" ~ 2
  )
  )

# Felt left out
dat <- dat %>%
  mutate(felt_left_out_pandemic_numeric =
           case_when(
           lone.felt_left_out.1 == "Hardly ever" ~ 0,
           lone.felt_left_out.1 == "Some of the time" ~ 1,
           lone.felt_left_out.1 == "Often" ~ 2
  )
)

# Felt isolated from others
dat <- dat %>%
  mutate(felt_isolated_from_others_pandemic_numeric =
           case_when(
           lone.felt_isolated_from_others.1 == "Hardly ever" ~ 0,
           lone.felt_isolated_from_others.1 == "Some of the time" ~ 1,
           lone.felt_isolated_from_others.1 == "Often" ~ 2
  )
)

# Felt alone
dat <- dat %>%
  mutate(felt_alone_pandemic_numeric =
           case_when(
           lone.felt_alone.1 == "Hardly ever" ~ 0,
           lone.felt_alone.1 == "Some of the time" ~ 1,
           lone.felt_alone.1 == "Often" ~ 2
  )
)
            
```

Calculate prepandemic loneliness score
```{r Loneliness prepandemic score}
dat$loneliness_pandemic_count <- rowSums(dat[ ,
                                 c("felt_alone_pandemic_numeric",
                                   "felt_isolated_from_others_pandemic_numeric",
                                   "felt_left_out_pandemic_numeric",
                                   "lack_companionship_pandemic_numeric")],
                                  na.rm = TRUE)

# Check
dat %>%
  freq(loneliness_pandemic_count)
```

Calculate whether they have experienced an increase in loneliness during the pandemic or not 
```{r Loneliness increased during pandemic}
dat <- dat %>%
  mutate(increased_loneliness_during_pandemic =
           case_when(
           loneliness_prepan_count < loneliness_pandemic_count ~ "Yes", # These people have higher loneliness scores at baseline than retrospective prepandemic loneliness scores
         loneliness_prepan_count >= loneliness_pandemic_count ~ "No", # These people have lower or the same loneliness scores at baseline than retrospective prepandemic loneliness scores
         )
  )

# Check
dat %>%
  freq(increased_loneliness_during_pandemic)
```

### Change in main eco activity (work/education)
Create baseline variable indicating if change in main eco activity
```{r Change in main eco activity at baseline}
dat <- dat %>%
  mutate(eco_activity_change_baseline =
           case_when(employ.my_employment_status_has_not_changed == "My employment status has not changed" ~ "No",
                     employ.my_employment_status_has_not_changed == "Not My employment status has not changed" ~ "Yes",
                     employ.no_impact == "Not No impact" ~ "Yes",
                     employ.no_impact == "No impact" ~ "No"
            ))

```

Create phases variable indicating if change in main eco activity
```{r Change in main eco activity at phases}
dat <- dat %>%
  mutate(eco_activity_change_phases =
           case_when(is.na(dem.nothing_has_changed_.Wave_1a) &
                       is.na(dem.nothing_has_changed_.Wave_1b)&
                       is.na(dem.nothing_has_changed_.Wave_2a)&
                       is.na(dem.nothing_has_changed_.Wave_2b)&
                       is.na(dem.nothing_has_changed_.Wave_3a)&
                       is.na(dem.nothing_has_changed_.Wave_3b)&
                       is.na(dem.nothing_has_changed_.Wave_4a)&
                       is.na(dem.nothing_has_changed_.Wave_4b)&
                       is.na(dem.nothing_has_changed_.Wave_5a)&
                       is.na(dem.nothing_has_changed_.Wave_6b)&
                       is.na(dem.nothing_has_changed_.Wave_7a)&
                       is.na(dem.nothing_has_changed_.Wave_8b)&
                       is.na(dem.nothing_has_changed_.Wave_9a)&
                       is.na(dem.nothing_has_changed_.Wave_10b)&
                       is.na(dem.nothing_has_changed_.Wave_11a)&
                       is.na(dem.nothing_has_changed_.Wave_12b) &              
                     
                       is.na(dem.employment_.Wave_1a) &
                       is.na(dem.employment_.Wave_1b)&
                       is.na(dem.employment_.Wave_2a)&
                       is.na(dem.employment_.Wave_2b)&
                       is.na(dem.employment_.Wave_3a)&
                       is.na(dem.employment_.Wave_3b)&
                       is.na(dem.employment_.Wave_4a)&
                       is.na(dem.employment_.Wave_4b)&
                       is.na(dem.employment_.Wave_5a)&
                       is.na(dem.employment_.Wave_6b)&
                       is.na(dem.employment_.Wave_7a)&
                       is.na(dem.employment_.Wave_8b)&
                       is.na(dem.employment_.Wave_9a)&
                       is.na(dem.employment_.Wave_10b)&
                       is.na(dem.employment_.Wave_11a)&
                       is.na(dem.employment_.Wave_12b) ~ "Missing at every phase",
                     
                       dem.employment_.Wave_1a == "Employment" |
                       dem.employment_.Wave_1b == "Employment" |
                       dem.employment_.Wave_2a == "Employment" |
                       dem.employment_.Wave_2b == "Employment" |
                       dem.employment_.Wave_3a == "Employment" |
                       dem.employment_.Wave_3b == "Employment" |
                       dem.employment_.Wave_4a == "Employment" |
                       dem.employment_.Wave_4b == "Employment" |
                       dem.employment_.Wave_5a == "Employment" |
                       dem.employment_.Wave_6b == "Employment" |
                       dem.employment_.Wave_7a == "Employment" |
                       dem.employment_.Wave_8b == "Employment" |
                       dem.employment_.Wave_9a == "Employment" |
                       dem.employment_.Wave_10b == "Employment" |
                       dem.employment_.Wave_11a == "Employment" |
                       dem.employment_.Wave_12b == "Employment" ~ "Yes", # Said "Yes" they have experienced change in employment at least once
                     
                       dem.nothing_has_changed_.Wave_1a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_1b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_2a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_2b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_3a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_3b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_4a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_4b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_5a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_6b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_7a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_8b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_9a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_10b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_11a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_12b == "Nothing has changed" ~ "No", # Not experienced change in any domain
                      
                      dem.employment_.Wave_1a == "Not Employment" |
                       dem.employment_.Wave_1b == "Not Employment" |
                       dem.employment_.Wave_2a == "Not Employment" |
                       dem.employment_.Wave_2b == "Not Employment" |
                       dem.employment_.Wave_3a == "Not Employment" |
                       dem.employment_.Wave_3b == "Not Employment" |
                       dem.employment_.Wave_4a == "Not Employment" |
                       dem.employment_.Wave_4b == "Not Employment" |
                       dem.employment_.Wave_5a == "Not Employment" |
                       dem.employment_.Wave_6b == "Not Employment" |
                       dem.employment_.Wave_7a == "Not Employment" |
                       dem.employment_.Wave_8b == "Not Employment" |
                       dem.employment_.Wave_9a == "Not Employment" |
                       dem.employment_.Wave_10b == "Not Employment" |
                       dem.employment_.Wave_11a == "Not Employment" |
                       dem.employment_.Wave_12b == "Not Employment" ~ "No" # Have experienced change but not in the employment domain
                     
                   ))


dat %>%
  freq(eco_activity_change_phases)
```

Combine baseline & phases - change in main eco activity
```{r Change in main eco activity combine baseline and phases}

dat <- dat%>%
  mutate(main_economic_activity_change =
           case_when(eco_activity_change_baseline == "Yes" |
                eco_activity_change_phases == "Yes" ~ "Yes",
               
                eco_activity_change_baseline == "No" |
                 eco_activity_change_phases == "No" ~ "No")
)

#Check
dat %>%
  freq(main_economic_activity_change)
```

### Change in housing
Calculate change in housing at baseline
```{r Change in housing at baseline}
dat <- dat %>%
  mutate(living_situation_baseline =
           case_when(dem2.living_situation_change_pandemic == "Yes" ~ "Yes",
                     dem2.living_situation_change_pandemic == "No" ~ "No"
                     
                )
  )

dat %>%
  freq(living_situation_baseline)
```

Calculate change in housing during phases
```{r Change in housing phases}
dat <- dat %>%
  mutate(living_situation_change_phases =
           case_when(is.na(dem.nothing_has_changed_.Wave_1a) &
                       is.na(dem.nothing_has_changed_.Wave_1b)&
                       is.na(dem.nothing_has_changed_.Wave_2a)&
                       is.na(dem.nothing_has_changed_.Wave_2b)&
                       is.na(dem.nothing_has_changed_.Wave_3a)&
                       is.na(dem.nothing_has_changed_.Wave_3b)&
                       is.na(dem.nothing_has_changed_.Wave_4a)&
                       is.na(dem.nothing_has_changed_.Wave_4b)&
                       is.na(dem.nothing_has_changed_.Wave_5a)&
                       is.na(dem.nothing_has_changed_.Wave_6b)&
                       is.na(dem.nothing_has_changed_.Wave_7a)&
                       is.na(dem.nothing_has_changed_.Wave_8b)&
                       is.na(dem.nothing_has_changed_.Wave_9a)&
                       is.na(dem.nothing_has_changed_.Wave_10b)&
                       is.na(dem.nothing_has_changed_.Wave_11a)&
                       is.na(dem.nothing_has_changed_.Wave_12b) &              
                     
                       is.na(dem.living_situation_.Wave_1a) &
                       is.na(dem.living_situation_.Wave_1b)&
                       is.na(dem.living_situation_.Wave_2a)&
                       is.na(dem.living_situation_.Wave_2b)&
                       is.na(dem.living_situation_.Wave_3a)&
                       is.na(dem.living_situation_.Wave_3b)&
                       is.na(dem.living_situation_.Wave_4a)&
                       is.na(dem.living_situation_.Wave_4b)&
                       is.na(dem.living_situation_.Wave_5a)&
                       is.na(dem.living_situation_.Wave_6b)&
                       is.na(dem.living_situation_.Wave_7a)&
                       is.na(dem.living_situation_.Wave_8b)&
                       is.na(dem.living_situation_.Wave_9a)&
                       is.na(dem.living_situation_.Wave_10b)&
                       is.na(dem.living_situation_.Wave_11a)&
                       is.na(dem.living_situation_.Wave_12b) ~ "Missing at every phase",
                     
                     
                       dem.living_situation_.Wave_1a == "Living situation" |
                       dem.living_situation_.Wave_1b == "Living situation" |
                       dem.living_situation_.Wave_2a == "Living situation" |
                       dem.living_situation_.Wave_2b == "Living situation" |
                       dem.living_situation_.Wave_3a == "Living situation" |
                       dem.living_situation_.Wave_3b == "Living situation" |
                       dem.living_situation_.Wave_4a == "Living situation" |
                       dem.living_situation_.Wave_4b == "Living situation" |
                       dem.living_situation_.Wave_5a == "Living situation" |
                       dem.living_situation_.Wave_6b == "Living situation" |
                       dem.living_situation_.Wave_7a == "Living situation" |
                       dem.living_situation_.Wave_8b == "Living situation" |
                       dem.living_situation_.Wave_9a == "Living situation" |
                       dem.living_situation_.Wave_10b == "Living situation" |
                       dem.living_situation_.Wave_11a == "Living situation" |
                       dem.living_situation_.Wave_12b == "Living situation" ~ "Yes", # Said "Yes" they have experienced change in housing at least once
                     
                       dem.nothing_has_changed_.Wave_1a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_1b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_2a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_2b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_3a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_3b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_4a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_4b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_5a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_6b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_7a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_8b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_9a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_10b == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_11a == "Nothing has changed" |
                       dem.nothing_has_changed_.Wave_12b == "Nothing has changed" ~ "No", # Nothing has changed in any domain
                      
                     dem.living_situation_.Wave_1a == "Not Living situation" |
                       dem.living_situation_.Wave_1b == "Not Living situation" |
                       dem.living_situation_.Wave_2a == "Not Living situation" |
                       dem.living_situation_.Wave_2b == "Not Living situation" |
                       dem.living_situation_.Wave_3a == "Not Living situation" |
                       dem.living_situation_.Wave_3b == "Not Living situation" |
                       dem.living_situation_.Wave_4a == "Not Living situation" |
                       dem.living_situation_.Wave_4b == "Not Living situation" |
                       dem.living_situation_.Wave_5a == "Not Living situation" |
                       dem.living_situation_.Wave_6b == "Not Living situation" |
                       dem.living_situation_.Wave_7a == "Not Living situation" |
                       dem.living_situation_.Wave_8b == "Not Living situation" |
                       dem.living_situation_.Wave_9a == "Not Living situation" |
                       dem.living_situation_.Wave_10b == "Not Living situation" |
                       dem.living_situation_.Wave_11a == "Not Living situation" |
                       dem.living_situation_.Wave_12b == "Not Living situation" ~ "Yes", # Something has changed but not their living situation
                     
                   ))


dat %>%
  freq(living_situation_change_phases)
```

Change in housing combine baseline and phases
```{r Change in housing combine baseline and phases}
dat <- dat%>%
  mutate(living_situation_change =
           case_when(living_situation_change_phases == "Yes" |
                    living_situation_baseline == "Yes" ~ "Yes",
                    
                    living_situation_change_phases == "No" |
                      living_situation_baseline == "No" ~ "No"
                    )
)

# Check
dat %>%
  freq(living_situation_change) 
```
# Saving dataset
## FOR NOW - select & save variables needed for interim analysis
```{r Select final variables ready for regression analyses}
test_dat <- dat %>%
  select(ID,
         cohort_name,
         NEW_binge_eating_pandemic,
         NEW_low_weight_pandemic,
         PREPANDEMIC_passive_suicidal_ideation,
         passive_suicidal_ideation_PANDEMIC,
         PREPANDEMIC_selfharm_ideation,
         selfharm_ideation_PANDEMIC,
         PREPANDEMIC_selfharm,
         selfharm_PANDEMIC,
         age_category_COVID_baseline,
         gender_cleaned,
         sex_binary_numeric,
         race_binary,
         A_Levels_higher,
         psych_disorder_factor,
         employed_key,
         vulnerable_group_member,
         positive_covid_test_final,
         panworry_total_score_percent,
         panworry_factor,
         loss_of_loved_one_final,
         increased_loneliness_during_pandemic,
         main_economic_activity_change,
         living_situation_change
      )
```

Save final dataset (interim analysis)
Save dataset
```{r}
saveRDS(object = test_dat,
       file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/test_dat", date, ".rds"))

```




