---
title: "Data_Analysis_EDBeh_SelfHarm"
author: "Helena Davies"
date: "28/01/2021"
output: html_document
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

#### Call in library script

```{r source files}
source("./libraries.R")
```

### Read in TAF data
```{r}
dat.taf <- readRDS(file = "../data_cleaned/dat.taf.rds")
dim(dat.taf)
colnames(dat.taf)

```

### Read in EDEQ data
```{r}
dat.edeq <- readRDS(file = "../data_cleaned/dat.edeq.rds")
dim(dat.edeq)
colnames(dat.edeq)

```
# Colour palettes
Define colours for plotting this are the standard coping colours
```{r Colour palettes: COPING}
COPINGpalette2 <- c("#78D9C5",
                    "#F5BE5E")
COPINGpalette3 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9")
COPINGpalette4 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73")
COPINGpalette5 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73",
                    "#FFED98")
COPINGpalette6 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73",
                    "#FFED98",
                    "#BFD2EB")
COPINGpalette7 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73",
                    "#FFED98",
                    "#BFD2EB",
                    "#808080")
COPINGpaletteGRAD <- c("#F5BE5E",
                       "#FFD284",
                       "#FFEED1",
                       "#B5B5B5",
                       "#DEFFF8",
                       "#94F6E1",
                       "#78D9C5")
COPINGNeuCenterpalette <- c("#78D9C5",
                            "#808080",
                            "#F5BE5E")
RAMPworseGRADpalette <- c("#78D9C5",
                          "#FFEED1",
                          "#F5BE5E",
                          "#FFB1B5")
GLADpalette = c("#efc00b",
                "#b7dee8")
```

Choose in this chunk which palette to use
04.07.2020 - Default to 2 colour COPING palette
```{r Choose colour palette}
palette = COPINGpalette2
```

# ggplot theme
Set up ggplot theme for the plots
```{r ggplot theme}
theme_personal <-  theme(
    text = element_text(color = "black"),
    axis.title = element_text(color = "black"),
    axis.text = element_text(color = "black"),
    axis.title.y = element_blank(),
    legend.background = element_blank(),
    legend.box.background = element_blank(),
    panel.background = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_line(
      colour = "gray",
      linetype = "dashed",
      size = 0.2
      ),
    axis.ticks = element_blank()
    )
```

##Demographics - TAF
#cohort
```{r}
freq(dat.taf$cohort_name)
```

#age
```{r}
freq(dat.taf$age_category)
```

#gender
```{r}
freq(dat.taf$gender)
```

#ethnicity
```{r}
freq(dat.taf$ethnicity)
##Lots of missing data from NBR - have checked ethnicity source script and seems that the original dataset contains a lot of NAs...

##Check which cohort missing data is from
x <- dat.taf %>%
  filter(is.na(ethnicity))

freq(x$cohort_name)

```

#highest level of education
```{r}
freq(dat.taf$highest_education)

##Check which cohort missing data is from
x <- dat.taf %>%
  filter(is.na(highest_education))

freq(x$cohort_name)

```

#self-reported diagnoses
```{r}
freq(dat.taf$depressive_disorders_numeric) ##ALL GLAD + EDGI 

```

##PLOTS - TAF 
#First, need to re-structure data so that "wave" is a single column with rows of "baseline, 2a, 2b etc", and each taf item is a separate column in which rows are values
```{r}
dat.taf <- dat.taf %>%
  pivot_longer(
    cols = (starts_with("taf") &
              contains(".Wave")),
    names_to = "wave_taf",
    values_to = "value") %>%
  separate(wave_taf, into = c("taf", "wave"), sep = "_.Wave", remove = TRUE) %>%
  pivot_wider(
     names_from = "taf",
     values_from = "value")

```

For percentage, perhaps try scales::percent instead of percent_format. For ordering, try fill = reorder(wave, taf.worth_living_life_people). Let me know if you prefer a call!

#Plot 1. Many people have thoughts that life is not worth living. Have you felt that way in the past two weeks?
```{r}
##NEEDS TO BE PERCENTAGES!!!!!!!!! change order
ggplot(subset(dat.taf, !is.na(taf.worth_living_life_people)),
       aes(taf.worth_living_life_people, 
           fill = reorder(wave, taf.worth_living_life_people))) +
  geom_bar(size = 1,
           shape = 23,
           colour = "black",
           position = position_dodge()) +
  scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
  labs(y = "Percentage of participants",
       x = "Many people have thoughts that life is not worth living. Have you felt that way in the past two weeks?",
       title = "Life not worth living (past 2 weeks)")


```





























