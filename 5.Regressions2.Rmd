---
title: "Regressions2"
author: "Helena Davies"
date: "24/05/2021"
output: html_document
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

#### Call in library script

```{r source files}
source("./libraries.R")
```


#Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

#### R functions

```{r call in function library functions}
# source all functions in the function folder
source("./functions.R")
```

# Read in data
```{r}
dat <- readRDS(file = "../data_cleaned/test_dat2021-06-09.rds")
dim(dat)
colnames(dat)

```
## CORRELATION MATRICES ##
```{r}

#Categorical variables for dummy coding

descriptives.columns.dummy <- c(
"gender_cleaned",
  "age_category_COVID_baseline",
  "ethnicity_binary",
  "highest_education",
  "psych_disorder_factor",
  "key_worker",
"vulnerable_group_member",
"covid_test_final",

"loss_of_loved_one_final",
"increased_loneliness_during_pandemic",
"main_economic_activity_change",
"living_situation_change",

"PREPANDEMIC_selfharm_ideation",
"PREPANDEMIC_passive_suicidal_ideation",
"PREPANDEMIC_selfharm"
)

```

#Dummy coding for categorical variables
```{r descriptives data frame}
dat_dummy <- fastDummies::dummy_cols(dat,
                                              select_columns = descriptives.columns.dummy)

colnames(dat_dummy)

```

# EATING DISORDER CORR MATRIX
```{r}
#Make binary variables numeric 

# Select items for correlation matrix
dat.corr.mat <- dat_dummy %>%
  select("Male" = "gender_cleaned_Male",
   "Female" = "gender_cleaned_Female",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71-75" = "age_category_COVID_baseline_71-75",
   "75+" = "age_category_COVID_baseline_75+",
   "Racially_minoritised" = "ethnicity_binary_Racially minoritised",
   "White" = "ethnicity_binary_White", 
   "No_formal_education" = "highest_education_No formal qualifications",
  "GCSE/CSE"="highest_education_GCSE/CSE",
  "NVQ" = "highest_education_NVQ",
  "A-Levels" = "highest_education_A-levels",
  "Uni/Prof_qual" = "highest_education_University/Other professional qualifications",
  #"No_psych_disorder" = "psych_disorder_factor_No psychiatric disorder",
  "Psych_disorder" ="psych_disorder_factor_Psychiatric disorder",
 # "Not_key_worker" = "key_worker_No key worker",
  "Key_worker"="key_worker_Key worker",
#  "Not_vulnerable_group" = "vulnerable_group_member_I am not a member of a vulnerable group",
  "Vulnerable_group" = "vulnerable_group_member_Not I am not a member of a vulnerable group",
  "covid_test_final_Positive result",
 "Loss" = "loss_of_loved_one_final_Yes",
 "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
 "Change_main_eco" = "main_economic_activity_change_Yes",
 "Change_living_sit" ="living_situation_change_Yes"
  
  
) %>%
  polycor::hetcor(use = "pairwise.complete.obs") #Remember to specify "pairwise.complete.obs"!


# Save the correlations from the correlation matrix in an object
dat.corr.matrix <- as.matrix(dat.corr.mat)

# Save the p values from the correlation matrix in an object
dat.p.matrix <- as.matrix(dat.corr.mat$tests)
```

# 16. Create the correlation matrix plot using the corrplot package
```{r Correlation matrix at t1 plot, fig.height=7}

dat.corr.matrix %>%
  corrplot::corrplot(method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.8,
         number.cex = 0.75,
         tl.col = "black",
         col=colorRampPalette(c("dodgerblue4",
                                "white",
                                "firebrick4"))(200), # colours for correlations
         # Combine with significance
         p.mat = dat.p.matrix, # Matrix with p values
         sig.level = 0.01, # Choose significant level
         insig = "blank") # Nonsignificant correlations have no colour
         

         
```

#SELF-HARM CORR MATRIX
 
```{r}
#Make binary variables numeric 

# Select items for correlation matrix
dat.corr.mat <- dat_dummy %>%
  select("Male" = "gender_cleaned_Male",
   "Female" = "gender_cleaned_Female",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71-75" = "age_category_COVID_baseline_71-75",
   "75+" = "age_category_COVID_baseline_75+",
   "Racially_minoritised" = "ethnicity_binary_Racially minoritised",
   "White" = "ethnicity_binary_White", 
   "No_formal_education" = "highest_education_No formal qualifications",
  "GCSE/CSE"="highest_education_GCSE/CSE",
  "NVQ" = "highest_education_NVQ",
  "A-Levels" = "highest_education_A-levels",
  "Uni/Prof_qual" = "highest_education_University/Other professional qualifications",
# "No_psych_disorder" = "psych_disorder_factor_No psychiatric disorder",
  "Psych_disorder" ="psych_disorder_factor_Psychiatric disorder", 
#"Not_control" ="psych_disorder_factor_Not a control",
#  "Not_key_worker" = "key_worker_No key worker",
  "Key_worker"= "key_worker_Key worker",
#  "Not_vulnerable_group" = "vulnerable_group_member_I am not a member of a vulnerable group",
  "Vulnerable_group" = "vulnerable_group_member_Not I am not a member of a vulnerable group",
  "covid_test_final_Positive result",
  "Prepan_suicidal_ideation" = "PREPANDEMIC_passive_suicidal_ideation_1",
  "Prepan_selfharm_ideation" = "PREPANDEMIC_selfharm_ideation_1",
  "Prepan_selfharm" = "PREPANDEMIC_selfharm_1",
   "covid_test_final_Positive result",
 "Loss" = "loss_of_loved_one_final_Yes",
 "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
 "Change_main_eco" = "main_economic_activity_change_Yes",
 "Change_living_sit" ="living_situation_change_Yes"
  
) %>%
  polycor::hetcor(use = "pairwise.complete.obs") #Remember to specify "pairwise.complete.obs"!


# Save the correlations from the correlation matrix in an object
dat.corr.matrix <- as.matrix(dat.corr.mat)

# Save the p values from the correlation matrix in an object
dat.p.matrix <- as.matrix(dat.corr.mat$tests)
```

# 16. Create the correlation matrix plot using the corrplot package
```{r Correlation matrix at t1 plot, fig.height=7}

dat.corr.matrix %>%
  corrplot::corrplot(method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.8,
         number.cex = 0.75,
         tl.col = "black",
         col=colorRampPalette(c("dodgerblue4",
                                "white",
                                "firebrick4"))(200), # colours for correlations
         # Combine with significance
         p.mat = dat.p.matrix, # Matrix with p values
         sig.level = 0.01, # Choose significant level
         insig = "blank") # Nonsignificant correlations have no colour
         

         
```

### BASIC MODELS ###

#First, re-order all variables to get desired reference category for plotting - put largest category as reference

Education
```{r}

dat <- dat %>%
  mutate(A_Levels_higher =
           case_when(highest_education == "No formal qualifications" ~ "No",
                     highest_education == "GCSE/CSE" ~ "No",
                     highest_education == "NVQ" ~ "No",
                       highest_education == "A-levels" ~"Yes",
                       highest_education == "University/Other professional qualifications" ~ "Yes"
             
           ))



#Check
dat %>%
  freq(A_Levels_higher)

```

Age
```{r}

dat <- dat %>%
  mutate(age_category_COVID_baseline =
           case_when(age_category_COVID_baseline == "16-25" ~ "16-25",
                     age_category_COVID_baseline == "26-35" ~ "26-35",
                     age_category_COVID_baseline == "36-45" ~ "36-45",
                       age_category_COVID_baseline == "46-55" ~"46-55",
                       age_category_COVID_baseline == "56-65" ~ "56-65",
                     age_category_COVID_baseline  == "66-70" ~ "66-70",
                     age_category_COVID_baseline == "71-75" ~ "71+",
                     age_category_COVID_baseline == "75+" ~ "71+",
                     
            ))

#Reorder education 
dat <- dat %>%
  mutate(age_category_COVID_baseline = factor(age_category_COVID_baseline,
                       levels = c("56-65",
                                  "16-25",
                                  "26-35",
                                  "36-45",
                                  "46-55",
                                   "66-70",
                                   "71+"
                                  
                         
          )))

#Check
dat %>%
  freq(age_category_COVID_baseline)
```
Race
```{r}

#Reorder education 
dat <- dat %>%
  mutate(ethnicity_binary = factor(ethnicity_binary,
                       levels = c("White",
                                  "Racially minoritised"
                                  )))
dat %>%
  freq(ethnicity_binary)
```
Psych disorder
```{r}
dat <- dat %>%
  mutate(psych_disorder_factor =
           case_when(
            psych_disorder_factor =="No psychiatric disorder" ~ "No",
           psych_disorder_factor == "Psychiatric disorder" ~ "Yes")
  )

#Check 
dat %>%
  freq(psych_disorder_factor)
```

Explore absolute risk across each minimal explanatory variable group for each phenotype

Binge eating - age
```{r}
dat_no_na <- dat %>%
  filter(!is.na(NEW_binge_eating_pandemic))

dat_no_na %>%
  nrow()

dat_no_na %>%
  group_by(age_category_COVID_baseline) %>%
  count(NEW_binge_eating_pandemic)
```


#Binge eating - minimal model
```{r}
# Age and gender and ethnicity 
model1 <- glm(NEW_binge_eating_pandemic ~ gender_cleaned +age_category_COVID_baseline +  ethnicity_binary + A_Levels_higher + psych_disorder_factor,
               data = dat,
               family = "binomial")

tidy(model1,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model1) %>% 
  length()

```

#Plot! Binge eating - minimal model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_binge_eating" = "NEW_binge_eating_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor"
         )


#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder")


dependent <- "Pandemic_binge_eating"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of binge eating during pandemic",
          remove_ref = TRUE)


```


# Low weight - minimal model
```{r}
# Age and gender and ethnicity 
model2 <- glm(NEW_low_weight_pandemic ~ age_category_COVID_baseline + gender_cleaned + ethnicity_binary+ psych_disorder_factor+ A_Levels_higher,
               data = dat,
               family = "binomial")

tidy(model2,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model2) %>% 
  length()
```

#Plot! Low weight - minimal model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_low_weight" = "NEW_low_weight_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor")

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder")


dependent <- "Pandemic_low_weight"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of low weight during pandemic",
          remove_ref = TRUE)


```
# Passive suicial ideation - minimal model
```{r}
#Recode to factor
dat <- dat %>%
  mutate(PREPANDEMIC_passive_suicidal_ideation_factor = 
           case_when(PREPANDEMIC_passive_suicidal_ideation == 1 ~ "Yes",
                     PREPANDEMIC_passive_suicidal_ideation == 0 ~ "No")
         )


dat %>%
  freq(PREPANDEMIC_passive_suicidal_ideation)

# Age and gender and ethnicity and pre-pan exp
model3 <- glm(passive_suicidal_ideation_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + ethnicity_binary+ A_Levels_higher + psych_disorder_factor+ PREPANDEMIC_passive_suicidal_ideation_factor,
               data = dat,
               family = "binomial")

tidy(model3,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model3) %>% 
  length() 

```

#Plot! Passive suicial ideation - minimal model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_passive_suicidal_ideation" = "passive_suicidal_ideation_PANDEMIC",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
         "Prepan_experience" = "PREPANDEMIC_passive_suicidal_ideation_factor")


#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience")


dependent <- "Pandemic_passive_suicidal_ideation"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Passive suicidal ideation during pandemic",
          remove_ref = TRUE)

```
# Self-harm ideation - minimal model
```{r}
#Recode to factor
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_ideation_factor = 
           case_when(PREPANDEMIC_selfharm_ideation == 1 ~ "Yes",
                     PREPANDEMIC_selfharm_ideation == 0 ~ "No")
         )


dat %>%
  freq(PREPANDEMIC_selfharm_ideation_factor)


# Age and gender and ethnicity 
model4 <- glm(selfharm_ideation_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + ethnicity_binary+ A_Levels_higher + psych_disorder_factor + PREPANDEMIC_selfharm_ideation_factor,
               data = dat,
               family = "binomial")

tidy(model4,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model4) %>% 
  length()
```

#Plot! Self-harm ideation - minimal model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_selfharm_ideation" = "selfharm_ideation_PANDEMIC",
         "Education" = "highest_education",
         "Prepan_experience" = "PREPANDEMIC_selfharm_ideation_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor")


#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience")


dependent <- "Pandemic_selfharm_ideation"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm ideation during pandemic",
          remove_ref = TRUE)


```

# Self-harm - minimal model
```{r}

#Recode to factor
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_factor = 
           case_when(PREPANDEMIC_selfharm == 1 ~ "Yes",
                     PREPANDEMIC_selfharm == 0 ~ "No")
         )


dat %>%
  freq(PREPANDEMIC_selfharm_factor)


# Age and gender and ethnicity 
model5 <- glm(selfharm_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + ethnicity_binary + A_Levels_higher +psych_disorder_factor+ PREPANDEMIC_selfharm,
               data = dat,
               family = "binomial")

tidy(model5,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model5) %>% 
  length()


```

#Plot! Self-harm - minimal model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_selfharm" = "selfharm_PANDEMIC",
         "Prepan_experience" = "PREPANDEMIC_selfharm_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor")


#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience")


dependent <- "Pandemic_selfharm"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "Self-harm during pandemic",
          remove_ref = TRUE)


```
         


#### ADDING PSYCH DISORDER STATUS + KEY WORKER + VULNERABLE GROUP + PANDEMIC WORRY + COVID TEST + LOSS OF LOVED ONE + LONELINESS + MAIN ECO CHANGE + LIVING SITUATION CHANGE ####

Re-order / rename variables ready for plotting
Member of vulnerable group
```{r}
dat <- dat %>%
  mutate(vulnerable_group_member = 
           case_when(vulnerable_group_member == "I am not a member of a vulnerable group" ~ "No",
                     vulnerable_group_member == "Not I am not a member of a vulnerable group" ~ "Yes"))


freq(dat$vulnerable_group_member)
```
Key worker
```{r}
dat <- dat %>%
  mutate(key_worker = 
           case_when(key_worker == "No key worker" ~ "No",
                     key_worker == "Key worker" ~ "Yes"))


freq(dat$key_worker)

```
Employment
```{r}
dat <- dat %>%
  mutate(employed_key = factor(employed_key,
                       levels = c("Yes",
                                  "Yes, key",
                                  "No",
                                  "Student"
                                  )))

dat %>%
  freq(employed_key)

```



#COVID model - Binge eating

```{r}
#  Age + gender + ethnicity + highest education + control+ vulnerable group + key worker status + pandemic worry + covid test - Binge eating
model6 <- glm(NEW_binge_eating_pandemic ~  age_category_COVID_baseline + gender_cleaned + ethnicity_binary + highest_education + psych_disorder_factor + employed_key + vulnerable_group_member +  covid_test_final + loss_of_loved_one_final + increased_loneliness_during_pandemic + main_economic_activity_change + living_situation_change,
               data = dat,
               family = "binomial")

tidy(model6,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model6) %>% 
  length()

dat %>%
  freq(employed_key)
```


#Plot! Binge eating - COVID model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_binge_eating" = "NEW_binge_eating_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "covid_test_final",
         "Loss" = "loss_of_loved_one_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_economic_activity_change",
         "Living_sit_change" = "living_situation_change"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")


dependent <- "Pandemic_binge_eating"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of binge eating during pandemic",
          remove_ref = TRUE) +
theme_bw()

```
Exploring absolute risk of significant predictors in fully adjusted model

Gender
```{r}
dat_no_na <- dat %>%
  filter(!is.na(NEW_binge_eating_pandemic))

dat_no_na %>%
  nrow()

dat_no_na %>%
  group_by(gender_cleaned) %>%
  count(NEW_binge_eating_pandemic)
```
Psych disorder
```{r}
dat_no_na %>%
  group_by(psych_disorder_factor) %>%
  count(NEW_binge_eating_pandemic)
```

Living experience
```{r}
dat_no_na %>%
  group_by(living_situation_change) %>%
  count(NEW_binge_eating_pandemic)
```
#  Age + gender + ethnicity + highest education +  control + vulnerable group + key worker status + pandemic worry + covid test- - Low weight
```{r}
#  Age + gender + ethnicity + highest education +  control + vulnerable group + key worker status + pandemic worry + covid test- - Low weight
model7 <- glm(NEW_low_weight_pandemic ~ age_category_COVID_baseline + gender_cleaned + ethnicity_binary + highest_education + psych_disorder_factor + employed_key + vulnerable_group_member +panworry_total_score_percent + covid_test_final,
               data = dat,
               family = "binomial")

tidy(model7,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model7) %>% 
  length()
```

#Plot!  Low weight - COVID model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_low_weight" = "NEW_low_weight_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
        "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "covid_test_final",
         "Loss" = "loss_of_loved_one_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_economic_activity_change",
         "Living_sit_change" = "living_situation_change"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")


dependent <- "Pandemic_low_weight"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of low weight during pandemic",
          remove_ref = TRUE)
```


#  Age + gender + ethnicity + highest education +  control + vulnerable group + key worker status + pandemic worry + covid test-  - Passive suicial ideation
```{r}

#  Age + gender + ethnicity + highest education +  control + vulnerable group + key worker status + pandemic worry + covid test- - Low weight
model8 <- glm(passive_suicidal_ideation_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + ethnicity_binary + highest_education + psych_disorder_factor + PREPANDEMIC_passive_suicidal_ideation_factor + employed_key + vulnerable_group_member +panworry_total_score_percent + covid_test_final,
               data = dat,
               family = "binomial")

tidy(model8,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model8) %>% 
  length()

```

#Plot! AAge + gender + ethnicity + highest education +  control + vulnerable group + key worker status + pandemic worry + covid test- Passive suicial ideation
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_suicidal_ideation" = "passive_suicidal_ideation_PANDEMIC",
          "Prepan_experience" = "PREPANDEMIC_passive_suicidal_ideation_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
        "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "covid_test_final",
         "Loss" = "loss_of_loved_one_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_economic_activity_change",
         "Living_sit_change" = "living_situation_change"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")


dependent <- "Pandemic_suicidal_ideation"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Passive suicidal ideation during pandemic",
          remove_ref = TRUE)

```

# Self harm ideation - COVID model
```{r}

#  Age + gender + ethnicity + highest education +  control + vulnerable group + key worker status + pandemic worry + covid test- - Low weight
model9 <- glm(selfharm_ideation_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + ethnicity_binary + highest_education + psych_disorder_factor +PREPANDEMIC_selfharm_ideation_factor+ employed_key + vulnerable_group_member +panworry_total_score_percent + covid_test_final,
               data = dat,
               family = "binomial")

tidy(model9,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model9) %>% 
  length()
```

#Plot! Self harm ideation - COVID model
```{r}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_selfharm_ideation" = "selfharm_ideation_PANDEMIC",
          "Prepan_experience" = "PREPANDEMIC_selfharm_ideation_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
        "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "covid_test_final",
         "Loss" = "loss_of_loved_one_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_economic_activity_change",
         "Living_sit_change" = "living_situation_change"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")


dependent <- "Pandemic_selfharm_ideation"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm ideation during pandemic",
          remove_ref = TRUE)
```

#  Self harm - COVID model
```{r}

#  Age + gender + ethnicity + highest education +  control + vulnerable group + key worker status + pandemic worry + covid test- - Low weight
model10 <- glm(selfharm_PANDEMIC ~age_category_COVID_baseline + gender_cleaned + ethnicity_binary + highest_education + psych_disorder_factor + PREPANDEMIC_selfharm_factor + employed_key + vulnerable_group_member  + covid_test_final,
               data = dat,
               family = "binomial")

tidy(model10,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model10) %>% 
  length()


```

#Plot! Self harm - COVID model
```{r}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "ethnicity_binary",
         "Pandemic_selfharm" = "selfharm_PANDEMIC",
          "Prepan_experience" = "PREPANDEMIC_selfharm_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
        "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "covid_test_final",
         "Loss" = "loss_of_loved_one_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_economic_activity_change",
         "Living_sit_change" = "living_situation_change"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")



dependent <- "Pandemic_selfharm"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm during pandemic",
          remove_ref = TRUE)
```







