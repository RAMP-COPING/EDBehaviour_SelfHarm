---
title: "Regressions2"
author: "Helena Davies"
date: "24/05/2021"
output: html_document
---

# Set up
```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)
```

Delete everything in your global environment
```{r Delete everything in your global environment}
remove(list = ls())
```

Call in library script
```{r source files}
source("./libraries.R")
```

Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

R functions
```{r call in function library functions}
# source all functions in the function folder
source("./functions.R")
```

# Read in data
```{r Read in data}
dat <- readRDS(file = "../data_cleaned/test_dat2021-08-16.rds")
dim(dat)
colnames(dat)
```
```{r}
dat %>%
   filter(passive_suicidal_ideation_PANDEMIC == 1) %>%
   freq(positive_covid_test_before_BE_merged)

dat %>%
   filter(passive_suicidal_ideation_PANDEMIC == 0) %>%
   freq(positive_covid_test_before_BE_merged)

dat %>%
   filter(NEW_binge_eating_pandemic == 1) %>%
   freq(living_situation_change_before_BE_final)

dat %>%
   filter(NEW_binge_eating_pandemic == 0) %>%
   freq(living_situation_change_before_BE_final)


mytable <- table(dat$NEW_binge_eating_pandemic, 
         dat$living_situation_change_before_BE_final)

```

# CORRELATION MATRICES of exposure variables (assessing multicollinearity)
## Dummy coding variables
```{r Dummy coding categorical variables}

descriptives.columns.dummy <- c(
  "gender_cleaned",
  "age_category_COVID_baseline",
  "race_binary",
  "A_Levels_higher",
  "psych_disorder_factor",
  "employed_key",
  "vulnerable_group_member",
  "positive_covid_test_before_BE_merged",
  "positive_covid_test_before_LW_merged",
  "positive_covid_test_before_PSS_merged",
  "positive_covid_test_before_SHI_merged",
  "positive_covid_test_before_SH_merged",
  "lost_someone_before_BE_final",
  "lost_someone_before_LW_final",
  "lost_someone_before_PSS_final",
  "lost_someone_before_SHI_final",
  "lost_someone_before_SH_final",
  "increased_loneliness_during_pandemic",
  "main_eco_change_before_BE_final",
  "main_eco_change_before_LW_final",
  "main_eco_change_before_PSS_final",
  "main_eco_change_before_SHI_final",
  "main_eco_change_before_SH_final",
  "living_situation_change_before_BE_final",
  "living_situation_change_before_LW_final",
  "living_situation_change_before_PSS_final",
  "living_situation_change_before_SHI_final",
  "living_situation_change_before_SH_final"
)
```

Data frame of dummy variables
```{r Data frame dummy variables}
dat_dummy <- fastDummies::dummy_cols(dat,
                                     select_columns = descriptives.columns.dummy)
# Check
dat_dummy %>%
  colnames()
```

## Binge eating
```{r Select variables for binge eating correlation matrix}

# Select items for correlation matrix
BE.dat.corr.mat <- dat_dummy %>%
  select(
   "Man" = "gender_cleaned_Man",
   "Woman" = "gender_cleaned_Woman",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71-75" = "age_category_COVID_baseline_71+",
   "White" = "race_binary_White",
   "A-Levels_higher" = "A_Levels_higher_Yes",
   "Psych_disorder" ="psych_disorder_factor_Psychiatric disorder",
   "Employed_not_key" ="employed_key_Yes",
   "Employed_key"  = "employed_key_Yes, key",
   "Unemployed" = "employed_key_No",
   "Student" = "employed_key_Student",
   "Vulnerable_group" = "vulnerable_group_member_Yes",
   "Positive_COVID_test" = "positive_covid_test_before_BE_merged_Yes",
   "Loss" = "lost_someone_before_BE_final_Yes",
   "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
   "Change_main_eco" = "main_eco_change_before_BE_final_Yes",
   "Change_living_sit" ="living_situation_change_before_BE_final_Yes"
 ) %>%
  polycor::hetcor(use = "pairwise.complete.obs") # Remember to specify "pairwise.complete.obs"!

# Save the correlations from the correlation matrix in an object
BE.dat.corr.matrix <- as.matrix(BE.dat.corr.mat)

# Save the p values from the correlation matrix in an object
BE.dat.p.matrix <- as.matrix(BE.dat.corr.mat$tests)
```

Create the correlation matrix plot using the corrplot package
```{r Create binge eating correlation matrix at t1 plot, fig.height=7}

BE.dat.corr.matrix %>%
  corrplot::corrplot(method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.8,
         number.cex = 0.75,
         tl.col = "black",
         col=colorRampPalette(c("dodgerblue4",
                                "white",
                                "firebrick4"))(200), # colours for correlations
         # Combine with significance
         p.mat = BE.dat.p.matrix, # Matrix with p values
         sig.level = 0.01, # Choose significant level
         insig = "blank") # Nonsignificant correlations have no colour
      
```

## Low weight
```{r Select variables for low weight correlation matrix}

# Select items for correlation matrix
LW.dat.corr.mat <- dat_dummy %>%
  select(
   "Man" = "gender_cleaned_Man",
   "Woman" = "gender_cleaned_Woman",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71-75" = "age_category_COVID_baseline_71+",
   "White" = "race_binary_White",
   "A-Levels_higher" = "A_Levels_higher_Yes",
   "Psych_disorder" ="psych_disorder_factor_Psychiatric disorder",
   "Employed_not_key" ="employed_key_Yes",
   "Employed_key"  = "employed_key_Yes, key",
   "Unemployed" = "employed_key_No",
   "Student" = "employed_key_Student",
   "Vulnerable_group" = "vulnerable_group_member_Yes",
   "Positive_COVID_test" = "positive_covid_test_before_LW_merged_Yes",
   "Loss" = "lost_someone_before_LW_final_Yes",
   "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
   "Change_main_eco" = "main_eco_change_before_LW_final_Yes",
   "Change_living_sit" ="living_situation_change_before_LW_final_Yes"
 ) %>%
  polycor::hetcor(use = "pairwise.complete.obs") # Remember to specify "pairwise.complete.obs"!

# Save the correlations from the correlation matrix in an object
LW.dat.corr.matrix <- as.matrix(LW.dat.corr.mat)

# Save the p values from the correlation matrix in an object
LW.dat.p.matrix <- as.matrix(LW.dat.corr.mat$tests)
```
Create the correlation matrix plot using the corrplot package
```{r Create low weight correlation matrix at t1 plot, fig.height=7}

LW.dat.corr.matrix %>%
  corrplot::corrplot(method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.8,
         number.cex = 0.75,
         tl.col = "black",
         col=colorRampPalette(c("dodgerblue4",
                                "white",
                                "firebrick4"))(200), # colours for correlations
         # Combine with significance
         p.mat = LW.dat.p.matrix, # Matrix with p values
         sig.level = 0.01, # Choose significant level
         insig = "blank") # Nonsignificant correlations have no colour
      
```
## Passive suicidal ideation
```{r Select variables for passive suicidal ideation correlation matrix}

# Select items for correlation matrix
PSS.dat.corr.mat <- dat_dummy %>%
  select(
   "Man" = "gender_cleaned_Man",
   "Woman" = "gender_cleaned_Woman",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71-75" = "age_category_COVID_baseline_71+",
   "White" = "race_binary_White",
   "A-Levels_higher" = "A_Levels_higher_Yes",
   "Psych_disorder" ="psych_disorder_factor_Psychiatric disorder",
   "Employed_not_key" ="employed_key_Yes",
   "Employed_key"  = "employed_key_Yes, key",
   "Unemployed" = "employed_key_No",
   "Student" = "employed_key_Student",
   "Vulnerable_group" = "vulnerable_group_member_Yes",
   "Positive_COVID_test" = "positive_covid_test_before_PSS_merged_Yes",
   "Loss" = "lost_someone_before_PSS_final_Yes",
   "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
   "Change_main_eco" = "main_eco_change_before_PSS_final_Yes",
   "Change_living_sit" ="living_situation_change_before_PSS_final_Yes"
 ) %>%
  polycor::hetcor(use = "pairwise.complete.obs") # Remember to specify "pairwise.complete.obs"!

# Save the correlations from the correlation matrix in an object
PSS.dat.corr.matrix <- as.matrix(PSS.dat.corr.mat)

# Save the p values from the correlation matrix in an object
PSS.dat.p.matrix <- as.matrix(PSS.dat.corr.mat$tests)
```
Create the correlation matrix plot using the corrplot package
```{r Create passive suicidal ideation correlation matrix at t1 plot, fig.height=7}

PSS.dat.corr.matrix %>%
  corrplot::corrplot(method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.8,
         number.cex = 0.75,
         tl.col = "black",
         col=colorRampPalette(c("dodgerblue4",
                                "white",
                                "firebrick4"))(200), # colours for correlations
         # Combine with significance
         p.mat = PSS.dat.p.matrix, # Matrix with p values
         sig.level = 0.01, # Choose significant level
         insig = "blank") # Nonsignificant correlations have no colour
      
```

## Self-harm ideation
```{r Select variables for self-harm ideation correlation matrix}

# Select items for correlation matrix
SHI.dat.corr.mat <- dat_dummy %>%
  select(
   "Man" = "gender_cleaned_Man",
   "Woman" = "gender_cleaned_Woman",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71-75" = "age_category_COVID_baseline_71+",
   "White" = "race_binary_White",
   "A-Levels_higher" = "A_Levels_higher_Yes",
   "Psych_disorder" ="psych_disorder_factor_Psychiatric disorder",
   "Employed_not_key" ="employed_key_Yes",
   "Employed_key"  = "employed_key_Yes, key",
   "Unemployed" = "employed_key_No",
   "Student" = "employed_key_Student",
   "Vulnerable_group" = "vulnerable_group_member_Yes",
   "Positive_COVID_test" = "positive_covid_test_before_SHI_merged_Yes",
   "Loss" = "lost_someone_before_SHI_final_Yes",
   "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
   "Change_main_eco" = "main_eco_change_before_SHI_final_Yes",
   "Change_living_sit" ="living_situation_change_before_SHI_final_Yes"
 ) %>%
  polycor::hetcor(use = "pairwise.complete.obs") # Remember to specify "pairwise.complete.obs"!

# Save the correlations from the correlation matrix in an object
SHI.dat.corr.matrix <- as.matrix(SHI.dat.corr.mat)

# Save the p values from the correlation matrix in an object
SHI.dat.p.matrix <- as.matrix(SHI.dat.corr.mat$tests)
```

Create the correlation matrix plot using the corrplot package
```{r Create self-harm ideation correlation matrix at t1 plot, fig.height=7}

SHI.dat.corr.matrix %>%
  corrplot::corrplot(method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.8,
         number.cex = 0.75,
         tl.col = "black",
         col=colorRampPalette(c("dodgerblue4",
                                "white",
                                "firebrick4"))(200), # colours for correlations
         # Combine with significance
         p.mat = SHI.dat.p.matrix, # Matrix with p values
         sig.level = 0.01, # Choose significant level
         insig = "blank") # Nonsignificant correlations have no colour
      
```

## Self-harm 
```{r Select variables for self-harm correlation matrix}

# Select items for correlation matrix
SH.dat.corr.mat <- dat_dummy %>%
  select(
   "Man" = "gender_cleaned_Man",
   "Woman" = "gender_cleaned_Woman",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71-75" = "age_category_COVID_baseline_71+",
   "White" = "race_binary_White",
   "A-Levels_higher" = "A_Levels_higher_Yes",
   "Psych_disorder" ="psych_disorder_factor_Psychiatric disorder",
   "Employed_not_key" ="employed_key_Yes",
   "Employed_key"  = "employed_key_Yes, key",
   "Unemployed" = "employed_key_No",
   "Student" = "employed_key_Student",
   "Vulnerable_group" = "vulnerable_group_member_Yes",
   "Positive_COVID_test" = "positive_covid_test_before_SH_merged_Yes",
   "Loss" = "lost_someone_before_SH_final_Yes",
   "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
   "Change_main_eco" = "main_eco_change_before_SH_final_Yes",
   "Change_living_sit" ="living_situation_change_before_SH_final_Yes"
 ) %>%
  polycor::hetcor(use = "pairwise.complete.obs") # Remember to specify "pairwise.complete.obs"!

# Save the correlations from the correlation matrix in an object
SH.dat.corr.matrix <- as.matrix(SH.dat.corr.mat)

# Save the p values from the correlation matrix in an object
SH.dat.p.matrix <- as.matrix(SH.dat.corr.mat$tests)
```

Create the correlation matrix plot using the corrplot package
```{r Create self-harm correlation matrix at t1 plot, fig.height=7}

SH.dat.corr.matrix %>%
  corrplot::corrplot(method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.8,
         number.cex = 0.75,
         tl.col = "black",
         col=colorRampPalette(c("dodgerblue4",
                                "white",
                                "firebrick4"))(200), # colours for correlations
         # Combine with significance
         p.mat = SH.dat.p.matrix, # Matrix with p values
         sig.level = 0.01, # Choose significant level
         insig = "blank") # Nonsignificant correlations have no colour
      
```



## BASIC MODELS 

# Re-ordering variables / converting to factors
First, re-order all variables to get desired reference category for plotting - put largest category as reference

Education
```{r Re-order education levels}
dat <- dat %>%
  mutate(A_Levels_higher = factor(A_Levels_higher,
                       levels = c("Yes", # Largest category
                                  "No")
                       )
         )

# Check
dat %>%
  freq(A_Levels_higher)
```

Age
```{r Re-order age levels}
dat <- dat %>%
  mutate(age_category_COVID_baseline = factor(age_category_COVID_baseline,
                       levels = c("56-65", # Largest category
                                  "16-25",
                                  "26-35",
                                  "36-45",
                                  "46-55",
                                   "66-70",
                                   "71+")
                       )
         )

# Check
dat %>%
  freq(age_category_COVID_baseline)
```

Race
```{r Re-order race levels}
dat <- dat %>%
  mutate(race_binary = factor(race_binary,
                       levels = c("White", # Largest category
                                  "Racially minoritised"
                                  )))
dat %>%
  freq(race_binary)
```

Psychiatric disorder
```{r  Re-order psych disorder levels}
# First recode to "Yes" and "No"
dat <- dat %>%
  mutate(psych_disorder_factor =
           case_when(
            psych_disorder_factor == "Psychiatric disorder" ~ "Yes", 
           psych_disorder_factor == "No psychiatric disorder" ~ "No")
  )

# Check 
dat %>%
  freq(psych_disorder_factor)

# Then change order
dat <- dat %>%
  mutate(psych_disorder_factor = factor(psych_disorder_factor,
                       levels = c("Yes", # Largest category
                                  "No"
                                  )))

# Check again
dat %>%
  freq(psych_disorder_factor)
```
Recode prepandemic PSS to factor
```{r Recode prepandemic PSS to factor}
dat <- dat %>%
  mutate(PREPANDEMIC_passive_suicidal_ideation_factor = 
           case_when(PREPANDEMIC_passive_suicidal_ideation == 1 ~ "Yes",
                     PREPANDEMIC_passive_suicidal_ideation == 0 ~ "No")
         )


dat %>%
  freq(PREPANDEMIC_passive_suicidal_ideation_factor)
```

Recode prepandemic SHI to factor
```{r Recode prepandemic SHI to factor}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_ideation_factor = 
           case_when(PREPANDEMIC_selfharm_ideation == 1 ~ "Yes",
                     PREPANDEMIC_selfharm_ideation == 0 ~ "No")
         )


dat %>%
  freq(PREPANDEMIC_selfharm_ideation_factor)
```

Recode prepandemic SH to factor
```{r Recode prepandemic SH to factor}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_factor = 
           case_when(PREPANDEMIC_selfharm == 1 ~ "Yes",
                     PREPANDEMIC_selfharm == 0 ~ "No")
         )


dat %>%
  freq(PREPANDEMIC_selfharm_factor)
```

# Binge eating - minimal model
Age, gender, race, education, psych disorder
```{r Binge eating minimal model}
model1 <- glm(NEW_binge_eating_pandemic ~ gender_cleaned + age_category_COVID_baseline +  race_binary + A_Levels_higher + psych_disorder_factor,
               data = dat,
               family = "binomial")

tidy(model1,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model1) %>% 
  length()
```

Plot
```{r Binge eating minimal model plot}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_binge_eating" = "NEW_binge_eating_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor"
         )


# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder")


dependent <- "Pandemic_binge_eating"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of binge eating during pandemic",
          remove_ref = TRUE)
```

# Low weight - minimal model
Age, gender, race, education, psych disorder
```{r Low weight minimal model}
model2 <- glm(NEW_low_weight_pandemic ~ age_category_COVID_baseline + gender_cleaned + race_binary+ psych_disorder_factor+ A_Levels_higher,
               data = dat,
               family = "binomial")

tidy(model2,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model2) %>% 
  length()
```

Plot
```{r Low weight minimal model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_low_weight" = "NEW_low_weight_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor")

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder")


dependent <- "Pandemic_low_weight"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of low weight during pandemic",
          remove_ref = TRUE)
```

# Passive suicial ideation - minimal model
Age, gender, race, education, psych disorder, prepandemic experience
```{r Passive suicial ideation minimal model}
model3 <- glm(passive_suicidal_ideation_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + race_binary+ A_Levels_higher + psych_disorder_factor+ PREPANDEMIC_passive_suicidal_ideation_factor,
               data = dat,
               family = "binomial")

tidy(model3,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model3) %>% 
  length() 
```

Plot
```{r Passive suicial ideation minimal model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_passive_suicidal_ideation" = "passive_suicidal_ideation_PANDEMIC",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
         "Prepan_experience" = "PREPANDEMIC_passive_suicidal_ideation_factor")

# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience")


dependent <- "Pandemic_passive_suicidal_ideation"


dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Passive suicidal ideation during pandemic",
          remove_ref = TRUE)

```

# Self-harm ideation - minimal model
Age, gender, race, education, psych disorder, prepandemic experience
```{r Self-harm ideation minimal model}
model4 <- glm(selfharm_ideation_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + race_binary+ A_Levels_higher + psych_disorder_factor + PREPANDEMIC_selfharm_ideation_factor,
               data = dat,
               family = "binomial")

tidy(model4,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model4) %>% 
  length()
```

Plot
```{r Self-harm ideation minimal model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_selfharm_ideation" = "selfharm_ideation_PANDEMIC",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
         "Prepan_experience" = "PREPANDEMIC_selfharm_ideation_factor")

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience")

dependent <- "Pandemic_selfharm_ideation"

dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm ideation during pandemic",
          remove_ref = TRUE)
```

# Self-harm - minimal model
Age, gender, race, education, psych disorder, prepandemic experience
```{r Self-harm minimal model}
model5 <- glm(selfharm_PANDEMIC ~ age_category_COVID_baseline + gender_cleaned + race_binary + A_Levels_higher +psych_disorder_factor+ PREPANDEMIC_selfharm,
               data = dat,
               family = "binomial")

tidy(model5,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model5) %>% 
  length()
```

Plot
```{r Self-harm minimal model}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_selfharm" = "selfharm_PANDEMIC",
         "Prepan_experience" = "PREPANDEMIC_selfharm_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor")

# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience")


dependent <- "Pandemic_selfharm"

dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "Self-harm during pandemic",
          remove_ref = TRUE)
```
         
# EXTENDED MODELS
Adding: Key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation

## Re-order / rename variables ready for plotting

Employment
```{r Re-order employment variable}
dat <- dat %>%
  mutate(employed_key = factor(employed_key,
                       levels = c("Yes",
                                  "Yes, key",
                                  "No",
                                  "Student"
                                  )))

dat %>%
  freq(employed_key)
```

# Binge eating - extended model
Age, gender, race, education, psych disorder, key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation
```{r Binge eating extended model}
model6 <- glm(NEW_binge_eating_pandemic ~  age_category_COVID_baseline +
                 gender_cleaned +
                 race_binary +
                 A_Levels_higher +
                 psych_disorder_factor +
                 employed_key +
                 vulnerable_group_member +
                 positive_covid_test_before_BE_merged +
                 lost_someone_before_BE_final +
                 increased_loneliness_during_pandemic +
                 main_eco_change_before_BE_final +
                 living_situation_change_before_BE_final,
               data = dat,
               family = "binomial")

tidy(model6,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model6) %>% 
  length()
```

Plot
```{r Binge eating extended model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_binge_eating" = "NEW_binge_eating_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
       #  "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "positive_covid_test_before_BE_merged", # .3 % of BE sample
         "Loss" = "lost_someone_before_BE_final", # 1.4 % of BE sample
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_BE_final", # 9% of sample
         "Living_sit_change" = "living_situation_change_before_BE_final" # 4% of BE sample
         
        )


# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
               #  "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change"
               )

dependent <- "Pandemic_binge_eating"

dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of binge eating during pandemic",
          remove_ref = TRUE) +
theme_bw()

```

# Low weight - extended model
Age, gender, race, education, psych disorder, key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation
```{r Low weight extended model}
model7 <- glm(NEW_low_weight_pandemic ~ age_category_COVID_baseline +
                 gender_cleaned +
                 race_binary +
                 A_Levels_higher +
                 psych_disorder_factor +
                 employed_key +
                 vulnerable_group_member +
                 # panworry_total_score_percent + 
                 positive_covid_test_before_LW_merged + 
                 lost_someone_before_LW_final + 
                 increased_loneliness_during_pandemic + 
                 main_eco_change_before_LW_final + 
                 living_situation_change_before_LW_final,
               data = dat,
               family = "binomial")

tidy(model7,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model7) %>% 
  length()
```

Plot
```{r Low weight extended model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_low_weight" = "NEW_low_weight_pandemic",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
       # "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "positive_covid_test_before_LW_merged",
         "Loss" = "lost_someone_before_LW_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_LW_final",
         "Living_sit_change" = "living_situation_change_before_LW_final"
         
        )

# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
                # "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")

dependent <- "Pandemic_low_weight"

dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "New experience of low weight during pandemic",
          remove_ref = TRUE)
```

# Passive suicidal ideation - extended model
Age, gender, race, education, psych disorder, key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation
```{r Passive suicidal ideation extended model}
model8 <- glm(passive_suicidal_ideation_PANDEMIC ~ age_category_COVID_baseline + 
                 gender_cleaned + 
                 race_binary + 
                 A_Levels_higher + 
                 psych_disorder_factor + 
                 PREPANDEMIC_passive_suicidal_ideation_factor + 
                 employed_key + 
                 vulnerable_group_member + 
                # panworry_total_score_percent + 
                 positive_covid_test_before_PSS_merged + 
                 lost_someone_before_PSS_final + 
                 increased_loneliness_during_pandemic +
                 main_eco_change_before_PSS_final +
                 living_situation_change_before_PSS_final,
               data = dat,
               family = "binomial")

tidy(model8,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model8) %>% 
  length()

```


Plot
```{r Passive suicidal ideation extended model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_suicidal_ideation" = "passive_suicidal_ideation_PANDEMIC",
          "Prepan_experience" = "PREPANDEMIC_passive_suicidal_ideation_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
        # "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "positive_covid_test_before_PSS_merged",
         "Loss" = "lost_someone_before_PSS_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_PSS_final",
         "Living_sit_change" = "living_situation_change_before_PSS_final"
         
        )

# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience",
                 "Employment",
                 "Vulnerable_group_member",
                # "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")

dependent <- "Pandemic_suicidal_ideation"

dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Passive suicidal ideation during pandemic",
          remove_ref = TRUE)
```

# Self-harm ideation - extended model
Age, gender, race, education, psych disorder, key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation
```{r Self-harm ideation extended model}
model9 <- glm(selfharm_ideation_PANDEMIC ~ age_category_COVID_baseline + 
                 gender_cleaned + 
                 race_binary + 
                 A_Levels_higher + 
                 psych_disorder_factor + 
                 PREPANDEMIC_selfharm_ideation_factor + 
                 employed_key + 
                 vulnerable_group_member + 
                # panworry_total_score_percent + 
                 positive_covid_test_before_SHI_merged + 
                 lost_someone_before_SHI_final + 
                 increased_loneliness_during_pandemic + 
                 main_eco_change_before_SHI_final + 
                 living_situation_change_before_SHI_final,
               data = dat,
               family = "binomial")

tidy(model9,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model9) %>% 
  length()
```

Plot
```{r Self-harm ideation extended model plot}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_selfharm_ideation" = "selfharm_ideation_PANDEMIC",
          "Prepan_experience" = "PREPANDEMIC_selfharm_ideation_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
        "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
      #   "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "positive_covid_test_before_SHI_merged",
         "Loss" = "lost_someone_before_SHI_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_SHI_final",
         "Living_sit_change" = "living_situation_change_before_SHI_final"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience",
                 "Employment",
                 "Vulnerable_group_member",
             #    "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")

dependent <- "Pandemic_selfharm_ideation"

dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm ideation during pandemic",
          remove_ref = TRUE)
```

# Self-harm - extended model
Age, gender, race, education, psych disorder, key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation
```{r Self-harm extended model}
model10 <- glm(selfharm_PANDEMIC ~
                  age_category_COVID_baseline + 
                  gender_cleaned +
                  race_binary +
                  A_Levels_higher + 
                  psych_disorder_factor + 
                  PREPANDEMIC_selfharm_factor + 
                  employed_key + 
                  vulnerable_group_member + 
                  positive_covid_test_before_SH_merged + 
                  lost_someone_before_SH_final + 
                  increased_loneliness_during_pandemic + 
                  main_eco_change_before_SH_final + 
                  living_situation_change_before_SH_final,
               data = dat,
               family = "binomial")

tidy(model10,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model10) %>% 
  length()
```

Plot 
```{r Self-harm extended model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_selfharm" = "selfharm_PANDEMIC",
          "Prepan_experience" = "PREPANDEMIC_selfharm_factor",
         "A_Levels_higher" = "A_Levels_higher",
         "Psych_disorder" = "psych_disorder_factor",
        "Employment" = "employed_key",
         "Vulnerable_group_member" ="vulnerable_group_member",
       #  "Pandemic_worry" = "panworry_total_score_percent",
         "Covid_test" = "positive_covid_test_before_SH_merged",
         "Loss" = "lost_someone_before_SH_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_SH_final",
         "Living_sit_change" = "living_situation_change_before_SH_final"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "A_Levels_higher",
                 "Psych_disorder",
                 "Prepan_experience",
                 "Employment",
                 "Vulnerable_group_member",
              #   "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")

dependent <- "Pandemic_selfharm"

dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm during pandemic",
          remove_ref = TRUE)
```







