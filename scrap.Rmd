---
title: "Untitled"
author: "Helena Davies"
date: "19/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.







# Demographics 
## GLAD 1
### Read in data
```{r Read in data GLAD COPING demographic}
if(GLAD == TRUE){
glad.coping.dem.raw <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/glad/dem_glad.rds")
dim(glad.coping.dem.raw)
colnames(glad.coping.dem.raw)
}
```

Select variables
```{r Select variables GLAD COPING demographic}
if(GLAD == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

glad.coping.dem.raw.id <- glad.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         endDate,
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_pregnant,
         weight_lb_unc = dem.current_weight_provide_pregnant.1,
         weight_kg_unc = dem.current_weight_provide_pregnant.2,
         highest_weight_st_unc = dem.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = dem.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = dem.provide_pregnant_weighed_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.adult_height_lowest_weight.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.coping.dem.raw.id)
# Inspect colnames
colnames(glad.coping.dem.raw.id)
#Differences
dim(glad.coping.dem.raw)[1]-dim(glad.coping.dem.raw.id)[1]
}
```

Summarise GLAD COPING demographic
```{r GLAD COPING demographic summary, eval=FALSE, include=FALSE}
if(GLAD == TRUE) {
summarytools::dfSummary(
  glad.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```

# Demographics 
## EDGI 
### Read in data
```{r Read in data EDGI COPING demographics}
if(EDGI == TRUE){
edgi.coping.dem.raw <- readRDS(file = "../data_raw/edgi/dem_coping_edgi.rds")
dim(edgi.coping.dem.raw)
colnames(edgi.coping.dem.raw)
}
```

Select variables EDGI COPING demographics
```{r Select variables EDGI COPING demographics}
if(EDGI == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

edgi.coping.dem.raw.id <- edgi.coping.dem.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  distinct(externalDataReference, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = dem.which_gender_do_you_identify_with, # Gender
         sex = dem.select_questionnaire_items_medical, #Sex
         pregnant_binary = dem.baby_pregnant_months,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = dem.what_is_your_current_height,
         height_inch_unc = dem.what_is_your_current_height.1,
         height_cm_unc = dem.what_is_your_current_height.2,
         weight_st_unc = dem.current_weight_provide_weight,
         weight_lb_unc = dem.current_weight_provide_weight.1,
         weight_kg_unc = dem.current_weight_provide_weight.2,
         highest_weight_st_unc = dem.provide_weighed_pregnant_weight,
         highest_weight_lb_unc = dem.provide_weighed_pregnant_weight.1,
         highest_weight_kg_unc = dem.provide_weighed_pregnant_weight.2,
         lowest_weight_st_unc = dem.adult_height_reaching_weighed,
         lowest_weight_lb_unc = dem.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = dem.adult_height_reaching_weighed.2,
         age_highest_weight_unc = dem.highest_weight.txt,
         age_lowest_weight_unc = dem.lowest_weight_adult_height.txt,
         uk_location = dem.live,
         current_country = dem.in_which_country_do_you_currently_reside
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(edgi.coping.dem.raw.id)
# Inspect colnames
colnames(edgi.coping.dem.raw.id)
#Differences
dim(edgi.coping.dem.raw)[1]-dim(edgi.coping.dem.raw.id)[1]
}
```

Summarise EDGI COPING demographics
```{r Summarise EDGI COPING demographics}
if(EDGI == TRUE) {
summarytools::dfSummary(
  edgi.coping.dem.raw.id,
  graph.col = F,
  valid.col = F,
  labels.col = F)
}
```


# Demographics 
## NBR 1
### Read in data
```{r Read in data NBR demographics}
if(NBR == TRUE){
nbr.dem.raw <- readRDS(file = "../data_raw/nbr/demographics_coping_nbr.rds")
dim(nbr.dem.raw)
colnames(nbr.dem.raw)
}
```

Select variables
```{r Select variables NBR demographics}
if(NBR == TRUE){
exclude_cols_dem <- c("ID",
                  "cohort_name",
                  "startDate",
                  "endDate")

nbr.dem.raw.id <- nbr.dem.raw %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  distinct(subjectid, .keep_all = TRUE) %>% # Remove duplicates based on ID
  #separate(externalDataReference, into = c("Sample", "ID"), sep = 4) %>% # Split ID in Sample and Number
  #mutate(externalDataReference = as.numeric(externalDataReference)) %>%
  add_column(cohort_name = "nbr", .before = "startDate") %>% #create new column 
  select(
         ID = subjectid, # ID
         cohort_name, # Sample
         startDate_baseline = startDate,
         endDate,
         #startDate.prepandemic = startDate, #Date when participant signed up to glad
         #Age_uncleaned = demographics.how_old_are_you_now.txt, # Age
         gender_unc = demographics.which_gender_do_you_identify_with, # Gender
         sex = demographics.select_questionnaire_items_medical, #Sex
         pregnant_binary = demographics.baby_pregnant_months,
         birthday_day = demographics.day,
         birthday_month = demographics.month,
         birthday_year = demographics.year,
         #EduYrs = demographics.school_education_school_years.txt, # Years in education
         #demographics.college_or_university_degree, # level of education - univeristy
         #demographics.a_levelsas_levels_or_equivalent, # level of education - alevel
         #demographics.o_levelsgcses_or_equivalent, # level of education - gcse
         #demographics.cses_or_equivalent, # level of education - cse
         #demographics.nvq_or_hnd_or_hnc_or_equivalent, # level of education - nvq
         #Ethnicity_unc = demographics.questions_based_ethnic_origin # Ethnicity
         height_ft_unc = demographics.what_is_your_current_height,
         height_inch_unc = demographics.what_is_your_current_height.1,
         height_cm_unc = demographics.what_is_your_current_height.2,
         weight_st_unc = demographics.provide_current_weight_pregnant,
         weight_lb_unc = demographics.provide_current_weight_pregnant.1,
         weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         highest_weight_st_unc = demographics.provide_pregnant_weighed_weight,
         highest_weight_lb_unc = demographics.provide_pregnant_weighed_weight.1,
         highest_weight_kg_unc = demographics.provide_current_weight_pregnant.2,
         lowest_weight_st_unc = demographics.adult_height_reaching_weighed,
         lowest_weight_lb_unc = demographics.adult_height_reaching_weighed.1,
         lowest_weight_kg_unc = demographics.adult_height_reaching_weighed.2,
         age_highest_weight_unc = demographics.highest_weight.txt,
         age_lowest_weight_unc = demographics.adult_height_lowest_weight.txt,
         uk_location = demographics.live,
         current_country = demographics.in_which_country_do_you_currently_reside,
         
         
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(nbr.dem.raw.id)
# Inspect colnames
colnames(nbr.dem.raw.id)
#Differences
dim(nbr.dem.raw)[1]-dim(nbr.dem.raw.id)[1]
}
```

# Make list of EDEQ baseline columns only in RAMP
NB: The EDEQ is only asked at baseline in the RAMP study. Therefore, this dataset has columns that the other datasets do not. In order to merge, we need to create these columns within the other datasets.
```{r}
edeq_baseline_columnNames <- c("edeq.deliberately_limit_amount_influence_baseline",                     
                               "edeq.calories_made_body_shape_baseline",                               
                               "edeq.weight_influenced_person_baseline",                                
                               "edeq.dissatisfied_shape_weight_baseline",                              
                               "edeq.nibbled_picked_snacks_grazed_baseline",                            
                               "edeq.felt_anxious_blue_bored_baseline",                                
                               "edeq.felt_anxious_blue_bored.1_baseline",                              
                               "edeq.eating_behaviours_concerns_distressed_baseline",                  
                               "edeq.deliberately_limit_amount_influence.1_baseline",                   
                               "edeq.calories_made_body_shape.1_baseline",                              
                               "edeq.weight_influenced_person.1_baseline",                              
                               "edeq.dissatisfied_shape_weight.1_baseline",                            
                               "edeq.eating_behaviours_concerns_distressed.1_baseline",                 
                               "edeq.feelings_pandemic_felt_baseline",                                  
                               "edeq.actively_been_monitoring_your_shape_or_weight_baseline",           
                               "edeq.regard_lost_control_eaten_baseline",                               
                               "edeq.sick_means_made_shape_baseline",                                   
                               "edeq.diuretics_laxatives_means_shape_baseline",                         
                               "edeq.compulsive_driven_burn_calories_baseline",                         
                               "edeq.nibbled_picked_snacks_grazed.1_baseline",                         
                               "edeq.felt_anxious_blue_bored.2_baseline",                               
                               "edeq.felt_anxious_blue_bored.3_baseline",                               
                               "edeq.actively_been_monitoring_your_shape_or_weight_.1_baseline",        
                               "edeq.regard_lost_control_eaten.1_baseline",                             
                               "edeq.sick_means_made_shape.1_baseline",                                 
                               "edeq.diuretics_laxatives_means_shape.1_baseline",                       
                               "edeq.compulsive_driven_burn_calories.1_baseline",                       
                               "edeq.deliberately_limit_amount_influence_baseline_numeric",             
                               "edeq.calories_made_body_shape_baseline_numeric",                        
                               "edeq.weight_influenced_person_baseline_numeric",                        
                               "edeq.dissatisfied_shape_weight_baseline_numeric",                       
                               "edeq.nibbled_picked_snacks_grazed_baseline_numeric",                    
                               "edeq.felt_anxious_blue_bored_baseline_numeric",                         
                               "edeq.felt_anxious_blue_bored.1_baseline_numeric",                       
                               "edeq.eating_behaviours_concerns_distressed_baseline_numeric",           
                               "edeq.deliberately_limit_amount_influence.1_baseline_numeric",           
                               "edeq.calories_made_body_shape.1_baseline_numeric",                      
                               "edeq.weight_influenced_person.1_baseline_numeric",                      
                               "edeq.dissatisfied_shape_weight.1_baseline_numeric",                     
                               "edeq.eating_behaviours_concerns_distressed.1_baseline_numeric",         
                               "edeq.feelings_pandemic_felt_baseline_numeric",                          
                               "edeq.actively_been_monitoring_your_shape_or_weight_baseline_numeric",   
                               "edeq.regard_lost_control_eaten_baseline_numeric",                       
                               "edeq.sick_means_made_shape_baseline_numeric",                           
                               "edeq.diuretics_laxatives_means_shape_baseline_numeric",
                               "edeq.compulsive_driven_burn_calories_baseline_numeric",                 
                               "edeq.nibbled_picked_snacks_grazed.1_baseline_numeric",                  
                               "edeq.felt_anxious_blue_bored.2_baseline_numeric",                       
                               "edeq.felt_anxious_blue_bored.3_baseline_numeric",                       
                               "edeq.actively_been_monitoring_your_shape_or_weight_.1_baseline_numeric",
                               "edeq.regard_lost_control_eaten.1_baseline_numeric",                     
                               "edeq.sick_means_made_shape.1_baseline_numeric",                         
                               "edeq.diuretics_laxatives_means_shape.1_baseline_numeric",               
                               "edeq.compulsive_driven_burn_calories.1_baseline_numeric") 
                               
```

Add all above columns as NA in NBR, EDGI, & GLAD
```{r Add all EDEQ columns as NA in NBR, EDGI, GLAD}
nbr_baseline[edeq_baseline_columnNames] <- NA

glad_baseline[edeq_baseline_columnNames] <- NA

edgi_baseline[edeq_baseline_columnNames] <- NA
```
                                                          
Need same columns across all datasets in order to merge
The below chunk adds colummns to each dataset that are not present, to get the data ready to merge.
```{r Add columns ready to merge all datasets}

# Sex, age_category_numeric, mhd.suspected_eating_disorder_diagnosed_numeric, highest_education_prepan/numeric & age_category_COPING not in RAMP
ramp_baseline$sex <- NA
ramp_baseline$age_category_numeric <- NA
ramp_baseline$mhd.suspected_eating_disorder_diagnosed_numeric <- NA
ramp_baseline$employ.taking_unpaid_leave <- NA
ramp_baseline$highest_education_prepan <- NA
ramp_baseline$highest_education_prepan_numeric <- NA
ramp_baseline$age_category_COPING <- NA

# Transgender & highest_education_prepan/numeric & age_category_COPING not in NBR
nbr_baseline$transgender <- NA
nbr_baseline$highest_education_prepan <- NA
nbr_baseline$highest_education_prepan_numeric <- NA
nbr_baseline$age_category_COPING <- NA

```

Create empty wave 1a and 1bs in COPING to merge with RAMP 
```{r Create wave 1a and wave 1b columns in COPING}
edeq_coping_screener$ed_scid5.regular_episodes_eating_binges_.Wave_1a <- NULL 
edeq_coping_screener$ed_scid5.regular_episodes_eating_binges_.Wave_1b <- NULL 
edeq_coping_screener$ed_scid5.weigh_weighed_past_month_.Wave_1a <- NULL 
edeq_coping_screener$ed_scid5.weigh_weighed_past_month_.Wave_1b <- NULL 
```

### Read in EDGI sign-up demographics data (for employment/education info!)
```{r Read in data EDGI demographics 3}
if(EDGI == TRUE){
edgi.dem3.raw <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/edgi/dem_edgi.rds")
dim(edgi.dem3.raw)
colnames(edgi.dem3.raw)
}
```

Select variables EDGI demographics 3
```{r Select variables EDGI demographics 3}
if(EDGI == TRUE){
edgi.dem3.raw.id <- edgi.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(cohort_name = "coping_edgi", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         demographics.collegeuniversity,
         demographics.asa_levels,
         demographics.cse,
         demographics.gcse,
         demographics.nvq,
         demographics.other.1,
         demographics.none_of_the_above,
         demographics.other_text.txt.1
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  

# Inspect dimensions
dim(edgi.dem3.raw.id)
# Inspect colnames
colnames(edgi.dem3.raw.id)
#Differences
dim(edgi.dem3.raw)[1]-dim(edgi.dem3.raw.id)[1]
}
```

### Read in GLAD sign-up demographics data (for employment/education info!)
```{r Read in data GLAD demographics}
if(GLAD == TRUE){
glad.dem3.raw <- readRDS(file = "../data_raw/glad/dem_glad.rds")
"/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/glad/dem_glad.rds"
dim(glad.dem3.raw)
colnames(glad.dem3.raw)
}
```

Select variables
```{r Select variables GLAD demographics}
if(GLAD == TRUE){
glad.dem3.raw.id <- glad.dem3.raw %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
  add_column(cohort_name = "coping_glad", .before = "startDate") %>% #create new column 
  select(
         ID = externalDataReference, # ID
         cohort_name, # Sample
         startDate_prepandemic = startDate,
         dem.college_or_university_degree,
         dem.a_levelsas_levels_or_equivalent,
         dem.o_levelsgcses_or_equivalent,
         dem.cses_or_equivalent,
         dem.nvq_or_hnd_or_hnc_or_equivalent,
         dem.other_professional_qualifications,
         dem.other_professional_qualifications_text.txt,
         dem.none_of_the_above_education = dem.none_of_the_above,
         transgender = dem.do_you_identify_as_transgender
         ) %>%
  add_numeric(., exclude = exclude_cols_dem) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad.dem3.raw.id)
# Inspect colnames
colnames(glad.dem3.raw.id)
#Differences
dim(glad.dem3.raw)[1]-dim(glad.dem3.raw.id)[1]
}
```

# *JOINING & SAVING DATASETS - baseline*
## Select same variables from each dataset
EDGI select variables from each dataset
```{r EDGI select variables for final dataset}
if(EDGI == TRUE) {
  # Temporary solution - Drop one dup cohort name columns
edgi.coping.dem.raw.id$cohort_name.y <- NULL
edgi.coping.dem.raw.id <- edgi.coping.dem.raw.id %>% 
  rename(
    cohort_name = cohort_name.x
    )

edgi.1 <- edgi.coping.dem.raw.id %>% 
  select(ID,
  cohort_name,
  gender_unc,
  sex,
  uk_location,
  current_country,
  age_category_COPING
  )
  
edgi.2 <- edgi.dem3.raw.id %>% 
  select(ID,
  cohort_name,
  age_category_numeric,
  age_category,
  highest_education_prepan_numeric,
  highest_education_prepan,
  ethnicity, 
  transgender
  )
  
edgi.3 <- edgi.coping.dem4.employ.raw.id %>% 
  select(ID,
  cohort_name,
  highest_education_numeric,
  highest_education,
  employment_prior_covid_numeric,
  employment_prior_covid,
  employment_change_numeric,
  employment_change,
  key_worker,
  employed,
  employ.government_work_key_workers_numeric,
  employ.government_work_key_workers,
  key_worker_numeric,
  employ.fulltime_employed,
  employ.parttime_employed,
  employ.unemployed,
  employ.zerohours_contract,
  employ.stayathome_parent_or_carer,
  employ.selfemployed,
  employ.contract_or_freelance_work,
  employ.small_business_owner,
  employ.receiving_state_income,
  employ.retired,
  employ.student_gcse_or_a_level,
  employ.student_university,
  employ.my_employment_status_has_not_changed,
  employ.became_unemployed,
  employ.reduction_in_hours,
  employ.reduction_in_salary,
  employ.benefits_increased,
  employ.benefits_decreased,
  employ.change_in_duties_or_responsibilities,
  employ.became_employed,
  employ.increased_hours,
  employ.increased_salary,
  employ.furloughed_or_paid_leave_government_funded,
  employ.furloughed_or_paid_leave_company_funded,
  employ.paid_leave_furloughed,
  employ.taking_unpaid_leave,
  employ.other,
  employ.other_text.txt,
  employ.no_impact,
  employ.cancelled_exams,
  employ.change_in_format_of_exams,
  employ.automatic_pass,
  employ.change_in_deadlines,
  employ.change_in_lesson_delivery,
  employ.past_performance_grade_decided,
  employ.cancelled_classes,
  employ.cannot_complete_degree,
  employ.impact_on_studies_still_unknown,
  employ.other.1,
  employ.other_text.txt.1,
  employ.losing_job_due_risk,
  employ.increased_due_job_pandemic)
  
edgi.4 <- taf.edgi.coping.baseline.raw.id %>% 
  select(ID,
  cohort_name,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
   taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)

edgi.5 <- mhd.raw.id %>% 
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_diagnosed_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         PERSONALITY_DISORDER_NUMERIC,
         agoraphobia_panic_disorder_numeric,
         depression_and_anxiety_numeric,
         bipolar_and_schizophrenia_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
         mhd.posttraumatic_stress_disorder_ptsd_numeric, 
         autism_spectrum_disorder_numeric,
         mhd.attention_deficit_hyperactivity_disorder_numeric,
         mhd.personality_disorder_numeric,
         mhd.suspected_eating_disorder_diagnosed_numeric,
         mhd.body_dysmorphic_disorder_bdd_numeric,
         mhd.anorexia_nervosa_numeric,
          mhd.atypical_anorexia_nervosa_numeric,
          mhd.bulimia_nervosa_numeric, 
          mhd.atypical_bulimia_nervosa_numeric,  
          mhd.bingeeating_disorder_numeric, 
          mhd.atypical_bingeeating_disorder_numeric, 
          mhd.purging_disorder_numeric, 
          mhd.night_eating_syndrome_numeric,  
          mhd.pica_numeric, 
          mhd.avoidantrestrictive_food_intake_disorder_numeric,
          mhd.rumination_disorder_numeric, 
          mhd.feeding_eating_disorder_numeric, 
          mhd.other_eating_disorder_numeric)

edgi.6 <- taf.edgi.coping.baseline.raw.id %>% 
  select(ID,
  cohort_name,
  taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)

edgi.7 <- edgi.coping.dem2.raw.id %>%
  select(ID,
         cohort_name,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
          dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure)
  
edgi.8 <- edgi_pan_worry.id %>%
  select(ID,
         cohort_name,
         panworry.impact_on_your_employment_status,                                    
         panworry.employment_status_household_key,              
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.impact_mental_health_childrens,               
         panworry.impact_relatives_mental_health,           
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.standing_impact_global_recession,
         panworry.other_,
         
         panworry.impact_on_your_employment_status_numeric,                                    
         panworry.employment_status_household_key_numeric,              
         panworry.impact_on_your_education_or_exams_numeric,            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.impact_mental_health_childrens_numeric,               
         panworry.impact_relatives_mental_health_numeric,           
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.standing_impact_global_recession_numeric,
         panworry.other__numeric)
  
edgi.9 <- edgi.loneliness.baseline.raw.id %>%
  select(ID,
         cohort_name,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )
edgi.10 <- edgi.loss.baseline.raw.id %>%
  select(ID, 
         cohort_name,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss)


edgi.11 <- edgi.baseline.resp.id %>%
  select(ID, 
         cohort_name,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.coronavirus_antibody_test)

       
##See if IDs match with edgi.5
x <- edgi.5[edgi.5$ID %in% edgi.4$ID,]
length(unique(x$ID))
x <- edgi.5[edgi.5$ID %in% edgi.3$ID,]
length(unique(x$ID))
x <- edgi.5[edgi.5$ID %in% edgi.2$ID,]
length(unique(x$ID))
x <- edgi.5[edgi.5$ID %in% edgi.1$ID,]
length(unique(x$ID))
}
```


 
GLAD data frame list
```{r GLAD data frame list}
if(GLAD == TRUE) {
  
  # Temporary solution - Drop one dup cohort name columns
glad.coping.dem.raw.id$cohort_name.y <- NULL
glad.coping.dem.raw.id <- glad.coping.dem.raw.id %>% 
  rename(
    cohort_name = cohort_name.x
    )

glad.1 <-  glad.coping.dem.raw.id %>%
     select(ID,
            cohort_name,
            sex,
            gender_unc,
            uk_location,
            current_country,
            age_category_COPING
            )

glad.2 <- glad.dem3.raw.id %>%
  select(ID,
         cohort_name,
         age_category_numeric,
         age_category,
         ethnicity,
         highest_education_prepan_numeric,
         highest_education_prepan,
         transgender)

glad.3 <- glad.coping.dem4.employ.raw.id %>% 
  select(ID,
         cohort_name,
         highest_education_numeric,
         highest_education,
         employment_prior_covid,
         employment_prior_covid_numeric,
         employment_change,
         employment_change_numeric,
         key_worker,
         key_worker_numeric,
         employed,
         employ.government_work_key_workers_numeric,
           employ.government_work_key_workers,
         employ.fulltime_employed,
  employ.parttime_employed,
  employ.unemployed,
  employ.zerohours_contract,
  employ.stayathome_parent_or_carer,
  employ.selfemployed,
  employ.contract_or_freelance_work,
  employ.small_business_owner,
  employ.receiving_state_income,
  employ.retired,
  employ.student_gcse_or_a_level,
  employ.student_university,
  employ.my_employment_status_has_not_changed,
  employ.became_unemployed,
  employ.reduction_in_hours,
  employ.reduction_in_salary,
  employ.benefits_increased,
  employ.benefits_decreased,
  employ.change_in_duties_or_responsibilities,
  employ.became_employed,
  employ.increased_hours,
  employ.increased_salary,
  employ.furloughed_or_paid_leave_government_funded,
  employ.furloughed_or_paid_leave_company_funded,
  employ.paid_leave_furloughed,
  employ.taking_unpaid_leave,
  employ.other,
  employ.other_text.txt,
  employ.no_impact,
  employ.cancelled_exams,
  employ.change_in_format_of_exams,
  employ.automatic_pass,
  employ.change_in_deadlines,
  employ.change_in_lesson_delivery,
  employ.past_performance_grade_decided,
  employ.cancelled_classes,
  employ.cannot_complete_degree,
  employ.impact_on_studies_still_unknown,
  employ.other.1,
  employ.other_text.txt.1,
  employ.losing_job_due_risk,
  employ.increased_due_job_pandemic)

glad.4 <- taf.glad.coping.baseline.raw.id%>%
  select(ID,
  cohort_name,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
   taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)

glad.5 <- mhd.raw.id %>%
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_diagnosed_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         PERSONALITY_DISORDER_NUMERIC,
         agoraphobia_panic_disorder_numeric,
         depression_and_anxiety_numeric,
         bipolar_and_schizophrenia_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
        mhd.posttraumatic_stress_disorder_ptsd_numeric, 
        autism_spectrum_disorder_numeric,
        mhd.attention_deficit_hyperactivity_disorder_numeric,
        mhd.personality_disorder_numeric,
        mhd.suspected_eating_disorder_diagnosed_numeric,
        mhd.body_dysmorphic_disorder_bdd_numeric,
        mhd.anorexia_nervosa_numeric,
          mhd.atypical_anorexia_nervosa_numeric,
          mhd.bulimia_nervosa_numeric, 
          mhd.atypical_bulimia_nervosa_numeric,  
          mhd.bingeeating_disorder_numeric, 
          mhd.atypical_bingeeating_disorder_numeric, 
          mhd.purging_disorder_numeric, 
          mhd.night_eating_syndrome_numeric,  
          mhd.pica_numeric, 
          mhd.avoidantrestrictive_food_intake_disorder_numeric,
          mhd.rumination_disorder_numeric, 
          mhd.feeding_eating_disorder_numeric, 
          mhd.other_eating_disorder_numeric)

glad.6 <- glad.coping.dem2.raw.id %>%
  select(ID,
         cohort_name,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure)
  
glad.7 <- glad_pan_worry.id %>%
  select(ID,
         cohort_name,
         panworry.impact_on_your_employment_status,                                    
         panworry.employment_status_household_key,              
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.impact_mental_health_childrens,               
         panworry.impact_relatives_mental_health,           
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.standing_impact_global_recession,
         panworry.other_,
         
         panworry.impact_on_your_employment_status_numeric,                                    
         panworry.employment_status_household_key_numeric,              
         panworry.impact_on_your_education_or_exams_numeric,            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.impact_mental_health_childrens_numeric,               
         panworry.impact_relatives_mental_health_numeric,           
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.standing_impact_global_recession_numeric,
         panworry.other__numeric)

glad.8 <- glad.loneliness.baseline.raw.id %>%
  select(ID,
         cohort_name,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )

glad.9 <- glad.loss.baseline.raw.id %>%
  select(ID, 
         cohort_name,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss)

glad.10 <-  glad.baseline.resp.id %>%
  select(ID, 
         cohort_name,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.coronavirus_antibody_test)
  
# See if IDs match with glad.3
x <- glad.3[glad.3$ID %in% glad.1$ID,]
length(unique(x$ID))
x <- glad.3[glad.3$ID %in% glad.2$ID,]
length(unique(x$ID))
x <- glad.3[glad.3$ID %in% glad.4$ID,]
length(unique(x$ID))
x <- glad.3[glad.3$ID %in% glad.5$ID,]
length(unique(x$ID))
}
```

GLAD data frame list
```{r GLAD data frame list}
if(GLAD == TRUE) {
dfs.list <- list(
  glad.1,
  glad.2,
  glad.3,
  glad.4,
  glad.5,
  glad.6,
  glad.7,
  glad.8,
  glad.9,
  glad.10
  )
}
```

Join all GLAD
```{r Join all GLAD questionnaires}
if(GLAD == TRUE) {
dat.raw.glad <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name")
  )
# Look at the data
colnames(dat.raw.glad)
}
```

Get rid of duplicates in GLAD
```{r Check duplicates GLAD final dataset}
if(GLAD == TRUE) {
  dat.raw.glad$ID.dup <- duplicated(dat.raw.glad$ID)
summary(as.factor(dat.raw.glad$ID.dup))
select(dat.raw.glad)
# Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw.glad)))
names_freq[names_freq$Freq > 1, ]
# Filter out duplicate column names
 #dat.dup <- dat.raw.glad %>%
 # filter(ID.dup == TRUE)
#dat.raw.glad <- dat.raw.glad %>%
#  filter(ID.dup == FALSE)
colnames(dat.raw.glad)
}
```

NBR selected variables
```{r NBR selected variables final dataset}
if(NBR == TRUE) {
  nbr.1 <- nbr.dem.employ.raw.id %>%
    select(ID,
           cohort_name,
           highest_education_numeric,
           highest_education,
           employment_change_numeric,
           employment_change,
           employment_prior_covid,
           employment_prior_covid_numeric,
           key_worker,
           key_worker_numeric,
           employed,
           employ.government_work_key_workers_numeric,
           employ.government_work_key_workers,
           employ.fulltime_employed,
           employ.parttime_employed,
employ.unemployed,
employ.zerohours_contract,
employ.stayathome_parent_or_carer,
employ.selfemployed,
employ.contract_or_freelance_work,
employ.small_business_owner,
employ.receiving_state_income,
employ.retired,
employ.student_gcse_or_a_level,
employ.student_university,
employ.my_employment_status_has_not_changed,
employ.became_unemployed,
employ.reduction_in_hours,
employ.reduction_in_salary,
employ.benefits_increased,
employ.benefits_decreased,
employ.change_in_duties_or_responsibilities,
employ.became_employed,
employ.increased_hours,
employ.increased_salary,
employ.furloughed_or_paid_leave_government_funded,
employ.furloughed_or_paid_leave_company_funded,
employ.paid_leave_furloughed,
employ.taking_unpaid_leave,
employ.other,
employ.other_text.txt,
employ.no_impact,
employ.cancelled_exams,
employ.change_in_format_of_exams,
employ.automatic_pass,
employ.change_in_deadlines,
employ.change_in_lesson_delivery,
employ.past_performance_grade_decided,
employ.cancelled_classes,
employ.cannot_complete_degree,
employ.impact_on_studies_still_unknown,
employ.other.1,
employ.other_text.txt.1,
employ.losing_job_due_risk,
employ.increased_due_job_pandemic,)
  
nbr.2 <- nbr.dem.raw.id.complete %>%
  select(ID,
         cohort_name,
         sex,
         gender_unc,
         ethnicity,
         current_country,
         uk_location)

nbr.3 <- nbr.dem.raw.id %>%
    select(ID,
           cohort_name,
           age_category,
           age_category_numeric)

nbr.4 <- taf.nbr.baseline.raw.id %>%
  select(ID,
  cohort_name,
  taf.worth_living_life_people_.Wavebaseline,
  taf.felt_weeks_past_.Wavebaseline,
  taf.have_you_contemplated_harming_yourself_.Wavebaseline,
  taf.felt_weeks_past.1_.Wavebaseline,
  taf.meant_life_end_weeks_.Wavebaseline,
  taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)

nbr.5 <- mhd.raw.id %>% 
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_diagnosed_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         PERSONALITY_DISORDER_NUMERIC,
         agoraphobia_panic_disorder_numeric,
         depression_and_anxiety_numeric,
         bipolar_and_schizophrenia_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
        mhd.posttraumatic_stress_disorder_ptsd_numeric, 
        autism_spectrum_disorder_numeric,
        mhd.attention_deficit_hyperactivity_disorder_numeric,
        mhd.personality_disorder_numeric,
        mhd.suspected_eating_disorder_diagnosed_numeric,
        mhd.body_dysmorphic_disorder_bdd_numeric,
        mhd.anorexia_nervosa_numeric,
          mhd.atypical_anorexia_nervosa_numeric,
          mhd.bulimia_nervosa_numeric, 
          mhd.atypical_bulimia_nervosa_numeric,  
          mhd.bingeeating_disorder_numeric, 
          mhd.atypical_bingeeating_disorder_numeric, 
          mhd.purging_disorder_numeric, 
          mhd.night_eating_syndrome_numeric,  
          mhd.pica_numeric, 
          mhd.avoidantrestrictive_food_intake_disorder_numeric,
          mhd.rumination_disorder_numeric, 
          mhd.feeding_eating_disorder_numeric, 
          mhd.other_eating_disorder_numeric)

nbr.6 <- nbr.dem2.raw.id %>%
  select(ID,
         cohort_name,
         dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living, 
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1, 
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1,
         
         dem2.member_vulnerable_group,
         dem2.solid_organ_transplant_recipient,
         dem2.lung_cancer_radical_radiotherapy,
         dem2.bone_marrow_blood_leukaemia,
         dem2.immunotherapy_cancer_continuing_antibody,
         dem2.parp_inhibitors_affect_immune,
         dem2.stem_cell_transplants_bone,
         dem2.severe_copd_cystic_fibrosis,
         dem2.inborn_errors_rare_diseases,
         dem2.taking_medicine_that_weakens_your_immune_system,
         dem2.condition_infections_makes,
         dem2.congenital_pregnant_acquired_significant,
         dem2.pregnant,
         dem2.over_70_years_old,
         dem2.prefer_not_to_say.2,
         dem2.unsure)

nbr.7 <- nbr_pan_worry.id %>%
  select(ID,
         cohort_name,
         panworry.impact_on_your_employment_status,                                    
         panworry.employment_status_household_key,              
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.impact_mental_health_childrens,               
         panworry.impact_relatives_mental_health,           
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.standing_impact_global_recession,
         
         panworry.other_,
        panworry.impact_on_your_employment_status_numeric,                                    
         panworry.employment_status_household_key_numeric,              
         panworry.impact_on_your_education_or_exams_numeric,            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.impact_mental_health_childrens_numeric,               
         panworry.impact_relatives_mental_health_numeric,           
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.standing_impact_global_recession_numeric,
         panworry.other__numeric)

nbr.8 <- nbr.loneliness.baseline.raw.id %>%
  select(ID,
         cohort_name,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )

nbr.9 <- nbr.loss.baseline.raw.id %>%
  select(ID, 
         cohort_name,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss)

nbr.10 <- nbr.baseline.resp.id %>%
  select(ID, 
         cohort_name,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.coronavirus_antibody_test)
  
#Check nbr mhd data IDs
x <- nbr.5[nbr.5$ID %in% nbr.1$ID,]
length(unique(x$ID))
x <- nbr.5[nbr.5$ID %in% nbr.2$ID,]
length(unique(x$ID))
x <- nbr.5[nbr.5$ID %in% nbr.3$ID,]
length(unique(x$ID))
x <- nbr.5[nbr.5$ID %in% nbr.4$ID,]
length(unique(x$ID))
x <- nbr.9[nbr.9$ID %in% nbr.1$ID,]
length(unique(x$ID))    
nrow(nbr.5)
nrow(nbr.4)
nrow(nbr.3)
nrow(nbr.2)
nrow(nbr.1)
nrow(nbr.9)
}
```

NBR  data frame list
```{r NBR data frame list for final dataset}
if(NBR == TRUE) {
dfs.list <- list(
  nbr.1,
  nbr.2,
  nbr.3,
  nbr.4,
  nbr.5,
  nbr.6,
  nbr.7,
  nbr.8,
  nbr.9,
  nbr.10
)
}
```

Join all NBR 
```{r Join all NBR questionnaires for final dataset}
if(NBR == TRUE) {
dat.raw.nbr <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name") # Alternatively you can join by several columns EDGI -> "Age", "Sex", "Birthyear"
  )
# Look at the data
colnames(dat.raw.nbr)
}
```

Get rid of duplicates in NBR
```{r Check duplicates NBR final dataset}
if(NBR == TRUE) {
dat.raw.nbr$ID.dup <- duplicated(dat.raw.nbr$ID)
summary(as.factor(dat.raw.nbr$ID.dup))
select(dat.raw.nbr)
 # Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw.nbr)))
names_freq[names_freq$Freq > 1, ]
# Filter out duplicate column names
 dat.dup <- dat.raw.nbr %>%
  filter(ID.dup == TRUE)
dat.raw.nbr <- dat.raw.nbr %>%
  filter(ID.dup == FALSE)
colnames(dat.raw.nbr)
}
```

RAMP variable list
```{r RAMP variable list}
if(RAMP == TRUE) {

  ramp.1 <- ramp.dem.raw.id %>%
    select(ID,
           cohort_name,
           gender_unc,
           ethnicity,
           age_unc,
           dem2.member_vulnerable_group,
           dem2.solid_organ_transplant_recipient,
           dem2.lung_cancer_radical_radiotherapy,
           dem2.bone_marrow_blood_leukaemia,
           dem2.immunotherapy_cancer_continuing_antibody,
           dem2.parp_inhibitors_affect_immune,
           dem2.stem_cell_transplants_bone,
           dem2.severe_copd_cystic_fibrosis, #= dem2.cystic_fibrosis_severe_asthma,
           dem2.inborn_errors_rare_diseases, # = dem2.inborn_errors_metabolism_infections,
           dem2.taking_medicine_that_weakens_your_immune_system,
           dem2.congenital_pregnant_acquired_significant, # = dem2.condition_infections_makes,
           dem2.pregnant,
           dem2.over_70_years_old,
           dem2.prefer_not_to_say.2, # = dem2.prefer_not_to_say.1,
           dem2.unsure,
           transgender,
           dem2.living_with_partner_or_spouse,
         dem2.living_alone,
         dem2.living_with_partner_or_spouse,
         dem2.living_with_housemates,
         dem2.age_children_living,
         dem2.age_children_living.1,
         dem2.living_with_other_members_of_my_family,
         dem2.spouse_partner_members_living,
         dem2.staying_live,
         dem2.staying_live.1,
         dem2.prefer_not_to_say,
         dem2.living_situation_change_pandemic,
         dem2.living_alone.1,
         dem2.living_with_partner_or_spouse.1,
         dem2.living_with_housemates.1,
         dem2.age_children_living.2,
         dem2.age_children_living.3,
         dem2.living_with_other_members_of_my_family.1,
         dem2.spouse_partner_members_living.1,
         dem2.staying_live.2,
         dem2.staying_live.3,
         dem2.prefer_not_to_say.1)

  ramp.2 <- ramp.dem.employ.raw.id %>%
    select(ID,
           cohort_name,
           highest_education,
           highest_education_numeric,
           employment_prior_covid,
           employment_prior_covid_numeric,
           employment_change,
           employment_change_numeric,
           key_worker,
           key_worker_numeric,
           employed,
           employ.government_work_key_workers_numeric,
           employ.government_work_key_workers,
           employ.fulltime_employed,
  employ.parttime_employed,
  employ.unemployed,
employ.zerohours_contract,
  employ.stayathome_parent_or_carer,
  employ.selfemployed,
  employ.contract_or_freelance_work,
  employ.small_business_owner,
  employ.receiving_state_income,
  employ.retired,
  employ.student_gcse_or_a_level,
  employ.student_university,
  employ.my_employment_status_has_not_changed,
  employ.became_unemployed,
  employ.reduction_in_hours,
  employ.reduction_in_salary,
  employ.benefits_increased,
  employ.benefits_decreased,
  employ.change_in_duties_or_responsibilities,
  employ.became_employed,
  employ.increased_hours,
  employ.increased_salary,
  employ.furloughed_or_paid_leave_government_funded,
  employ.furloughed_or_paid_leave_company_funded,
  employ.paid_leave_furloughed,
  #employ.taking_unpaid_leave,
  employ.other,
  employ.other_text.txt,
  employ.no_impact,
  employ.cancelled_exams,
  employ.change_in_format_of_exams,
  employ.automatic_pass,
  employ.change_in_deadlines,
  employ.change_in_lesson_delivery,
  employ.past_performance_grade_decided,
  employ.cancelled_classes,
  employ.cannot_complete_degree,
  employ.impact_on_studies_still_unknown,
  employ.other.1,
  employ.other_text.txt.1,
  employ.losing_job_due_risk,
  employ.increased_due_job_pandemic)

  ramp.3 <- edeq.ramp.baseline.raw.id %>%
    select(ID,
           cohort_name,
           edeq.deliberately_limit_amount_influence.1_.Wavebaseline,
           edeq.calories_made_body_shape.1_.Wavebaseline,
           edeq.weight_influenced_person.1_.Wavebaseline,
           edeq.dissatisfied_shape_weight.1_.Wavebaseline,
           edeq.eating_behaviours_concerns_distressed.1_.Wavebaseline,
           edeq.nibbled_picked_snacks_grazed.1_.Wavebaseline,
           edeq.felt_anxious_blue_bored.2_.Wavebaseline,
           edeq.felt_anxious_blue_bored.3_.Wavebaseline,
           edeq.actively_been_monitoring_your_shape_or_weight_.1_.Wavebaseline,
           edeq.regard_lost_control_eaten.1_.Wavebaseline,
           edeq.sick_means_made_shape.1_.Wavebaseline,
           edeq.diuretics_laxatives_means_shape.1_.Wavebaseline,
           edeq.compulsive_driven_burn_calories.1_.Wavebaseline,
           edeq.deliberately_limit_amount_influence.1_.Wavebaseline_numeric,
           edeq.calories_made_body_shape.1_.Wavebaseline_numeric,
           edeq.weight_influenced_person.1_.Wavebaseline_numeric,
           edeq.dissatisfied_shape_weight.1_.Wavebaseline_numeric,
           edeq.eating_behaviours_concerns_distressed.1_.Wavebaseline_numeric,
           edeq.nibbled_picked_snacks_grazed.1_.Wavebaseline_numeric,
           edeq.felt_anxious_blue_bored.2_.Wavebaseline_numeric,
           edeq.felt_anxious_blue_bored.3_.Wavebaseline_numeric,
           edeq.actively_been_monitoring_your_shape_or_weight_.1_.Wavebaseline_numeric,
           edeq.regard_lost_control_eaten.1_.Wavebaseline_numeric,
           edeq.sick_means_made_shape.1_.Wavebaseline_numeric,
           edeq.diuretics_laxatives_means_shape.1_.Wavebaseline_numeric,
           edeq.compulsive_driven_burn_calories.1_.Wavebaseline_numeric,
           edeq.deliberately_limit_amount_influence_.Wavebaseline,
          edeq.calories_made_body_shape_.Wavebaseline ,
          edeq.weight_influenced_person_.Wavebaseline,
          edeq.dissatisfied_shape_weight_.Wavebaseline ,
         edeq.nibbled_picked_snacks_grazed_.Wavebaseline ,
         edeq.felt_anxious_blue_bored_.Wavebaseline ,
         edeq.felt_anxious_blue_bored.1_.Wavebaseline ,
         edeq.eating_behaviours_concerns_distressed_.Wavebaseline,
         edeq.actively_been_monitoring_your_shape_or_weight_.Wavebaseline,
         edeq.regard_lost_control_eaten_.Wavebaseline,
         edeq.sick_means_made_shape_.Wavebaseline,
         edeq.diuretics_laxatives_means_shape_.Wavebaseline,
         edeq.compulsive_driven_burn_calories_.Wavebaseline,
         edeq.deliberately_limit_amount_influence_.Wavebaseline_numeric,
         edeq.calories_made_body_shape_.Wavebaseline_numeric,
         edeq.weight_influenced_person_.Wavebaseline_numeric,
         edeq.dissatisfied_shape_weight_.Wavebaseline_numeric ,
         edeq.nibbled_picked_snacks_grazed_.Wavebaseline_numeric ,
         edeq.felt_anxious_blue_bored_.Wavebaseline_numeric ,
         edeq.felt_anxious_blue_bored.1_.Wavebaseline_numeric ,
         edeq.eating_behaviours_concerns_distressed_.Wavebaseline_numeric ,
         edeq.actively_been_monitoring_your_shape_or_weight_.Wavebaseline_numeric,
         edeq.regard_lost_control_eaten_.Wavebaseline_numeric,
         edeq.sick_means_made_shape_.Wavebaseline_numeric,
         edeq.diuretics_laxatives_means_shape_.Wavebaseline_numeric ,
         edeq.compulsive_driven_burn_calories_.Wavebaseline_numeric 
  )
  
ramp.4 <- mhd.raw.id %>% 
  select(ID,
         cohort_name,
         control,
         control_numeric,
         depressive_disorders_numeric,
         anxiety_disorders_numeric,
         eating_disorders_diagnosed_numeric,
         obsessive_compulsive_disorders_numeric,
         psychotic_disorders_numeric,
         PERSONALITY_DISORDER_NUMERIC,
         agoraphobia_panic_disorder_numeric,
         depression_and_anxiety_numeric,
         bipolar_and_schizophrenia_numeric,
         mhd.mania_hypomania_bipolar_or_manicdepression_numeric,
         mhd.posttraumatic_stress_disorder_ptsd_numeric, 
         autism_spectrum_disorder_numeric,
         mhd.attention_deficit_hyperactivity_disorder_numeric,
         mhd.personality_disorder_numeric,
         mhd.body_dysmorphic_disorder_bdd_numeric,
         mhd.anorexia_nervosa_numeric,
         mhd.atypical_anorexia_nervosa_numeric,
         mhd.bulimia_nervosa_numeric,
         mhd.bingeeating_disorder_numeric)

ramp.5 <- taf.ramp.baseline.raw.id  %>% 
  select(ID,
         cohort_name,
         taf.worth_living_life_people_.Wavebaseline,
         taf.felt_weeks_past_.Wavebaseline,
         taf.have_you_contemplated_harming_yourself_.Wavebaseline,
         taf.felt_weeks_past.1_.Wavebaseline,
         taf.meant_life_end_weeks_.Wavebaseline)

ramp.6 <- taf.ramp.baseline.raw.id %>% #for retro prepan
  select(ID,
  cohort_name,
  taf.pandemic_felt_.Wavebaseline,
  taf.pandemic_felt.1_.Wavebaseline,
  taf.meant_end_life_pandemic_.Wavebaseline)

ramp.7 <- ramp_pan_worry.id %>%
  select(ID,
         cohort_name,
         panworry.impact_on_your_employment_status,                                    
         panworry.employment_status_household_key,              
         panworry.impact_on_your_education_or_exams,            
         panworry.exams_impact_education_children,              
         panworry.financial_impact,                           
         panworry.contracting_the_virus,                       
         panworry.people_you_know_contracting_the_virus,       
         panworry.people_you_dont_know_contracting_the_virus,   
         panworry.impact_mental_health_wellbeing,               
         panworry.impact_mental_health_childrens,               
         panworry.impact_relatives_mental_health,           
         panworry.being_socially_isolated,                    
         panworry.people_you_know_being_socially_isolated,      
         panworry.shortage_of_essential_supplies,                
         panworry.shortage_of_medication_or_access_to_healthcare,
         panworry.healthcare_people_essential_supplies,          
         panworry.information_virus_government_accuracy,         
         panworry.the_governments_response_to_the_pandemic,      
         panworry.separation_from_family_members,         
         panworry.standing_impact_global_recession,
         panworry.other_,
         panworry.impact_on_your_employment_status_numeric,                                    
         panworry.employment_status_household_key_numeric,              
         panworry.impact_on_your_education_or_exams_numeric,            
         panworry.exams_impact_education_children_numeric,              
         panworry.financial_impact_numeric,                           
         panworry.contracting_the_virus_numeric,                       
         panworry.people_you_know_contracting_the_virus_numeric,       
         panworry.people_you_dont_know_contracting_the_virus_numeric,   
         panworry.impact_mental_health_wellbeing_numeric,               
         panworry.impact_mental_health_childrens_numeric,               
         panworry.impact_relatives_mental_health_numeric,           
         panworry.being_socially_isolated_numeric,                    
         panworry.people_you_know_being_socially_isolated_numeric,      
         panworry.shortage_of_essential_supplies_numeric,                
         panworry.shortage_of_medication_or_access_to_healthcare_numeric,
         panworry.healthcare_people_essential_supplies_numeric,          
         panworry.information_virus_government_accuracy_numeric,         
         panworry.the_governments_response_to_the_pandemic_numeric,      
         panworry.separation_from_family_members_numeric,         
         panworry.standing_impact_global_recession_numeric,
         panworry.other__numeric)

ramp.8 <- ramp.loneliness.baseline.raw.id %>%
  select(ID,
         cohort_name,
         lone.felt_that_you_lack_companionship,
        lone.felt_left_out,
        lone.felt_isolated_from_others,
        lone.felt_alone,lone.similar_felt_pandemic,
        lone.felt_that_you_lack_companionship.1,
        lone.felt_left_out.1,
        lone.felt_isolated_from_others.1,
        lone.felt_alone.1
  )

ramp.9 <- ramp.loss.baseline.raw.id %>%
  select(ID, 
         cohort_name,
         grief.covid_lost_due_close,
         grief.suffered_past_month_loss)

ramp.10 <- ramp.baseline.resp.id %>%
  select(ID, 
         cohort_name,
         resp.coronavirus_test_nosethroat_swab,
         resp.results_nosethroat_swab_test,
         resp.coronavirus_antibody_test,
         resp.coronavirus_antibody_test)
  
# Check ramp.4 has same IDs as other datasets
x <- ramp.4[ramp.4$ID %in% ramp.1$ID,]
length(unique(x$ID))
x <- ramp.4[ramp.4$ID %in% ramp.2$ID,]
length(unique(x$ID))
x <- ramp.4[ramp.4$ID %in% ramp.3$ID,]
length(unique(x$ID))
x <- ramp.4[ramp.4$ID %in% ramp.5$ID,]
length(unique(x$ID))    
}
```

RAMPdata frame list
```{r RAMP data frame list}
if(RAMP == TRUE) {
dfs.list <- list(
  ramp.1,
  ramp.2,
  ramp.3,
  ramp.4,
  ramp.5,
  ramp.6,
  ramp.7,
  ramp.8,
  ramp.9,
  ramp.10
)
}
```

Join all RAMP 
```{r Join all RAMP questionnaires final dataset}
if(RAMP == TRUE) {
dat.raw.ramp <- plyr::join_all(
  dfs.list,
  by = c("ID", "cohort_name") # Alternatively you can join by several columns EDGI -> "Age", "Sex", "Birthyear"
  )
# Look at the data
colnames(dat.raw.ramp)
}
```

Get rid of duplicates in RAMP
```{r Check duplicates RAMP final dataset}
if(RAMP == TRUE) {
dat.raw.ramp$ID.dup <- duplicated(dat.raw.ramp$ID)
summary(as.factor(dat.raw.ramp$ID.dup))
 # Check for duplicate names of columns
names_freq <- as.data.frame(table(names(dat.raw.ramp)))
names_freq[names_freq$Freq > 1, ]
# Filter out duplicate column names
 dat.dup <- dat.raw.ramp %>%
  filter(ID.dup == TRUE)
dat.raw.ramp <- dat.raw.ramp %>%
  filter(ID.dup == FALSE)
}
```

# Export baseline data
```{r export data}
if(GLAD == TRUE) {
saveRDS(object = dat.raw.glad, file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/BASELINE_glad", date, ".rds"))
}
if(EDGI == TRUE) {
saveRDS(object = dat.raw.edgi, file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/BASELINE_edgi", date, ".rds"))
  
}
if(RAMP == TRUE) {
  saveRDS(object = dat.raw.ramp, file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/BASELINE_ramp", date, ".rds"))
}
if(NBR == TRUE) {
  saveRDS(object = dat.raw.nbr, file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/BASELINE_nbr", date, ".rds"))
}
```

```{r Pandemic worry as exposure, identifying not applicable or missing data}

# Own Employment
dat <- dat %>%
  mutate(not_applicable_or_missing_own_employment =
           case_when(panworry.impact_on_your_employment_status == "Not applicable" |
                       is.na(panworry.impact_on_your_employment_status) ~ 1
             
           ))
# Check 
dat %>%
  freq(not_applicable_or_missing_own_employment)

# Household employment 
dat <- dat %>% 
  mutate(not_applicable_or_missing_household_employment =
           case_when(panworry.household_employment_status_key == "Not applicable" |
                       is.na(panworry.household_employment_status_key) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_household_employment)

# Own education / exams
dat <- dat %>%
  mutate(not_applicable_or_missing_own_education_exams =
           case_when(panworry.impact_on_your_education_or_exams == "Not applicable" |
                       is.na(panworry.impact_on_your_education_or_exams) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_own_education_exams)

# Children's exams
dat <- dat %>%
  mutate(not_applicable_or_missing_childrens_education_exams =
           case_when(panworry.exams_impact_education_children == "Not applicable" |
                       is.na(panworry.exams_impact_education_children) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_childrens_education_exams)

# Financial impact
dat <- dat %>%
  mutate(not_applicable_or_missing_financial_impact =
           case_when(panworry.financial_impact == "Not applicable" |
                       is.na(panworry.financial_impact) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_financial_impact)

# Contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_contracting_virus =
           case_when(panworry.contracting_the_virus == "Not applicable" |
                       is.na(panworry.contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_contracting_virus)

# People you know contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_people_know_contracting_virus =
           case_when(panworry.people_you_know_contracting_the_virus == "Not applicable" |
                       is.na(panworry.people_you_know_contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_know_contracting_virus)


# People you don't know contracting virus
dat <- dat %>%
  mutate(not_applicable_or_missing_people_dont_know_contracting_virus =
           case_when(panworry.people_you_dont_know_contracting_the_virus == "Not applicable" |
                       is.na(panworry.people_you_dont_know_contracting_the_virus) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_dont_know_contracting_virus)

# Mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_mental_health =
           case_when(panworry.impact_mental_health_wellbeing == "Not applicable" |
                       is.na(panworry.impact_mental_health_wellbeing) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_mental_health)

# Children's mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_childrens_mental_health =
           case_when(panworry.childrens_mental_health_impact == "Not applicable" |
                       is.na(panworry.childrens_mental_health_impact) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_childrens_mental_health)

# Relative's mental health
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_relatives_mental_health =
           case_when(panworry.relatives_impact_mental_health == "Not applicable" |
                       is.na(panworry.relatives_impact_mental_health) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_relatives_mental_health)

# Social isolation
dat <- dat %>%
  mutate(not_applicable_or_missing_social_isolation =
           case_when(panworry.being_socially_isolated == "Not applicable" |
                       is.na(panworry.being_socially_isolated) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_social_isolation)


# People you know social isolation
dat <- dat %>%
  mutate(not_applicable_or_missing_people_know_social_isolation =
           case_when(panworry.people_you_know_being_socially_isolated == "Not applicable" |
                       is.na(panworry.people_you_know_being_socially_isolated) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_people_know_social_isolation)

# Shortage of essentials
dat <- dat %>%
  mutate(not_applicable_or_missing_shortage_essentials =
           case_when(panworry.shortage_of_essential_supplies == "Not applicable" |
                       is.na(panworry.shortage_of_essential_supplies) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_shortage_essentials)

# Shortage of medication / accesss to healthcare
dat <- dat %>%
  mutate(not_applicable_or_missing_shortage_medication_access_healthcare =
           case_when(panworry.shortage_of_medication_or_access_to_healthcare == "Not applicable" |
                       is.na(panworry.shortage_of_medication_or_access_to_healthcare) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_shortage_medication_access_healthcare)

# People healthcare/shortage essentials
dat <- dat %>%
  mutate(not_applicable_or_missing_healthcare_people_essentials =
           case_when(panworry.healthcare_people_essential_supplies == "Not applicable" |
                       is.na(panworry.healthcare_people_essential_supplies) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_healthcare_people_essentials)

# Government info accuracy
dat <- dat %>%
  mutate(not_applicable_or_missing_gov_info_accurary =
           case_when(panworry.information_virus_government_accuracy == "Not applicable" |
                       is.na(panworry.information_virus_government_accuracy) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_gov_info_accurary)

# Government response to pandemic
dat <- dat %>%
  mutate(not_applicable_or_missing_gov_response_pandemic =
           case_when(panworry.the_governments_response_to_the_pandemic == "Not applicable" |
                       is.na(panworry.the_governments_response_to_the_pandemic) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_gov_response_pandemic)

# Separation from family members
dat <- dat %>%
  mutate(not_applicable_or_missing_separation_family =
           case_when(panworry.separation_from_family_members == "Not applicable" |
                       is.na(panworry.separation_from_family_members) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_separation_family)

# Impact global recession
dat <- dat %>%
  mutate(not_applicable_or_missing_impact_global_recession =
           case_when(panworry.global_recession_economy_longstanding == "Not applicable" |
                       is.na(panworry.global_recession_economy_longstanding) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_impact_global_recession)


# Other worry
dat <- dat %>%
  mutate(not_applicable_or_missing_other_worry =
           case_when(panworry.other_ == "Not applicable" |
                       is.na(panworry.other_) ~ 1
             
           ))

# Check 
dat %>%
  freq(not_applicable_or_missing_other_worry)

```

Pandemic worry - Sum score of 'missingness/not applicable'
```{r Pandemic worry as exposure, missingness score}

dat$panworry_sumscore_missingness_not_applicable <- rowSums(dat[ ,
                                 c("not_applicable_or_missing_own_employment",
                                   "not_applicable_or_missing_household_employment",
                                   "not_applicable_or_missing_own_education_exams",
                                   "not_applicable_or_missing_childrens_education_exams",
                                   "not_applicable_or_missing_financial_impact",
                                   "not_applicable_or_missing_contracting_virus",
                                   "not_applicable_or_missing_people_know_contracting_virus",
                                   "not_applicable_or_missing_people_dont_know_contracting_virus",
                                   "not_applicable_or_missing_impact_mental_health",
                                   "not_applicable_or_missing_impact_childrens_mental_health",
                                   "not_applicable_or_missing_impact_relatives_mental_health",
                                   "not_applicable_or_missing_social_isolation",
                                   "not_applicable_or_missing_people_know_social_isolation",
                                   "not_applicable_or_missing_shortage_essentials",
                                   "not_applicable_or_missing_shortage_medication_access_healthcare",
                                   "not_applicable_or_missing_healthcare_people_essentials",
                                   "not_applicable_or_missing_gov_info_accurary",
                                   "not_applicable_or_missing_gov_response_pandemic",
                                   "not_applicable_or_missing_separation_family",
                                   "not_applicable_or_missing_impact_global_recession",
                                   "not_applicable_or_missing_other_worry")],
                                  na.rm = TRUE)

# Check
dat %>%
  freq(panworry_sumscore_missingness_not_applicable)    
```

Work out the total number of questions about pandemic worry each participant answered 
```{r Pandemic worry total number of questions answered}

dat$panworry_total_applicable <- 21 - dat$panworry_sumscore_missingness_not_applicable

# Check
dat %>%
  freq(panworry_total_applicable)    
```

Highest possible score for each participant (i.e., multiply the number of questions they answered with the highest score they could possibly get on each question, i.e., 4)
```{r Pandemic worry highest possible score}

dat$panworry_total_possible_score <- dat$panworry_total_applicable * 4 # The highest score for each question is '4' = Extremely worried

# Check
dat %>%
  freq(panworry_total_possible_score)    
```

Answers as a percentage of possible scores (i.e., divide their actual score by their highest possible score, as calculated by the number of questions that were applicable to them/they answered)
```{r Pandemic worry answers as percentage}
dat$panworry_total_score_percent <- (dat$panworry_total_raw_score/dat$panworry_total_possible_score)*100

# Check 
dat %>%
  freq(panworry_total_score_percent)  
```

Answers as factors (0-20, 20-40, 40-50, 60-80, 80-100)
NB: I have included this as just another idea of grouping pandemic worry scores.
```{r Pandemic worry answers as factors}

dat <- dat %>%
  mutate(panworry_factor =
           case_when(
             panworry_total_score_percent >= 0 & panworry_total_score_percent <= 20 ~ "0-20",
             panworry_total_score_percent >= 21 & panworry_total_score_percent <= 40 ~ "21-40",
             panworry_total_score_percent >= 41 & panworry_total_score_percent <= 60 ~ "41-60",
             panworry_total_score_percent >= 61 & panworry_total_score_percent <= 80 ~ "61-80",
             panworry_total_score_percent >= 81 & panworry_total_score_percent <= 100 ~ "81-100"
           )
    
  )

# Change to factor
dat$panworry_factor <- as.factor(dat$panworry_factor)

dat %>%
  freq(panworry_factor)
```

















---
title: "Previous experience of eating disorders at baseline"
author: "Helena Davies"
date: "06/05/2021"
output: html_document
---

This script identifies whether people have experienced lifetime low weight or lifetime binge eating at baseline.

Due to differences in the available variables, the way in which I have assessed lifetime binge eating and lifetime low weight differ across the datasets. See here for a description of what I have done: https://docs.google.com/document/d/1NlIEts80sh5-S_upnWEL9xn-iZihiYZDrOPj86RGdHs/edit

ORDER OF SCRIPTS
1. Pre-processing
2. Baseline ED groupings
3. Merging
4. Deriving variables
Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/add_numeric.R")
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/remove_duplicates.R")
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/package_check.R")
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

# Read in ED data: GLAD COPING BE
```{r Read in data GLAD COPING BE}
dat.be.coping.glad <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_glad/be_coping_glad.rds")
# Inspect dimensions
dim(dat.be.coping.glad)
# Inspect colnames
colnames(dat.be.coping.glad)

nrow(dat.be.coping.glad)
```

Exclude cols
```{r exclude cols}
exclude_cols <- c("ID",
                  "sample")
```

Select variables: GLAD COPING BE
```{r Select variables GLAD COPING BE}

dat.be.coping.glad.id <- dat.be.coping.glad %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% 
  add_column(sample = "GLAD", .before = "be.ate_regard_short_period") %>% #create new column 
  select(
         ID = externalDataReference,# ID
       sample, # Sample
      be.ate_regard_eating_binges =  be.ate_regard_short_period, #rename to same as NBR
      be.roughly_binge_eating_regular.txt
       ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.be.coping.glad.id )
# Inspect colnames
colnames(dat.be.coping.glad.id )
#Differences
dim(dat.be.coping.glad)[1]-dim(dat.be.coping.glad.id )[1]

```

# Read in ED data: NBR COPING BE
```{r Read in data NBR COPING BE}
dat.be.nbr <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_nbr/be_coping_nbr.rds")

# Inspect dimensions
dim(dat.be.nbr)
# Inspect colnames
colnames(dat.be.nbr)

nrow(dat.be.nbr)

```

Select variables: NBR COPING BE
```{r Select variables NBR COPING BE}
dat.be.nbr.id <- dat.be.nbr %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% 
  add_column(sample = "NBR", .before = "be.ate_regard_short_period") %>% #create new column 
  select(
         ID = subjectid,# ID
       sample, # Sample
       be.ate_regard_eating_binges = be.ate_regard_short_period,
       be.roughly_binge_eating_regular.txt
         ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.be.nbr.id )
# Inspect colnames
colnames(dat.be.nbr.id )
#Differences
dim(dat.be.nbr)[1]-dim(dat.be.nbr.id )[1]

```

# Read in ED data: GLAD COPING AN SCREENER
```{r Read in data GLAD AN screener}
dat.an.scr.glad.coping <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_glad/an_scr_coping_glad.rds")

# Inspect dimensions
dim(dat.an.scr.glad.coping)
# Inspect colnames
colnames(dat.an.scr.glad.coping)

nrow(dat.an.scr.glad.coping)
```

Select variables: GLAD COPING AN SCREENER
```{r Select variables GLAD COPING AN SCREENER}
dat.an.scr.glad.coping.id <- dat.an.scr.glad.coping %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% 
  add_column(sample = "GLAD", .before = "an.weigh_weighed_people_thought") %>% #create new column 
  select(
         ID = externalDataReference,# ID
        sample, # Sample
        an.weigh_weighed_people_thought,
         ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.an.scr.glad.coping.id )
# Inspect colnames
colnames(dat.an.scr.glad.coping.id )
#Differences
dim(dat.an.scr.glad.coping)[1]-dim(dat.an.scr.glad.coping.id )[1]

```

# Read in ED data: GLAD COPING AN MODULE
```{r Read in data GLAD AN screener}
dat.an.glad.coping <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_glad/an_coping_glad.rds")

# Inspect dimensions
dim(dat.an.glad.coping)
# Inspect colnames
colnames(dat.an.glad.coping)

nrow(dat.an.glad.coping)
```

Select variables: GLAD COPING AN MODULE
```{r Select variables GLAD COPING AN SCREENER}
dat.an.glad.coping.id <- dat.an.glad.coping %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% 
  add_column(sample = "GLAD", .before = "an.1.how_old_were_you_then.txt") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         sample, # Sample
        an.1.how_old_were_you_then.txt,
         ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.an.glad.coping.id )
# Inspect colnames
colnames(dat.an.glad.coping.id )
#Differences
dim(dat.an.glad.coping)[1]-dim(dat.an.glad.coping.id )[1]

```

# Read in ED data: NBR AN SCREENER
```{r Read in data NBR AN SCREENER}
dat.an.scr.nbr <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_nbr/an_scr_coping_nbr.rds")

# Inspect dimensions
dim(dat.an.scr.nbr)
# Inspect colnames
colnames(dat.an.scr.nbr)

nrow(dat.an.scr.nbr)
```

Select variables: NBR AN SCREENER
```{r Select variables NBR AN SCREENER}
dat.an.scr.nbr.id <- dat.an.scr.nbr %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% 
  add_column(sample = "NBR", .before = "an.weigh_weighed_people_thought") %>% #create new column 
  select(
         ID = subjectid,# ID
        sample, # Sample
         an.weigh_weighed_people_thought
         ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.an.scr.nbr.id )
# Inspect colnames
colnames(dat.an.scr.nbr.id )
#Differences
dim(dat.an.scr.nbr)[1]-dim(dat.an.scr.nbr.id)[1]

```

# Read in ED data: NBR AN MODULE
```{r Read in data NBR AN SCREENER}
dat.an.nbr <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_nbr/an_coping_nbr.rds")

# Inspect dimensions
dim(dat.an.nbr)
# Inspect colnames
colnames(dat.an.nbr)

nrow(dat.an.nbr)
```

Select variables: NBR AN MODULE
```{r Select variables NBR AN SCREENER}
dat.an.nbr.id <- dat.an.nbr %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% 
 add_column(sample = "NBR", .before = "an.1.how_old_were_you_then.txt") %>% #create new column 
  select(
         ID = subjectid,# ID
        sample, # Sample
  an.1.how_old_were_you_then.txt
         ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.an.nbr.id )
# Inspect colnames
colnames(dat.an.nbr.id )
#Differences
dim(dat.an.nbr)[1]-dim(dat.an.nbr.id)[1]

```

# Read in ED data: GLAD COPING MHD
```{r Read in data GLAD COPING mhd data}
dat.mhd.glad.coping <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_glad/mhd_coping_glad.rds")

# Inspect dimensions
dim(dat.mhd.glad.coping)
# Inspect colnames
colnames(dat.mhd.glad.coping)

nrow(dat.mhd.glad.coping)
```

Select variables: GLAD COPING MHD
```{r Select variables GLAD COPING MHD}
dat.mhd.glad.coping.id <- dat.mhd.glad.coping %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% 
  add_column(sample = "GLAD", .before = "mhd.anorexia_nervosa") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         sample, # Sample
        mhd_EndDate = endDate,
        mhd.anorexia_nervosa,
        mhd.anorexia_nervosa_current_past = mhd.anorexia_nervosa.1, # Current or in past
        mhd.anorexia_age_at_diagnosis = mhd.anorexia_nervosa.2, # Age at diagnosis
       
        # Current or past binge-type ED 
       mhd.bulimia_nervosa.1_current_past = mhd.bulimia_nervosa.1,
       mhd.atypical_bulimia_nervosa.1_current_past = mhd.atypical_bulimia_nervosa.1,
       mhd.bingeeating_disorder.1_current_past = mhd.bingeeating_disorder.1,
       mhd.atypical_bingeeating_disorder.1_current_past = mhd.atypical_bingeeating_disorder.1,
       
       # Age at diagnosis binge-type ED
       mhd.bulimia_nervosa.2_age_at_diagnosis = mhd.bulimia_nervosa.2,
       mhd.atypical_bulimia_nervosa.2_age_at_diagnosis = mhd.atypical_bulimia_nervosa.2,
       mhd.bingeeating_disorder.2_age_at_diagnosis = mhd.bingeeating_disorder.2,
       mhd.atypical_bingeeating_disorder.2_age_at_diagnosis = mhd.atypical_bingeeating_disorder.2,
       
        mhd.bulimia_nervosa,
        mhd.atypical_bulimia_nervosa,
        mhd.bingeeating_disorder,
        mhd.atypical_bingeeating_disorder,
       mhd.suspected_eating_disorder_diagnosed
         ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.mhd.glad.coping.id )
# Inspect colnames
colnames(dat.mhd.glad.coping.id )
#Differences
dim(dat.mhd.glad.coping)[1]-dim(dat.mhd.glad.coping.id )[1]

```

# Read in ED data: NBR COPING MHD
```{r Read in data NBR COPING mhd data}
dat.mhd.nbr.coping <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/coping_nbr/mhd_coping_nbr.rds")

# Inspect dimensions
dim(dat.mhd.nbr.coping)
# Inspect colnames
colnames(dat.mhd.nbr.coping)

nrow(dat.mhd.nbr.coping)
```

Select variables: NBR COPING MHD
```{r Select variables NBR COPING MHD}
dat.mhd.nbr.coping.id <- dat.mhd.nbr.coping %>% #new dataset with ID
  drop_na(subjectid) %>% # Drop NAs
  remove_duplicates("subjectid") %>% 
  add_column(sample = "NBR", .before = "mhd.anorexia_nervosa") %>% #create new column 
  select(
         ID = subjectid,# ID
         sample, # Sample
         mhd_EndDate = endDate,
        mhd.anorexia_nervosa,
        mhd.anorexia_nervosa_current_past = mhd.anorexia_nervosa.1, # Current or in past
        mhd.anorexia_age_at_diagnosis = mhd.anorexia_nervosa.2, # Age at diagnosis
       
       # Current or past binge-type ED 
       mhd.bulimia_nervosa.1_current_past = mhd.bulimia_nervosa.1,
       mhd.atypical_bulimia_nervosa.1_current_past = mhd.atypical_bulimia_nervosa.1,
       mhd.bingeeating_disorder.1_current_past = mhd.bingeeating_disorder.1,
       mhd.atypical_bingeeating_disorder.1_current_past = mhd.atypical_bingeeating_disorder.1,
       
       # Age at diagnosis binge-type ED
       mhd.bulimia_nervosa.2_age_at_diagnosis = mhd.bulimia_nervosa.2,
       mhd.atypical_bulimia_nervosa.2_age_at_diagnosis = mhd.atypical_bulimia_nervosa.2,
       mhd.bingeeating_disorder.2_age_at_diagnosis = mhd.bingeeating_disorder.2,
       mhd.atypical_bingeeating_disorder.2_age_at_diagnosis = mhd.atypical_bingeeating_disorder.2,
       
        mhd.bulimia_nervosa,
        mhd.atypical_bulimia_nervosa,
        mhd.bingeeating_disorder,
        mhd.atypical_bingeeating_disorder,
        mhd.suspected_eating_disorder_diagnosed
         ) %>%
  add_numeric(., exclude = exclude_cols) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(dat.mhd.nbr.coping.id )
# Inspect colnames
colnames(dat.mhd.nbr.coping.id )
#Differences
dim(dat.mhd.nbr.coping)[1]-dim(dat.mhd.nbr.coping.id )[1]

```

# Read in DEM data: NBR COPING AGE
```{r Read in data NBR COPING AGE data}
age_dat_nbr <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data/latest_freeze/coping_nbr/demographics/age_coping_nbr_clean_INTERNAL_ONLY.rds")
dim(age_dat_nbr)
colnames(age_dat_nbr)
```

# Read in DEM data: GLAD COPING AGE
```{r}
age_dat_glad_coping <- readRDS(file =  "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data/latest_freeze/coping_glad/demographics/age_coping_glad_clean_INTERNAL_ONLY.rds")
dim(age_dat_glad_coping)
colnames(age_dat_glad_coping)
```

# Merge data
## GLAD COPING
```{r Merge GLAD data}
# Merge
dat_glad1 <- dplyr::full_join(dat.be.coping.glad.id,
                              dat.an.scr.glad.coping.id,
                              by = c("ID",
                                     "sample"
                                     )
                              )

dat_glad2 <- dplyr::full_join(dat.mhd.glad.coping.id,
                              dat.an.glad.coping.id,
                              by = c("ID",
                                     "sample"
                                     )
                              )


dat_glad3 <- dplyr::full_join(dat_glad1,
                              age_dat_glad_coping,
                              by = c("ID",
                                     "sample"
                                     )
                              )

dat.ed.GLAD.COPING <- dplyr::full_join(dat_glad3,
                              dat_glad2,
                              by = c("ID",
                                     "sample"
                                     )
                              )


# Check rows
nrow(dat.ed.GLAD.COPING)

# Check columns
colnames(dat.ed.GLAD.COPING)
```

# Merge data
## NBR
```{r Merge NBR data}
# Merge
dat_nbr1 <- dplyr::full_join(dat.be.nbr.id,
                              dat.an.scr.nbr.id,
                              by = c("ID",
                                     "sample"
                                     )
                              )

dat_nbr2 <- dplyr::full_join(dat.mhd.nbr.coping.id,
                              dat.an.nbr.id,
                              by = c("ID",
                                     "sample"
                                     )
                              )

dat_nbr3 <- dplyr::full_join(dat_nbr1,
                              age_dat_nbr,
                              by = c("ID",
                                     "sample"
                                     )
                            )

dat.ed.NBR <- dplyr::full_join(dat_nbr3,
                              dat_nbr2,
                              by = c("ID",
                                     "sample"
                                     )
                            )

# Check rows
nrow(dat.ed.NBR)

# Check columns
colnames(dat.ed.NBR)
```

# Bind data 
# GLAD + NBR
```{r Bind data GLAD & NBR}
# Bind
dat.ed.COPING <- dat.ed.NBR %>%
  bind_rows(
                   dat.ed.GLAD.COPING
                )

# Check colnames 
colnames(dat.ed.COPING)

# Check number of people
nrow(dat.ed.COPING)
```

## How many people started binge eating possibly during the pandemic? 
```{r binge eating started maybe during pandemic}
# Need to cross-check with their age! 
# This captures everyone. Need to discuss what to do with them.
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_binge_eating_vs_current_age =
           case_when(
             be.ate_regard_eating_binges == "Yes" & # Had lifetime binge eating 
             be.roughly_binge_eating_regular.txt == dem.dob_age_cop ~ "Possibly started during pandemic",
                    
             be.ate_regard_eating_binges == "Yes" & # Had lifetime binge eating 
                    be.roughly_binge_eating_regular.txt < dem.dob_age_cop ~ "Prepandemic",
                    
             be.ate_regard_eating_binges == "Yes" & # Had lifetime binge eating 
                    be.roughly_binge_eating_regular.txt > dem.dob_age_cop ~ "Implausible age or age when started",
                    
             be.ate_regard_eating_binges == "Yes" & # Had lifetime binge eating 
                    is.na(be.roughly_binge_eating_regular.txt) ~ "Missing age when started",
                    
             be.ate_regard_eating_binges == "Yes" & # Had lifetime binge eating 
                    is.na(dem.dob_age_cop) ~ "Missing age"
                    )
  )

dat.ed.COPING %>%
  freq(pandemic_binge_eating_vs_current_age)
```

## How many people have a binge-type ED that might have started during the pandemic?
### Bulimia nervosa - prepan or pan?
19/11/21: 97 people have a current binge-type eating disorder and/or binge eating and said it was diagnosed/started at the same age that they are now... But we are not 100% sure when it started...i.e., whether it started DURING or BEFORE the pandemic. We would need to look at birthdays and if they turned a new age during the pandemic and have said that they were that age when it started (would then be pandemic start). If they turned that age BEFORE the pandemic started and said it started then, then would be prepandemic. For others who did not report their age, age at diagnosis, or did but they are implausible...what do we do about them?
```{r age at beginning of pandemic GLAD and NBR}
# First, need to calculate age at the beginning of the pandemic (23rd March 2020)
## NBR participants
dat.ed.COPING$age_start_pandemic_cop <- lubridate::interval(
    start = dat.ed.COPING$dem.dob_cop,
    end = as.Date("2020-03-23")) %/% # use modulo to round down
        lubridate::duration(num = 1, units = "years")

## GLAD participants
dat.ed.COPING$age_start_pandemic_glad <- lubridate::interval(
    start = dat.ed.COPING$dem.dob,
    end = as.Date("2020-03-23")) %/% # use modulo to round down
        lubridate::duration(num = 1, units = "years")

## Final age at start for both GLAD and NBR participants
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(age_start_pandemic =
           case_when(
             !is.na(age_start_pandemic_cop)~ age_start_pandemic_cop,
             !is.na(age_start_pandemic_glad)~ age_start_pandemic_glad
             )
         )
```

```{r working out if during the pandemic or before atypical binge-eating disorder}
# Work out if during pandemic - atypical binge-eating disorder
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_atypical_BED_vs_start_pandemic_age =
           case_when(
             
            mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" &
             age_start_pandemic < mhd.atypical_bingeeating_disorder.2_age_at_diagnosis_numeric ~ "Pandemic binge eating", #...but they've turned that age since the pandemic started (i.e., started binge eating during the pandemic)
             
          mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" &
             age_start_pandemic > mhd.atypical_bingeeating_disorder.2_age_at_diagnosis_numeric ~ "Pre-pandemic binge eating", # ...but they started binge eating at an age younger than their age at the beginning of the pandemic
            
           mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" &
             age_start_pandemic == mhd.atypical_bingeeating_disorder.2_age_at_diagnosis_numeric ~ "Probably pre-pandemic binge eating" #...same age, difficult to tell when they started EXACTLY
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_atypical_BED_vs_start_pandemic_age)

# How many people put the same age?  BED (n = 33)
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(BED_same_age =
           case_when(
           pandemic_bed_vs_current_age == "Possibly started during pandemic" ~ 1
         )
  )

# Check
dat.ed.COPING %>%
  freq(BED_same_age)

# Work out if during pandemic - binge-eating disorder
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_BED_vs_start_pandemic_age =
           case_when(
             
             BED_same_age == 1 & # Said their binge-eating disorder started at the age they were at when they answered the questionnaire...
             age_start_pandemic < mhd.bingeeating_disorder.2_age_at_diagnosis_numeric ~ "Pandemic binge eating", #...but they've turned that age since the pandemic started (i.e., started binge eating during the pandemic)
             
             BED_same_age == 1 & # Said their  binge-eating disorder started at the age they were at when they answered the questionnaire...
             age_start_pandemic > mhd.bingeeating_disorder.2_age_at_diagnosis_numeric ~ "Pre-pandemic binge eating", # ...but they started binge eating at an age younger than their age at the beginning of the pandemic
            
             BED_same_age == 1 & # Said their  binge-eating disorder started at the age they were at when they answered the questionnaire...
             age_start_pandemic == mhd.bingeeating_disorder.2_age_at_diagnosis_numeric ~ "Probably pre-pandemic binge eating" #...same age, difficult to tell when they started EXACTLY
             ) 
         )


# Check 
dat.ed.COPING %>%
  freq(pandemic_BED_vs_start_pandemic_age)

# How many people put the same age?  BN (n = 8)
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(BN_same_age =
           case_when(
           pandemic_bulimia_vs_current_age == "Possibly started during pandemic" ~ 1
         )
  )

# Check
dat.ed.COPING %>%
  freq(BN_same_age)

# Work out if during pandemic - bulimia nervosa
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_BN_vs_start_pandemic_age =
           case_when(
             
             BN_same_age == 1 & # Said their bulimia started at the age they were at when they answered the questionnaire...
             age_start_pandemic < mhd.bulimia_nervosa.2_age_at_diagnosis_numeric ~ "Pandemic binge eating", #...but they've turned that age since the pandemic started (i.e., started binge eating during the pandemic)
             
             BN_same_age == 1 & # Said their bulimia started at the age they were at when they answered the questionnaire...
             age_start_pandemic > mhd.bulimia_nervosa.2_age_at_diagnosis_numeric ~ "Pre-pandemic binge eating", # ...but they started binge eating at an age younger than their age at the beginning of the pandemic
            
             BN_same_age == 1 & # Said their bulimia started at the age they were at when they answered the questionnaire...
             age_start_pandemic == mhd.bulimia_nervosa.2_age_at_diagnosis_numeric ~ "Probably pre-pandemic binge eating" #...same age, difficult to tell when they started EXACTLY
             ) 
         )


# Check 
dat.ed.COPING %>%
  freq(pandemic_BN_vs_start_pandemic_age)
  
# How many people put the same age?  Binge eating (n = 90)
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(BE_same_age =
           case_when(
           pandemic_binge_eating_vs_current_age == "Possibly started during pandemic" ~ 1
         )
  )

# Check
dat.ed.COPING %>%
  freq(BE_same_age)

# Work out if during pandemic - binge eating
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_BE_vs_start_pandemic_age =
           case_when(
             
             BE_same_age == 1 & # Said their binge eating started at the age they were at when they answered the questionnaire...
             age_start_pandemic < be.roughly_binge_eating_regular.txt ~ "Pandemic binge eating", #...but they've turned that age since the pandemic started (i.e., started binge eating during the pandemic)
             
             BE_same_age == 1 & # Said their binge eating started at the age they were at when they answered the questionnaire...
             age_start_pandemic > be.roughly_binge_eating_regular.txt ~ "Pre-pandemic binge eating", # ...but they started binge eating at an age younger than their age at the beginning of the pandemic
            
             BE_same_age == 1 & # Said their binge eating started at the age they were at when they answered the questionnaire...
             age_start_pandemic == be.roughly_binge_eating_regular.txt ~ "Probably pre-pandemic binge eating" #...same age, difficult to tell when they started EXACTLY
             ) 
         )


# Check 
dat.ed.COPING %>%
  freq(pandemic_BE_vs_start_pandemic_age)
  
# How many people put the same age?  Atypical BN (n = 0)
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(atypical_BN_same_age =
           case_when(
           pandemic_atypical_bulimia_vs_current_age == "Possibly started during pandemic" ~ 1
         )
  )
```










```{r current bulimia? }
# Bulimia
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(possible_pandemic_bulimia =
           case_when(
             mhd.bulimia_nervosa == "Bulimia nervosa" &
             mhd.bulimia_nervosa.1_current_past == "Current" ~ 1 # +++ should we even look at this? what about people who join COPING late?
         )
  )
           
dat.ed.COPING %>%
  freq(possible_pandemic_bulimia) 
# 28/10/21: 121 people have CURRENT bulimia. We need to know if this started during the pandemic.

# Need to cross-check with their age!
# This captures everyone. Need to discuss what to do with them.
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_bulimia_vs_current_age =
           case_when(
                 mhd.bulimia_nervosa == "Bulimia nervosa" &
                    mhd.bulimia_nervosa.2_age_at_diagnosis_numeric == dem.dob_age_cop ~ "Possibly started during pandemic",
                    
                  mhd.bulimia_nervosa == "Bulimia nervosa" &
                    mhd.bulimia_nervosa.2_age_at_diagnosis_numeric < dem.dob_age_cop ~ "Prepandemic",
                    
                 mhd.bulimia_nervosa == "Bulimia nervosa" &
                    mhd.bulimia_nervosa.2_age_at_diagnosis_numeric > dem.dob_age_cop ~ "Implausible age or age at diagnosis",
                    
                   mhd.bulimia_nervosa == "Bulimia nervosa" &
                    is.na(mhd.bulimia_nervosa.2_age_at_diagnosis_numeric) ~ "Missing age at diagnosis",
                    
                  mhd.bulimia_nervosa == "Bulimia nervosa" &
                    is.na(dem.dob_age_cop) ~ "Missing age"
                    )
  )

dat.ed.COPING %>%
  freq(pandemic_bulimia_vs_current_age)
```

### Binge-eating disorder- prepan or pan?
```{r current binge-eating disorder? }
# Binge-eating disorder
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(possible_pandemic_bingeeating_disorder =
           case_when(end
  mhd.bingeeating_disorder == "Binge-eating disorder" &
           mhd.bingeeating_disorder.1_current_past == "Current" ~ 1
         )
  )

dat.ed.COPING %>%
  freq(possible_pandemic_bingeeating_disorder) 
# 28/10/21: 391 people have CURRENT binge-eating disorder. We need to know if this started during the pandemic.


# Need to cross-check with their age!
# This captures everyone. Need to discuss what to do with them.
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_bed_vs_current_age =
           case_when(possible_pandemic_bingeeating_disorder == 1 &
                       
                    mhd.bingeeating_disorder.2_age_at_diagnosis_numeric == dem.dob_age_cop ~ "Possibly started during pandemic",
                    
                    possible_pandemic_bingeeating_disorder == 1 &
                    mhd.bingeeating_disorder.2_age_at_diagnosis_numeric < dem.dob_age_cop ~ "Prepandemic",
                    
                    possible_pandemic_bingeeating_disorder == 1 &
                    mhd.bingeeating_disorder.2_age_at_diagnosis_numeric > dem.dob_age_cop ~ "Implausible age or age at diagnosis",
                    
                    possible_pandemic_bingeeating_disorder == 1 &
                    is.na(mhd.bingeeating_disorder.2_age_at_diagnosis_numeric) ~ "Missing age at diagnosis",
                    
                    possible_pandemic_bingeeating_disorder == 1 &
                    is.na(dem.dob_age_cop) ~ "Missing age"
                    )
  )

dat.ed.COPING %>%
  freq(pandemic_bed_vs_current_age)
```

### Atypical binge-eating disorder- prepan or pan?
```{r current atypical binge-eating disorder? }
# Atypical binge-eating disorder
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(possible_pandemic_atypical_bingeeating_disorder =
           case_when(
  mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" &
           mhd.atypical_bingeeating_disorder.1_current_past == "Current" ~ 1
         )
  )

dat.ed.COPING %>%
  freq(possible_pandemic_atypical_bingeeating_disorder) 
# 28/10/21: 45 people have CURRENT atypical binge-eating disorder. We need to know if this started during the pandemic.


# Need to cross-check with their age! 
# This captures everyone. Need to discuss what to do with them.
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_atypical_bed_vs_current_age =
           case_when(
             possible_pandemic_atypical_bingeeating_disorder == 1 &
                    mhd.atypical_bingeeating_disorder.2_age_at_diagnosis_numeric == dem.dob_age_cop ~ "Possibly started during pandemic",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    mhd.atypical_bingeeating_disorder.2_age_at_diagnosis_numeric < dem.dob_age_cop ~ "Prepandemic",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    mhd.atypical_bingeeating_disorder.2_age_at_diagnosis_numeric > dem.dob_age_cop ~ "Implausible age or age at diagnosis",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    is.na(mhd.atypical_bingeeating_disorder.2_age_at_diagnosis_numeric) ~ "Missing age at diagnosis",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    is.na(dem.dob_age_cop) ~ "Missing age"
                    )
  )

dat.ed.COPING %>%
  freq(pandemic_atypical_bed_vs_current_age)
```

### Atypical bulimia nervosa - prepan or pan?
```{r current atypical bulimia? }
# Atypical bulimia
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(possible_pandemic_atypical_bulimia =
           case_when(
             mhd.atypical_bulimia_nervosa == "Atypical bulimia nervosa" &
             mhd.atypical_bulimia_nervosa.1_current_past == "Current" ~ 1
         )
  )

dat.ed.COPING %>%
  freq(possible_pandemic_atypical_bulimia) 
# 28/10/21: 16 people have CURRENT atypical bulimia. We need to know if this started during the pandemic.

# Need to cross-check with their age! 
# This captures everyone. Need to discuss what to do with them.
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_atypical_bulimia_vs_current_age =
           case_when(
             possible_pandemic_atypical_bingeeating_disorder == 1 &
                    mhd.atypical_bulimia_nervosa.2_age_at_diagnosis_numeric == dem.dob_age_cop ~ "Possibly started during pandemic",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    mhd.atypical_bulimia_nervosa.2_age_at_diagnosis_numeric < dem.dob_age_cop ~ "Prepandemic",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    mhd.atypical_bulimia_nervosa.2_age_at_diagnosis_numeric > dem.dob_age_cop ~ "Implausible age or age at diagnosis",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    is.na(mhd.atypical_bulimia_nervosa.2_age_at_diagnosis_numeric) ~ "Missing age at diagnosis",
                    
                    possible_pandemic_atypical_bingeeating_disorder == 1 &
                    is.na(dem.dob_age_cop) ~ "Missing age"
                    )
  )

dat.ed.COPING %>%
  freq(pandemic_atypical_bulimia_vs_current_age)
```

# Now, need to combine all the binge phenotypes and identify people who we are unsure about.
```{r identify people we are unsure about} 
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(any_pandemic_binge_eating_vs_current_age =
           case_when(pandemic_atypical_bulimia_vs_current_age == "Prepandemic" |
                       pandemic_bulimia_vs_current_age == "Prepandemic" |
                       pandemic_bed_vs_current_age == "Prepandemic" |
                       pandemic_atypical_bed_vs_current_age == "Prepandemic" |
                       pandemic_binge_eating_vs_current_age == "Prepandemic" ~ "Prepandemic binge eating",
                    
                       pandemic_atypical_bed_vs_current_age == "Possibly started during pandemic" |
                       pandemic_bed_vs_current_age == "Possibly started during pandemic" |
                       pandemic_bulimia_vs_current_age == "Possibly started during pandemic" |
                       pandemic_atypical_bulimia_vs_current_age == "Possibly started during pandemic" |
                       pandemic_binge_eating_vs_current_age == "Possibly started during pandemic" ~ "Binge eating started possibly during pandemic",
                     
                       pandemic_atypical_bed_vs_current_age == "Missing age at diagnosis" |
                       pandemic_bed_vs_current_age == "Missing age at diagnosis" |
                       pandemic_bulimia_vs_current_age == "Missing age at diagnosis" |
                       pandemic_atypical_bulimia_vs_current_age == "Missing age at diagnosis" |
                       pandemic_binge_eating_vs_current_age == "Missing age when started" |
                       pandemic_atypical_bed_vs_current_age == "Missing age" |
                       pandemic_bed_vs_current_age == "Missing age" |
                       pandemic_bulimia_vs_current_age == "Missing age" |
                       pandemic_atypical_bulimia_vs_current_age == "Missing age" |
                       pandemic_binge_eating_vs_current_age == "Missing age" ~ "Missing age data" # 24 people are missing age data
                     
                     # The rest may have indicated that they have never binged, or have binged but in the past (or just be missing)
                     
                     )
         )
dat.ed.COPING %>%
  freq(any_pandemic_binge_eating_vs_current_age)
```



# Identify (again) people who we are unsure about.
These are people who put 'current' bingeing and we have looked at their age at diagnosis/start, the time they filled out the survey, and their birthdays.
Now that we have taken birthdays into account and the age they were at the beginning of the pandemic (Rather than just their current age), there should be fewer people that we are not sure about.
```{r identify people we are unsure about} 
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(final_any_pandemic_binge_eating =
           case_when( 
            # PREPANDEMIC
              
             # Identified without having to use birthdays (this is people who put current but a start age younger than their current age)
              pandemic_atypical_bulimia_vs_current_age == "Prepandemic" |
              pandemic_bulimia_vs_current_age == "Prepandemic" |
              pandemic_bed_vs_current_age == "Prepandemic" |
              pandemic_atypical_bed_vs_current_age == "Prepandemic" |
              pandemic_binge_eating_vs_current_age == "Prepandemic" |
             
             # Unsure (i.e., put a start age the same as their current age)vand had to look at birthdays 
             # (NB: No one with atypical BED put a start age the same as their current age)
             # Given that start age (for all binge-type EDs) is age at diagnosis, those who are 'probably' pre-pandemic, we have counted as prepandemic given diagnostic delays. (i.e., binge eating probably started long before they were actually diagnosed). For the binge eating variable, we can be less sure
              pandemic_BE_vs_start_pandemic_age == "Pre-pandemic binge eating" |
              pandemic_BN_vs_start_pandemic_age == "Pre-pandemic binge eating" |
              pandemic_BN_vs_start_pandemic_age == "Probably pre-pandemic binge eating"|  
              pandemic_BED_vs_start_pandemic_age == "Pre-pandemic binge eating" |
              pandemic_BED_vs_start_pandemic_age == "Probably pre-pandemic binge eating"|
              pandemic_atypical_BED_vs_start_pandemic_age == "Pre-pandemic binge eating" |
              pandemic_atypical_BED_vs_start_pandemic_age == "Probably pre-pandemic binge eating" |
           
           # People who put that their disorder was in the past
             (mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" &
              mhd.atypical_bingeeating_disorder.1_current_past == "Past") |
             (mhd.bingeeating_disorder == "Binge-eating disorder" &
              mhd.bingeeating_disorder.1_current_past == "Past") |
             (mhd.bulimia_nervosa == "Bulimia nervosa" &
              mhd.bulimia_nervosa.1_current_past == "Past") |
             (mhd.atypical_bulimia_nervosa == "Atypical bulimia nervosa" &
              mhd.atypical_bulimia_nervosa.1_current_past == "Past") ~ "Prepandemic binge eating",
             
          # PANDEMIC    
            # People who we were unsure about (i.e., put the same start age as current age) and had to look at birthdays 
            # (NB: No one with atypical BED put a start age the same as their current age)
              pandemic_BE_vs_start_pandemic_age == "Pandemic binge eating" |
              pandemic_BN_vs_start_pandemic_age == "Pandemic binge eating" |
              pandemic_BED_vs_start_pandemic_age == "Pandemic binge eating" |
              pandemic_atypical_BED_vs_start_pandemic_age == "Pandemic binge eating"  ~ "Pandemic binge eating",
               
           # People left over who we are still unsure about   
              pandemic_atypical_bed_vs_current_age == "Possibly started during pandemic" |
              pandemic_bed_vs_current_age == "Possibly started during pandemic" |
              pandemic_bulimia_vs_current_age == "Possibly started during pandemic" |
              pandemic_atypical_bulimia_vs_current_age == "Possibly started during pandemic" |
              pandemic_binge_eating_vs_current_age == "Possibly started during pandemic" |
              pandemic_BE_vs_start_pandemic_age == "Probably pre-pandemic binge eating" ~ "Still unsure",
            
           # People with current binge-type ED but missing age data
              pandemic_atypical_bed_vs_current_age == "Missing age at diagnosis" |
              pandemic_bed_vs_current_age == "Missing age at diagnosis" |
              pandemic_bulimia_vs_current_age == "Missing age at diagnosis" |
              pandemic_atypical_bulimia_vs_current_age == "Missing age at diagnosis" |
              pandemic_binge_eating_vs_current_age == "Missing age when started" |

              pandemic_atypical_bed_vs_current_age == "Missing age" |
              pandemic_bed_vs_current_age == "Missing age" |
              pandemic_bulimia_vs_current_age == "Missing age" |
              pandemic_atypical_bulimia_vs_current_age == "Missing age" |
              pandemic_binge_eating_vs_current_age == "Missing age"  ~ "Missing age data" # 2399 people are missing age data with 'current' binge eating
                     
           # NB: The rest may have indicated that they have never binged. The code above is focused on identifying who, out of those who indicated that they had HAD experienced binge eating, started this DURING or BEFORE the pandemic
                     
                     )
         )
dat.ed.COPING %>%
  freq(final_any_pandemic_binge_eating)
```

# COPING GLAD & NBR
## Lifetime binge eating at baseline
```{r Lifetime binge eating at baseline GLAD & NBR}
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(lifetime_binge_eating_baseline_numeric =
           case_when(
            # (See code above)
            # People who, for any binge-type ED or binge eating, indicated prepandemic (taking into account birthdays etc)
              final_any_pandemic_binge_eating ==  "Prepandemic binge eating"  ~ 1,
      
           # People who, for any binge-type ED or binge eating, indicated pandemic start and therefore, at baseline, had NOT experienced binge eating (taking into account birthdays etc) *will need to code these people as baseline binge eating*
            final_any_pandemic_binge_eating ==  "Pandemic binge eating"  ~ 0,
      
           # Never binged and never suspected eating disorder
           be.ate_regard_eating_binges == "No" &
           mhd.suspected_eating_disorder_diagnosed == "No" ~ 0, 
        
           # Never binged BUT has suspected ED (i.e., got shown ED options) BUT never suspected binge-type ED 
           be.ate_regard_eating_binges == "No" &
           mhd.bulimia_nervosa == "Not Bulimia nervosa" &
           mhd.atypical_bulimia_nervosa == "Not Atypical bulimia nervosa" &
           mhd.bingeeating_disorder == "Not Binge-eating disorder" &
           mhd.atypical_bingeeating_disorder == "Not Atypical binge-eating disorder" ~ 0,
        
           # Missing binge eating data 
         is.na(be.ate_regard_eating_binges) &
         (
          is.na(mhd.suspected_eating_disorder_diagnosed) |
          (is.na(mhd.bulimia_nervosa) &
          is.na(mhd.atypical_bulimia_nervosa) &
          is.na(mhd.bingeeating_disorder) &
          is.na(mhd.atypical_bingeeating_disorder))
        ) |
        
        # Missing age data
          final_any_pandemic_binge_eating == "Missing age data" ~ 2
        )
      )

# Check
dat.ed.COPING %>%
  freq(lifetime_binge_eating_baseline_numeric)

# +++ There are ~800 people who have missing data for either the binge eating question or the mhd, what should we do with these people? OR, for example, has said they've never binged but then endorsed a BED diagnosis...
dat.ed.COPING %>%
  filter(is.na(lifetime_binge_eating_baseline_numeric)) %>%
  select(final_any_pandemic_binge_eating,
           be.ate_regard_eating_binges,
           mhd.suspected_eating_disorder_diagnosed,
           mhd.bulimia_nervosa,
           mhd.atypical_bulimia_nervosa,
           mhd.bingeeating_disorder,
           mhd.atypical_bingeeating_disorder,
           age_start_pandemic,
           be.roughly_binge_eating_regular.txt
         
        )

```

# Low weight
## How many people have anorexia that may have started during the pandemic? 
```{r current anorexia?}
# Anorexia - current
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(possible_pandemic_anorexia =
           case_when(
             mhd.anorexia_nervosa == "Anorexia nervosa" &
             mhd.anorexia_nervosa_current_past == "Current" ~ 1
         ) 
  )

dat.ed.COPING %>%
  freq(possible_pandemic_anorexia) 
# 28/10/21: 128 people have CURRENT anorexia. We need to know if this started during the pandemic.

# Need to cross-check with their age! 
# This captures everyone. Need to discuss what to do with them.
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_anorexia_vs_current_age =
           case_when(
             possible_pandemic_anorexia == 1 &
                    mhd.anorexia_age_at_diagnosis_numeric == dem.dob_age_cop ~ "Possibly started during pandemic",
                    
                    possible_pandemic_anorexia == 1 &
                    mhd.anorexia_age_at_diagnosis_numeric < dem.dob_age_cop ~ "Prepandemic",
                    
                    possible_pandemic_anorexia == 1 &
                    mhd.anorexia_age_at_diagnosis_numeric > dem.dob_age_cop ~ "Implausible age or age at diagnosis",
                    
                    possible_pandemic_anorexia == 1 &
                    is.na(mhd.anorexia_age_at_diagnosis_numeric) ~ "Missing age at diagnosis",
                    
                    possible_pandemic_anorexia == 1 &
                    is.na(dem.dob_age_cop) ~ "Missing age"
                    )
  )

dat.ed.COPING %>%
  freq(pandemic_anorexia_vs_current_age)
```

## How many people have low weight that may have started during the pandemic? 
```{r}
# Need to cross-check with their age! 
# This captures everyone. Need to discuss what to do with them.
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_low_weight_vs_current_age =
           case_when(
             an.weigh_weighed_people_thought == "Yes"  & # Had lifetime low weight
             an.1.how_old_were_you_then.txt == dem.dob_age_cop ~ "Possibly started during pandemic",
                    
             an.weigh_weighed_people_thought == "Yes"  & # Had lifetime low weight
                    an.1.how_old_were_you_then.txt < dem.dob_age_cop ~ "Prepandemic",
                    
             an.weigh_weighed_people_thought == "Yes"  & # Had lifetime low weight
                    an.1.how_old_were_you_then.txt > dem.dob_age_cop ~ "Implausible age or age when started",
                    
           an.weigh_weighed_people_thought == "Yes"  & # Had lifetime low weight
                    is.na(an.1.how_old_were_you_then.txt) ~ "Missing age when started",
                    
          an.weigh_weighed_people_thought == "Yes"  & # Had lifetime low weight 
                    is.na(dem.dob_age_cop) ~ "Missing age"
                    )
  )

dat.ed.COPING %>%
  freq(pandemic_low_weight_vs_current_age)
```

# Now, need to combine anorexia and low weight identify people who we are unsure about.
```{r identify people we are unsure about} 
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(any_pandemic_low_weight_vs_current_age =
           case_when(pandemic_low_weight_vs_current_age == "Prepandemic" |
                       pandemic_anorexia_vs_current_age == "Prepandemic" ~ "Prepandemic low weight",
                     
                     pandemic_low_weight_vs_current_age == "Possibly started during pandemic" |
                       pandemic_anorexia_vs_current_age == "Possibly started during pandemic" ~ "Low weight started possibly during pandemic",
                    
                   pandemic_low_weight_vs_current_age == "Missing age when started" |
                       pandemic_anorexia_vs_current_age == "Missing age at diagnosis" |
                       pandemic_low_weight_vs_current_age == "Missing age" |
                       pandemic_anorexia_vs_current_age == "Missing age"  ~ "Missing age data" # 171 people are missing age data
                     
                     # The rest may have indicated that they have never had low weight, or have had low weight but in the past (or just be missing)
                     
                     )
         )
dat.ed.COPING %>%
  freq(any_pandemic_low_weight_vs_current_age)
```

19/11/21: 152 people have current anorexia and/or low weight and said it was diagnosed/started at the same age that they are now... But we are not 100% sure when it started...i.e., whether it started DURING or BEFORE the pandemic. We would need to look at birthdays and if they turned a new age during the pandemic and have said that they were that age when it started (would then be pandemic start). If they turned that age BEFORE the pandemic started and said it started then, then would be prepandemic. For others who did not report their age, age at diagnosis, or did but they are implausible...what do we do about them?
```{r working out if during the pandemic or before LW}
# How many people put the same age? 
# Anorexia (n = 4)
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(anorexia_same_age =
           case_when(
           pandemic_anorexia_vs_current_age == "Possibly started during pandemic" ~ 1
         )
  )

# Check
dat.ed.COPING %>%
  freq(anorexia_same_age)

# Work out if during pandemic - anorexia
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_anorexia_vs_start_pandemic_age =
           case_when(
             
             anorexia_same_age == 1 & # Said their anorexia started at the age they were at when they answered the questionnaire...
             age_start_pandemic < mhd.anorexia_age_at_diagnosis_numeric ~ "Pandemic low weight", #...but they've turned that age since the pandemic started (i.e., anorexia started during the pandemic)
             
             anorexia_same_age == 1 & # Said their anorexia started at the age they were at when they answered the questionnaire...
             age_start_pandemic > mhd.anorexia_age_at_diagnosis_numeric ~ "Pre-pandemic low weight", # ...but anorexia started at an age younger than their age at the beginning of the pandemic
            
             anorexia_same_age == 1 & # Said their anorexia started at the age they were at when they answered the questionnaire...
             age_start_pandemic == mhd.anorexia_age_at_diagnosis_numeric ~ "Probably pre-pandemic low weight" #...same age, difficult to tell when they started EXACTLY
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_anorexia_vs_start_pandemic_age)

# How many people put the same age? 
# Low weight ()
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(low_weight_same_age =
           case_when(
           pandemic_low_weight_vs_current_age == "Possibly started during pandemic" ~ 1
         )
  )

# Check
dat.ed.COPING %>%
  freq(low_weight_same_age)

# Work out if during pandemic - low weight
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_low_weight_vs_start_pandemic_age =
           case_when(
             
             low_weight_same_age == 1 & # Said their low weight  started at the age they were at when they answered the questionnaire...
             age_start_pandemic < an.1.how_old_were_you_then.txt ~ "Pandemic low weight", #...but they've turned that age since the pandemic started (i.e., low weight started during the pandemic)
             
             low_weight_same_age == 1 & # Said their low weight started at the age they were at when they answered the questionnaire...
             age_start_pandemic > an.1.how_old_were_you_then.txt ~ "Pre-pandemic low weight", # ...but they started low weight at an age younger than their age at the beginning of the pandemic
            
             low_weight_same_age == 1 & # Said their low weight started at the age they were at when they answered the questionnaire...
             age_start_pandemic == an.1.how_old_were_you_then.txt ~ "Probably pre-pandemic low weight" #...same age, difficult to tell when they started EXACTLY
             ) 
         )


# Check 
dat.ed.COPING %>%
  freq(pandemic_low_weight_vs_start_pandemic_age)
```

# Identify (again) people who we are unsure about.
These are people who put 'current' low weight and we have looked at their age at diagnosis/start, the time they filled out the survey, and their birthdays. Now that we have taken birthdays into account, there should be fewer people that we are not sure about.
```{r identify people we are unsure about} 
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(final_any_pandemic_low_weight =
           case_when( 
            # PREPANDEMIC
              # Identified without having to use birthdays (this is people who put current but a start age younger than their current age)
              pandemic_anorexia_vs_current_age == "Prepandemic" |
              pandemic_low_weight_vs_current_age == "Prepandemic" |
           
             # Unsure (i.e., put a start age the same as their current age) and had to look at birthdays 
             # Given that start age (for the anorexia variable) is age at diagnosis, those who are 'probably' pre-pandemic, we have counted as prepandemic given diagnostic delays. (i.e., low weight probably started long before they were actually diagnosed). we can be less sure of the low weight variable 
              pandemic_anorexia_vs_start_pandemic_age == "Pre-pandemic low weight" |
              pandemic_anorexia_vs_start_pandemic_age == "Probably pre-pandemic low weight" |
             pandemic_low_weight_vs_start_pandemic_age == "Pre-pandemic low weight"|
             
        # People who put that their anorexia was in the past
             (mhd.anorexia_nervosa == "Anorexia nervosa" &
              mhd.anorexia_nervosa_current_past == "Past") ~ "Prepandemic low weight",
             
          # PANDEMIC    
            # People who we were unsure about (i.e., put the same start age as current age) and had to look at birthdays 
              pandemic_anorexia_vs_start_pandemic_age == "Pandemic low weight" |
              pandemic_low_weight_vs_start_pandemic_age == "Pandemic low weight" ~ "Pandemic low weight",
               
           # People left over who we are still unsure about   
             pandemic_low_weight_vs_start_pandemic_age == "Probably pre-pandemic low weight" |
              pandemic_anorexia_vs_current_age == "Possibly started during pandemic" |
              pandemic_low_weight_vs_current_age == "Possibly started during pandemic" ~ "Still unsure",
               
          # People with current low weight but missing age data
            pandemic_anorexia_vs_current_age == "Missing age at diagnosis" |
            pandemic_anorexia_vs_current_age == "Missing age" |
            pandemic_low_weight_vs_current_age == "Missing age when started" |
            pandemic_low_weight_vs_current_age == "Missing age" ~ "Missing age data" # 165 people are missing age data
                     
           # NB: The rest may have indicated that they have never had low weight The code above is focused on identifying who, out of those who indicated that they had HAD experienced low weight, started this DURING or BEFORE the pandemic
                     
                     )
         )

dat.ed.COPING %>%
  freq(final_any_pandemic_low_weight)

# +++ Everyone left has reported the same age and were that age at the beginning of the pandemic...what should we do with these people? (n = ~150)
dat.ed.COPING %>%
  filter(final_any_pandemic_low_weight == "Still unsure") %>%
  select(mhd.anorexia_nervosa,
         mhd.anorexia_nervosa_current_past,
         mhd.anorexia_age_at_diagnosis,
         an.weigh_weighed_people_thought,
         an.1.how_old_were_you_then.txt,
         age_start_pandemic
         )

```

## Lifetime low weight at baseline
```{r Lifetime low weight at baseline GLAD & NBR}
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(lifetime_low_weight_baseline_numeric =
           case_when(
            # (See code above)
            # People who, for anorexia or low weight, indicated prepandemic (taking into account birthdays etc)
              final_any_pandemic_low_weight ==  "Prepandemic low weight"  ~ 1,
      
           # People who, for anorexia or low weight, indicated pandemic start and therefore, at baseline, had NOT experienced low weight (taking into account birthdays etc) *will need to code these people as baseline low weight*
            final_any_pandemic_low_weight ==  "Pandemic low weight"  ~ 0,
      
        # Never low weight and never suspected eating disorder
        an.weigh_weighed_people_thought == "No" &
        mhd.suspected_eating_disorder_diagnosed == "No" ~ 0, 
       
        # Never low weight BUT has suspected ED (i.e., got shown ED options) BUT never suspected anorexia
         an.weigh_weighed_people_thought == "No" &
        mhd.anorexia_nervosa == "Not Anorexia nervosa"  ~ 0,
         
           # Missing low weight data 
         is.na(an.weigh_weighed_people_thought) &
         (
          is.na(mhd.suspected_eating_disorder_diagnosed) |
          (is.na(mhd.anorexia_nervosa))
        ) |
        
        # Missing age data
          final_any_pandemic_low_weight == "Missing age data" ~ 2
        )
      )

# Check
dat.ed.COPING %>%
  freq(lifetime_low_weight_baseline_numeric)


# +++ There are ~900 people who have missing data for either the low weight question or the mhd, what should we do with these people? OR, have same age at start of pandemic as age at start of low weight
dat.ed.COPING %>%
  filter(is.na(lifetime_low_weight_baseline_numeric)) %>%
  select(final_any_pandemic_low_weight,
           an.weigh_weighed_people_thought,
           mhd.suspected_eating_disorder_diagnosed,
           mhd.anorexia_nervosa,
           age_start_pandemic,
           mhd.anorexia_age_at_diagnosis_numeric,
         an.1.how_old_were_you_then.txt
        )
```

# GLAD original data
## ED100K AFTER 23RD JAN
Reminder: I have chosen this date as it is 3 months before the start of the pandemic. We are going to assume that if someone at this point does NOT endorse binge eating or low weight, then we can assume that if they experience it during the pandemic, then it is for the first time (it is however likely that we capture some false positives of 'new experiences' if someone experienced it after filling out the GLAD signup but before filling out the COPING baseline). 
### GLAD ED100K self-reported CLEANED diagnostics data
```{r read in GLAD ED100K self reported diagnosis}
exclude_cols_glad <- c("ID",
                       "sample_glad") 

glad_ed100k_selfreport_diagnoses <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data/latest_freeze/glad/eating/selfreported_ed100k_diagnoses_glad_clean.rds")
dim(glad_ed100k_selfreport_diagnoses)
colnames(glad_ed100k_selfreport_diagnoses)

glad_ed100k_selfreport_diagnoses <- glad_ed100k_selfreport_diagnoses %>% 
  add_column(sample_glad = "GLAD", .before = "an.1.anorexia_nervosa") %>% #create new column 
  select(
         ID ,
         sample_glad, # Sample
         an.1.anorexia_nervosa,
         an.1.bingeeating_disorder ,
         an.1.bulimia_nervosa,
         an.1.atypical_binge_eating_disorder,
         an.1.compulsive_overeating,
         an.1.overeating
         ) 

dim(glad_ed100k_selfreport_diagnoses)
colnames(glad_ed100k_selfreport_diagnoses)
```

## Import GLAD mhd self-report data
```{r Read in data glad mhd data}
glad_mhd <- readRDS(file =   "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/glad/mhd_glad.rds") # 
dim(glad_mhd)
colnames(glad_mhd)

glad_mhd <- glad_mhd %>% 
  remove_duplicates("externalDataReference") %>%
  add_column(sample_glad = "GLAD", .before = "mhd.an") %>% #create new column 
  select(
         ID = externalDataReference ,
         sample_glad, # Sample
         mhd.an,
         mhd.bn,
     #    mhd.atypical_bn, # Not in GLAD
     #    mhd.atypical_bed, # Not in GLAD
         mhd.bed,
         endDate_mhd = endDate
         )

dim(glad_mhd)
colnames(glad_mhd)
```

## Import GLAD ED100K self-report symptom data
AN screener
```{r Read in data glad an screener}
glad_AN_scr <- readRDS(file =   "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/glad_ed/an_scr_glad.rds")
dim(glad_AN_scr)
colnames(glad_AN_scr)

glad_AN_scr.id <- glad_AN_scr %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% 
  add_column(sample_glad = "GLAD", .before = "an.1.people_thought_weigh_weighed") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         sample_glad, # Sample
         an.1.people_thought_weigh_weighed,
         endDate_ED100K_AN = endDate
         ) %>%
  add_numeric(., exclude = exclude_cols_glad) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad_AN_scr.id )
# Inspect colnames
colnames(glad_AN_scr.id )
#Differences
dim(glad_AN_scr)[1]-dim(glad_AN_scr.id)[1]
```

## Import GLAD ED100K self-report symptom data
BE symptom data
```{r Read in data glad be data}
glad_BE <- readRDS(file =   "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/glad_ed/be_glad_ed.rds")
dim(glad_BE)
colnames(glad_BE)

glad_BE.id <- glad_BE %>% #new dataset with ID
  drop_na(externalDataReference) %>% # Drop NAs
  remove_duplicates("externalDataReference") %>% 
  add_column(sample_glad = "GLAD", .before = "be.short_period_ate_regard") %>% #create new column 
  select(
         ID = externalDataReference,# ID
         sample_glad, # Sample
         be.short_period_ate_regard, 
         endDate_ED100K_BE = endDate
         ) %>%
  add_numeric(., exclude = exclude_cols_glad) %>%
  mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
  mutate_if(is.numeric, ~na_if(., -99)) %>%
  mutate_if(is.numeric, ~na_if(., -77)) %>%
  mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
  mutate_if(is.factor, ~na_if(., "Don't know")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
  mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
  mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))

# Inspect dimensions
dim(glad_BE.id )
# Inspect colnames
colnames(glad_BE.id )
#Differences
dim(glad_BE)[1]-dim(glad_BE.id)[1]
```

Merge GLAD original data
```{r merge glad and glad coping}
glad1 <- dplyr::full_join(glad_BE.id,
                          glad_AN_scr.id,
                          by = c("ID",
                                 "sample_glad"))


glad2 <- dplyr::full_join(glad_mhd,
                          glad_ed100k_selfreport_diagnoses,
                          by = c("ID",
                                 "sample_glad"))

glad_dat <- dplyr::full_join(glad1,
                          glad2,
                          by = c("ID",
                                 "sample_glad"))

# Look at the data
colnames(glad_dat)
```

## Identify lifetime binge eating at GLAD sign-up AFTER 23RD JANUARY 2020
```{r Lifetime binge eating at GLAD sign-up}
glad_dat <- glad_dat %>%
  mutate(lifetime_binge_eating_baseline_GLAD_numeric =
           case_when(
             # Self-reported binge eating ED100K at ANY time
             be.short_period_ate_regard == "Yes" | # GLAD self-reported binge eating optional ED100K BE module
             
             # Self-reported binge-type ED in optional ED100K
             an.1.bingeeating_disorder == "Binge-eating disorder" | # GLAD ED100K self-report diagnosis BED
             an.1.bulimia_nervosa == "Bulimia nervosa"  |    # GLAD optional ED100K self-report diagnosis BN
             an.1.atypical_binge_eating_disorder == "Atypical BED" |  # GLAD optional ED100K self-report diagnosis ATYPICAL BED
             an.1.compulsive_overeating == "Compulsive overeating" |  # GLAD optional ED100K self-report diagnosis compulsive overeating 
            an.1.overeating == "Overeating" |
               
           # Self-reported binge-type ED in sign-up mhd (NB: There is NO screening question in glad mhd [unlike glad coping mhd]; everyone is asked about eating disorder diagnosis. Also no atypical BN or atypical BED in GLAD signup mhd)
               mhd.bn == 1 | # GLAD mhd self-report diagnosis BN
              mhd.bed == 1 # GLAD mhd self-report diagnosis BED
             ~ 1, # Lifetime binge-eating
            
            # For those who filled out the optional ED100K (likely to be AFTER the main GLAD sign-up, so this should come first)
            (endDate_ED100K_BE > as.Date("2020-01-23") & # Filled out the ED100K AFTER 23RD JAN 2020 # +++HLD: Should we put an end date? i.e., 23rd March?
           
               (be.short_period_ate_regard == "No" & # NO GLAD self-reported binge eating optional ED100K BE module
             an.1.bingeeating_disorder == "Not Binge-eating disorder" & # NO GLAD ED100K self-report diagnosis BED
             an.1.bulimia_nervosa == "Not Bulimia nervosa" &    # NO GLAD optional ED100K self-report diagnosis BN
             an.1.atypical_binge_eating_disorder == "Not Atypical BED" & # NO GLAD optional ED100K self-report diagnosis ATYPICAL BED
             an.1.compulsive_overeating == "Not Compulsive overeating" & # no GLAD optional ED100K self-report compulsive overeating
             an.1.overeating == "Not Overeating")    # no GLAD optional ED100K self-report overeating
             )  ~ 0,    
            
            # For those who filled out the GLAD sign-up and not the optional ED100K  (do NOT want to capture those who DID fill out the ED100K and indicated they had binged)
            (
              (is.na(endDate_ED100K_BE) & 
              endDate_mhd > as.Date("2020-01-23")) & # Filled out the MHD AFTER 23RD JAN 2020
            (mhd.bn == 0 & # NO GLAD mhd self-report diagnosis BN
             mhd.bed == 0 # NO GLAD mhd self-report diagnosis BED
             )) ~ 0, 
            
         # Missing all binge data 
             is.na(be.short_period_ate_regard) & # GLAD self-reported binge eating optional ED100K BE module
             is.na(an.1.bingeeating_disorder) & # GLAD ED100K self-report diagnosis
             is.na(an.1.bulimia_nervosa) &    # GLAD optional ED100K self-report diagnosis
             is.na(an.1.atypical_binge_eating_disorder) & # GLAD ED100K self-report diagnosis
             is.na(an.1.compulsive_overeating) &    # GLAD optional ED100K self-report diagnosis
             is.na(an.1.overeating) &    # GLAD optional ED100K self-report diagnosis
              is.na(mhd.bn) & # GLAD mhd self-report diagnosis
             is.na(mhd.bed)  # GLAD mhd self-report diagnosis  
           ~ 2 # Missing all lifetime binge eating data in GLAD original data 
           )
    
  )

# Check 
glad_dat %>%
  freq(lifetime_binge_eating_baseline_GLAD_numeric)

# Investigate NAs (A lot of people are not missing all binge data but answered the GLAD questionnaire before the 23rd Jan 2020)
glad_dat %>%
  filter(is.na(lifetime_binge_eating_baseline_GLAD_numeric)) %>%
  select( be.short_period_ate_regard,
          an.1.bingeeating_disorder,
          an.1.bulimia_nervosa,
          an.1.atypical_binge_eating_disorder,
          an.1.compulsive_overeating,
          an.1.overeating,
          mhd.bn,
          mhd.bed,
          endDate_ED100K_BE,
          endDate_mhd
  )
```

## Identify lifetime low weight at GLAD sign-up AFTER 23RD JANUARY 2020
```{r Lifetime binge eating at GLAD sign-up}
glad_dat <- glad_dat %>%
  mutate(lifetime_low_weight_baseline_GLAD_numeric =
           case_when(
             # Self-reported low weight ED100K
             an.1.people_thought_weigh_weighed == "Yes" | # GLAD self-reported low weight optional ED100K AN module
             
             # Self-reported anorexia in optional ED100K
             an.1.anorexia_nervosa == "Anorexia nervosa" | # GLAD ED100K self-report diagnosis AN
             
             # Self-reported anorexia in sign-up mhd (NB: There is NO screening question in glad mhd [unlike glad coping mhd]; everyone is asked about eating disorder diagnosis)
             mhd.an == 1 # GLAD mhd self-report diagnosis AN
             ~ 1, # Lifetime low weight
            
             # For those who filled out the optional ED100K (likely to be AFTER the main GLAD sign-up, so this should come first)
            endDate_ED100K_AN > as.Date("2020-01-23") & # Filled out the ED100K AFTER 23RD JAN 2020 # +++HLD: Should we put an end date? i.e., 23rd March?
             an.1.people_thought_weigh_weighed == "No" & # NO GLAD self-reported low weight optional ED100K AN module
             an.1.anorexia_nervosa == "Not Anorexia nervosa"  # NO GLAD ED100K self-report diagnosis AN
              ~ 0,    
            
            # For those who filled out the GLAD sign-up and not the optional ED100K  (do NOT want to capture those who DID fill out the ED100K and indicated they had low weight)
            (
            (is.na(endDate_ED100K_AN) & 
              endDate_mhd > as.Date("2020-01-23")) & # Filled out the MHD AFTER 23RD JAN 2020
            mhd.an == 0  # NO GLAD mhd self-report diagnosis anorexia nervosa
             ) ~ 0, 
            
            is.na(an.1.anorexia_nervosa) &
            is.na(an.1.people_thought_weigh_weighed) &
            is.na(mhd.an) ~ NA_real_ # Missing all lifetime low weight data in GLAD original data
           )
    
  )

# Check  (NB: A lot of people are not missing all low weight data but answered the GLAD questionnaire before the 23rd Jan 2020)
glad_dat %>%
  freq(lifetime_low_weight_baseline_GLAD_numeric)
```

Combine GLAD sign-up self-reported lifetime BE and lifetime low weight with GLAD COPING baseline self-reported lifetime BE and low weight
```{r bing GLAD self-report BE lifetime}
# Filter out participants from COPING GLAD from the merged COPING GLAD & NBR dataset
dat.ed.GLAD.COPING <- dat.ed.COPING %>%
  filter(sample == "GLAD")

# Check
dat.ed.GLAD.COPING %>%
  nrow()

# Merge COPING GLAD and GLAD
glad_merged <- dplyr::full_join(dat.ed.GLAD.COPING,
                                glad_dat,
                                by = "ID")


# Check
glad_merged %>%
  colnames()

glad_merged %>%
  nrow()
```


Lifetime binge eating: GLAD sign-up combined with GLAD COPING baseline
```{r lifetime binge eating combined GLAD data} 
glad_merged <- glad_merged %>%
  mutate(lifetime_binge_eating_baseline_combined_numeric =
           case_when(
             lifetime_binge_eating_baseline_numeric == 1 | # Reported lifetime binge eating at COPING baseline
             lifetime_binge_eating_baseline_GLAD_numeric == 1 ~ 1, # Reported lifetime binge eating at GLAD sign-up,
             
            is.na(lifetime_binge_eating_baseline_numeric) &
              is.na(lifetime_binge_eating_baseline_GLAD_numeric) ~ NA_real_, # Missing for both
             
              lifetime_binge_eating_baseline_numeric == 0 |  # No binge eating for at least one (either after 23rd Jan 2020 in GLAD sign-up or not endorsed at COPING baseline)
            lifetime_binge_eating_baseline_GLAD_numeric == 0 ~ 0
            
           )
    
  )

# Check
glad_merged %>%
  freq(lifetime_binge_eating_baseline_combined_numeric)
```

Lifetime low weight: GLAD sign-up combined with GLAD COPING baseline
```{r lifetime low weight combined GLAD data} 
glad_merged <- glad_merged %>%
  mutate(lifetime_low_weight_baseline_combined_numeric =
           case_when(
             lifetime_low_weight_baseline_numeric == 1 | # Reported lifetime low weight at COPING baseline
             lifetime_low_weight_baseline_GLAD_numeric == 1 ~ 1, # Reported lifetime low weight at GLAD sign-up,
             
            is.na(lifetime_low_weight_baseline_numeric) &
              is.na(lifetime_low_weight_baseline_GLAD_numeric) ~ NA_real_, # Missing for both
             
              lifetime_low_weight_baseline_numeric == 0 |  # No low weight for at least one (either after 23rd Jan 2020 in GLAD sign-up or not endorsed at COPING baseline)
            lifetime_low_weight_baseline_GLAD_numeric == 0 ~ 0
            
           )
    
  )

# Check
glad_merged %>%
  freq(lifetime_low_weight_baseline_combined_numeric)
```

# Import RAMP MHD self-report data
```{r Read in data RAMP MHD self-report}
ramp.mhd.raw <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data/latest_freeze/ramp/clinical/mhd_ramp_clean.rds")
dim(ramp.mhd.raw)
colnames(ramp.mhd.raw)
```

Select columns from RAMP self-report data
NB: No questions in RAMP about age at diagnosis..
```{r Select columns RAMP MHD self-report}
ramp.mhd.raw.id <- ramp.mhd.raw %>%
    select(
      ID,
      sample, # Sample
      startDate_mhd = startDate,
      mhd.an_cop_numeric,                                                   
      mhd.bn_cop_numeric,                                                    
      mhd.bed_cop_numeric,                                                   
) 

# Inspect dimensions
ramp.mhd.raw.id %>%
  dim()
# Inspect colnames
ramp.mhd.raw.id %>%
  colnames()
```

# Import RAMP EDEQ baseline screener data
```{r Read in data RAMP EDEQ baseline}
ramp.edeq.scr.baseline <- readRDS(file =  "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/ramp/ed_scid5_ramp.rds")
dim(ramp.edeq.scr.baseline)
colnames(ramp.edeq.scr.baseline)
```

```{r Select columns RAMP EDEQ screener baseline}
ramp.edeq.scr.baseline.id <- ramp.edeq.scr.baseline %>%
    drop_na(`Login ID`) %>% # Drop NAs
    remove_duplicates("Login ID") %>% # Remove duplicates based on ID
    add_column(sample = "RAMP", 
               .before = "ed_scid5.weigh_weighed_past_month") %>% #create new column 
    select(
      ID = `Login ID`, # ID
      sample, # Sample
      ed_scid5.weigh_weighed_past_month, # Over the past month, have you weighed much less than other people thought you ought to weigh?
      ed_scid5.regular_episodes_eating_binges # Over the past month, have you had regular episodes of overeating or eating binges when you ate what most people would regard as an unusually large amount of food in a short period of time ?
      ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(ramp.edeq.scr.baseline.id)
  # Inspect colnames
  colnames(ramp.edeq.scr.baseline.id)
  # Differences
  dim(ramp.edeq.scr.baseline)[1]-dim(ramp.edeq.scr.baseline.id)[1]
```

# Import RAMP EDEQ baseline data
```{r Read in data RAMP EDEQ baseline}
ramp.edeq.baseline <- readRDS(file =  "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/BASELINE_ramp2021-11-24.rds")
dim(ramp.edeq.baseline)
colnames(ramp.edeq.baseline)
```

```{r Select columns RAMP EDEQ baseline}
ramp.edeq.baseline.id <- ramp.edeq.baseline %>%
    select(
      ID, # ID
      sample, # Sample
      edeq.regard_lost_control_eaten.1_.Wavebaseline_numeric # Over the past 28 days BEFORE PANDEMIC, how many times have you: Eaten what other people would regard as an unusually large amount of food with a sense of having lost control over your eating?
      ) 

  # Inspect dimensions
  dim(ramp.edeq.baseline.id)
  # Inspect colnames
  colnames(ramp.edeq.baseline.id)
  # Differences
  dim(ramp.edeq.baseline)[1]-dim(ramp.edeq.baseline.id)[1]
```

Merge RAMP MHD and EDEQ BASELINE and EDEQ SCREENER data
```{r bind ramp edeq and mhd data}
ramp_mhd_and_edeq <- dplyr::full_join(ramp.mhd.raw.id,
                          ramp.edeq.baseline.id,
                          by = c("ID",
                                  "sample")
)


ramp_dat <- dplyr::full_join(ramp_mhd_and_edeq,
                          ramp.edeq.scr.baseline.id,
                          by = c("ID",
                                  "sample")
)

# Check
ramp_dat %>%
  colnames()

ramp_dat %>%
  nrow()
```

# RAMP - Lifetime/RECENT binge eating at baseline
```{r Lifetime binge eating at baseline RAMP}
ramp_dat <- ramp_dat %>%
  mutate(lifetime_binge_eating_baseline_numeric =
           case_when(
              startDate_mhd < as.Date("2020-05-23") & # Filled out the MHD before 23RD June 2020 and ... 
             (mhd.bn_cop_numeric == 1 |   #...diagnosis of BN or BED                                                
              mhd.bed_cop_numeric == 1) ~ 1,
             
             # If indicated they have binged in the 28 days before the pandemic, this would also count as BE pre-pandemic
               edeq.regard_lost_control_eaten.1_.Wavebaseline_numeric > 0 ~ 1, 
             
             mhd.bn_cop_numeric == 0 &  # Never had a binge-type ED
             mhd.bed_cop_numeric ==  0 &                                                    
            (edeq.regard_lost_control_eaten.1_.Wavebaseline_numeric == 0 | # No days of binge eating in the past month before the pandemic
           ed_scid5.regular_episodes_eating_binges == "No") # OR did not pass EDE-Q screener (no bingeing in past month) so did not get asked the above question
            ~  0,
           
           # Missing all binge data
           is.na(mhd.bn_cop_numeric) &
           is.na(mhd.bed_cop_numeric) &
             is.na(edeq.regard_lost_control_eaten.1_.Wavebaseline_numeric) &
             is.na(ed_scid5.regular_episodes_eating_binges) ~ 2
           
           
           )
  )
    

# Check
ramp_dat %>%
  freq(lifetime_binge_eating_baseline_numeric)


# Investigate NAs (A lot of people are not missing all binge data but answered the RAMP questionnaire after the 23rd June 2020 OR they have not answered the mhd questions or put 'PNTA' or 'Don't know')
ramp_dat %>%
  filter(is.na(lifetime_binge_eating_baseline_numeric) &
         ed_scid5.regular_episodes_eating_binges == "No" ) %>%
  select( mhd.bn_cop_numeric,
          mhd.bed_cop_numeric,
          edeq.regard_lost_control_eaten.1_.Wavebaseline_numeric,
          ed_scid5.regular_episodes_eating_binges,
          startDate_mhd
  )
```

# RAMP -  Lifetime low weight baseline
```{r Lifetime low weight baseline RAMP}
ramp_dat <- ramp_dat %>%
  mutate(lifetime_low_weight_baseline_numeric =
           case_when(
            startDate_mhd < as.Date("2020-05-23") & # Filled out the MHD before 23RD June 2020 and ... 
            mhd.an_cop_numeric == 1  # ...indicated diagnosis of anorexia
              ~ 1, # low weight likely to have occured before the pandemic
              
             mhd.an_cop_numeric == 0 & # No diagnosis of AN 
             ed_scid5.weigh_weighed_past_month == "No" ~ 0 # AND not had low weight in the past month 
             
           )
    
  )

# Check
ramp_dat %>%
  freq(lifetime_low_weight_baseline_numeric)
```

# EDGI 
## Import EDGI MHD data
NB: Have read in the raw data because I think the ED100K AN screener is mistakenly in the mhd dataframe.
```{r Read in data EDGI MHD}
edgi.mhd.raw <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/edgi/mhd_edgi.rds")
dim(edgi.mhd.raw)
colnames(edgi.mhd.raw)
```

Select columns EDGI mhd data
NB: I think the ED100K AN screener is mistakenly in the mhd dataframe.
```{r Select columns EDGI mhd data}
edgi.mhd.raw.id <- edgi.mhd.raw %>%
    drop_na(externalDataReference) %>% # Drop NAs
    remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
    add_column(sample = "EDGI", .before = "startDate") %>% #create new column 
    select(
      ID = externalDataReference, # ID
      sample, # Sample
      mhd.people_thought_weigh_weighed, # ED1OOK AN screener
      mhd.anorexia_nervosa,
      mhd.bulimia_nervosa,
      mhd.atypical_bulimia_nervosa,
      mhd.bingeeating_disorder,                      
      mhd.atypical_bingeeating_disorder,
      mhd.suspected_eating_disorder_diagnosed
    ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(edgi.mhd.raw.id)
  # Inspect colnames
  colnames(edgi.mhd.raw.id)
  #Differences
  dim(edgi.mhd.raw.id)[1]-dim(edgi.mhd.raw.id)[1]
 
```

## Import EDGI BE data
```{r Read in EDGI BE data}
be.edgi.raw <- readRDS(file = "/Users/helenadavies/King's College London/MT-TNG BioResource EDIT - ilovedata - ilovedata/data_raw/latest_freeze/edgi/be_edgi.rds")
dim(be.edgi.raw)
colnames(be.edgi.raw)
```

Select columns EDGI BE data
```{r Select columns EDGI BE data}
be.edgi.raw.id <- be.edgi.raw  %>%
    drop_na(externalDataReference) %>% # Drop NAs
    remove_duplicates("externalDataReference") %>% # Remove duplicates based on ID
    add_column(sample = "EDGI", .before = "be.short_period_ate_regard") %>% #create new column 
    select(
      ID = externalDataReference, # ID
      sample,
      be.short_period_ate_regard
    ) %>%
    add_numeric(., exclude = exclude_cols) %>%
    mutate_if(is.numeric, ~na_if(., -88)) %>% # Recode missing values to NAs in numeric variables
    mutate_if(is.numeric, ~na_if(., -99)) %>%
    mutate_if(is.numeric, ~na_if(., -77)) %>%
    mutate_if(is.factor, ~na_if(., "Seen but not answered")) %>% # Recode missing values to NAs in factor variables
    mutate_if(is.factor, ~na_if(., "Don't know")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to say")) %>%
    mutate_if(is.factor, ~na_if(., "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Seen but not answered")) %>% # Drop empty factor levels
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Don't know")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to answer")) %>%
    mutate_if(is.factor, ~forcats::fct_drop(., only = "Prefer not to say"))
  # Inspect dimensions
  dim(be.edgi.raw.id)
  # Inspect colnames
  colnames(be.edgi.raw.id)
  #Differences
  dim(be.edgi.raw)[1]-dim(be.edgi.raw.id)[1]
```

Merge EDGI BE and low weight data
```{r merge EDGI BE and low weight data}
edgi_dat <- dplyr::full_join(be.edgi.raw.id,
                          edgi.mhd.raw.id,
                          by = c("ID",
                                  "sample")
)


# Check
edgi_dat %>%
  colnames()
```

# EDGI sign-up - Lifetime binge eating at baseline
```{r Lifetime binge eating baseline EDGI}
edgi_dat <- edgi_dat %>%
  mutate(lifetime_binge_eating_baseline_numeric =
           case_when(
             be.short_period_ate_regard == "Yes" |
             mhd.bingeeating_disorder == "Binge-eating disorder" |
             mhd.bulimia_nervosa == "Bulimia nervosa" |
             mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" |
             mhd.atypical_bulimia_nervosa  == "Atypical bulimia nervosa"
             ~ 1, # Reported any BE in EDGI sign-up
              
             # Never binged and never suspected eating disorder
              be.short_period_ate_regard == "No" &
              mhd.suspected_eating_disorder_diagnosed == "No" ~ 0,
             
             # Never binged BUT has suspected ED [i.e., got asked which ED] BUT not a binge-type eating disorder
              be.short_period_ate_regard == "No" &
              mhd.bingeeating_disorder == "Not Binge-eating disorder" &
              mhd.bulimia_nervosa == "Not Bulimia nervosa" &
              mhd.atypical_bingeeating_disorder == "Not Atypical binge-eating disorder" &
              mhd.atypical_bulimia_nervosa  == "Not Atypical bulimia nervosa" ~ 0, 
                
             # Missing for all BE data in EDGI sign-up
               is.na(be.short_period_ate_regard) &
               is.na(mhd.suspected_eating_disorder_diagnosed) &
               is.na(mhd.bingeeating_disorder) & 
               is.na(mhd.bulimia_nervosa) & 
               is.na(mhd.atypical_bingeeating_disorder) & 
               is.na(mhd.atypical_bulimia_nervosa) ~ 2
               
           )
  )

# Check
edgi_dat %>%
  freq(lifetime_binge_eating_baseline_numeric)

# Investigate NAs (All people missing have not answered the BE question..)
edgi_dat %>%
  filter(is.na(lifetime_binge_eating_baseline_numeric)) %>%
  select(  be.short_period_ate_regard,
         mhd.suspected_eating_disorder_diagnosed,
         mhd.bingeeating_disorder, 
         mhd.bulimia_nervosa,
         mhd.atypical_bingeeating_disorder,
         mhd.atypical_bulimia_nervosa
           )
```

# EDGI sign-up -Lifetime low weight at baseline
```{r Lifetime low weight baseline EDGI}
edgi_dat <- edgi_dat %>%
  mutate(lifetime_low_weight_baseline_numeric =
           case_when( 
             mhd.people_thought_weigh_weighed == "Yes" |
             mhd.anorexia_nervosa == "Anorexia nervosa"  ~ 1, # reported any low weight in EDGI sign-up
             
             mhd.people_thought_weigh_weighed == "No" &
              mhd.anorexia_nervosa == "Not Anorexia nervosa" ~ 0,
             
             # Missing all mhd data in EDGI sign-up
             is.na(mhd.people_thought_weigh_weighed) & 
              is.na(mhd.anorexia_nervosa) ~ 2
           )
  )

# Check
edgi_dat %>%
  freq(lifetime_low_weight_baseline_numeric)


# Investigate NAs (All people missing have not answered the BE question..)
edgi_dat %>%
  filter(is.na(lifetime_low_weight_baseline_numeric)) %>%
  select(  mhd.people_thought_weigh_weighed,
         mhd.anorexia_nervosa
           )
```

# Select variables from each dataset to keep

## RAMP
```{r Select variables to keep RAMP}
ramp_dat <- ramp_dat %>%
  select(ID,
         sample,
         lifetime_low_weight_baseline_numeric, # Low weight at baseline
         lifetime_binge_eating_baseline_numeric # Binge eating at baseline
         
   )


ramp_dat %>%
  colnames()
```

## NBR
```{r Select variables to keep NBR}
nbr_dat <- dat.ed.COPING %>%
  filter(sample == "NBR") %>%
  select(ID,
         sample,
         lifetime_binge_eating_baseline_numeric, # Binge eating at baseline
         lifetime_low_weight_baseline_numeric, # Low weight at baseline
         final_any_pandemic_binge_eating,
         final_any_pandemic_low_weight
         )

nbr_dat %>%
  colnames()


nbr_dat %>%
  nrow()
```

## GLAD
```{r Select variables to keep GLAD}
glad_merged <- glad_merged %>%
  select(ID,
         sample,
         lifetime_binge_eating_baseline_numeric = lifetime_binge_eating_baseline_combined_numeric, # Binge eating at baseline
         lifetime_low_weight_baseline_numeric = lifetime_low_weight_baseline_combined_numeric, # Low weight at baseline,
         final_any_pandemic_binge_eating,
         final_any_pandemic_low_weight
         )

glad_merged %>%
  colnames()

glad_merged %>%
  nrow()
```

## EDGI
```{r Select variables to keep EDGI}
edgi_dat <- edgi_dat %>%
  select(ID,
         sample,
         lifetime_binge_eating_baseline_numeric, # Binge eating at baseline
         lifetime_low_weight_baseline_numeric # Low weight at baseline
        
         )

edgi_dat %>%
  colnames()

edgi_dat %>%
  nrow()
```

# MERGE ALL DATA
```{r Merge all data}
baseline_ED_groups <- ramp_dat %>%
  bind_rows(
      edgi_dat,
      glad_merged,
      nbr_dat)


# Check 
nrow(baseline_ED_groups)
colnames(baseline_ED_groups)
```

Save dataset
```{r Save final dataset ED baseline groupings}
saveRDS(object = baseline_ED_groups,
        file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/ED_BASELINE_groups", date, ".rds"))

```


```{r}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation =
           case_when(
             taf.felt_weeks_past_.Wavebaseline == "Yes" |
                     taf.felt_weeks_past_.Wave_1a == "Yes" |
                       taf.felt_weeks_past_.Wave_1b == "Yes" |
                       taf.felt_weeks_past_.Wave_2a == "Yes" |
                       taf.felt_weeks_past_.Wave_2b == "Yes" |
                       taf.felt_weeks_past_.Wave_3a == "Yes" |
                       taf.felt_weeks_past_.Wave_3b == "Yes" |
                       taf.felt_weeks_past_.Wave_4a == "Yes" |
                       taf.felt_weeks_past_.Wave_4b == "Yes" |
                       taf.felt_weeks_past_.Wave_5a == "Yes" |
                       taf.felt_weeks_past_.Wave_6b == "Yes" |
                       taf.felt_weeks_past_.Wave_7a == "Yes" |
                       taf.felt_weeks_past_.Wave_8b == "Yes" |
                       taf.felt_weeks_past_.Wave_9a == "Yes" |
                       taf.felt_weeks_past_.Wave_10b == "Yes" |
                       taf.felt_weeks_past_.Wave_11a == "Yes" |
                       taf.felt_weeks_past_.Wave_12b == "Yes" |
                       taf.felt_weeks_past_.Wave_13a == "Yes" |
                       taf.felt_weeks_past_.Wave_14b == "Yes" |
                       taf.felt_weeks_past_.Wave_15a == "Yes" |
                       taf.felt_weeks_past_.Wave_16b == "Yes"  ~ 1, # Said 'Yes' at least once during the pandemic
                        
        
             # Either never answered screener or DID answer screener but never answered about last two weeks
                 (
             (is.na(taf.worth_living_life_people_.Wavebaseline) |
                taf.worth_living_life_people_.Wavebaseline == "Yes" &
               is.na(taf.felt_weeks_past_.Wavebaseline)) &
               
               (is.na(taf.worth_living_life_people_.Wave_1a) |
                taf.worth_living_life_people_.Wave_1a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_1a)) &
               
                (is.na(taf.worth_living_life_people_.Wave_1b) |
                taf.worth_living_life_people_.Wave_1b== "Yes" &
               is.na(taf.felt_weeks_past_.Wave_1b)) &
               
               (is.na(taf.worth_living_life_people_.Wave_2a) |
                taf.worth_living_life_people_.Wave_2a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_2a)) &
                   
                (is.na(taf.worth_living_life_people_.Wave_2b) |
                taf.worth_living_life_people_.Wave_2b== "Yes" &
               is.na(taf.felt_weeks_past_.Wave_2b)) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3a) |
                taf.worth_living_life_people_.Wave_3a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_3a)) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3b) |
                taf.worth_living_life_people_.Wave_3b == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_3b)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4a) |
                taf.worth_living_life_people_.Wave_4a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_4a)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4b) |
                taf.worth_living_life_people_.Wave_4b == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_4b)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_5a) |
                taf.worth_living_life_people_.Wave_5a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_5a)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_6b) |
                taf.worth_living_life_people_.Wave_6b == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_6b)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_7a) |
                taf.worth_living_life_people_.Wave_7a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_7a)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_8b) |
                taf.worth_living_life_people_.Wave_8b == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_8b)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_9a) |
                taf.worth_living_life_people_.Wave_9a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_9a)) & 
               
                      (is.na(taf.worth_living_life_people_.Wave_10b) |
                taf.worth_living_life_people_.Wave_10b == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_10b)) & 
               
               (is.na(taf.worth_living_life_people_.Wave_11a) |
                taf.worth_living_life_people_.Wave_11a == "Yes" &
               is.na(taf.felt_weeks_past_.Wave_11a)) & 
               
                (is.na(taf.worth_living_life_people_.Wave_12b) |
                taf.worth_living_life_people_.Wave_12b== "Yes" &
               is.na(taf.felt_weeks_past_.Wave_12b)) & 
                 
                   (is.na(taf.worth_living_life_people_.Wave_13a) |
                taf.worth_living_life_people_.Wave_13a== "Yes" &
               is.na(taf.felt_weeks_past_.Wave_13a)) & 
                 
                  (is.na(taf.worth_living_life_people_.Wave_14b) |
                taf.worth_living_life_people_.Wave_14b== "Yes" &
               is.na(taf.felt_weeks_past_.Wave_14b)) & 
                 
                 (is.na(taf.worth_living_life_people_.Wave_15a) |
                taf.worth_living_life_people_.Wave_15a== "Yes" &
               is.na(taf.felt_weeks_past_.Wave_15a)) & 
                      
                  (is.na(taf.worth_living_life_people_.Wave_16b) |
                taf.worth_living_life_people_.Wave_16b== "Yes" &
               is.na(taf.felt_weeks_past_.Wave_16b))
               ) ~ NA_real_, 
                     
                      
             
              (taf.felt_weeks_past_.Wavebaseline == "No" | is.na(taf.felt_weeks_past_.Wavebaseline)) & 
                       (taf.felt_weeks_past_.Wave_1a == "No" | is.na(taf.felt_weeks_past_.Wave_1a)) & 
                       (taf.felt_weeks_past_.Wave_1b == "No" | is.na(taf.felt_weeks_past_.Wave_1b)) &
                       (taf.felt_weeks_past_.Wave_2a == "No" | is.na(taf.felt_weeks_past_.Wave_2a)) &
                       (taf.felt_weeks_past_.Wave_2b == "No" | is.na(taf.felt_weeks_past_.Wave_2b)) &
                       (taf.felt_weeks_past_.Wave_3a == "No" | is.na(taf.felt_weeks_past_.Wave_3a)) &
                       (taf.felt_weeks_past_.Wave_3b == "No" | is.na(taf.felt_weeks_past_.Wave_3b)) &
                       (taf.felt_weeks_past_.Wave_4a == "No" | is.na(taf.felt_weeks_past_.Wave_4a)) &
                       (taf.felt_weeks_past_.Wave_4b == "No" | is.na(taf.felt_weeks_past_.Wave_4b)) &
                       (taf.felt_weeks_past_.Wave_5a == "No" | is.na(taf.felt_weeks_past_.Wave_5a)) &
                       (taf.felt_weeks_past_.Wave_6b == "No" | is.na(taf.felt_weeks_past_.Wave_6b)) &
                       (taf.felt_weeks_past_.Wave_7a == "No" | is.na(taf.felt_weeks_past_.Wave_7a)) &
                       (taf.felt_weeks_past_.Wave_8b == "No" | is.na(taf.felt_weeks_past_.Wave_8b)) &
                       (taf.felt_weeks_past_.Wave_9a == "No" | is.na(taf.felt_weeks_past_.Wave_9a)) &
                       (taf.felt_weeks_past_.Wave_10b == "No" | is.na(taf.felt_weeks_past_.Wave_10b)) &
                       (taf.felt_weeks_past_.Wave_11a == "No" | is.na(taf.felt_weeks_past_.Wave_11a)) &
                       (taf.felt_weeks_past_.Wave_12b == "No" | is.na(taf.felt_weeks_past_.Wave_12b)) &
                       (taf.felt_weeks_past_.Wave_13a == "No" | is.na(taf.felt_weeks_past_.Wave_13a)) &
                     (taf.felt_weeks_past_.Wave_14b == "No" | is.na(taf.felt_weeks_past_.Wave_14b)) &
                     (taf.felt_weeks_past_.Wave_15a == "No" | is.na(taf.felt_weeks_past_.Wave_15a)) &
                     (taf.felt_weeks_past_.Wave_16b == "No" | is.na(taf.felt_weeks_past_.Wave_16b))
                  ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases). Answer options include PTNA.
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)



```

### Baseline passive suicidal ideation
At baseline, participants are also asked whether they have experienced passive suicidal ideation in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.
taf.felt_weeks_past_.Wavebaseline = Many people have thoughts that life is not worth living. Have you felt that way in the past two weeks?
```{r Passive suicidal ideation baseline experience past two weeks}
dat <- dat %>%
  mutate(baseline_passive_suicidal_ideation =
           case_when(
                    taf.felt_weeks_past_.Wavebaseline == "No" ~ 0, # Not experienced in past two weeks
                    taf.felt_weeks_past_.Wavebaseline == "Yes" ~ 1 # Experienced in past two weeks
               )
  )

# Check 
dat %>%
  freq(baseline_passive_suicidal_ideation)
```

Combined - passive suicidal ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)
```{r Combine pandemic and baseline experience into pandemic experience}
dat <- dat %>%
  mutate(passive_suicidal_ideation_PANDEMIC =
           case_when(
             
             (TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1 | # Experience DURING pandemic (answered yes to 2 week question during pandemic) OR
                EVER_PANDEMIC_passive_suicidal_ideation == 1 ) ~ 1, # Experience DURING pandemic (answered yes to EVER question during pandemic)
           
             EVER_PANDEMIC_passive_suicidal_ideation == 0 & # (Technically, including the two weeks variable is redundant because you only get shown this question if you endorse the 'ever' variable)
               TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 0 ~ 0 
           )
  )

# Check
dat %>%
  freq(passive_suicidal_ideation_PANDEMIC)
```



# Outcome = Self-harm ideation
## Derive ANY self-harm ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Have you contemplated harming yourself?" [If "Yes"] then asked "Have you felt that way in the past two weeks?" (taf.felt_weeks_past.1_.Wave_1a etc)
```{r Self-harm ideation ANY past two weeks pandemic}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_selfharm_ideation =
           case_when(
             taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_13a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_14b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_15a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_16b == "Yes"
                     # | taf.felt_weeks_past.1_.Wave_17a == "Yes"
             ~ 1, # Said "Yes" at any point to the two week question
                        
              
                       is.na(taf.felt_weeks_past.1_.Wave_1a) &
                       is.na(taf.felt_weeks_past.1_.Wave_1b) &
                       is.na(taf.felt_weeks_past.1_.Wave_2a) &
                       is.na(taf.felt_weeks_past.1_.Wave_2b) &
                       is.na(taf.felt_weeks_past.1_.Wave_3a) &
                       is.na(taf.felt_weeks_past.1_.Wave_3b) &
                       is.na(taf.felt_weeks_past.1_.Wave_4a) &
                       is.na(taf.felt_weeks_past.1_.Wave_4b) &
                       is.na(taf.felt_weeks_past.1_.Wave_5a) &
                       is.na(taf.felt_weeks_past.1_.Wave_6b) &
                       is.na(taf.felt_weeks_past.1_.Wave_7a) &
                       is.na(taf.felt_weeks_past.1_.Wave_8b) &
                       is.na(taf.felt_weeks_past.1_.Wave_9a) &
                       is.na(taf.felt_weeks_past.1_.Wave_10b) &
                       is.na(taf.felt_weeks_past.1_.Wave_11a) &
                       is.na(taf.felt_weeks_past.1_.Wave_12b) &
                       is.na(taf.felt_weeks_past.1_.Wave_13a) &
                       is.na(taf.felt_weeks_past.1_.Wave_14b) &
                       is.na(taf.felt_weeks_past.1_.Wave_15a) &
                       is.na(taf.felt_weeks_past.1_.Wave_16b) 
                    # &  is.na(taf.felt_weeks_past.1_.Wave_17a) 
             ~ NA_real_, # NA for all waves (i.e., never answered the two week question during the pandemic)
                     
                      
                       (taf.felt_weeks_past.1_.Wave_1a == "No" | is.na(taf.felt_weeks_past.1_.Wave_1a)) &
                       (taf.felt_weeks_past.1_.Wave_1b == "No" | is.na(taf.felt_weeks_past.1_.Wave_1b)) &
                       (taf.felt_weeks_past.1_.Wave_2a == "No" | is.na(taf.felt_weeks_past.1_.Wave_2a)) &
                       (taf.felt_weeks_past.1_.Wave_2b == "No" | is.na(taf.felt_weeks_past.1_.Wave_2b)) &
                       (taf.felt_weeks_past.1_.Wave_3a == "No" | is.na(taf.felt_weeks_past.1_.Wave_3a)) &
                       (taf.felt_weeks_past.1_.Wave_3b == "No" | is.na(taf.felt_weeks_past.1_.Wave_3b)) &
                       (taf.felt_weeks_past.1_.Wave_4a == "No" | is.na(taf.felt_weeks_past.1_.Wave_4a)) &
                       (taf.felt_weeks_past.1_.Wave_4b == "No" | is.na(taf.felt_weeks_past.1_.Wave_4b)) &
                       (taf.felt_weeks_past.1_.Wave_5a == "No" | is.na(taf.felt_weeks_past.1_.Wave_5a)) &
                       (taf.felt_weeks_past.1_.Wave_6b == "No" | is.na(taf.felt_weeks_past.1_.Wave_6b)) &
                       (taf.felt_weeks_past.1_.Wave_7a == "No" | is.na(taf.felt_weeks_past.1_.Wave_7a)) &
                       (taf.felt_weeks_past.1_.Wave_8b == "No" | is.na(taf.felt_weeks_past.1_.Wave_8b)) &
                       (taf.felt_weeks_past.1_.Wave_9a == "No" | is.na(taf.felt_weeks_past.1_.Wave_9a)) &
                       (taf.felt_weeks_past.1_.Wave_10b == "No" | is.na(taf.felt_weeks_past.1_.Wave_10b)) &
                       (taf.felt_weeks_past.1_.Wave_11a == "No" | is.na(taf.felt_weeks_past.1_.Wave_11a)) &
                       (taf.felt_weeks_past.1_.Wave_12b == "No" | is.na(taf.felt_weeks_past.1_.Wave_12b)) &
               (taf.felt_weeks_past.1_.Wave_13a == "No" | is.na(taf.felt_weeks_past.1_.Wave_13a)) &
               (taf.felt_weeks_past.1_.Wave_14b == "No" | is.na(taf.felt_weeks_past.1_.Wave_14b)) &
               (taf.felt_weeks_past.1_.Wave_15a == "No" | is.na(taf.felt_weeks_past.1_.Wave_15a)) &
               (taf.felt_weeks_past.1_.Wave_16b == "No" | is.na(taf.felt_weeks_past.1_.Wave_16b))
            # & (taf.felt_weeks_past.1_.Wave_17a == "No" | is.na(taf.felt_weeks_past.1_.Wave_17a))
             ~ 0 # Said "No" at least once and did not say "Yes" once
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)
```

### Experience ever
In the follow ups, participants are also asked lifetime self-harm ideation: "Have you contemplated harming yourself?". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Self-harm ideation EVER pandemic}
#Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_selfharm_ideation =
           case_when(
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                         taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" |
                      # taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, once" |
                       
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once" 
                      # | taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, more than once" 
                      ~ 1, # "Yes" at at least one phase
                       
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) &
                        is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) 
                     # &  is.na(taf.have_you_contemplated_harming_yourself_.Wave_17a)
                        ~ NA_real_, # Missing at every phase
                     
                      
                       (taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a)) & (taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_12b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b)) &
                         (taf.have_you_contemplated_harming_yourself_.Wave_13a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_14b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_15a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_16b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b)) 
                    # & (taf.have_you_contemplated_harming_yourself_.Wave_17b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_17b)) 
                    ~ 0 # "No" at least once and never said "Yes"
                    
           ))

#Check
dat %>%
  freq(EVER_PANDEMIC_selfharm_ideation)
```

### Baseline self-harm ideation
At baseline, participants are also asked whether they have experienced self-harm ideation in the past two weeks. This would count as experiencing it during the pandemic as all studies started during the pandemic.

taf.felt_weeks_past.1_.Wavebaseline = Have you contemplated harming yourself...in the past two weeks?
```{r Self-harm ideation baseline experience past two weeks}
dat <- dat %>%
  mutate(baseline_selfharm_ideation =
           case_when(
                    taf.felt_weeks_past.1_.Wavebaseline == "No" ~ 0, # Not experienced in the past two weeks
                    taf.felt_weeks_past.1_.Wavebaseline == "Yes" ~ 1 # Experienced in the past two weeks
             )
  )

# Check 
dat %>%
  freq(baseline_selfharm_ideation)
```

### PREPANDEMIC self-harm ideation 
At baseline, participants are first asked: "Have you contemplated harming yourself ?" (taf.have_you_contemplated_harming_yourself_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt.1_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.

```{r Self-harm ideation prepandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_ideation =
           case_when(
                     taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" ~ 0, # Never experienced it in their life
                     
                     taf.pandemic_felt.1_.Wavebaseline == "No" ~ 0, # Have experienced it in their life but not before the pandemic
                     taf.pandemic_felt.1_.Wavebaseline == "Yes" ~ 1 # Have experienced it before in their life and during the pandemic
                     )
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_selfharm_ideation)
```

Combined - self-harm ideation: BASELINE experience OR FOLLOW UP experience (participants may have indicated experiencing it at baseline and/or at follow-up)
```{r Combined baseline self-harm ideation experience and/or follow up experience pandemic}
dat <- dat %>%
  mutate(selfharm_ideation_PANDEMIC =
           case_when(
         
             (TWO_WEEKS_PANDEMIC_selfharm_ideation == 1 | # Experience DURING pandemic (answered yes to 2 week question during pandemic)
                EVER_PANDEMIC_selfharm_ideation == 1 ) ~ 1, # Experience DURING pandemic (answered yes to EVER question during pandemic)
           
              baseline_selfharm_ideation == 1 ~ 1, # Experience DURING pandemic (indicated at baseline)
             
             baseline_selfharm_ideation == 0 |
             EVER_PANDEMIC_selfharm_ideation == 0 ~ 0 # Baseline never experienced, and/or NO to EVER experiencing at ANY phase (people who have endorsed it EVER during the pandemic will be captured above, so this can be an OR rather than an AND, i.e., we will allow it if some people are NA for one)
          )
    
  )

#Check
dat %>%
  freq(selfharm_ideation_PANDEMIC)
```



Passive suicidal ideation
```{r Identify phase at which outcome first experienced - passive suicidal ideation}
dat <- dat %>%
  mutate(outcome_phase_passive_suicidal_ideation =
           case_when( 
                      
                      (
                         # Either hasn't answered or is PNTA for baseline
                      ((is.na(taf.felt_weeks_past_.Wavebaseline) |
                        taf.felt_weeks_past_.Wavebaseline == "Prefer not to answer") &
                      
                         (is.na(taf.worth_living_life_people_.Wavebaseline) |
                      taf.worth_living_life_people_.Wavebaseline == "Prefer not to answer")) &
                        
                        # Either hasn't answered or is PNTA for 1a
                        ((is.na(taf.felt_weeks_past_.Wave_1a) |
                         taf.felt_weeks_past_.Wave_1a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_1a) |
                        taf.worth_living_life_people_.Wave_1a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 1b
                      ((is.na(taf.felt_weeks_past_.Wave_1b) |
                         taf.felt_weeks_past_.Wave_1b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_1b) |
                        taf.worth_living_life_people_.Wave_1b == "Prefer not to answer")) &
                        
                      # Either hasn't answered or is PNTA for 2a
                      ((is.na(taf.felt_weeks_past_.Wave_2a) |
                         taf.felt_weeks_past_.Wave_2a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_2a) |
                        taf.worth_living_life_people_.Wave_2a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 2b
                      ((is.na(taf.felt_weeks_past_.Wave_2b) |
                         taf.felt_weeks_past_.Wave_2b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_2b) |
                        taf.worth_living_life_people_.Wave_2b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 3a
                      ((is.na(taf.felt_weeks_past_.Wave_3a) |
                         taf.felt_weeks_past_.Wave_3a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_3a) |
                        taf.worth_living_life_people_.Wave_3a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 3b
                      ((is.na(taf.felt_weeks_past_.Wave_3b) |
                         taf.felt_weeks_past_.Wave_3b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_3b) |
                        taf.worth_living_life_people_.Wave_3b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 4a
                      ((is.na(taf.felt_weeks_past_.Wave_4a) |
                         taf.felt_weeks_past_.Wave_4a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_4a) |
                        taf.worth_living_life_people_.Wave_4a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 4b
                      ((is.na(taf.felt_weeks_past_.Wave_4b) |
                         taf.felt_weeks_past_.Wave_4b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_4b) |
                        taf.worth_living_life_people_.Wave_4b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 5a
                      ((is.na(taf.felt_weeks_past_.Wave_5a) |
                         taf.felt_weeks_past_.Wave_5a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_5a) |
                        taf.worth_living_life_people_.Wave_5a == "Prefer not to answer")) &
                    
                     # Either hasn't answered or is PNTA for 6b
                      ((is.na(taf.felt_weeks_past_.Wave_6b) |
                         taf.felt_weeks_past_.Wave_6b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_6b) |
                        taf.worth_living_life_people_.Wave_6b == "Prefer not to answer")) &
                     
                     # Either hasn't answered or is PNTA for 7a
                      ((is.na(taf.felt_weeks_past_.Wave_7a) |
                         taf.felt_weeks_past_.Wave_7a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_7a) |
                        taf.worth_living_life_people_.Wave_7a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 8b
                      ((is.na(taf.felt_weeks_past_.Wave_8b) |
                         taf.felt_weeks_past_.Wave_8b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_8b) |
                        taf.worth_living_life_people_.Wave_8b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 9a
                      ((is.na(taf.felt_weeks_past_.Wave_9a) |
                         taf.felt_weeks_past_.Wave_9a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_9a) |
                        taf.worth_living_life_people_.Wave_9a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 10b
                      ((is.na(taf.felt_weeks_past_.Wave_10b) |
                         taf.felt_weeks_past_.Wave_10b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_10b) |
                        taf.worth_living_life_people_.Wave_10b == "Prefer not to answer")) &
                         
                    # Either hasn't answered or is PNTA for 11a
                      ((is.na(taf.felt_weeks_past_.Wave_11a) |
                         taf.felt_weeks_past_.Wave_11a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_11a) |
                        taf.worth_living_life_people_.Wave_11a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 12b
                      ((is.na(taf.felt_weeks_past_.Wave_12b) |
                         taf.felt_weeks_past_.Wave_12b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_12b) |
                        taf.worth_living_life_people_.Wave_12b == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 13a
                      ((is.na(taf.felt_weeks_past_.Wave_13a) |
                         taf.felt_weeks_past_.Wave_13a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_13a) |
                        taf.worth_living_life_people_.Wave_13a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 14b
                      ((is.na(taf.felt_weeks_past_.Wave_14b) |
                         taf.felt_weeks_past_.Wave_14b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_14b) |
                        taf.worth_living_life_people_.Wave_14b == "Prefer not to answer")) &
                      
                       # Either hasn't answered or is PNTA for 15a
                      ((is.na(taf.felt_weeks_past_.Wave_15a) |
                         taf.felt_weeks_past_.Wave_15a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_15a) |
                        taf.worth_living_life_people_.Wave_15a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 16b
                      ((is.na(taf.felt_weeks_past_.Wave_16b) |
                         taf.felt_weeks_past_.Wave_16b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_16b) |
                        taf.worth_living_life_people_.Wave_16b == "Prefer not to answer")) 
                    
                    ) ~ "Not answered or PNTA",
                   
                    
                    
                    
                    
                    
                          
                     taf.felt_weeks_past_.Wavebaseline == "Yes" |
                      taf.worth_living_life_people_.Wavebaseline == "Yes, once" | 
                      taf.worth_living_life_people_.Wavebaseline == "Yes, more than once" ~ "Baseline",
                    
                    taf.felt_weeks_past_.Wave_1a == "Yes" |
                      taf.worth_living_life_people_.Wave_1a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_1a == "Yes, more than once" ~ "1a",
                       
                      taf.felt_weeks_past_.Wave_1b == "Yes" |
                      taf.worth_living_life_people_.Wave_1b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_1b == "Yes, more than once" ~ "1b", 
                     
                     taf.felt_weeks_past_.Wave_2b == "Yes" |
                      taf.worth_living_life_people_.Wave_2b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_2b == "Yes, more than once" ~ "2b",
                      
                     taf.felt_weeks_past_.Wave_3a == "Yes" |
                      taf.worth_living_life_people_.Wave_3a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_3a == "Yes, more than once" ~ "3a",
                     
                     taf.felt_weeks_past_.Wave_3b == "Yes" |
                      taf.worth_living_life_people_.Wave_3b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_3b == "Yes, more than once" ~ "3b",
                     
                     taf.felt_weeks_past_.Wave_4a == "Yes" |
                      taf.worth_living_life_people_.Wave_4a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_4a == "Yes, more than once" ~ "4a",
                     
                     taf.felt_weeks_past_.Wave_4b == "Yes" |
                      taf.worth_living_life_people_.Wave_4b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_4b == "Yes, more than once" ~ "4b",
                     
                     taf.felt_weeks_past_.Wave_5a == "Yes" |
                      taf.worth_living_life_people_.Wave_5a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_5a == "Yes, more than once" ~ "5a",
                     
                     taf.felt_weeks_past_.Wave_6b == "Yes" |
                      taf.worth_living_life_people_.Wave_6b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_6b == "Yes, more than once" ~ "6b",
                     
                     taf.felt_weeks_past_.Wave_7a == "Yes" |
                      taf.worth_living_life_people_.Wave_7a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_7a == "Yes, more than once" ~ "7a",
                     
                     taf.felt_weeks_past_.Wave_8b == "Yes" |
                      taf.worth_living_life_people_.Wave_8b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_8b == "Yes, more than once" ~ "8b",
                     
                     taf.felt_weeks_past_.Wave_9a == "Yes" |
                      taf.worth_living_life_people_.Wave_9a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_9a == "Yes, more than once" ~ "9a",
                     
                     taf.felt_weeks_past_.Wave_10b == "Yes" |
                      taf.worth_living_life_people_.Wave_10b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_10b == "Yes, more than once" ~ "10b",
                   
                     taf.felt_weeks_past_.Wave_11a == "Yes" |
                      taf.worth_living_life_people_.Wave_11a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_11a == "Yes, more than once" ~ "11a",
                     
                     taf.felt_weeks_past_.Wave_12b == "Yes" |
                      taf.worth_living_life_people_.Wave_12b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_12b == "Yes, more than once" ~ "12b",
                    
                    taf.felt_weeks_past_.Wave_13a == "Yes" |
                      taf.worth_living_life_people_.Wave_13a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_13a == "Yes, more than once" ~ "13a",
                    
                     taf.felt_weeks_past_.Wave_14b == "Yes" |
                      taf.worth_living_life_people_.Wave_14b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_14b == "Yes, more than once" ~ "14b",
                    
                    taf.felt_weeks_past_.Wave_15a == "Yes" |
                      taf.worth_living_life_people_.Wave_15a == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_15a == "Yes, more than once" ~ "15a",
                    
                    taf.felt_weeks_past_.Wave_16b == "Yes" |
                      taf.worth_living_life_people_.Wave_16b == "Yes, once" | 
                      taf.worth_living_life_people_.Wave_16b == "Yes, more than once" ~ "16b",
                    
                  #  taf.felt_weeks_past_.Wave_17a == "Yes" |
                  #    taf.worth_living_life_people_.Wave_17a == "Yes, once" | 
                  #    taf.worth_living_life_people_.Wave_17a == "Yes, more than once" ~ "17a",
                    
                    
                    TRUE ~ "Not experienced"
                    
                    )
         )
  

# Check
dat %>%
  freq(outcome_phase_passive_suicidal_ideation)
```

Self-harm ideation
```{r Identify phase at which outcome first experienced - self-harm ideation}

dat <- dat %>%
  mutate(outcome_phase_selfharm_ideation =
           case_when( 
                      (
                        # Either hasn't answered or is PNTA for baseline
                      ((is.na(taf.felt_weeks_past.1_.Wavebaseline) |
                        taf.felt_weeks_past.1_.Wavebaseline == "Prefer not to answer") &
                      
                         (is.na(taf.have_you_contemplated_harming_yourself_.Wavebaseline) |
                      taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Prefer not to answer")) &
                        
                       # Either hasn't answered or is PNTA for 1a
                      
                        ((is.na(taf.felt_weeks_past.1_.Wave_1a) |
                         taf.felt_weeks_past.1_.Wave_1a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_1a == "Prefer not to answer")) &
                          
                        # Either hasn't answered or is PNTA for 1b
                        ((is.na(taf.felt_weeks_past.1_.Wave_1b) |
                         taf.felt_weeks_past.1_.Wave_1b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_1b == "Prefer not to answer")) &
                           
                          # Either hasn't answered or is PNTA for 2a
                        ((is.na(taf.felt_weeks_past.1_.Wave_2a) |
                         taf.felt_weeks_past.1_.Wave_2a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_2a == "Prefer not to answer")) &
                        
                           # Either hasn't answered or is PNTA for 2b
                        ((is.na(taf.felt_weeks_past.1_.Wave_2b) |
                         taf.felt_weeks_past.1_.Wave_2b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_2b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 3a
                        ((is.na(taf.felt_weeks_past.1_.Wave_3a) |
                         taf.felt_weeks_past.1_.Wave_3a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_3a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 3b
                        ((is.na(taf.felt_weeks_past.1_.Wave_3b) |
                         taf.felt_weeks_past.1_.Wave_3b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_3b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 4a
                        ((is.na(taf.felt_weeks_past.1_.Wave_4a) |
                         taf.felt_weeks_past.1_.Wave_4a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_4a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 4b
                        ((is.na(taf.felt_weeks_past.1_.Wave_4b) |
                         taf.felt_weeks_past.1_.Wave_4b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_4b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 5a
                        ((is.na(taf.felt_weeks_past.1_.Wave_5a) |
                         taf.felt_weeks_past.1_.Wave_5a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_5a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 6b
                        ((is.na(taf.felt_weeks_past.1_.Wave_6b) |
                         taf.felt_weeks_past.1_.Wave_6b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_6b == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 7a
                        ((is.na(taf.felt_weeks_past.1_.Wave_7a) |
                         taf.felt_weeks_past.1_.Wave_7a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_7a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 8b
                        ((is.na(taf.felt_weeks_past.1_.Wave_8b) |
                         taf.felt_weeks_past.1_.Wave_8b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_8b == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 9a
                        ((is.na(taf.felt_weeks_past.1_.Wave_9a) |
                         taf.felt_weeks_past.1_.Wave_9a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_9a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 10b
                        ((is.na(taf.felt_weeks_past.1_.Wave_10b) |
                         taf.felt_weeks_past.1_.Wave_10b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_10b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 11a
                        ((is.na(taf.felt_weeks_past.1_.Wave_11a) |
                         taf.felt_weeks_past.1_.Wave_11a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_11a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 12b
                        ((is.na(taf.felt_weeks_past.1_.Wave_12b) |
                         taf.felt_weeks_past.1_.Wave_12b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_12b == "Prefer not to answer")) &
                      
                        # Either hasn't answered or is PNTA for 13a
                        ((is.na(taf.felt_weeks_past.1_.Wave_13a) |
                         taf.felt_weeks_past.1_.Wave_13a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_13a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 14b
                        ((is.na(taf.felt_weeks_past.1_.Wave_14b) |
                         taf.felt_weeks_past.1_.Wave_14b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_14b == "Prefer not to answer")) &
                        
                        # Either hasn't answered or is PNTA for 15a
                        ((is.na(taf.felt_weeks_past.1_.Wave_15a) |
                         taf.felt_weeks_past.1_.Wave_15a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_15a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 16b
                        ((is.na(taf.felt_weeks_past.1_.Wave_16b) |
                         taf.felt_weeks_past.1_.Wave_16b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_16b == "Prefer not to answer")) 
                          
                      ) ~ "Not answered or PNTA",
                        
                      #  # Either hasn't answered or is PNTA for 17a
                      #  ((is.na(taf.felt_weeks_past.1_.Wave_17a) |
                      #   taf.felt_weeks_past.1_.Wave_17a == "Prefer not to answer") & 
                      #   
                      #  (is.na(taf.have_you_contemplated_harming_yourself_.Wave_17a) |
                      #  taf.have_you_contemplated_harming_yourself_.Wave_17a == "Prefer not to answer")) 
                       
                     
                      taf.felt_weeks_past.1_.Wavebaseline == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once" ~ "Baseline", 

                      taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" ~ "1a", 

                     taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" ~ "1b",
                     
                     taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" ~ "2a",
                     
                     taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" ~ "2b",
                     
                     taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" ~ "3a",
                     
                     taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" ~ "3b",
                     
                     taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" ~ "4a",
                     
                     taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" ~ "4b",
                     
                     taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" ~ "5a",
                     
                     taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" ~ "6b",
                     
                     taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" ~ "7a",
                     
                     taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" ~ "8b",
                     
                     taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" ~ "9a",
                     
                     taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" ~ "10b",
                     
                     taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" ~ "11a",
                     
                     taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" ~ "12b",
                     
                     taf.felt_weeks_past.1_.Wave_13a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once" ~ "13a",
                     
                     taf.felt_weeks_past.1_.Wave_14b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once" ~ "14b",
                     
                     taf.felt_weeks_past.1_.Wave_15a == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once" ~ "15a",
                     
                      taf.felt_weeks_past.1_.Wave_16b == "Yes" |
                      taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" |
                      taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once" ~ "16b",
                     
                   #  taf.felt_weeks_past.1_.Wave_17a == "Yes" |
                   #   taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, once" |
                   #   taf.have_you_contemplated_harming_yourself_.Wave_17a == "Yes, more than once" ~ "17a",
                     
                     
                     TRUE ~ "Not experienced"
           )
  )

# Check
dat %>%
  freq(outcome_phase_selfharm_ideation)
```

```{r Combine pandemic and baseline experience into pandemic experience}
dat <- dat %>%
  mutate(passive_suicidal_ideation_PANDEMIC =
           case_when(
             
             TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1 ~ 1,  # Experience DURING pandemic (answered yes to 2 week question during pandemic) 
             
              EVER_PANDEMIC_passive_suicidal_ideation == 1 & # LIFEETIME experience but NOT pre-pandemic, therefore must be a pandemic experience*
              PREPANDEMIC_passive_suicidal_ideation == 0 ~ 1,
             
             EVER_PANDEMIC_passive_suicidal_ideation == 1 & # LIFETIME experience...
             PREPANDEMIC_passive_suicidal_ideation == 1 & #...not before the pandemic...
             TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1  ~ 1, #...but in the past two weeks (captured in first line of code but written out for ease of understanding)
               
              EVER_PANDEMIC_passive_suicidal_ideation == 0 & # (Technically, including the two weeks variable is redundant because you only get shown this question if you endorse the 'ever' variable)
               TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 0 ~ 0 
           )
  )

# Check
dat %>%
  freq(passive_suicidal_ideation_PANDEMIC)
```

```{r Combine pandemic and baseline experience into pandemic experience}
dat <- dat %>%
  mutate(selfharm_ideation_PANDEMIC =
           case_when(
             
             TWO_WEEKS_PANDEMIC_selfharm_ideation == 1 ~ 1,  # Experience DURING pandemic (answered yes to 2 week question during pandemic) 
             
              EVER_PANDEMIC_selfharm_ideation == 1 & # LIFEETIME experience but NOT pre-pandemic, therefore must be a pandemic experience*
              PREPANDEMIC_selfharm_ideation == 0 ~ 1,
             
             EVER_PANDEMIC_selfharm_ideation == 1 & # LIFETIME experience...
             PREPANDEMIC_selfharm_ideation == 1 & #...not before the pandemic...
             TWO_WEEKS_PANDEMIC_selfharm_ideation == 1  ~ 1, #...but in the past two weeks (captured in first line of code but written out for ease of understanding)
               
              EVER_PANDEMIC_selfharm_ideation == 0 & # (Technically, including the two weeks variable is redundant because you only get shown this question if you endorse the 'ever' variable)
               TWO_WEEKS_PANDEMIC_selfharm_ideation == 0 ~ 0 
           )
  )

# Check
dat %>%
  freq(selfharm_ideation_PANDEMIC) 
```

```{r}
# Current or past - binge-eating disorder
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_BED_in_past =
           case_when(
             
         mhd.bingeeating_disorder == "Binge-eating disorder" &
         mhd.bingeeating_disorder.1_current_past == "Past" &
         mhd_EndDate < as.Date("2020-06-23") ~ "Pre-pandemic binge eating", # Filled out the MHD COPING baseline BEFORE 23RD June 2020
         
         mhd.bingeeating_disorder == "Binge-eating disorder" &
         mhd.bingeeating_disorder.1_current_past == "Current" &
         mhd_EndDate < as.Date("2020-05-23") ~ "Pre-pandemic binge eating",# These are people who have got a DIAGNOSIS. Considering diagnostic delays, it is likely that anyone with a diagnosis had symptom start BEFORE the pandemic. Have put as 2 months to allow for those with a fast diagnosis.
           
          mhd.bingeeating_disorder == "Binge-eating disorder" ~ "Not sure"
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_BED_in_past)
```

```{r}
# Current or past - atypical binge-eating disorder
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_atypical_BED_in_past =
           case_when(
             
         mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" &
         mhd.atypical_bingeeating_disorder.1_current_past == "Past" &
         mhd_EndDate < as.Date("2020-06-23") ~ "Pre-pandemic binge eating", # Filled out the MHD COPING baseline BEFORE 23RD June 2020
          
         mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" &
         mhd.atypical_bingeeating_disorder.1_current_past == "Current" &
         mhd_EndDate < as.Date("2020-05-23") ~ "Pre-pandemic binge eating", # These are people who have got a DIAGNOSIS. Considering diagnostic delays, it is likely that anyone with a diagnosis had symptom start BEFORE the pandemic. Have put as 2 months to allow for those with a fast diagnosis.
           
         mhd.atypical_bingeeating_disorder == "Atypical binge-eating disorder" ~ "Not sure"
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_atypical_BED_in_past)


```

```{r}
# Current or past - bulimia
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_BN_in_past =
           case_when(
             
         mhd.bulimia_nervosa == "Bulimia nervosa" &
         mhd.bulimia_nervosa.1_current_past == "Past" &
         mhd_EndDate < as.Date("2020-06-23") ~ "Pre-pandemic binge eating", # Filled out the MHD COPING baseline BEFORE 23RD June 2020
          
        mhd.bulimia_nervosa == "Bulimia nervosa" &
        mhd.bulimia_nervosa.1_current_past == "Current" &
         mhd_EndDate < as.Date("2020-05-23") ~ "Pre-pandemic binge eating", # These are people who have got a DIAGNOSIS. Considering diagnostic delays, it is likely that anyone with a diagnosis had symptom start BEFORE the pandemic. Have put as 2 months to allow for those with a fast diagnosis.
           
        mhd.bulimia_nervosa == "Bulimia nervosa" ~ "Not sure"
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_BN_in_past)



```

```{r}
# Current or past - atypical bulimia
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_atypical_BN_in_past =
           case_when(

         mhd.atypical_bulimia_nervosa == "Atypical bulimia nervosa" &
         mhd.atypical_bulimia_nervosa.1_current_past == "Past" &
         mhd_EndDate < as.Date("2020-06-23") ~ "Pre-pandemic binge eating", # Filled out the MHD COPING baseline BEFORE 23RD June 2020
          
       mhd.atypical_bulimia_nervosa == "Atypical bulimia nervosa"&
       mhd.atypical_bulimia_nervosa.1_current_past == "Current" &
         mhd_EndDate < as.Date("2020-05-23") ~ "Pre-pandemic binge eating", # These are people who have got a DIAGNOSIS. Considering diagnostic delays, it is likely that anyone with a diagnosis had symptom start BEFORE the pandemic. Have put as 2 months to allow for those with a fast diagnosis.
           
     mhd.atypical_bulimia_nervosa == "Atypical bulimia nervosa" ~ "Not sure"
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_atypical_BN_in_past)
```

```{r}
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_BE_in_past =
           case_when(

        be.ate_regard_eating_binges == "Yes" & # Had lifetime binge eating 
         be.current == "No" & # Not currently 
         mhd_EndDate < as.Date("2020-05-07") ~ "Pre-pandemic binge eating", # Filled out the MHD COPING baseline BEFORE 7th May 2020 (given 6 weeks leeway)
           
          be.ate_regard_eating_binges == "Yes"  ~ "Not sure"
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_BE_in_past)


```

```{r}
# Current or past - anorexia
dat.ed.COPING <- dat.ed.COPING %>%
  mutate(pandemic_AN_in_past =
           case_when(

          mhd.anorexia_nervosa == "Anorexia nervosa" &
         mhd.anorexia_nervosa_current_past == "Past" &
         mhd_EndDate < as.Date("2020-06-23") ~ "Pre-pandemic low weight", # Filled out the MHD COPING baseline BEFORE 23RD June 2020
          
        mhd.anorexia_nervosa == "Anorexia nervosa" &
       mhd.anorexia_nervosa_current_past == "Current" &
         mhd_EndDate < as.Date("2020-05-23") ~ "Pre-pandemic low weight", # These are people who have got a DIAGNOSIS. Considering diagnostic delays, it is likely that anyone with a diagnosis had symptom start BEFORE the pandemic. Have put as 2 months to allow for those with a fast diagnosis.
           
      mhd.anorexia_nervosa == "Anorexia nervosa" ~ "Not sure"
             ) 
         )

# Check 
dat.ed.COPING %>%
  freq(pandemic_AN_in_past)


```

Passive suicidal ideation
```{r Positve COVID test result exposure BEFORE outcome PSS - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_PSS_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of PSS
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (outcome_phase_passive_suicidal_ideation == "Baseline" | # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1a" | 
                         outcome_phase_passive_suicidal_ideation == "1b" |
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_PSS_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                     outcome_phase_passive_suicidal_ideation == "Baseline" ~ "To drop",
                      
                     # These people will have experienced a positive COVID test before their first experience of PSS
                        exposure_phase_positive_covid_test == "1a" & 
                       (outcome_phase_passive_suicidal_ideation == "1a" |  # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1b" | 
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_PSS_1b =
           case_when(exposure_phase_positive_covid_test == "1b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_passive_suicidal_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_PSS_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2a" |  # Co-occurring symptom & exposure
                         outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" | 
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_PSS_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" | 
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_PSS_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_passive_suicidal_ideation == "3a" |  # Co-occurring exposure and outcome
                      outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" | 
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_PSS_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of  passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_PSS_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_passive_suicidal_ideation == "4a" |  # Co-occurring exposure and outcome
                        outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" | 
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_PSS_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_PSS_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_passive_suicidal_ideation == "5a" |  # Co-occurring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_PSS_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_PSS_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_passive_suicidal_ideation == "7a" | # Co-occurring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_PSS_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_passive_suicidal_ideation == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_PSS_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_passive_suicidal_ideation == "9a" | # Co-occuring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_PSS_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" | 
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" | 
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" | 
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" | 
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    ( outcome_phase_passive_suicidal_ideation == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_PSS_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_passive_suicidal_ideation == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_PSS_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_passive_suicidal_ideation == "12b" | # Co-occurring symptom and exposure
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_PSS_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    ( outcome_phase_passive_suicidal_ideation == "13a" | # Co-occurring symptom and exposure
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_PSS_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    ( outcome_phase_passive_suicidal_ideation == "14b" |  # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_14b)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_PSS_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    (  outcome_phase_passive_suicidal_ideation == "15a" |  # Co-occurring symptom and exposure
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_PSS_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                        (outcome_phase_passive_suicidal_ideation == "16b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_16b)


# Phase 17a
dat <- dat %>%
  mutate(positive_covid_test_PSS_17a =
           case_when(exposure_phase_positive_covid_test == "17a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                          outcome_phase_passive_suicidal_ideation == "16b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "17a" & # First positive COVID test at phase 17a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "17a" & # First positive COVID test at phase 17a
                      outcome_phase_passive_suicidal_ideation == "17a" ~ "Yes"   # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_17a)
``` 


Passive suicidal ideation & Positive COVID test result
```{r Positve COVID test result exposure PSS - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_PSS =
           case_when(# First positive test NOT before first experience of passive suicidal ideation
                positive_covid_test_PSS_baseline == "To drop" |
                            positive_covid_test_PSS_1a == "To drop" |
                    positive_covid_test_PSS_1b == "To drop" |
               positive_covid_test_PSS_2a == "To drop" |
                    positive_covid_test_PSS_2b == "To drop" |
               positive_covid_test_PSS_3a == "To drop" |
                    positive_covid_test_PSS_3b == "To drop" |
               positive_covid_test_PSS_4a == "To drop" |
                    positive_covid_test_PSS_4b == "To drop" |
               positive_covid_test_PSS_5a == "To drop" |
                    positive_covid_test_PSS_6b == "To drop" |
               positive_covid_test_PSS_7a == "To drop" |
                    positive_covid_test_PSS_8b == "To drop" |
               positive_covid_test_PSS_9a == "To drop" |
                    positive_covid_test_PSS_10b == "To drop" |
              positive_covid_test_PSS_11a == "To drop" |
                    positive_covid_test_PSS_12b == "To drop" |
                 positive_covid_test_PSS_13a == "To drop" |
                    positive_covid_test_PSS_14b == "To drop" |
                 positive_covid_test_PSS_15a == "To drop" |
                    positive_covid_test_PSS_16b == "To drop" |
                 positive_covid_test_PSS_17a == "To drop" ~ "Positive test after passive suicidal ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether taken test" ~ "All missing", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced passive suicidal ideation
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of passsive suicidal ideation
             positive_covid_test_PSS_baseline == "Yes" |
                    positive_covid_test_PSS_1a == "Yes" |
             positive_covid_test_PSS_1b == "Yes" |
               positive_covid_test_PSS_2a == "Yes" |
              positive_covid_test_PSS_2b == "Yes" |
               positive_covid_test_PSS_3a== "Yes" |
                    positive_covid_test_PSS_3b == "Yes" |
               positive_covid_test_PSS_4a == "Yes" |
                    positive_covid_test_PSS_4b == "Yes" |
               positive_covid_test_PSS_5a == "Yes" |
                    positive_covid_test_PSS_6b == "Yes" |
               positive_covid_test_PSS_7a == "Yes" |
                    positive_covid_test_PSS_8b == "Yes" |
               positive_covid_test_PSS_9a == "Yes" |
                    positive_covid_test_PSS_10b== "Yes" |
               positive_covid_test_PSS_11a == "Yes" |
                    positive_covid_test_PSS_12b == "Yes"|
               positive_covid_test_PSS_13a == "Yes" |
                    positive_covid_test_PSS_14b == "Yes"|
               positive_covid_test_PSS_15a == "Yes" |
                    positive_covid_test_PSS_16b == "Yes"|
               positive_covid_test_PSS_17a == "Yes"  ~ "Positive test before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_PSS_baseline == "No outcome" |
             positive_covid_test_PSS_1a == "No outcome" |
                    positive_covid_test_PSS_1b == "No outcome" |
               positive_covid_test_PSS_2a == "No outcome" |
                    positive_covid_test_PSS_2b == "No outcome" |
               positive_covid_test_PSS_3a == "No outcome" |
                    positive_covid_test_PSS_3b == "No outcome" |
               positive_covid_test_PSS_4a == "No outcome" |
                    positive_covid_test_PSS_4b == "No outcome" |
               positive_covid_test_PSS_5a == "No outcome" |
                    positive_covid_test_PSS_6b == "No outcome" |
               positive_covid_test_PSS_7a == "No outcome" |
                    positive_covid_test_PSS_8b == "No outcome" |
               positive_covid_test_PSS_9a == "No outcome" |
                    positive_covid_test_PSS_10b == "No outcome" |
               positive_covid_test_PSS_11a == "No outcome" |
                    positive_covid_test_PSS_12b == "No outcome" |
               positive_covid_test_PSS_13a == "No outcome" |
                    positive_covid_test_PSS_14b == "No outcome" |
               positive_covid_test_PSS_15a == "No outcome" |
                    positive_covid_test_PSS_16b == "No outcome" |
               positive_covid_test_PSS_17a == "No outcome" ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_PSS) 

# Create final variable of positive COVID test before PSS outcome
dat <- dat %>%
  mutate(positive_covid_test_before_PSS_final =
           case_when(positive_covid_test_before_PSS == "Positive test after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_PSS == "All missing" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_PSS == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced passive suicidal ideation
                     
                     positive_covid_test_before_PSS ==  "Outcome but no exposure" |
                    positive_covid_test_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                     
                     positive_covid_test_before_PSS == "Exposure but no outcome" |
                    positive_covid_test_before_PSS == "Positive test before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_PSS_final) 
```

Self-harm ideation
```{r Positve COVID test result exposure BEFORE outcome SHI - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_SHI_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of SHI
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (outcome_phase_selfharm_ideation == "Baseline" | # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1a" | 
                         outcome_phase_selfharm_ideation == "1b" |
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_SHI_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                     outcome_phase_selfharm_ideation == "Baseline" ~ "To drop",
                     
                     # These people will have experienced a positive COVID test before their first experience of SHI
                        exposure_phase_positive_covid_test == "1a" & 
                       (outcome_phase_selfharm_ideation == "1a" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1b" | 
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_SHI_1b =
           case_when(exposure_phase_positive_covid_test == "1b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_selfharm_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_SHI_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_selfharm_ideation == "2a" |  # Co-occurring symptom & exposure
                         outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" | 
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_SHI_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" | 
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_SHI_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_selfharm_ideation == "3a" |  # Co-occurring exposure and outcome
                      outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" | 
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_SHI_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of  self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_SHI_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_selfharm_ideation == "4a" |  # Co-occurring exposure and outcome
                        outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" | 
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_SHI_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_SHI_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_selfharm_ideation == "5a" |  # Co-occurring exposure & outcome
                      outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_SHI_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_SHI_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_selfharm_ideation == "7a" | # Co-occurring exposure & outcome
                      outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_SHI_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_selfharm_ideation == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_SHI_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_selfharm_ideation == "9a" | # Co-occuring exposure & outcome
                      outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_SHI_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" | 
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" | 
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" | 
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" | 
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    ( outcome_phase_selfharm_ideation == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_SHI_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_selfharm_ideation == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_SHI_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_selfharm_ideation == "12b" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_SHI_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    (  outcome_phase_selfharm_ideation == "13a" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_13a)



# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_SHI_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    ( outcome_phase_selfharm_ideation == "14b" |   # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_14b)


# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_SHI_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    ( outcome_phase_selfharm_ideation == "15a" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_SHI_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    ( outcome_phase_selfharm_ideation == "16b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_16b)


# Phase 17a
dat <- dat %>%
  mutate(positive_covid_test_SHI_17a =
           case_when(exposure_phase_positive_covid_test == "17a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" |
                        outcome_phase_selfharm_ideation == "16b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "17a" & # First positive COVID test at phase 17a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "17a" & # First positive COVID test at phase 17a
                    outcome_phase_selfharm_ideation == "17a" ~ "Yes"  # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_17a)
```

Self-harm ideation & Positive COVID test result
```{r Positve COVID test result exposure SHI - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_SHI =
           case_when(# First positive test NOT before first experience of self-harm ideation
                positive_covid_test_SHI_baseline == "To drop" |
                            positive_covid_test_SHI_1a == "To drop" |
                    positive_covid_test_SHI_1b == "To drop" |
               positive_covid_test_SHI_2a == "To drop" |
                    positive_covid_test_SHI_2b == "To drop" |
               positive_covid_test_SHI_3a == "To drop" |
                    positive_covid_test_SHI_3b == "To drop" |
               positive_covid_test_SHI_4a == "To drop" |
                    positive_covid_test_SHI_4b == "To drop" |
               positive_covid_test_SHI_5a == "To drop" |
                    positive_covid_test_SHI_6b == "To drop" |
               positive_covid_test_SHI_7a == "To drop" |
                    positive_covid_test_SHI_8b == "To drop" |
               positive_covid_test_SHI_9a == "To drop" |
                    positive_covid_test_SHI_10b == "To drop" |
              positive_covid_test_SHI_11a == "To drop" |
                    positive_covid_test_SHI_12b == "To drop" |
                positive_covid_test_SHI_13a == "To drop" |
                    positive_covid_test_SHI_14b == "To drop" |
                positive_covid_test_SHI_15a == "To drop" |
                    positive_covid_test_SHI_16b == "To drop" |
                positive_covid_test_SHI_17a == "To drop"  ~ "Positive test after self-harm ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether taken test" ~ "All missing", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced self-harm ideation
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of self-harm ideation
             positive_covid_test_SHI_baseline == "Yes" |
                    positive_covid_test_SHI_1a == "Yes" |
             positive_covid_test_SHI_1b == "Yes" |
               positive_covid_test_SHI_2a == "Yes" |
              positive_covid_test_SHI_2b == "Yes" |
               positive_covid_test_SHI_3a== "Yes" |
                    positive_covid_test_SHI_3b == "Yes" |
               positive_covid_test_SHI_4a == "Yes" |
                    positive_covid_test_SHI_4b == "Yes" |
               positive_covid_test_SHI_5a == "Yes" |
                    positive_covid_test_SHI_6b == "Yes" |
               positive_covid_test_SHI_7a == "Yes" |
                    positive_covid_test_SHI_8b == "Yes" |
               positive_covid_test_SHI_9a == "Yes" |
                    positive_covid_test_SHI_10b== "Yes" |
               positive_covid_test_SHI_11a == "Yes" |
                    positive_covid_test_SHI_12b == "Yes" |
               positive_covid_test_SHI_13a == "Yes" |
               positive_covid_test_SHI_14b == "Yes" |
                    positive_covid_test_SHI_15a== "Yes" |
               positive_covid_test_SHI_16b == "Yes" |
                    positive_covid_test_SHI_17a == "Yes" ~ "Positive test before self-harm ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_SHI_baseline == "No outcome" |
             positive_covid_test_SHI_1a == "No outcome" |
                    positive_covid_test_SHI_1b == "No outcome" |
               positive_covid_test_SHI_2a == "No outcome" |
                    positive_covid_test_SHI_2b == "No outcome" |
               positive_covid_test_SHI_3a == "No outcome" |
                    positive_covid_test_SHI_3b == "No outcome" |
               positive_covid_test_SHI_4a == "No outcome" |
                    positive_covid_test_SHI_4b == "No outcome" |
               positive_covid_test_SHI_5a == "No outcome" |
                    positive_covid_test_SHI_6b == "No outcome" |
               positive_covid_test_SHI_7a == "No outcome" |
                    positive_covid_test_SHI_8b == "No outcome" |
               positive_covid_test_SHI_9a == "No outcome" |
                    positive_covid_test_SHI_10b == "No outcome" |
               positive_covid_test_SHI_11a == "No outcome" |
                    positive_covid_test_SHI_12b == "No outcome" |
               positive_covid_test_SHI_13a == "No outcome" |
               positive_covid_test_SHI_14b == "No outcome" |
                    positive_covid_test_SHI_15a == "No outcome" |
               positive_covid_test_SHI_16b == "No outcome" |
                    positive_covid_test_SHI_17a == "No outcome" ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_SHI) 

# Create final variable of positive COVID test before SHI outcome
dat <- dat %>%
  mutate(positive_covid_test_before_SHI_final =
           case_when(positive_covid_test_before_SHI == "Positive test after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_SHI == "All missing" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_SHI == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                     positive_covid_test_before_SHI ==  "Outcome but no exposure" |
                     positive_covid_test_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                    positive_covid_test_before_SHI == "Exposure but no outcome" |
                    positive_covid_test_before_SHI == "Positive test before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_SHI_final) 

```

Passive suicidal ideation
```{r Lost someone exposure BEFORE outcome PSS}

# Baseline
dat <- dat %>%
  mutate(lost_someone_PSS_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of PSS
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1a" | 
                          outcome_phase_passive_suicidal_ideation == "1b" | 
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b" |
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_PSS_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_passive_suicidal_ideation == "Baseline"   # Co-occurring exposure & outcome
                         ~ "To drop",
                     
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (outcome_phase_passive_suicidal_ideation == "1a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "1b" | 
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_PSS_1a)


# Phase 1b
dat <- dat %>%
  mutate(lost_someone_PSS_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_passive_suicidal_ideation == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(lost_someone_PSS_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" |
                         outcome_phase_passive_suicidal_ideation == "3b" |
                           outcome_phase_passive_suicidal_ideation == "4a" |
                         outcome_phase_passive_suicidal_ideation == "4b" | 
                           outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_PSS_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_passive_suicidal_ideation == "3a" |
                         outcome_phase_passive_suicidal_ideation == "3b" |
                           outcome_phase_passive_suicidal_ideation == "4a" |
                         outcome_phase_passive_suicidal_ideation == "4b" | 
                           outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_PSS_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                       (outcome_phase_passive_suicidal_ideation == "3a" |  # Co-occurring outcome and exposure
                        outcome_phase_passive_suicidal_ideation == "3b" | 
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_PSS_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_PSS_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    (outcome_phase_passive_suicidal_ideation == "4a" | # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "4b" | 
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_PSS_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_PSS_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    ( outcome_phase_passive_suicidal_ideation == "5a" |  # Co-occurring symptom and exposure
                      outcome_phase_passive_suicidal_ideation == "6b" | 
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_PSS_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_6b)


# Phase 7a
dat <- dat %>%
  mutate(lost_someone_PSS_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    (outcome_phase_passive_suicidal_ideation == "7a" |  # Co-occurring symptom and exposure
                      outcome_phase_passive_suicidal_ideation == "8b" |  
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_PSS_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_passive_suicidal_ideation == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_PSS_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    (outcome_phase_passive_suicidal_ideation == "9a" |  # Co-occurring symptom and exposure
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_9a)


# Phase 10b
dat <- dat %>%
  mutate(lost_someone_PSS_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_passive_suicidal_ideation == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_PSS_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    (outcome_phase_passive_suicidal_ideation == "11a" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_PSS_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   (outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_PSS_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                   (  outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_13a)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_PSS_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   (outcome_phase_passive_suicidal_ideation == "14b" |  # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_PSS_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b"  )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                   ( outcome_phase_passive_suicidal_ideation == "15a" | # Co-occurring symptom and exposure
                     outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_15a)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_PSS_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |  
                       outcome_phase_passive_suicidal_ideation == "15a" 
                         )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                   (outcome_phase_passive_suicidal_ideation == "16b" | # Co-occurring symptom and exposure
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_16b)

# Phase 17a
dat <- dat %>%
  mutate(lost_someone_PSS_17a =
           case_when(exposure_phase_losing_someone == "17a" & # First indicated losing someone at phase 17a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |  
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "17a" & # First indicated losing someone at phase 17a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "17a" & # First indicated losing someone at phase 17a
                     outcome_phase_passive_suicidal_ideation == "17a"  ~ "Yes"  # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_17a)
```

Passive suicidal ideation & losing someone
```{r Losing someone exposure PSS}
dat <- dat %>%
  mutate(losing_someone_before_PSS =
           case_when(# First lost someone NOT before first experience of passive suicidal ideation
                    lost_someone_PSS_baseline == "To drop" |
                       lost_someone_PSS_1a == "To drop" |
                    lost_someone_PSS_1b == "To drop" |
                       lost_someone_PSS_2a == "To drop" |
                    lost_someone_PSS_2b == "To drop" |
                       lost_someone_PSS_3a == "To drop" |
                    lost_someone_PSS_3b == "To drop" |
                       lost_someone_PSS_4a == "To drop" |
                    lost_someone_PSS_4b == "To drop" |
                       lost_someone_PSS_5a == "To drop" |
                    lost_someone_PSS_6b == "To drop" |
                       lost_someone_PSS_7a == "To drop" |
                    lost_someone_PSS_8b == "To drop" |
                       lost_someone_PSS_9a == "To drop" |
                    lost_someone_PSS_10b == "To drop" |
                       lost_someone_PSS_11a == "To drop" |
                    lost_someone_PSS_12b == "To drop" |
                       lost_someone_PSS_13a == "To drop" |
                      lost_someone_PSS_14b == "To drop" |
                       lost_someone_PSS_15a == "To drop" |
                    lost_someone_PSS_16b == "To drop" |
                       lost_someone_PSS_17a == "To drop" ~ "Lost someone after passive suicidal ideation",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced passive suicidal ideation
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of passive suicidal ideation
                    lost_someone_PSS_baseline == "Yes" |
                       lost_someone_PSS_1a == "Yes" |
                    lost_someone_PSS_1b == "Yes" |
                       lost_someone_PSS_2a == "Yes" |
                    lost_someone_PSS_2b == "Yes" |
                       lost_someone_PSS_3a == "Yes" |
                    lost_someone_PSS_3b == "Yes" |
                       lost_someone_PSS_4a == "Yes" |
                    lost_someone_PSS_4b == "Yes" |
                       lost_someone_PSS_5a == "Yes" |
                    lost_someone_PSS_6b == "Yes" |
                       lost_someone_PSS_7a == "Yes" |
                    lost_someone_PSS_8b == "Yes" |
                       lost_someone_PSS_9a == "Yes" |
                    lost_someone_PSS_10b == "Yes" |
                       lost_someone_PSS_11a == "Yes" |
                    lost_someone_PSS_12b == "Yes" |
                       lost_someone_PSS_13a == "Yes" |
                      lost_someone_PSS_14b == "Yes" |
                       lost_someone_PSS_15a == "Yes" |
                    lost_someone_PSS_16b == "Yes" |
                       lost_someone_PSS_17a == "Yes" ~ "Lost someone before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_PSS_baseline == "No outcome" |
                       lost_someone_PSS_1a == "No outcome" |
                    lost_someone_PSS_1b == "No outcome" |
                       lost_someone_PSS_2a == "No outcome" |
                    lost_someone_PSS_2b == "No outcome" |
                       lost_someone_PSS_3a == "No outcome" |
                    lost_someone_PSS_3b == "No outcome" |
                       lost_someone_PSS_4a == "No outcome" |
                    lost_someone_PSS_4b == "No outcome" |
                       lost_someone_PSS_5a == "No outcome" |
                    lost_someone_PSS_6b == "No outcome" |
                       lost_someone_PSS_7a == "No outcome" |
                    lost_someone_PSS_8b == "No outcome" |
                       lost_someone_PSS_9a == "No outcome" |
                    lost_someone_PSS_10b == "No outcome" |
                       lost_someone_PSS_11a == "No outcome" |
                    lost_someone_PSS_12b == "No outcome" |
                       lost_someone_PSS_13a == "No outcome" |
                      lost_someone_PSS_14b == "No outcome" |
                       lost_someone_PSS_15a == "No outcome" |
                    lost_someone_PSS_16b == "No outcome" |
                       lost_someone_PSS_17a == "No outcome" ~ "Exposure but no outcome",
                  
                  
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_PSS) 

# Create final variable of lost someone before PSS outcome
dat <- dat %>%
  mutate(lost_someone_before_PSS_final =
           case_when(losing_someone_before_PSS == "Lost someone after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_PSS == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced passive suicidal ideation
                     
                      losing_someone_before_PSS ==  "Outcome but no exposure" |
                     losing_someone_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_PSS == "Exposure but no outcome" |
                    losing_someone_before_PSS == "Lost someone before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_PSS_final) 
```



Self-harm ideation
```{r Lost someone exposure BEFORE outcome SHI}

# Baseline
dat <- dat %>%
  mutate(lost_someone_SHI_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of SHI
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_selfharm_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1a" | 
                          outcome_phase_selfharm_ideation == "1b" | 
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_SHI_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_selfharm_ideation == "Baseline" ~ "To drop",
                     
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (outcome_phase_selfharm_ideation == "1a" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1b" | 
                        outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SHI_1a)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_SHI_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_selfharm_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_selfharm_ideation == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(lost_someone_SHI_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       (outcome_phase_selfharm_ideation == "2a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" |
                         outcome_phase_selfharm_ideation == "3b" |
                           outcome_phase_selfharm_ideation == "4a" |
                         outcome_phase_selfharm_ideation == "4b" | 
                           outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_SHI_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_selfharm_ideation == "3a" |
                         outcome_phase_selfharm_ideation == "3b" |
                           outcome_phase_selfharm_ideation == "4a" |
                         outcome_phase_selfharm_ideation == "4b" | 
                           outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_2b)


# Phase 3a
dat <- dat %>%
  mutate(lost_someone_SHI_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                      ( outcome_phase_selfharm_ideation == "3a" |  # Co-occurring outcome and exposure
                        outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_SHI_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_3b)


# Phase 4a
dat <- dat %>%
  mutate(lost_someone_SHI_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    ( outcome_phase_selfharm_ideation == "4a" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "4b" | 
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_SHI_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_SHI_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    (outcome_phase_selfharm_ideation == "5a" | # Co-occurring symptom and exposure
                      outcome_phase_selfharm_ideation == "6b" | 
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_SHI_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(lost_someone_SHI_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    (  outcome_phase_selfharm_ideation == "7a" | # Co-occurring symptom and exposure
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_SHI_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_selfharm_ideation == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_SHI_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    (  outcome_phase_selfharm_ideation == "9a" |  # Co-occurring symptom and exposure
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_9a)


# Phase 10b
dat <- dat %>%
  mutate(lost_someone_SHI_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_selfharm_ideation == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_SHI_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    ( outcome_phase_selfharm_ideation == "11a" | # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_SHI_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                      (outcome_phase_selfharm_ideation == "12b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_SHI_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                      (  outcome_phase_selfharm_ideation == "13a" | # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_13a)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_SHI_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |  
                       outcome_phase_selfharm_ideation == "13a" 
                        )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                      ( outcome_phase_selfharm_ideation == "14b" |  # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_SHI_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" | 
                       outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" 
                        )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                      ( outcome_phase_selfharm_ideation == "15a" |  # Co-occurring symptom and exposure
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_15a)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_SHI_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" | 
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                      ( outcome_phase_selfharm_ideation == "16b" |   # Co-occurring symptom and exposure
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_16b)

# Phase 17a
dat <- dat %>%
  mutate(lost_someone_SHI_17a =
           case_when(exposure_phase_losing_someone == "17a" & # First indicated losing someone at phase 17a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |  
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                        outcome_phase_selfharm_ideation == "16b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "17a" & # First indicated losing someone at phase 17a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "17a" & # First indicated losing someone at phase 17a
                     outcome_phase_selfharm_ideation == "17a" ~ "Yes"  # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_17a)
```

Self-harm ideation & losing someone
```{r Losing someone exposure SHI}
dat <- dat %>%
  mutate(losing_someone_before_SHI =
           case_when(# First lost someone NOT before first experience of self-harm ideation
                    lost_someone_SHI_baseline == "To drop" |
                       lost_someone_SHI_1a == "To drop" |
                    lost_someone_SHI_1b == "To drop" |
                       lost_someone_SHI_2a == "To drop" |
                    lost_someone_SHI_2b == "To drop" |
                       lost_someone_SHI_3a == "To drop" |
                    lost_someone_SHI_3b == "To drop" |
                       lost_someone_SHI_4a == "To drop" |
                    lost_someone_SHI_4b == "To drop" |
                       lost_someone_SHI_5a == "To drop" |
                    lost_someone_SHI_6b == "To drop" |
                       lost_someone_SHI_7a == "To drop" |
                    lost_someone_SHI_8b == "To drop" |
                       lost_someone_SHI_9a == "To drop" |
                    lost_someone_SHI_10b == "To drop" |
                       lost_someone_SHI_11a == "To drop" |
                    lost_someone_SHI_12b == "To drop" |
                       lost_someone_SHI_13a == "To drop" |
                    lost_someone_SHI_14b == "To drop" |
                       lost_someone_SHI_15a == "To drop" |
                    lost_someone_SHI_16b == "To drop" |
                       lost_someone_SHI_17a == "To drop" ~ "Lost someone after self-harm ideation",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced self-harm ideation
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of self-harm ideation
                   lost_someone_SHI_baseline == "Yes" |
                       lost_someone_SHI_1a == "Yes" |
                    lost_someone_SHI_1b == "Yes" |
                       lost_someone_SHI_2a == "Yes" |
                    lost_someone_SHI_2b == "Yes" |
                       lost_someone_SHI_3a == "Yes" |
                    lost_someone_SHI_3b == "Yes" |
                       lost_someone_SHI_4a == "Yes" |
                    lost_someone_SHI_4b == "Yes" |
                       lost_someone_SHI_5a == "Yes" |
                    lost_someone_SHI_6b == "Yes" |
                       lost_someone_SHI_7a == "Yes" |
                    lost_someone_SHI_8b == "Yes" |
                       lost_someone_SHI_9a == "Yes" |
                    lost_someone_SHI_10b == "Yes" |
                       lost_someone_SHI_11a == "Yes" |
                    lost_someone_SHI_12b == "Yes" |
                       lost_someone_SHI_13a == "Yes" |
                    lost_someone_SHI_14b == "Yes" |
                       lost_someone_SHI_15a == "Yes" |
                    lost_someone_SHI_16b == "Yes" |
                       lost_someone_SHI_17a == "Yes"  ~ "Lost someone before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_SHI_baseline == "No outcome" |
                       lost_someone_SHI_1a == "No outcome" |
                    lost_someone_SHI_1b == "No outcome" |
                       lost_someone_SHI_2a == "No outcome" |
                    lost_someone_SHI_2b == "No outcome" |
                       lost_someone_SHI_3a == "No outcome" |
                    lost_someone_SHI_3b == "No outcome" |
                       lost_someone_SHI_4a == "No outcome" |
                    lost_someone_SHI_4b == "No outcome" |
                       lost_someone_SHI_5a == "No outcome" |
                    lost_someone_SHI_6b == "No outcome" |
                       lost_someone_SHI_7a == "No outcome" |
                    lost_someone_SHI_8b == "No outcome" |
                       lost_someone_SHI_9a == "No outcome" |
                    lost_someone_SHI_10b == "No outcome" |
                       lost_someone_SHI_11a == "No outcome" |
                    lost_someone_SHI_12b == "No outcome" |
                       lost_someone_SHI_13a == "No outcome" |
                    lost_someone_SHI_14b == "No outcome" |
                       lost_someone_SHI_15a == "No outcome" |
                    lost_someone_SHI_16b == "No outcome" |
                       lost_someone_SHI_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                   # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_SHI) 


# Create final variable of lost someone before SHI outcome
dat <- dat %>%
  mutate(lost_someone_before_SHI_final =
           case_when(losing_someone_before_SHI == "Lost someone after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_SHI == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                      losing_someone_before_SHI ==  "Outcome but no exposure" |
                     losing_someone_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                     losing_someone_before_SHI == "Exposure but no outcome" |
                    losing_someone_before_SHI == "Lost someone before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_SHI_final) 
```


Passive suicidal ideation
```{r Change in main eco activity BEFORE outcome PSS}

# Baseline
dat <- dat %>%
  mutate(main_eco_change_PSS_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_passive_suicidal_ideation == "Baseline" | # Co-occurring 
                        outcome_phase_passive_suicidal_ideation == "1a" | 
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" | 
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_PSS_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Baseline"~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_passive_suicidal_ideation == "1a" |  # Co-occurring
                        outcome_phase_passive_suicidal_ideation == "1b" |  
                         outcome_phase_passive_suicidal_ideation == "2a" | 
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                          outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                          outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_PSS_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_passive_suicidal_ideation == "1b" |  # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "2a" |
                         outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_PSS_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "2b" |
                          outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_PSS_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_passive_suicidal_ideation == "Baseline" |
                           outcome_phase_passive_suicidal_ideation == "1a" |
                           outcome_phase_passive_suicidal_ideation == "1b" |
                          outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "3a" |
                          outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_PSS_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_passive_suicidal_ideation == "3a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_PSS_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_passive_suicidal_ideation == "3b" | # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "4a" |
                           outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_PSS_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_passive_suicidal_ideation == "4a" | # Co-occurring
                         outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_PSS_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_passive_suicidal_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "5a" |
                          outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_PSS_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_passive_suicidal_ideation == "5a" |
                         outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_PSS_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "6b" | # Co-occurring outcome and exposure
                      outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_PSS_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_PSS_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_passive_suicidal_ideation == "7a" | # Co-occurring
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_PSS_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                        outcome_phase_passive_suicidal_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "9a" |
                          outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_PSS_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_passive_suicidal_ideation == "9a" | # Co-occurring
                        outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_PSS_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_PSS_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" | 
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "11a" | # Co-occurring
                    outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_PSS_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_passive_suicidal_ideation == "12b" |  # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_PSS_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_passive_suicidal_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_PSS_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 13a
                    (  outcome_phase_passive_suicidal_ideation == "14b" |   # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_14b)


# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_PSS_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_passive_suicidal_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_15a)



# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_PSS_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    ( outcome_phase_passive_suicidal_ideation == "16b" |   # Co-occurring outcome and exposure
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_16b)




# Phase 17a
dat <- dat %>%
  mutate(main_eco_change_PSS_17a =
           case_when(exposure_phase_main_eco_change == "17a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                        outcome_phase_passive_suicidal_ideation == "16b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                     outcome_phase_passive_suicidal_ideation == "17a" ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_17a)
```

Passive suicidal ideation & change in main eco activity 
```{r Change in eco activity exposure PSS}

dat <- dat %>%
  mutate(main_eco_change_before_PSS =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_PSS_baseline == "To drop" |
                       main_eco_change_PSS_1a == "To drop" |
                    main_eco_change_PSS_1b == "To drop" |
                       main_eco_change_PSS_2a == "To drop" |
                    main_eco_change_PSS_2b == "To drop" |
                       main_eco_change_PSS_3a == "To drop" |
                    main_eco_change_PSS_3b == "To drop" |
                       main_eco_change_PSS_4a == "To drop" |
                    main_eco_change_PSS_4b == "To drop" |
                       main_eco_change_PSS_5a == "To drop" |
                    main_eco_change_PSS_6b == "To drop" |
                       main_eco_change_PSS_7a == "To drop" |
                    main_eco_change_PSS_8b == "To drop" |
                       main_eco_change_PSS_9a == "To drop" |
                    main_eco_change_PSS_10b == "To drop" |
                       main_eco_change_PSS_11a == "To drop" |
                    main_eco_change_PSS_12b == "To drop" |
                    main_eco_change_PSS_13a == "To drop" |
                       main_eco_change_PSS_14b == "To drop" |
                    main_eco_change_PSS_15a == "To drop" |
                       main_eco_change_PSS_16b == "To drop" |
                    main_eco_change_PSS_17a == "To drop" ~ "Change in eco activity after passive suicidal ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_PSS_baseline == "Yes" |
                     main_eco_change_PSS_1a == "Yes" |
                    main_eco_change_PSS_1b == "Yes" |
                     main_eco_change_PSS_2a == "Yes" |
                    main_eco_change_PSS_2b == "Yes" |
                     main_eco_change_PSS_3a == "Yes" |
                    main_eco_change_PSS_3b == "Yes" |
                     main_eco_change_PSS_4a == "Yes" |
                    main_eco_change_PSS_4b == "Yes" |
                     main_eco_change_PSS_5a == "Yes" |
                    main_eco_change_PSS_6b == "Yes" |
                     main_eco_change_PSS_7a == "Yes" |
                    main_eco_change_PSS_8b == "Yes" |
                     main_eco_change_PSS_9a == "Yes" |
                    main_eco_change_PSS_10b == "Yes" |
                     main_eco_change_PSS_11a == "Yes" |
                    main_eco_change_PSS_12b == "Yes"|
                    main_eco_change_PSS_13a == "Yes" |
                     main_eco_change_PSS_14b == "Yes" |
                    main_eco_change_PSS_15a == "Yes" |
                     main_eco_change_PSS_16b == "Yes" |
                    main_eco_change_PSS_17a == "Yes" ~ "Change in eco activity before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_PSS_baseline == "No outcome" |
                    main_eco_change_PSS_1a == "No outcome" |
                    main_eco_change_PSS_1b == "No outcome" |
                    main_eco_change_PSS_2a == "No outcome" |
                    main_eco_change_PSS_2b == "No outcome" |
                    main_eco_change_PSS_3a == "No outcome" |
                    main_eco_change_PSS_3b == "No outcome" |
                    main_eco_change_PSS_4a == "No outcome" |
                    main_eco_change_PSS_4b == "No outcome" |
                    main_eco_change_PSS_5a == "No outcome" |
                    main_eco_change_PSS_6b == "No outcome" |
                    main_eco_change_PSS_7a == "No outcome" |
                    main_eco_change_PSS_8b == "No outcome" |
                    main_eco_change_PSS_9a == "No outcome" |
                    main_eco_change_PSS_10b == "No outcome" |
                    main_eco_change_PSS_11a == "No outcome" |
                    main_eco_change_PSS_12b == "No outcome" |
                    main_eco_change_PSS_13a == "No outcome" |
                    main_eco_change_PSS_14b == "No outcome" |
                    main_eco_change_PSS_15a == "No outcome" |
                    main_eco_change_PSS_16b == "No outcome" |
                    main_eco_change_PSS_17a == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_passive_suicidal_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_PSS) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_PSS_final =
           case_when(main_eco_change_before_PSS == "Change in eco activity after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_PSS == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_PSS ==  "Outcome but no exposure" |
                      main_eco_change_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                      
                     main_eco_change_before_PSS == "Exposure but no outcome" |
                      main_eco_change_before_PSS == "Change in eco activity before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_PSS_final)  

```

Self-harm ideation
```{r Change in main eco activity BEFORE outcome SHI} 
# Baseline
dat <- dat %>%
  mutate(main_eco_change_SHI_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_selfharm_ideation == "Baseline" | # Co-occurring 
                        outcome_phase_selfharm_ideation == "1a" | 
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" | 
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_SHI_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Baseline"~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_selfharm_ideation == "1a" |  # Co-occurring
                        outcome_phase_selfharm_ideation == "1b" |  
                         outcome_phase_selfharm_ideation == "2a" | 
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                          outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                          outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_SHI_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "1b" |  # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_SHI_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "2a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "2b" |
                          outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_SHI_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_selfharm_ideation == "Baseline" |
                           outcome_phase_selfharm_ideation == "1a" |
                           outcome_phase_selfharm_ideation == "1b" |
                          outcome_phase_selfharm_ideation == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "3a" |
                          outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_SHI_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_selfharm_ideation == "3a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_SHI_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "4a" |
                           outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_SHI_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_selfharm_ideation == "4a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_SHI_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "5a" |
                          outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_SHI_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_selfharm_ideation == "5a" |
                         outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_SHI_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_SHI_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_selfharm_ideation == "7a" | # Co-occurring
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_SHI_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                        outcome_phase_selfharm_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "9a" |
                          outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_SHI_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_selfharm_ideation == "9a" | # Co-occurring
                        outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_SHI_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "11a" |
                         outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_SHI_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" | 
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "11a" | # Co-occurring
                    outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_SHI_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_selfharm_ideation == "12b" |   # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") == "12b" ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_SHI_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_selfharm_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_SHI_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_selfharm_ideation == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_SHI_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (outcome_phase_selfharm_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_SHI_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    ( outcome_phase_selfharm_ideation == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_16b)

# Phase 17a
dat <- dat %>%
  mutate(main_eco_change_SHI_17a =
           case_when(exposure_phase_main_eco_change == "17a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "17a" & # First exposure at phase 17a
                      outcome_phase_selfharm_ideation == "17a" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_17a)
```

Self-harm ideation & change in main eco activity 
```{r Change in eco activity exposure SHI}

dat <- dat %>%
  mutate(main_eco_change_before_SHI =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_SHI_baseline == "To drop" |
                       main_eco_change_SHI_1a == "To drop" |
                    main_eco_change_SHI_1b == "To drop" |
                       main_eco_change_SHI_2a == "To drop" |
                    main_eco_change_SHI_2b == "To drop" |
                       main_eco_change_SHI_3a == "To drop" |
                    main_eco_change_SHI_3b == "To drop" |
                       main_eco_change_SHI_4a == "To drop" |
                    main_eco_change_SHI_4b == "To drop" |
                       main_eco_change_SHI_5a == "To drop" |
                    main_eco_change_SHI_6b == "To drop" |
                       main_eco_change_SHI_7a == "To drop" |
                    main_eco_change_SHI_8b == "To drop" |
                       main_eco_change_SHI_9a == "To drop" |
                    main_eco_change_SHI_10b == "To drop" |
                       main_eco_change_SHI_11a == "To drop" |
                    main_eco_change_SHI_12b == "To drop" |
                    main_eco_change_SHI_13a == "To drop" |
                       main_eco_change_SHI_14b == "To drop" |
                    main_eco_change_SHI_15a == "To drop" |
                       main_eco_change_SHI_16b == "To drop" |
                    main_eco_change_SHI_17a == "To drop"~ "Change in eco activity after self-harm ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_SHI_baseline == "Yes" |
                     main_eco_change_SHI_1a == "Yes" |
                    main_eco_change_SHI_1b == "Yes" |
                     main_eco_change_SHI_2a == "Yes" |
                    main_eco_change_SHI_2b == "Yes" |
                     main_eco_change_SHI_3a == "Yes" |
                    main_eco_change_SHI_3b == "Yes" |
                     main_eco_change_SHI_4a == "Yes" |
                    main_eco_change_SHI_4b == "Yes" |
                     main_eco_change_SHI_5a == "Yes" |
                    main_eco_change_SHI_6b == "Yes" |
                     main_eco_change_SHI_7a == "Yes" |
                    main_eco_change_SHI_8b == "Yes" |
                     main_eco_change_SHI_9a == "Yes" |
                    main_eco_change_SHI_10b == "Yes" |
                     main_eco_change_SHI_11a == "Yes" |
                    main_eco_change_SHI_12b == "Yes" |
                    main_eco_change_SHI_13a == "Yes" |
                     main_eco_change_SHI_14b == "Yes" |
                    main_eco_change_SHI_15a == "Yes" |
                     main_eco_change_SHI_16b == "Yes" |
                    main_eco_change_SHI_17a == "Yes" ~ "Change in eco activity before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_SHI_baseline == "No outcome" |
                    main_eco_change_SHI_1a == "No outcome" |
                    main_eco_change_SHI_1b == "No outcome" |
                    main_eco_change_SHI_2a == "No outcome" |
                    main_eco_change_SHI_2b == "No outcome" |
                    main_eco_change_SHI_3a == "No outcome" |
                    main_eco_change_SHI_3b == "No outcome" |
                    main_eco_change_SHI_4a == "No outcome" |
                    main_eco_change_SHI_4b == "No outcome" |
                    main_eco_change_SHI_5a == "No outcome" |
                    main_eco_change_SHI_6b == "No outcome" |
                    main_eco_change_SHI_7a == "No outcome" |
                    main_eco_change_SHI_8b == "No outcome" |
                    main_eco_change_SHI_9a == "No outcome" |
                    main_eco_change_SHI_10b == "No outcome" |
                    main_eco_change_SHI_11a == "No outcome" |
                    main_eco_change_SHI_12b == "No outcome" |
                    main_eco_change_SHI_13a == "No outcome" |
                    main_eco_change_SHI_14b == "No outcome" |
                    main_eco_change_SHI_15a == "No outcome" |
                    main_eco_change_SHI_16b == "No outcome" |
                    main_eco_change_SHI_17a == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_selfharm_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_SHI) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_SHI_final =
           case_when(main_eco_change_before_SHI == "Change in eco activity after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_SHI == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_SHI ==  "Outcome but no exposure" |
                      main_eco_change_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                      main_eco_change_before_SHI == "Exposure but no outcome" |
                      main_eco_change_before_SHI == "Change in eco activity before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_SHI_final)  

```



Self-harm ideation
```{r Change in living situation BEFORE outcome SHI}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_SHI_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_selfharm_ideation == "Baseline" | # Co-occurring
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |  
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_SHI_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Baseline" ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_selfharm_ideation == "1a" | # Co-occurring
                        outcome_phase_selfharm_ideation == "1b" | 
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_SHI_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_SHI_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "Baseline" |
                          outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                          outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_SHI_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a") ~ "To drop", # First experience of outcome occurred SHIfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_selfharm_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "3a" |
                          outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_SHI_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_selfharm_ideation == "3a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_SHI_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_selfharm_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "4a" |
                          outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_SHI_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_selfharm_ideation == "4a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_SHI_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_selfharm_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "5a" |
                          outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_SHI_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_selfharm_ideation == "5a" | # Co-occurring
                         outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_SHI_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_SHI_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_selfharm_ideation == "7a" | # Co-occurring
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_SHI_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_selfharm_ideation == "8b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "9a" |
                          outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_SHI_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_selfharm_ideation == "9a" | # Co-occurring
                        outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_SHI_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "10b" | # Co-occurring outcome and exposure
                      outcome_phase_selfharm_ideation == "11a" |
                          outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_SHI_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" | 
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "11a" | # Co-occurring
                     outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_SHI_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_SHI_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_selfharm_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_SHI_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_selfharm_ideation == "14b" |  # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_SHI_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_selfharm_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_SHI_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    (  outcome_phase_selfharm_ideation == "16b" | # Co-occurring outcome and exposure
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_16b)


# Phase 17a
dat <- dat %>%
  mutate(living_situation_change_SHI_17a =
           case_when(exposure_phase_living_situation_change == "17a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" |
                        outcome_phase_selfharm_ideation == "16b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "17a" & # First exposure at phase 17a
                    outcome_phase_selfharm_ideation == "17a" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_17a)
```

Self-harm ideation & change in living situation
```{r Change in eco activity exposure SHI}

dat <- dat %>%
  mutate(living_situation_change_before_SHI =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_SHI_baseline == "To drop" |
                    living_situation_change_SHI_1a == "To drop" |
                    living_situation_change_SHI_1b == "To drop" |
                      living_situation_change_SHI_2a == "To drop" |
                    living_situation_change_SHI_2b == "To drop" |
                      living_situation_change_SHI_3a == "To drop" |
                    living_situation_change_SHI_3b == "To drop" |
                      living_situation_change_SHI_4a == "To drop" |
                    living_situation_change_SHI_4b == "To drop" |
                      living_situation_change_SHI_5a == "To drop" |
                    living_situation_change_SHI_6b == "To drop" |
                      living_situation_change_SHI_7a == "To drop" |
                    living_situation_change_SHI_8b == "To drop" |
                      living_situation_change_SHI_9a == "To drop" |
                    living_situation_change_SHI_10b == "To drop" |
                      living_situation_change_SHI_11a == "To drop" |
                    living_situation_change_SHI_12b == "To drop" |
                    living_situation_change_SHI_13a == "To drop" |
                      living_situation_change_SHI_14b == "To drop" |
                    living_situation_change_SHI_15a == "To drop" |
                      living_situation_change_SHI_16b == "To drop" |
                    living_situation_change_SHI_17a == "To drop"~ "Change in living situation after self-harm ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_SHI_baseline == "Yes" |
                    living_situation_change_SHI_1a == "Yes" |
                    living_situation_change_SHI_1b == "Yes" |
                    living_situation_change_SHI_2a == "Yes" |
                    living_situation_change_SHI_2b == "Yes" |
                    living_situation_change_SHI_3a == "Yes" |
                    living_situation_change_SHI_3b == "Yes" |
                    living_situation_change_SHI_4a == "Yes" |
                    living_situation_change_SHI_4b == "Yes" |
                    living_situation_change_SHI_5a == "Yes" |
                    living_situation_change_SHI_6b == "Yes" |
                    living_situation_change_SHI_7a == "Yes" |
                    living_situation_change_SHI_8b == "Yes" |
                    living_situation_change_SHI_9a == "Yes" |
                    living_situation_change_SHI_10b == "Yes" |
                    living_situation_change_SHI_11a == "Yes" |
                    living_situation_change_SHI_12b == "Yes"|
                    living_situation_change_SHI_13a == "Yes" |
                    living_situation_change_SHI_14b == "Yes" |
                    living_situation_change_SHI_15a == "Yes" |
                    living_situation_change_SHI_16b == "Yes" |
                    living_situation_change_SHI_17a == "Yes" ~ "Change in living situation before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_SHI_baseline == "No outcome" |
                    living_situation_change_SHI_1a == "No outcome" |
                    living_situation_change_SHI_1b == "No outcome" |
                    living_situation_change_SHI_2a == "No outcome" |
                    living_situation_change_SHI_2b == "No outcome" |
                    living_situation_change_SHI_3a == "No outcome" |
                    living_situation_change_SHI_3b == "No outcome" |
                    living_situation_change_SHI_4a == "No outcome" |
                    living_situation_change_SHI_4b == "No outcome" |
                    living_situation_change_SHI_5a == "No outcome" |
                    living_situation_change_SHI_6b == "No outcome" |
                    living_situation_change_SHI_7a == "No outcome" |
                    living_situation_change_SHI_8b == "No outcome" |
                    living_situation_change_SHI_9a == "No outcome" |
                    living_situation_change_SHI_10b == "No outcome" |
                    living_situation_change_SHI_11a == "No outcome" |
                    living_situation_change_SHI_12b == "No outcome" |
                    living_situation_change_SHI_13a == "No outcome" |
                    living_situation_change_SHI_14b == "No outcome" |
                    living_situation_change_SHI_15a == "No outcome" |
                    living_situation_change_SHI_16b == "No outcome" |
                    living_situation_change_SHI_17a == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_selfharm_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_SHI) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_SHI_final =
           case_when(living_situation_change_before_SHI == "Change in living situation after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_SHI == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                      living_situation_change_before_SHI ==  "Outcome but no exposure" |
                      living_situation_change_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_SHI == "Exposure but no outcome" |
                    living_situation_change_before_SHI == "Change in living situation before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_SHI_final) 
```

SENS ANALYSIS 
Passive suicidal ideation
```{r Positve COVID test result exposure BEFORE outcome PSS - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_PSS_baseline =
           case_when( exposure_phase_positive_covid_test == "Baseline" &
                        outcome_phase_passive_suicidal_ideation == "Baseline" ~ "To drop",
             
             exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of PSS
                        exposure_phase_positive_covid_test == "Baseline" & 
                       ( 
                         outcome_phase_passive_suicidal_ideation == "1a" | 
                         outcome_phase_passive_suicidal_ideation == "1b" |
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b" |
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_PSS_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop",
                      
                     # These people will have experienced a positive COVID test before their first experience of PSS
                        exposure_phase_positive_covid_test == "1a" & 
                       ( outcome_phase_passive_suicidal_ideation == "1b" | 
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_PSS_1b =
           case_when(exposure_phase_positive_covid_test == "1b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       ( outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_PSS_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       ( outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" | 
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_PSS_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                        outcome_phase_passive_suicidal_ideation == "2b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" | 
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_PSS_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    ( outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" | 
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_PSS_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of  passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      ( 
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_PSS_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      ( 
                        outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" | 
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_PSS_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (
                     outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_PSS_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    ( 
                      outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_PSS_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    ( 
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_PSS_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    ( outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_PSS_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    ( outcome_phase_passive_suicidal_ideation == "9a" | 
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_PSS_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" | 
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" | 
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" | 
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" | 
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    ( outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" | 
                     outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_PSS_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" | 
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" | 
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" | 
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" | 
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" | 
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    (  outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_PSS_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    ( outcome_phase_passive_suicidal_ideation == "12b"|
                         outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_PSS_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (  outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_PSS_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    ( 
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_PSS_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    (  
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_14b)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_PSS_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a")  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    ( 
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_PSS_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                      outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                      outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                      outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                      outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                        outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                      outcome_phase_passive_suicidal_ideation == "16b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_PSS_16b)
``` 


Passive suicidal ideation & Positive COVID test result
```{r Positve COVID test result exposure PSS - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_PSS =
           case_when(# First positive test NOT before first experience of passive suicidal ideation
                positive_covid_test_PSS_baseline == "To drop" |
                            positive_covid_test_PSS_1a == "To drop" |
                    positive_covid_test_PSS_1b == "To drop" |
               positive_covid_test_PSS_2a == "To drop" |
                    positive_covid_test_PSS_2b == "To drop" |
               positive_covid_test_PSS_3a == "To drop" |
                    positive_covid_test_PSS_3b == "To drop" |
               positive_covid_test_PSS_4a == "To drop" |
                    positive_covid_test_PSS_4b == "To drop" |
               positive_covid_test_PSS_5a == "To drop" |
                    positive_covid_test_PSS_6b == "To drop" |
               positive_covid_test_PSS_7a == "To drop" |
                    positive_covid_test_PSS_8b == "To drop" |
               positive_covid_test_PSS_9a == "To drop" |
                    positive_covid_test_PSS_10b == "To drop" |
              positive_covid_test_PSS_11a == "To drop" |
                    positive_covid_test_PSS_12b == "To drop" |
                 positive_covid_test_PSS_13a == "To drop" |
                    positive_covid_test_PSS_14b == "To drop" |
                 positive_covid_test_PSS_15a == "To drop" |
                    positive_covid_test_PSS_16b == "To drop" ~ "Positive test after passive suicidal ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether taken test" ~ "All missing", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced passive suicidal ideation
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of passsive suicidal ideation
             positive_covid_test_PSS_baseline == "Yes" |
                    positive_covid_test_PSS_1a == "Yes" |
             positive_covid_test_PSS_1b == "Yes" |
               positive_covid_test_PSS_2a == "Yes" |
              positive_covid_test_PSS_2b == "Yes" |
               positive_covid_test_PSS_3a== "Yes" |
                    positive_covid_test_PSS_3b == "Yes" |
               positive_covid_test_PSS_4a == "Yes" |
                    positive_covid_test_PSS_4b == "Yes" |
               positive_covid_test_PSS_5a == "Yes" |
                    positive_covid_test_PSS_6b == "Yes" |
               positive_covid_test_PSS_7a == "Yes" |
                    positive_covid_test_PSS_8b == "Yes" |
               positive_covid_test_PSS_9a == "Yes" |
                    positive_covid_test_PSS_10b== "Yes" |
               positive_covid_test_PSS_11a == "Yes" |
                    positive_covid_test_PSS_12b == "Yes"|
               positive_covid_test_PSS_13a == "Yes" |
                    positive_covid_test_PSS_14b == "Yes"|
               positive_covid_test_PSS_15a == "Yes" |
                    positive_covid_test_PSS_16b == "Yes" ~ "Positive test before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_PSS_baseline == "No outcome" |
             positive_covid_test_PSS_1a == "No outcome" |
                    positive_covid_test_PSS_1b == "No outcome" |
               positive_covid_test_PSS_2a == "No outcome" |
                    positive_covid_test_PSS_2b == "No outcome" |
               positive_covid_test_PSS_3a == "No outcome" |
                    positive_covid_test_PSS_3b == "No outcome" |
               positive_covid_test_PSS_4a == "No outcome" |
                    positive_covid_test_PSS_4b == "No outcome" |
               positive_covid_test_PSS_5a == "No outcome" |
                    positive_covid_test_PSS_6b == "No outcome" |
               positive_covid_test_PSS_7a == "No outcome" |
                    positive_covid_test_PSS_8b == "No outcome" |
               positive_covid_test_PSS_9a == "No outcome" |
                    positive_covid_test_PSS_10b == "No outcome" |
               positive_covid_test_PSS_11a == "No outcome" |
                    positive_covid_test_PSS_12b == "No outcome" |
               positive_covid_test_PSS_13a == "No outcome" |
                    positive_covid_test_PSS_14b == "No outcome" |
               positive_covid_test_PSS_15a == "No outcome" |
                    positive_covid_test_PSS_16b == "No outcome" ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_PSS) 

# Create final variable of positive COVID test before PSS outcome
dat <- dat %>%
  mutate(positive_covid_test_before_PSS_final =
           case_when(positive_covid_test_before_PSS == "Positive test after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_PSS == "All missing" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_PSS == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced passive suicidal ideation
                     
                     positive_covid_test_before_PSS ==  "Outcome but no exposure" |
                    positive_covid_test_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                     
                     positive_covid_test_before_PSS == "Exposure but no outcome" |
                    positive_covid_test_before_PSS == "Positive test before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_PSS_final) 
```

Self-harm ideation
```{r Positve COVID test result exposure BEFORE outcome SHI - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_SHI_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & 
                     outcome_phase_selfharm_ideation == "Baseline" ~ "To drop",
             
                      exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of SHI
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (outcome_phase_selfharm_ideation == "1a" | 
                         outcome_phase_selfharm_ideation == "1b" |
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b" |
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_SHI_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a") ~ "To drop",
                     
                     # These people will have experienced a positive COVID test before their first experience of SHI
                        exposure_phase_positive_covid_test == "1a" & 
                       (  
                         outcome_phase_selfharm_ideation == "1b" | 
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_SHI_1b =
           case_when(exposure_phase_positive_covid_test == "1b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       ( outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_SHI_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                       outcome_phase_selfharm_ideation == "2a" )  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       ( outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" | 
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_SHI_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                        outcome_phase_selfharm_ideation == "2b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" | 
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_SHI_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    ( outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" | 
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_SHI_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" )  ~ "To drop", # First experience of  self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      ( outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_SHI_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" | 
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_SHI_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (  outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                      outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                      outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                      outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_SHI_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    ( outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_SHI_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_SHI_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    ( outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" | 
                      outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_SHI_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (  outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_SHI_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" | 
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" | 
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" | 
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" | 
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    ( 
                      outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" | 
                     outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_SHI_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" | 
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" | 
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" | 
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" | 
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" | 
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" | 
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                        outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    (  
                       outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_SHI_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    ( outcome_phase_selfharm_ideation == "12b"|
                         outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_SHI_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" )  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_SHI_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    (  outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_13a)



# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_SHI_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    (  outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_14b)


# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_SHI_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                      outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                      outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                      outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                      outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" )  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    (   outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_SHI_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                        outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                        outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                        outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                        outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                        outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                        outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" |
                        outcome_phase_selfharm_ideation == "16b")  ~ "To drop", # First experience of self-harm ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_SHI_16b)
```

Self-harm ideation & Positive COVID test result
```{r Positve COVID test result exposure SHI - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_SHI =
           case_when(# First positive test NOT before first experience of self-harm ideation
                positive_covid_test_SHI_baseline == "To drop" |
                            positive_covid_test_SHI_1a == "To drop" |
                    positive_covid_test_SHI_1b == "To drop" |
               positive_covid_test_SHI_2a == "To drop" |
                    positive_covid_test_SHI_2b == "To drop" |
               positive_covid_test_SHI_3a == "To drop" |
                    positive_covid_test_SHI_3b == "To drop" |
               positive_covid_test_SHI_4a == "To drop" |
                    positive_covid_test_SHI_4b == "To drop" |
               positive_covid_test_SHI_5a == "To drop" |
                    positive_covid_test_SHI_6b == "To drop" |
               positive_covid_test_SHI_7a == "To drop" |
                    positive_covid_test_SHI_8b == "To drop" |
               positive_covid_test_SHI_9a == "To drop" |
                    positive_covid_test_SHI_10b == "To drop" |
              positive_covid_test_SHI_11a == "To drop" |
                    positive_covid_test_SHI_12b == "To drop" |
                positive_covid_test_SHI_13a == "To drop" |
                    positive_covid_test_SHI_14b == "To drop" |
                positive_covid_test_SHI_15a == "To drop" |
                    positive_covid_test_SHI_16b == "To drop"   ~ "Positive test after self-harm ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "Not answered whether taken test" ~ "All missing", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Taken test but not indicated result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced self-harm ideation
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of self-harm ideation
             positive_covid_test_SHI_baseline == "Yes" |
                    positive_covid_test_SHI_1a == "Yes" |
             positive_covid_test_SHI_1b == "Yes" |
               positive_covid_test_SHI_2a == "Yes" |
              positive_covid_test_SHI_2b == "Yes" |
               positive_covid_test_SHI_3a== "Yes" |
                    positive_covid_test_SHI_3b == "Yes" |
               positive_covid_test_SHI_4a == "Yes" |
                    positive_covid_test_SHI_4b == "Yes" |
               positive_covid_test_SHI_5a == "Yes" |
                    positive_covid_test_SHI_6b == "Yes" |
               positive_covid_test_SHI_7a == "Yes" |
                    positive_covid_test_SHI_8b == "Yes" |
               positive_covid_test_SHI_9a == "Yes" |
                    positive_covid_test_SHI_10b== "Yes" |
               positive_covid_test_SHI_11a == "Yes" |
                    positive_covid_test_SHI_12b == "Yes" |
               positive_covid_test_SHI_13a == "Yes" |
               positive_covid_test_SHI_14b == "Yes" |
                    positive_covid_test_SHI_15a== "Yes" |
               positive_covid_test_SHI_16b == "Yes" ~ "Positive test before self-harm ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_SHI_baseline == "No outcome" |
             positive_covid_test_SHI_1a == "No outcome" |
                    positive_covid_test_SHI_1b == "No outcome" |
               positive_covid_test_SHI_2a == "No outcome" |
                    positive_covid_test_SHI_2b == "No outcome" |
               positive_covid_test_SHI_3a == "No outcome" |
                    positive_covid_test_SHI_3b == "No outcome" |
               positive_covid_test_SHI_4a == "No outcome" |
                    positive_covid_test_SHI_4b == "No outcome" |
               positive_covid_test_SHI_5a == "No outcome" |
                    positive_covid_test_SHI_6b == "No outcome" |
               positive_covid_test_SHI_7a == "No outcome" |
                    positive_covid_test_SHI_8b == "No outcome" |
               positive_covid_test_SHI_9a == "No outcome" |
                    positive_covid_test_SHI_10b == "No outcome" |
               positive_covid_test_SHI_11a == "No outcome" |
                    positive_covid_test_SHI_12b == "No outcome" |
               positive_covid_test_SHI_13a == "No outcome" |
               positive_covid_test_SHI_14b == "No outcome" |
                    positive_covid_test_SHI_15a == "No outcome" |
               positive_covid_test_SHI_16b == "No outcome"  ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_SHI) 

# Create final variable of positive COVID test before SHI outcome
dat <- dat %>%
  mutate(positive_covid_test_before_SHI_final =
           case_when(positive_covid_test_before_SHI == "Positive test after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_SHI == "All missing" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_SHI == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                     positive_covid_test_before_SHI ==  "Outcome but no exposure" |
                     positive_covid_test_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                    positive_covid_test_before_SHI == "Exposure but no outcome" |
                    positive_covid_test_before_SHI == "Positive test before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_SHI_final) 
```

Passive suicidal ideation
```{r Lost someone exposure BEFORE outcome PSS}
# Baseline
dat <- dat %>%
  mutate(lost_someone_PSS_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" &
                      outcome_phase_passive_suicidal_ideation == "Baseline" ~ "To drop", 
             
                    exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of PSS
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       ( outcome_phase_passive_suicidal_ideation == "1a" | 
                          outcome_phase_passive_suicidal_ideation == "1b" | 
                          outcome_phase_passive_suicidal_ideation == "2a" | 
                        outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b" |
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_PSS_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                    (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" ) ~ "To drop",
                     
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (outcome_phase_passive_suicidal_ideation == "1b" | 
                        outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_PSS_1a)


# Phase 1b
dat <- dat %>%
  mutate(lost_someone_PSS_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (  outcome_phase_passive_suicidal_ideation == "2a" | 
                          outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(lost_someone_PSS_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       ( outcome_phase_passive_suicidal_ideation == "2b" | 
                          outcome_phase_passive_suicidal_ideation == "3a" |
                         outcome_phase_passive_suicidal_ideation == "3b" |
                           outcome_phase_passive_suicidal_ideation == "4a" |
                         outcome_phase_passive_suicidal_ideation == "4b" | 
                           outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_PSS_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                        outcome_phase_passive_suicidal_ideation == "2b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (  outcome_phase_passive_suicidal_ideation == "3a" |
                         outcome_phase_passive_suicidal_ideation == "3b" |
                           outcome_phase_passive_suicidal_ideation == "4a" |
                         outcome_phase_passive_suicidal_ideation == "4b" | 
                           outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_PSS_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                       (outcome_phase_passive_suicidal_ideation == "3b" | 
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_PSS_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (  outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" | 
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_PSS_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    ( outcome_phase_passive_suicidal_ideation == "4b" | 
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_PSS_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (  outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_PSS_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    ( outcome_phase_passive_suicidal_ideation == "6b" | 
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_PSS_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    ( outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_6b)


# Phase 7a
dat <- dat %>%
  mutate(lost_someone_PSS_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    ( outcome_phase_passive_suicidal_ideation == "8b" |  
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_PSS_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (  outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_PSS_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    (  outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_9a)


# Phase 10b
dat <- dat %>%
  mutate(lost_someone_PSS_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (  outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_PSS_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    (outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_PSS_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   ( outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_PSS_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                        outcome_phase_passive_suicidal_ideation == "13a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                   ( outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_13a)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_PSS_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   ( outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_PSS_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a")  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                   ( outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_15a)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_PSS_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                      outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                          outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |  
                       outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" 
                         )  ~ "To drop", # First experience of passive suicidal ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_PSS_16b)
```

Passive suicidal ideation & losing someone
```{r Losing someone exposure PSS}
dat <- dat %>%
  mutate(losing_someone_before_PSS =
           case_when(# First lost someone NOT before first experience of passive suicidal ideation
                    lost_someone_PSS_baseline == "To drop" |
                       lost_someone_PSS_1a == "To drop" |
                    lost_someone_PSS_1b == "To drop" |
                       lost_someone_PSS_2a == "To drop" |
                    lost_someone_PSS_2b == "To drop" |
                       lost_someone_PSS_3a == "To drop" |
                    lost_someone_PSS_3b == "To drop" |
                       lost_someone_PSS_4a == "To drop" |
                    lost_someone_PSS_4b == "To drop" |
                       lost_someone_PSS_5a == "To drop" |
                    lost_someone_PSS_6b == "To drop" |
                       lost_someone_PSS_7a == "To drop" |
                    lost_someone_PSS_8b == "To drop" |
                       lost_someone_PSS_9a == "To drop" |
                    lost_someone_PSS_10b == "To drop" |
                       lost_someone_PSS_11a == "To drop" |
                    lost_someone_PSS_12b == "To drop" |
                       lost_someone_PSS_13a == "To drop" |
                      lost_someone_PSS_14b == "To drop" |
                       lost_someone_PSS_15a == "To drop" |
                    lost_someone_PSS_16b == "To drop" ~ "Lost someone after passive suicidal ideation",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced passive suicidal ideation
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of passive suicidal ideation
                    lost_someone_PSS_baseline == "Yes" |
                       lost_someone_PSS_1a == "Yes" |
                    lost_someone_PSS_1b == "Yes" |
                       lost_someone_PSS_2a == "Yes" |
                    lost_someone_PSS_2b == "Yes" |
                       lost_someone_PSS_3a == "Yes" |
                    lost_someone_PSS_3b == "Yes" |
                       lost_someone_PSS_4a == "Yes" |
                    lost_someone_PSS_4b == "Yes" |
                       lost_someone_PSS_5a == "Yes" |
                    lost_someone_PSS_6b == "Yes" |
                       lost_someone_PSS_7a == "Yes" |
                    lost_someone_PSS_8b == "Yes" |
                       lost_someone_PSS_9a == "Yes" |
                    lost_someone_PSS_10b == "Yes" |
                       lost_someone_PSS_11a == "Yes" |
                    lost_someone_PSS_12b == "Yes" |
                       lost_someone_PSS_13a == "Yes" |
                      lost_someone_PSS_14b == "Yes" |
                       lost_someone_PSS_15a == "Yes" |
                    lost_someone_PSS_16b == "Yes"  ~ "Lost someone before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_PSS_baseline == "No outcome" |
                       lost_someone_PSS_1a == "No outcome" |
                    lost_someone_PSS_1b == "No outcome" |
                       lost_someone_PSS_2a == "No outcome" |
                    lost_someone_PSS_2b == "No outcome" |
                       lost_someone_PSS_3a == "No outcome" |
                    lost_someone_PSS_3b == "No outcome" |
                       lost_someone_PSS_4a == "No outcome" |
                    lost_someone_PSS_4b == "No outcome" |
                       lost_someone_PSS_5a == "No outcome" |
                    lost_someone_PSS_6b == "No outcome" |
                       lost_someone_PSS_7a == "No outcome" |
                    lost_someone_PSS_8b == "No outcome" |
                       lost_someone_PSS_9a == "No outcome" |
                    lost_someone_PSS_10b == "No outcome" |
                       lost_someone_PSS_11a == "No outcome" |
                    lost_someone_PSS_12b == "No outcome" |
                       lost_someone_PSS_13a == "No outcome" |
                      lost_someone_PSS_14b == "No outcome" |
                       lost_someone_PSS_15a == "No outcome" |
                    lost_someone_PSS_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_PSS) 

# Create final variable of lost someone before PSS outcome
dat <- dat %>%
  mutate(lost_someone_before_PSS_final =
           case_when(losing_someone_before_PSS == "Lost someone after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_PSS == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced passive suicidal ideation
                     
                      losing_someone_before_PSS ==  "Outcome but no exposure" |
                     losing_someone_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_PSS == "Exposure but no outcome" |
                    losing_someone_before_PSS == "Lost someone before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_PSS_final) 
```


Self-harm ideation
```{r Lost someone exposure BEFORE outcome SHI}
# Baseline
dat <- dat %>%
  mutate(lost_someone_SHI_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" &
             outcome_phase_selfharm_ideation == "Baseline" ~ "To drop",
             
             exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of SHI
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       ( outcome_phase_selfharm_ideation == "1a" | 
                          outcome_phase_selfharm_ideation == "1b" | 
                          outcome_phase_selfharm_ideation == "2a" | 
                        outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_SHI_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (
                         outcome_phase_selfharm_ideation == "1b" | 
                        outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SHI_1a)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_SHI_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_selfharm_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_selfharm_ideation == "2a" | 
                          outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(lost_someone_SHI_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       ( outcome_phase_selfharm_ideation == "2b" | 
                          outcome_phase_selfharm_ideation == "3a" |
                         outcome_phase_selfharm_ideation == "3b" |
                           outcome_phase_selfharm_ideation == "4a" |
                         outcome_phase_selfharm_ideation == "4b" | 
                           outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_SHI_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                        outcome_phase_selfharm_ideation == "2b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       ( outcome_phase_selfharm_ideation == "3a" |
                         outcome_phase_selfharm_ideation == "3b" |
                           outcome_phase_selfharm_ideation == "4a" |
                         outcome_phase_selfharm_ideation == "4b" | 
                           outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_2b)


# Phase 3a
dat <- dat %>%
  mutate(lost_someone_SHI_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                      ( outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_SHI_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" | 
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_SHI_3b)


# Phase 4a
dat <- dat %>%
  mutate(lost_someone_SHI_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    ( outcome_phase_selfharm_ideation == "4b" | 
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_SHI_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    ( outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_SHI_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    ( outcome_phase_selfharm_ideation == "6b" | 
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_SHI_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (  outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(lost_someone_SHI_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b"| 
                      outcome_phase_selfharm_ideation == "7a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    ( outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_SHI_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (  outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_SHI_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    (outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_9a)


# Phase 10b
dat <- dat %>%
  mutate(lost_someone_SHI_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    ( outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_SHI_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    (  outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_SHI_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                      (outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_SHI_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                        outcome_phase_selfharm_ideation == "13a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                      (  outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_13a)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_SHI_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |  
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" )  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                      ( outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_SHI_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" | 
                       outcome_phase_selfharm_ideation == "13a" |
                        outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                      ( outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_SHI_15a)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_SHI_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                      outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" | 
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b")  ~ "To drop", # First experience of self-harm ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                           
         ) 
  )
```

Self-harm ideation & losing someone
```{r Losing someone exposure SHI}
dat <- dat %>%
  mutate(losing_someone_before_SHI =
           case_when(# First lost someone NOT before first experience of self-harm ideation
                    lost_someone_SHI_baseline == "To drop" |
                       lost_someone_SHI_1a == "To drop" |
                    lost_someone_SHI_1b == "To drop" |
                       lost_someone_SHI_2a == "To drop" |
                    lost_someone_SHI_2b == "To drop" |
                       lost_someone_SHI_3a == "To drop" |
                    lost_someone_SHI_3b == "To drop" |
                       lost_someone_SHI_4a == "To drop" |
                    lost_someone_SHI_4b == "To drop" |
                       lost_someone_SHI_5a == "To drop" |
                    lost_someone_SHI_6b == "To drop" |
                       lost_someone_SHI_7a == "To drop" |
                    lost_someone_SHI_8b == "To drop" |
                       lost_someone_SHI_9a == "To drop" |
                    lost_someone_SHI_10b == "To drop" |
                       lost_someone_SHI_11a == "To drop" |
                    lost_someone_SHI_12b == "To drop" |
                       lost_someone_SHI_13a == "To drop" |
                    lost_someone_SHI_14b == "To drop" |
                       lost_someone_SHI_15a == "To drop" |
                    lost_someone_SHI_16b == "To drop"  ~ "Lost someone after self-harm ideation",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced self-harm ideation
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of self-harm ideation
                   lost_someone_SHI_baseline == "Yes" |
                       lost_someone_SHI_1a == "Yes" |
                    lost_someone_SHI_1b == "Yes" |
                       lost_someone_SHI_2a == "Yes" |
                    lost_someone_SHI_2b == "Yes" |
                       lost_someone_SHI_3a == "Yes" |
                    lost_someone_SHI_3b == "Yes" |
                       lost_someone_SHI_4a == "Yes" |
                    lost_someone_SHI_4b == "Yes" |
                       lost_someone_SHI_5a == "Yes" |
                    lost_someone_SHI_6b == "Yes" |
                       lost_someone_SHI_7a == "Yes" |
                    lost_someone_SHI_8b == "Yes" |
                       lost_someone_SHI_9a == "Yes" |
                    lost_someone_SHI_10b == "Yes" |
                       lost_someone_SHI_11a == "Yes" |
                    lost_someone_SHI_12b == "Yes" |
                       lost_someone_SHI_13a == "Yes" |
                    lost_someone_SHI_14b == "Yes" |
                       lost_someone_SHI_15a == "Yes" |
                    lost_someone_SHI_16b == "Yes"  ~ "Lost someone before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_SHI_baseline == "No outcome" |
                       lost_someone_SHI_1a == "No outcome" |
                    lost_someone_SHI_1b == "No outcome" |
                       lost_someone_SHI_2a == "No outcome" |
                    lost_someone_SHI_2b == "No outcome" |
                       lost_someone_SHI_3a == "No outcome" |
                    lost_someone_SHI_3b == "No outcome" |
                       lost_someone_SHI_4a == "No outcome" |
                    lost_someone_SHI_4b == "No outcome" |
                       lost_someone_SHI_5a == "No outcome" |
                    lost_someone_SHI_6b == "No outcome" |
                       lost_someone_SHI_7a == "No outcome" |
                    lost_someone_SHI_8b == "No outcome" |
                       lost_someone_SHI_9a == "No outcome" |
                    lost_someone_SHI_10b == "No outcome" |
                       lost_someone_SHI_11a == "No outcome" |
                    lost_someone_SHI_12b == "No outcome" |
                       lost_someone_SHI_13a == "No outcome" |
                    lost_someone_SHI_14b == "No outcome" |
                       lost_someone_SHI_15a == "No outcome" |
                    lost_someone_SHI_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                   # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_SHI) 


# Create final variable of lost someone before SHI outcome
dat <- dat %>%
  mutate(lost_someone_before_SHI_final =
           case_when(losing_someone_before_SHI == "Lost someone after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_SHI == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced self-harm ideation
                     
                      losing_someone_before_SHI ==  "Outcome but no exposure" |
                     losing_someone_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                     losing_someone_before_SHI == "Exposure but no outcome" |
                    losing_someone_before_SHI == "Lost someone before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_SHI_final) 
```

Passive suicidal ideation
```{r Change in main eco activity BEFORE outcome PSS}

# Baseline
dat <- dat %>%
  mutate(main_eco_change_PSS_baseline =
           case_when(  exposure_phase_main_eco_change == "Baseline" &
                      outcome_phase_passive_suicidal_ideation == "Baseline" ~ "To drop",
                     
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      ( outcome_phase_passive_suicidal_ideation == "1a" | 
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" | 
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_PSS_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" )~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      ( outcome_phase_passive_suicidal_ideation == "1b" |  
                         outcome_phase_passive_suicidal_ideation == "2a" | 
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" | 
                       outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" | 
                       outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" | 
                       outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" | 
                       outcome_phase_passive_suicidal_ideation == "8b" |
                          outcome_phase_passive_suicidal_ideation == "9a" | 
                       outcome_phase_passive_suicidal_ideation == "10b" |
                          outcome_phase_passive_suicidal_ideation == "11a" | 
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_PSS_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" |
                         outcome_phase_passive_suicidal_ideation == "1b") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_passive_suicidal_ideation == "2a" |
                         outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_PSS_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |
                       outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" ) ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2b" |
                          outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_PSS_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_passive_suicidal_ideation == "Baseline" |
                           outcome_phase_passive_suicidal_ideation == "1a" |
                           outcome_phase_passive_suicidal_ideation == "1b" |
                          outcome_phase_passive_suicidal_ideation == "2a" |
                           outcome_phase_passive_suicidal_ideation == "2b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       ( outcome_phase_passive_suicidal_ideation == "3a" |
                          outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_PSS_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_PSS_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_passive_suicidal_ideation == "4a" |
                           outcome_phase_passive_suicidal_ideation == "4b" |
                        outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                        outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_PSS_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_PSS_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_passive_suicidal_ideation == "5a" |
                          outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_PSS_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_PSS_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_PSS_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_PSS_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    ( outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_PSS_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                        outcome_phase_passive_suicidal_ideation == "8b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                       outcome_phase_passive_suicidal_ideation == "9a" |
                          outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_PSS_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_PSS_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      ( outcome_phase_passive_suicidal_ideation == "11a" |
                         outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_PSS_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" | 
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "12b"| 
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_PSS_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_PSS_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a"  )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (   outcome_phase_passive_suicidal_ideation == "14b" | 
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_PSS_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b"   )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 13a
                    (  outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_14b)


# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_PSS_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (    outcome_phase_passive_suicidal_ideation == "16b" | 
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_15a)



# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_PSS_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                        outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                       outcome_phase_passive_suicidal_ideation == "16b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered") 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_PSS_16b)
```

Passive suicidal ideation & change in main eco activity 
```{r Change in eco activity exposure PSS}

dat <- dat %>%
  mutate(main_eco_change_before_PSS =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_PSS_baseline == "To drop" |
                       main_eco_change_PSS_1a == "To drop" |
                    main_eco_change_PSS_1b == "To drop" |
                       main_eco_change_PSS_2a == "To drop" |
                    main_eco_change_PSS_2b == "To drop" |
                       main_eco_change_PSS_3a == "To drop" |
                    main_eco_change_PSS_3b == "To drop" |
                       main_eco_change_PSS_4a == "To drop" |
                    main_eco_change_PSS_4b == "To drop" |
                       main_eco_change_PSS_5a == "To drop" |
                    main_eco_change_PSS_6b == "To drop" |
                       main_eco_change_PSS_7a == "To drop" |
                    main_eco_change_PSS_8b == "To drop" |
                       main_eco_change_PSS_9a == "To drop" |
                    main_eco_change_PSS_10b == "To drop" |
                       main_eco_change_PSS_11a == "To drop" |
                    main_eco_change_PSS_12b == "To drop" |
                    main_eco_change_PSS_13a == "To drop" |
                       main_eco_change_PSS_14b == "To drop" |
                    main_eco_change_PSS_15a == "To drop" |
                       main_eco_change_PSS_16b == "To drop" ~ "Change in eco activity after passive suicidal ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_PSS_baseline == "Yes" |
                     main_eco_change_PSS_1a == "Yes" |
                    main_eco_change_PSS_1b == "Yes" |
                     main_eco_change_PSS_2a == "Yes" |
                    main_eco_change_PSS_2b == "Yes" |
                     main_eco_change_PSS_3a == "Yes" |
                    main_eco_change_PSS_3b == "Yes" |
                     main_eco_change_PSS_4a == "Yes" |
                    main_eco_change_PSS_4b == "Yes" |
                     main_eco_change_PSS_5a == "Yes" |
                    main_eco_change_PSS_6b == "Yes" |
                     main_eco_change_PSS_7a == "Yes" |
                    main_eco_change_PSS_8b == "Yes" |
                     main_eco_change_PSS_9a == "Yes" |
                    main_eco_change_PSS_10b == "Yes" |
                     main_eco_change_PSS_11a == "Yes" |
                    main_eco_change_PSS_12b == "Yes"|
                    main_eco_change_PSS_13a == "Yes" |
                     main_eco_change_PSS_14b == "Yes" |
                    main_eco_change_PSS_15a == "Yes" |
                     main_eco_change_PSS_16b == "Yes" ~ "Change in eco activity before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_PSS_baseline == "No outcome" |
                    main_eco_change_PSS_1a == "No outcome" |
                    main_eco_change_PSS_1b == "No outcome" |
                    main_eco_change_PSS_2a == "No outcome" |
                    main_eco_change_PSS_2b == "No outcome" |
                    main_eco_change_PSS_3a == "No outcome" |
                    main_eco_change_PSS_3b == "No outcome" |
                    main_eco_change_PSS_4a == "No outcome" |
                    main_eco_change_PSS_4b == "No outcome" |
                    main_eco_change_PSS_5a == "No outcome" |
                    main_eco_change_PSS_6b == "No outcome" |
                    main_eco_change_PSS_7a == "No outcome" |
                    main_eco_change_PSS_8b == "No outcome" |
                    main_eco_change_PSS_9a == "No outcome" |
                    main_eco_change_PSS_10b == "No outcome" |
                    main_eco_change_PSS_11a == "No outcome" |
                    main_eco_change_PSS_12b == "No outcome" |
                    main_eco_change_PSS_13a == "No outcome" |
                    main_eco_change_PSS_14b == "No outcome" |
                    main_eco_change_PSS_15a == "No outcome" |
                    main_eco_change_PSS_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_passive_suicidal_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_PSS) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_PSS_final =
           case_when(main_eco_change_before_PSS == "Change in eco activity after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_PSS == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_PSS ==  "Outcome but no exposure" |
                      main_eco_change_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                      
                     main_eco_change_before_PSS == "Exposure but no outcome" |
                      main_eco_change_before_PSS == "Change in eco activity before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_PSS_final)  

```


Self-harm ideation
```{r Change in main eco activity BEFORE outcome SHI} 
# Baseline
dat <- dat %>%
  mutate(main_eco_change_SHI_baseline =
           case_when(exposure_phase_main_eco_change == "Baseline" &
                      outcome_phase_selfharm_ideation == "Baseline" ~ "To drop",
             
                   exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      ( outcome_phase_selfharm_ideation == "1a" | 
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" | 
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_SHI_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a") ~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      ( outcome_phase_selfharm_ideation == "1b" |  
                         outcome_phase_selfharm_ideation == "2a" | 
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" | 
                       outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" | 
                       outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" | 
                       outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" | 
                       outcome_phase_selfharm_ideation == "8b" |
                          outcome_phase_selfharm_ideation == "9a" | 
                       outcome_phase_selfharm_ideation == "10b" |
                          outcome_phase_selfharm_ideation == "11a" | 
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_SHI_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                         outcome_phase_selfharm_ideation == "1b" ) ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_SHI_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "Baseline" |
                       outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       ( outcome_phase_selfharm_ideation == "2b" |
                          outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_SHI_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_selfharm_ideation == "Baseline" |
                           outcome_phase_selfharm_ideation == "1a" |
                           outcome_phase_selfharm_ideation == "1b" |
                          outcome_phase_selfharm_ideation == "2a" |
                           outcome_phase_selfharm_ideation == "2b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       ( outcome_phase_selfharm_ideation == "3a" |
                          outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_SHI_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       ( outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_SHI_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       ( outcome_phase_selfharm_ideation == "4a" |
                           outcome_phase_selfharm_ideation == "4b" |
                        outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                        outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_SHI_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       ( outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_SHI_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       ( outcome_phase_selfharm_ideation == "5a" |
                          outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_SHI_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       ( outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_SHI_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm_ideation == "7a" |
                        outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_SHI_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" | 
                         outcome_phase_selfharm_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    ( outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_SHI_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                         outcome_phase_selfharm_ideation == "8b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                       outcome_phase_selfharm_ideation == "9a" |
                          outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_SHI_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a"  )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      ( outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_SHI_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "11a" |
                         outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_SHI_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" | 
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      ( outcome_phase_selfharm_ideation == "12b"| 
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_SHI_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    ( outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") == "12b" ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_SHI_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (  outcome_phase_selfharm_ideation == "14b" | 
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_SHI_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_SHI_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (outcome_phase_selfharm_ideation == "16b" | 
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_SHI_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a"|
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                       outcome_phase_selfharm_ideation == "16b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_SHI_16b)
```

Self-harm ideation & change in main eco activity 
```{r Change in eco activity exposure SHI}

dat <- dat %>%
  mutate(main_eco_change_before_SHI =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_SHI_baseline == "To drop" |
                       main_eco_change_SHI_1a == "To drop" |
                    main_eco_change_SHI_1b == "To drop" |
                       main_eco_change_SHI_2a == "To drop" |
                    main_eco_change_SHI_2b == "To drop" |
                       main_eco_change_SHI_3a == "To drop" |
                    main_eco_change_SHI_3b == "To drop" |
                       main_eco_change_SHI_4a == "To drop" |
                    main_eco_change_SHI_4b == "To drop" |
                       main_eco_change_SHI_5a == "To drop" |
                    main_eco_change_SHI_6b == "To drop" |
                       main_eco_change_SHI_7a == "To drop" |
                    main_eco_change_SHI_8b == "To drop" |
                       main_eco_change_SHI_9a == "To drop" |
                    main_eco_change_SHI_10b == "To drop" |
                       main_eco_change_SHI_11a == "To drop" |
                    main_eco_change_SHI_12b == "To drop" |
                    main_eco_change_SHI_13a == "To drop" |
                       main_eco_change_SHI_14b == "To drop" |
                    main_eco_change_SHI_15a == "To drop" |
                       main_eco_change_SHI_16b == "To drop" ~ "Change in eco activity after self-harm ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_SHI_baseline == "Yes" |
                     main_eco_change_SHI_1a == "Yes" |
                    main_eco_change_SHI_1b == "Yes" |
                     main_eco_change_SHI_2a == "Yes" |
                    main_eco_change_SHI_2b == "Yes" |
                     main_eco_change_SHI_3a == "Yes" |
                    main_eco_change_SHI_3b == "Yes" |
                     main_eco_change_SHI_4a == "Yes" |
                    main_eco_change_SHI_4b == "Yes" |
                     main_eco_change_SHI_5a == "Yes" |
                    main_eco_change_SHI_6b == "Yes" |
                     main_eco_change_SHI_7a == "Yes" |
                    main_eco_change_SHI_8b == "Yes" |
                     main_eco_change_SHI_9a == "Yes" |
                    main_eco_change_SHI_10b == "Yes" |
                     main_eco_change_SHI_11a == "Yes" |
                    main_eco_change_SHI_12b == "Yes" |
                    main_eco_change_SHI_13a == "Yes" |
                     main_eco_change_SHI_14b == "Yes" |
                    main_eco_change_SHI_15a == "Yes" |
                     main_eco_change_SHI_16b == "Yes"  ~ "Change in eco activity before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_SHI_baseline == "No outcome" |
                    main_eco_change_SHI_1a == "No outcome" |
                    main_eco_change_SHI_1b == "No outcome" |
                    main_eco_change_SHI_2a == "No outcome" |
                    main_eco_change_SHI_2b == "No outcome" |
                    main_eco_change_SHI_3a == "No outcome" |
                    main_eco_change_SHI_3b == "No outcome" |
                    main_eco_change_SHI_4a == "No outcome" |
                    main_eco_change_SHI_4b == "No outcome" |
                    main_eco_change_SHI_5a == "No outcome" |
                    main_eco_change_SHI_6b == "No outcome" |
                    main_eco_change_SHI_7a == "No outcome" |
                    main_eco_change_SHI_8b == "No outcome" |
                    main_eco_change_SHI_9a == "No outcome" |
                    main_eco_change_SHI_10b == "No outcome" |
                    main_eco_change_SHI_11a == "No outcome" |
                    main_eco_change_SHI_12b == "No outcome" |
                    main_eco_change_SHI_13a == "No outcome" |
                    main_eco_change_SHI_14b == "No outcome" |
                    main_eco_change_SHI_15a == "No outcome" |
                    main_eco_change_SHI_16b == "No outcome"   ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_selfharm_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_SHI) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_SHI_final =
           case_when(main_eco_change_before_SHI == "Change in eco activity after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_SHI == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_SHI ==  "Outcome but no exposure" |
                      main_eco_change_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                      main_eco_change_before_SHI == "Exposure but no outcome" |
                      main_eco_change_before_SHI == "Change in eco activity before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_SHI_final)  

```

Passive suicidal ideation
```{r Change in living situation BEFORE outcome PSS}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_PSS_baseline =
           case_when(exposure_phase_living_situation_change == "Baseline" &
                     outcome_phase_passive_suicidal_ideation == "Baseline" ~ "To drop",
             
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      ( outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" |  
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_PSS_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_passive_suicidal_ideation == "1b" | 
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_PSS_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                         outcome_phase_passive_suicidal_ideation == "1b" ) ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      ( outcome_phase_passive_suicidal_ideation == "2a" |
                         outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_PSS_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "Baseline" |
                          outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" ) ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_passive_suicidal_ideation == "2b" |
                          outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_PSS_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                        outcome_phase_passive_suicidal_ideation == "2b") ~ "To drop", # First experience of outcome occurred PSSfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_passive_suicidal_ideation == "3a" |
                          outcome_phase_passive_suicidal_ideation == "3b" |
                         outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_PSS_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_PSS_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_passive_suicidal_ideation == "Baseline" |
                         outcome_phase_passive_suicidal_ideation == "1a" |
                        outcome_phase_passive_suicidal_ideation == "1b" |
                         outcome_phase_passive_suicidal_ideation == "2a" |
                       outcome_phase_passive_suicidal_ideation == "2b" |
                         outcome_phase_passive_suicidal_ideation == "3a") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_passive_suicidal_ideation == "3b" |
                          outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_PSS_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_PSS_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       ( outcome_phase_passive_suicidal_ideation == "4a" |
                          outcome_phase_passive_suicidal_ideation == "4b" |
                         outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_PSS_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                      outcome_phase_passive_suicidal_ideation == "2b" |
                        outcome_phase_passive_suicidal_ideation == "3a" |
                       outcome_phase_passive_suicidal_ideation == "3b" |
                        outcome_phase_passive_suicidal_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_passive_suicidal_ideation == "4b" |
                          outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_PSS_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_passive_suicidal_ideation == "5a" |
                          outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_PSS_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                       outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       ( outcome_phase_passive_suicidal_ideation == "6b" |
                          outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                         outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_PSS_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    ( outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_PSS_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_PSS_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                       outcome_phase_passive_suicidal_ideation == "6b" |
                         outcome_phase_passive_suicidal_ideation == "7a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    ( outcome_phase_passive_suicidal_ideation == "8b" |
                        outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_PSS_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_PSS_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_passive_suicidal_ideation == "9a" |
                          outcome_phase_passive_suicidal_ideation == "10b" |
                        outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_PSS_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                       outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      ( outcome_phase_passive_suicidal_ideation == "10b" |
                         outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_PSS_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "11a" |
                          outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_PSS_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" | 
                       outcome_phase_passive_suicidal_ideation == "9a" |
                       outcome_phase_passive_suicidal_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_passive_suicidal_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_passive_suicidal_ideation == "11a" | # Co-occurring
                     outcome_phase_passive_suicidal_ideation == "12b"|
                       outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_PSS_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_PSS_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a" |
                       outcome_phase_passive_suicidal_ideation == "12b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_passive_suicidal_ideation == "13a" |
                         outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_12b)

# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_PSS_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_passive_suicidal_ideation == "14b" |
                       outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_PSS_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_passive_suicidal_ideation == "15a" |
                         outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_PSS_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    ( outcome_phase_passive_suicidal_ideation == "16b" |
                       outcome_phase_passive_suicidal_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_15a)



# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_PSS_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_passive_suicidal_ideation == "Baseline" |
                        outcome_phase_passive_suicidal_ideation == "1a" |
                       outcome_phase_passive_suicidal_ideation == "1b" |
                        outcome_phase_passive_suicidal_ideation == "2a" |
                     outcome_phase_passive_suicidal_ideation == "2b" |
                       outcome_phase_passive_suicidal_ideation == "3a" |
                     outcome_phase_passive_suicidal_ideation == "3b" |
                       outcome_phase_passive_suicidal_ideation == "4a" |
                     outcome_phase_passive_suicidal_ideation == "4b" |
                       outcome_phase_passive_suicidal_ideation == "5a" |
                     outcome_phase_passive_suicidal_ideation == "6b" |
                       outcome_phase_passive_suicidal_ideation == "7a" |
                     outcome_phase_passive_suicidal_ideation == "8b" |
                       outcome_phase_passive_suicidal_ideation == "9a" |
                     outcome_phase_passive_suicidal_ideation == "10b" |
                       outcome_phase_passive_suicidal_ideation == "11a"|
                       outcome_phase_passive_suicidal_ideation == "12b" |
                       outcome_phase_passive_suicidal_ideation == "13a" |
                       outcome_phase_passive_suicidal_ideation == "14b" |
                        outcome_phase_passive_suicidal_ideation == "15a" |
                        outcome_phase_passive_suicidal_ideation == "16b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_passive_suicidal_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_PSS_16b)
```

Passive suicidal ideation & change in living situation
```{r Change in eco activity exposure PSS}

dat <- dat %>%
  mutate(living_situation_change_before_PSS =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_PSS_baseline == "To drop" |
                    living_situation_change_PSS_1a == "To drop" |
                    living_situation_change_PSS_1b == "To drop" |
                      living_situation_change_PSS_2a == "To drop" |
                    living_situation_change_PSS_2b == "To drop" |
                      living_situation_change_PSS_3a == "To drop" |
                    living_situation_change_PSS_3b == "To drop" |
                      living_situation_change_PSS_4a == "To drop" |
                    living_situation_change_PSS_4b == "To drop" |
                      living_situation_change_PSS_5a == "To drop" |
                    living_situation_change_PSS_6b == "To drop" |
                      living_situation_change_PSS_7a == "To drop" |
                    living_situation_change_PSS_8b == "To drop" |
                      living_situation_change_PSS_9a == "To drop" |
                    living_situation_change_PSS_10b == "To drop" |
                      living_situation_change_PSS_11a == "To drop" |
                    living_situation_change_PSS_12b == "To drop" |
                    living_situation_change_PSS_13a == "To drop" |
                      living_situation_change_PSS_14b == "To drop" |
                    living_situation_change_PSS_15a == "To drop" |
                      living_situation_change_PSS_16b == "To drop" ~ "Change in living situation after passive suicidal ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_passive_suicidal_ideation == "Not answered or PNTA" ~ "Missing whether experienced passive suicidal ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_PSS_baseline == "Yes" |
                    living_situation_change_PSS_1a == "Yes" |
                    living_situation_change_PSS_1b == "Yes" |
                    living_situation_change_PSS_2a == "Yes" |
                    living_situation_change_PSS_2b == "Yes" |
                    living_situation_change_PSS_3a == "Yes" |
                    living_situation_change_PSS_3b == "Yes" |
                    living_situation_change_PSS_4a == "Yes" |
                    living_situation_change_PSS_4b == "Yes" |
                    living_situation_change_PSS_5a == "Yes" |
                    living_situation_change_PSS_6b == "Yes" |
                    living_situation_change_PSS_7a == "Yes" |
                    living_situation_change_PSS_8b == "Yes" |
                    living_situation_change_PSS_9a == "Yes" |
                    living_situation_change_PSS_10b == "Yes" |
                    living_situation_change_PSS_11a == "Yes" |
                    living_situation_change_PSS_12b == "Yes"|
                    living_situation_change_PSS_13a == "Yes" |
                    living_situation_change_PSS_14b == "Yes" |
                    living_situation_change_PSS_15a == "Yes" |
                    living_situation_change_PSS_16b == "Yes" ~ "Change in living situation before passive suicidal ideation",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_PSS_baseline == "No outcome" |
                    living_situation_change_PSS_1a == "No outcome" |
                    living_situation_change_PSS_1b == "No outcome" |
                    living_situation_change_PSS_2a == "No outcome" |
                    living_situation_change_PSS_2b == "No outcome" |
                    living_situation_change_PSS_3a == "No outcome" |
                    living_situation_change_PSS_3b == "No outcome" |
                    living_situation_change_PSS_4a == "No outcome" |
                    living_situation_change_PSS_4b == "No outcome" |
                    living_situation_change_PSS_5a == "No outcome" |
                    living_situation_change_PSS_6b == "No outcome" |
                    living_situation_change_PSS_7a == "No outcome" |
                    living_situation_change_PSS_8b == "No outcome" |
                    living_situation_change_PSS_9a == "No outcome" |
                    living_situation_change_PSS_10b == "No outcome" |
                    living_situation_change_PSS_11a == "No outcome" |
                    living_situation_change_PSS_12b == "No outcome" |
                    living_situation_change_PSS_13a == "No outcome" |
                    living_situation_change_PSS_14b == "No outcome" |
                    living_situation_change_PSS_15a == "No outcome" |
                    living_situation_change_PSS_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_passive_suicidal_ideation != "Not answered or PNTA" |
                        outcome_phase_passive_suicidal_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_passive_suicidal_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_PSS) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_PSS_final =
           case_when(living_situation_change_before_PSS == "Change in living situation after passive suicidal ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_PSS == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_PSS == "Missing whether experienced passive suicidal ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                       living_situation_change_before_PSS ==  "Outcome but no exposure" |
                      living_situation_change_before_PSS ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_PSS == "Exposure but no outcome" |
                    living_situation_change_before_PSS == "Change in living situation before passive suicidal ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_PSS_final) 
```

Self-harm ideation
```{r Change in living situation BEFORE outcome SHI}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_SHI_baseline =
           case_when( exposure_phase_living_situation_change == "Baseline" & 
                        outcome_phase_selfharm_ideation == "Baseline" ~ "To drop",
                      
                    exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      ( outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |  
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_SHI_1a =
           case_when(
                   exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" ) ~ "To drop", # Outcome before exposure
             
                  exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_selfharm_ideation == "1b" | 
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_SHI_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                         outcome_phase_selfharm_ideation == "1b") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_selfharm_ideation == "2a" |
                         outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_SHI_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "Baseline" |
                          outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_selfharm_ideation == "2b" |
                          outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_SHI_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                        outcome_phase_selfharm_ideation == "2b") ~ "To drop", # First experience of outcome occurred SHIfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_selfharm_ideation == "3a" |
                          outcome_phase_selfharm_ideation == "3b" |
                         outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SHI_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_SHI_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_selfharm_ideation == "Baseline" |
                         outcome_phase_selfharm_ideation == "1a" |
                        outcome_phase_selfharm_ideation == "1b" |
                         outcome_phase_selfharm_ideation == "2a" |
                       outcome_phase_selfharm_ideation == "2b" |
                         outcome_phase_selfharm_ideation == "3a"  ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       ( outcome_phase_selfharm_ideation == "3b" |
                          outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_SHI_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_SHI_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_selfharm_ideation == "4a" |
                          outcome_phase_selfharm_ideation == "4b" |
                         outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_SHI_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                      outcome_phase_selfharm_ideation == "2b" |
                        outcome_phase_selfharm_ideation == "3a" |
                       outcome_phase_selfharm_ideation == "3b" |
                        outcome_phase_selfharm_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_selfharm_ideation == "4b" |
                          outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_SHI_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_selfharm_ideation == "5a" |
                          outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_SHI_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                       outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       ( outcome_phase_selfharm_ideation == "6b" |
                          outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                         outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_SHI_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SHI_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_SHI_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                       outcome_phase_selfharm_ideation == "6b" |
                         outcome_phase_selfharm_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    ( outcome_phase_selfharm_ideation == "8b" |
                        outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_SHI_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_SHI_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_selfharm_ideation == "9a" |
                          outcome_phase_selfharm_ideation == "10b" |
                        outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_SHI_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                       outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_selfharm_ideation == "10b" |
                         outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_SHI_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "11a" |
                          outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_SHI_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" | 
                       outcome_phase_selfharm_ideation == "9a" |
                       outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_selfharm_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_selfharm_ideation == "12b"|
                       outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_SHI_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_SHI_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a" |
                       outcome_phase_selfharm_ideation == "12b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    ( outcome_phase_selfharm_ideation == "13a" |
                         outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_12b)

# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_SHI_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" |
                         outcome_phase_selfharm_ideation == "16b" |
                       outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_SHI_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_selfharm_ideation == "15a" |
                      outcome_phase_selfharm_ideation == "16b" |
                      outcome_phase_selfharm_ideation == "17a") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_SHI_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                       outcome_phase_selfharm_ideation == "15a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                     outcome_phase_selfharm_ideation == "16b"  ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_15a)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_SHI_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_selfharm_ideation == "Baseline" |
                        outcome_phase_selfharm_ideation == "1a" |
                       outcome_phase_selfharm_ideation == "1b" |
                        outcome_phase_selfharm_ideation == "2a" |
                     outcome_phase_selfharm_ideation == "2b" |
                       outcome_phase_selfharm_ideation == "3a" |
                     outcome_phase_selfharm_ideation == "3b" |
                       outcome_phase_selfharm_ideation == "4a" |
                     outcome_phase_selfharm_ideation == "4b" |
                       outcome_phase_selfharm_ideation == "5a" |
                     outcome_phase_selfharm_ideation == "6b" |
                       outcome_phase_selfharm_ideation == "7a" |
                     outcome_phase_selfharm_ideation == "8b" |
                       outcome_phase_selfharm_ideation == "9a" |
                     outcome_phase_selfharm_ideation == "10b" |
                       outcome_phase_selfharm_ideation == "11a"|
                       outcome_phase_selfharm_ideation == "12b" |
                       outcome_phase_selfharm_ideation == "13a" |
                       outcome_phase_selfharm_ideation == "14b" |
                        outcome_phase_selfharm_ideation == "15a" |
                        outcome_phase_selfharm_ideation == "16b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_selfharm_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_SHI_16b)
```

Self-harm ideation & change in living situation
```{r Change in eco activity exposure SHI}

dat <- dat %>%
  mutate(living_situation_change_before_SHI =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_SHI_baseline == "To drop" |
                    living_situation_change_SHI_1a == "To drop" |
                    living_situation_change_SHI_1b == "To drop" |
                      living_situation_change_SHI_2a == "To drop" |
                    living_situation_change_SHI_2b == "To drop" |
                      living_situation_change_SHI_3a == "To drop" |
                    living_situation_change_SHI_3b == "To drop" |
                      living_situation_change_SHI_4a == "To drop" |
                    living_situation_change_SHI_4b == "To drop" |
                      living_situation_change_SHI_5a == "To drop" |
                    living_situation_change_SHI_6b == "To drop" |
                      living_situation_change_SHI_7a == "To drop" |
                    living_situation_change_SHI_8b == "To drop" |
                      living_situation_change_SHI_9a == "To drop" |
                    living_situation_change_SHI_10b == "To drop" |
                      living_situation_change_SHI_11a == "To drop" |
                    living_situation_change_SHI_12b == "To drop" |
                    living_situation_change_SHI_13a == "To drop" |
                      living_situation_change_SHI_14b == "To drop" |
                    living_situation_change_SHI_15a == "To drop" |
                      living_situation_change_SHI_16b == "To drop"~ "Change in living situation after self-harm ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_selfharm_ideation == "Not answered or PNTA" ~ "Missing whether experienced self-harm ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_SHI_baseline == "Yes" |
                    living_situation_change_SHI_1a == "Yes" |
                    living_situation_change_SHI_1b == "Yes" |
                    living_situation_change_SHI_2a == "Yes" |
                    living_situation_change_SHI_2b == "Yes" |
                    living_situation_change_SHI_3a == "Yes" |
                    living_situation_change_SHI_3b == "Yes" |
                    living_situation_change_SHI_4a == "Yes" |
                    living_situation_change_SHI_4b == "Yes" |
                    living_situation_change_SHI_5a == "Yes" |
                    living_situation_change_SHI_6b == "Yes" |
                    living_situation_change_SHI_7a == "Yes" |
                    living_situation_change_SHI_8b == "Yes" |
                    living_situation_change_SHI_9a == "Yes" |
                    living_situation_change_SHI_10b == "Yes" |
                    living_situation_change_SHI_11a == "Yes" |
                    living_situation_change_SHI_12b == "Yes"|
                    living_situation_change_SHI_13a == "Yes" |
                    living_situation_change_SHI_14b == "Yes" |
                    living_situation_change_SHI_15a == "Yes" |
                    living_situation_change_SHI_16b == "Yes" ~ "Change in living situation before self-harm ideation",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_SHI_baseline == "No outcome" |
                    living_situation_change_SHI_1a == "No outcome" |
                    living_situation_change_SHI_1b == "No outcome" |
                    living_situation_change_SHI_2a == "No outcome" |
                    living_situation_change_SHI_2b == "No outcome" |
                    living_situation_change_SHI_3a == "No outcome" |
                    living_situation_change_SHI_3b == "No outcome" |
                    living_situation_change_SHI_4a == "No outcome" |
                    living_situation_change_SHI_4b == "No outcome" |
                    living_situation_change_SHI_5a == "No outcome" |
                    living_situation_change_SHI_6b == "No outcome" |
                    living_situation_change_SHI_7a == "No outcome" |
                    living_situation_change_SHI_8b == "No outcome" |
                    living_situation_change_SHI_9a == "No outcome" |
                    living_situation_change_SHI_10b == "No outcome" |
                    living_situation_change_SHI_11a == "No outcome" |
                    living_situation_change_SHI_12b == "No outcome" |
                    living_situation_change_SHI_13a == "No outcome" |
                    living_situation_change_SHI_14b == "No outcome" |
                    living_situation_change_SHI_15a == "No outcome" |
                    living_situation_change_SHI_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_selfharm_ideation != "Not answered or PNTA" |
                        outcome_phase_selfharm_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_selfharm_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_SHI) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_SHI_final =
           case_when(living_situation_change_before_SHI == "Change in living situation after self-harm ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_SHI == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_SHI == "Missing whether experienced self-harm ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                      living_situation_change_before_SHI ==  "Outcome but no exposure" |
                      living_situation_change_before_SHI ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_SHI == "Exposure but no outcome" |
                    living_situation_change_before_SHI == "Change in living situation before self-harm ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_SHI_final) 
```

## Self-harm ideation
```{r self-harm ideation correlation matrix}
# Select items for correlation matrix
SHI_dat_corr_mat <- dat_dummy %>%
  select(
   "Man" = "gender_cleaned_Man",
   "Woman" = "gender_cleaned_Woman",
   "Minoritised_gender" = "gender_cleaned_Minoritised gender",
   "16-25" = "age_category_COVID_baseline_16-25",
   "26-35" = "age_category_COVID_baseline_26-35",
   "36-45" = "age_category_COVID_baseline_36-45",
   "46-55" = "age_category_COVID_baseline_46-55",
   "56-65" = "age_category_COVID_baseline_56-65",
   "66-70" =  "age_category_COVID_baseline_66-70",
   "71+" = "age_category_COVID_baseline_71+",
   "White" = "race_binary_White",
   "A-Levels_higher" = "A_Levels_higher_Yes",
   "Not_A-Levels_higher" = "A_Levels_higher_No",
   "Education_not_finished" = "A_Levels_higher_Education not finished",
   "Psych_disorder" ="mental_health_diagnosis_Psychiatric disorder",
   "Key_worker" ="paid_employment_key_worker_Key worker",
   "Employed_not_key"  = "paid_employment_key_worker_Paid employment",
   "Unemployed" = "paid_employment_key_worker_Not paid employment",
   "Student" = "paid_employment_key_worker_Student",
   "Retired"= "paid_employment_key_worker_Retired",
   "Vulnerable_group" = "vulnerable_group_member_Yes",
   "Positive_COVID_test" = "positive_covid_test_before_BE_final_Yes",
   "Loss" = "lost_someone_before_BE_final_Yes",
   "Lonelier_during_pandemic" = "increased_loneliness_during_pandemic_Yes",
   "Change_main_eco" = "main_eco_change_before_BE_final_Yes",
   "Change_living_sit" ="living_situation_change_before_BE_final_Yes",
   "pan_worry" = "panworry_total_score"
 ) 

# Run correlation analyses with continious and dichotomous variables 
SHI_corr_mat_object <- psych::mixedCor(data=SHI_dat_corr_mat,
         c= 29,  # Continuous variables
         p= NULL,
         d= 1:28, # Dichotomous variable
             use="pairwise.complete.obs")


# Save correlation matrix in an object
SHI_corr_mat_object_matrix <- SHI_corr_mat_object$rho

# Write file path to save plot
png(file = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/plots/correlations/SHI_exposures_corr_matrix.png")

# Create correlation matrix with hierarchical clustering
corrplot::corrplot(SHI_corr_mat_object_matrix, 
         method = "color", # objects to represent the correlations on plot
         type = "lower", # only use the lower triangle of the matrix
         diag = FALSE, # do not show the correlations on the diagonal
         addgrid.col = NA,
         addCoef.col = "black", # colour for the correlation coefficients in the plot
         tl.cex = 0.5,
         order = "hclust",
         tl.col = "black",
         cl.align.text = "c",
         col=colorRampPalette(c("dodgerblue4","white","firebrick4"))(200), # colours for correlations
         number.font = 0.1,
         number.cex = 0.4,
         sig.level = 0.01, # Choose significant level
         insig = "blank", # Nonsignificant correlations have no colour,
         bg = "white"
         )

# Save plot
dev.off()
```

Take the LATER data entry from people who answered twice within a single phase 
```{r Later date entry twice in single phase RAMP demographics}
if(RAMP == TRUE) {
# Confirm number of rows in current dataset 
nrow(dat.raw.dem.ramp.followup)

# Filter out duplicated IDs AND phase, keeping the LAST entry
dat.raw.dem.ramp.followup <- dat.raw.dem.ramp.followup %>% 
    group_by(ID) %>% 
    filter(!duplicated(wave_dem,
                      fromLast = TRUE)
           )
# Confirm number of rows in dataset after filtering 
nrow(dat.raw.dem.ramp.followup)
}
```

# Passive suicial ideation - minimal model
Age, gender, race, education, psych disorder, prepandemic experience
```{r Passive suicial ideation minimal model}
model3 <- glm(NEW_passive_suicidal_ideation_pandemic ~ age_category_COVID_baseline + gender_cleaned + race_binary+ psych_disorder_factor+ highest_education,
               data = dat,
               family = "binomial")

tidy(model3,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model3) %>% 
  length() 

# How many people in this model have the outcome? 
dat %>%
   filter(!is.na(age_category_COVID_baseline) & 
          !is.na(gender_cleaned) &
            !is.na(race_binary) & 
             !is.na(NEW_passive_suicidal_ideation_pandemic) &
             !is.na(highest_education) &
             !is.na(psych_disorder_factor)) %>%
   freq(NEW_passive_suicidal_ideation_pandemic)
```

Plot
```{r Passive suicial ideation minimal model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_passive_suicidal_ideation" = "NEW_passive_suicidal_ideation_pandemic",
         "Education" = "highest_education",
         "Psych_disorder" = "psych_disorder_factor")

# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "Education",
                 "Psych_disorder")


dependent <- "Pandemic_passive_suicidal_ideation"


PSS_minimal_dat_plot <- dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Passive suicidal ideation during pandemic",
          remove_ref = TRUE)
```


```{r Save PSS minimal level plot}
ggsave(
  paste0("PSS_minimal_dat_plot",
                    date,
                    ".png"),
  plot = PSS_minimal_dat_plot,
  device = "png", 
  path = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/plots/minimal", 
  scale = 1,
  width = 25,
  height = 12,
  units = "cm"
  )
```
# Self-harm ideation - minimal model
Age, gender, race, education, psych disorder, prepandemic experience
```{r Self-harm ideation minimal model}
model4 <- glm(NEW_selfharm_ideation_pandemic ~ age_category_COVID_baseline + gender_cleaned + race_binary+ highest_education + psych_disorder_factor,
               data = dat,
               family = "binomial")

tidy(model4,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model4) %>% 
  length()

# How many people in this model have the outcome? n = 11,639 (of 32046)
dat %>%
   filter(!is.na(age_category_COVID_baseline) & 
          !is.na(gender_cleaned) &
            !is.na(race_binary) & 
             !is.na(NEW_selfharm_ideation_pandemic) &
             !is.na(highest_education) &
             !is.na(psych_disorder_factor)) %>%
   freq(NEW_selfharm_ideation_pandemic)
```

Plot
```{r Self-harm ideation minimal model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_selfharm_ideation" = "NEW_selfharm_ideation_pandemic",
        "Education" = "highest_education",
         "Psych_disorder" = "psych_disorder_factor")

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "Education",
                 "Psych_disorder")

dependent <- "Pandemic_selfharm_ideation"

SHI_minimal_dat_plot <- dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm ideation during pandemic",
          remove_ref = TRUE)
```

```{r Save SHI minimal level plot}
ggsave(
  paste0("SHI_minimal_dat_plot",
                    date,
                    ".png"),
  plot = SHI_minimal_dat_plot,
  device = "png", 
  path = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/plots/minimal", 
  scale = 1,
  width = 25,
  height = 12,
  units = "cm"
  )
```

# Passive suicidal ideation - extended model
Age, gender, race, education, psych disorder, key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation
```{r Passive suicidal ideation extended model}
model8 <- glm(NEW_passive_suicidal_ideation_pandemic ~ age_category_COVID_baseline + 
                 gender_cleaned + 
                 race_binary + 
                 highest_education + 
                 psych_disorder_factor + 
                 paid_employment_key_worker + 
                 vulnerable_group_member + 
                 panworry_total_score + 
                 positive_covid_test_before_PSS_final + 
                 lost_someone_before_PSS_final + 
                 increased_loneliness_during_pandemic +
                 main_eco_change_before_PSS_final +
                 living_situation_change_before_PSS_final,
               data = dat,
               family = "binomial")

tidy(model8,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model8) %>% 
  length()

# How many people in this model have the outcome? n = 5170 (of 8663)
dat %>%
   filter( !is.na(age_category_COVID_baseline) & 
             !is.na(gender_cleaned) &
             !is.na(race_binary) & 
             !is.na(NEW_passive_suicidal_ideation_pandemic) &
             !is.na(highest_education) &
             !is.na(psych_disorder_factor) &
             !is.na(paid_employment_key_worker) & 
             !is.na(vulnerable_group_member) &
             !is.na(panworry_total_score) & 
             !is.na(positive_covid_test_before_BE_final) &
             !is.na(increased_loneliness_during_pandemic) &
             !is.na(main_eco_change_before_BE_final)  &
             !is.na(increased_loneliness_during_pandemic) &
             !is.na(living_situation_change_before_BE_final)
          ) %>%
   freq(NEW_passive_suicidal_ideation_pandemic)
```


Plot
```{r Passive suicidal ideation extended model plot}
dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_suicidal_ideation" = "NEW_passive_suicidal_ideation_pandemic",
         "Education" = "highest_education",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "paid_employment_key_worker",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score",
         "Covid_test" = "positive_covid_test_before_PSS_final",
         "Loss" = "lost_someone_before_PSS_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_PSS_final",
         "Living_sit_change" = "living_situation_change_before_PSS_final"
         
        )

# 1. Plot
explanatory <- c("Age",
                "Gender",
                 "Race",
                 "Education",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")

dependent <- "Pandemic_suicidal_ideation"

PSS_extended_dat_plot <- dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Passive suicidal ideation during pandemic",
           remove_ref = FALSE) 
```

```{r Save PSS extended level plot}
ggsave(
  paste0("PSS_extended_dat_plot",
                    date,
                    ".png"),
  plot = PSS_extended_dat_plot,
  device = "png", 
  path = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/plots/extended", 
  scale = 1,
  width = 25,
 height = 20,
  units = "cm"
  )
```

# Self-harm ideation - extended model
Age, gender, race, education, psych disorder, key worker/employment status, vulnerable group member, pandemic worry, positive COVID test, loss of loved one, lonelieness, change in main eco activity, change in living situation
```{r Self-harm ideation extended model}
model9 <- glm(NEW_selfharm_ideation_pandemic ~ age_category_COVID_baseline + 
                 gender_cleaned + 
                 race_binary + 
                 highest_education + 
                 psych_disorder_factor + 
                 paid_employment_key_worker + 
                 vulnerable_group_member + 
                 panworry_total_score + 
                 positive_covid_test_before_SHI_final + 
                 lost_someone_before_SHI_final + 
                 increased_loneliness_during_pandemic + 
                 main_eco_change_before_SHI_final + 
                 living_situation_change_before_SHI_final,
               data = dat,
               family = "binomial")

tidy(model9,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model9) %>% 
  length()

# How many people in this model have the outcome? n = 3647 (of 8645)
dat %>%
   filter( !is.na(age_category_COVID_baseline) & 
             !is.na(gender_cleaned) &
             !is.na(race_binary) & 
             !is.na(NEW_selfharm_ideation_pandemic) &
             !is.na(highest_education) &
             !is.na(psych_disorder_factor) &
             !is.na(paid_employment_key_worker) & 
             !is.na(vulnerable_group_member) &
             !is.na(panworry_total_score) & 
             !is.na(positive_covid_test_before_BE_final) &
             !is.na(increased_loneliness_during_pandemic) &
             !is.na(main_eco_change_before_BE_final)  &
             !is.na(increased_loneliness_during_pandemic) &
             !is.na(living_situation_change_before_BE_final)
          ) %>%
   freq(NEW_selfharm_ideation_pandemic)
```

Plot
```{r Self-harm ideation extended model plot}

dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_selfharm_ideation" = "NEW_selfharm_ideation_pandemic",
         "Education" = "highest_education",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "paid_employment_key_worker",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score",
         "Covid_test" = "positive_covid_test_before_SHI_final",
         "Loss" = "lost_someone_before_SHI_final",
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_SHI_final",
         "Living_sit_change" = "living_situation_change_before_SHI_final"
         
        )

#1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "Education",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change")

dependent <- "Pandemic_selfharm_ideation"

SHI_extended_dat_plot <- dat_plot %>%
  finalfit::or_plot(dependent, explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 13,
          dependent_label = "Self-harm ideation during pandemic",
          remove_ref = FALSE) 
```

```{r Save SHI extended level plot}
ggsave(
  paste0("SHI_extended_dat_plot",
                    date,
                    ".png"),
  plot = SHI_extended_dat_plot,
  device = "png", 
  path = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/plots/extended", 
  scale = 1,
  width = 25,
  height = 20,
  units = "cm"
  )
```

## At least 3 nos: passive suicidal ideation - extended model
```{r sens analysis 3 nos passive suicidal ideation extended model}
model13 <- glm(sens_NEW_passive_suicidal_ideation_pandemic ~  
                 age_category_COVID_baseline +
                 gender_cleaned +
                 race_binary +
                 highest_education +
                 psych_disorder_factor +
                 paid_employment_key_worker +
                 vulnerable_group_member +
                 panworry_total_score + 
                 positive_covid_test_before_PSS_final +
                 lost_someone_before_PSS_final +
                 increased_loneliness_during_pandemic +
                 main_eco_change_before_PSS_final +
                 living_situation_change_before_PSS_final,
                 data = dat,
                 family = "binomial"
              )

tidy(model13,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model13) %>% 
  length()
```

Plot
```{r passive suicidal ideation extended model plot}
sens_dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_passive_suicidal_ideation" = "sens_NEW_passive_suicidal_ideation_pandemic",
         "Education" = "highest_education",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "paid_employment_key_worker",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score",
         "Covid_test" = "positive_covid_test_before_PSS_final", 
         "Loss" = "lost_someone_before_PSS_final", 
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_PSS_final", 
         "Living_sit_change" = "living_situation_change_before_PSS_final"
        )


# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "Education",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change"
               )

dependent <- "Pandemic_passive_suicidal_ideation"

sens_PSS_extended_dat_plot <- sens_dat_plot %>%
  finalfit::or_plot(dependent,
                    explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "Sens analysis: New experience of passive suicidal ideation during pandemic",
          remove_ref = FALSE) 
```

```{r Save PSS extended level plot}
ggsave(
  paste0("sens_PSS_3_nos_extended_dat_plot",
                    date,
                    ".png"),
  plot = sens_PSS_extended_dat_plot,
  device = "png", 
  path = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/plots/sensitivity", 
  scale = 1,
  width = 25,
  height = 20,
  units = "cm"
  )
```

## At least 3 nos: self-harm ideation - extended model
```{r sens analysis 3 nos self-harm ideation extended model}
model14 <- glm(sens_NEW_selfharm_ideation_pandemic ~  
                 age_category_COVID_baseline +
                 gender_cleaned +
                 race_binary +
                 highest_education +
                 psych_disorder_factor +
                 paid_employment_key_worker +
                 vulnerable_group_member +
                 panworry_total_score + 
                 positive_covid_test_before_SHI_final +
                 lost_someone_before_SHI_final +
                 increased_loneliness_during_pandemic +
                 main_eco_change_before_SHI_final +
                 living_situation_change_before_SHI_final,
                 data = dat,
                 family = "binomial"
              )

tidy(model14,
     conf.int=TRUE,
     exponentiate=TRUE)

fitted(model14) %>% 
  length()
```

Plot
```{r self-harm ideation extended model plot}
sens_dat_plot <- dat %>%
  select("Age" = "age_category_COVID_baseline",
         "Gender" = "gender_cleaned",
         "Race" = "race_binary",
         "Pandemic_selfharm_ideation" = "sens_NEW_selfharm_ideation_pandemic",
         "Education" = "highest_education",
         "Psych_disorder" = "psych_disorder_factor",
         "Employment" = "paid_employment_key_worker",
         "Vulnerable_group_member" ="vulnerable_group_member",
         "Pandemic_worry" = "panworry_total_score",
         "Covid_test" = "positive_covid_test_before_SHI_final", 
         "Loss" = "lost_someone_before_SHI_final", 
         "Increased_loneliness" = "increased_loneliness_during_pandemic",
         "Main_eco_act_change" = "main_eco_change_before_SHI_final", 
         "Living_sit_change" = "living_situation_change_before_SHI_final"
        )


# 1. Plot
explanatory <- c("Age",
                 "Gender",
                 "Race",
                 "Education",
                 "Psych_disorder",
                 "Employment",
                 "Vulnerable_group_member",
                 "Pandemic_worry",
                 "Covid_test",
                 "Loss",
                 "Increased_loneliness",
                 "Main_eco_act_change",
                 "Living_sit_change"
               )

dependent <- "Pandemic_selfharm_ideation"

sens_SHI_extended_dat_plot <- sens_dat_plot %>%
  finalfit::or_plot(dependent,
                    explanatory, 
          breaks = c(0.5, 1, 5, 10, 20, 30),
          table_text_size = 3.0,
          title_text_size = 15,
          dependent_label = "Sens analysis: New experience of self-harm ideation during pandemic",
          remove_ref = FALSE) 
```

```{r Save SHI extended level plot}
ggsave(
  paste0("sens_SHI_3_nos_extended_dat_plot",
                    date,
                    ".png"),
  plot = sens_SHI_extended_dat_plot,
  device = "png", 
  path = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/plots/sensitivity", 
  scale = 1,
  width = 25,
  height = 20,
  units = "cm"
  )
```


                    ((taf.worth_living_life_people_.Wavebaseline == "No" | is.na(taf.worth_living_life_people_.Wavebaseline)) &
                       (taf.worth_living_life_people_.Wave_1a == "No" | is.na(taf.worth_living_life_people_.Wave_1a)) &
                       (taf.worth_living_life_people_.Wave_1b == "No" | is.na(taf.worth_living_life_people_.Wave_1b)) &
                       (taf.worth_living_life_people_.Wave_2a == "No" | is.na(taf.worth_living_life_people_.Wave_2a)) &
                       (taf.worth_living_life_people_.Wave_2b == "No" | is.na(taf.worth_living_life_people_.Wave_2b)) &
                       (taf.worth_living_life_people_.Wave_3a == "No" | is.na(taf.worth_living_life_people_.Wave_3a)) &
                       (taf.worth_living_life_people_.Wave_3b == "No" | is.na(taf.worth_living_life_people_.Wave_3b)) &
                       (taf.worth_living_life_people_.Wave_4a == "No" | is.na(taf.worth_living_life_people_.Wave_4a)) &
                       (taf.worth_living_life_people_.Wave_4b == "No" | is.na(taf.worth_living_life_people_.Wave_4b)) &
                       (taf.worth_living_life_people_.Wave_5a == "No" | is.na(taf.worth_living_life_people_.Wave_5a)) &
                       (taf.worth_living_life_people_.Wave_6b == "No" | is.na(taf.worth_living_life_people_.Wave_6b)) &
                       (taf.worth_living_life_people_.Wave_7a == "No" | is.na(taf.worth_living_life_people_.Wave_7a)) &
                       (taf.worth_living_life_people_.Wave_8b == "No" | is.na(taf.worth_living_life_people_.Wave_8b)) &
                       (taf.worth_living_life_people_.Wave_9a == "No" | is.na(taf.worth_living_life_people_.Wave_9a)) &
                       (taf.worth_living_life_people_.Wave_10b == "No" | is.na(taf.worth_living_life_people_.Wave_10b)) &
                       (taf.worth_living_life_people_.Wave_11a == "No" | is.na(taf.worth_living_life_people_.Wave_11a)) &
                       (taf.worth_living_life_people_.Wave_12b == "No" | is.na(taf.worth_living_life_people_.Wave_12b)) &
                       (taf.worth_living_life_people_.Wave_13a == "No" | is.na(taf.worth_living_life_people_.Wave_13a)) &
                       (taf.worth_living_life_people_.Wave_14b == "No" | is.na(taf.worth_living_life_people_.Wave_14b)) &
                       (taf.worth_living_life_people_.Wave_15a == "No" | is.na(taf.worth_living_life_people_.Wave_15a)) &
                       (taf.worth_living_life_people_.Wave_16b == "No" | is.na(taf.worth_living_life_people_.Wave_16b))) ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases). Answer options include PTNA.
                    
                    
                     ((taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a)) &                        (taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_12b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b)) &
                         (taf.have_you_contemplated_harming_yourself_.Wave_13a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_14b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_15a == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a)) &
                       (taf.have_you_contemplated_harming_yourself_.Wave_16b == "No" | is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b))) 
                    ~ 0 # "No" at least once and never said "Yes"
                    
                    
                    
                      ((taf.meant_life_end_weeks_.Wavebaseline == "No" | is.na(taf.meant_life_end_weeks_.Wavebaseline)) &
                       (taf.meant_life_end_weeks_.Wave_1a == "No" | is.na(taf.meant_life_end_weeks_.Wave_1a)) &
                       (taf.meant_life_end_weeks_.Wave_1b == "No" | is.na(taf.meant_life_end_weeks_.Wave_1b)) &
                       (taf.meant_life_end_weeks_.Wave_2a == "No" | is.na(taf.meant_life_end_weeks_.Wave_2a)) &
                       (taf.meant_life_end_weeks_.Wave_2b == "No" | is.na(taf.meant_life_end_weeks_.Wave_2b)) &
                       (taf.meant_life_end_weeks_.Wave_3a == "No" | is.na(taf.meant_life_end_weeks_.Wave_3a)) &
                       (taf.meant_life_end_weeks_.Wave_3b == "No" | is.na(taf.meant_life_end_weeks_.Wave_3b)) &
                       (taf.meant_life_end_weeks_.Wave_4a == "No" | is.na(taf.meant_life_end_weeks_.Wave_4a)) &
                       (taf.meant_life_end_weeks_.Wave_4b == "No" | is.na(taf.meant_life_end_weeks_.Wave_4b)) &
                       (taf.meant_life_end_weeks_.Wave_5a == "No" | is.na(taf.meant_life_end_weeks_.Wave_5a)) &
                       (taf.meant_life_end_weeks_.Wave_6b == "No" | is.na(taf.meant_life_end_weeks_.Wave_6b)) &
                       (taf.meant_life_end_weeks_.Wave_7a == "No" | is.na(taf.meant_life_end_weeks_.Wave_7a)) &
                       (taf.meant_life_end_weeks_.Wave_8b == "No" | is.na(taf.meant_life_end_weeks_.Wave_8b)) &
                       (taf.meant_life_end_weeks_.Wave_9a == "No" | is.na(taf.meant_life_end_weeks_.Wave_9a)) &
                       (taf.meant_life_end_weeks_.Wave_10b == "No" | is.na(taf.meant_life_end_weeks_.Wave_10b)) &
                       (taf.meant_life_end_weeks_.Wave_11a == "No" | is.na(taf.meant_life_end_weeks_.Wave_11a)) &
                       (taf.meant_life_end_weeks_.Wave_12b == "No" | is.na(taf.meant_life_end_weeks_.Wave_12b)) &
                       (taf.meant_life_end_weeks_.Wave_13a == "No" | is.na(taf.meant_life_end_weeks_.Wave_13a)) &
                       (taf.meant_life_end_weeks_.Wave_14b == "No" | is.na(taf.meant_life_end_weeks_.Wave_14b)) &
                       (taf.meant_life_end_weeks_.Wave_15a == "No" | is.na(taf.meant_life_end_weeks_.Wave_15a)) &
                       (taf.meant_life_end_weeks_.Wave_16b == "No" | is.na(taf.meant_life_end_weeks_.Wave_16b))) 
                   ~ 0 # Said "No" to at least one phase and never said "Yes"
