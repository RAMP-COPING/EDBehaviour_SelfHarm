---
title: "Deriving variables: Low weight"
author: "Helena Davies"
date: "21/02/2022"
output: html_document
---

This script derives variables for the low weight phenotype ready for regression analyses.
Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Read in file with path to data channel
```{r Read in file with path to data channel}
source(file = "../credentials/paths.R")
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = paste0(filepath_functions, "add_numeric.R"))
source(file = paste0(filepath_functions, "remove_duplicates.R"))
source(file = paste0(filepath_functions, "package_check.R"))
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

# Read in data
```{r Read in dataset}
dat_exposure_info <- readRDS(paste0(filepath_saved_data, "exposures_all_models2022-04-28.rds"))
dat_all_info <- readRDS(paste0(filepath_saved_data, "final_dat_no_dup_entries2022-02-21.rds"))

# Merge
dat <- dplyr::full_join(dat_all_info,
                        dat_exposure_info,
                        by ="ID")
```

# Outcome = Low weight
## Derive ANY low weight during the COVID-19 pandemic
```{r Derive ANY low weight during pandemic}
dat <- dat %>%
  mutate(pandemic_low_weight =
           case_when(ed_scid5.weigh_weighed_past_month_.Wavebaseline == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "Yes" ~ 1, # Answered yes at least once to the low weight screener
                     
                  is.na(ed_scid5.weigh_weighed_past_month_.Wavebaseline) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b) ~ NA_real_, # Captures anyone who did not answer any of the low weight screeners at any phase
                     
                  ed_scid5.weigh_weighed_past_month_.Wavebaseline == "No" |
                       ed_scid5.weigh_weighed_past_month_.Wave_1b == "No" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "No" | 
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "No"  ~ 0 # Captures anyone who has at least one "No" and never said "Yes" and is not NA for all phases (answer options are only "Yes" or "No")
                    
           )
  )

# Check
dat %>%
  freq(pandemic_low_weight)


# Check NAs
dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wavebaseline)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_1b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_2b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_3b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_4b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_6b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_8b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_10b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_12b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_14b)

dat %>%
  filter(is.na(pandemic_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_16b)


# Look at people who answered EVERY phase
dat <- dat %>%
  mutate(pandemic_low_weight_every_phase =
           case_when(ed_scid5.weigh_weighed_past_month_.Wavebaseline == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "Yes" ~ 1, 
             
                  is.na(ed_scid5.weigh_weighed_past_month_.Wavebaseline) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b) ~ NA_real_, 
                     
                   ed_scid5.weigh_weighed_past_month_.Wavebaseline == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_1b == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "No" & 
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "No" &
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "No" & 
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "No"  ~ 0 
                    
           )
  )

# Check
dat %>%
  freq(pandemic_low_weight_every_phase)
```

NEW low weight experience, i.e., those who at baseline indicated no lifetime experience of binge eating
```{r Derive NEW low weight experience during pandemic}
dat <- dat %>%
  mutate(NEW_low_weight_pandemic =
           case_when( 
                  # No lifetime low weight at baseline...
                   lifetime_low_weight_baseline_numeric == 0 & 
               
                 #... but occurred at least once during the pandemic
                     (pandemic_low_weight == 1 |
                     pandemic_low_weight_derived == 1)  # as identified in the script "2.Baseline_ED_groupings" 
                        ~ 1,
                     
                     lifetime_low_weight_baseline_numeric == 0 &  # No lifetime low weight at baseline, and no low weight during the pandemic
                     pandemic_low_weight == 0 ~ 0
            )
  )

dat %>%
  freq(NEW_low_weight_pandemic) # NAs are because the sample is restricted to those who did NOT report low weight at baseline

# Check NAs
dat %>%
  filter(is.na(NEW_low_weight_pandemic) &
           lifetime_low_weight_baseline_numeric == 0) %>% # Only interested in those with no prepan experience
  freq(pandemic_low_weight)


# Look at people who answered EVERY phase
dat <- dat %>%
  mutate(NEW_low_weight_pandemic_every_phase =
           case_when( 
                  # No lifetime low weight at baseline...
                   lifetime_low_weight_baseline_numeric == 0 & 
               
                 #... but occurred at least once during the pandemic
                     (pandemic_low_weight_every_phase == 1 |
                       pandemic_low_weight_derived == 1)  # as identified in the script "2.Baseline_ED_groupings" 
                        ~ 1,
                     
                     lifetime_low_weight_baseline_numeric == 0 &  # No lifetime low weight at baseline, and no low weight during the pandemic at EVERY phase
                     pandemic_low_weight_every_phase == 0 ~ 0
            )
  )

dat %>%
  freq(NEW_low_weight_pandemic_every_phase) # NAs are because the sample is restricted to those who did NOT report low weight at baseline
```
## Sensitivity analysis: No at least 3 times
```{r sensitivity analysis low weight no 3 times}
# Create score of number of Nos
dat <- dat %>%
  mutate(low_weight_baseline_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wavebaseline == "No" ~ 1))

dat <- dat %>%
  mutate(low_weight_wave1b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_1b == "No" ~ 1))
  
dat <- dat %>%
  mutate(low_weight_wave2b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_2b == "No" ~ 1))
  
dat <- dat %>%
  mutate(low_weight_wave3b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_3b == "No" ~ 1))
  
dat <- dat %>%
  mutate(low_weight_wave4b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_4b == "No" ~ 1))

dat <- dat %>%
  mutate(low_weight_wave6b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_6b == "No" ~ 1))

dat <- dat %>%
  mutate(low_weight_wave8b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_8b == "No" ~ 1))

dat <- dat %>%
  mutate(low_weight_wave10b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_10b == "No" ~ 1))

dat <- dat %>%
  mutate(low_weight_wave12b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_12b == "No" ~ 1))

dat <- dat %>%
  mutate(low_weight_wave14b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_14b == "No" ~ 1))

dat <- dat %>%
  mutate(low_weight_wave16b_no =
           case_when(ed_scid5.weigh_weighed_past_month_.Wave_16b == "No" ~ 1))

# Row sum
dat$LW_number_of_nos <- rowSums(dat[ ,
                                 c("low_weight_baseline_no",
                                   "low_weight_wave1b_no",
                                   "low_weight_wave2b_no",
                                   "low_weight_wave3b_no",
                                   "low_weight_wave4b_no",
                                   "low_weight_wave6b_no",
                                   "low_weight_wave8b_no",
                                   "low_weight_wave10b_no",
                                   "low_weight_wave12b_no",
                                   "low_weight_wave14b_no",
                                   "low_weight_wave16b_no")],
                                    na.rm = TRUE)

# Check 
dat %>%
  freq(LW_number_of_nos)
```

Sensitivity analysis: NEW low weight experience 
```{r sens analysis derive NEW low weight experience}
dat <- dat %>%
  mutate(sens_pandemic_low_weight =
           case_when(ed_scid5.weigh_weighed_past_month_.Wavebaseline == "Yes" |
             ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_14b == "Yes" |
                       ed_scid5.weigh_weighed_past_month_.Wave_16b == "Yes" ~ 1, # Answered yes at least once to the low weight screener
                     
             is.na(ed_scid5.weigh_weighed_past_month_.Wavebaseline) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b) ~ NA_real_, # Captures anyone who did not answer any of the low weight screeners at any phase
                     
                       LW_number_of_nos >= 3 ~ 0 # at least 3 nos

           )
  )

# Check
dat %>%
  freq(sens_pandemic_low_weight)


dat <- dat %>%
  mutate(sens_NEW_low_weight_pandemic =
           case_when(
                      lifetime_low_weight_baseline_numeric == 0 & 
                     (sens_pandemic_low_weight == 1  | # as identified above
                      pandemic_low_weight_derived == 1)  # as identified in the script "2.Baseline_ED_groupings"
                     ~ 1,
                     
                     lifetime_low_weight_baseline_numeric == 0 &  
                     sens_pandemic_low_weight == 0 ~ 0
           )
  )

dat %>%
  freq(sens_NEW_low_weight_pandemic) 

# Check NAs
dat %>%
  filter(is.na(sens_NEW_low_weight_pandemic) &
           lifetime_low_weight_baseline_numeric == 0) %>% # Only interested in those with no prepan experience
  freq(sens_pandemic_low_weight)
```

# Identify at which phase they first experienced the outcome
This is for ensuring the exposure is reported either BEFORE or in the SAME PHASE as the outcome. E.g,. we do not want to include cases of binge eating (for example) if they exposure (e.g., living situation change) was self-reported AFTER the binge eating.
First, need to identify at which phase participants first experienced each outcome, to ensure that their experience of the exposure happened BEFORE the outcome.

Low weight
```{r Identify phase at which outcome first experienced - low weight}
dat <- dat %>%
  mutate(outcome_phase_low_weight =
           case_when( is.na(ed_scid5.weigh_weighed_past_month_.Wavebaseline ) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_1b ) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_2b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_3b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_4b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_6b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_8b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_10b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_12b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_14b) &
                       is.na(ed_scid5.weigh_weighed_past_month_.Wave_16b) ~ "Not answered", 
                     
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wavebaseline ==  "Yes") ~ "Baseline",
                 (NEW_low_weight_pandemic == 1 & # New experience
                     pandemic_low_weight_derived ==  1) ~ "Baseline",
                     (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_1b == "Yes") ~ "1b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_2b == "Yes") ~ "2b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_3b == "Yes") ~ "3b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                     ed_scid5.weigh_weighed_past_month_.Wave_4b == "Yes") ~ "4b",
                      (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_6b == "Yes") ~ "6b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_8b == "Yes") ~ "8b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_10b == "Yes") ~ "10b",
                       (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_12b == "Yes") ~ "12b",
                     (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_14b == "Yes") ~ "14b",
                     (NEW_low_weight_pandemic == 1 & # New experience
                      ed_scid5.weigh_weighed_past_month_.Wave_16b == "Yes") ~ "16b",
                     
                     TRUE ~ "Not experienced" # Then, everyone else will have answered "No" at least once, even if they are missing for all other phases. The only people we can not assume an answer for (i.e., has experienced or has not experienced) is those who never answered the question throughout the whole time period. Also, there is no PNTA option on the low weight question, only "Yes" or "No
           )
  )

# Check
dat %>%
  freq(outcome_phase_low_weight)

# Check NAs
dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wavebaseline)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_1b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_2b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_3b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_4b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_6b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_8b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_10b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_12b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_14b)

dat %>%
  filter(is.na(outcome_phase_low_weight)) %>%
  freq(ed_scid5.weigh_weighed_past_month_.Wave_16b)
```

# EXPOSURES / EXPLANATORY VARIABLES
[NB: for the below exposures, will need to derive these differently depending on the outcome because they were reported at every/every other phase and we are taking only those reported BEFORE or in the SAME PHASE as the outcome]
  • Positive COVID test or ill due to COVID  
  • Loss of loved one due to COVID
  • Change in economic activity
  • Change in living situation
  
*The below use follow-up data and are coded so that exposures are only counted if they happened before or in same phase as the outcome*

## COVID-19 infection
```{r Positve COVID test result exposure BEFORE outcome LW - virus, dem and resp Q}
# Baseline
dat <- dat %>%
  mutate(positive_covid_test_LW_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                    
                     # These people will have experienced a positive COVID test before their first experience of LW
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (outcome_phase_low_weight == "Baseline" | 
                         outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_LW_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_low_weight == "Baseline" ~ "To drop", 
                        
                     # These people will have experienced a positive COVID test before their first experience of LW
                        exposure_phase_positive_covid_test == "1a" & 
                       (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_LW_1b =
           case_when(exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                      outcome_phase_low_weight == "Baseline" ~ "To drop",
                        
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (
                         outcome_phase_low_weight == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_low_weight == "2b" | 
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_LW_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_low_weight == "1b" |
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_low_weight == "2b" | 
                        outcome_phase_low_weight == "3b" | 
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_LW_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_low_weight == "1b" )  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                         outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" | 
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_LW_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" | 
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_LW_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weightoccurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_LW_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" | 
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_LW_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_LW_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_LW_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_low_weight == "6b" | # Co-occuring symptom and exposure
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_LW_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_LW_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_low_weight == "8b" |  # Co-occuring symptom and exposure
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_LW_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_LW_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight== "2b" |
                     outcome_phase_low_weight== "3b" |
                      outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                      outcome_phase_low_weight == "8b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    (outcome_phase_low_weight == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_LW_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_LW_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_LW_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    (outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_13a)

# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_LW_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                         outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    (outcome_phase_low_weight == "14b" | # Co-occurring symptom and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_14b)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_LW_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "Baseline"
                     )  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                     outcome_phase_low_weight == "16b" ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_LW_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "Baseline"
                     )  ~ "To drop", # First experience of  low weight occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                     outcome_phase_low_weight == "16b" ~ "Yes"  # Co-occurring
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_LW_16b)

```

Low weight & Positive COVID test result
```{r Positve COVID test result exposure LW - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_LW =
           case_when(# First exposure NOT before first experience of outcome
                positive_covid_test_LW_baseline == "To drop" |
                            positive_covid_test_LW_1a == "To drop" |
                    positive_covid_test_LW_1b == "To drop" |
               positive_covid_test_LW_2a == "To drop" |
                    positive_covid_test_LW_2b == "To drop" |
               positive_covid_test_LW_3a == "To drop" |
                    positive_covid_test_LW_3b == "To drop" |
               positive_covid_test_LW_4a == "To drop" |
                    positive_covid_test_LW_4b == "To drop" |
               positive_covid_test_LW_5a == "To drop" |
                    positive_covid_test_LW_6b == "To drop" |
               positive_covid_test_LW_7a == "To drop" |
                    positive_covid_test_LW_8b == "To drop" |
               positive_covid_test_LW_9a == "To drop" |
                    positive_covid_test_LW_10b == "To drop" |
              positive_covid_test_LW_11a == "To drop" |
                    positive_covid_test_LW_12b == "To drop" |
                positive_covid_test_LW_13a == "To drop" |
                    positive_covid_test_LW_14b == "To drop" |
                 positive_covid_test_LW_15a == "To drop" |
                    positive_covid_test_LW_16b == "To drop" ~ "Positive test after low weight",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "All missing" ~ "Missing whether experienced COVID", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Test taken but not answered test result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced binge eating 
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                    # First exposure BEFORE first experience of outcome
             positive_covid_test_LW_baseline == "Yes" |
                    positive_covid_test_LW_1a == "Yes" |
             positive_covid_test_LW_1b == "Yes" |
               positive_covid_test_LW_2a == "Yes" |
              positive_covid_test_LW_2b == "Yes" |
               positive_covid_test_LW_3a == "Yes" |
                    positive_covid_test_LW_3b == "Yes" |
               positive_covid_test_LW_4a == "Yes" |
                    positive_covid_test_LW_4b == "Yes" |
               positive_covid_test_LW_5a == "Yes" |
                    positive_covid_test_LW_6b == "Yes" |
               positive_covid_test_LW_7a == "Yes" |
                    positive_covid_test_LW_8b == "Yes" |
               positive_covid_test_LW_9a == "Yes" |
                    positive_covid_test_LW_10b == "Yes" |
               positive_covid_test_LW_11a  == "Yes" |
                    positive_covid_test_LW_12b  == "Yes" |
               positive_covid_test_LW_13a  == "Yes" |
                    positive_covid_test_LW_14b  == "Yes" |
               positive_covid_test_LW_15a == "Yes" |
                    positive_covid_test_LW_16b == "Yes"~ "Positive test before low weight",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_LW_baseline == "No outcome" |
             positive_covid_test_LW_1a == "No outcome" |
                    positive_covid_test_LW_1b == "No outcome" |
               positive_covid_test_LW_2a == "No outcome" |
                    positive_covid_test_LW_2b == "No outcome" |
               positive_covid_test_LW_3a == "No outcome" |
                    positive_covid_test_LW_3b == "No outcome" |
               positive_covid_test_LW_4a == "No outcome" |
                    positive_covid_test_LW_4b == "No outcome" |
               positive_covid_test_LW_5a == "No outcome" |
                    positive_covid_test_LW_6b == "No outcome" |
               positive_covid_test_LW_7a == "No outcome" |
                    positive_covid_test_LW_8b == "No outcome" |
               positive_covid_test_LW_9a == "No outcome" |
                    positive_covid_test_LW_10b == "No outcome" |
               positive_covid_test_LW_11a == "No outcome" |
                    positive_covid_test_LW_12b == "No outcome" |
               positive_covid_test_LW_13a == "No outcome" |
                    positive_covid_test_LW_14b == "No outcome" |
               positive_covid_test_LW_15a == "No outcome" |
                    positive_covid_test_LW_16b == "No outcome"  ~ "Exposure but no outcome",
             
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_low_weight == "Not experienced" ~ "Neither exposure nor outcome"
  
      )
)
                   
# Check            
dat %>%
  freq(positive_covid_test_before_LW)  # No NAs

# Create final variable of positive COVID test before LW outcome
dat <- dat %>%
  mutate(positive_covid_test_before_LW_final =
           case_when(positive_covid_test_before_LW == "Positive test after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_LW == "All missing" | # Need to drop people who never answered whether they'd experienced the exposure
                       positive_covid_test_before_LW == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                     positive_covid_test_before_LW == "Not taken test" |
                     positive_covid_test_before_LW ==  "Outcome but no exposure" |
                     positive_covid_test_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     
                       positive_covid_test_before_LW == "Exposure but no outcome" |
                    positive_covid_test_before_LW == "Positive test before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_LW) 

# Check NAs
missing <- dat %>%
  filter(is.na(positive_covid_test_before_LW_final) 
           )

# These people should all have experienced outcome before exposure, or missing test result etc    
missing %>%
  filter(exposure_phase_positive_covid_test != "All missing" &
          outcome_phase_low_weight != "Not answered") %>%
  select(exposure_phase_positive_covid_test,
         outcome_phase_low_weight
         )
```

## Losing someone due to COVID-19 (grief)
```{r Lost someone exposure BEFORE outcome LW}
# Baseline
dat <- dat %>%
  mutate(lost_someone_LW_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     # These people will have experienced losing someone before their first experience of LW
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (  outcome_phase_low_weight == "Baseline" | # Co-occurring
                         outcome_phase_low_weight == "1b" | 
                         outcome_phase_low_weight == "2b" |
                          outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                         outcome_phase_low_weight == "6b" |
                          outcome_phase_low_weight == "8b" |
                         outcome_phase_low_weight == "10b" |
                          outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_LW_1a =
           case_when(exposure_phase_losing_someone == "1a" &
                   outcome_phase_low_weight == "Baseline" ~ "To drop",
                     
                    exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (outcome_phase_low_weight == "1b" | 
                         outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_LW_1a)

# Phase 1b
dat <- dat %>%
  mutate(lost_someone_LW_1b =
           case_when( exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_low_weight == "Baseline" ~ "To  drop", 
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_low_weight == "1b" | 
                         outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_LW_1b)


# Phase 2a
dat <- dat %>%
  mutate(lost_someone_LW_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       ( outcome_phase_low_weight == "2b" |
                         outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                      outcome_phase_low_weight == "6b" |
                         outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_2a)


# Phase 2b
dat <- dat %>%
  mutate(lost_someone_LW_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_low_weight == "2b" |
                         outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                         outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                         outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_LW_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                      ( outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                         outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_3a)


# Phase 3b
dat <- dat %>%
  mutate(lost_someone_LW_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     ( outcome_phase_low_weight == "1b" | 
                         outcome_phase_low_weight == "2b"| 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      ( outcome_phase_low_weight == "3b" |
                          outcome_phase_low_weight == "4b" |
                         outcome_phase_low_weight == "6b" |
                          outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_LW_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_low_weight == "1b" | 
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    (  outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_LW_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    ( outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_LW_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b"| 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    (  outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                          outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_LW_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(lost_someone_LW_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                      outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" | 
                        outcome_phase_low_weight == "Baseline" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_LW_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    ( outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                         outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_LW_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_low_weight == "1b" | 
                       outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                         outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"| 
                        outcome_phase_low_weight == "Baseline" |
                        outcome_phase_low_weight == "8b")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    ( outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(lost_someone_LW_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_low_weight == "1b" | 
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    ( outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"  ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_LW_11a = 
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_low_weight == "1b" | 
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b"| 
                        outcome_phase_low_weight == "Baseline" )  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    ( outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"  ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_LW_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_low_weight == "1b" | 
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    ( outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b" 
                         ) ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_LW_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_low_weight == "1b" | 
                      outcome_phase_low_weight == "2b" |
                      outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    ( outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b"  ) ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_12b)


# Phase 14b
dat <- dat %>%
  mutate(lost_someone_LW_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                      ( outcome_phase_low_weight == "14b" |
                         outcome_phase_low_weight == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_LW_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" | 
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                      outcome_phase_low_weight == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_15a)


# Phase 16b
dat <- dat %>%
  mutate(lost_someone_LW_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     ( outcome_phase_low_weight == "1b" | 
                        outcome_phase_low_weight == "2b" |
                        outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of low weight occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                       outcome_phase_low_weight == "16b"  ~ "Yes"  # Co-occurring symptom and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_LW_16b)

```

Low weight & losing someone
```{r Losing someone exposure LW}
dat <- dat %>%
  mutate(losing_someone_before_LW =
           case_when(# First lost someone NOT before first experience of low weight
                    lost_someone_LW_baseline == "To drop" |
                      lost_someone_LW_1a == "To drop" |
                    lost_someone_LW_1b == "To drop" |
                      lost_someone_LW_2a == "To drop" |
                    lost_someone_LW_2b == "To drop" |
                      lost_someone_LW_3a == "To drop" |
                    lost_someone_LW_3b == "To drop" |
                      lost_someone_LW_4a == "To drop" |
                    lost_someone_LW_4b == "To drop" |
                      lost_someone_LW_5a == "To drop" |
                    lost_someone_LW_6b == "To drop" |
                      lost_someone_LW_7a == "To drop" |
                    lost_someone_LW_8b == "To drop" |
                      lost_someone_LW_9a == "To drop" |
                    lost_someone_LW_10b == "To drop" |
                      lost_someone_LW_11a == "To drop" |
                    lost_someone_LW_12b == "To drop"  |
                      lost_someone_LW_13a == "To drop" |
                      lost_someone_LW_14b == "To drop" |
                      lost_someone_LW_15a == "To drop" |
                    lost_someone_LW_16b == "To drop"~ "Lost someone after low weight",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced low weight
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of low weight
                     lost_someone_LW_baseline == "Yes" |
                      lost_someone_LW_1a == "Yes" |
                    lost_someone_LW_1b == "Yes" |
                      lost_someone_LW_2a == "Yes" |
                    lost_someone_LW_2b == "Yes" |
                      lost_someone_LW_3a == "Yes" |
                    lost_someone_LW_3b == "Yes" |
                      lost_someone_LW_4a == "Yes" |
                    lost_someone_LW_4b == "Yes" |
                      lost_someone_LW_5a == "Yes" |
                    lost_someone_LW_6b == "Yes" |
                      lost_someone_LW_7a == "Yes" |
                    lost_someone_LW_8b == "Yes" |
                      lost_someone_LW_9a == "Yes" |
                    lost_someone_LW_10b == "Yes" |
                      lost_someone_LW_11a == "Yes" |
                    lost_someone_LW_12b == "Yes"  |
                      lost_someone_LW_13a == "Yes" |
                      lost_someone_LW_14b == "Yes" |
                      lost_someone_LW_15a == "Yes" |
                    lost_someone_LW_16b == "Yes"  ~ "Lost someone before low weight",
                    
                   # Experienced exposure but not outcome
                    lost_someone_LW_baseline == "No outcome" |
                      lost_someone_LW_1a == "No outcome" |
                    lost_someone_LW_1b == "No outcome" |
                      lost_someone_LW_2a == "No outcome" |
                    lost_someone_LW_2b == "No outcome" |
                      lost_someone_LW_3a == "No outcome" |
                    lost_someone_LW_3b == "No outcome" |
                      lost_someone_LW_4a == "No outcome" |
                    lost_someone_LW_4b == "No outcome" |
                      lost_someone_LW_5a == "No outcome" |
                    lost_someone_LW_6b == "No outcome" |
                      lost_someone_LW_7a == "No outcome" |
                    lost_someone_LW_8b == "No outcome" |
                      lost_someone_LW_9a == "No outcome" |
                    lost_someone_LW_10b == "No outcome" |
                      lost_someone_LW_11a == "No outcome" |
                    lost_someone_LW_12b == "No outcome"  |
                      lost_someone_LW_13a == "No outcome" |
                      lost_someone_LW_14b == "No outcome" |
                      lost_someone_LW_15a == "No outcome" |
                    lost_someone_LW_16b == "No outcome"  ~ "Exposure but no outcome",
                   
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_low_weight == "Not experienced" ~ "Neither exposure nor outcome"
                  )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_LW) 

# Create final variable of lost someone before LW outcome
dat <- dat %>%
  mutate(lost_someone_before_LW_final =
           case_when(losing_someone_before_LW == "Lost someone after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_LW == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced low weight
                     
                      losing_someone_before_LW ==  "Outcome but no exposure" |
                    losing_someone_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     losing_someone_before_LW == "Exposure but no outcome" |
                    losing_someone_before_LW == "Lost someone before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_LW_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(lost_someone_before_LW_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_losing_someone != "Not answered or PNTA" &
          outcome_phase_low_weight != "Not answered") %>%
  select(exposure_phase_losing_someone,
         outcome_phase_low_weight
         )

```

## Change in main eco activity (work/education)
```{r Change in main eco activity BEFORE outcome LW}
# Baseline
dat <- dat %>%
  mutate(main_eco_change_LW_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_low_weight == "Baseline" |  # Co-occurring
                        outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_LW_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Baseline"~ "To drop", 
                       
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_LW_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at 1b
                      outcome_phase_low_weight == "Baseline"~ "To drop", 
                       
                     
                        exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_low_weight == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_LW_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "1b"|
                          outcome_phase_low_weight == "Baseline") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_LW_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                     (outcome_phase_low_weight == "1b" |
                          outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_LW_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_low_weight == "1b" |
                       outcome_phase_low_weight == "2b"|
                          outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_LW_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_LW_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_low_weight == "1b" |
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_LW_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_LW_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_LW_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_LW_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_LW_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_LW_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_LW_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_LW_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_LW_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b"|
                          outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_12b)


# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_LW_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_LW_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_low_weight == "14b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_14b)

# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_LW_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                     outcome_phase_low_weight == "16b" ~ "Yes"  # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_15a)


# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_LW_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "14b" |
                          outcome_phase_low_weight == "Baseline"
                      )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                     outcome_phase_low_weight == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_LW_16b)
```

Low weight & change in main eco activity 
```{r Change in eco activity exposure LW}
dat <- dat %>%
  mutate(main_eco_change_before_LW =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_LW_baseline == "To drop" |
                       main_eco_change_LW_1a == "To drop" |
                    main_eco_change_LW_1b == "To drop" |
                       main_eco_change_LW_2a == "To drop" |
                    main_eco_change_LW_2b == "To drop" |
                       main_eco_change_LW_3a == "To drop" |
                    main_eco_change_LW_3b == "To drop" |
                       main_eco_change_LW_4a == "To drop" |
                    main_eco_change_LW_4b == "To drop" |
                       main_eco_change_LW_5a == "To drop" |
                    main_eco_change_LW_6b == "To drop" |
                       main_eco_change_LW_7a == "To drop" |
                    main_eco_change_LW_8b == "To drop" |
                       main_eco_change_LW_9a == "To drop" |
                    main_eco_change_LW_10b == "To drop" |
                       main_eco_change_LW_11a == "To drop" |
                    main_eco_change_LW_12b == "To drop" |
                    main_eco_change_LW_13a == "To drop" |
                       main_eco_change_LW_14b == "To drop" |
                    main_eco_change_LW_15a == "To drop" |
                       main_eco_change_LW_16b == "To drop"~ "Change in eco activity after low weight",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_LW_baseline == "Yes" |
                     main_eco_change_LW_1a == "Yes" |
                    main_eco_change_LW_1b == "Yes" |
                     main_eco_change_LW_2a == "Yes" |
                    main_eco_change_LW_2b == "Yes" |
                     main_eco_change_LW_3a == "Yes" |
                    main_eco_change_LW_3b == "Yes" |
                     main_eco_change_LW_4a == "Yes" |
                    main_eco_change_LW_4b == "Yes" |
                     main_eco_change_LW_5a == "Yes" |
                    main_eco_change_LW_6b == "Yes" |
                     main_eco_change_LW_7a == "Yes" |
                    main_eco_change_LW_8b == "Yes" |
                     main_eco_change_LW_9a == "Yes" |
                    main_eco_change_LW_10b == "Yes" |
                     main_eco_change_LW_11a == "Yes" |
                    main_eco_change_LW_12b == "Yes" |
                    main_eco_change_LW_13a == "Yes" |
                     main_eco_change_LW_14b == "Yes" |
                    main_eco_change_LW_15a == "Yes" |
                     main_eco_change_LW_16b == "Yes" ~ "Change in eco activity before low weight",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_LW_baseline == "No outcome" |
                    main_eco_change_LW_1a == "No outcome" |
                    main_eco_change_LW_1b == "No outcome" |
                    main_eco_change_LW_2a == "No outcome" |
                    main_eco_change_LW_2b == "No outcome" |
                    main_eco_change_LW_3a == "No outcome" |
                    main_eco_change_LW_3b == "No outcome" |
                    main_eco_change_LW_4a == "No outcome" |
                    main_eco_change_LW_4b == "No outcome" |
                    main_eco_change_LW_5a == "No outcome" |
                    main_eco_change_LW_6b == "No outcome" |
                    main_eco_change_LW_7a == "No outcome" |
                    main_eco_change_LW_8b == "No outcome" |
                    main_eco_change_LW_9a == "No outcome" |
                    main_eco_change_LW_10b == "No outcome" |
                    main_eco_change_LW_11a == "No outcome" |
                    main_eco_change_LW_12b == "No outcome" |
                    main_eco_change_LW_13a == "No outcome" |
                    main_eco_change_LW_14b == "No outcome" |
                    main_eco_change_LW_15a == "No outcome" |
                    main_eco_change_LW_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_low_weight  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_LW) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_LW_final =
           case_when(main_eco_change_before_LW == "Change in eco activity after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_LW == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_LW ==  "Outcome but no exposure" |
                      main_eco_change_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                      main_eco_change_before_LW == "Exposure but no outcome" |
                      main_eco_change_before_LW == "Change in eco activity before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_LW_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(main_eco_change_before_LW_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_main_eco_change != "Missing at every phase" &
          outcome_phase_low_weight != "Not answered") %>%
  select(exposure_phase_main_eco_change,
         outcome_phase_low_weight
         )
```

## Change in living situation
```{r Change in living situation BEFORE outcome LW}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_LW_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_low_weight == "Baseline" | # Co-occurring 
                        outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_LW_1a =
           case_when(
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                      exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_low_weight == "Baseline" ~ "To drop",
                         
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_low_weight == "1b" |  
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_LW_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                      exposure_phase_living_situation_change == "1b" & # First exposure at 1b
                      outcome_phase_low_weight == "Baseline" ~ "To drop",
                     
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_low_weight == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_LW_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      (outcome_phase_low_weight == "1b" |
                        outcome_phase_low_weight == "Baseline") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_LW_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_low_weight == "1b"  |
                        outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred LWfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_low_weight == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_LW_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_LW_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_low_weight == "1b" |
                       outcome_phase_low_weight == "2b"|
                        outcome_phase_low_weight == "Baseline") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_LW_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_LW_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b"|
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_low_weight == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_LW_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_low_weight == "1b" |
                      outcome_phase_low_weight == "2b" |
                       outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_LW_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_low_weight == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_LW_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                       outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_LW_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_low_weight == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_LW_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_LW_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                       outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_low_weight == "8b" |
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_LW_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_LW_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_low_weight == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_LW_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                       outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_LW_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "12b"|
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_LW_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" | 
                       outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "Baseline")   ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_low_weight == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_LW_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_LW_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_12b)




# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_LW_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_low_weight == "14b" |
                       outcome_phase_low_weight == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_LW_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    ( outcome_phase_low_weight == "14b" |  # Co-occurring outcome and exposure
                       outcome_phase_low_weight == "16b") ~ "Yes"
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_14b)


# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_LW_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                      outcome_phase_low_weight == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_16b)


# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_LW_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_low_weight == "1b" |
                     outcome_phase_low_weight == "2b" |
                     outcome_phase_low_weight == "3b" |
                     outcome_phase_low_weight == "4b" |
                     outcome_phase_low_weight == "6b" |
                     outcome_phase_low_weight == "8b" |
                     outcome_phase_low_weight == "10b" |
                       outcome_phase_low_weight == "12b" |
                       outcome_phase_low_weight == "14b" |
                        outcome_phase_low_weight == "Baseline")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_low_weight == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                      outcome_phase_low_weight == "16b" ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_LW_15a)
```

Low weight & change in living situation
```{r Change in living situation exposure LW}
dat <- dat %>%
  mutate(living_situation_change_before_LW =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_LW_baseline == "To drop" |
                    living_situation_change_LW_1a == "To drop" |
                    living_situation_change_LW_1b == "To drop" |
                      living_situation_change_LW_2a == "To drop" |
                    living_situation_change_LW_2b == "To drop" |
                      living_situation_change_LW_3a == "To drop" |
                    living_situation_change_LW_3b == "To drop" |
                      living_situation_change_LW_4a == "To drop" |
                    living_situation_change_LW_4b == "To drop" |
                      living_situation_change_LW_5a == "To drop" |
                    living_situation_change_LW_6b == "To drop" |
                      living_situation_change_LW_7a == "To drop" |
                    living_situation_change_LW_8b == "To drop" |
                      living_situation_change_LW_9a == "To drop" |
                    living_situation_change_LW_10b == "To drop" |
                      living_situation_change_LW_11a == "To drop" |
                    living_situation_change_LW_12b == "To drop"|
                    living_situation_change_LW_13a == "To drop" |
                      living_situation_change_LW_14b== "To drop" |
                    living_situation_change_LW_15a == "To drop" |
                      living_situation_change_LW_16b == "To drop" ~ "Change in living situation after low weight",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_low_weight == "Not answered" ~ "Missing whether experienced low weight", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_LW_baseline == "Yes" |
                    living_situation_change_LW_1a == "Yes" |
                    living_situation_change_LW_1b == "Yes" |
                    living_situation_change_LW_2a == "Yes" |
                    living_situation_change_LW_2b == "Yes" |
                    living_situation_change_LW_3a == "Yes" |
                    living_situation_change_LW_3b == "Yes" |
                    living_situation_change_LW_4a == "Yes" |
                    living_situation_change_LW_4b == "Yes" |
                    living_situation_change_LW_5a == "Yes" |
                    living_situation_change_LW_6b == "Yes" |
                    living_situation_change_LW_7a == "Yes" |
                    living_situation_change_LW_8b == "Yes" |
                    living_situation_change_LW_9a == "Yes" |
                    living_situation_change_LW_10b == "Yes" |
                    living_situation_change_LW_11a == "Yes" |
                    living_situation_change_LW_12b == "Yes" |
                    living_situation_change_LW_13a == "Yes" |
                    living_situation_change_LW_14b == "Yes" |
                    living_situation_change_LW_15a == "Yes" |
                    living_situation_change_LW_16b == "Yes"~ "Change in living situation before low weight",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_LW_baseline == "No outcome" |
                    living_situation_change_LW_1a == "No outcome" |
                    living_situation_change_LW_1b == "No outcome" |
                    living_situation_change_LW_2a == "No outcome" |
                    living_situation_change_LW_2b == "No outcome" |
                    living_situation_change_LW_3a == "No outcome" |
                    living_situation_change_LW_3b == "No outcome" |
                    living_situation_change_LW_4a == "No outcome" |
                    living_situation_change_LW_4b == "No outcome" |
                    living_situation_change_LW_5a == "No outcome" |
                    living_situation_change_LW_6b == "No outcome" |
                    living_situation_change_LW_7a == "No outcome" |
                    living_situation_change_LW_8b == "No outcome" |
                    living_situation_change_LW_9a == "No outcome" |
                    living_situation_change_LW_10b == "No outcome" |
                    living_situation_change_LW_11a == "No outcome" |
                    living_situation_change_LW_12b == "No outcome" |
                    living_situation_change_LW_13a == "No outcome" |
                    living_situation_change_LW_14b == "No outcome" |
                    living_situation_change_LW_15a == "No outcome" |
                    living_situation_change_LW_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_low_weight != "Not answered" |
                        outcome_phase_low_weight != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_low_weight  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_LW) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_LW_final =
           case_when(living_situation_change_before_LW == "Change in living situation after low weight" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_LW == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_LW == "Missing whether experienced low weight" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                       living_situation_change_before_LW ==  "Outcome but no exposure" |
                     living_situation_change_before_LW ==  "Neither exposure nor outcome" ~ "No",
                    
                     living_situation_change_before_LW == "Exposure but no outcome" |
                    living_situation_change_before_LW == "Change in living situation before low weight" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_LW_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(living_situation_change_before_LW_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_living_situation_change != "Missing at every phase" &
          outcome_phase_low_weight != "Not answered" &
           outcome_phase_low_weight != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_living_situation_change,
         outcome_phase_low_weight
         )
```

# Saving dataset
## Select & save variables needed for analysis
```{r Select final variables ready for regression analyses}
final_dat_LW <- dat %>%
  select(ID,
         lifetime_low_weight_baseline_numeric,
         # Outcome for eating disorder regressions
         NEW_low_weight_pandemic,
         outcome_phase_low_weight,
        
         # Exposures 
         positive_covid_test_before_LW_final,
         lost_someone_before_LW_final,
         main_eco_change_before_LW_final,
         living_situation_change_before_LW_final,
        
        # Sensitivity analysis
        sens_NEW_low_weight_pandemic
        )

```

Save final dataset (interim analysis)
Save dataset
```{r save dataset}
saveRDS(object = final_dat_LW,
       file = paste0(filepath_saved_data, "final_dat_LW", date, ".rds"))
```
