---
title: "Creating dem.benefits_decreased to merge"
author: "Helena Davies"
date: "30/11/2021"
output: html_document
---

The dem.benefits_decreased variable at some point got deleted as an answer option in RAMP, so unfortunately, from a certain time point, that data in RAMP is now lost as a result. 

We should merge the files with the last data freeze. These surveys aren't being used anymore anyway, so this can be done in the final export when all issues are resolved, and then left.

This script pulls out the cleaned dem.benefits_decreased data in wide format (i.e., wave_1a, wave_1b, etc etc), ready for it to be merged with the cleaned latest freeze data (which now does not have this variable).

Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/add_numeric.R")
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/remove_duplicates.R")
source(file = "/Users/helenadavies/werk/ilovedata/scripts/functions/package_check.R")
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

# Read in data with dem.benefits_decreased cleaned
```{r read in data}
dat <- readRDS(file = "/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned_archive/DEM_followup_ramp2021-06-29.rds")

# Select ID and variable of interest
dat <-dat %>%
  select(ID,
         dem.benefits_decreased_.Wave_1a,
         dem.benefits_decreased_.Wave_1b,
         dem.benefits_decreased_.Wave_2a,
         dem.benefits_decreased_.Wave_2b,
         dem.benefits_decreased_.Wave_3a,
         dem.benefits_decreased_.Wave_3b,
         dem.benefits_decreased_.Wave_4a,
         dem.benefits_decreased_.Wave_4b,
         dem.benefits_decreased_.Wave_5a,
         dem.benefits_decreased_.Wave_6b,
         dem.benefits_decreased_.Wave_7a,
         dem.benefits_decreased_.Wave_8b,
         dem.benefits_decreased_.Wave_9a,
         dem.benefits_decreased_.Wave_10b,
         dem.benefits_decreased_.Wave_11a,
         dem.benefits_decreased_.Wave_12b
         )
```

```{r save data}
saveRDS(object = dat, file = paste0("/Users/helenadavies/werk/EDBEHSELFHARM2/gitEDBEHSELFHARM/data_cleaned/dem.benefits_decreased_dat", date, ".rds"))
```

