---
title: "Deriving variables: Suicidal and/or self-harm ideation"
author: "Helena Davies"
date: "21/02/2022"
output: html_document
---

This script derives variables for the suicidal and/or self-harm ideation phenotype ready for regression analyses.
NB: I first clean 'suicidal ideation' and 'self-harm ideation' separately before combining into a variable called 'harmful ideation' which represents 'suicidal and/or self-harm ideation'. We have merged these two variables because they are highly correlated (>0.8).

Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Read in file with path to data channel
```{r Read in file with path to data channel}
source(file = "../credentials/paths.R")
```

Add the add_numeric function - used to convert character variables into numeric variables
Add the remove_duplicates function - used to deduplicate and remove NAs from IDs
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
Add the imp_check function - used to check variables for implausible values
```{r Read in functions}
source(file = paste0(filepath_functions, "add_numeric.R"))
source(file = paste0(filepath_functions, "remove_duplicates.R"))
source(file = paste0(filepath_functions, "package_check.R"))
source("./functions.R")
```

Use package_check to install and load dependencies
Load tidyverse last
```{r Install load dependencies}
packages <- c("summarytools", "sjlabelled", "Amelia", "gtsummary", "tidyverse")
package_check(packages)
```

Retrieve recent date
We are using the recent date to save files with paste0() as an extension to not overwrite old versions
```{r Recent date}
date <- Sys.Date()
date
```

# Read in data
```{r Read in dataset}
dat <- readRDS(paste0(filepath_saved_data, "final_dat_no_dup_entries2022-02-21.rds"))
```

# Outcome = Passive suicidal ideation
## Derive ANY passive suicidal ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Many people have thoughts that life is not worth living. Have you felt that way?" If "Yes", they are asked: "Have you felt that way in the past two weeks?"
```{r Passive suicdal ideation in the past two weeks}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation =
           case_when(
             taf.felt_weeks_past_.Wavebaseline == "Yes" |
                     taf.felt_weeks_past_.Wave_1a == "Yes" |
                       taf.felt_weeks_past_.Wave_1b == "Yes" |
                       taf.felt_weeks_past_.Wave_2a == "Yes" |
                       taf.felt_weeks_past_.Wave_2b == "Yes" |
                       taf.felt_weeks_past_.Wave_3a == "Yes" |
                       taf.felt_weeks_past_.Wave_3b == "Yes" |
                       taf.felt_weeks_past_.Wave_4a == "Yes" |
                       taf.felt_weeks_past_.Wave_4b == "Yes" |
                       taf.felt_weeks_past_.Wave_5a == "Yes" |
                       taf.felt_weeks_past_.Wave_6b == "Yes" |
                       taf.felt_weeks_past_.Wave_7a == "Yes" |
                       taf.felt_weeks_past_.Wave_8b == "Yes" |
                       taf.felt_weeks_past_.Wave_9a == "Yes" |
                       taf.felt_weeks_past_.Wave_10b == "Yes" |
                       taf.felt_weeks_past_.Wave_11a == "Yes" |
                       taf.felt_weeks_past_.Wave_12b == "Yes" |
                       taf.felt_weeks_past_.Wave_13a == "Yes" |
                       taf.felt_weeks_past_.Wave_14b == "Yes" |
                       taf.felt_weeks_past_.Wave_15a == "Yes" |
                       taf.felt_weeks_past_.Wave_16b == "Yes"  ~ 1, # Said 'Yes' at least once during the pandemic
                        
      # Either never answered screener or DID answer screener but never answered about last two weeks
                 (
             (is.na(taf.worth_living_life_people_.Wavebaseline) | # Did not answer screener
               ((taf.worth_living_life_people_.Wavebaseline == "Yes, once" | # Passed screener
                 taf.worth_living_life_people_.Wavebaseline == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wavebaseline))) & # Didn't answer about last two weeks 
               
               (is.na(taf.worth_living_life_people_.Wave_1a) |
                  ((taf.worth_living_life_people_.Wave_1a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_1a == "Yes, more than once") &
                   is.na(taf.felt_weeks_past_.Wave_1a))) &
               
                (is.na(taf.worth_living_life_people_.Wave_1b) |
               ((taf.worth_living_life_people_.Wave_1b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_1b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_1b))) &
               
               (is.na(taf.worth_living_life_people_.Wave_2a) |
                ((taf.worth_living_life_people_.Wave_2a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_2a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_2a))) &
                   
                (is.na(taf.worth_living_life_people_.Wave_2b) |
               ((taf.worth_living_life_people_.Wave_2b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_2b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_2b))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3a) |
               ((taf.worth_living_life_people_.Wave_3a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_3a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_3a))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3b) |
               ((taf.worth_living_life_people_.Wave_3b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_3b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_3b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4a) |
               ((taf.worth_living_life_people_.Wave_4a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_4a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_4a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4b) |
               ((taf.worth_living_life_people_.Wave_4b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_4b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_4b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_5a) |
               ((taf.worth_living_life_people_.Wave_5a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_5a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_5a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_6b) |
              ((taf.worth_living_life_people_.Wave_6b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_6b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_6b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_7a) |
               ((taf.worth_living_life_people_.Wave_7a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_7a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_7a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_8b) |
              ((taf.worth_living_life_people_.Wave_8b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_8b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_8b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_9a) |
               ((taf.worth_living_life_people_.Wave_9a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_9a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_9a))) & 
               
              (is.na(taf.worth_living_life_people_.Wave_10b) |
                ((taf.worth_living_life_people_.Wave_10b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_10b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_10b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_11a) |
               ((taf.worth_living_life_people_.Wave_11a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_11a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_11a))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_12b) |
                ((taf.worth_living_life_people_.Wave_12b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_12b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_12b))) & 
                 
                   (is.na(taf.worth_living_life_people_.Wave_13a) |
               ((taf.worth_living_life_people_.Wave_13a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_13a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_13a))) & 
                 
                  (is.na(taf.worth_living_life_people_.Wave_14b) |
                ((taf.worth_living_life_people_.Wave_14b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_14b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_14b))) & 
                 
                 (is.na(taf.worth_living_life_people_.Wave_15a) |
                ((taf.worth_living_life_people_.Wave_15a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_15a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_15a))) & 
                      
                  (is.na(taf.worth_living_life_people_.Wave_16b) |
               ((taf.worth_living_life_people_.Wave_16b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_16b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_16b)))
               ) ~ NA_real_, 
                     
               # Either never experienced it (lifetime) or HAS but not in the last two weeks       
             (
             (taf.worth_living_life_people_.Wavebaseline == "No" | 
               taf.felt_weeks_past_.Wavebaseline == "No") |
               
               (taf.worth_living_life_people_.Wave_1a == "No" | 
               taf.felt_weeks_past_.Wave_1a == "No") |
               
               (taf.worth_living_life_people_.Wave_1b == "No" | 
               taf.felt_weeks_past_.Wave_1b == "No") |
               
               (taf.worth_living_life_people_.Wave_2a == "No" | 
               taf.felt_weeks_past_.Wave_2a == "No") |
               
               (taf.worth_living_life_people_.Wave_2b == "No" | 
               taf.felt_weeks_past_.Wave_2b== "No") |
               
               (taf.worth_living_life_people_.Wave_3a == "No" | 
               taf.felt_weeks_past_.Wave_3a == "No") |
               
               (taf.worth_living_life_people_.Wave_3b == "No" | 
               taf.felt_weeks_past_.Wave_3b == "No") |
               
               (taf.worth_living_life_people_.Wave_4a == "No" | 
               taf.felt_weeks_past_.Wave_4a == "No") |
               
               (taf.worth_living_life_people_.Wave_4b == "No" | 
               taf.felt_weeks_past_.Wave_4b == "No") |
               
                 (taf.worth_living_life_people_.Wave_5a == "No" | 
               taf.felt_weeks_past_.Wave_5a == "No") |
               
                (taf.worth_living_life_people_.Wave_6b == "No" | 
               taf.felt_weeks_past_.Wave_6b == "No") |
               
                (taf.worth_living_life_people_.Wave_7a == "No" | 
               taf.felt_weeks_past_.Wave_7a == "No") |
               
               (taf.worth_living_life_people_.Wave_8b == "No" | 
               taf.felt_weeks_past_.Wave_8b == "No") |
               
                (taf.worth_living_life_people_.Wave_9a == "No" | 
               taf.felt_weeks_past_.Wave_9a == "No") |
               
               (taf.worth_living_life_people_.Wave_10b == "No" | 
               taf.felt_weeks_past_.Wave_10b == "No") |
               
               (taf.worth_living_life_people_.Wave_11a == "No" | 
               taf.felt_weeks_past_.Wave_11a == "No") |
               
               (taf.worth_living_life_people_.Wave_12b  == "No" | 
               taf.felt_weeks_past_.Wave_12b == "No") |
               
               (taf.worth_living_life_people_.Wave_13a  == "No" | 
               taf.felt_weeks_past_.Wave_13a == "No") |
               
               (taf.worth_living_life_people_.Wave_14b  == "No" | 
               taf.felt_weeks_past_.Wave_14b == "No") |
               
                (taf.worth_living_life_people_.Wave_15a  == "No" | 
               taf.felt_weeks_past_.Wave_15a == "No") |
               
               (taf.worth_living_life_people_.Wave_16b  == "No" | 
               taf.felt_weeks_past_.Wave_16b == "No")
             ) ~ 0 
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)

# Check NAs (should all be NA or PNTA)
dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wavebaseline)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_1a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_1b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_2a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_2b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_3a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_3b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_4a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_4b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_5a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_6b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_7a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_8b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_9a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_10b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_11a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_12b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_13a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_14b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_15a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_16b)

# Look at number of people who answered EVERY phase
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase =
           case_when(
                       taf.felt_weeks_past_.Wavebaseline == "Yes" |
                       taf.felt_weeks_past_.Wave_1a == "Yes" |
                       taf.felt_weeks_past_.Wave_1b == "Yes" |
                       taf.felt_weeks_past_.Wave_2a == "Yes" |
                       taf.felt_weeks_past_.Wave_2b == "Yes" |
                       taf.felt_weeks_past_.Wave_3a == "Yes" |
                       taf.felt_weeks_past_.Wave_3b == "Yes" |
                       taf.felt_weeks_past_.Wave_4a == "Yes" |
                       taf.felt_weeks_past_.Wave_4b == "Yes" |
                       taf.felt_weeks_past_.Wave_5a == "Yes" |
                       taf.felt_weeks_past_.Wave_6b == "Yes" |
                       taf.felt_weeks_past_.Wave_7a == "Yes" |
                       taf.felt_weeks_past_.Wave_8b == "Yes" |
                       taf.felt_weeks_past_.Wave_9a == "Yes" |
                       taf.felt_weeks_past_.Wave_10b == "Yes" |
                       taf.felt_weeks_past_.Wave_11a == "Yes" |
                       taf.felt_weeks_past_.Wave_12b == "Yes" |
                       taf.felt_weeks_past_.Wave_13a == "Yes" |
                       taf.felt_weeks_past_.Wave_14b == "Yes" |
                       taf.felt_weeks_past_.Wave_15a == "Yes" |
                       taf.felt_weeks_past_.Wave_16b == "Yes"  ~ 1, # Said 'Yes' at least once during the pandemic
                        
        # Either never answered screener or DID answer screener but never answered about last two weeks
                 (
             (is.na(taf.worth_living_life_people_.Wavebaseline) | # Did not answer screener
               ((taf.worth_living_life_people_.Wavebaseline == "Yes, once" | # Passed screener
                 taf.worth_living_life_people_.Wavebaseline == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wavebaseline))) & # Didn't answer about last two weeks 
               
               (is.na(taf.worth_living_life_people_.Wave_1a) |
                  ((taf.worth_living_life_people_.Wave_1a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_1a == "Yes, more than once") &
                   is.na(taf.felt_weeks_past_.Wave_1a))) &
               
                (is.na(taf.worth_living_life_people_.Wave_1b) |
               ((taf.worth_living_life_people_.Wave_1b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_1b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_1b))) &
               
               (is.na(taf.worth_living_life_people_.Wave_2a) |
                ((taf.worth_living_life_people_.Wave_2a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_2a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_2a))) &
                   
                (is.na(taf.worth_living_life_people_.Wave_2b) |
               ((taf.worth_living_life_people_.Wave_2b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_2b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_2b))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3a) |
               ((taf.worth_living_life_people_.Wave_3a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_3a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_3a))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_3b) |
               ((taf.worth_living_life_people_.Wave_3b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_3b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_3b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4a) |
               ((taf.worth_living_life_people_.Wave_4a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_4a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_4a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_4b) |
               ((taf.worth_living_life_people_.Wave_4b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_4b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_4b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_5a) |
               ((taf.worth_living_life_people_.Wave_5a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_5a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_5a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_6b) |
              ((taf.worth_living_life_people_.Wave_6b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_6b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_6b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_7a) |
               ((taf.worth_living_life_people_.Wave_7a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_7a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_7a))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_8b) |
              ((taf.worth_living_life_people_.Wave_8b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_8b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_8b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_9a) |
               ((taf.worth_living_life_people_.Wave_9a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_9a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_9a))) & 
               
              (is.na(taf.worth_living_life_people_.Wave_10b) |
                ((taf.worth_living_life_people_.Wave_10b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_10b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_10b))) & 
               
               (is.na(taf.worth_living_life_people_.Wave_11a) |
               ((taf.worth_living_life_people_.Wave_11a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_11a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_11a))) & 
               
                (is.na(taf.worth_living_life_people_.Wave_12b) |
                ((taf.worth_living_life_people_.Wave_12b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_12b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_12b))) & 
                 
                   (is.na(taf.worth_living_life_people_.Wave_13a) |
               ((taf.worth_living_life_people_.Wave_13a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_13a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_13a))) & 
                 
                  (is.na(taf.worth_living_life_people_.Wave_14b) |
                ((taf.worth_living_life_people_.Wave_14b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_14b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_14b))) & 
                 
                 (is.na(taf.worth_living_life_people_.Wave_15a) |
                ((taf.worth_living_life_people_.Wave_15a == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_15a == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_15a))) & 
                      
                  (is.na(taf.worth_living_life_people_.Wave_16b) |
               ((taf.worth_living_life_people_.Wave_16b == "Yes, once" | 
                 taf.worth_living_life_people_.Wave_16b == "Yes, more than once") &
               is.na(taf.felt_weeks_past_.Wave_16b)))
               ) ~ NA_real_, 
               
        
         # Either never experienced it (lifetime) or HAS but not in the last two weeks       
             (
             (taf.worth_living_life_people_.Wavebaseline == "No" | 
               taf.felt_weeks_past_.Wavebaseline == "No") &
               
               (taf.worth_living_life_people_.Wave_1a == "No" | 
               taf.felt_weeks_past_.Wave_1a == "No") &
               
               (taf.worth_living_life_people_.Wave_1b == "No" | 
               taf.felt_weeks_past_.Wave_1b == "No") &
               
               (taf.worth_living_life_people_.Wave_2a == "No" | 
               taf.felt_weeks_past_.Wave_2a == "No") &
               
               (taf.worth_living_life_people_.Wave_2b == "No" | 
               taf.felt_weeks_past_.Wave_2b== "No") &
               
               (taf.worth_living_life_people_.Wave_3a == "No" | 
               taf.felt_weeks_past_.Wave_3a == "No") &
               
               (taf.worth_living_life_people_.Wave_3b == "No" | 
               taf.felt_weeks_past_.Wave_3b == "No") &
               
               (taf.worth_living_life_people_.Wave_4a == "No" | 
               taf.felt_weeks_past_.Wave_4a == "No") &
               
               (taf.worth_living_life_people_.Wave_4b == "No" | 
               taf.felt_weeks_past_.Wave_4b == "No") &
               
                 (taf.worth_living_life_people_.Wave_5a == "No" | 
               taf.felt_weeks_past_.Wave_5a == "No") &
               
                (taf.worth_living_life_people_.Wave_6b == "No" | 
               taf.felt_weeks_past_.Wave_6b == "No") &
               
                (taf.worth_living_life_people_.Wave_7a == "No" | 
               taf.felt_weeks_past_.Wave_7a == "No") &
               
               (taf.worth_living_life_people_.Wave_8b == "No" | 
               taf.felt_weeks_past_.Wave_8b == "No") &
               
                (taf.worth_living_life_people_.Wave_9a == "No" | 
               taf.felt_weeks_past_.Wave_9a == "No") &
               
               (taf.worth_living_life_people_.Wave_10b == "No" | 
               taf.felt_weeks_past_.Wave_10b == "No") &
               
               (taf.worth_living_life_people_.Wave_11a == "No" | 
               taf.felt_weeks_past_.Wave_11a == "No") &
               
               (taf.worth_living_life_people_.Wave_12b  == "No" | 
               taf.felt_weeks_past_.Wave_12b == "No") &
               
               (taf.worth_living_life_people_.Wave_13a  == "No" | 
               taf.felt_weeks_past_.Wave_13a == "No") &
               
               (taf.worth_living_life_people_.Wave_14b  == "No" | 
               taf.felt_weeks_past_.Wave_14b == "No") &
               
                (taf.worth_living_life_people_.Wave_15a  == "No" | 
               taf.felt_weeks_past_.Wave_15a == "No") &
               
               (taf.worth_living_life_people_.Wave_16b  == "No" | 
               taf.felt_weeks_past_.Wave_16b == "No")
             ) ~ 0 
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)

# Check NAs
dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wavebaseline)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_1a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_1b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_2a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_2b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_3a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_3b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_4a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_4b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_5a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_6b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_7a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_8b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_9a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_10b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_11a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_12b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_13a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_14b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_15a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation_every_phase)) %>%
  freq(taf.felt_weeks_past_.Wave_16b)
```

### Experience ever
In the follow ups and baseline, participants are also asked: "Many people have thoughts that life is not worth living. Have you felt that way". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Passive suicidal ideation ever}
# Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_passive_suicidal_ideation =
           case_when(
                    (taf.worth_living_life_people_.Wavebaseline == "Yes, once" |
                     taf.worth_living_life_people_.Wave_1a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_13a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_14b == "Yes, once" |
                       taf.worth_living_life_people_.Wave_15a == "Yes, once" |
                       taf.worth_living_life_people_.Wave_16b == "Yes, once" |
                      
                      taf.worth_living_life_people_.Wavebaseline == "Yes, more than once" |
                        taf.worth_living_life_people_.Wave_1a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_1b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_2b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_3b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_4b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_5a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_6b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_7a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_8b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_9a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_10b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_11a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_12b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_13a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_14b == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_15a == "Yes, more than once" |
                       taf.worth_living_life_people_.Wave_16b == "Yes, more than once")  ~ 1, # Answered yes at least once
                        
                       (is.na(taf.worth_living_life_people_.Wavebaseline) &
                       is.na(taf.worth_living_life_people_.Wave_1a) &
                       is.na(taf.worth_living_life_people_.Wave_1b) &
                       is.na(taf.worth_living_life_people_.Wave_2a) &
                       is.na(taf.worth_living_life_people_.Wave_2b) &
                       is.na(taf.worth_living_life_people_.Wave_3a) &
                       is.na(taf.worth_living_life_people_.Wave_3b) &
                       is.na(taf.worth_living_life_people_.Wave_4a) &
                       is.na(taf.worth_living_life_people_.Wave_4b) &
                       is.na(taf.worth_living_life_people_.Wave_5a) &
                       is.na(taf.worth_living_life_people_.Wave_6b) &
                       is.na(taf.worth_living_life_people_.Wave_7a) &
                       is.na(taf.worth_living_life_people_.Wave_8b) &
                       is.na(taf.worth_living_life_people_.Wave_9a) &
                       is.na(taf.worth_living_life_people_.Wave_10b) &
                       is.na(taf.worth_living_life_people_.Wave_11a) &
                       is.na(taf.worth_living_life_people_.Wave_12b) &
                       is.na(taf.worth_living_life_people_.Wave_13a) &
                       is.na(taf.worth_living_life_people_.Wave_14b) &
                       is.na(taf.worth_living_life_people_.Wave_15a) &
                       is.na(taf.worth_living_life_people_.Wave_16b))  ~ NA_real_, # Captures those missing at every phase
                     
                     (taf.worth_living_life_people_.Wavebaseline == "No" |
                       taf.worth_living_life_people_.Wave_1a == "No" |
                       taf.worth_living_life_people_.Wave_1b == "No"  |
                       taf.worth_living_life_people_.Wave_2a == "No" |
                       taf.worth_living_life_people_.Wave_2b == "No" |
                       taf.worth_living_life_people_.Wave_3a == "No" |
                       taf.worth_living_life_people_.Wave_3b == "No" |
                       taf.worth_living_life_people_.Wave_4a == "No" |
                       taf.worth_living_life_people_.Wave_4b == "No" |
                       taf.worth_living_life_people_.Wave_5a == "No" |
                       taf.worth_living_life_people_.Wave_6b == "No" |
                       taf.worth_living_life_people_.Wave_7a == "No" |
                       taf.worth_living_life_people_.Wave_8b == "No" |
                       taf.worth_living_life_people_.Wave_9a == "No" |
                       taf.worth_living_life_people_.Wave_10b == "No" | 
                       taf.worth_living_life_people_.Wave_11a == "No" | 
                       taf.worth_living_life_people_.Wave_12b == "No" | 
                       taf.worth_living_life_people_.Wave_13a == "No" | 
                       taf.worth_living_life_people_.Wave_14b == "No" | 
                       taf.worth_living_life_people_.Wave_15a == "No" | 
                       taf.worth_living_life_people_.Wave_16b == "No") ~ 0 # Captures anyone who has at least one "No" and never said "Yes" (e.g., might be NA for all other phases)
                    
           )
         )

# Check
dat %>%
  freq(EVER_PANDEMIC_passive_suicidal_ideation)
 
# Check NAs (should be all PNTA or NA)
dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wavebaseline)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_1a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_1b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_2a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_2b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_3a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_3b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_4a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_4b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_5a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_6b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_7a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_8b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_9a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_10b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_11a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_12b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_13a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_14b)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_15a)

dat %>%
  filter(is.na(EVER_PANDEMIC_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_16b)
```

### PREPANDEMIC passive suicidal ideation 
At baseline, participants are first asked: "Many people have thoughts that life is not worth living. Have you felt that way?" (taf.worth_living_thoughts_life_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.
```{r Passive suicidal ideation baseline pre-pandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_passive_suicidal_ideation =
           case_when(
             
                  taf.worth_living_life_people_.Wavebaseline == "No" ~ 0, # Never experienced it (lifetime)
                  
                    taf.pandemic_felt_.Wavebaseline == "No" ~ 0, # Have in their life but not before the pandemic
                    taf.pandemic_felt_.Wavebaseline == "Yes" ~ 1 # Have in their life AND before the pandemic
                  )
                      
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_passive_suicidal_ideation)

# Check NAs
dat %>%
  filter(is.na(PREPANDEMIC_passive_suicidal_ideation)) %>%
           freq(taf.worth_living_life_people_.Wavebaseline) # Some NAs are people who said yes to lifetime but then PNTA or NA to pre-pandemic or NA

dat %>%
  filter(is.na(PREPANDEMIC_passive_suicidal_ideation)) %>%
           freq(taf.pandemic_felt_.Wavebaseline)
```

### NEW passive suicidal ideation experience, i.e., those who at baseline indicated no prepandemic experience of passive suicidal ideation and then went on to experience it
Combined - passive suicidal ideation during the pandemic 
*Basically, if someone has said that they experienced it BEFORE the pandemic AND they endorse lifetime experience during the pandemic, it's hard for us to work out whether their experience is ONLY BEFORE the pandemic (therefore, should be 0 for pandemic experience) or whether they are referencing their experience BEFORE the pandemic AND during the pandemic (so should be 1 for pandemic experience). Decided to just look at those with NO prepandemic experience.
```{r Derive NEW passive suicidal ideation experience}
dat <- dat %>%
  mutate(NEW_passive_suicidal_ideation_pandemic =
           case_when(
             PREPANDEMIC_passive_suicidal_ideation == 0 & # No pre-pandemic passive suicidal ideation
               
               #...but occured at least once during the pandemic
                     (TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1   | # either in the past two weeks question
                      EVER_PANDEMIC_passive_suicidal_ideation == 1)  ~ 1, # or in the lifetime question
                     
             
               PREPANDEMIC_passive_suicidal_ideation == 0 & # No pre-pandemic passive suicidal ideation
              EVER_PANDEMIC_passive_suicidal_ideation == 0  ~ 0 # never in their life (therefore don't get asked 2 week question)
                     
          )
  )

dat %>%
  freq(NEW_passive_suicidal_ideation_pandemic) # NAs are because the sample is restricted to those who did NOT report binge eating at baseline

# Check NAs (should all be NA)
dat %>%
  filter(is.na(NEW_passive_suicidal_ideation_pandemic) &
         PREPANDEMIC_passive_suicidal_ideation == 0) %>% # only interested in those without prepandemic experience
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)

dat %>%
  filter(is.na(NEW_passive_suicidal_ideation_pandemic) &
         PREPANDEMIC_passive_suicidal_ideation == 0) %>% # only interested in those without prepandemic experience
  freq(EVER_PANDEMIC_passive_suicidal_ideation)
```
## Sensitivity analysis: No at least 3 times
```{r sensitivity analysis passive suicidal ideation no 3 times}
# Create score of number of Nos
dat <- dat %>%
  mutate(PSS_baseline_no =
           case_when(taf.worth_living_life_people_.Wavebaseline == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave1a_no =
           case_when(taf.worth_living_life_people_.Wave_1a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave1b_no =
           case_when(taf.worth_living_life_people_.Wave_1b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave2a_no =
           case_when(taf.worth_living_life_people_.Wave_2a == "No" ~ 1))
  
dat <- dat %>%
  mutate(PSS_wave2b_no =
           case_when(taf.worth_living_life_people_.Wave_2b == "No" ~ 1))
  
dat <- dat %>%
  mutate(PSS_wave3a_no =
           case_when(taf.worth_living_life_people_.Wave_3a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave3b_no =
           case_when(taf.worth_living_life_people_.Wave_3b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave4a_no =
           case_when(taf.worth_living_life_people_.Wave_4a == "No" ~ 1))
  
dat <- dat %>%
  mutate(PSS_wave4b_no =
           case_when(taf.worth_living_life_people_.Wave_4b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave5a_no =
           case_when(taf.worth_living_life_people_.Wave_5a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave6b_no =
           case_when(taf.worth_living_life_people_.Wave_6b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave7a_no =
           case_when(taf.worth_living_life_people_.Wave_7a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave8b_no =
           case_when(taf.worth_living_life_people_.Wave_8b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave9a_no =
           case_when(taf.worth_living_life_people_.Wave_9a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave10b_no =
           case_when(taf.worth_living_life_people_.Wave_10b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave11a_no =
           case_when(taf.worth_living_life_people_.Wave_11a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave12b_no =
           case_when(taf.worth_living_life_people_.Wave_12b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave13a_no =
           case_when(taf.worth_living_life_people_.Wave_13a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave14b_no =
           case_when(taf.worth_living_life_people_.Wave_14b == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave15a_no =
           case_when(taf.worth_living_life_people_.Wave_15a == "No" ~ 1))

dat <- dat %>%
  mutate(PSS_wave16b_no =
           case_when(taf.worth_living_life_people_.Wave_16b == "No" ~ 1))

# Row sum
dat$PSS_number_of_nos <- rowSums(dat[ ,
                                 c("PSS_baseline_no",
                                   "PSS_wave1a_no",
                                   "PSS_wave1b_no",
                                   "PSS_wave2a_no",
                                   "PSS_wave2b_no",
                                   "PSS_wave3a_no",
                                   "PSS_wave3b_no",
                                   "PSS_wave4a_no",
                                   "PSS_wave4b_no",
                                   "PSS_wave5a_no",
                                   "PSS_wave6b_no",
                                   "PSS_wave7a_no",
                                   "PSS_wave8b_no",
                                   "PSS_wave9a_no",
                                   "PSS_wave10b_no",
                                   "PSS_wave11a_no",
                                   "PSS_wave12b_no",
                                   "PSS_wave13a_no",
                                   "PSS_wave14b_no",
                                   "PSS_wave15a_no",
                                   "PSS_wave16b_no")],
                                    na.rm = TRUE)

# Check 
dat %>%
  freq(PSS_number_of_nos)
```

Sensitivity analysis: NEW passive suicidal ideation
```{r sens analysis Derive NEW passive suicidal ideation experience}
dat <- dat %>%
  mutate(sens_NEW_passive_suicidal_ideation_pandemic =
           case_when(
             PREPANDEMIC_passive_suicidal_ideation == 0 & # No pre-pandemic passive suicidal ideation
               
               #...but occured at least once during the pandemic
                     (TWO_WEEKS_PANDEMIC_passive_suicidal_ideation == 1   | # either in the past two weeks question
                      EVER_PANDEMIC_passive_suicidal_ideation == 1)  ~ 1, # or in the lifetime question
                     
             
              PREPANDEMIC_passive_suicidal_ideation == 0 & # No pre-pandemic passive suicidal ideation
              PSS_number_of_nos >= 3 ~ 0 # said no at least 3 times
                     
          )
  )

dat %>%
  freq(sens_NEW_passive_suicidal_ideation_pandemic) 

# Check NAs (should all be NA)
dat %>%
  filter(is.na(sens_NEW_passive_suicidal_ideation_pandemic) &
         PREPANDEMIC_passive_suicidal_ideation == 0 & # only interested in those without prepandemic experience
           PSS_number_of_nos >= 3) %>% 
  freq(TWO_WEEKS_PANDEMIC_passive_suicidal_ideation)

dat %>%
  filter(is.na(sens_NEW_passive_suicidal_ideation_pandemic) &
         PREPANDEMIC_passive_suicidal_ideation == 0 & # only interested in those without prepandemic experience
           PSS_number_of_nos >= 3) %>% 
  freq(EVER_PANDEMIC_passive_suicidal_ideation)
```

# Outcome = Self-harm ideation
## Derive ANY self-harm ideation during the COVID-19 pandemic
### Experience during past two weeks 
In the follow ups, participants are asked: "Have you contemplated harming yourself?" [If "Yes"] then asked "Have you felt that way in the past two weeks?" (taf.felt_weeks_past.1_.Wave_1a etc)
```{r Self-harm ideation ANY past two weeks pandemic}
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_selfharm_ideation =
           case_when(  taf.felt_weeks_past.1_.Wavebaseline == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_13a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_14b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_15a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_16b == "Yes" ~ 1, # Said "Yes" at any point to the two week question
                        
              # Either never answered screener or DID answer screener but never answered about last two weeks
                (
             (is.na(taf.have_you_contemplated_harming_yourself_.Wavebaseline) |
                 ((taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wavebaseline))) &
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_1a))) &
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_1b))) &
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_2a))) &
                   
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_2b))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_3a))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_3b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_4a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) |
                (taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes" &
               is.na(taf.felt_weeks_past.1_.Wave_4b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_5a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_6b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_7a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_8b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_9a))) & 
               
                      (is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_10b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_11a))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_12b))) & 
                 
                   (is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_13a))) & 
                 
                  (is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_14b))) & 
                 
                 (is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_15a))) & 
                      
                  (is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_16b)))
               ) ~ NA_real_, 
                     
               # Either never experienced it (lifetime) or HAS but not in the last two weeks       
             (
             (taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" | 
               taf.felt_weeks_past.1_.Wavebaseline == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | 
               taf.felt_weeks_past.1_.Wave_1a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | 
               taf.felt_weeks_past.1_.Wave_1b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | 
               taf.felt_weeks_past.1_.Wave_2a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | 
               taf.felt_weeks_past.1_.Wave_2b== "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | 
               taf.felt_weeks_past.1_.Wave_3a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | 
               taf.felt_weeks_past.1_.Wave_3b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | 
               taf.felt_weeks_past.1_.Wave_4a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | 
               taf.felt_weeks_past.1_.Wave_4b == "No") |
               
                 (taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | 
               taf.felt_weeks_past.1_.Wave_5a == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | 
               taf.felt_weeks_past.1_.Wave_6b == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | 
               taf.felt_weeks_past.1_.Wave_7a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | 
               taf.felt_weeks_past.1_.Wave_8b == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" | 
               taf.felt_weeks_past.1_.Wave_9a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | 
               taf.felt_weeks_past.1_.Wave_10b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | 
               taf.felt_weeks_past.1_.Wave_11a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_12b  == "No" | 
               taf.felt_weeks_past.1_.Wave_12b == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_13a  == "No" | 
               taf.felt_weeks_past.1_.Wave_13a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_14b  == "No" | 
               taf.felt_weeks_past.1_.Wave_14b == "No") |
               
                (taf.have_you_contemplated_harming_yourself_.Wave_15a  == "No" | 
               taf.felt_weeks_past.1_.Wave_15a == "No") |
               
               (taf.have_you_contemplated_harming_yourself_.Wave_16b  == "No" | 
               taf.felt_weeks_past.1_.Wave_16b == "No")
             ) ~ 0 
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)

# Check NAs (should be NA or PNTA)
dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wavebaseline)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_1a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_1b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_2a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_2b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_3a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_3b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_4a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_4b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_5a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_6b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_7a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_8b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_9a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_10b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_11a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_12b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_13a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_14b)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_15a)

dat %>%
  filter(is.na(TWO_WEEKS_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_16b)


# No at every phase
dat <- dat %>%
  mutate(TWO_WEEKS_PANDEMIC_selfharm_ideation_every_phase =
           case_when(  taf.felt_weeks_past.1_.Wavebaseline == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_1b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_2b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_3b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_4b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_5a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_6b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_7a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_8b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_9a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_10b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_11a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_12b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_13a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_14b == "Yes" |
                       taf.felt_weeks_past.1_.Wave_15a == "Yes" |
                       taf.felt_weeks_past.1_.Wave_16b == "Yes" ~ 1, # Said "Yes" at any point to the two week question
                        
              # Either never answered screener or DID answer screener but never answered about last two weeks
                (
             (is.na(taf.have_you_contemplated_harming_yourself_.Wavebaseline) |
                 ((taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wavebaseline))) &
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_1a))) &
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_1b))) &
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_2a))) &
                   
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_2b))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_3a))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_3b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_4a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) |
                (taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes" &
               is.na(taf.felt_weeks_past.1_.Wave_4b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_5a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_6b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_7a))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_8b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_9a))) & 
               
                      (is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_10b))) & 
               
               (is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_11a))) & 
               
                (is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_12b))) & 
                 
                   (is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) |
               ((taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_13a))) & 
                 
                  (is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_14b))) & 
                 
                 (is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) |
                ((taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_15a))) & 
                      
                  (is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) |
                 ((taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" | 
                 taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once") &
               is.na(taf.felt_weeks_past.1_.Wave_16b)))
               ) ~ NA_real_, 
                     
               # Either never experienced it (lifetime) or HAS but not in the last two weeks       
             (
             (taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" | 
               taf.felt_weeks_past.1_.Wavebaseline == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | 
               taf.felt_weeks_past.1_.Wave_1a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | 
               taf.felt_weeks_past.1_.Wave_1b == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | 
               taf.felt_weeks_past.1_.Wave_2a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | 
               taf.felt_weeks_past.1_.Wave_2b== "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | 
               taf.felt_weeks_past.1_.Wave_3a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | 
               taf.felt_weeks_past.1_.Wave_3b == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | 
               taf.felt_weeks_past.1_.Wave_4a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | 
               taf.felt_weeks_past.1_.Wave_4b == "No") &
               
                 (taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | 
               taf.felt_weeks_past.1_.Wave_5a == "No") &
               
                (taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | 
               taf.felt_weeks_past.1_.Wave_6b == "No") &
               
                (taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | 
               taf.felt_weeks_past.1_.Wave_7a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | 
               taf.felt_weeks_past.1_.Wave_8b == "No") &
               
                (taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" | 
               taf.felt_weeks_past.1_.Wave_9a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | 
               taf.felt_weeks_past.1_.Wave_10b == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | 
               taf.felt_weeks_past.1_.Wave_11a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_12b  == "No" | 
               taf.felt_weeks_past.1_.Wave_12b == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_13a  == "No" | 
               taf.felt_weeks_past.1_.Wave_13a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_14b  == "No" | 
               taf.felt_weeks_past.1_.Wave_14b == "No") &
               
                (taf.have_you_contemplated_harming_yourself_.Wave_15a  == "No" | 
               taf.felt_weeks_past.1_.Wave_15a == "No") &
               
               (taf.have_you_contemplated_harming_yourself_.Wave_16b  == "No" | 
               taf.felt_weeks_past.1_.Wave_16b == "No")
             ) ~ 0 
                    
           ))

# Check
dat %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation_every_phase)
```


### Experience ever
In the follow ups, participants are also asked lifetime self-harm ideation: "Have you contemplated harming yourself?". We need to capture both; people might endorse lifetime experience but not have felt that way in the past two weeks (either if they missed out on a follow up questionnaire so the gap between them was longer than two weeks, or because they've answered at a monthly follow-up [i.e., from August 2020 onwards])
```{r Self-harm ideation EVER pandemic}
# Experience EVER
dat <- dat %>%
  mutate(EVER_PANDEMIC_selfharm_ideation =
           case_when(
                      (taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" |
                       
                       taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, more than once" |
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, more than once") 
                     ~ 1, # "Yes" at at least one phase
                       
                      (is.na(taf.have_you_contemplated_harming_yourself_.Wavebaseline) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) &
                        is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) &
                       is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b))
                       ~ NA_real_, # Missing at every phase
                     
                       (taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" |
                         taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" |
                       taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_12b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_13a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_14b == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_15a == "No" | 
                       taf.have_you_contemplated_harming_yourself_.Wave_16b == "No")  ~ 0 # "No" at least once and never said "Yes"
                     )
         )

# Check
dat %>%
  freq(EVER_PANDEMIC_selfharm_ideation)

# Check NAs (should all be NA or PNTA)
dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wavebaseline)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_1a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_1b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_2a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_2b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_3a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_3b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_4a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_4b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_5a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_6b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_7a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_8b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_9a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_10b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_11a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_12b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_13a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_14b)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_15a)

dat %>%
  filter(is.na(EVER_PANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_16b)
```

### PREPANDEMIC self-harm ideation 
At baseline, participants are first asked: "Have you contemplated harming yourself ?" (taf.have_you_contemplated_harming_yourself_.Wavebaseline) Only those who say "Yes" are then asked "Had you felt that way before the pandemic?" (taf.pandemic_felt.1_.Wavebaseline). Therefore, we need to count those say "No" to the first question, AND those who say "Yes" to the first but "No" to the second as having no prepandemic experience.

```{r Self-harm ideation prepandemic experience}
dat <- dat %>%
  mutate(PREPANDEMIC_selfharm_ideation =
           case_when(
                     taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" ~ 0, # Never experienced it in their life
                     
                     taf.pandemic_felt.1_.Wavebaseline == "No" ~ 0, # Have experienced it in their life but not before the pandemic
                     taf.pandemic_felt.1_.Wavebaseline == "Yes" ~ 1 # Have experienced it before in their life and before the pandemic
                     )
           )
    
# Check 
dat %>%
  freq(PREPANDEMIC_selfharm_ideation)

# Check NAs
dat %>%
  filter(is.na(PREPANDEMIC_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wavebaseline) # Again, some NAs are people who said Yes to lifetime but then did not answer or PNTA for pre-pandemic question

dat %>%
  filter(is.na(PREPANDEMIC_selfharm_ideation)) %>%
  freq(taf.pandemic_felt.1_.Wavebaseline)
```

### NEW self-harm ideation experience, i.e., those who at baseline indicated no prepandemic experience of self-harm ideation
```{r Derive NEW self harm ideation experience}
dat <- dat %>%
  mutate(NEW_selfharm_ideation_pandemic =
           case_when(
             PREPANDEMIC_selfharm_ideation == 0 & # No pre-pandemic self-harm ideation
               
               #...but occured at least once during the pandemic
                     (TWO_WEEKS_PANDEMIC_selfharm_ideation == 1   | # either in the past two weeks question
                      EVER_PANDEMIC_selfharm_ideation == 1)  ~ 1, # or in the lifetime question
                     
             
               PREPANDEMIC_selfharm_ideation == 0 & # No pre-pandemic self-harm ideation
                EVER_PANDEMIC_selfharm_ideation == 0  ~ 0 # & never in their life (therefore don't get asked 2 week question)
                     
          )
  )

dat %>%
  freq(NEW_selfharm_ideation_pandemic) 

# Check NAs
dat %>%
  filter(is.na(NEW_selfharm_ideation_pandemic) &
           PREPANDEMIC_selfharm_ideation == 0) %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)

dat %>%
  filter(is.na(NEW_selfharm_ideation_pandemic) &
           PREPANDEMIC_selfharm_ideation == 0) %>%
  freq(EVER_PANDEMIC_selfharm_ideation)
```

## Sensitivity analysis: No at least 3 times
```{r sensitivity analysis self-harm ideation no 3 times}
# Create score of number of Nos
dat <- dat %>%
  mutate(SHI_baseline_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wavebaseline == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave1a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_1a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave1b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_1b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave2a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_2a == "No" ~ 1))
  
dat <- dat %>%
  mutate(SHI_wave2b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_2b == "No" ~ 1))
  
dat <- dat %>%
  mutate(SHI_wave3a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_3a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave3b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_3b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave4a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_4a == "No" ~ 1))
  
dat <- dat %>%
  mutate(SHI_wave4b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_4b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave5a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_5a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave6b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_6b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave7a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_7a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave8b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_8b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave9a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_9a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave10b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_10b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave11a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_11a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave12b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_12b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave13a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_13a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave14b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_14b == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave15a_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_15a == "No" ~ 1))

dat <- dat %>%
  mutate(SHI_wave16b_no =
           case_when(taf.have_you_contemplated_harming_yourself_.Wave_16b == "No" ~ 1))

# Row sum
dat$SHI_number_of_nos <- rowSums(dat[ ,
                                 c("SHI_baseline_no",
                                   "SHI_wave1a_no",
                                   "SHI_wave1b_no",
                                   "SHI_wave2a_no",
                                   "SHI_wave2b_no",
                                   "SHI_wave3a_no",
                                   "SHI_wave3b_no",
                                   "SHI_wave4a_no",
                                   "SHI_wave4b_no",
                                   "SHI_wave5a_no",
                                   "SHI_wave6b_no",
                                   "SHI_wave7a_no",
                                   "SHI_wave8b_no",
                                   "SHI_wave9a_no",
                                   "SHI_wave10b_no",
                                   "SHI_wave11a_no",
                                   "SHI_wave12b_no",
                                   "SHI_wave13a_no",
                                   "SHI_wave14b_no",
                                   "SHI_wave15a_no",
                                   "SHI_wave16b_no")],
                                    na.rm = TRUE)

# Check 
dat %>%
  freq(SHI_number_of_nos)
```

Sensitivity analysis: NEW self-harm ideation
```{r sens analysis Derive NEW self harm ideation experience}
dat <- dat %>%
  mutate(sens_NEW_selfharm_ideation_pandemic =
           case_when(
             PREPANDEMIC_selfharm_ideation == 0 & # No pre-pandemic self-harm ideation
               
               #...but occured at least once during the pandemic
                     (TWO_WEEKS_PANDEMIC_selfharm_ideation == 1   | # either in the past two weeks question
                      EVER_PANDEMIC_selfharm_ideation == 1)  ~ 1, # or in the lifetime question
                     
             
               PREPANDEMIC_selfharm_ideation == 0 & # No pre-pandemic self-harm ideation
                SHI_number_of_nos >= 3  ~ 0 # at least 3 Nos
                     
          )
  )

dat %>%
  freq(sens_NEW_selfharm_ideation_pandemic) 

# Check NAs
dat %>%
  filter(is.na(NEW_selfharm_ideation_pandemic) &
           PREPANDEMIC_selfharm_ideation == 0 &
           SHI_number_of_nos >= 3) %>%
  freq(TWO_WEEKS_PANDEMIC_selfharm_ideation)

dat %>%
  filter(is.na(NEW_selfharm_ideation_pandemic) &
           PREPANDEMIC_selfharm_ideation == 0 &
           SHI_number_of_nos >= 3) %>%
  freq(EVER_PANDEMIC_selfharm_ideation)
```

#### Combine self-harm ideation and passive suicidal ideation (correlation of 0.87)
```{r combining self-harm and suicidal ideation main analysis}
dat <- dat %>%
  mutate(NEW_harmful_ideation_pandemic =
           case_when(
             NEW_selfharm_ideation_pandemic == 1 |
             NEW_passive_suicidal_ideation_pandemic == 1 ~ 1,
             
             NEW_selfharm_ideation_pandemic == 0 &
             NEW_passive_suicidal_ideation_pandemic == 0 ~ 0
             
           ))

# Check
dat %>%
  freq(NEW_harmful_ideation_pandemic)

# Check NAs
dat %>%
  filter(is.na(NEW_harmful_ideation_pandemic)) %>%
  freq(NEW_selfharm_ideation_pandemic)

dat %>%
  filter(is.na(NEW_harmful_ideation_pandemic)) %>%
  freq(NEW_passive_suicidal_ideation_pandemic)

dat %>% 
  filter(is.na(NEW_harmful_ideation_pandemic) &
           (!is.na(NEW_passive_suicidal_ideation_pandemic) |
              !is.na(NEW_selfharm_ideation_pandemic))
         ) %>%
  select(NEW_passive_suicidal_ideation_pandemic,
         NEW_selfharm_ideation_pandemic) # Some people missing have a 0 for one but are NA for the other. Can not assume they have not experienced some form of harmful ideation so have to drop from this variable. 
```

```{r combining self-harm and suicidal ideation main analysis}
dat <- dat %>%
  mutate(sens_NEW_harmful_ideation_pandemic =
           case_when(
               sens_NEW_selfharm_ideation_pandemic == 1 |
               sens_NEW_passive_suicidal_ideation_pandemic == 1 ~ 1,
             
               sens_NEW_selfharm_ideation_pandemic == 0 &
               sens_NEW_passive_suicidal_ideation_pandemic == 0 ~ 0
             
           ))

# Check
dat %>%
  freq(sens_NEW_harmful_ideation_pandemic)

# Check NAs
dat %>% 
  filter(is.na(sens_NEW_harmful_ideation_pandemic) &
           (!is.na(NEW_passive_suicidal_ideation_pandemic) |
              !is.na(NEW_selfharm_ideation_pandemic))
         ) %>%
  select(NEW_passive_suicidal_ideation_pandemic,
         NEW_selfharm_ideation_pandemic) # Again, some people missing have a 0 for one but are NA for the other. Can not assume they have not experienced some form of harmful ideation so have to drop from this variable. 
```

# Identify at which phase they first experienced the outcome
This is for ensuring the exposure is reported either BEFORE or in the SAME PHASE as the outcome. E.g,. we do not want to include cases of binge eating (for example) if they exposure (e.g., living situation change) was self-reported AFTER the binge eating.
First, need to identify at which phase participants first experienced each outcome, to ensure that their experience of the exposure happened BEFORE the outcome.

Passive suicidal ideation
```{r Identify phase at which outcome first experienced - passive suicidal ideation}
dat <- dat %>%
  mutate(outcome_phase_passive_suicidal_ideation =
           case_when( 
                      
                      (
                         # Either hasn't answered or is PNTA for LIFETIME and for TWO WEEKS at baseline
                      ((is.na(taf.felt_weeks_past_.Wavebaseline) |
                        taf.felt_weeks_past_.Wavebaseline == "Prefer not to answer") &
                      
                         (is.na(taf.worth_living_life_people_.Wavebaseline) |
                      taf.worth_living_life_people_.Wavebaseline == "Prefer not to answer")) &
                        
                        # Either hasn't answered or is PNTA for 1a
                        ((is.na(taf.felt_weeks_past_.Wave_1a) |
                         taf.felt_weeks_past_.Wave_1a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_1a) |
                        taf.worth_living_life_people_.Wave_1a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 1b
                      ((is.na(taf.felt_weeks_past_.Wave_1b) |
                         taf.felt_weeks_past_.Wave_1b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_1b) |
                        taf.worth_living_life_people_.Wave_1b == "Prefer not to answer")) &
                        
                      # Either hasn't answered or is PNTA for 2a
                      ((is.na(taf.felt_weeks_past_.Wave_2a) |
                         taf.felt_weeks_past_.Wave_2a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_2a) |
                        taf.worth_living_life_people_.Wave_2a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 2b
                      ((is.na(taf.felt_weeks_past_.Wave_2b) |
                         taf.felt_weeks_past_.Wave_2b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_2b) |
                        taf.worth_living_life_people_.Wave_2b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 3a
                      ((is.na(taf.felt_weeks_past_.Wave_3a) |
                         taf.felt_weeks_past_.Wave_3a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_3a) |
                        taf.worth_living_life_people_.Wave_3a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 3b
                      ((is.na(taf.felt_weeks_past_.Wave_3b) |
                         taf.felt_weeks_past_.Wave_3b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_3b) |
                        taf.worth_living_life_people_.Wave_3b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 4a
                      ((is.na(taf.felt_weeks_past_.Wave_4a) |
                         taf.felt_weeks_past_.Wave_4a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_4a) |
                        taf.worth_living_life_people_.Wave_4a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 4b
                      ((is.na(taf.felt_weeks_past_.Wave_4b) |
                         taf.felt_weeks_past_.Wave_4b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_4b) |
                        taf.worth_living_life_people_.Wave_4b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 5a
                      ((is.na(taf.felt_weeks_past_.Wave_5a) |
                         taf.felt_weeks_past_.Wave_5a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_5a) |
                        taf.worth_living_life_people_.Wave_5a == "Prefer not to answer")) &
                    
                     # Either hasn't answered or is PNTA for 6b
                      ((is.na(taf.felt_weeks_past_.Wave_6b) |
                         taf.felt_weeks_past_.Wave_6b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_6b) |
                        taf.worth_living_life_people_.Wave_6b == "Prefer not to answer")) &
                     
                     # Either hasn't answered or is PNTA for 7a
                      ((is.na(taf.felt_weeks_past_.Wave_7a) |
                         taf.felt_weeks_past_.Wave_7a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_7a) |
                        taf.worth_living_life_people_.Wave_7a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 8b
                      ((is.na(taf.felt_weeks_past_.Wave_8b) |
                         taf.felt_weeks_past_.Wave_8b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_8b) |
                        taf.worth_living_life_people_.Wave_8b == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 9a
                      ((is.na(taf.felt_weeks_past_.Wave_9a) |
                         taf.felt_weeks_past_.Wave_9a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_9a) |
                        taf.worth_living_life_people_.Wave_9a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 10b
                      ((is.na(taf.felt_weeks_past_.Wave_10b) |
                         taf.felt_weeks_past_.Wave_10b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_10b) |
                        taf.worth_living_life_people_.Wave_10b == "Prefer not to answer")) &
                         
                    # Either hasn't answered or is PNTA for 11a
                      ((is.na(taf.felt_weeks_past_.Wave_11a) |
                         taf.felt_weeks_past_.Wave_11a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_11a) |
                        taf.worth_living_life_people_.Wave_11a == "Prefer not to answer")) &
                         
                         # Either hasn't answered or is PNTA for 12b
                      ((is.na(taf.felt_weeks_past_.Wave_12b) |
                         taf.felt_weeks_past_.Wave_12b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_12b) |
                        taf.worth_living_life_people_.Wave_12b == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 13a
                      ((is.na(taf.felt_weeks_past_.Wave_13a) |
                         taf.felt_weeks_past_.Wave_13a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_13a) |
                        taf.worth_living_life_people_.Wave_13a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 14b
                      ((is.na(taf.felt_weeks_past_.Wave_14b) |
                         taf.felt_weeks_past_.Wave_14b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_14b) |
                        taf.worth_living_life_people_.Wave_14b == "Prefer not to answer")) &
                      
                       # Either hasn't answered or is PNTA for 15a
                      ((is.na(taf.felt_weeks_past_.Wave_15a) |
                         taf.felt_weeks_past_.Wave_15a == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_15a) |
                        taf.worth_living_life_people_.Wave_15a == "Prefer not to answer")) &
                      
                      # Either hasn't answered or is PNTA for 16b
                      ((is.na(taf.felt_weeks_past_.Wave_16b) |
                         taf.felt_weeks_past_.Wave_16b == "Prefer not to answer") & 
                         
                        (is.na(taf.worth_living_life_people_.Wave_16b) |
                        taf.worth_living_life_people_.Wave_16b == "Prefer not to answer")) 
                    
                    ) ~ "Not answered or PNTA",
                   
                    # Either endorsed 2 week experience at a certain phase AND/OR endorsed LIFETIME and having NOT experienced it before the pandemic
                    (
                     PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wavebaseline == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wavebaseline == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wavebaseline == "Yes, more than once"))
                    ) ~ "Baseline", # Prepandemic
                    
                    (
                    PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_1a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_1a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_1a == "Yes, more than once"))
                    ) ~ "1a", # Prepandemic
                    
                    (
                     PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_1b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_1b== "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_1b == "Yes, more than once"))
                    ) ~ "1b", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_2a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_2a== "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_2a == "Yes, more than once"))
                    ) ~ "2a", # Prepandemic
           
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_2b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_2b== "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_2b == "Yes, more than once"))
                    ) ~ "2b", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_3a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_3a== "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_3a == "Yes, more than once"))
                    ) ~ "3a", # Prepandemic
           
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_3b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_3b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_3b  == "Yes, more than once"))
                    ) ~ "3b", # Prepandemic
           
                     (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_4a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_4a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_4a  == "Yes, more than once"))
                    ) ~ "4a", # Prepandemic
           
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_4b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_4b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_4b  == "Yes, more than once"))
                    ) ~ "4b", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_5a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_5a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_5a  == "Yes, more than once"))
                    ) ~ "5a", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_6b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_6b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_6b  == "Yes, more than once"))
                    ) ~ "6b", # Prepandemic
                    
                     
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_7a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_7a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_7a  == "Yes, more than once"))
                    ) ~ "7a", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_8b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_8b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_8b  == "Yes, more than once"))
                    ) ~ "8b", # Prepandemic
                    
                 
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_9a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_9a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_9a  == "Yes, more than once"))
                    ) ~ "9a", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_10b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_10b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_10b  == "Yes, more than once"))
                    ) ~ "10b", # Prepandemic
                    
                     (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_11a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_11a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_11a  == "Yes, more than once"))
                    ) ~ "11a", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_12b  == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_12b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_12b  == "Yes, more than once"))
                    ) ~ "12b", # Prepandemic
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_13a  == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_13a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_13a  == "Yes, more than once"))
                    ) ~ "13a", # Prepandemic
                 
                    
                    (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_14b  == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_14b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_14b  == "Yes, more than once"))
                    ) ~ "14b", # Prepandemic
                 
                    
                      (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_15a == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_15a == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_15a  == "Yes, more than once"))
                    ) ~ "15a", # Prepandemic
                 
                     
                     (
                      PREPANDEMIC_passive_suicidal_ideation == 0 &
                    (taf.felt_weeks_past_.Wave_16b == "Yes" | # past 2 weeks 
                      (taf.worth_living_life_people_.Wave_16b == "Yes, once" |  # Lifetime
                       taf.worth_living_life_people_.Wave_16b  == "Yes, more than once"))
                    ) ~ "16b", # Prepandemic
                 
                    TRUE ~ "Not experienced"
                    
                    )
         )

# Check
dat %>%
  freq(outcome_phase_passive_suicidal_ideation)

# Check NAs
dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wavebaseline)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_1a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_1b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_2a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_2b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_3a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_3b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_4a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_4b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_5a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_6b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_7a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_8b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_9a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_10b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_11a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_12b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_13a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_14b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_15a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.worth_living_life_people_.Wave_16b)


# Check NAs
dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wavebaseline)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_1a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_1b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_2a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_2b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_3a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_3b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_4a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_4b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_5a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_6b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_7a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_8b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_9a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_10b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_11a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_12b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_13a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_14b)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_15a)

dat %>%
  filter(is.na(outcome_phase_passive_suicidal_ideation)) %>%
  freq(taf.felt_weeks_past_.Wave_16b)
```

Self-harm ideation
```{r Identify phase at which outcome first experienced - self-harm ideation}
dat <- dat %>%
  mutate(outcome_phase_selfharm_ideation =
           case_when( 
             # Either hasn't answered screener/PNTA OR has but then not answered/PNTA for the 2 week question
                      (
                        # Either hasn't answered or is PNTA for baseline
                      ((is.na(taf.felt_weeks_past.1_.Wavebaseline) |
                        taf.felt_weeks_past.1_.Wavebaseline == "Prefer not to answer") &
                      
                         (is.na(taf.have_you_contemplated_harming_yourself_.Wavebaseline) |
                      taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Prefer not to answer")) &
                        
                       # Either hasn't answered or is PNTA for 1a
                      
                        ((is.na(taf.felt_weeks_past.1_.Wave_1a) |
                         taf.felt_weeks_past.1_.Wave_1a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_1a == "Prefer not to answer")) &
                          
                        # Either hasn't answered or is PNTA for 1b
                        ((is.na(taf.felt_weeks_past.1_.Wave_1b) |
                         taf.felt_weeks_past.1_.Wave_1b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_1b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_1b == "Prefer not to answer")) &
                           
                          # Either hasn't answered or is PNTA for 2a
                        ((is.na(taf.felt_weeks_past.1_.Wave_2a) |
                         taf.felt_weeks_past.1_.Wave_2a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_2a == "Prefer not to answer")) &
                        
                           # Either hasn't answered or is PNTA for 2b
                        ((is.na(taf.felt_weeks_past.1_.Wave_2b) |
                         taf.felt_weeks_past.1_.Wave_2b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_2b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_2b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 3a
                        ((is.na(taf.felt_weeks_past.1_.Wave_3a) |
                         taf.felt_weeks_past.1_.Wave_3a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_3a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 3b
                        ((is.na(taf.felt_weeks_past.1_.Wave_3b) |
                         taf.felt_weeks_past.1_.Wave_3b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_3b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_3b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 4a
                        ((is.na(taf.felt_weeks_past.1_.Wave_4a) |
                         taf.felt_weeks_past.1_.Wave_4a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_4a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 4b
                        ((is.na(taf.felt_weeks_past.1_.Wave_4b) |
                         taf.felt_weeks_past.1_.Wave_4b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_4b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_4b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 5a
                        ((is.na(taf.felt_weeks_past.1_.Wave_5a) |
                         taf.felt_weeks_past.1_.Wave_5a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_5a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_5a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 6b
                        ((is.na(taf.felt_weeks_past.1_.Wave_6b) |
                         taf.felt_weeks_past.1_.Wave_6b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_6b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_6b == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 7a
                        ((is.na(taf.felt_weeks_past.1_.Wave_7a) |
                         taf.felt_weeks_past.1_.Wave_7a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_7a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_7a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 8b
                        ((is.na(taf.felt_weeks_past.1_.Wave_8b) |
                         taf.felt_weeks_past.1_.Wave_8b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_8b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_8b == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 9a
                        ((is.na(taf.felt_weeks_past.1_.Wave_9a) |
                         taf.felt_weeks_past.1_.Wave_9a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_9a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_9a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 10b
                        ((is.na(taf.felt_weeks_past.1_.Wave_10b) |
                         taf.felt_weeks_past.1_.Wave_10b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_10b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_10b == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 11a
                        ((is.na(taf.felt_weeks_past.1_.Wave_11a) |
                         taf.felt_weeks_past.1_.Wave_11a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_11a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_11a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 12b
                        ((is.na(taf.felt_weeks_past.1_.Wave_12b) |
                         taf.felt_weeks_past.1_.Wave_12b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_12b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_12b == "Prefer not to answer")) &
                      
                        # Either hasn't answered or is PNTA for 13a
                        ((is.na(taf.felt_weeks_past.1_.Wave_13a) |
                         taf.felt_weeks_past.1_.Wave_13a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_13a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_13a == "Prefer not to answer")) &
                          
                          # Either hasn't answered or is PNTA for 14b
                        ((is.na(taf.felt_weeks_past.1_.Wave_14b) |
                         taf.felt_weeks_past.1_.Wave_14b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_14b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_14b == "Prefer not to answer")) &
                        
                        # Either hasn't answered or is PNTA for 15a
                        ((is.na(taf.felt_weeks_past.1_.Wave_15a) |
                         taf.felt_weeks_past.1_.Wave_15a == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_15a) |
                        taf.have_you_contemplated_harming_yourself_.Wave_15a == "Prefer not to answer")) &
                          
                           # Either hasn't answered or is PNTA for 16b
                        ((is.na(taf.felt_weeks_past.1_.Wave_16b) |
                         taf.felt_weeks_past.1_.Wave_16b == "Prefer not to answer") & 
                         
                        (is.na(taf.have_you_contemplated_harming_yourself_.Wave_16b) |
                        taf.have_you_contemplated_harming_yourself_.Wave_16b == "Prefer not to answer")) 
                          
                      ) ~ "Not answered or PNTA",
                        
                           
                    # Either endorsed 2 week experience at a certain phase AND/OR endorsed LIFETIME and having NOT experienced it before the pandemic
                                      (
                     PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wavebaseline == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wavebaseline == "Yes, more than once"))
                    ) ~ "Baseline", # Prepandemic
                    
                    (
                    PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_1a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_1a == "Yes, more than once"))
                    ) ~ "1a", # Prepandemic
                    
                    (
                     PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_1b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_1b== "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_1b == "Yes, more than once"))
                    ) ~ "1b", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_2a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_2a== "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_2a == "Yes, more than once"))
                    ) ~ "2a", # Prepandemic
           
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_2b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_2b== "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_2b == "Yes, more than once"))
                    ) ~ "2b", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_3a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_3a== "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_3a == "Yes, more than once"))
                    ) ~ "3a", # Prepandemic
           
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_3b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_3b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_3b  == "Yes, more than once"))
                    ) ~ "3b", # Prepandemic
           
                     (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_4a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_4a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_4a  == "Yes, more than once"))
                    ) ~ "4a", # Prepandemic
           
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_4b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_4b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_4b  == "Yes, more than once"))
                    ) ~ "4b", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_5a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_5a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_5a  == "Yes, more than once"))
                    ) ~ "5a", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_6b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_6b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_6b  == "Yes, more than once"))
                    ) ~ "6b", # Prepandemic
                    
                     
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_7a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_7a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_7a  == "Yes, more than once"))
                    ) ~ "7a", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_8b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_8b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_8b  == "Yes, more than once"))
                    ) ~ "8b", # Prepandemic
                    
                 
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_9a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_9a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_9a  == "Yes, more than once"))
                    ) ~ "9a", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_10b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_10b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_10b  == "Yes, more than once"))
                    ) ~ "10b", # Prepandemic
                    
                     (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_11a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_11a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_11a  == "Yes, more than once"))
                    ) ~ "11a", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_12b  == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_12b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_12b  == "Yes, more than once"))
                    ) ~ "12b", # Prepandemic
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_13a  == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_13a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_13a  == "Yes, more than once"))
                    ) ~ "13a", # Prepandemic
                 
                    
                    (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_14b  == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_14b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_14b  == "Yes, more than once"))
                    ) ~ "14b", # Prepandemic
                 
                    
                      (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_15a == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_15a == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_15a  == "Yes, more than once"))
                    ) ~ "15a", # Prepandemic
                 
                     
                     (
                      PREPANDEMIC_selfharm_ideation == 0 &
                    (taf.felt_weeks_past.1_.Wave_16b == "Yes" | # past 2 weeks 
                      (taf.have_you_contemplated_harming_yourself_.Wave_16b == "Yes, once" |  # Lifetime
                       taf.have_you_contemplated_harming_yourself_.Wave_16b  == "Yes, more than once"))
                    ) ~ "16b", # Prepandemic
                    
                    TRUE ~ "Not experienced"
           )
  )

# Check
dat %>%
  freq(outcome_phase_selfharm_ideation)


# Check NAs
dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wavebaseline)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_1a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_1b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_2a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_2b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_3a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_3b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_4a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_4b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_5a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_6b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_7a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_8b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_9a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_10b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_11a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_12b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_13a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_14b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_15a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.felt_weeks_past.1_.Wave_16b)


# Check NAs
dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wavebaseline)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_1a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_1b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_2a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_2b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_3a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_3b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_4a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_4b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_5a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_6b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_7a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_8b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_9a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_10b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_11a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_12b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_13a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_14b)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_15a)

dat %>%
  filter(is.na(outcome_phase_selfharm_ideation)) %>%
  freq(taf.have_you_contemplated_harming_yourself_.Wave_16b)
```

Combine self-harm ideation and suicidal ideation - phase first experienced
```{r combine ideation for first phase experienced}
dat <- dat %>%
  mutate(outcome_phase_harmful_ideation =
           case_when(
             outcome_phase_selfharm_ideation == "Baseline" |
             outcome_phase_passive_suicidal_ideation == "Baseline" ~ "Baseline",
             
             outcome_phase_selfharm_ideation == "1a" |
             outcome_phase_passive_suicidal_ideation == "1a" ~ "1a",
             
             outcome_phase_selfharm_ideation == "1b" |
             outcome_phase_passive_suicidal_ideation == "1b" ~ "1b",
             
             outcome_phase_selfharm_ideation == "2a" |
             outcome_phase_passive_suicidal_ideation == "2a" ~ "2a",
             
             outcome_phase_selfharm_ideation == "2b" |
             outcome_phase_passive_suicidal_ideation == "2b" ~ "2b",
             
             outcome_phase_selfharm_ideation == "3a" |
             outcome_phase_passive_suicidal_ideation == "3a" ~ "3a",
             
             outcome_phase_selfharm_ideation == "3b" |
             outcome_phase_passive_suicidal_ideation == "3b" ~ "3b",
             
             outcome_phase_selfharm_ideation == "4a" |
             outcome_phase_passive_suicidal_ideation == "4a" ~ "4a",
             
              outcome_phase_selfharm_ideation == "4b" |
             outcome_phase_passive_suicidal_ideation == "4b" ~ "4b",
             
              outcome_phase_selfharm_ideation == "5a" |
             outcome_phase_passive_suicidal_ideation == "5a" ~ "5a",
             
             outcome_phase_selfharm_ideation == "6b" |
             outcome_phase_passive_suicidal_ideation == "6b" ~ "6b",
             
             outcome_phase_selfharm_ideation == "7a" |
             outcome_phase_passive_suicidal_ideation == "7a" ~ "7a",
             
             outcome_phase_selfharm_ideation == "8b" |
             outcome_phase_passive_suicidal_ideation == "8b" ~ "8b",
             
             outcome_phase_selfharm_ideation == "9a" |
             outcome_phase_passive_suicidal_ideation == "9a" ~ "9a",
             
             outcome_phase_selfharm_ideation == "10b" |
             outcome_phase_passive_suicidal_ideation == "10b" ~ "10b",
             
             outcome_phase_selfharm_ideation == "11a" |
             outcome_phase_passive_suicidal_ideation == "11a" ~ "11a",
             
             outcome_phase_selfharm_ideation == "12b" |
             outcome_phase_passive_suicidal_ideation == "12b" ~ "12b",
             
             outcome_phase_selfharm_ideation == "13a" |
             outcome_phase_passive_suicidal_ideation == "13a" ~ "13a",
             
             outcome_phase_selfharm_ideation == "14b" |
             outcome_phase_passive_suicidal_ideation == "14b" ~ "14b",
             
             outcome_phase_selfharm_ideation == "15a" |
             outcome_phase_passive_suicidal_ideation == "15a" ~ "15a",
             
             outcome_phase_selfharm_ideation == "16b" |
             outcome_phase_passive_suicidal_ideation == "16b" ~ "16b",
             
             outcome_phase_selfharm_ideation == "Not experienced" &
             outcome_phase_passive_suicidal_ideation ==  "Not experienced" ~ "Not experienced",
             
             TRUE ~ "Not answered or PNTA"
           ))

# Check
dat %>%
  freq(outcome_phase_harmful_ideation)

# Check NAs
dat %>%
  filter(is.na(outcome_phase_harmful_ideation)) %>%
  freq(outcome_phase_selfharm_ideation)

dat %>%
  filter(is.na(outcome_phase_harmful_ideation)) %>%
  freq(outcome_phase_passive_suicidal_ideation)
```

# EXPOSURES / EXPLANATORY VARIABLES
[NB: for the below exposures, will need to derive these differently depending on the outcome because they were reported at every/every other phase and we are taking only those reported BEFORE or in the SAME PHASE as the outcome]
  • Positive COVID test or ill due to COVID  
  • Loss of loved one due to COVID
  • Change in economic activity
  • Change in living situation
  
*The below use follow-up data and are coded so that exposures are only counted if they happened before or in same phase as the outcome*

## Positive covid test - three questionnaires (virus, resp, & dem)
NB: For the 'virus' questionnaire, there is no baseline assessment. However, there is a 'resp' questionnaire that is asked at baseline and at every follow up phase, so will include positive tests indicated in this questionnaire too, as well as people who indicated they were unwell with coronavirus in any of the demographic questionnaires.

Need to ensure COVID test occurred BEFORE outcomes - create new variable for COVID test that only counts positive tests as ones that occurred BEFORE each outcome. Will exclude anyone from the analysis if they experienced outcome before exposure, EVEN if it went: outcome → exposure → outcome. Should look at whether their FIRST experience of outcome came before (or at the same time of) their FIRST experience of exposure

Will also include co-occurring symptoms, but as a sensitivity analysis will get rid to further assess causal hypothesis.

### Identify at which phase they first experienced the exposure
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - positive COVID test - virus, dem and resp Q}
dat <- dat %>%
  mutate(exposure_phase_positive_covid_test =
           case_when(
             # Virus questionnaire - all missing (Have you ever had a COVID-19 test? Please include any tests you've reported in past surveys.)
             (is.na(virus.past_surveys_include_covid19_.Wave_1b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_2b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_3b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_4b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_6b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_8b)  &
                       is.na(virus.past_surveys_include_covid19_.Wave_10b) &
                       is.na(virus.past_surveys_include_covid19_.Wave_12b) &
                       is.na(virus.past_surveys_include_covid19_.Wave_14b) &
                       is.na(virus.past_surveys_include_covid19_.Wave_16b) & 
           
            # Resp questionnaire - all missing
                       is.na(resp.coronavirus_test_nosethroat_swab) &
                       is.na(resp.coronavirus_antibody_test) &
                       is.na(resp.coronavirus_test_nosethroat_swab_.Wave_1a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_1a) &
                        is.na(resp.coronavirus_test_nosethroat_swab_.Wave_1b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_1b) & 
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_2a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_2a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_2b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_2b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_3a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_3a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_3b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_3b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_4a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_4a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_4b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_4b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_5a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_5a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_6b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_6b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_7a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_7a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_8b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_8b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_9a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_9a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_10b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_10b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_11a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_11a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_12b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_12b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_13a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_13a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_14b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_14b) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_15a) &
                       is.na(resp.coronavirus_antibody_test_.Wave_15a) &
                         is.na(resp.coronavirus_test_nosethroat_swab_.Wave_16b) &
                       is.na(resp.coronavirus_antibody_test_.Wave_16b) &
                        
              
                # Demographics questionnaire - all missing (In the last two weeks, has your physical health changed because you became unwell with the coronavirus?)
                        is.na(dem.unwell_coronavirus_weeks_physical_.Wave_1a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_1b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_2a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_2b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_3a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_3b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_4a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_4b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_5a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_6b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_7a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_8b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_9a) &
                        is.na(dem.unwell_coronavirus_weeks_physical_.Wave_10b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_11a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_12b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_13a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_14b) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_15a) &
                         is.na(dem.unwell_coronavirus_weeks_physical_.Wave_16b)) ~ "All missing",
             
             # Virus questionnaire - No at least once and rest missing (i.e., never said yes to taking a test)        
                       ((is.na(virus.past_surveys_include_covid19_.Wave_1b ) |
                        virus.past_surveys_include_covid19_.Wave_1b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_2b ) |
                        virus.past_surveys_include_covid19_.Wave_2b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_3b ) |
                        virus.past_surveys_include_covid19_.Wave_3b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_4b ) |
                        virus.past_surveys_include_covid19_.Wave_4b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_6b ) |
                        virus.past_surveys_include_covid19_.Wave_6b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_8b ) |
                        virus.past_surveys_include_covid19_.Wave_8b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_10b ) |
                        virus.past_surveys_include_covid19_.Wave_10b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_12b ) |
                        virus.past_surveys_include_covid19_.Wave_12b == "No") & 
                        (is.na(virus.past_surveys_include_covid19_.Wave_14b ) |
                        virus.past_surveys_include_covid19_.Wave_14b == "No") &
                         (is.na(virus.past_surveys_include_covid19_.Wave_16b ) |
                        virus.past_surveys_include_covid19_.Wave_16b == "No") &
                       
             
         # Resp questionnaire - No at least once and rest missing (i.e., never said yes to taking a test)
            (is.na(resp.coronavirus_test_nosethroat_swab) |
                       resp.coronavirus_test_nosethroat_swab == "No") &
                         
            (is.na(resp.coronavirus_antibody_test) |
                         resp.coronavirus_antibody_test == "No") &
                     
            (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_1a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_1a == "No") &
                         
            (is.na(resp.coronavirus_antibody_test_.Wave_1a) |
                         resp.coronavirus_antibody_test_.Wave_1a == "No") &
           
            (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_1b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_1b == "No") &
                         
             (is.na(resp.coronavirus_antibody_test_.Wave_1b) |
                         resp.coronavirus_antibody_test_.Wave_1b == "No") &
           
            (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_2a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_2a == "No") &
                         
             (is.na(resp.coronavirus_antibody_test_.Wave_2a) |
                         resp.coronavirus_antibody_test_.Wave_2a == "No") &
           
            (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_2b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_2b == "No") &
                         
           (is.na(resp.coronavirus_antibody_test_.Wave_2b) |
                         resp.coronavirus_antibody_test_.Wave_2b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_3a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_3a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_3a) |
                         resp.coronavirus_antibody_test_.Wave_3a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_3b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_3b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_3b) |
                         resp.coronavirus_antibody_test_.Wave_3b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_4a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_4a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_4a) |
                         resp.coronavirus_antibody_test_.Wave_4a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_4b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_4b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_4b) |
                         resp.coronavirus_antibody_test_.Wave_4b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_5a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_5a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_5a) |
                         resp.coronavirus_antibody_test_.Wave_5a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_6b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_6b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_6b) |
                         resp.coronavirus_antibody_test_.Wave_6b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_7a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_7a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_7a) |
                         resp.coronavirus_antibody_test_.Wave_7a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_8b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_8b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_8b) |
                         resp.coronavirus_antibody_test_.Wave_8b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_9a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_9a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_9a) |
                         resp.coronavirus_antibody_test_.Wave_9a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_10b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_10b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_10b) |
                         resp.coronavirus_antibody_test_.Wave_10b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_11a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_11a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_11a) |
                         resp.coronavirus_antibody_test_.Wave_11a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_12b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_12b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_12b) |
                         resp.coronavirus_antibody_test_.Wave_12b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_13a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_13a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_13a) |
                         resp.coronavirus_antibody_test_.Wave_13a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_14b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_14b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_14b) |
                         resp.coronavirus_antibody_test_.Wave_14b == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_15a) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_15a == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_15a) |
                         resp.coronavirus_antibody_test_.Wave_15a == "No") &
           
           (is.na(resp.coronavirus_test_nosethroat_swab_.Wave_16b) |
                       resp.coronavirus_test_nosethroat_swab_.Wave_16b == "No") &
                         
                        (is.na(resp.coronavirus_antibody_test_.Wave_16b) |
                         resp.coronavirus_antibody_test_.Wave_16b == "No")) ~ "Not taken test",  
             
         
             # Virus questionnaire - Question about results of their test
                      ( is.na(virus.back_positive_antibodies_tests_.Wave_1b ) &
                       is.na(virus.back_positive_antibodies_tests_.Wave_2b ) &
                       is.na(virus.back_positive_antibodies_tests_.Wave_3b ) &
                       is.na(virus.back_positive_antibodies_tests_.Wave_4b ) &
                       is.na(virus.back_positive_antibodies_tests_.Wave_6b ) &
                       is.na(virus.back_positive_antibodies_tests_.Wave_8b ) &
                       is.na(virus.back_positive_antibodies_tests_.Wave_10b)  &
                       is.na(virus.back_positive_antibodies_tests_.Wave_12b)  &
                       is.na(virus.back_positive_antibodies_tests_.Wave_14b)  &
                       is.na(virus.back_positive_antibodies_tests_.Wave_16b)  &
           
             # Resp questionnaire - Question about results of their test
            is.na(resp.results_nosethroat_swab_test) &
                        is.na(resp.results_antibody_test) &
           is.na(resp.results_nosethroat_swab_test_.Wave_1a) &
                        is.na(resp.results_antibody_test_.Wave_1a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_1b) &
                        is.na(resp.results_antibody_test_.Wave_1b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_2a) &
                        is.na(resp.results_antibody_test_.Wave_2a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_2b) &
                        is.na(resp.results_antibody_test_.Wave_2b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_3a) &
                        is.na(resp.results_antibody_test_.Wave_3a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_3b) &
                        is.na(resp.results_antibody_test_.Wave_3b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_4a) &
                        is.na(resp.results_antibody_test_.Wave_4a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_4b) &
                        is.na(resp.results_antibody_test_.Wave_4b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_5a) &
                        is.na(resp.results_antibody_test_.Wave_5a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_6b) &
                        is.na(resp.results_antibody_test_.Wave_6b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_7a) &
                        is.na(resp.results_antibody_test_.Wave_7a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_8b) &
                        is.na(resp.results_antibody_test_.Wave_8b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_9a) &
                        is.na(resp.results_antibody_test_.Wave_9a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_10b) &
                        is.na(resp.results_antibody_test_.Wave_10b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_11a) &
                        is.na(resp.results_antibody_test_.Wave_11a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_12b) &
                        is.na(resp.results_antibody_test_.Wave_12b) &
          is.na(resp.results_nosethroat_swab_test_.Wave_13a) &
                        is.na(resp.results_antibody_test_.Wave_13a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_14b) &
                        is.na(resp.results_antibody_test_.Wave_14b) &
           is.na(resp.results_nosethroat_swab_test_.Wave_15a) &
                        is.na(resp.results_antibody_test_.Wave_15a) &
           is.na(resp.results_nosethroat_swab_test_.Wave_16b) &
                        is.na(resp.results_antibody_test_.Wave_16b))  ~ "Test taken but not answered test result", 
       
                       
           # Positive test results - resp, virus and demographics questionnaire
         resp.results_nosethroat_swab_test == "Positive" | 
         resp.results_antibody_test == "Positive"  ~ "Baseline",
         
          resp.results_nosethroat_swab_test_.Wave_1a == "Positive" | 
          resp.results_antibody_test_.Wave_1a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_1a == "Yes"  ~ "1a",

          virus.back_positive_antibodies_tests_.Wave_1b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_1b == "Positive" | 
           resp.results_antibody_test_.Wave_1b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_1b =="Yes" ~ "1b",
           
           resp.results_nosethroat_swab_test_.Wave_2a == "Positive" | 
          resp.results_antibody_test_.Wave_2a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_2a == "Yes"  ~ "2a",
           
          virus.back_positive_antibodies_tests_.Wave_2b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_2b == "Positive" | 
           resp.results_antibody_test_.Wave_2b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_2b == "Yes" ~ "2b",
           
           resp.results_nosethroat_swab_test_.Wave_3a == "Positive" | 
          resp.results_antibody_test_.Wave_3a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_3a == "Yes"  ~ "3a",
           
           virus.back_positive_antibodies_tests_.Wave_3b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_3b == "Positive" | 
           resp.results_antibody_test_.Wave_3b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_3b =="Yes" ~ "3b",
           
           resp.results_nosethroat_swab_test_.Wave_4a == "Positive" | 
          resp.results_antibody_test_.Wave_4a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_4a == "Yes"  ~ "4a",
           
           virus.back_positive_antibodies_tests_.Wave_4b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_4b == "Positive" | 
           resp.results_antibody_test_.Wave_4b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_4b =="Yes" ~ "4b",
           
            resp.results_nosethroat_swab_test_.Wave_5a == "Positive" | 
          resp.results_antibody_test_.Wave_5a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_5a == "Yes"  ~ "5a",
           
             virus.back_positive_antibodies_tests_.Wave_6b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_6b == "Positive" | 
           resp.results_antibody_test_.Wave_6b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_6b =="Yes" ~ "6b",

                
            resp.results_nosethroat_swab_test_.Wave_7a == "Positive" | 
          resp.results_antibody_test_.Wave_7a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_7a == "Yes"  ~ "7a",
           
             virus.back_positive_antibodies_tests_.Wave_8b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_8b == "Positive" | 
           resp.results_antibody_test_.Wave_8b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_8b =="Yes" ~ "8b",
           
            resp.results_nosethroat_swab_test_.Wave_9a == "Positive" | 
          resp.results_antibody_test_.Wave_9a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_9a == "Yes"  ~ "9a",
           
           virus.back_positive_antibodies_tests_.Wave_10b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_10b == "Positive" | 
           resp.results_antibody_test_.Wave_10b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_10b =="Yes" ~ "10b",
           
            resp.results_nosethroat_swab_test_.Wave_11a == "Positive" | 
          resp.results_antibody_test_.Wave_11a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_11a == "Yes"  ~ "11a",
           
            virus.back_positive_antibodies_tests_.Wave_12b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_12b == "Positive" | 
           resp.results_antibody_test_.Wave_12b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_12b =="Yes" ~ "12b",
           
           resp.results_nosethroat_swab_test_.Wave_13a == "Positive" | 
          resp.results_antibody_test_.Wave_13a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_13a == "Yes"  ~ "13a",
           
           virus.back_positive_antibodies_tests_.Wave_14b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_14b == "Positive" | 
           resp.results_antibody_test_.Wave_14b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_14b =="Yes" ~ "14b",
           
           resp.results_nosethroat_swab_test_.Wave_15a == "Positive" | 
          resp.results_antibody_test_.Wave_15a == "Positive"  |
          dem.unwell_coronavirus_weeks_physical_.Wave_15a == "Yes"  ~ "15a",
           
            virus.back_positive_antibodies_tests_.Wave_16b == "Yes" |
           resp.results_nosethroat_swab_test_.Wave_16b == "Positive" | 
           resp.results_antibody_test_.Wave_16b == "Positive"|
           dem.unwell_coronavirus_weeks_physical_.Wave_16b =="Yes" ~ "16b",
            
            TRUE ~ "Not positive" # Then, everyone who is left over, i.e., NA will have answered "No" or "Unsure/inconclusive" at least once, even if they are missing for all other phases. The only people we can not assume an answer for (i.e., has experienced or has not experienced) is those who never answered the question throughout the whole time period
                   )
  )

# Check
dat %>%
  freq(exposure_phase_positive_covid_test)

# Check NAs - unwell with coronavirus
dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_1a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_1b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_2a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_2b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_3a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_3b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_4a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_4b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_5a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_6b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_7a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_8b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_9a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_10b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_11a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_12b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_13a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_14b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_15a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(dem.unwell_coronavirus_weeks_physical_.Wave_16b)

# Check NAs - results nose/throat swab
dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_1a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_1b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_2a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_2b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_3a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_3b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_4a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_4b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_5a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_6b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_7a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_8b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_9a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_10b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_11a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_12b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_13a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_14b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_15a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_nosethroat_swab_test_.Wave_16b)

# Check NAs - results antibody test
dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_1a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_1b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_2a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_2b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_3a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_3b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_4a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_4b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_5a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_6b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_7a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_8b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_9a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_10b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_11a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_12b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_13a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_14b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_15a)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(resp.results_antibody_test_.Wave_16b)

# Check NAs - antibody test (different questionnaire)
dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_1b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_2b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_3b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_4b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_6b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_8b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_10b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_12b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_14b)

dat %>%
  filter(is.na(exposure_phase_positive_covid_test)) %>%
  freq(virus.back_positive_antibodies_tests_.Wave_16b)
```

Harmful ideation
```{r Positve COVID test result exposure BEFORE outcome HI - virus, dem and resp Q}

# Baseline
dat <- dat %>%
  mutate(positive_covid_test_HI_baseline =
           case_when(exposure_phase_positive_covid_test == "Baseline" & # First positive COVID test at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced a positive COVID test before their first experience of HI
                        exposure_phase_positive_covid_test == "Baseline" & 
                       (outcome_phase_harmful_ideation == "Baseline" | # Co-occurring exposure & outcome
                         outcome_phase_harmful_ideation == "1a" | 
                         outcome_phase_harmful_ideation == "1b" |
                          outcome_phase_harmful_ideation == "2a" | 
                        outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b" |
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(positive_covid_test_HI_1a =
           case_when(exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       exposure_phase_positive_covid_test == "1a" & # First positive COVID test at phase 1a
                     outcome_phase_harmful_ideation == "Baseline" ~ "To drop",
                      
                     # These people will have experienced a positive COVID test before their first experience of HI
                        exposure_phase_positive_covid_test == "1a" & 
                       (outcome_phase_harmful_ideation == "1a" |  # Co-occurring exposure & outcome
                         outcome_phase_harmful_ideation == "1b" | 
                          outcome_phase_harmful_ideation == "2a" | 
                        outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_1a)

# Phase 1b
dat <- dat %>%
  mutate(positive_covid_test_HI_1b =
           case_when(exposure_phase_positive_covid_test == "1b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop
             
                    exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "1b" & # First positive COVID test at phase 1b
                       (outcome_phase_harmful_ideation == "1b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "2a" | 
                          outcome_phase_harmful_ideation == "2b" | 
                         outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b"  ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(positive_covid_test_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(positive_covid_test_HI_2a =
           case_when(exposure_phase_positive_covid_test == "2a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_positive_covid_test == "2a" & # First positive COVID test at phase 2a
                       (outcome_phase_harmful_ideation == "2a" |  # Co-occurring symptom & exposure
                         outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" | 
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(positive_covid_test_HI_2b =
           case_when(exposure_phase_positive_covid_test == "2b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "2b" & # First positive COVID test at phase 2b
                       (outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" | 
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(positive_covid_test_HI_3a =
           case_when(exposure_phase_positive_covid_test == "3a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_positive_covid_test == "3a" & # First positive COVID test at phase 3a
                    (outcome_phase_harmful_ideation == "3a" |  # Co-occurring exposure and outcome
                      outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                     outcome_phase_harmful_ideation == "6b" | 
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(positive_covid_test_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(positive_covid_test_HI_3b =
           case_when(exposure_phase_positive_covid_test == "3b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of  harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_positive_covid_test == "3b" & # First positive COVID test at phase 3b
                      (outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" | 
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(positive_covid_test_HI_4a =
           case_when(exposure_phase_positive_covid_test == "4a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4a" & # First positive COVID test at phase 4a
                      (outcome_phase_harmful_ideation == "4a" |  # Co-occurring exposure and outcome
                        outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" | 
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(positive_covid_test_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(positive_covid_test_HI_4b =
           case_when(exposure_phase_positive_covid_test == "4b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "4b" & # First positive COVID test at phase 4b
                    (outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                     outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(positive_covid_test_HI_5a =
           case_when(exposure_phase_positive_covid_test == "5a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "5a" & # First positive COVID test at phase 5a
                    (outcome_phase_harmful_ideation == "5a" |  # Co-occurring exposure & outcome
                      outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(positive_covid_test_HI_6b =
           case_when(exposure_phase_positive_covid_test == "6b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "6b" & # First positive COVID test at phase 6b
                    (outcome_phase_harmful_ideation == "6b" | # Co-occuring symptom and exposure
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_6b)

# Phase 7a
dat <- dat %>%
  mutate(positive_covid_test_HI_7a =
           case_when(exposure_phase_positive_covid_test == "7a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                     outcome_phase_harmful_ideation == "6b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "7a" & # First positive COVID test at phase 7a
                    (outcome_phase_harmful_ideation == "7a" | # Co-occurring exposure & outcome
                      outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(positive_covid_test_HI_8b =
           case_when(exposure_phase_positive_covid_test == "8b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "8b" & # First positive COVID test at phase 8b
                    (outcome_phase_harmful_ideation == "8b" |  # Co-occuring symptom and exposure
                       outcome_phase_harmful_ideation == "9a" | 
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(positive_covid_test_HI_9a =
           case_when(exposure_phase_positive_covid_test == "9a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" | 
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" | 
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" | 
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" | 
                     outcome_phase_harmful_ideation == "8b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "9a" & # First positive COVID test at phase 9a
                    (outcome_phase_harmful_ideation == "9a" | # Co-occuring exposure & outcome
                      outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" | 
                     outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_9a)


# Phase 10b
dat <- dat %>%
  mutate(positive_covid_test_HI_10b =
           case_when(exposure_phase_positive_covid_test == "10b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" | 
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" | 
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" | 
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" | 
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" | 
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" | 
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "10b" & # First positive COVID test at phase 10b
                    ( outcome_phase_harmful_ideation == "10b" | # Co-occuring symptom and exposure
                       outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(positive_covid_test_HI_11a =
           case_when(exposure_phase_positive_covid_test == "11a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "11a" & # First positive COVID test at phase 11a
                    (outcome_phase_harmful_ideation == "11a" | # Co-occurring exposure & outcome
                      outcome_phase_harmful_ideation == "12b"|
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(positive_covid_test_HI_12b =
           case_when(exposure_phase_positive_covid_test == "12b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "12b" & # First positive COVID test at phase 12b
                    (outcome_phase_harmful_ideation == "12b" | # Co-occurring symptom and exposure
                         outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_12b)


# Phase 13a
dat <- dat %>%
  mutate(positive_covid_test_HI_13a =
           case_when(exposure_phase_positive_covid_test == "13a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "13a" & # First positive COVID test at phase 13a
                    ( outcome_phase_harmful_ideation == "13a" | # Co-occurring symptom and exposure
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_13a)


# Phase 14b
dat <- dat %>%
  mutate(positive_covid_test_HI_14b =
           case_when(exposure_phase_positive_covid_test == "14b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "12b" |
                        outcome_phase_harmful_ideation == "13a" )  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "14b" & # First positive COVID test at phase 14b
                    ( outcome_phase_harmful_ideation == "14b" |  # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_14b)

# Phase 15a
dat <- dat %>%
  mutate(positive_covid_test_HI_15a =
           case_when(exposure_phase_positive_covid_test == "15a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "12b" |
                        outcome_phase_harmful_ideation == "13a" |
                        outcome_phase_harmful_ideation == "14b")  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "15a" & # First positive COVID test at phase 15a
                    (  outcome_phase_harmful_ideation == "15a" |  # Co-occurring symptom and exposure
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_15a)


# Phase 16b
dat <- dat %>%
  mutate(positive_covid_test_HI_16b =
           case_when(exposure_phase_positive_covid_test == "16b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                      outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                      outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                      outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                        outcome_phase_harmful_ideation == "12b" |
                        outcome_phase_harmful_ideation == "13a" |
                        outcome_phase_harmful_ideation == "14b" |
                        outcome_phase_harmful_ideation == "15a" )  ~ "To drop", # First experience of harmful ideation occurred before first COVID test - need to drop 
                     
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_positive_covid_test == "16b" & # First positive COVID test at phase 16b
                      outcome_phase_harmful_ideation == "16b"  # Co-occurring symptom and exposure
                     ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(positive_covid_test_HI_16b)
``` 

Harmful ideation & Positive COVID test result
```{r Positve COVID test result exposure HI - virus, dem and resp Q}
dat <- dat %>%
  mutate(positive_covid_test_before_HI =
           case_when(# First positive test NOT before first experience of harm ideation
                positive_covid_test_HI_baseline == "To drop" |
                            positive_covid_test_HI_1a == "To drop" |
                    positive_covid_test_HI_1b == "To drop" |
               positive_covid_test_HI_2a == "To drop" |
                    positive_covid_test_HI_2b == "To drop" |
               positive_covid_test_HI_3a == "To drop" |
                    positive_covid_test_HI_3b == "To drop" |
               positive_covid_test_HI_4a == "To drop" |
                    positive_covid_test_HI_4b == "To drop" |
               positive_covid_test_HI_5a == "To drop" |
                    positive_covid_test_HI_6b == "To drop" |
               positive_covid_test_HI_7a == "To drop" |
                    positive_covid_test_HI_8b == "To drop" |
               positive_covid_test_HI_9a == "To drop" |
                    positive_covid_test_HI_10b == "To drop" |
              positive_covid_test_HI_11a == "To drop" |
                    positive_covid_test_HI_12b == "To drop" |
                 positive_covid_test_HI_13a == "To drop" |
                    positive_covid_test_HI_14b == "To drop" |
                 positive_covid_test_HI_15a == "To drop" |
                    positive_covid_test_HI_16b == "To drop" ~ "Positive test after harmful ideation",
                    
                     # Not answered whether they'd taken a test
                    exposure_phase_positive_covid_test == "All missing" ~ "Missing whether experienced COVID", # Need to be dropped
                    
                     # Not taken test
                    exposure_phase_positive_covid_test == "Not taken test" ~ "Not taken test", 
                    
                    # Taken test but not given test result
                    exposure_phase_positive_covid_test == "Test taken but not answered test result" ~ "Missing test result", # Need to be dropped
                    
                     # Not answered whether they'd experienced harmful ideation
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "Missing whether experienced harmful ideation", # Need to be dropped
                    
                    # First positive test BEFORE first experience of passsive suicidal ideation
             positive_covid_test_HI_baseline == "Yes" |
                    positive_covid_test_HI_1a == "Yes" |
             positive_covid_test_HI_1b == "Yes" |
               positive_covid_test_HI_2a == "Yes" |
              positive_covid_test_HI_2b == "Yes" |
               positive_covid_test_HI_3a== "Yes" |
                    positive_covid_test_HI_3b == "Yes" |
               positive_covid_test_HI_4a == "Yes" |
                    positive_covid_test_HI_4b == "Yes" |
               positive_covid_test_HI_5a == "Yes" |
                    positive_covid_test_HI_6b == "Yes" |
               positive_covid_test_HI_7a == "Yes" |
                    positive_covid_test_HI_8b == "Yes" |
               positive_covid_test_HI_9a == "Yes" |
                    positive_covid_test_HI_10b== "Yes" |
               positive_covid_test_HI_11a == "Yes" |
                    positive_covid_test_HI_12b == "Yes"|
               positive_covid_test_HI_13a == "Yes" |
                    positive_covid_test_HI_14b == "Yes"|
               positive_covid_test_HI_15a == "Yes" |
                    positive_covid_test_HI_16b == "Yes" ~ "Positive test before harmful ideation",
                    
                   # Experienced exposure but not outcome
             positive_covid_test_HI_baseline == "No outcome" |
             positive_covid_test_HI_1a == "No outcome" |
                    positive_covid_test_HI_1b == "No outcome" |
               positive_covid_test_HI_2a == "No outcome" |
                    positive_covid_test_HI_2b == "No outcome" |
               positive_covid_test_HI_3a == "No outcome" |
                    positive_covid_test_HI_3b == "No outcome" |
               positive_covid_test_HI_4a == "No outcome" |
                    positive_covid_test_HI_4b == "No outcome" |
               positive_covid_test_HI_5a == "No outcome" |
                    positive_covid_test_HI_6b == "No outcome" |
               positive_covid_test_HI_7a == "No outcome" |
                    positive_covid_test_HI_8b == "No outcome" |
               positive_covid_test_HI_9a == "No outcome" |
                    positive_covid_test_HI_10b == "No outcome" |
               positive_covid_test_HI_11a == "No outcome" |
                    positive_covid_test_HI_12b == "No outcome" |
               positive_covid_test_HI_13a == "No outcome" |
                    positive_covid_test_HI_14b == "No outcome" |
               positive_covid_test_HI_15a == "No outcome" |
                    positive_covid_test_HI_16b == "No outcome" ~ "Exposure but no outcome",
                   
              # Experienced outcome but not exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" |
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_positive_covid_test == "Not positive" &
                     outcome_phase_harmful_ideation == "Not experienced" ~ "Neither exposure nor outcome"
             )
)
                   
# Check                      
dat %>%
  freq(positive_covid_test_before_HI) # No NAs

# Create final variable of positive COVID test before HI outcome
dat <- dat %>%
  mutate(positive_covid_test_before_HI_final =
           case_when(positive_covid_test_before_HI == "Positive test after harmful ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     positive_covid_test_before_HI == "Missing whether experienced COVID" | # Need to drop people who never answered whether they'd taken a COVID test
                       positive_covid_test_before_HI == "Missing test result" | # Taken a test but not indicated result of test
                     positive_covid_test_before_HI == "Missing whether experienced harmful ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced harmful ideation
                     
                     positive_covid_test_before_HI ==  "Not taken test" |
                     positive_covid_test_before_HI ==  "Outcome but no exposure" |
                    positive_covid_test_before_HI ==  "Neither exposure nor outcome" ~ "No",
                     
                     positive_covid_test_before_HI == "Exposure but no outcome" |
                    positive_covid_test_before_HI == "Positive test before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(positive_covid_test_before_HI_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(positive_covid_test_before_HI_final) 
           )

# These people should all have experienced outcome before exposure, or missing test result etc    
missing %>%
  filter(exposure_phase_positive_covid_test != "All missing" &
          outcome_phase_harmful_ideation != "Not answered") %>%
  select(exposure_phase_positive_covid_test,
         outcome_phase_harmful_ideation
         )
```
                 
## Losing someone due to COVID-19 (grief)
There are two questions in COPING that capture whether someone has lost someone due to COVID, in the 'grief' questionnaire in follow up B only and baseline ("In the past month, have you lost someone close to you due to COVID-19?") and the demographics questionnaire ("Has a relative that was previously ill with coronavirus or suspected coronavirus passed away?") in follow up A and B [not at baseline]

### Identify at which phase they first experienced the exposure
Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - losing someone}
dat <- dat %>%
  mutate(exposure_phase_losing_someone =
           case_when( 
                       ( # In the past month, have you lost someone close to you due to COVID-19?
                          (is.na(grief.covid_lost_due_close) |
                         grief.covid_lost_due_close == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_1b) |
                         grief.due_past_month_lost_.Wave_1b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_2b) |
                         grief.due_past_month_lost_.Wave_2b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_3b) |
                         grief.due_past_month_lost_.Wave_3b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_4b) |
                         grief.due_past_month_lost_.Wave_4b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_6b) |
                         grief.due_past_month_lost_.Wave_6b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_8b) |
                         grief.due_past_month_lost_.Wave_8b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_10b) |
                         grief.due_past_month_lost_.Wave_10b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_12b) |
                         grief.due_past_month_lost_.Wave_12b == "Prefer not to say") &
                          (is.na(grief.due_past_month_lost_.Wave_14b) |
                         grief.due_past_month_lost_.Wave_14b == "Prefer not to say") &
                        (is.na(grief.due_past_month_lost_.Wave_16b) |
                         grief.due_past_month_lost_.Wave_16b == "Prefer not to say") &
                        
                    # Has a relative that was previously ill with coronavirus or suspected coronavirus passed away?
                         
                       (dem.coronavirus_relative_previously_ill.1_.Wave_1a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_1a) # Not answered screener question
                           ) &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_1b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_1b ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_1b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_2a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_2a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_2a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_2b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_2b ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_2b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_3a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_3a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_3a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_3b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_3b ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_3b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_4a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_4a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_4a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_4b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_4b ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_4b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_5a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_5a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_5a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_6b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_6b) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_6b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_7a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_7a) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_7a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_8b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_8b ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_8b == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_9a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_9a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_9a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_10b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_10b ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_10b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_11a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_11a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_11a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_12b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_12b) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_12b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_13a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_13a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_13a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_14b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_14b ) |# Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_14b  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_15a == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_15a ) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_15a  == "Unsure") &
                          
                          (dem.coronavirus_relative_previously_ill.1_.Wave_16b == "Prefer not to say" |
                         is.na(dem.health_of_a_relative_.Wave_16b) | # Not answered screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_16b  == "Unsure")
                        )  ~ "Not answered or PNTA", 
                       
                       grief.covid_lost_due_close == "Yes" ~ "Baseline",
                       
                       dem.coronavirus_relative_previously_ill.1_.Wave_1a == "Yes" ~ "1a",
                    
                       grief.due_past_month_lost_.Wave_1b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_1b == "Yes" ~ "1b",
                    
                      dem.coronavirus_relative_previously_ill.1_.Wave_2a == "Yes" ~ "2a",
                    
                       grief.due_past_month_lost_.Wave_2b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_2b == "Yes" ~ "2b",
                      
                      dem.coronavirus_relative_previously_ill.1_.Wave_3a == "Yes" ~ "3a",
                        
                      grief.due_past_month_lost_.Wave_3b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_3b == "Yes" ~ "3b",
                       
                      dem.coronavirus_relative_previously_ill.1_.Wave_4a == "Yes" ~ "4a",
                      
                       grief.due_past_month_lost_.Wave_4b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_4b == "Yes" ~ "4b",
                      
                      dem.coronavirus_relative_previously_ill.1_.Wave_5a == "Yes" ~ "5a",
                       
                     grief.due_past_month_lost_.Wave_6b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_6b == "Yes" ~ "6b",
                      
                     dem.coronavirus_relative_previously_ill.1_.Wave_7a == "Yes" ~ "7a",
                       
                   grief.due_past_month_lost_.Wave_8b  == "Yes" |
                       dem.coronavirus_relative_previously_ill.1_.Wave_8b == "Yes" ~ "8b",
                       
                    dem.coronavirus_relative_previously_ill.1_.Wave_9a == "Yes" ~ "9a",
                       
                    grief.due_past_month_lost_.Wave_10b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_10b == "Yes" ~ "10b",
                       
                    dem.coronavirus_relative_previously_ill.1_.Wave_11a == "Yes" ~ "11a",
                       
                    grief.due_past_month_lost_.Wave_12b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_12b == "Yes" ~ "12b",
                       
                    dem.coronavirus_relative_previously_ill.1_.Wave_13a == "Yes" ~ "13a",
                      
                     grief.due_past_month_lost_.Wave_14b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_14b == "Yes" ~ "14b",
                      
                     dem.coronavirus_relative_previously_ill.1_.Wave_15a == "Yes" ~ "15a",
                      
                     grief.due_past_month_lost_.Wave_16b  == "Yes" |
                         dem.coronavirus_relative_previously_ill.1_.Wave_16b == "Yes" ~ "16b",
                       
              # Not lost someone
                     
                     grief.covid_lost_due_close == "No" |
                      
                     (dem.health_of_a_relative_.Wave_1a == "Not Health of a relative" | # Screener question
                        dem.coronavirus_relative_previously_ill.1_.Wave_1a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_1a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_1a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_1a == "No") |

                      (dem.health_of_a_relative_.Wave_1b == "Not Health of a relative" | # Screener question
                          dem.coronavirus_relative_previously_ill.1_.Wave_1b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_1b == "No" | # No ill relative
                         dem.coronavirus_relative_ill_suspected_.Wave_1b == "Unsure" |  # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_1b == "No" |
                      grief.due_past_month_lost_.Wave_1b  == "No" ) |

                      (dem.health_of_a_relative_.Wave_2a == "Not Health of a relative" | # Screener question
                      dem.coronavirus_relative_ill_suspected_.Wave_2a == "No" | # No ill relative
                         dem.coronavirus_relative_previously_ill.1_.Wave_2a  == "Unsure" | # Unsure if relative has passed
                         dem.coronavirus_relative_ill_suspected_.Wave_2a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_2a == "No" ) |

                      (dem.health_of_a_relative_.Wave_2b == "Not Health of a relative" | # Screener question
                       dem.coronavirus_relative_previously_ill.1_.Wave_2b  == "Unsure" | # Unsure if relative has passed
                         dem.coronavirus_relative_ill_suspected_.Wave_2b == "No" | # No ill relative
                       dem.coronavirus_relative_ill_suspected_.Wave_2b == "Unsure" |  # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_2b == "No" |
                      grief.due_past_month_lost_.Wave_2b  == "No" ) |

                     (dem.health_of_a_relative_.Wave_3a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_3a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_3a == "No" | # No ill relative
                         dem.coronavirus_relative_ill_suspected_.Wave_3a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_3a == "No" ) |

                      (dem.health_of_a_relative_.Wave_3b == "Not Health of a relative" | # Screener question
                          dem.coronavirus_relative_previously_ill.1_.Wave_3b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_3b == "No" | # No ill relative
                         dem.coronavirus_relative_ill_suspected_.Wave_3b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_3b == "No" |
                      grief.due_past_month_lost_.Wave_3b  == "No" ) |

                     (dem.health_of_a_relative_.Wave_4a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_4a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_4a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_4a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_4a == "No" ) |
                     
                      (dem.health_of_a_relative_.Wave_4b == "Not Health of a relative" | # Screener question
                          dem.coronavirus_relative_previously_ill.1_.Wave_4b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_4b == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_4b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_4b == "No" |
                      grief.due_past_month_lost_.Wave_4b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_5a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_5a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_5a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_5a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_5a == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_6b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_6b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_6b == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_6b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_6b == "No" |
                      grief.due_past_month_lost_.Wave_6b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_7a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_7a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_7a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_7a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_7a == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_8b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_8b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_8b == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_8b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_8b == "No" |
                      grief.due_past_month_lost_.Wave_8b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_9a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_9a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_9a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_9a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_9a == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_10b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_10b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_10b == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_10b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_10b == "No" |
                      grief.due_past_month_lost_.Wave_10b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_11a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_11a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_11a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_11a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_11a == "No" ) |
                     
                      (dem.health_of_a_relative_.Wave_12b == "Not Health of a relative" | # Screener question
                          dem.coronavirus_relative_previously_ill.1_.Wave_12b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_12b == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_12b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_12b == "No" |
                      grief.due_past_month_lost_.Wave_12b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_13a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_13a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_13a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_13a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_13a == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_14b == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_14b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_14b == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_14b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_14b == "No" |
                      grief.due_past_month_lost_.Wave_14b  == "No" ) |
                     
                     (dem.health_of_a_relative_.Wave_15a == "Not Health of a relative" | # Screener question
                         dem.coronavirus_relative_previously_ill.1_.Wave_15a  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_15a == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_15a == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_15a == "No" ) |
                     
                       (dem.health_of_a_relative_.Wave_16b == "Not Health of a relative" | # Screener question
                           dem.coronavirus_relative_previously_ill.1_.Wave_16b  == "Unsure" | # Unsure if relative has passed
                      dem.coronavirus_relative_ill_suspected_.Wave_16b == "No" | # No ill relative
                        dem.coronavirus_relative_ill_suspected_.Wave_16b == "Unsure" | # Not sure if ill relative (not known)
                      dem.coronavirus_relative_previously_ill.1_.Wave_16b == "No" |
                      grief.due_past_month_lost_.Wave_16b  == "No" )   ~ "Not lost someone" 
                   
                       )
         )

# Check
dat %>%
  freq(exposure_phase_losing_someone)
```

Harmful ideation
```{r Lost someone exposure BEFORE outcome HI}
# Baseline
dat <- dat %>%
  mutate(lost_someone_HI_baseline =
           case_when(exposure_phase_losing_someone == "Baseline" & # First indicated losing someone at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                     # These people will have experienced losing someone before their first experience of HI
                        exposure_phase_losing_someone == "Baseline" &  # First indicated losing someone at baseline
                       (outcome_phase_harmful_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_harmful_ideation == "1a" | 
                          outcome_phase_harmful_ideation == "1b" | 
                          outcome_phase_harmful_ideation == "2a" | 
                        outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b" |
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
    
# Check
dat %>%
  freq(lost_someone_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(lost_someone_HI_1a =
           case_when(exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                     outcome_phase_harmful_ideation == "Baseline"   # Co-occurring exposure & outcome
                         ~ "To drop",
                     
                     exposure_phase_losing_someone == "1a" & # First indicated losing someone at phase 1a
                       (outcome_phase_harmful_ideation == "1a" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "1b" | 
                        outcome_phase_harmful_ideation == "2a" | 
                          outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_HI_1a)


# Phase 1b
dat <- dat %>%
  mutate(lost_someone_HI_1b =
           case_when(exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                     (outcome_phase_harmful_ideation == "Baseline" |  # Co-occurring exposure & outcome
                         outcome_phase_harmful_ideation == "1a") ~ "To drop",
                     
                     exposure_phase_losing_someone == "1b" & # First indicated losing someone at phase 1b
                       (outcome_phase_harmful_ideation == "1b" | # Co-occurring outcome and exposure
                        outcome_phase_harmful_ideation == "2a" | 
                          outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(lost_someone_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(lost_someone_HI_2a =
           case_when(exposure_phase_losing_someone == "2a" &  # First indicated losing someone at phase 2a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2a" & # First indicated losing someone at phase 2a
                       (outcome_phase_harmful_ideation == "2a" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "2b" | 
                          outcome_phase_harmful_ideation == "3a" |
                         outcome_phase_harmful_ideation == "3b" |
                           outcome_phase_harmful_ideation == "4a" |
                         outcome_phase_harmful_ideation == "4b" | 
                           outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(lost_someone_HI_2b =
           case_when(exposure_phase_losing_someone == "2b" &  # First indicated losing someone at phase 2b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "2b" & # First indicated losing someone at phase 2b
                       (outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                          outcome_phase_harmful_ideation == "3a" |
                         outcome_phase_harmful_ideation == "3b" |
                           outcome_phase_harmful_ideation == "4a" |
                         outcome_phase_harmful_ideation == "4b" | 
                           outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(lost_someone_HI_3a =
           case_when(exposure_phase_losing_someone == "3a" &  # First indicated losing someone at phase 3a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3a" & # First indicated losing someone at phase 3a
                       (outcome_phase_harmful_ideation == "3a" |  # Co-occurring outcome and exposure
                        outcome_phase_harmful_ideation == "3b" | 
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                        outcome_phase_harmful_ideation == "8b" | 
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(lost_someone_HI_3b =
           case_when(exposure_phase_losing_someone == "3b" &  # First indicated losing someone at phase 3b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_losing_someone == "3b" & # First indicated losing someone at phase 3b
                      (outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                        outcome_phase_harmful_ideation == "8b" | 
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(lost_someone_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(lost_someone_HI_4a =
           case_when(exposure_phase_losing_someone == "4a" &  # First indicated losing someone at phase 4a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4a" & # First indicated losing someone at phase 4a
                    (outcome_phase_harmful_ideation == "4a" | # Co-occurring outcome and exposure
                      outcome_phase_harmful_ideation == "4b" | 
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(lost_someone_HI_4b =
           case_when(exposure_phase_losing_someone == "4b" &  # First indicated losing someone at phase 4b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "4b" & # First indicated losing someone at phase 4b
                    (outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(lost_someone_HI_5a =
           case_when(exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "5a" & # First indicated losing someone at phase 5a
                    ( outcome_phase_harmful_ideation == "5a" |  # Co-occurring symptom and exposure
                      outcome_phase_harmful_ideation == "6b" | 
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(lost_someone_HI_6b =
           case_when(exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "6b" & # First indicated losing someone at phase 6b
                    (outcome_phase_harmful_ideation == "6b" | # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_6b)


# Phase 7a
dat <- dat %>%
  mutate(lost_someone_HI_7a =
           case_when(exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "7a" & # First indicated losing someone at phase 7a
                    (outcome_phase_harmful_ideation == "7a" |  # Co-occurring symptom and exposure
                      outcome_phase_harmful_ideation == "8b" |  
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(lost_someone_HI_8b =
           case_when(exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "8b" & # First indicated losing someone at phase 8b
                    (outcome_phase_harmful_ideation == "8b" |  # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(lost_someone_HI_9a =
           case_when(exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "9a" & # First indicated losing someone at phase 9a
                    (outcome_phase_harmful_ideation == "9a" |  # Co-occurring symptom and exposure
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_9a)


# Phase 10b
dat <- dat %>%
  mutate(lost_someone_HI_10b =
           case_when(exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "10b" & # First indicated losing someone at phase 10b
                    (outcome_phase_harmful_ideation == "10b" | # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(lost_someone_HI_11a =
           case_when(exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "11a" & # First indicated losing someone at phase 11a
                    (outcome_phase_harmful_ideation == "11a" | # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(lost_someone_HI_12b =
           case_when(exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "12b" & # First indicated losing someone at phase 12b
                   (outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_12b)

# Phase 13a
dat <- dat %>%
  mutate(lost_someone_HI_13a =
           case_when(exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "13a" & # First indicated losing someone at phase 13a
                   (  outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b")  ~ "Yes" # Co-occurring symptom and exposure
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_13a)

# Phase 14b
dat <- dat %>%
  mutate(lost_someone_HI_14b =
           case_when(exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a")  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "14b" & # First indicated losing someone at phase 14b
                   (outcome_phase_harmful_ideation == "14b" |  # Co-occurring symptom and exposure
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" )  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_14b)

# Phase 15a
dat <- dat %>%
  mutate(lost_someone_HI_15a =
           case_when(exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b"  )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "15a" & # First indicated losing someone at phase 15a
                   ( outcome_phase_harmful_ideation == "15a" | # Co-occurring symptom and exposure
                     outcome_phase_harmful_ideation == "16b")  ~ "Yes" 
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_15a)

# Phase 16b
dat <- dat %>%
  mutate(lost_someone_HI_16b =
           case_when(exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                      outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                          outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b" |  
                       outcome_phase_harmful_ideation == "15a" 
                         )  ~ "To drop", # First experience of harmful ideation occurred before losing someone - need to drop
                     
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_losing_someone == "16b" & # First indicated losing someone at phase 16b
                   outcome_phase_harmful_ideation == "16b"  ~ "Yes"  # Co-occurring symptom and exposure
                      
                         
         ) 
  )
  
      
# Check
dat %>%
  freq(lost_someone_HI_16b)
```

Harmful ideation & losing someone
```{r Losing someone exposure HI}
dat <- dat %>%
  mutate(losing_someone_before_HI =
           case_when(# First lost someone NOT before first experience of harmful ideation
                    lost_someone_HI_baseline == "To drop" |
                       lost_someone_HI_1a == "To drop" |
                    lost_someone_HI_1b == "To drop" |
                       lost_someone_HI_2a == "To drop" |
                    lost_someone_HI_2b == "To drop" |
                       lost_someone_HI_3a == "To drop" |
                    lost_someone_HI_3b == "To drop" |
                       lost_someone_HI_4a == "To drop" |
                    lost_someone_HI_4b == "To drop" |
                       lost_someone_HI_5a == "To drop" |
                    lost_someone_HI_6b == "To drop" |
                       lost_someone_HI_7a == "To drop" |
                    lost_someone_HI_8b == "To drop" |
                       lost_someone_HI_9a == "To drop" |
                    lost_someone_HI_10b == "To drop" |
                       lost_someone_HI_11a == "To drop" |
                    lost_someone_HI_12b == "To drop" |
                       lost_someone_HI_13a == "To drop" |
                      lost_someone_HI_14b == "To drop" |
                       lost_someone_HI_15a == "To drop" |
                    lost_someone_HI_16b == "To drop"  ~ "Lost someone after harmful ideation",
                    
                     # Not answered whether they'd lost someone
                    exposure_phase_losing_someone == "Not answered or PNTA" ~ "Missing whether lost someone", # Need to be dropped
                    
                    # Not answered whether they'd experienced harmful ideation
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "Missing whether experienced harmful ideation", # Need to be dropped
                    
                  # First lost someone BEFORE first experience of harmful ideation
                    lost_someone_HI_baseline == "Yes" |
                       lost_someone_HI_1a == "Yes" |
                    lost_someone_HI_1b == "Yes" |
                       lost_someone_HI_2a == "Yes" |
                    lost_someone_HI_2b == "Yes" |
                       lost_someone_HI_3a == "Yes" |
                    lost_someone_HI_3b == "Yes" |
                       lost_someone_HI_4a == "Yes" |
                    lost_someone_HI_4b == "Yes" |
                       lost_someone_HI_5a == "Yes" |
                    lost_someone_HI_6b == "Yes" |
                       lost_someone_HI_7a == "Yes" |
                    lost_someone_HI_8b == "Yes" |
                       lost_someone_HI_9a == "Yes" |
                    lost_someone_HI_10b == "Yes" |
                       lost_someone_HI_11a == "Yes" |
                    lost_someone_HI_12b == "Yes" |
                       lost_someone_HI_13a == "Yes" |
                      lost_someone_HI_14b == "Yes" |
                       lost_someone_HI_15a == "Yes" |
                    lost_someone_HI_16b == "Yes"  ~ "Lost someone before harmful ideation",
                    
                   # Experienced exposure but not outcome
                    lost_someone_HI_baseline == "No outcome" |
                       lost_someone_HI_1a == "No outcome" |
                    lost_someone_HI_1b == "No outcome" |
                       lost_someone_HI_2a == "No outcome" |
                    lost_someone_HI_2b == "No outcome" |
                       lost_someone_HI_3a == "No outcome" |
                    lost_someone_HI_3b == "No outcome" |
                       lost_someone_HI_4a == "No outcome" |
                    lost_someone_HI_4b == "No outcome" |
                       lost_someone_HI_5a == "No outcome" |
                    lost_someone_HI_6b == "No outcome" |
                       lost_someone_HI_7a == "No outcome" |
                    lost_someone_HI_8b == "No outcome" |
                       lost_someone_HI_9a == "No outcome" |
                    lost_someone_HI_10b == "No outcome" |
                       lost_someone_HI_11a == "No outcome" |
                    lost_someone_HI_12b == "No outcome" |
                       lost_someone_HI_13a == "No outcome" |
                      lost_someone_HI_14b == "No outcome" |
                       lost_someone_HI_15a == "No outcome" |
                    lost_someone_HI_16b == "No outcome"  ~ "Exposure but no outcome",
                  
                  
                  # Experienced outcome but not exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" |
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_losing_someone == "Not lost someone" &
                     outcome_phase_harmful_ideation == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(losing_someone_before_HI) 

# Create final variable of lost someone before HI outcome
dat <- dat %>%
  mutate(lost_someone_before_HI_final =
           case_when(losing_someone_before_HI == "Lost someone after harmful ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     losing_someone_before_HI == "Missing whether lost someone" | # Need to drop people who never answered or put PNTA for whether they'd lost someone
                     losing_someone_before_HI == "Missing whether experienced harmful ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced harmful ideation
                     
                      losing_someone_before_HI ==  "Outcome but no exposure" |
                     losing_someone_before_HI ==  "Neither exposure nor outcome" ~ "No",
                    
                    losing_someone_before_HI == "Exposure but no outcome" |
                    losing_someone_before_HI == "Lost someone before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(lost_someone_before_HI_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(lost_someone_before_HI_final) 
           )

# These people should all have experienced outcome before exposure    
missing %>%
  filter(exposure_phase_losing_someone != "Not answered or PNTA" &
          outcome_phase_harmful_ideation != "Not answered or PNTA") %>%
  select(exposure_phase_losing_someone,
         outcome_phase_harmful_ideation
         )
```

## Change in main eco activity (work/education)
### Identify at which phase they first experienced the exposure

Baseline:
employ.my_employment_status_has_not_changed = Has your employment status changed since the pandemic began? [My employment status has not changed]
employ.no_impact = How has this impacted your studies? [No impact]
employ.impact_on_studies_still_unknown = How has this impacted your studies? [Impact on studies still unknown]

Follow ups:
dem.household_employment_status_key: Has anything changed in the following domains in the last two weeks: Employment status of a key earner in your household
dem.employment: Has anything changed in the following domains in the last two weeks: Employment 
NB: No follow-up questions about studying.

Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - change in main eco activity}
dat <- dat %>%
  mutate(exposure_phase_main_eco_change =
           case_when(
                     # Change in employment at baseline
                     employ.my_employment_status_has_not_changed == "Not My employment status has not changed" ~ "Baseline",
                     
                     # (for students) Change in school/studies/exams at baseline
                     employ.no_impact == "Not No impact" &  
                     employ.impact_on_studies_still_unknown == "Not Impact on studies still unknown" ~ "Baseline", # Indicated that the pandemic has impacted their studies in some way at baseline
                     
                     # Missing at baseline and all phases
                       is.na(employ.no_impact) & # Not answered impact on studies at baseline
                      is.na(employ.my_employment_status_has_not_changed) & # Not answered whether employment has changed at baseline
                       
                    # Has anything changed in the following domains in the last two weeks: Employment
                       is.na(dem.employment_.Wave_1a) &  
                       is.na(dem.employment_.Wave_1b) &
                       is.na(dem.employment_.Wave_2a) &
                       is.na(dem.employment_.Wave_2b) &
                       is.na(dem.employment_.Wave_3a) &
                       is.na(dem.employment_.Wave_3b) &
                       is.na(dem.employment_.Wave_4a) &
                       is.na(dem.employment_.Wave_4b) &
                       is.na(dem.employment_.Wave_5a) &
                       is.na(dem.employment_.Wave_6b) &
                       is.na(dem.employment_.Wave_7a) &
                       is.na(dem.employment_.Wave_8b) &
                       is.na(dem.employment_.Wave_9a) &
                       is.na(dem.employment_.Wave_10b) &
                       is.na(dem.employment_.Wave_11a) &
                       is.na(dem.employment_.Wave_12b) &
                       is.na(dem.employment_.Wave_13a) &
                       is.na(dem.employment_.Wave_14b) &
                       is.na(dem.employment_.Wave_15a) &
                       is.na(dem.employment_.Wave_16b) &

                    # Has anything changed in the following domains in the last two weeks: Employment status of a key earner in your household   
                       is.na(dem.household_employment_status_key_.Wave_1a) &  
                       is.na(dem.household_employment_status_key_.Wave_1b) &
                       is.na(dem.household_employment_status_key_.Wave_2a) &
                       is.na(dem.household_employment_status_key_.Wave_2b) &
                       is.na(dem.household_employment_status_key_.Wave_3a) &
                       is.na(dem.household_employment_status_key_.Wave_3b) &
                       is.na(dem.household_employment_status_key_.Wave_4a) &
                       is.na(dem.household_employment_status_key_.Wave_4b) &
                       is.na(dem.household_employment_status_key_.Wave_5a) &
                       is.na(dem.household_employment_status_key_.Wave_6b) &
                       is.na(dem.household_employment_status_key_.Wave_7a) &
                       is.na(dem.household_employment_status_key_.Wave_8b) &
                       is.na(dem.household_employment_status_key_.Wave_9a) &
                       is.na(dem.household_employment_status_key_.Wave_10b) &
                       is.na(dem.household_employment_status_key_.Wave_11a) &
                       is.na(dem.household_employment_status_key_.Wave_12b) &
                       is.na(dem.household_employment_status_key_.Wave_13a) &
                       is.na(dem.household_employment_status_key_.Wave_14b) &
                       is.na(dem.household_employment_status_key_.Wave_15a) &
                       is.na(dem.household_employment_status_key_.Wave_16b)  ~ "Missing at every phase", # Not answered whether employment has changed in the last two weeks 
            
                       dem.employment_.Wave_1a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_1a == "Employment status of a key earner in your household" ~ "1a",
                       dem.employment_.Wave_1b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_1b == "Employment status of a key earner in your household" ~ "1b",
                       dem.employment_.Wave_2a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_2a == "Employment status of a key earner in your household"~ "2a",
                       dem.employment_.Wave_2b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_2b == "Employment status of a key earner in your household"~ "2b",
                       dem.employment_.Wave_3a == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_3a == "Employment status of a key earner in your household" ~ "3a",
                       dem.employment_.Wave_3b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_3b == "Employment status of a key earner in your household"~ "3b",
                       dem.employment_.Wave_4a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_4a == "Employment status of a key earner in your household"~ "4a",
                       dem.employment_.Wave_4b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_4b == "Employment status of a key earner in your household"~ "4b",
                       dem.employment_.Wave_5a == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_5a == "Employment status of a key earner in your household" ~ "5a",
                       dem.employment_.Wave_6b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_6b == "Employment status of a key earner in your household"~ "6b",
                       dem.employment_.Wave_7a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_7a == "Employment status of a key earner in your household" ~ "7a",
                       dem.employment_.Wave_8b == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_8b == "Employment status of a key earner in your household" ~ "8b",
                       dem.employment_.Wave_9a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_9a == "Employment status of a key earner in your household"~ "9a",
                       dem.employment_.Wave_10b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_10b == "Employment status of a key earner in your household"~ "10b",
                       dem.employment_.Wave_11a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_11a == "Employment status of a key earner in your household"~ "11a",
                       dem.employment_.Wave_12b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_12b == "Employment status of a key earner in your household"~ "12b",
                       dem.employment_.Wave_13a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_13a == "Employment status of a key earner in your household"~ "13a",
                       dem.employment_.Wave_14b == "Employment"|
                      dat$dem.household_employment_status_key_.Wave_14b == "Employment status of a key earner in your household" ~ "14b",
                       dem.employment_.Wave_15a == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_15a == "Employment status of a key earner in your household"~ "15a",
                       dem.employment_.Wave_16b == "Employment" |
                      dat$dem.household_employment_status_key_.Wave_16b == "Employment status of a key earner in your household"~ "16b",
                       
                    
                       employ.my_employment_status_has_not_changed == "My employment status has not changed" | # Not experienced change in employment at baseline
                       employ.no_impact == "No impact"  | # Not impacted studies at baseline
                       employ.impact_on_studies_still_unknown == "Impact on studies still unknown" | # Not sure about impact yet
                       dem.employment_.Wave_1a == "Not Employment" |
                       dem.employment_.Wave_1b == "Not Employment" |
                       dem.employment_.Wave_2a == "Not Employment" |
                       dem.employment_.Wave_2b == "Not Employment" |
                       dem.employment_.Wave_3a == "Not Employment" |
                       dem.employment_.Wave_3b == "Not Employment" |
                       dem.employment_.Wave_4a == "Not Employment" |
                       dem.employment_.Wave_4b == "Not Employment" |
                       dem.employment_.Wave_5a == "Not Employment" |
                       dem.employment_.Wave_6b == "Not Employment" |
                       dem.employment_.Wave_7a == "Not Employment" |
                       dem.employment_.Wave_8b == "Not Employment" |
                       dem.employment_.Wave_9a == "Not Employment" |
                       dem.employment_.Wave_10b == "Not Employment" |
                       dem.employment_.Wave_11a == "Not Employment" |
                       dem.employment_.Wave_12b == "Not Employment" |
                       dem.employment_.Wave_13a == "Not Employment" |
                       dem.employment_.Wave_14b == "Not Employment" |
                       dem.employment_.Wave_15a == "Not Employment" |
                       dem.employment_.Wave_16b == "Not Employment" |

                      dem.household_employment_status_key_.Wave_1a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_1b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_2a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_2b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_3a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_3b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_4a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_4b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_5a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_6b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_7a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_8b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_9a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_10b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_11a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_12b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_13a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_14b == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_15a == "Not Employment status of a key earner in your household" |
                       dem.household_employment_status_key_.Wave_16b == "Not Employment status of a key earner in your household"~ "No change in eco activity" # Have experienced change but not in the employment domain
                     
                   ))

dat %>%
  freq(exposure_phase_main_eco_change)
```

Harmful ideation
```{r Change in main eco activity BEFORE outcome HI}
# Baseline
dat <- dat %>%
  mutate(main_eco_change_HI_baseline =
           case_when(
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_harmful_ideation == "Baseline" | # Co-occurring 
                        outcome_phase_harmful_ideation == "1a" | 
                        outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" | 
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(main_eco_change_HI_1a =
           case_when(
                      exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_harmful_ideation == "Baseline"~ "To drop", # Outcome before exposure
                      
                     exposure_phase_main_eco_change == "1a" & # First exposure at 1a
                      outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_main_eco_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_harmful_ideation == "1a" |  # Co-occurring
                        outcome_phase_harmful_ideation == "1b" |  
                         outcome_phase_harmful_ideation == "2a" | 
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" | 
                       outcome_phase_harmful_ideation == "3b" |
                          outcome_phase_harmful_ideation == "4a" | 
                       outcome_phase_harmful_ideation == "4b" |
                          outcome_phase_harmful_ideation == "5a" | 
                       outcome_phase_harmful_ideation == "6b" |
                          outcome_phase_harmful_ideation == "7a" | 
                       outcome_phase_harmful_ideation == "8b" |
                          outcome_phase_harmful_ideation == "9a" | 
                       outcome_phase_harmful_ideation == "10b" |
                          outcome_phase_harmful_ideation == "11a" | 
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_1a)


# Phase 1b
dat <- dat %>%
  mutate(main_eco_change_HI_1b =
           case_when(exposure_phase_main_eco_change == "1b" & # First exposure at 1a
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1a") ~ "To drop", # Outcome before exposure
             
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                       exposure_phase_main_eco_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_harmful_ideation == "1b" |  # Co-occurring outcome and exposure
                      outcome_phase_harmful_ideation == "2a" |
                         outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                        outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(main_eco_change_HI_2a =
           case_when(exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_harmful_ideation == "Baseline" |
                       outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_main_eco_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_harmful_ideation == "2a" | # Co-occurring
                         outcome_phase_harmful_ideation == "2b" |
                          outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(main_eco_change_HI_2b =
           case_when(
                      exposure_phase_main_eco_change == "2b" &
                        (outcome_phase_harmful_ideation == "Baseline" |
                           outcome_phase_harmful_ideation == "1a" |
                           outcome_phase_harmful_ideation == "1b" |
                          outcome_phase_harmful_ideation == "2a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "2b" & # First  exposure at phase 2b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "3a" |
                          outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(main_eco_change_HI_3a =
           case_when(
                      exposure_phase_main_eco_change == "3a" &
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                       outcome_phase_harmful_ideation == "2b" ) ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3a" & # First  exposure at phase 3a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_main_eco_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_harmful_ideation == "3a" | # Co-occurring
                         outcome_phase_harmful_ideation == "3b" |
                          outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(main_eco_change_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(main_eco_change_HI_3b =
           case_when(exposure_phase_main_eco_change == "3b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                      outcome_phase_harmful_ideation == "4a" |
                           outcome_phase_harmful_ideation == "4b" |
                        outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                        outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(main_eco_change_HI_4a =
           case_when(exposure_phase_main_eco_change == "4a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_main_eco_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_harmful_ideation == "4a" | # Co-occurring
                         outcome_phase_harmful_ideation == "4b" |
                          outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(main_eco_change_HI_4b =
           case_when(exposure_phase_main_eco_change == "4b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "5a" |
                          outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(main_eco_change_HI_5a =
           case_when(exposure_phase_main_eco_change == "5a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_main_eco_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_harmful_ideation == "5a" |
                         outcome_phase_harmful_ideation == "6b" |
                          outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(main_eco_change_HI_6b =
           case_when(exposure_phase_main_eco_change == "6b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" )  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_harmful_ideation == "6b" | # Co-occurring outcome and exposure
                      outcome_phase_harmful_ideation == "7a" |
                        outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_HI_6b)

# Phase 7a
dat <- dat %>%
  mutate(main_eco_change_HI_7a =
           case_when(exposure_phase_main_eco_change == "7a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                   outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_main_eco_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_harmful_ideation == "7a" | # Co-occurring
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(main_eco_change_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(main_eco_change_HI_8b =
           case_when(exposure_phase_main_eco_change == "8b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "8b" & # First exposure at phase 8b
                      (
                        outcome_phase_harmful_ideation == "8b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "9a" |
                          outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(main_eco_change_HI_9a =
           case_when(exposure_phase_main_eco_change == "9a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_main_eco_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_harmful_ideation == "9a" | # Co-occurring
                        outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_9a)

# Phase 10b
dat <- dat %>%
  mutate(main_eco_change_HI_10b =
           case_when(exposure_phase_main_eco_change == "10b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_harmful_ideation == "10b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "11a" |
                         outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(main_eco_change_HI_11a  =
           case_when(exposure_phase_main_eco_change == "11a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" | 
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                  outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_harmful_ideation == "11a" | # Co-occurring
                    outcome_phase_harmful_ideation == "12b"| 
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(main_eco_change_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(main_eco_change_HI_12b =
           case_when(exposure_phase_main_eco_change == "12b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_harmful_ideation == "12b" |  # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_12b)

# Phase 13a
dat <- dat %>%
  mutate(main_eco_change_HI_13a =
           case_when(exposure_phase_main_eco_change == "13a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "13a" & # First exposure at phase 13a
                    ( outcome_phase_harmful_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "14b" | 
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_13a)


# Phase 14b
dat <- dat %>%
  mutate(main_eco_change_HI_14b =
           case_when(exposure_phase_main_eco_change == "14b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 14b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "14b" & # First exposure at phase 13a
                    (  outcome_phase_harmful_ideation == "14b" |   # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_14b)


# Phase 15a
dat <- dat %>%
  mutate(main_eco_change_HI_15a =
           case_when(exposure_phase_main_eco_change == "15a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                        outcome_phase_harmful_ideation == "14b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_harmful_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_15a)



# Phase 16b
dat <- dat %>%
  mutate(main_eco_change_HI_16b =
           case_when(exposure_phase_main_eco_change == "16b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                        outcome_phase_harmful_ideation == "14b" |
                        outcome_phase_harmful_ideation == "15a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_main_eco_change == "16b" & # First exposure at phase 16b
                     outcome_phase_harmful_ideation == "16b" ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(main_eco_change_HI_16b)
```

Harmful ideation & change in main eco activity 
```{r Change in eco activity exposure HI}
dat <- dat %>%
  mutate(main_eco_change_before_HI =
           case_when(# First exposure NOT before first experience of outcome   
                    main_eco_change_HI_baseline == "To drop" |
                       main_eco_change_HI_1a == "To drop" |
                    main_eco_change_HI_1b == "To drop" |
                       main_eco_change_HI_2a == "To drop" |
                    main_eco_change_HI_2b == "To drop" |
                       main_eco_change_HI_3a == "To drop" |
                    main_eco_change_HI_3b == "To drop" |
                       main_eco_change_HI_4a == "To drop" |
                    main_eco_change_HI_4b == "To drop" |
                       main_eco_change_HI_5a == "To drop" |
                    main_eco_change_HI_6b == "To drop" |
                       main_eco_change_HI_7a == "To drop" |
                    main_eco_change_HI_8b == "To drop" |
                       main_eco_change_HI_9a == "To drop" |
                    main_eco_change_HI_10b == "To drop" |
                       main_eco_change_HI_11a == "To drop" |
                    main_eco_change_HI_12b == "To drop" |
                    main_eco_change_HI_13a == "To drop" |
                       main_eco_change_HI_14b == "To drop" |
                    main_eco_change_HI_15a == "To drop" |
                       main_eco_change_HI_16b == "To drop" ~ "Change in eco activity after harmful ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_main_eco_change == "Missing at every phase" ~ "Missing whether change in eco activity", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "Missing whether experienced harmful ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    main_eco_change_HI_baseline == "Yes" |
                     main_eco_change_HI_1a == "Yes" |
                    main_eco_change_HI_1b == "Yes" |
                     main_eco_change_HI_2a == "Yes" |
                    main_eco_change_HI_2b == "Yes" |
                     main_eco_change_HI_3a == "Yes" |
                    main_eco_change_HI_3b == "Yes" |
                     main_eco_change_HI_4a == "Yes" |
                    main_eco_change_HI_4b == "Yes" |
                     main_eco_change_HI_5a == "Yes" |
                    main_eco_change_HI_6b == "Yes" |
                     main_eco_change_HI_7a == "Yes" |
                    main_eco_change_HI_8b == "Yes" |
                     main_eco_change_HI_9a == "Yes" |
                    main_eco_change_HI_10b == "Yes" |
                     main_eco_change_HI_11a == "Yes" |
                    main_eco_change_HI_12b == "Yes"|
                    main_eco_change_HI_13a == "Yes" |
                     main_eco_change_HI_14b == "Yes" |
                    main_eco_change_HI_15a == "Yes" |
                     main_eco_change_HI_16b == "Yes"  ~ "Change in eco activity before harmful ideation",
                    
                   # Experienced exposure but not outcome
                    main_eco_change_HI_baseline == "No outcome" |
                    main_eco_change_HI_1a == "No outcome" |
                    main_eco_change_HI_1b == "No outcome" |
                    main_eco_change_HI_2a == "No outcome" |
                    main_eco_change_HI_2b == "No outcome" |
                    main_eco_change_HI_3a == "No outcome" |
                    main_eco_change_HI_3b == "No outcome" |
                    main_eco_change_HI_4a == "No outcome" |
                    main_eco_change_HI_4b == "No outcome" |
                    main_eco_change_HI_5a == "No outcome" |
                    main_eco_change_HI_6b == "No outcome" |
                    main_eco_change_HI_7a == "No outcome" |
                    main_eco_change_HI_8b == "No outcome" |
                    main_eco_change_HI_9a == "No outcome" |
                    main_eco_change_HI_10b == "No outcome" |
                    main_eco_change_HI_11a == "No outcome" |
                    main_eco_change_HI_12b == "No outcome" |
                    main_eco_change_HI_13a == "No outcome" |
                    main_eco_change_HI_14b == "No outcome" |
                    main_eco_change_HI_15a == "No outcome" |
                    main_eco_change_HI_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" |
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_main_eco_change == "No change in eco activity" &
                     outcome_phase_harmful_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(main_eco_change_before_HI) 

# Create final variable of first exposure before first outcome
dat <- dat %>%
  mutate(main_eco_change_before_HI_final =
           case_when(main_eco_change_before_HI == "Change in eco activity after harmful ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     main_eco_change_before_HI == "Missing whether change in eco activity" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their main eco activity
                      main_eco_change_before_HI == "Missing whether experienced harmful ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced outcome
                     
                      main_eco_change_before_HI ==  "Outcome but no exposure" |
                      main_eco_change_before_HI ==  "Neither exposure nor outcome" ~ "No",
                      
                     main_eco_change_before_HI == "Exposure but no outcome" |
                      main_eco_change_before_HI == "Change in eco activity before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(main_eco_change_before_HI_final)  

# Check NAs
missing <- dat %>%
  filter(is.na(main_eco_change_before_HI_final) 
           )

# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_main_eco_change != "Missing at every phase" &
          outcome_phase_harmful_ideation != "Not answered or PNTA" &
  outcome_phase_harmful_ideation != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_main_eco_change,
         outcome_phase_harmful_ideation
         )
```


## Change in living situation
### Identify at which phase they first experienced the exposure

Exposure must come before the outcome. Need to identify at which wave participants first experienced each exposure (as well as first experience of each outcome), to ensure that their first experience of the exposure happened BEFORE their first experience of the outcome.
```{r First experience of exposure - change in living situation}
dat <- dat %>%
  mutate(exposure_phase_living_situation_change =
           case_when(
                     # Change in employment
                     dem2.living_situation_change_pandemic == "Yes" ~ "Baseline", # Indicated change in living situation at baseline
                  
                     # Missing at baseline and all phases
                       is.na(dem2.living_situation_change_pandemic) & # Not answered at baseline
                      is.na(dem.living_situation_.Wave_1a) &  # Has anything changed in the following domains in the last two weeks: Living situation
                       is.na(dem.living_situation_.Wave_1b) &
                       is.na(dem.living_situation_.Wave_2a) &
                       is.na(dem.living_situation_.Wave_2b) &
                       is.na(dem.living_situation_.Wave_3a) &
                       is.na(dem.living_situation_.Wave_3b) &
                       is.na(dem.living_situation_.Wave_4a) &
                       is.na(dem.living_situation_.Wave_4b) &
                       is.na(dem.living_situation_.Wave_5a) &
                       is.na(dem.living_situation_.Wave_6b) &
                       is.na(dem.living_situation_.Wave_7a) &
                       is.na(dem.living_situation_.Wave_8b) &
                       is.na(dem.living_situation_.Wave_9a) &
                       is.na(dem.living_situation_.Wave_10b) &
                       is.na(dem.living_situation_.Wave_11a) &
                       is.na(dem.living_situation_.Wave_12b)&
                       is.na(dem.living_situation_.Wave_13a) &
                       is.na(dem.living_situation_.Wave_14b) &
                       is.na(dem.living_situation_.Wave_15a) &
                       is.na(dem.living_situation_.Wave_16b) ~ "Missing at every phase", # Not answered whether living situation has changed in the last two weeks 
            
                       dem.living_situation_.Wave_1a == "Living situation" ~ "1a",
                       dem.living_situation_.Wave_1b == "Living situation" ~ "1b",
                       dem.living_situation_.Wave_2a == "Living situation" ~ "2a",
                       dem.living_situation_.Wave_2b == "Living situation" ~ "2b",
                       dem.living_situation_.Wave_3a == "Living situation" ~ "3a",
                       dem.living_situation_.Wave_3b == "Living situation" ~ "3b",
                       dem.living_situation_.Wave_4a == "Living situation" ~ "4a",
                       dem.living_situation_.Wave_4b == "Living situation" ~ "4b",
                       dem.living_situation_.Wave_5a == "Living situation" ~ "5a",
                       dem.living_situation_.Wave_6b == "Living situation" ~ "6b",
                       dem.living_situation_.Wave_7a == "Living situation" ~ "7a",
                       dem.living_situation_.Wave_8b == "Living situation" ~ "8b",
                       dem.living_situation_.Wave_9a == "Living situation" ~ "9a",
                       dem.living_situation_.Wave_10b == "Living situation" ~ "10b",
                       dem.living_situation_.Wave_11a == "Living situation" ~ "11a",
                       dem.living_situation_.Wave_12b == "Living situation" ~ "12b",
                     dem.living_situation_.Wave_13a == "Living situation" ~ "13a",
                       dem.living_situation_.Wave_14b == "Living situation" ~ "14b",
                       dem.living_situation_.Wave_15a == "Living situation" ~ "15a",
                       dem.living_situation_.Wave_16b == "Living situation" ~ "16b",

                      dem2.living_situation_change_pandemic == "No" | # Not experienced change in living situation at baseline
                       dem.living_situation_.Wave_1a == "Not Living situation" |
                       dem.living_situation_.Wave_1b == "Not Living situation" |
                       dem.living_situation_.Wave_2a == "Not Living situation" |
                       dem.living_situation_.Wave_2b == "Not Living situation" |
                       dem.living_situation_.Wave_3a == "Not Living situation" |
                       dem.living_situation_.Wave_3b == "Not Living situation" |
                       dem.living_situation_.Wave_4a == "Not Living situation" |
                       dem.living_situation_.Wave_4b == "Not Living situation" |
                       dem.living_situation_.Wave_5a == "Not Living situation" |
                       dem.living_situation_.Wave_6b == "Not Living situation" |
                       dem.living_situation_.Wave_7a == "Not Living situation" |
                       dem.living_situation_.Wave_8b == "Not Living situation" |
                       dem.living_situation_.Wave_9a == "Not Living situation" |
                       dem.living_situation_.Wave_10b == "Not Living situation" |
                       dem.living_situation_.Wave_11a == "Not Living situation" |
                       dem.living_situation_.Wave_12b == "Not Living situation" |
                       dem.living_situation_.Wave_13a == "Not Living situation" |
                       dem.living_situation_.Wave_14b == "Not Living situation" |
                       dem.living_situation_.Wave_15a == "Not Living situation" |
                       dem.living_situation_.Wave_16b == "Not Living situation"  ~ "No change in living situation" # Have experienced change but not in the employment domain
                     
                   ))


dat %>%
  freq(exposure_phase_living_situation_change)

```

Harmful ideation
```{r Change in living situation BEFORE outcome HI}
# Baseline
dat <- dat %>%
  mutate(living_situation_change_HI_baseline =
           case_when(
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "Baseline" & # First exposure at baseline
                      (outcome_phase_harmful_ideation == "Baseline" | # Co-occurring
                         outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "1b" |  
                         outcome_phase_harmful_ideation == "2a" |
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_baseline)

# Phase 1a
dat <- dat %>%
  mutate(living_situation_change_HI_1a =
           case_when(
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_harmful_ideation == "Baseline" ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1a" & # First exposure at 1a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                        
                      exposure_phase_living_situation_change == "1a" & # First exposure at phase 1a
                      (outcome_phase_harmful_ideation == "1a" | # Co-occurring
                        outcome_phase_harmful_ideation == "1b" | 
                         outcome_phase_harmful_ideation == "2a" |
                       outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_1a)


# Phase 1b
dat <- dat %>%
  mutate(living_situation_change_HI_1b =
           case_when(exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a") ~ "To drop", # Outcome before exposure
             
             exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                        exposure_phase_living_situation_change == "1b" & # First exposure at phase 1b
                      (outcome_phase_harmful_ideation == "1b" |  # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "2a" |
                         outcome_phase_harmful_ideation == "2b" |
                         outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_1b)

# Phase 2a
dat <- dat %>%
  mutate(living_situation_change_HI_2a =
           case_when(exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                      outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                       
                     exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_harmful_ideation == "Baseline" |
                          outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b") ~ "To drop", # Exposure occurred after outcome
                     
                        exposure_phase_living_situation_change == "2a" & # First exposure at phase 2a
                       (outcome_phase_harmful_ideation == "2a" |
                         outcome_phase_harmful_ideation == "2b" |
                          outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes"  # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_2a)

# Phase 2b
dat <- dat %>%
  mutate(living_situation_change_HI_2b =
           case_when(
                      exposure_phase_living_situation_change == "2b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a") ~ "To drop", # First experience of outcome occurred HIfore first experience of exposure
                     
                     exposure_phase_living_situation_change == "2b" & # First  exposure at phase 2b
                     outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "2b" & # First exposure at phase 2b
                       (outcome_phase_harmful_ideation == "2b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "3a" |
                          outcome_phase_harmful_ideation == "3b" |
                         outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_HI_2b)

# Phase 3a
dat <- dat %>%
  mutate(living_situation_change_HI_3a =
           case_when(
                      exposure_phase_living_situation_change == "3a" &
                      (outcome_phase_harmful_ideation == "Baseline" |
                         outcome_phase_harmful_ideation == "1a" |
                        outcome_phase_harmful_ideation == "1b" |
                         outcome_phase_harmful_ideation == "2a" |
                       outcome_phase_harmful_ideation == "2b") ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                      exposure_phase_living_situation_change == "3a" & # First  exposure at phase 3a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                      exposure_phase_living_situation_change == "3a" & # First exposure at phase 3a
                       (outcome_phase_harmful_ideation == "3a" | # Co-occurring
                         outcome_phase_harmful_ideation == "3b" |
                          outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )

# Check
dat %>%
  freq(living_situation_change_HI_3a)

# Phase 3b
dat <- dat %>%
  mutate(living_situation_change_HI_3b =
           case_when(exposure_phase_living_situation_change == "3b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "3b" & # First exposure at phase 3b
                       (outcome_phase_harmful_ideation == "3b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "4a" |
                          outcome_phase_harmful_ideation == "4b" |
                         outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_3b)

# Phase 4a
dat <- dat %>%
  mutate(living_situation_change_HI_4a =
           case_when(exposure_phase_living_situation_change == "4a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                      outcome_phase_harmful_ideation == "2b" |
                        outcome_phase_harmful_ideation == "3a" |
                       outcome_phase_harmful_ideation == "3b" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure - need to drop
                     
                      exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                    outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                      
                     exposure_phase_living_situation_change == "4a" & # First exposure at phase 4a
                       (outcome_phase_harmful_ideation == "4a" | # Co-occurring
                         outcome_phase_harmful_ideation == "4b" |
                          outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                    )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_4a)

# Phase 4b
dat <- dat %>%
  mutate(living_situation_change_HI_4b =
           case_when(exposure_phase_living_situation_change == "4b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "4b" & # First exposure at phase 4b
                       (outcome_phase_harmful_ideation == "4b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "5a" |
                          outcome_phase_harmful_ideation == "6b" |
                         outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_4b)

# Phase 5a
dat <- dat %>%
  mutate(living_situation_change_HI_5a =
           case_when(exposure_phase_living_situation_change == "5a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                       outcome_phase_harmful_ideation == "4b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                     exposure_phase_living_situation_change == "5a" & # First exposure at phase 5a
                       (outcome_phase_harmful_ideation == "5a" | # Co-occurring
                         outcome_phase_harmful_ideation == "6b" |
                          outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                         outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_5a)

# Phase 6b
dat <- dat %>%
  mutate(living_situation_change_HI_6b =
           case_when(exposure_phase_living_situation_change == "6b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "6b" & # First exposure at phase 6b
                    (outcome_phase_harmful_ideation == "6b" | # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_HI_6b)

# Phase 7a
dat <- dat %>%
  mutate(living_situation_change_HI_7a =
           case_when(exposure_phase_living_situation_change == "7a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                       outcome_phase_harmful_ideation == "6b")  ~ "To drop", # First experience of outcome occurred before first expeirence of exposure
                     
                     exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                     
                    exposure_phase_living_situation_change == "7a" & # First exposure at phase 7a
                    (  outcome_phase_harmful_ideation == "7a" | # Co-occurring
                      outcome_phase_harmful_ideation == "8b" |
                        outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
         )
      
# Check
dat %>%
  freq(living_situation_change_HI_7a)

# Phase 8b
dat <- dat %>%
  mutate(living_situation_change_HI_8b =
           case_when(exposure_phase_living_situation_change == "8b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "8b" & # First exposure at phase 8b
                      (outcome_phase_harmful_ideation == "8b" | # Co-occurring outcome and exposure
                      outcome_phase_harmful_ideation == "9a" |
                          outcome_phase_harmful_ideation == "10b" |
                        outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_8b)

# Phase 9a
dat <- dat %>%
  mutate(living_situation_change_HI_9a =
           case_when(exposure_phase_living_situation_change == "9a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                       outcome_phase_harmful_ideation == "8b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                     outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                      exposure_phase_living_situation_change == "9a" & # First exposure at phase 9a
                      (outcome_phase_harmful_ideation == "9a" | # Co-occurring
                        outcome_phase_harmful_ideation == "10b" |
                         outcome_phase_harmful_ideation == "11a" |
                       outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_9a)

# Phase 10b
dat <- dat %>%
  mutate(living_situation_change_HI_10b =
           case_when(exposure_phase_living_situation_change == "10b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "10b" & # First exposure at phase 10b
                      (outcome_phase_harmful_ideation == "10b" | # Co-occurring outcome and exposure
                      outcome_phase_harmful_ideation == "11a" |
                          outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b" ) ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_10b)

# Phase 11a
dat <- dat %>%
  mutate(living_situation_change_HI_11a  =
           case_when(exposure_phase_living_situation_change == "11a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" | 
                       outcome_phase_harmful_ideation == "9a" |
                       outcome_phase_harmful_ideation == "10b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                   outcome_phase_harmful_ideation == "Not experienced"~ "No outcome", # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "11a" & # First exposure at phase 10b
                      (outcome_phase_harmful_ideation == "11a" | # Co-occurring
                     outcome_phase_harmful_ideation == "12b"|
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Experienced outcome AFTER or at SAME TIME as exposure
                     )
  )
      
# Check
dat %>%
  freq(living_situation_change_HI_11a)

# Phase 12b
dat <- dat %>%
  mutate(living_situation_change_HI_12b =
           case_when(exposure_phase_living_situation_change == "12b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a" )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "12b" & # First exposure at phase 12b
                    (outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" # Co-occurring outcome and exposure
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_12b)

# Phase 13a
dat <- dat %>%
  mutate(living_situation_change_HI_13a =
           case_when(exposure_phase_living_situation_change == "13a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "12b")  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "13a" & # First exposure at phase 13a
                    (outcome_phase_harmful_ideation == "13a" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "14b" |
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_13a)


# Phase 14b
dat <- dat %>%
  mutate(living_situation_change_HI_14b =
           case_when(exposure_phase_living_situation_change == "14b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "14b" & # First exposure at phase 14b
                    (outcome_phase_harmful_ideation == "14b" |  # Co-occurring outcome and exposure
                       outcome_phase_harmful_ideation == "15a" |
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_14b)



# Phase 15a
dat <- dat %>%
  mutate(living_situation_change_HI_15a =
           case_when(exposure_phase_living_situation_change == "15a" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "15a" & # First exposure at phase 15a
                    (  outcome_phase_harmful_ideation == "15a" | # Co-occurring outcome and exposure
                         outcome_phase_harmful_ideation == "16b") ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_15a)



# Phase 16b
dat <- dat %>%
  mutate(living_situation_change_HI_16b =
           case_when(exposure_phase_living_situation_change == "16b" &
                     (outcome_phase_harmful_ideation == "Baseline" |
                        outcome_phase_harmful_ideation == "1a" |
                       outcome_phase_harmful_ideation == "1b" |
                        outcome_phase_harmful_ideation == "2a" |
                     outcome_phase_harmful_ideation == "2b" |
                       outcome_phase_harmful_ideation == "3a" |
                     outcome_phase_harmful_ideation == "3b" |
                       outcome_phase_harmful_ideation == "4a" |
                     outcome_phase_harmful_ideation == "4b" |
                       outcome_phase_harmful_ideation == "5a" |
                     outcome_phase_harmful_ideation == "6b" |
                       outcome_phase_harmful_ideation == "7a" |
                     outcome_phase_harmful_ideation == "8b" |
                       outcome_phase_harmful_ideation == "9a" |
                     outcome_phase_harmful_ideation == "10b" |
                       outcome_phase_harmful_ideation == "11a"|
                       outcome_phase_harmful_ideation == "12b" |
                       outcome_phase_harmful_ideation == "13a" |
                       outcome_phase_harmful_ideation == "14b" |
                        outcome_phase_harmful_ideation == "15a" 
                         )  ~ "To drop", # First experience of outcome occurred before first experience of exposure
                     
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                    outcome_phase_harmful_ideation == "Not experienced" ~ "No outcome",  # Never experienced outcome (people who are all NA are coded as "Not answered")
                    
                     exposure_phase_living_situation_change == "16b" & # First exposure at phase 16b
                      outcome_phase_harmful_ideation == "16b"  ~ "Yes" 
         ) 
  )
  
      
# Check
dat %>%
  freq(living_situation_change_HI_16b)
```

harmful ideation & change in living situation
```{r Change in eco activity exposure HI}

dat <- dat %>%
  mutate(living_situation_change_before_HI =
           case_when(# First exposure NOT before first experience of outcome   
                    living_situation_change_HI_baseline == "To drop" |
                    living_situation_change_HI_1a == "To drop" |
                    living_situation_change_HI_1b == "To drop" |
                      living_situation_change_HI_2a == "To drop" |
                    living_situation_change_HI_2b == "To drop" |
                      living_situation_change_HI_3a == "To drop" |
                    living_situation_change_HI_3b == "To drop" |
                      living_situation_change_HI_4a == "To drop" |
                    living_situation_change_HI_4b == "To drop" |
                      living_situation_change_HI_5a == "To drop" |
                    living_situation_change_HI_6b == "To drop" |
                      living_situation_change_HI_7a == "To drop" |
                    living_situation_change_HI_8b == "To drop" |
                      living_situation_change_HI_9a == "To drop" |
                    living_situation_change_HI_10b == "To drop" |
                      living_situation_change_HI_11a == "To drop" |
                    living_situation_change_HI_12b == "To drop" |
                    living_situation_change_HI_13a == "To drop" |
                      living_situation_change_HI_14b == "To drop" |
                    living_situation_change_HI_15a == "To drop" |
                      living_situation_change_HI_16b == "To drop" ~ "Change in living situation after harmful ideation",
                    
                     # Not answered whether they'd experienced exposure
                    exposure_phase_living_situation_change == "Missing at every phase" ~ "Missing whether change in living situation", # Need to be dropped
                    
                    # Not answered whether they'd experienced outcome
                    outcome_phase_harmful_ideation == "Not answered or PNTA" ~ "Missing whether experienced harmful ideation", # Need to be dropped
                    
                  # First exposure BEFORE first experience of outcome
                    living_situation_change_HI_baseline == "Yes" |
                    living_situation_change_HI_1a == "Yes" |
                    living_situation_change_HI_1b == "Yes" |
                    living_situation_change_HI_2a == "Yes" |
                    living_situation_change_HI_2b == "Yes" |
                    living_situation_change_HI_3a == "Yes" |
                    living_situation_change_HI_3b == "Yes" |
                    living_situation_change_HI_4a == "Yes" |
                    living_situation_change_HI_4b == "Yes" |
                    living_situation_change_HI_5a == "Yes" |
                    living_situation_change_HI_6b == "Yes" |
                    living_situation_change_HI_7a == "Yes" |
                    living_situation_change_HI_8b == "Yes" |
                    living_situation_change_HI_9a == "Yes" |
                    living_situation_change_HI_10b == "Yes" |
                    living_situation_change_HI_11a == "Yes" |
                    living_situation_change_HI_12b == "Yes"|
                    living_situation_change_HI_13a == "Yes" |
                    living_situation_change_HI_14b == "Yes" |
                    living_situation_change_HI_15a == "Yes" |
                    living_situation_change_HI_16b == "Yes" ~ "Change in living situation before harmful ideation",
                    
                   # Experienced exposure but not outcome
                    living_situation_change_HI_baseline == "No outcome" |
                    living_situation_change_HI_1a == "No outcome" |
                    living_situation_change_HI_1b == "No outcome" |
                    living_situation_change_HI_2a == "No outcome" |
                    living_situation_change_HI_2b == "No outcome" |
                    living_situation_change_HI_3a == "No outcome" |
                    living_situation_change_HI_3b == "No outcome" |
                    living_situation_change_HI_4a == "No outcome" |
                    living_situation_change_HI_4b == "No outcome" |
                    living_situation_change_HI_5a == "No outcome" |
                    living_situation_change_HI_6b == "No outcome" |
                    living_situation_change_HI_7a == "No outcome" |
                    living_situation_change_HI_8b == "No outcome" |
                    living_situation_change_HI_9a == "No outcome" |
                    living_situation_change_HI_10b == "No outcome" |
                    living_situation_change_HI_11a == "No outcome" |
                    living_situation_change_HI_12b == "No outcome" |
                    living_situation_change_HI_13a == "No outcome" |
                    living_situation_change_HI_14b == "No outcome" |
                    living_situation_change_HI_15a == "No outcome" |
                    living_situation_change_HI_16b == "No outcome" ~ "Exposure but no outcome",
                  
                  # Experienced outcome but not exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     (outcome_phase_harmful_ideation != "Not answered or PNTA" |
                        outcome_phase_harmful_ideation != "Not experienced") ~ "Outcome but no exposure", 
                   
                       # Experienced neither outcome nor exposure
                   exposure_phase_living_situation_change == "No change in living situation" &
                     outcome_phase_harmful_ideation  == "Not experienced" ~ "Neither exposure nor outcome"
      )
)
                   
# Check                      
dat %>%
  freq(living_situation_change_before_HI) 


# Create final variable of exposure before outcome
dat <- dat %>%
  mutate(living_situation_change_before_HI_final =
           case_when(living_situation_change_before_HI == "Change in living situation after harmful ideation" | # Need to drop people who first experienced outcome before first experience of exposure
                     living_situation_change_before_HI == "Missing whether change in living situation" | # Need to drop people who never answered or put PNTA for whether they'd experienced a change in their living situation
                     living_situation_change_before_HI == "Missing whether experienced harmful ideation" ~ NA_character_,  # Need to drop people who never answered whether they'd experienced the outcome
                     
                       living_situation_change_before_HI ==  "Outcome but no exposure" |
                      living_situation_change_before_HI ==  "Neither exposure nor outcome" ~ "No",
                    
                    living_situation_change_before_HI == "Exposure but no outcome" |
                    living_situation_change_before_HI == "Change in living situation before harmful ideation" ~ "Yes")
  )

# Check
dat %>%
  freq(living_situation_change_before_HI_final) 

# Check NAs
missing <- dat %>%
  filter(is.na(living_situation_change_before_HI_final) 
           )


# These people should all have experienced outcome before exposure 
missing %>%
  filter(exposure_phase_living_situation_change != "Missing at every phase" &
          outcome_phase_harmful_ideation != "Not answered or PNTA" &
           outcome_phase_harmful_ideation != "Baseline") %>% # Many dropped participants have endorsed the outcome at baseline but the exposure later on. Want to check other instances (too many otherwise!)
  select(exposure_phase_living_situation_change,
         outcome_phase_harmful_ideation
         )
```

# Saving dataset
## Select & save variables needed for analysis
```{r Select final variables ready for regression analyses}
final_dat_HI <- dat %>%
  select(ID,
         sample,
        # Save original variables
        NEW_selfharm_ideation_pandemic,
        NEW_passive_suicidal_ideation_pandemic,
          
         # Outcome for self harm regressions 
         NEW_harmful_ideation_pandemic,

         # Exposures 
         positive_covid_test_before_HI_final,
        lost_someone_before_HI_final,
        main_eco_change_before_HI_final,
        living_situation_change_before_HI_final,

       # Sensitivity analysis
       sens_NEW_harmful_ideation_pandemic
        
        )

```

Save final dataset (interim analysis)
Save dataset
```{r save dataset}
saveRDS(object = final_dat_HI,
       file = paste0(filepath_saved_data, "final_dat_HI", date, ".rds"))
```
